<!DOCTYPE html>
<html lang="en-US" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.60" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://mister-hope.github.io/backend/database/mysql.html"><meta property="og:site_name" content="Eddie-Tech-Blog"><meta property="og:title" content="Mysql"><meta property="og:description" content="Mysql Basic image-20220926085405282 MySQLâ˜… è¿æ¥åˆ°MySQLæ•°æ®åº“çš„æ“ä½œ 1.æœåŠ¡å¯åŠ¨--net start mysql(æœåŠ¡å) æœåŠ¡å…³é—­--net stop mysql(æœåŠ¡å) 2.ç™»å½•ï¼ˆè¿æ¥ï¼‰--mysql -h ä¸»æœºå -P ç«¯å£ -u ç”¨æˆ·å -på¯†ç  é€€å‡ºï¼ˆæ–­è¿ï¼‰--exit -påä¸èƒ½å‡ºç°ç©ºæ ¼ ..."><meta property="og:type" content="article"><meta property="og:locale" content="en-US"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Mysql","image":[""],"dateModified":null,"author":[]}</script><title>Mysql | Eddie-Tech-Blog</title><meta name="description" content="Mysql Basic image-20220926085405282 MySQLâ˜… è¿æ¥åˆ°MySQLæ•°æ®åº“çš„æ“ä½œ 1.æœåŠ¡å¯åŠ¨--net start mysql(æœåŠ¡å) æœåŠ¡å…³é—­--net stop mysql(æœåŠ¡å) 2.ç™»å½•ï¼ˆè¿æ¥ï¼‰--mysql -h ä¸»æœºå -P ç«¯å£ -u ç”¨æˆ·å -på¯†ç  é€€å‡ºï¼ˆæ–­è¿ï¼‰--exit -påä¸èƒ½å‡ºç°ç©ºæ ¼ ...">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d1e1f;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/assets/style-71862533.css" as="style"><link rel="stylesheet" href="/assets/style-71862533.css">
    <link rel="modulepreload" href="/assets/app-7117916c.js"><link rel="modulepreload" href="/assets/framework-e28ace55.js"><link rel="modulepreload" href="/assets/mysql.html-b07665bd.js"><link rel="modulepreload" href="/assets/mysql.html-348f725d.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">Skip to main content</a><!--]--><!--[--><div class="theme-container has-toc"><!--[--><header class="navbar" id="navbar"><div class="navbar-start"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><a href="/" class="brand"><img class="logo" src="/logo.png" alt="Eddie-Tech-Blog"><!----><span class="site-name hide-in-pad">Eddie-Tech-Blog</span></a><!--[--><!----><!--]--></div><div class="navbar-center"><!--[--><!----><!--]--><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/" class="nav-link" aria-label="Home"><span class="font-icon icon iconfont icon-home" style=""></span>Home<!----></a></div><div class="nav-item hide-in-mobile"><a href="/eddie/" class="nav-link" aria-label="Expoler"><span class="font-icon icon iconfont icon-discover" style=""></span>Expoler<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Backend-Dev"><span class="title"><span class="font-icon icon iconfont icon-edit" style=""></span>Backend-Dev</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>Java</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/backend/java/jvm.html" class="nav-link" aria-label="JVM"><span class="font-icon icon iconfont icon-edit" style=""></span>JVM<!----></a></li><li class="dropdown-subitem"><a href="/backend/java/java8.html" class="nav-link" aria-label="Java8"><span class="font-icon icon iconfont icon-edit" style=""></span>Java8<!----></a></li><li class="dropdown-subitem"><a href="/backend/java/java_concurrency_programming.html" class="nav-link" aria-label="Java Concurrency Programming"><span class="font-icon icon iconfont icon-edit" style=""></span>Java Concurrency Programming<!----></a></li><li class="dropdown-subitem"><a href="/backend/java/Java.html" class="nav-link" aria-label="Java"><span class="font-icon icon iconfont icon-edit" style=""></span>Java<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>Database</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a aria-current="page" href="/backend/database/mysql.html" class="router-link-active router-link-exact-active nav-link active" aria-label="MySQL  Basic --- advanced"><span class="font-icon icon iconfont icon-edit" style=""></span>MySQL  Basic --- advanced<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>Dev-FrameWork</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/backend/dev_framework/SpringBoot.html" class="nav-link" aria-label="Spring Boot"><span class="font-icon icon iconfont icon-edit" style=""></span>Spring Boot<!----></a></li><li class="dropdown-subitem"><a href="/backend/dev_framework/SpringMVC.html" class="nav-link" aria-label="SpringMVC"><span class="font-icon icon iconfont icon-edit" style=""></span>SpringMVC<!----></a></li><li class="dropdown-subitem"><a href="/backend/dev_framework/Spring5.html" class="nav-link" aria-label="Spring5"><span class="font-icon icon iconfont icon-edit" style=""></span>Spring5<!----></a></li><li class="dropdown-subitem"><a href="/backend/dev_framework/Mybatis.html" class="nav-link" aria-label="Mybatis"><span class="font-icon icon iconfont icon-edit" style=""></span>Mybatis<!----></a></li><li class="dropdown-subitem"><a href="/backend/dev_framework/MybatisPlus.html" class="nav-link" aria-label="MybatisPlus"><span class="font-icon icon iconfont icon-edit" style=""></span>MybatisPlus<!----></a></li><li class="dropdown-subitem"><a href="/backend/dev_framework/SpringCloud.html" class="nav-link" aria-label="SpringCloud &amp; ~Aibaba"><span class="font-icon icon iconfont icon-edit" style=""></span>SpringCloud &amp; ~Aibaba<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>Middleware</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/backend/middleware/MQ.html" class="nav-link" aria-label="MQ"><span class="font-icon icon iconfont icon-edit" style=""></span>MQ<!----></a></li><li class="dropdown-subitem"><a href="/backend/middleware/Redis.html" class="nav-link" aria-label="Redis"><span class="font-icon icon iconfont icon-edit" style=""></span>Redis<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>Skills</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/backend/skills/DataStructureAlgorithm.html" class="nav-link" aria-label="DataStructureAlgorithm"><span class="font-icon icon iconfont icon-edit" style=""></span>DataStructureAlgorithm<!----></a></li><li class="dropdown-subitem"><a href="/backend/skills/ComputerNetwork.html" class="nav-link" aria-label="ComputerNetwork"><span class="font-icon icon iconfont icon-edit" style=""></span>ComputerNetwork<!----></a></li><li class="dropdown-subitem"><a href="/backend/skills/OperatingSystem.html" class="nav-link" aria-label="OperatingSystem"><span class="font-icon icon iconfont icon-edit" style=""></span>OperatingSystem<!----></a></li><li class="dropdown-subitem"><a href="/backend/skills/Methodology.html" class="nav-link" aria-label="Methodology"><span class="font-icon icon iconfont icon-edit" style=""></span>Methodology<!----></a></li><li class="dropdown-subitem"><a href="/backend/skills/IO.html" class="nav-link" aria-label="IO"><span class="font-icon icon iconfont icon-edit" style=""></span>IO<!----></a></li><li class="dropdown-subitem"><a href="/backend/skills/Netty.html" class="nav-link" aria-label="Netty"><span class="font-icon icon iconfont icon-edit" style=""></span>Netty<!----></a></li><li class="dropdown-subitem"><a href="/backend/skills/Linux.html" class="nav-link" aria-label="Linux"><span class="font-icon icon iconfont icon-edit" style=""></span>Linux<!----></a></li><li class="dropdown-subitem"><a href="/backend/skills/Dubbo.html" class="nav-link" aria-label="Dubbo"><span class="font-icon icon iconfont icon-edit" style=""></span>Dubbo<!----></a></li><li class="dropdown-subitem"><a href="/backend/skills/Zookeeper.html" class="nav-link" aria-label="Zookeeper"><span class="font-icon icon iconfont icon-edit" style=""></span>Zookeeper<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>Tools</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/backend/tools/Docker.html" class="nav-link" aria-label="Docker"><span class="font-icon icon iconfont icon-edit" style=""></span>Docker<!----></a></li><li class="dropdown-subitem"><a href="/backend/tools/Git.html" class="nav-link" aria-label="Git"><span class="font-icon icon iconfont icon-edit" style=""></span>Git<!----></a></li><li class="dropdown-subitem"><a href="/backend/tools/Maven.html" class="nav-link" aria-label="Maven"><span class="font-icon icon iconfont icon-edit" style=""></span>Maven<!----></a></li><li class="dropdown-subitem"><a href="/backend/tools/Nginx.html" class="nav-link" aria-label="Nginx"><span class="font-icon icon iconfont icon-edit" style=""></span>Nginx<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a href="/article-papper/" class="nav-link" aria-label="Article &amp; Papper"><span class="font-icon icon iconfont icon-note" style=""></span>Article &amp; Papper<!----></a></div></nav><!--[--><!----><!--]--></div><div class="navbar-end"><!--[--><!----><!--]--><!----><div class="nav-item"><a class="repo-link" href="https://github.com/EddieZturbo/Eddie-Tech-Blog.github.io" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--[--><!----><!--]--><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside class="sidebar" id="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><a href="/" class="nav-link sidebar-link sidebar-page" aria-label="Home"><span class="font-icon icon iconfont icon-home" style=""></span>Home<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><section class="sidebar-group"><p class="sidebar-heading clickable"><span class="font-icon icon iconfont icon-discover" style=""></span><a href="/eddie/" class="title">Eddie</a><!----></p><ul class="sidebar-links"></ul></section></li><li><section class="sidebar-group"><p class="sidebar-heading active"><span class="font-icon icon iconfont icon-note" style=""></span><span class="title">Backend-Dev</span><!----></p><ul class="sidebar-links"><li><section class="sidebar-group"><button class="sidebar-heading clickable active"><!----><span class="title">Database</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><!--[--><a aria-current="page" href="/backend/database/mysql.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="Mysql"><!---->Mysql<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/backend/database/mysql.html#mysql-basic" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Mysql Basic"><!---->Mysql Basic<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/backend/database/mysql.html#mysqlâ˜…" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="MySQLâ˜…"><!---->MySQLâ˜…<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/database/mysql.html#mysqlç³»ç»Ÿå˜é‡æŸ¥è¯¢" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Mysqlç³»ç»Ÿå˜é‡æŸ¥è¯¢"><!---->Mysqlç³»ç»Ÿå˜é‡æŸ¥è¯¢<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/backend/database/mysql.html#æŸ¥è¯¢è®¾ç½®å…¨å±€å˜é‡-show-global-variables-g" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="æŸ¥è¯¢è®¾ç½®å…¨å±€å˜é‡ï¼šshow global variables \G;"><!---->æŸ¥è¯¢è®¾ç½®å…¨å±€å˜é‡ï¼šshow global variables \G;<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/database/mysql.html#æŸ¥è¯¢è®¾ç½®ä¼šè¯å˜é‡-show-session-variables-g-æˆ–show-variables" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="æŸ¥è¯¢è®¾ç½®ä¼šè¯å˜é‡ï¼šshow session variables \G;æˆ–show variablesï¼›"><!---->æŸ¥è¯¢è®¾ç½®ä¼šè¯å˜é‡ï¼šshow session variables \G;æˆ–show variablesï¼›<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/database/mysql.html#most-popular-mysql-commands" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Most Popular MySQL Commands"><!---->Most Popular MySQL Commands<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/backend/database/mysql.html#crud" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="CRUD"><!---->CRUD<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/database/mysql.html#reset-autoincrement-primary-id" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Reset AutoIncrement_Primary_Id"><!---->Reset AutoIncrement_Primary_Id<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/database/mysql.html#users-management-commands" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Users Management Commands"><!---->Users Management Commands<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/database/mysql.html#database-management-commands" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Database Management Commands"><!---->Database Management Commands<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/database/mysql.html#table-commands" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Table Commands"><!---->Table Commands<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/database/mysql.html#keys-in-mysql" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Keys in MySQL"><!---->Keys in MySQL<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/database/mysql.html#constraints-in-mysql" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Constraints in MySQL"><!---->Constraints in MySQL<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/database/mysql.html#views" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Views"><!---->Views<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/database/mysql.html#manipulation-commandsâ˜…" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Manipulation Commandsâ˜…"><!---->Manipulation Commandsâ˜…<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/database/mysql.html#joins" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Joins"><!---->Joins<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/database/mysql.html#index" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Index"><!---->Index<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/database/mysql.html#privilege-commands" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Privilege Commands"><!---->Privilege Commands<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/database/mysql.html#triggers" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Triggers"><!---->Triggers<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/database/mysql.html#transaction-commands" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Transaction Commands"><!---->Transaction Commands<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/database/mysql.html#mysqlå®æˆ˜45è®²ç²¾é€‰" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="MySQLå®æˆ˜45è®²ç²¾é€‰"><!---->MySQLå®æˆ˜45è®²ç²¾é€‰<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/backend/database/mysql.html#_00å¼€ç¯‡è¯-è¿™ä¸€æ¬¡-è®©æˆ‘ä»¬ä¸€èµ·æ¥ææ‡‚mysql" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="00å¼€ç¯‡è¯ è¿™ä¸€æ¬¡ï¼Œè®©æˆ‘ä»¬ä¸€èµ·æ¥ææ‡‚MySQL"><!---->00å¼€ç¯‡è¯ è¿™ä¸€æ¬¡ï¼Œè®©æˆ‘ä»¬ä¸€èµ·æ¥ææ‡‚MySQL<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/database/mysql.html#_01-åŸºç¡€æ¶æ„-ä¸€æ¡sqlæŸ¥è¯¢è¯­å¥æ˜¯å¦‚ä½•æ‰§è¡Œçš„" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="01 åŸºç¡€æ¶æ„ï¼šä¸€æ¡SQLæŸ¥è¯¢è¯­å¥æ˜¯å¦‚ä½•æ‰§è¡Œçš„ï¼Ÿ"><!---->01 åŸºç¡€æ¶æ„ï¼šä¸€æ¡SQLæŸ¥è¯¢è¯­å¥æ˜¯å¦‚ä½•æ‰§è¡Œçš„ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/database/mysql.html#_02-æ—¥å¿—ç³»ç»Ÿ-ä¸€æ¡sqlæ›´æ–°è¯­å¥æ˜¯å¦‚ä½•æ‰§è¡Œçš„" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="02 æ—¥å¿—ç³»ç»Ÿï¼šä¸€æ¡SQLæ›´æ–°è¯­å¥æ˜¯å¦‚ä½•æ‰§è¡Œçš„ï¼Ÿ"><!---->02 æ—¥å¿—ç³»ç»Ÿï¼šä¸€æ¡SQLæ›´æ–°è¯­å¥æ˜¯å¦‚ä½•æ‰§è¡Œçš„ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/database/mysql.html#_03-äº‹åŠ¡éš”ç¦»-ä¸ºä»€ä¹ˆä½ æ”¹äº†æˆ‘è¿˜çœ‹ä¸è§" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="03 äº‹åŠ¡éš”ç¦»ï¼šä¸ºä»€ä¹ˆä½ æ”¹äº†æˆ‘è¿˜çœ‹ä¸è§ï¼Ÿ"><!---->03 äº‹åŠ¡éš”ç¦»ï¼šä¸ºä»€ä¹ˆä½ æ”¹äº†æˆ‘è¿˜çœ‹ä¸è§ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/database/mysql.html#_04-æ·±å…¥æµ…å‡ºç´¢å¼•-ä¸Š" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="04 æ·±å…¥æµ…å‡ºç´¢å¼•ï¼ˆä¸Šï¼‰"><!---->04 æ·±å…¥æµ…å‡ºç´¢å¼•ï¼ˆä¸Šï¼‰<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/database/mysql.html#_05-æ·±å…¥æµ…å‡ºç´¢å¼•-ä¸‹" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="05 æ·±å…¥æµ…å‡ºç´¢å¼•ï¼ˆä¸‹ï¼‰"><!---->05 æ·±å…¥æµ…å‡ºç´¢å¼•ï¼ˆä¸‹ï¼‰<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/database/mysql.html#_06-å…¨å±€é”å’Œè¡¨é”-ç»™è¡¨åŠ ä¸ªå­—æ®µæ€ä¹ˆæœ‰è¿™ä¹ˆå¤šé˜»ç¢" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="06 å…¨å±€é”å’Œè¡¨é” ï¼šç»™è¡¨åŠ ä¸ªå­—æ®µæ€ä¹ˆæœ‰è¿™ä¹ˆå¤šé˜»ç¢ï¼Ÿ"><!---->06 å…¨å±€é”å’Œè¡¨é” ï¼šç»™è¡¨åŠ ä¸ªå­—æ®µæ€ä¹ˆæœ‰è¿™ä¹ˆå¤šé˜»ç¢ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/database/mysql.html#_07-è¡Œé”åŠŸè¿‡-æ€ä¹ˆå‡å°‘è¡Œé”å¯¹æ€§èƒ½çš„å½±å“" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="07 è¡Œé”åŠŸè¿‡ï¼šæ€ä¹ˆå‡å°‘è¡Œé”å¯¹æ€§èƒ½çš„å½±å“ï¼Ÿ"><!---->07 è¡Œé”åŠŸè¿‡ï¼šæ€ä¹ˆå‡å°‘è¡Œé”å¯¹æ€§èƒ½çš„å½±å“ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/database/mysql.html#_08-äº‹åŠ¡åˆ°åº•æ˜¯éš”ç¦»çš„è¿˜æ˜¯ä¸éš”ç¦»çš„" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="08 äº‹åŠ¡åˆ°åº•æ˜¯éš”ç¦»çš„è¿˜æ˜¯ä¸éš”ç¦»çš„ï¼Ÿ"><!---->08 äº‹åŠ¡åˆ°åº•æ˜¯éš”ç¦»çš„è¿˜æ˜¯ä¸éš”ç¦»çš„ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/database/mysql.html#_09-æ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•-åº”è¯¥æ€ä¹ˆé€‰æ‹©" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="09 æ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•ï¼Œåº”è¯¥æ€ä¹ˆé€‰æ‹©ï¼Ÿ"><!---->09 æ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•ï¼Œåº”è¯¥æ€ä¹ˆé€‰æ‹©ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/database/mysql.html#_10-mysqlä¸ºä»€ä¹ˆæœ‰æ—¶å€™ä¼šé€‰é”™ç´¢å¼•" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="10 MySQLä¸ºä»€ä¹ˆæœ‰æ—¶å€™ä¼šé€‰é”™ç´¢å¼•ï¼Ÿ"><!---->10 MySQLä¸ºä»€ä¹ˆæœ‰æ—¶å€™ä¼šé€‰é”™ç´¢å¼•ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/database/mysql.html#_11-æ€ä¹ˆç»™å­—ç¬¦ä¸²å­—æ®µåŠ ç´¢å¼•" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="11 æ€ä¹ˆç»™å­—ç¬¦ä¸²å­—æ®µåŠ ç´¢å¼•ï¼Ÿ"><!---->11 æ€ä¹ˆç»™å­—ç¬¦ä¸²å­—æ®µåŠ ç´¢å¼•ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/database/mysql.html#_16-order-by-æ˜¯æ€ä¹ˆå·¥ä½œçš„" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="16 â€œorder byâ€æ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼Ÿ"><!---->16 â€œorder byâ€æ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/database/mysql.html#_20-å¹»è¯»æ˜¯ä»€ä¹ˆ-å¹»è¯»æœ‰ä»€ä¹ˆé—®é¢˜" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="20 å¹»è¯»æ˜¯ä»€ä¹ˆï¼Œå¹»è¯»æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ"><!---->20 å¹»è¯»æ˜¯ä»€ä¹ˆï¼Œå¹»è¯»æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/database/mysql.html#_22-mysqlæœ‰å“ªäº›-é¥®é¸©æ­¢æ¸´-æé«˜æ€§èƒ½çš„æ–¹æ³•" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="22 MySQLæœ‰å“ªäº›â€œé¥®é¸©æ­¢æ¸´â€æé«˜æ€§èƒ½çš„æ–¹æ³•ï¼Ÿ"><!---->22 MySQLæœ‰å“ªäº›â€œé¥®é¸©æ­¢æ¸´â€æé«˜æ€§èƒ½çš„æ–¹æ³•ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/database/mysql.html#_23-mysqlæ˜¯æ€ä¹ˆä¿è¯æ•°æ®ä¸ä¸¢çš„" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="23 MySQLæ˜¯æ€ä¹ˆä¿è¯æ•°æ®ä¸ä¸¢çš„ï¼Ÿ"><!---->23 MySQLæ˜¯æ€ä¹ˆä¿è¯æ•°æ®ä¸ä¸¢çš„ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/database/mysql.html#_24-mysqlæ˜¯æ€ä¹ˆä¿è¯ä¸»å¤‡ä¸€è‡´çš„" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="24 MySQLæ˜¯æ€ä¹ˆä¿è¯ä¸»å¤‡ä¸€è‡´çš„ï¼Ÿ"><!---->24 MySQLæ˜¯æ€ä¹ˆä¿è¯ä¸»å¤‡ä¸€è‡´çš„ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/database/mysql.html#_25-mysqlæ˜¯æ€ä¹ˆä¿è¯é«˜å¯ç”¨çš„" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="25 MySQLæ˜¯æ€ä¹ˆä¿è¯é«˜å¯ç”¨çš„ï¼Ÿ"><!---->25 MySQLæ˜¯æ€ä¹ˆä¿è¯é«˜å¯ç”¨çš„ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/database/mysql.html#_27-ä¸»åº“å‡ºé—®é¢˜äº†-ä»åº“æ€ä¹ˆåŠ" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="27 ä¸»åº“å‡ºé—®é¢˜äº†ï¼Œä»åº“æ€ä¹ˆåŠï¼Ÿ"><!---->27 ä¸»åº“å‡ºé—®é¢˜äº†ï¼Œä»åº“æ€ä¹ˆåŠï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/database/mysql.html#_28-è¯»å†™åˆ†ç¦»æœ‰å“ªäº›å‘" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="28 è¯»å†™åˆ†ç¦»æœ‰å“ªäº›å‘ï¼Ÿ"><!---->28 è¯»å†™åˆ†ç¦»æœ‰å“ªäº›å‘ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/database/mysql.html#_29-å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªæ•°æ®åº“æ˜¯ä¸æ˜¯å‡ºé—®é¢˜äº†" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="29 å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªæ•°æ®åº“æ˜¯ä¸æ˜¯å‡ºé—®é¢˜äº†ï¼Ÿ"><!---->29 å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªæ•°æ®åº“æ˜¯ä¸æ˜¯å‡ºé—®é¢˜äº†ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/database/mysql.html#_33-æˆ‘æŸ¥è¿™ä¹ˆå¤šæ•°æ®-ä¼šä¸ä¼šæŠŠæ•°æ®åº“å†…å­˜æ‰“çˆ†" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="33 æˆ‘æŸ¥è¿™ä¹ˆå¤šæ•°æ®ï¼Œä¼šä¸ä¼šæŠŠæ•°æ®åº“å†…å­˜æ‰“çˆ†ï¼Ÿ"><!---->33 æˆ‘æŸ¥è¿™ä¹ˆå¤šæ•°æ®ï¼Œä¼šä¸ä¼šæŠŠæ•°æ®åº“å†…å­˜æ‰“çˆ†ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/database/mysql.html#_34-åˆ°åº•å¯ä¸å¯ä»¥ä½¿ç”¨join" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="34 åˆ°åº•å¯ä¸å¯ä»¥ä½¿ç”¨joinï¼Ÿ"><!---->34 åˆ°åº•å¯ä¸å¯ä»¥ä½¿ç”¨joinï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/database/mysql.html#_35-joinè¯­å¥æ€ä¹ˆä¼˜åŒ–" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="35 joinè¯­å¥æ€ä¹ˆä¼˜åŒ–ï¼Ÿ"><!---->35 joinè¯­å¥æ€ä¹ˆä¼˜åŒ–ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/database/mysql.html#_38-éƒ½è¯´innodbå¥½-é‚£è¿˜è¦ä¸è¦ä½¿ç”¨memoryå¼•æ“" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="38 éƒ½è¯´InnoDBå¥½ï¼Œé‚£è¿˜è¦ä¸è¦ä½¿ç”¨Memoryå¼•æ“ï¼Ÿ"><!---->38 éƒ½è¯´InnoDBå¥½ï¼Œé‚£è¿˜è¦ä¸è¦ä½¿ç”¨Memoryå¼•æ“ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/database/mysql.html#_39-è‡ªå¢ä¸»é”®ä¸ºä»€ä¹ˆä¸æ˜¯è¿ç»­çš„" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="39 è‡ªå¢ä¸»é”®ä¸ºä»€ä¹ˆä¸æ˜¯è¿ç»­çš„ï¼Ÿ"><!---->39 è‡ªå¢ä¸»é”®ä¸ºä»€ä¹ˆä¸æ˜¯è¿ç»­çš„ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/database/mysql.html#_40-insertè¯­å¥çš„é”ä¸ºä»€ä¹ˆè¿™ä¹ˆå¤š" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="40 insertè¯­å¥çš„é”ä¸ºä»€ä¹ˆè¿™ä¹ˆå¤šï¼Ÿ"><!---->40 insertè¯­å¥çš„é”ä¸ºä»€ä¹ˆè¿™ä¹ˆå¤šï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/database/mysql.html#_41-æ€ä¹ˆæœ€å¿«åœ°å¤åˆ¶ä¸€å¼ è¡¨" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="41 æ€ä¹ˆæœ€å¿«åœ°å¤åˆ¶ä¸€å¼ è¡¨ï¼Ÿ"><!---->41 æ€ä¹ˆæœ€å¿«åœ°å¤åˆ¶ä¸€å¼ è¡¨ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/database/mysql.html#mysqlæ•°æ®åº“è®¾è®¡è§„èŒƒ" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="MySQLæ•°æ®åº“è®¾è®¡è§„èŒƒ"><!---->MySQLæ•°æ®åº“è®¾è®¡è§„èŒƒ<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/backend/database/mysql.html#_1-è§„èŒƒèƒŒæ™¯ä¸ç›®çš„" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1. è§„èŒƒèƒŒæ™¯ä¸ç›®çš„"><!---->1. è§„èŒƒèƒŒæ™¯ä¸ç›®çš„<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/database/mysql.html#_2-è®¾è®¡è§„èŒƒ" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2. è®¾è®¡è§„èŒƒ"><!---->2. è®¾è®¡è§„èŒƒ<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/database/mysql.html#mysql-advanced" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Mysql  Advanced"><!---->Mysql  Advanced<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/backend/database/mysql.html#é€»è¾‘æ¶æ„" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="é€»è¾‘æ¶æ„"><!---->é€»è¾‘æ¶æ„<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/database/mysql.html#mysqlä¸‰å¤§æ—¥å¿—" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="MySQLä¸‰å¤§æ—¥å¿—"><!---->MySQLä¸‰å¤§æ—¥å¿—<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/database/mysql.html#mysqlä¸­çš„sqlè¯­å¥çš„æ‰§è¡Œæµç¨‹" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Mysqlä¸­çš„SQLè¯­å¥çš„æ‰§è¡Œæµç¨‹"><!---->Mysqlä¸­çš„SQLè¯­å¥çš„æ‰§è¡Œæµç¨‹<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/database/mysql.html#mysql-sqlè¯­å¥ä¹¦å†™é¡ºåºå’Œæ‰§è¡Œé¡ºåº" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="MySQL SQLè¯­å¥ä¹¦å†™é¡ºåºå’Œæ‰§è¡Œé¡ºåº"><!---->MySQL SQLè¯­å¥ä¹¦å†™é¡ºåºå’Œæ‰§è¡Œé¡ºåº<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/database/mysql.html#innodbå­˜å‚¨å¼•æ“å¯¹mvccçš„å®ç°" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="InnoDBå­˜å‚¨å¼•æ“å¯¹MVCCçš„å®ç°"><!---->InnoDBå­˜å‚¨å¼•æ“å¯¹MVCCçš„å®ç°<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/database/mysql.html#rc-å’Œ-rr-éš”ç¦»çº§åˆ«ä¸‹-mvcc-çš„å·®å¼‚" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="RC å’Œ RR éš”ç¦»çº§åˆ«ä¸‹ MVCC çš„å·®å¼‚"><!---->RC å’Œ RR éš”ç¦»çº§åˆ«ä¸‹ MVCC çš„å·®å¼‚<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/database/mysql.html#mvccâ•next-key-lock-é˜²æ­¢å¹»è¯»" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="MVCCâ•Next-key-Lock é˜²æ­¢å¹»è¯»"><!---->MVCCâ•Next-key-Lock é˜²æ­¢å¹»è¯»<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/database/mysql.html#mysql-é”" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="MySQL é”"><!---->MySQL é”<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/database/mysql.html#å­˜å‚¨å¼•æ“" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å­˜å‚¨å¼•æ“"><!---->å­˜å‚¨å¼•æ“<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/database/mysql.html#ç´¢å¼•" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ç´¢å¼•"><!---->ç´¢å¼•<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/database/mysql.html#å­˜å‚¨ç»“æ„" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å­˜å‚¨ç»“æ„"><!---->å­˜å‚¨ç»“æ„<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/database/mysql.html#ç´¢å¼•çš„åˆ›å»ºä¸è®¾è®¡åŸåˆ™" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ç´¢å¼•çš„åˆ›å»ºä¸è®¾è®¡åŸåˆ™"><!---->ç´¢å¼•çš„åˆ›å»ºä¸è®¾è®¡åŸåˆ™<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/database/mysql.html#mysql-ç´¢å¼•å¤±æ•ˆåœºæ™¯" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="MySQL ç´¢å¼•å¤±æ•ˆåœºæ™¯"><!---->MySQL ç´¢å¼•å¤±æ•ˆåœºæ™¯<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/database/mysql.html#æ€§èƒ½åˆ†æ" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="æ€§èƒ½åˆ†æ"><!---->æ€§èƒ½åˆ†æ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/database/mysql.html#mysqlå®šæ—¶å¢é‡-å…¨é‡å¤‡ä»½" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="MySQLå®šæ—¶å¢é‡/å…¨é‡å¤‡ä»½"><!---->MySQLå®šæ—¶å¢é‡/å…¨é‡å¤‡ä»½<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/database/mysql.html#mysqlä¸»ä»å¤åˆ¶è¯»å†™åˆ†ç¦»" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Mysqlä¸»ä»å¤åˆ¶è¯»å†™åˆ†ç¦»"><!---->Mysqlä¸»ä»å¤åˆ¶è¯»å†™åˆ†ç¦»<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li></ul><!--]--></li></ul></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">Dev Framework</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">Java</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">Middleware</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">Skills</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">Tools</span><span class="arrow end"></span></button><!----></section></li></ul></section></li><li><section class="sidebar-group"><p class="sidebar-heading"><span class="font-icon icon iconfont icon-note" style=""></span><span class="title">Article &amp; Papper</span><!----></p><ul class="sidebar-links"><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">Article</span><span class="arrow end"></span></button><!----></section></li></ul></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->Mysql</h1><div class="page-info"><span class="page-author-info" aria-label="AuthorğŸ–Š" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://github.com/EddieZturbo" target="_blank" rel="noopener noreferrer">EddieZ</a></span><span property="author" content="EddieZ"></span></span><!----><!----><!----><span class="page-reading-time-info" aria-label="Reading TimeâŒ›" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>About 588 min</span><meta property="timeRequired" content="PT588M"></span><!----><!----></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">On This Page<button class="print-button" title="print"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/backend/database/mysql.html#mysql-basic" class="router-link-active router-link-exact-active toc-link level2">Mysql Basic</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/backend/database/mysql.html#mysqlâ˜…" class="router-link-active router-link-exact-active toc-link level3">MySQLâ˜…</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/database/mysql.html#mysqlç³»ç»Ÿå˜é‡æŸ¥è¯¢" class="router-link-active router-link-exact-active toc-link level2">Mysqlç³»ç»Ÿå˜é‡æŸ¥è¯¢</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/backend/database/mysql.html#æŸ¥è¯¢è®¾ç½®å…¨å±€å˜é‡-show-global-variables-g" class="router-link-active router-link-exact-active toc-link level3">æŸ¥è¯¢è®¾ç½®å…¨å±€å˜é‡ï¼šshow global variables \G;</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/database/mysql.html#æŸ¥è¯¢è®¾ç½®ä¼šè¯å˜é‡-show-session-variables-g-æˆ–show-variables" class="router-link-active router-link-exact-active toc-link level3">æŸ¥è¯¢è®¾ç½®ä¼šè¯å˜é‡ï¼šshow session variables \G;æˆ–show variablesï¼›</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/database/mysql.html#most-popular-mysql-commands" class="router-link-active router-link-exact-active toc-link level2">Most Popular MySQL Commands</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/backend/database/mysql.html#crud" class="router-link-active router-link-exact-active toc-link level3">CRUD</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/database/mysql.html#reset-autoincrement-primary-id" class="router-link-active router-link-exact-active toc-link level3">Reset AutoIncrement_Primary_Id</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/database/mysql.html#users-management-commands" class="router-link-active router-link-exact-active toc-link level3">Users Management Commands</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/database/mysql.html#database-management-commands" class="router-link-active router-link-exact-active toc-link level3">Database Management Commands</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/database/mysql.html#table-commands" class="router-link-active router-link-exact-active toc-link level3">Table Commands</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/database/mysql.html#keys-in-mysql" class="router-link-active router-link-exact-active toc-link level3">Keys in MySQL</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/database/mysql.html#constraints-in-mysql" class="router-link-active router-link-exact-active toc-link level3">Constraints in MySQL</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/database/mysql.html#views" class="router-link-active router-link-exact-active toc-link level3">Views</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/database/mysql.html#manipulation-commandsâ˜…" class="router-link-active router-link-exact-active toc-link level3">Manipulation Commandsâ˜…</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/database/mysql.html#joins" class="router-link-active router-link-exact-active toc-link level3">Joins</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/database/mysql.html#index" class="router-link-active router-link-exact-active toc-link level3">Index</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/database/mysql.html#privilege-commands" class="router-link-active router-link-exact-active toc-link level3">Privilege Commands</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/database/mysql.html#triggers" class="router-link-active router-link-exact-active toc-link level3">Triggers</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/database/mysql.html#transaction-commands" class="router-link-active router-link-exact-active toc-link level3">Transaction Commands</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/database/mysql.html#mysqlå®æˆ˜45è®²ç²¾é€‰" class="router-link-active router-link-exact-active toc-link level2">MySQLå®æˆ˜45è®²ç²¾é€‰</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/backend/database/mysql.html#_00å¼€ç¯‡è¯-è¿™ä¸€æ¬¡-è®©æˆ‘ä»¬ä¸€èµ·æ¥ææ‡‚mysql" class="router-link-active router-link-exact-active toc-link level3">00å¼€ç¯‡è¯ è¿™ä¸€æ¬¡ï¼Œè®©æˆ‘ä»¬ä¸€èµ·æ¥ææ‡‚MySQL</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/database/mysql.html#_01-åŸºç¡€æ¶æ„-ä¸€æ¡sqlæŸ¥è¯¢è¯­å¥æ˜¯å¦‚ä½•æ‰§è¡Œçš„" class="router-link-active router-link-exact-active toc-link level3">01 åŸºç¡€æ¶æ„ï¼šä¸€æ¡SQLæŸ¥è¯¢è¯­å¥æ˜¯å¦‚ä½•æ‰§è¡Œçš„ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/database/mysql.html#_02-æ—¥å¿—ç³»ç»Ÿ-ä¸€æ¡sqlæ›´æ–°è¯­å¥æ˜¯å¦‚ä½•æ‰§è¡Œçš„" class="router-link-active router-link-exact-active toc-link level3">02 æ—¥å¿—ç³»ç»Ÿï¼šä¸€æ¡SQLæ›´æ–°è¯­å¥æ˜¯å¦‚ä½•æ‰§è¡Œçš„ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/database/mysql.html#_03-äº‹åŠ¡éš”ç¦»-ä¸ºä»€ä¹ˆä½ æ”¹äº†æˆ‘è¿˜çœ‹ä¸è§" class="router-link-active router-link-exact-active toc-link level3">03 äº‹åŠ¡éš”ç¦»ï¼šä¸ºä»€ä¹ˆä½ æ”¹äº†æˆ‘è¿˜çœ‹ä¸è§ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/database/mysql.html#_04-æ·±å…¥æµ…å‡ºç´¢å¼•-ä¸Š" class="router-link-active router-link-exact-active toc-link level3">04 æ·±å…¥æµ…å‡ºç´¢å¼•ï¼ˆä¸Šï¼‰</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/database/mysql.html#_05-æ·±å…¥æµ…å‡ºç´¢å¼•-ä¸‹" class="router-link-active router-link-exact-active toc-link level3">05 æ·±å…¥æµ…å‡ºç´¢å¼•ï¼ˆä¸‹ï¼‰</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/database/mysql.html#_06-å…¨å±€é”å’Œè¡¨é”-ç»™è¡¨åŠ ä¸ªå­—æ®µæ€ä¹ˆæœ‰è¿™ä¹ˆå¤šé˜»ç¢" class="router-link-active router-link-exact-active toc-link level3">06 å…¨å±€é”å’Œè¡¨é” ï¼šç»™è¡¨åŠ ä¸ªå­—æ®µæ€ä¹ˆæœ‰è¿™ä¹ˆå¤šé˜»ç¢ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/database/mysql.html#_07-è¡Œé”åŠŸè¿‡-æ€ä¹ˆå‡å°‘è¡Œé”å¯¹æ€§èƒ½çš„å½±å“" class="router-link-active router-link-exact-active toc-link level3">07 è¡Œé”åŠŸè¿‡ï¼šæ€ä¹ˆå‡å°‘è¡Œé”å¯¹æ€§èƒ½çš„å½±å“ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/database/mysql.html#_08-äº‹åŠ¡åˆ°åº•æ˜¯éš”ç¦»çš„è¿˜æ˜¯ä¸éš”ç¦»çš„" class="router-link-active router-link-exact-active toc-link level3">08 äº‹åŠ¡åˆ°åº•æ˜¯éš”ç¦»çš„è¿˜æ˜¯ä¸éš”ç¦»çš„ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/database/mysql.html#_09-æ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•-åº”è¯¥æ€ä¹ˆé€‰æ‹©" class="router-link-active router-link-exact-active toc-link level3">09 æ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•ï¼Œåº”è¯¥æ€ä¹ˆé€‰æ‹©ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/database/mysql.html#_10-mysqlä¸ºä»€ä¹ˆæœ‰æ—¶å€™ä¼šé€‰é”™ç´¢å¼•" class="router-link-active router-link-exact-active toc-link level3">10 MySQLä¸ºä»€ä¹ˆæœ‰æ—¶å€™ä¼šé€‰é”™ç´¢å¼•ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/database/mysql.html#_11-æ€ä¹ˆç»™å­—ç¬¦ä¸²å­—æ®µåŠ ç´¢å¼•" class="router-link-active router-link-exact-active toc-link level3">11 æ€ä¹ˆç»™å­—ç¬¦ä¸²å­—æ®µåŠ ç´¢å¼•ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/database/mysql.html#_16-order-by-æ˜¯æ€ä¹ˆå·¥ä½œçš„" class="router-link-active router-link-exact-active toc-link level3">16 â€œorder byâ€æ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/database/mysql.html#_20-å¹»è¯»æ˜¯ä»€ä¹ˆ-å¹»è¯»æœ‰ä»€ä¹ˆé—®é¢˜" class="router-link-active router-link-exact-active toc-link level3">20 å¹»è¯»æ˜¯ä»€ä¹ˆï¼Œå¹»è¯»æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/database/mysql.html#_22-mysqlæœ‰å“ªäº›-é¥®é¸©æ­¢æ¸´-æé«˜æ€§èƒ½çš„æ–¹æ³•" class="router-link-active router-link-exact-active toc-link level3">22 MySQLæœ‰å“ªäº›â€œé¥®é¸©æ­¢æ¸´â€æé«˜æ€§èƒ½çš„æ–¹æ³•ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/database/mysql.html#_23-mysqlæ˜¯æ€ä¹ˆä¿è¯æ•°æ®ä¸ä¸¢çš„" class="router-link-active router-link-exact-active toc-link level3">23 MySQLæ˜¯æ€ä¹ˆä¿è¯æ•°æ®ä¸ä¸¢çš„ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/database/mysql.html#_24-mysqlæ˜¯æ€ä¹ˆä¿è¯ä¸»å¤‡ä¸€è‡´çš„" class="router-link-active router-link-exact-active toc-link level3">24 MySQLæ˜¯æ€ä¹ˆä¿è¯ä¸»å¤‡ä¸€è‡´çš„ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/database/mysql.html#_25-mysqlæ˜¯æ€ä¹ˆä¿è¯é«˜å¯ç”¨çš„" class="router-link-active router-link-exact-active toc-link level3">25 MySQLæ˜¯æ€ä¹ˆä¿è¯é«˜å¯ç”¨çš„ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/database/mysql.html#_27-ä¸»åº“å‡ºé—®é¢˜äº†-ä»åº“æ€ä¹ˆåŠ" class="router-link-active router-link-exact-active toc-link level3">27 ä¸»åº“å‡ºé—®é¢˜äº†ï¼Œä»åº“æ€ä¹ˆåŠï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/database/mysql.html#_28-è¯»å†™åˆ†ç¦»æœ‰å“ªäº›å‘" class="router-link-active router-link-exact-active toc-link level3">28 è¯»å†™åˆ†ç¦»æœ‰å“ªäº›å‘ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/database/mysql.html#_29-å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªæ•°æ®åº“æ˜¯ä¸æ˜¯å‡ºé—®é¢˜äº†" class="router-link-active router-link-exact-active toc-link level3">29 å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªæ•°æ®åº“æ˜¯ä¸æ˜¯å‡ºé—®é¢˜äº†ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/database/mysql.html#_33-æˆ‘æŸ¥è¿™ä¹ˆå¤šæ•°æ®-ä¼šä¸ä¼šæŠŠæ•°æ®åº“å†…å­˜æ‰“çˆ†" class="router-link-active router-link-exact-active toc-link level3">33 æˆ‘æŸ¥è¿™ä¹ˆå¤šæ•°æ®ï¼Œä¼šä¸ä¼šæŠŠæ•°æ®åº“å†…å­˜æ‰“çˆ†ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/database/mysql.html#_34-åˆ°åº•å¯ä¸å¯ä»¥ä½¿ç”¨join" class="router-link-active router-link-exact-active toc-link level3">34 åˆ°åº•å¯ä¸å¯ä»¥ä½¿ç”¨joinï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/database/mysql.html#_35-joinè¯­å¥æ€ä¹ˆä¼˜åŒ–" class="router-link-active router-link-exact-active toc-link level3">35 joinè¯­å¥æ€ä¹ˆä¼˜åŒ–ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/database/mysql.html#_38-éƒ½è¯´innodbå¥½-é‚£è¿˜è¦ä¸è¦ä½¿ç”¨memoryå¼•æ“" class="router-link-active router-link-exact-active toc-link level3">38 éƒ½è¯´InnoDBå¥½ï¼Œé‚£è¿˜è¦ä¸è¦ä½¿ç”¨Memoryå¼•æ“ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/database/mysql.html#_39-è‡ªå¢ä¸»é”®ä¸ºä»€ä¹ˆä¸æ˜¯è¿ç»­çš„" class="router-link-active router-link-exact-active toc-link level3">39 è‡ªå¢ä¸»é”®ä¸ºä»€ä¹ˆä¸æ˜¯è¿ç»­çš„ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/database/mysql.html#_40-insertè¯­å¥çš„é”ä¸ºä»€ä¹ˆè¿™ä¹ˆå¤š" class="router-link-active router-link-exact-active toc-link level3">40 insertè¯­å¥çš„é”ä¸ºä»€ä¹ˆè¿™ä¹ˆå¤šï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/database/mysql.html#_41-æ€ä¹ˆæœ€å¿«åœ°å¤åˆ¶ä¸€å¼ è¡¨" class="router-link-active router-link-exact-active toc-link level3">41 æ€ä¹ˆæœ€å¿«åœ°å¤åˆ¶ä¸€å¼ è¡¨ï¼Ÿ</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/database/mysql.html#mysqlæ•°æ®åº“è®¾è®¡è§„èŒƒ" class="router-link-active router-link-exact-active toc-link level2">MySQLæ•°æ®åº“è®¾è®¡è§„èŒƒ</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/backend/database/mysql.html#_1-è§„èŒƒèƒŒæ™¯ä¸ç›®çš„" class="router-link-active router-link-exact-active toc-link level3">1. è§„èŒƒèƒŒæ™¯ä¸ç›®çš„</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/database/mysql.html#_2-è®¾è®¡è§„èŒƒ" class="router-link-active router-link-exact-active toc-link level3">2. è®¾è®¡è§„èŒƒ</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/database/mysql.html#mysql-advanced" class="router-link-active router-link-exact-active toc-link level2">Mysql  Advanced</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/backend/database/mysql.html#é€»è¾‘æ¶æ„" class="router-link-active router-link-exact-active toc-link level3">é€»è¾‘æ¶æ„</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/database/mysql.html#mysqlä¸‰å¤§æ—¥å¿—" class="router-link-active router-link-exact-active toc-link level3">MySQLä¸‰å¤§æ—¥å¿—</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/database/mysql.html#mysqlä¸­çš„sqlè¯­å¥çš„æ‰§è¡Œæµç¨‹" class="router-link-active router-link-exact-active toc-link level3">Mysqlä¸­çš„SQLè¯­å¥çš„æ‰§è¡Œæµç¨‹</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/database/mysql.html#mysql-sqlè¯­å¥ä¹¦å†™é¡ºåºå’Œæ‰§è¡Œé¡ºåº" class="router-link-active router-link-exact-active toc-link level3">MySQL SQLè¯­å¥ä¹¦å†™é¡ºåºå’Œæ‰§è¡Œé¡ºåº</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/database/mysql.html#innodbå­˜å‚¨å¼•æ“å¯¹mvccçš„å®ç°" class="router-link-active router-link-exact-active toc-link level3">InnoDBå­˜å‚¨å¼•æ“å¯¹MVCCçš„å®ç°</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/database/mysql.html#rc-å’Œ-rr-éš”ç¦»çº§åˆ«ä¸‹-mvcc-çš„å·®å¼‚" class="router-link-active router-link-exact-active toc-link level3">RC å’Œ RR éš”ç¦»çº§åˆ«ä¸‹ MVCC çš„å·®å¼‚</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/database/mysql.html#mvccâ•next-key-lock-é˜²æ­¢å¹»è¯»" class="router-link-active router-link-exact-active toc-link level3">MVCCâ•Next-key-Lock é˜²æ­¢å¹»è¯»</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/database/mysql.html#mysql-é”" class="router-link-active router-link-exact-active toc-link level3">MySQL é”</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/database/mysql.html#å­˜å‚¨å¼•æ“" class="router-link-active router-link-exact-active toc-link level3">å­˜å‚¨å¼•æ“</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/database/mysql.html#ç´¢å¼•" class="router-link-active router-link-exact-active toc-link level3">ç´¢å¼•</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/database/mysql.html#å­˜å‚¨ç»“æ„" class="router-link-active router-link-exact-active toc-link level3">å­˜å‚¨ç»“æ„</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/database/mysql.html#ç´¢å¼•çš„åˆ›å»ºä¸è®¾è®¡åŸåˆ™" class="router-link-active router-link-exact-active toc-link level3">ç´¢å¼•çš„åˆ›å»ºä¸è®¾è®¡åŸåˆ™</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/database/mysql.html#mysql-ç´¢å¼•å¤±æ•ˆåœºæ™¯" class="router-link-active router-link-exact-active toc-link level3">MySQL ç´¢å¼•å¤±æ•ˆåœºæ™¯</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/database/mysql.html#æ€§èƒ½åˆ†æ" class="router-link-active router-link-exact-active toc-link level3">æ€§èƒ½åˆ†æ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/database/mysql.html#mysqlå®šæ—¶å¢é‡-å…¨é‡å¤‡ä»½" class="router-link-active router-link-exact-active toc-link level3">MySQLå®šæ—¶å¢é‡/å…¨é‡å¤‡ä»½</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/database/mysql.html#mysqlä¸»ä»å¤åˆ¶è¯»å†™åˆ†ç¦»" class="router-link-active router-link-exact-active toc-link level3">Mysqlä¸»ä»å¤åˆ¶è¯»å†™åˆ†ç¦»</a></li><!----><!--]--></ul><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><h1 id="mysql" tabindex="-1"><a class="header-anchor" href="#mysql" aria-hidden="true">#</a> Mysql</h1><h2 id="mysql-basic" tabindex="-1"><a class="header-anchor" href="#mysql-basic" aria-hidden="true">#</a> Mysql Basic</h2><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20220926085405282.png" alt="image-20220926085405282"></p><h3 id="mysqlâ˜…" tabindex="-1"><a class="header-anchor" href="#mysqlâ˜…" aria-hidden="true">#</a> MySQLâ˜…</h3><p><strong>è¿æ¥åˆ°MySQLæ•°æ®åº“çš„æ“ä½œ</strong></p><p>1.æœåŠ¡å¯åŠ¨--net start mysql(æœåŠ¡å) æœåŠ¡å…³é—­--net stop mysql(æœåŠ¡å)</p><p>2.ç™»å½•ï¼ˆè¿æ¥ï¼‰--mysql -h ä¸»æœºå -P ç«¯å£ -u ç”¨æˆ·å -på¯†ç  é€€å‡ºï¼ˆæ–­è¿ï¼‰--exit</p><p>-påä¸èƒ½å‡ºç°ç©ºæ ¼</p><p>-påæ²¡å†™å¯†ç çš„ï¼Œå›è½¦ä¼šè¦æ±‚è¾“å…¥å¯†ç </p><p>å¦‚æœæ²¡æœ‰å†™-h ä¸»æœºï¼Œé»˜è®¤å°±æ˜¯æœ¬æœº</p><p>å¦‚æœæ²¡å†™-P ç«¯å£ï¼Œé»˜è®¤å°±æ˜¯3306</p><p>åœ¨å®é™…å·¥ä½œä¸­ ç«¯å£ä¸€èˆ¬ä¼šä¿®æ”¹</p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20220825205341677.png" alt="image-20220825205341677"></p><p><strong>SQL åˆ†ç±» SQLè¯­è¨€åœ¨åŠŸèƒ½ä¸Šä¸»è¦åˆ†ä¸ºå¦‚ä¸‹3å¤§ç±»ï¼š</strong></p><p><strong>DDLï¼ˆData Definition Languagesã€æ•°æ®å®šä¹‰è¯­è¨€ï¼‰</strong>ï¼Œè¿™äº›è¯­å¥å®šä¹‰äº†ä¸åŒçš„æ•°æ®åº“ã€è¡¨ã€è§†å›¾ã€ç´¢ å¼•ç­‰æ•°æ®åº“å¯¹è±¡ï¼Œè¿˜å¯ä»¥ç”¨æ¥åˆ›å»ºã€åˆ é™¤ã€ä¿®æ”¹æ•°æ®åº“å’Œæ•°æ®è¡¨çš„ç»“æ„ã€‚</p><p>ä¸»è¦çš„è¯­å¥å…³é”®å­—åŒ…æ‹¬ <strong>CREATE</strong> ã€ <strong>DROP</strong> ã€ <strong>ALTER</strong> ç­‰ã€‚</p><p><strong>DMLï¼ˆData Manipulation Languageã€æ•°æ®æ“ä½œè¯­è¨€ï¼‰</strong>ï¼Œç”¨äºæ·»åŠ ã€åˆ é™¤ã€æ›´æ–°å’ŒæŸ¥è¯¢æ•°æ®åº“è®° å½•ï¼Œå¹¶æ£€æŸ¥æ•°æ®å®Œæ•´æ€§ã€‚</p><p>ä¸»è¦çš„è¯­å¥å…³é”®å­—åŒ…æ‹¬ <strong>INSERT</strong> ã€ <strong>DELETE</strong> ã€ <strong>UPDATE</strong> ã€ <strong>SELECT</strong> ç­‰ã€‚ <strong>SELECT</strong>æ˜¯SQLè¯­è¨€çš„åŸºç¡€ï¼Œæœ€ä¸ºé‡è¦ã€‚</p><p><strong>DCLï¼ˆData Control Languageã€æ•°æ®æ§åˆ¶è¯­è¨€ï¼‰</strong>ï¼Œç”¨äºå®šä¹‰æ•°æ®åº“ã€è¡¨ã€å­—æ®µã€ç”¨æˆ·çš„è®¿é—®æƒé™å’Œ å®‰å…¨çº§åˆ«ã€‚</p><p>ä¸»è¦çš„è¯­å¥å…³é”®å­—åŒ…æ‹¬ <strong>GRANT</strong> ã€ <strong>REVOKE</strong> ã€ <strong>COMMIT</strong> ã€ <strong>ROLLBACK</strong> ã€ <strong>SAVEPOINT</strong> ç­‰</p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20220901093814041.png" alt="image-20220901093814041"></p><p><strong>SQLè¯­è¨€çš„è§„åˆ™ä¸è§„èŒƒ</strong></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20220901093857419.png" alt="image-20220901093857419"></p><p><strong>æ•°æ®å¯¼å…¥æŒ‡ä»¤</strong></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20220901093930942.png" alt="image-20220901093930942"></p><h4 id="æ•°æ®åº“" tabindex="-1"><a class="header-anchor" href="#æ•°æ®åº“" aria-hidden="true">#</a> æ•°æ®åº“</h4><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">#æ•°æ®åº“æ“ä½œ</span>
<span class="token comment">#create database db03 [IF NOT EXISTS] character set utf8 collate utf8_bin;</span>
<span class="token comment">-- åˆ›å»ºä¸€ä¸ªæ•°æ®ç©ºå¹¶ä½¿ç”¨ CHARACTER SER æŒ‡å®šå­—ç¬¦é›† åŒæ—¶ä½¿ç”¨ COLLATE æŒ‡å®šæ ¡éªŒ </span>
<span class="token comment">-- å…¶ä¸­[IF NOT EXISTS](å¼€å‘ä¸­æ¨èä½¿ç”¨)è¡¨ç¤ºå¦‚æœåº“å·²ç»å­˜åœ¨å°±ä¸åˆ›å»º ä¸å­˜åœ¨å°±åˆ›å»º</span>
<span class="token comment">#åˆ›å»ºä¸€ä¸ªåä¸ºEddie_db02çš„æ•°æ®åº“</span>
<span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> Eddie_db02<span class="token punctuation">;</span>
<span class="token comment">#åˆ é™¤æ•°æ®åº“</span>
<span class="token keyword">DROP</span> <span class="token keyword">DATABASE</span> Eddie_db02<span class="token punctuation">;</span>
<span class="token comment">#åˆ›å»ºä¸€ä¸ªä½¿ç”¨utf8å­—ç¬¦é›†çš„Eddie_db03æ•°æ®åº“</span>
<span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> Eddie_db03 <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8<span class="token punctuation">;</span>
<span class="token comment">#åˆ é™¤æ•°æ®åº“</span>
<span class="token keyword">DROP</span> <span class="token keyword">DATABASE</span> Eddie_db03<span class="token punctuation">;</span>
<span class="token comment">#åˆ›å»ºä¸€ä¸ªä½¿ç”¨utf_8å­—ç¬¦é›†ï¼Œå¹¶å¸¦æ ¡å¯¹è§„åˆ™çš„Eddie_db04æ•°æ®åº“</span>
<span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> Eddie_db04 <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8 <span class="token keyword">COLLATE</span> utf8_bin<span class="token punctuation">;</span>
<span class="token comment">#åˆ é™¤æ•°æ®åº“</span>
<span class="token keyword">DROP</span> <span class="token keyword">DATABASE</span> Eddie_db04
<span class="token comment">#ä»¥ä¸‹æ˜¯è¡¨ç¤ºæŸ¥è¯¢sqlè¯­å¥ï¼›SELECTæŸ¥è¯¢ *ä»£è¡¨æ‰€æœ‰å­—æ®µ FROMä»å“ªä¸ªè¡¨ä¸­æŸ¥è¯¢ WHRERè¡¨ç¤ºä»å“ªä¸ªå­—æ®µæŸ¥ NAME = &#39;Ivring&#39; è¡¨ç¤ºæŸ¥è¯¢åå­—ä¸ºIvringçš„</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> user1 <span class="token keyword">WHERE</span> NAME <span class="token operator">=</span> <span class="token string">&#39;Ivring&#39;</span><span class="token punctuation">;</span>

<span class="token comment">#æŸ¥çœ‹å½“å‰æ­£åœ¨ä½¿ç”¨çš„åº“ï¼ˆå½“å‰åœ¨å“ªä¸ªåº“ä¸‹ï¼‰</span>
<span class="token keyword">SELECT</span> <span class="token keyword">DATABASE</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">#æŸ¥çœ‹æœ‰å“ªäº›æ•°æ®åº“</span>
<span class="token keyword">SHOW</span> <span class="token keyword">DATABASES</span>
<span class="token comment">#æ˜¾ç¤ºæ•°æ®åº“çš„åˆ›å»ºè¯­å¥</span>
<span class="token keyword">SHOW</span> <span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> eddie_db03<span class="token punctuation">;</span>
<span class="token comment">#åˆ é™¤æ•°æ®åº“</span>
<span class="token keyword">DROP</span> <span class="token keyword">DATABASE</span> eddie_db02<span class="token punctuation">;</span>
<span class="token comment">#åœ¨åˆ›å»ºæ•°æ®åº“æˆ–è€…è¡¨çš„æ—¶å€™ï¼›ä¸ºäº†è§„é¿å…³é”®å­—å¯ä»¥ä½¿ç”¨åå¼•`CREATE`</span>
<span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> Eddie_db05 <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8 <span class="token keyword">COLLATE</span> utf8_bin
<span class="token keyword">DROP</span> <span class="token keyword">DATABASE</span> eddie_db05
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> user1
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> user1 <span class="token keyword">WHERE</span> NAME <span class="token operator">=</span> <span class="token string">&#39;Ivring&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> eddie_db05 <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8 <span class="token keyword">COLLATE</span> utf8_bin
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="åˆ›å»º" tabindex="-1"><a class="header-anchor" href="#åˆ›å»º" aria-hidden="true">#</a> åˆ›å»º</h5><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">database</span> db03 <span class="token punctuation">[</span><span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span><span class="token punctuation">]</span> <span class="token keyword">character</span> <span class="token keyword">set</span> utf8 <span class="token keyword">collate</span> utf8_bin<span class="token punctuation">;</span>
<span class="token comment">-- åˆ›å»ºä¸€ä¸ªæ•°æ®ç©ºå¹¶ä½¿ç”¨ CHARACTER SET æŒ‡å®šå­—ç¬¦é›† åŒæ—¶ä½¿ç”¨ COLLATE æŒ‡å®šæ ¡éªŒ </span>
<span class="token comment">-- ï¼ˆå¦‚æœä¸æŒ‡å®šé»˜è®¤å­—ç¬¦é›†ä¸ºutf-8 é»˜è®¤æ ¡å¯¹è§„åˆ™ä¸º utf-8)_general_ciä¸ºä¸åŒºåˆ†å¤§å°å†™ï¼‰</span>
<span class="token comment">-- å…¶ä¸­[IF NOT EXISTS](å¼€å‘ä¸­æ¨èä½¿ç”¨)è¡¨ç¤ºå¦‚æœåº“å·²ç»å­˜åœ¨å°±ä¸åˆ›å»º ä¸å­˜åœ¨å°±åˆ›å»º</span>
<span class="token comment">#åœ¨åˆ›å»ºæ•°æ®åº“æˆ–è€…è¡¨çš„æ—¶å€™ï¼›ä¸ºäº†è§„é¿å…³é”®å­—å¯ä»¥ä½¿ç”¨åå¼•`CREATE`</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="æŸ¥çœ‹-åˆ é™¤æ•°æ®åº“" tabindex="-1"><a class="header-anchor" href="#æŸ¥çœ‹-åˆ é™¤æ•°æ®åº“" aria-hidden="true">#</a> æŸ¥çœ‹ï¼Œåˆ é™¤æ•°æ®åº“</h5><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">#æŸ¥çœ‹æœ‰å“ªäº›æ•°æ®åº“</span>
<span class="token keyword">SHOW</span> <span class="token keyword">DATABASES</span>
<span class="token comment">#æ˜¾ç¤ºæ•°æ®åº“çš„åˆ›å»ºè¯­å¥</span>
<span class="token keyword">SHOW</span> <span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> eddie_db03<span class="token punctuation">;</span>

<span class="token comment">#åˆ é™¤æ•°æ®åº“</span>
<span class="token keyword">DROP</span> <span class="token keyword">DATABASE</span> eddie_db02<span class="token punctuation">;</span>
<span class="token comment">-- For instance:</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">drop</span> <span class="token keyword">database</span> db02<span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">4</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.03</span> sec<span class="token punctuation">)</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="å¤‡ä»½-æ¢å¤æ•°æ®åº“" tabindex="-1"><a class="header-anchor" href="#å¤‡ä»½-æ¢å¤æ•°æ®åº“" aria-hidden="true">#</a> å¤‡ä»½ï¼Œæ¢å¤æ•°æ®åº“</h5><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">#å¤‡ä»½æ•°æ®åº“:ï¼ˆæ³¨æ„è¦åœ¨DOSæ‰§è¡Œï¼‰å‘½ä»¤è¡Œ-*-è¿™é‡Œå¤‡ä»½æ•°æ®åº“å³æŠŠåˆ›å»ºæ•°æ®åº“çš„æ‰€æœ‰æ“ä½œå‘½ä»¤è¿›è¡Œå¤‡ä»½--&gt;æ¢å¤æ•°æ®åº“æ—¶å³ç›´æ¥å°†æ‰€æœ‰æ“ä½œå‘½ä»¤è¿è¡Œä¸€æ¬¡å³å¯</span>
mysqldump <span class="token operator">-</span>u root <span class="token operator">-</span>p <span class="token operator">-</span>B db02<span class="token punctuation">(</span>æ•°æ®åº“çš„å<span class="token punctuation">)</span> <span class="token operator">&gt;</span>e:\\bal<span class="token punctuation">.</span><span class="token keyword">sql</span><span class="token punctuation">(</span>æŒ‡å®šè¦å¤‡ä»½åˆ°çš„ç£ç›˜è·¯å¾„ ä»¥åŠæ–‡ä»¶å<span class="token punctuation">.</span><span class="token keyword">sql</span><span class="token punctuation">)</span>
<span class="token comment">-- C:\WINDOWS\system32&gt;mysqldump -u root -p -B db02 &gt;e:\\bak2.sql</span>
<span class="token comment">-- Enter password: ****</span>
<span class="token comment">#æ¢å¤æ•°æ®åº“:ï¼ˆæ³¨æ„è¦åœ¨Mysqlå‘½ä»¤æ‰§è¡Œï¼‰-*-è¿™é‡Œå¤‡ä»½æ•°æ®åº“å³æŠŠåˆ›å»ºæ•°æ®åº“çš„æ‰€æœ‰æ“ä½œå‘½ä»¤è¿›è¡Œå¤‡ä»½--&gt;æ¢å¤æ•°æ®åº“æ—¶å³ç›´æ¥å°†æ‰€æœ‰æ“ä½œå‘½ä»¤è¿è¡Œä¸€æ¬¡å³å¯</span>
mysql<span class="token operator">&gt;</span> source e:\\bak2<span class="token punctuation">.</span><span class="token keyword">sql</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="è¡¨" tabindex="-1"><a class="header-anchor" href="#è¡¨" aria-hidden="true">#</a> è¡¨</h4><h5 id="å¤‡ä»½-æ¢å¤è¡¨" tabindex="-1"><a class="header-anchor" href="#å¤‡ä»½-æ¢å¤è¡¨" aria-hidden="true">#</a> å¤‡ä»½ï¼Œæ¢å¤è¡¨</h5><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">-- å¤‡ä»½è¡¨:ï¼ˆæ³¨æ„è¦åœ¨DOSæ‰§è¡Œï¼‰å‘½ä»¤è¡Œ-*-è¿™é‡Œå¤‡ä»½æ•°æ®åº“çš„è¡¨å³æŠŠåˆ›å»ºæ•°æ®åº“çš„è¡¨çš„æ‰€æœ‰æ“ä½œå‘½ä»¤è¿›è¡Œå¤‡ä»½--&gt;æ¢å¤æ•°æ®åº“æ—¶å³ç›´æ¥å°†æ‰€æœ‰æ“ä½œå‘½ä»¤è¿è¡Œä¸€æ¬¡å³å¯</span>
mysqldump <span class="token operator">-</span>u root <span class="token operator">-</span>p db02<span class="token punctuation">(</span>æ•°æ®åº“çš„å<span class="token punctuation">)</span> <span class="token punctuation">(</span>è¡¨å<span class="token punctuation">)</span><span class="token operator">&gt;</span>e:<span class="token comment">//backaccount.sql(æŒ‡å®šè¦å¤‡ä»½åˆ°çš„ç£ç›˜è·¯å¾„ ä»¥åŠæ–‡ä»¶å.sql)</span>
<span class="token comment">-- C:\WINDOWS\system32&gt;mysqldump -u root -p db01 account &gt;e://backaccount.sql</span>
<span class="token comment">-- Enter password: ****</span>
<span class="token comment">#æ¢å¤è¡¨:ï¼ˆæ³¨æ„è¦åœ¨Mysqlå‘½ä»¤æ‰§è¡Œï¼‰-*-è¿™é‡Œå¤‡ä»½æ•°æ®åº“çš„è¡¨å³æŠŠåˆ›å»ºæ•°æ®åº“çš„è¡¨çš„æ‰€æœ‰æ“ä½œå‘½ä»¤è¿›è¡Œå¤‡ä»½--&gt;æ¢å¤æ•°æ®åº“æ—¶å³ç›´æ¥å°†æ‰€æœ‰æ“ä½œå‘½ä»¤è¿è¡Œä¸€æ¬¡å³å¯</span>
mysql<span class="token operator">&gt;</span> source e:<span class="token comment">//backaccount.sql;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">[</span><span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span><span class="token punctuation">]</span> è¡¨å<span class="token punctuation">(</span>
    å­—æ®µ<span class="token number">1</span><span class="token punctuation">,</span> æ•°æ®ç±»å‹ <span class="token punctuation">[</span>çº¦æŸæ¡ä»¶<span class="token punctuation">]</span> <span class="token punctuation">[</span>é»˜è®¤å€¼<span class="token punctuation">]</span><span class="token punctuation">,</span> å­—æ®µ<span class="token number">2</span><span class="token punctuation">,</span> æ•°æ®ç±»å‹ <span class="token punctuation">[</span>çº¦æŸæ¡ä»¶<span class="token punctuation">]</span> <span class="token punctuation">[</span>é»˜è®¤å€¼<span class="token punctuation">]</span><span class="token punctuation">,</span> å­—æ®µ<span class="token number">3</span><span class="token punctuation">,</span> æ•°æ®ç±»å‹ <span class="token punctuation">[</span>çº¦æŸæ¡ä»¶<span class="token punctuation">]</span> <span class="token punctuation">[</span>é»˜è®¤å€¼<span class="token punctuation">]</span><span class="token punctuation">,</span> 
    â€¦â€¦ 
    <span class="token punctuation">[</span>è¡¨çº¦æŸæ¡ä»¶<span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> <span class="token keyword">tables</span> <span class="token keyword">from</span> db02<span class="token punctuation">;</span><span class="token comment">-- æŸ¥çœ‹æŒ‡å®šåº“ä¸­æ‰€æœ‰çš„è¡¨</span>
<span class="token operator">+</span><span class="token comment">----------------+</span>
<span class="token operator">|</span> Tables_in_db02 <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------+</span>
<span class="token operator">|</span> emp1           <span class="token operator">|</span>
<span class="token operator">|</span> employee1      <span class="token operator">|</span>
<span class="token operator">|</span> employee2      <span class="token operator">|</span>
<span class="token operator">|</span> employee3      <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------+</span>
<span class="token number">4</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp1<span class="token punctuation">;</span><span class="token comment">-- æŸ¥çœ‹æŒ‡å®šè¡¨ä¸­çš„å®Œæ•´æ•°æ®</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> a    <span class="token operator">|</span> b    <span class="token operator">|</span> c    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+</span>
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span>  <span class="token number">100</span> <span class="token operator">|</span>  <span class="token number">200</span> <span class="token operator">|</span>  <span class="token number">300</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">2</span> <span class="token operator">|</span> <span class="token number">1000</span> <span class="token operator">|</span> <span class="token number">2000</span> <span class="token operator">|</span> <span class="token number">3000</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+</span>
<span class="token number">2</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> <span class="token keyword">create</span> <span class="token keyword">table</span> emp1<span class="token punctuation">;</span><span class="token comment">-- æŸ¥çœ‹æŒ‡å®šè¡¨çš„åˆ›å»ºç»“æ„</span>
<span class="token operator">+</span><span class="token comment">-------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span class="token operator">|</span> <span class="token keyword">Table</span> <span class="token operator">|</span> <span class="token keyword">Create</span> <span class="token keyword">Table</span>                                                                                                                                                                               <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span class="token operator">|</span> emp1  <span class="token operator">|</span> <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>emp1<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">int</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>a<span class="token punctuation">`</span></span> <span class="token keyword">int</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>b<span class="token punctuation">`</span></span> <span class="token keyword">int</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>c<span class="token punctuation">`</span></span> <span class="token keyword">int</span> GENERATED ALWAYS <span class="token keyword">AS</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>a<span class="token punctuation">`</span></span> <span class="token operator">+</span> <span class="token identifier"><span class="token punctuation">`</span>b<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span> VIRTUAL
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb3 <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">describe</span> emp1<span class="token punctuation">;</span><span class="token comment">-- describe æŸ¥çœ‹è¡¨çš„è¯¦æƒ…æè¿°</span>
<span class="token operator">+</span><span class="token comment">-------+------+------+-----+---------+-------------------+</span>
<span class="token operator">|</span> Field <span class="token operator">|</span> <span class="token keyword">Type</span> <span class="token operator">|</span> <span class="token boolean">Null</span> <span class="token operator">|</span> <span class="token keyword">Key</span> <span class="token operator">|</span> <span class="token keyword">Default</span> <span class="token operator">|</span> Extra             <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+------+------+-----+---------+-------------------+</span>
<span class="token operator">|</span> id    <span class="token operator">|</span> <span class="token keyword">int</span>  <span class="token operator">|</span> YES  <span class="token operator">|</span>     <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span>                   <span class="token operator">|</span>
<span class="token operator">|</span> a     <span class="token operator">|</span> <span class="token keyword">int</span>  <span class="token operator">|</span> YES  <span class="token operator">|</span>     <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span>                   <span class="token operator">|</span>
<span class="token operator">|</span> b     <span class="token operator">|</span> <span class="token keyword">int</span>  <span class="token operator">|</span> YES  <span class="token operator">|</span>     <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span>                   <span class="token operator">|</span>
<span class="token operator">|</span> c     <span class="token operator">|</span> <span class="token keyword">int</span>  <span class="token operator">|</span> YES  <span class="token operator">|</span>     <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span> VIRTUAL GENERATED <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+------+------+-----+---------+-------------------+</span>
<span class="token number">4</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="åˆ›å»º-1" tabindex="-1"><a class="header-anchor" href="#åˆ›å»º-1" aria-hidden="true">#</a> åˆ›å»º</h5><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">#åˆ›å»ºè¡¨æŒ‡æ˜è¡¨çš„å­—æ®µ</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> student4<span class="token punctuation">(</span>
    id <span class="token keyword">int</span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>password<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">,</span>birthday <span class="token keyword">DATE</span><span class="token punctuation">)</span>
    <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8 <span class="token keyword">COLLATE</span> UTF8_bin <span class="token keyword">ENGINE</span> <span class="token keyword">INNODB</span><span class="token punctuation">;</span>
<span class="token comment">-- ä½¿ç”¨CHARACTER SET æŒ‡æ˜å­—ç¬¦é›† å¦åˆ™é»˜è®¤ä½¿ç”¨å’Œè¡¨ä¸€æ · ä½¿ç”¨COLLATE æŒ‡æ˜æ ¡å¯¹è§„åˆ™ å¦åˆ™ä½¿ç”¨å’Œè¡¨ä¸€æ · ä½¿ç”¨ENGINEæŒ‡æ˜å­˜å‚¨å¼•æ“</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">[</span><span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span><span class="token punctuation">]</span> è¡¨å<span class="token punctuation">(</span>
    å­—æ®µ<span class="token number">1</span><span class="token punctuation">,</span> æ•°æ®ç±»å‹ <span class="token punctuation">[</span>çº¦æŸæ¡ä»¶<span class="token punctuation">]</span> <span class="token punctuation">[</span>é»˜è®¤å€¼<span class="token punctuation">]</span><span class="token punctuation">,</span> å­—æ®µ<span class="token number">2</span><span class="token punctuation">,</span> æ•°æ®ç±»å‹ <span class="token punctuation">[</span>çº¦æŸæ¡ä»¶<span class="token punctuation">]</span> <span class="token punctuation">[</span>é»˜è®¤å€¼<span class="token punctuation">]</span><span class="token punctuation">,</span> å­—æ®µ<span class="token number">3</span><span class="token punctuation">,</span> æ•°æ®ç±»å‹ <span class="token punctuation">[</span>çº¦æŸæ¡ä»¶<span class="token punctuation">]</span> <span class="token punctuation">[</span>é»˜è®¤å€¼<span class="token punctuation">]</span><span class="token punctuation">,</span> 
    â€¦â€¦ 
    <span class="token punctuation">[</span>è¡¨çº¦æŸæ¡ä»¶<span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">#åˆ›å»ºè¡¨å¯ä»¥å°†å¦ä¸€ä¸ªè¡¨çš„æ•°æ®å¼•ç”¨è¿‡æ¥æˆä¸ºåˆ›å»ºçš„æ–°è¡¨çš„æ•°æ®</span>
<span class="token comment">-- ä½¿ç”¨ AS subquery é€‰é¡¹ï¼Œå°†åˆ›å»ºè¡¨å’Œæ’å…¥æ•°æ®ç»“åˆèµ·æ¥</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> emp1 <span class="token keyword">AS</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> employees<span class="token punctuation">;</span><span class="token comment">-- å¯ä»¥å®Œå…¨å°†ä¸€ä¸ªè¡¨çš„æ•°æ®ä½œä¸ºæ–°è¡¨çš„æ•°æ®ç±»ä¼¼äºå¤åˆ¶äº†ä¸€ä»½è¡¨--&gt;ä¹Ÿå¯ä»¥åœ¨å‘½ä»¤ä¸­è¿½åŠ æ¡ä»¶å¼•ç”¨æŒ‡å®šçš„æ•°æ®</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> emp2 <span class="token keyword">AS</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> employees <span class="token keyword">WHERE</span> <span class="token number">1</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">-- åˆ›å»ºçš„emp2æ˜¯ç©ºè¡¨</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> dept80
<span class="token keyword">AS</span>
<span class="token keyword">SELECT</span> employee_id<span class="token punctuation">,</span> last_name<span class="token punctuation">,</span> salary<span class="token operator">*</span><span class="token number">12</span> ANNSAL<span class="token punctuation">,</span> hire_date
<span class="token keyword">FROM</span> employees
<span class="token keyword">WHERE</span> department_id <span class="token operator">=</span> <span class="token number">80</span><span class="token punctuation">;</span>
<span class="token comment">-- å°†å¦ä¸€ä¸ªè¡¨çš„æŒ‡å®šæ•°æ®å¼•ç”¨è¿‡æ¥æˆä¸ºåˆ›å»ºçš„æ–°è¡¨çš„æ•°æ®</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token keyword">table</span> emp2 <span class="token keyword">as</span> <span class="token keyword">select</span> id<span class="token punctuation">,</span>a<span class="token punctuation">,</span>b <span class="token keyword">from</span> emp1<span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">2</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.02</span> sec<span class="token punctuation">)</span>
Records: <span class="token number">2</span>  Duplicates: <span class="token number">0</span>  <span class="token keyword">Warnings</span>: <span class="token number">0</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp2<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+------+------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> a    <span class="token operator">|</span> b    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+------+------+</span>
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span>  <span class="token number">100</span> <span class="token operator">|</span>  <span class="token number">200</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">2</span> <span class="token operator">|</span> <span class="token number">1000</span> <span class="token operator">|</span> <span class="token number">2000</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+------+------+</span>
<span class="token number">2</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
<span class="token comment">-- å°†å¦ä¸€ä¸ªè¡¨çš„æŒ‡å®šæ•°æ®å¹¶å¯ä»¥æŒ‡å®šé™å®šæ¡ä»¶ç­›é€‰åå¼•ç”¨è¿‡æ¥æˆä¸ºåˆ›å»ºçš„æ–°è¡¨çš„æ•°æ®</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token keyword">table</span> emp3 <span class="token keyword">select</span> id<span class="token punctuation">,</span>a<span class="token punctuation">,</span>b <span class="token keyword">from</span> emp2 <span class="token keyword">where</span> b<span class="token operator">=</span><span class="token number">2000</span><span class="token punctuation">;</span><span class="token comment">-- whereåå¯æŒ‡å®šé™åˆ¶æ¡ä»¶</span>
Query OK<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">row</span> affected <span class="token punctuation">(</span><span class="token number">0.14</span> sec<span class="token punctuation">)</span>
Records: <span class="token number">1</span>  Duplicates: <span class="token number">0</span>  <span class="token keyword">Warnings</span>: <span class="token number">0</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp3<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+------+------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> a    <span class="token operator">|</span> b    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+------+------+</span>
<span class="token operator">|</span>    <span class="token number">2</span> <span class="token operator">|</span> <span class="token number">1000</span> <span class="token operator">|</span> <span class="token number">2000</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+------+------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="ä¿®æ”¹-alter" tabindex="-1"><a class="header-anchor" href="#ä¿®æ”¹-alter" aria-hidden="true">#</a> ä¿®æ”¹ Alter</h5><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">#MySQL ALTERå‘½ä»¤</span>
å½“æˆ‘ä»¬éœ€è¦ä¿®æ”¹æ•°æ®è¡¨åæˆ–è€…ä¿®æ”¹æ•°æ®è¡¨å­—æ®µæ—¶ï¼Œå°±éœ€è¦ä½¿ç”¨åˆ°MySQL <span class="token keyword">ALTER</span>å‘½ä»¤
<span class="token comment">#åˆ é™¤ï¼Œæ·»åŠ æˆ–ä¿®æ”¹è¡¨å­—æ®µ</span>
å¦‚ä¸‹å‘½ä»¤ä½¿ç”¨äº† <span class="token keyword">ALTER</span> å‘½ä»¤åŠ <span class="token keyword">DROP</span> å­å¥æ¥åˆ é™¤ä»¥ä¸Šåˆ›å»ºè¡¨çš„ i å­—æ®µï¼š

mysql<span class="token operator">&gt;</span> <span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> testalter_tbl  <span class="token keyword">DROP</span> i<span class="token punctuation">;</span>
å¦‚æœæ•°æ®è¡¨ä¸­åªå‰©ä½™ä¸€ä¸ªå­—æ®µåˆ™æ— æ³•ä½¿ç”¨<span class="token keyword">DROP</span>æ¥åˆ é™¤å­—æ®µã€‚

MySQL ä¸­ä½¿ç”¨ <span class="token keyword">ADD</span> å­å¥æ¥å‘æ•°æ®è¡¨ä¸­æ·»åŠ åˆ—ï¼Œå¦‚ä¸‹å®ä¾‹åœ¨è¡¨ testalter_tbl ä¸­æ·»åŠ  i å­—æ®µï¼Œå¹¶å®šä¹‰æ•°æ®ç±»å‹:

mysql<span class="token operator">&gt;</span> <span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> testalter_tbl <span class="token keyword">ADD</span> i <span class="token keyword">INT</span><span class="token punctuation">;</span>

<span class="token comment">#ä¿®æ”¹å­—æ®µç±»å‹åŠåç§°</span>
å¦‚æœéœ€è¦ä¿®æ”¹å­—æ®µç±»å‹åŠåç§°<span class="token punctuation">,</span> ä½ å¯ä»¥åœ¨<span class="token keyword">ALTER</span>å‘½ä»¤ä¸­ä½¿ç”¨ <span class="token keyword">MODIFY</span> æˆ– CHANGE å­å¥ ã€‚

ä¾‹å¦‚ï¼ŒæŠŠå­—æ®µ c çš„ç±»å‹ä» <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> æ”¹ä¸º <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤:

mysql<span class="token operator">&gt;</span> <span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> testalter_tbl <span class="token keyword">MODIFY</span> c <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ä½¿ç”¨ CHANGE å­å¥<span class="token punctuation">,</span> è¯­æ³•æœ‰å¾ˆå¤§çš„ä¸åŒã€‚ åœ¨ CHANGE å…³é”®å­—ä¹‹åï¼Œç´§è·Ÿç€çš„æ˜¯ä½ è¦ä¿®æ”¹çš„å­—æ®µåï¼Œç„¶åæŒ‡å®šæ–°å­—æ®µååŠç±»å‹ã€‚å°è¯•å¦‚ä¸‹å®ä¾‹ï¼š

mysql<span class="token operator">&gt;</span> <span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> testalter_tbl CHANGE i j <span class="token keyword">BIGINT</span><span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> testalter_tbl CHANGE j j <span class="token keyword">INT</span><span class="token punctuation">;</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> å¯¹ <span class="token boolean">Null</span> å€¼å’Œé»˜è®¤å€¼çš„å½±å“
å½“ä½ ä¿®æ”¹å­—æ®µæ—¶ï¼Œä½ å¯ä»¥æŒ‡å®šæ˜¯å¦åŒ…å«å€¼æˆ–è€…æ˜¯å¦è®¾ç½®é»˜è®¤å€¼
ä»¥ä¸‹å®ä¾‹ï¼ŒæŒ‡å®šå­—æ®µ j ä¸º <span class="token operator">NOT</span> <span class="token boolean">NULL</span> ä¸”é»˜è®¤å€¼ä¸º<span class="token number">100</span> ã€‚

mysql<span class="token operator">&gt;</span> <span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> testalter_tbl 
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">MODIFY</span> j <span class="token keyword">BIGINT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token number">100</span><span class="token punctuation">;</span>

<span class="token comment">#ä¿®æ”¹å­—æ®µé»˜è®¤å€¼</span>
ä½ å¯ä»¥ä½¿ç”¨ <span class="token keyword">ALTER</span> æ¥ä¿®æ”¹å­—æ®µçš„é»˜è®¤å€¼
ä½ å¯ä»¥ä½¿ç”¨ <span class="token keyword">ALTER</span> æ¥ä¿®æ”¹å­—æ®µçš„é»˜è®¤å€¼ï¼Œå°è¯•ä»¥ä¸‹å®ä¾‹ï¼š

mysql<span class="token operator">&gt;</span> <span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> testalter_tbl <span class="token keyword">ALTER</span> i <span class="token keyword">SET</span> <span class="token keyword">DEFAULT</span> <span class="token number">1000</span><span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">SHOW</span> <span class="token keyword">COLUMNS</span> <span class="token keyword">FROM</span> testalter_tbl<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-------+---------+------+-----+---------+-------+</span>
<span class="token operator">|</span> Field <span class="token operator">|</span> <span class="token keyword">Type</span>    <span class="token operator">|</span> <span class="token boolean">Null</span> <span class="token operator">|</span> <span class="token keyword">Key</span> <span class="token operator">|</span> <span class="token keyword">Default</span> <span class="token operator">|</span> Extra <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+---------+------+-----+---------+-------+</span>
<span class="token operator">|</span> c     <span class="token operator">|</span> <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">|</span> YES  <span class="token operator">|</span>     <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span>       <span class="token operator">|</span>
<span class="token operator">|</span> i     <span class="token operator">|</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">|</span> YES  <span class="token operator">|</span>     <span class="token operator">|</span> <span class="token number">1000</span>    <span class="token operator">|</span>       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+---------+------+-----+---------+-------+</span>
<span class="token number">2</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ <span class="token keyword">ALTER</span> å‘½ä»¤åŠ <span class="token keyword">DROP</span>å­å¥æ¥åˆ é™¤å­—æ®µçš„é»˜è®¤å€¼ï¼Œå¦‚ä¸‹å®ä¾‹ï¼š

mysql<span class="token operator">&gt;</span> <span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> testalter_tbl <span class="token keyword">ALTER</span> i <span class="token keyword">DROP</span> <span class="token keyword">DEFAULT</span><span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">SHOW</span> <span class="token keyword">COLUMNS</span> <span class="token keyword">FROM</span> testalter_tbl<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-------+---------+------+-----+---------+-------+</span>
<span class="token operator">|</span> Field <span class="token operator">|</span> <span class="token keyword">Type</span>    <span class="token operator">|</span> <span class="token boolean">Null</span> <span class="token operator">|</span> <span class="token keyword">Key</span> <span class="token operator">|</span> <span class="token keyword">Default</span> <span class="token operator">|</span> Extra <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+---------+------+-----+---------+-------+</span>
<span class="token operator">|</span> c     <span class="token operator">|</span> <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">|</span> YES  <span class="token operator">|</span>     <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span>       <span class="token operator">|</span>
<span class="token operator">|</span> i     <span class="token operator">|</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">|</span> YES  <span class="token operator">|</span>     <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span>       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+---------+------+-----+---------+-------+</span>
<span class="token number">2</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
Changing a <span class="token keyword">Table</span> <span class="token keyword">Type</span>:

<span class="token comment">#ä¿®æ”¹è¡¨å</span>
å¦‚æœéœ€è¦ä¿®æ”¹æ•°æ®è¡¨çš„åç§°ï¼Œå¯ä»¥åœ¨ <span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> è¯­å¥ä¸­ä½¿ç”¨ <span class="token keyword">RENAME</span> å­å¥æ¥å®ç°
å°è¯•ä»¥ä¸‹å®ä¾‹å°†æ•°æ®è¡¨ testalter_tbl é‡å‘½åä¸º alter_tblï¼š

mysql<span class="token operator">&gt;</span> <span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> testalter_tbl <span class="token keyword">RENAME</span> <span class="token keyword">TO</span> alter_tbl<span class="token punctuation">;</span>

<span class="token comment">#alterå…¶ä»–ç”¨é€”ï¼š</span>

<span class="token comment">#ä¿®æ”¹å­˜å‚¨å¼•æ“ï¼šä¿®æ”¹ä¸ºmyisam</span>

<span class="token keyword">alter</span> <span class="token keyword">table</span> tableName <span class="token keyword">engine</span><span class="token operator">=</span>myisam<span class="token punctuation">;</span>
<span class="token comment">#åˆ é™¤å¤–é”®çº¦æŸï¼škeyNameæ˜¯å¤–é”®åˆ«å</span>

<span class="token keyword">alter</span> <span class="token keyword">table</span> tableName <span class="token keyword">drop</span> <span class="token keyword">foreign</span> <span class="token keyword">key</span> keyName<span class="token punctuation">;</span>
<span class="token comment">#ä¿®æ”¹å­—æ®µçš„ç›¸å¯¹ä½ç½®ï¼šè¿™é‡Œname1ä¸ºæƒ³è¦ä¿®æ”¹çš„å­—æ®µï¼Œtype1ä¸ºè¯¥å­—æ®µåŸæ¥ç±»å‹ï¼Œfirstå’ŒafteräºŒé€‰ä¸€ï¼Œè¿™åº”è¯¥æ˜¾è€Œæ˜“è§ï¼Œfirstæ”¾åœ¨ç¬¬ä¸€ä½ï¼Œafteræ”¾åœ¨name2å­—æ®µåé¢</span>

<span class="token keyword">alter</span> <span class="token keyword">table</span> tableName <span class="token keyword">modify</span> name1 type1 <span class="token keyword">first</span><span class="token operator">|</span><span class="token keyword">after</span> name2<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="åˆ é™¤" tabindex="-1"><a class="header-anchor" href="#åˆ é™¤" aria-hidden="true">#</a> åˆ é™¤</h5><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">#åœ¨MySQLä¸­ï¼Œå½“ä¸€å¼ æ•°æ®è¡¨ æ²¡æœ‰ä¸å…¶ä»–ä»»ä½•æ•°æ®è¡¨å½¢æˆå…³è”å…³ç³» æ—¶ï¼Œå¯ä»¥å°†å½“å‰æ•°æ®è¡¨ç›´æ¥åˆ é™¤ã€‚</span>
<span class="token comment">#æ•°æ®å’Œç»“æ„éƒ½è¢«åˆ é™¤</span>
<span class="token comment">#æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„ç›¸å…³äº‹åŠ¡è¢«æäº¤</span>
<span class="token comment">#æ‰€æœ‰ç›¸å…³ç´¢å¼•è¢«åˆ é™¤</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">drop</span> <span class="token keyword">table</span> <span class="token punctuation">[</span><span class="token keyword">IF</span> <span class="token keyword">EXISTS</span><span class="token punctuation">]</span> emp3<span class="token punctuation">;</span>
<span class="token comment">-- DROP TABLE è¯­å¥ä¸èƒ½å›æ»š</span>

<span class="token comment">#TRUNCATE TABLEè¯­å¥ï¼š</span>
<span class="token comment">#åˆ é™¤è¡¨ä¸­æ‰€æœ‰çš„æ•°æ®</span>
<span class="token comment">#é‡Šæ”¾è¡¨çš„å­˜å‚¨ç©ºé—´</span>
<span class="token comment">#ä¸¾ä¾‹ï¼š</span>
<span class="token keyword">TRUNCATE</span> <span class="token keyword">TABLE</span> detail_dept<span class="token punctuation">;</span>
<span class="token comment">-- TRUNCATEè¯­å¥ä¸èƒ½å›æ»šï¼Œè€Œä½¿ç”¨ DELETE è¯­å¥åˆ é™¤æ•°æ®ï¼Œå¯ä»¥å›æ»š</span>
<span class="token comment">#delete from è¡¨å</span>
<span class="token comment">#åˆ é™¤è¡¨ä¸­æ‰€æœ‰çš„æ•°æ®</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">delete</span> <span class="token keyword">from</span> emp2<span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">2</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> <span class="token keyword">tables</span> <span class="token keyword">from</span> db02<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----------------+</span>
<span class="token operator">|</span> Tables_in_db02 <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------+</span>
<span class="token operator">|</span> emp1           <span class="token operator">|</span>
<span class="token operator">|</span> emp2           <span class="token operator">|</span>
<span class="token operator">|</span> employee1      <span class="token operator">|</span>
<span class="token operator">|</span> employee2      <span class="token operator">|</span>
<span class="token operator">|</span> employee3      <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------+</span>
<span class="token number">5</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> fm emp2<span class="token punctuation">;</span>
Empty <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="è·¨æœåŠ¡å™¨è·¨åº“æŸ¥è¯¢" tabindex="-1"><a class="header-anchor" href="#è·¨æœåŠ¡å™¨è·¨åº“æŸ¥è¯¢" aria-hidden="true">#</a> è·¨æœåŠ¡å™¨è·¨åº“æŸ¥è¯¢</h4><blockquote><p><strong>1.è¦æ±‚å½“å‰MySQLæœåŠ¡å™¨å¼€å¯ä½¿ç”¨Federatedå­˜å‚¨å¼•æ“</strong></p><p>show enginesï¼ˆæŸ¥çœ‹æ˜¯å¦å¼€å¯äº†Federatedå­˜å‚¨å¼•æ“ï¼‰</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysql<span class="token operator">&gt;</span> show engines <span class="token punctuation">\</span>G<span class="token punctuation">;</span>
     Engine: FEDERATED
     Support: YES
     Comment: Federated MySQL storage engine
Transactions: NO
          XA: NO
  Savepoints: NO
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>my.iniæ–‡ä»¶é…ç½®</p><div class="language-ini line-numbers-mode" data-ext="ini"><pre class="language-ini"><code><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">mysqld</span><span class="token punctuation">]</span></span>
<span class="token comment"># æ”¯æŒfederatedå¼•æ“</span>
federated
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>2.åˆ›å»ºæ˜ å°„è¡¨Connectionè¿œç¨‹MySQLæœåŠ¡å™¨çš„åº“è¡¨</strong></p><p>å¼€å¯è¦è¿æ¥æœåŠ¡å™¨MySQLçš„ç”¨æˆ·çš„è¿æ¥æƒé™</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>mysql&gt; update user set host = &quot;%&quot; where user = &quot;root&quot;;
Query OK, 1 row affected (0.02 sec)
Rows matched: 1  Changed: 1  Warnings: 0

mysql&gt; select host,user from user;
+-----------+------------------+
| host      | user             |
+-----------+------------------+
| %         | root             |
| %         | slave-gtid       |
| localhost | mysql.infoschema |
| localhost | mysql.session    |
| localhost | mysql.sys        |
+-----------+------------------+
5 rows in set (0.00 sec)

mysql&gt; flush privileges;
Query OK, 0 rows affected (0.72 sec)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å»ºæ˜ å°„è¡¨Connectionè¿œç¨‹MySQLæœåŠ¡å™¨çš„åº“è¡¨</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>CREATE TABLE `eddie_test`  (
  `id` int(0) NOT NULL AUTO_INCREMENT,
  `name` varchar(25) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL DEFAULT &#39;&#39;,
  `major` varchar(55) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL DEFAULT &#39;&#39;,
  `gender` varchar(10) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL DEFAULT &#39;&#39;,
  PRIMARY KEY (`id`) USING BTREE
) ENGINE = FEDERATED connection &#39;mysql://root:root@192.168.6.183:3306/åº“å/è¡¨å&#39; CHARACTER SET = utf8 COLLATE = utf8_general_ci ROW_FORMAT = Dynamic;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></blockquote><h4 id="mysqlæ•°æ®ç±»å‹â˜…" tabindex="-1"><a class="header-anchor" href="#mysqlæ•°æ®ç±»å‹â˜…" aria-hidden="true">#</a> MySQLæ•°æ®ç±»å‹â˜…</h4><h5 id="æ•°å€¼ç±»å‹" tabindex="-1"><a class="header-anchor" href="#æ•°å€¼ç±»å‹" aria-hidden="true">#</a> æ•°å€¼ç±»å‹</h5><h6 id="æ•´å½¢" tabindex="-1"><a class="header-anchor" href="#æ•´å½¢" aria-hidden="true">#</a> æ•´å½¢</h6><p>tInyint[ä¸€ä¸ªå­—èŠ‚]</p><p>smallint[ä¸¤ä¸ªå­—èŠ‚]</p><p>mediumint[ä¸‰ä¸ªå­—èŠ‚]</p><p><strong>int[å››ä¸ªå­—èŠ‚]</strong></p><p>bigint[å…«ä¸ªå­—èŠ‚]</p><h6 id="å°æ•°ç±»å‹" tabindex="-1"><a class="header-anchor" href="#å°æ•°ç±»å‹" aria-hidden="true">#</a> å°æ•°ç±»å‹</h6><p>floatï¼ˆå•ç²¾åº¦ï¼‰[å››ä¸ªå­—èŠ‚]</p><p><strong>doubleï¼ˆåŒç²¾åº¦ï¼‰[å…«ä¸ªå­—èŠ‚]</strong></p><p><strong>decimalï¼ˆM,Dï¼‰[ä¸ç¡®å®šå¤§å°]</strong></p><h5 id="æ–‡æœ¬ç±»å‹-å­—ç¬¦ä¸²ç±»å‹" tabindex="-1"><a class="header-anchor" href="#æ–‡æœ¬ç±»å‹-å­—ç¬¦ä¸²ç±»å‹" aria-hidden="true">#</a> æ–‡æœ¬ç±»å‹ï¼ˆå­—ç¬¦ä¸²ç±»å‹ï¼‰</h5><p><strong>char(è¡¨æ•°èŒƒå›´0-255)</strong></p><p><strong>varcharï¼ˆè¡¨æ•°èŒƒå›´0-65535ã€2^16-1ã€‘ï¼‰</strong></p><p><strong>text(è¡¨æ•°èŒƒå›´0-65535ã€2^16-1ã€‘)</strong></p><p>longtext(è¡¨æ•°èŒƒå›´0-ã€2^32-1ã€‘)</p><h5 id="äºŒè¿›åˆ¶æ•°æ®ç±»å‹" tabindex="-1"><a class="header-anchor" href="#äºŒè¿›åˆ¶æ•°æ®ç±»å‹" aria-hidden="true">#</a> äºŒè¿›åˆ¶æ•°æ®ç±»å‹</h5><p>blob(è¡¨æ•°èŒƒå›´0-65535ã€2^16-1ã€‘)</p><p>longblob(è¡¨æ•°èŒƒå›´0-ã€2^32-1ã€‘)</p><h5 id="æ—¥æœŸç±»å‹" tabindex="-1"><a class="header-anchor" href="#æ—¥æœŸç±»å‹" aria-hidden="true">#</a> æ—¥æœŸç±»å‹</h5><p>date(æ—¥æœŸ å¹´æœˆæ—¥)</p><p>timeï¼ˆæ—¶é—´ æ—¶åˆ†ç§’ï¼‰</p><p><strong>datetimeï¼ˆæ—¥æœŸæ—¶é—´ å¹´æœˆæ—¥ æ—¶åˆ†ç§’ YYYY-MM-DD hh:mm:ssï¼‰</strong></p><p><strong>timestamp(æ—¶é—´æˆ³)</strong></p><p>yearï¼ˆå¹´ï¼‰</p><h4 id="crudâ˜…" tabindex="-1"><a class="header-anchor" href="#crudâ˜…" aria-hidden="true">#</a> CRUDâ˜…</h4><p><strong>Tip</strong>: sqlä¸­çš„<strong>null</strong>å€¼ æŸ¥æ‰¾ä½¿ç”¨ is</p><p>SELECT * FROM SOME_TABLE <strong>WHERE SOME_COLUMN <code>IS</code> NULL</strong></p><h5 id="insert" tabindex="-1"><a class="header-anchor" href="#insert" aria-hidden="true">#</a> Insert</h5><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">#SQL INSERT INTO è¯­å¥</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> è¯­å¥ç”¨äºå‘è¡¨ä¸­æ’å…¥æ–°è®°å½•

<span class="token comment">#INSERT INTO è¯­å¥å¯ä»¥æœ‰ä¸¤ç§ç¼–å†™å½¢å¼ã€‚</span>
<span class="token comment">-- ç¬¬ä¸€ç§å½¢å¼æ— éœ€æŒ‡å®šè¦æ’å…¥æ•°æ®çš„åˆ—åï¼Œåªéœ€æä¾›è¢«æ’å…¥çš„å€¼å³å¯ï¼šæ²¡æœ‰æŒ‡å®šè¦æ’å…¥æ•°æ®çš„åˆ—åçš„å½¢å¼éœ€è¦åˆ—å‡ºæ’å…¥è¡Œçš„æ¯ä¸€åˆ—æ•°æ®:</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> table_name
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span>value1<span class="token punctuation">,</span>value2<span class="token punctuation">,</span>value3<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- ç¬¬äºŒç§å½¢å¼éœ€è¦æŒ‡å®šåˆ—ååŠè¢«æ’å…¥çš„å€¼ï¼š</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> table_name <span class="token punctuation">(</span>column1<span class="token punctuation">,</span>column2<span class="token punctuation">,</span>column3<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span>value1<span class="token punctuation">,</span>value2<span class="token punctuation">,</span>value3<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- æ‰©å±•</span>
<span class="token comment">-- é€šè¿‡ SQLï¼Œæ‚¨å¯ä»¥ä»ä¸€ä¸ªè¡¨å¤åˆ¶ä¿¡æ¯åˆ°å¦ä¸€ä¸ªè¡¨ã€‚INSERT INTO SELECT è¯­å¥ä»ä¸€ä¸ªè¡¨å¤åˆ¶æ•°æ®ï¼Œç„¶åæŠŠæ•°æ®æ’å…¥åˆ°ä¸€ä¸ªå·²å­˜åœ¨çš„è¡¨ä¸­</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token keyword">SELECT</span>

<span class="token comment">-- For instance:</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp2<span class="token punctuation">;</span><span class="token comment">-- ç¬¬ä¸€ç§å½¢å¼æ— éœ€æŒ‡å®šè¦æ’å…¥æ•°æ®çš„åˆ—åï¼Œåªéœ€æä¾›è¢«æ’å…¥çš„å€¼å³å¯ï¼š</span>
Empty <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> inert <span class="token keyword">into</span> emp2 <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">22</span><span class="token punctuation">,</span><span class="token number">33</span><span class="token punctuation">,</span><span class="token number">55</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ERROR <span class="token number">1064</span> <span class="token punctuation">(</span><span class="token number">42000</span><span class="token punctuation">)</span>: You have an error <span class="token operator">in</span> your <span class="token keyword">SQL</span> syntax<span class="token punctuation">;</span> <span class="token keyword">check</span> the manual that corresponds <span class="token keyword">to</span> your MySQL server version <span class="token keyword">for</span> the <span class="token keyword">right</span> syntax <span class="token keyword">to</span> <span class="token keyword">use</span> near <span class="token string">&#39;inert into emp2 values (1,22,33,55)&#39;</span> at line <span class="token number">1</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">insert</span> <span class="token keyword">into</span> emp2 <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">22</span><span class="token punctuation">,</span><span class="token number">33</span><span class="token punctuation">,</span><span class="token number">55</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">row</span> affected <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp2<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> a    <span class="token operator">|</span> b    <span class="token operator">|</span> sum  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+</span>
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span>   <span class="token number">22</span> <span class="token operator">|</span>   <span class="token number">33</span> <span class="token operator">|</span>   <span class="token number">55</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">insert</span> <span class="token keyword">into</span> emp1 <span class="token punctuation">(</span>id<span class="token punctuation">,</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>d<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">5223</span><span class="token punctuation">,</span><span class="token number">544</span><span class="token punctuation">,</span><span class="token number">1001</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">-- ç¬¬äºŒç§å½¢å¼éœ€è¦æŒ‡å®šåˆ—ååŠè¢«æ’å…¥çš„å€¼ï¼š</span>
Query OK<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">row</span> affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp1<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> a    <span class="token operator">|</span> b    <span class="token operator">|</span> c    <span class="token operator">|</span> d    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+------+</span>
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span>  <span class="token number">100</span> <span class="token operator">|</span>  <span class="token number">200</span> <span class="token operator">|</span>  <span class="token number">300</span> <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">2</span> <span class="token operator">|</span> <span class="token number">1000</span> <span class="token operator">|</span> <span class="token number">2000</span> <span class="token operator">|</span> <span class="token number">3000</span> <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">3</span> <span class="token operator">|</span>  <span class="token number">120</span> <span class="token operator">|</span>  <span class="token number">520</span> <span class="token operator">|</span>  <span class="token number">640</span> <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">4</span> <span class="token operator">|</span>  <span class="token number">120</span> <span class="token operator">|</span>  <span class="token number">520</span> <span class="token operator">|</span>  <span class="token number">640</span> <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">5</span> <span class="token operator">|</span>  <span class="token number">120</span> <span class="token operator">|</span>  <span class="token number">520</span> <span class="token operator">|</span>  <span class="token number">640</span> <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">6</span> <span class="token operator">|</span> <span class="token number">5223</span> <span class="token operator">|</span>  <span class="token number">544</span> <span class="token operator">|</span> <span class="token number">5767</span> <span class="token operator">|</span> <span class="token number">1001</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+------+</span>
<span class="token number">6</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span>

<span class="token comment">#SQL INSERT INTO SELECT è¯­å¥</span>
<span class="token comment">-- é€šè¿‡ SQLï¼Œæ‚¨å¯ä»¥ä»ä¸€ä¸ªè¡¨å¤åˆ¶ä¿¡æ¯åˆ°å¦ä¸€ä¸ªè¡¨ã€‚INSERT INTO SELECT è¯­å¥ä»ä¸€ä¸ªè¡¨å¤åˆ¶æ•°æ®ï¼Œç„¶åæŠŠæ•°æ®æ’å…¥åˆ°ä¸€ä¸ªå·²å­˜åœ¨çš„è¡¨ä¸­</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">insert</span> <span class="token keyword">into</span> emp2 <span class="token punctuation">(</span>id<span class="token punctuation">,</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>sum<span class="token punctuation">)</span> <span class="token keyword">select</span> id<span class="token punctuation">,</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c <span class="token keyword">from</span> emp1 <span class="token keyword">where</span> id <span class="token operator">between</span> <span class="token number">2</span> <span class="token operator">and</span> <span class="token number">6</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">5</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
Records: <span class="token number">5</span>  Duplicates: <span class="token number">0</span>  <span class="token keyword">Warnings</span>: <span class="token number">0</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp2<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> a    <span class="token operator">|</span> b    <span class="token operator">|</span> sum  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+</span>
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span>   <span class="token number">22</span> <span class="token operator">|</span>   <span class="token number">33</span> <span class="token operator">|</span>   <span class="token number">55</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">2</span> <span class="token operator">|</span> <span class="token number">1000</span> <span class="token operator">|</span> <span class="token number">2000</span> <span class="token operator">|</span> <span class="token number">3000</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">3</span> <span class="token operator">|</span>  <span class="token number">120</span> <span class="token operator">|</span>  <span class="token number">520</span> <span class="token operator">|</span>  <span class="token number">640</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">4</span> <span class="token operator">|</span>  <span class="token number">120</span> <span class="token operator">|</span>  <span class="token number">520</span> <span class="token operator">|</span>  <span class="token number">640</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">5</span> <span class="token operator">|</span>  <span class="token number">120</span> <span class="token operator">|</span>  <span class="token number">520</span> <span class="token operator">|</span>  <span class="token number">640</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">6</span> <span class="token operator">|</span> <span class="token number">5223</span> <span class="token operator">|</span>  <span class="token number">544</span> <span class="token operator">|</span> <span class="token number">5767</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+</span>
<span class="token number">6</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">update</span> emp1 <span class="token keyword">set</span> d<span class="token operator">=</span><span class="token punctuation">(</span>id <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">6</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.15</span> sec<span class="token punctuation">)</span>
<span class="token keyword">Rows</span> <span class="token keyword">matched</span>: <span class="token number">6</span>  Changed: <span class="token number">6</span>  <span class="token keyword">Warnings</span>: <span class="token number">0</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp1<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> a    <span class="token operator">|</span> b    <span class="token operator">|</span> c    <span class="token operator">|</span> d    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+------+</span>
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span>  <span class="token number">100</span> <span class="token operator">|</span>  <span class="token number">200</span> <span class="token operator">|</span>  <span class="token number">300</span> <span class="token operator">|</span>   <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">2</span> <span class="token operator">|</span> <span class="token number">1000</span> <span class="token operator">|</span> <span class="token number">2000</span> <span class="token operator">|</span> <span class="token number">3000</span> <span class="token operator">|</span>   <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">3</span> <span class="token operator">|</span>  <span class="token number">120</span> <span class="token operator">|</span>  <span class="token number">520</span> <span class="token operator">|</span>  <span class="token number">640</span> <span class="token operator">|</span>   <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">4</span> <span class="token operator">|</span>  <span class="token number">120</span> <span class="token operator">|</span>  <span class="token number">520</span> <span class="token operator">|</span>  <span class="token number">640</span> <span class="token operator">|</span>   <span class="token number">40</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">5</span> <span class="token operator">|</span>  <span class="token number">120</span> <span class="token operator">|</span>  <span class="token number">520</span> <span class="token operator">|</span>  <span class="token number">640</span> <span class="token operator">|</span>   <span class="token number">50</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">6</span> <span class="token operator">|</span> <span class="token number">5223</span> <span class="token operator">|</span>  <span class="token number">544</span> <span class="token operator">|</span> <span class="token number">5767</span> <span class="token operator">|</span>   <span class="token number">60</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+------+</span>
<span class="token number">6</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="update" tabindex="-1"><a class="header-anchor" href="#update" aria-hidden="true">#</a> Update</h5><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">#SQL UPDATE è¯­å¥</span>
<span class="token keyword">UPDATE</span> è¯­å¥ç”¨äºæ›´æ–°è¡¨ä¸­å·²å­˜åœ¨çš„è®°å½•ã€‚
<span class="token comment">-- SQL UPDATE è¯­æ³•</span>
<span class="token keyword">UPDATE</span> table_name
<span class="token keyword">SET</span> column1<span class="token operator">=</span>value1<span class="token punctuation">,</span>column2<span class="token operator">=</span>value2<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">WHERE</span> some_column<span class="token operator">=</span>some_value<span class="token punctuation">;</span>

<span class="token comment">-- For instance</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp1<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> a    <span class="token operator">|</span> b    <span class="token operator">|</span> c    <span class="token operator">|</span> d    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+------+</span>
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span>  <span class="token number">100</span> <span class="token operator">|</span>  <span class="token number">200</span> <span class="token operator">|</span>  <span class="token number">300</span> <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">2</span> <span class="token operator">|</span> <span class="token number">1000</span> <span class="token operator">|</span> <span class="token number">2000</span> <span class="token operator">|</span> <span class="token number">3000</span> <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">3</span> <span class="token operator">|</span>  <span class="token number">120</span> <span class="token operator">|</span>  <span class="token number">520</span> <span class="token operator">|</span>  <span class="token number">640</span> <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">4</span> <span class="token operator">|</span>  <span class="token number">120</span> <span class="token operator">|</span>  <span class="token number">520</span> <span class="token operator">|</span>  <span class="token number">640</span> <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">5</span> <span class="token operator">|</span>  <span class="token number">120</span> <span class="token operator">|</span>  <span class="token number">520</span> <span class="token operator">|</span>  <span class="token number">640</span> <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">6</span> <span class="token operator">|</span> <span class="token number">5223</span> <span class="token operator">|</span>  <span class="token number">544</span> <span class="token operator">|</span> <span class="token number">5767</span> <span class="token operator">|</span> <span class="token number">1001</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+------+</span>
<span class="token number">6</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">update</span> emp1 <span class="token keyword">set</span> d<span class="token operator">=</span><span class="token number">100</span> <span class="token keyword">where</span> c<span class="token operator">&lt;=</span><span class="token number">640</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">4</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
<span class="token keyword">Rows</span> <span class="token keyword">matched</span>: <span class="token number">4</span>  Changed: <span class="token number">4</span>  <span class="token keyword">Warnings</span>: <span class="token number">0</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp1<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> a    <span class="token operator">|</span> b    <span class="token operator">|</span> c    <span class="token operator">|</span> d    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+------+</span>
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span>  <span class="token number">100</span> <span class="token operator">|</span>  <span class="token number">200</span> <span class="token operator">|</span>  <span class="token number">300</span> <span class="token operator">|</span>  <span class="token number">100</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">2</span> <span class="token operator">|</span> <span class="token number">1000</span> <span class="token operator">|</span> <span class="token number">2000</span> <span class="token operator">|</span> <span class="token number">3000</span> <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">3</span> <span class="token operator">|</span>  <span class="token number">120</span> <span class="token operator">|</span>  <span class="token number">520</span> <span class="token operator">|</span>  <span class="token number">640</span> <span class="token operator">|</span>  <span class="token number">100</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">4</span> <span class="token operator">|</span>  <span class="token number">120</span> <span class="token operator">|</span>  <span class="token number">520</span> <span class="token operator">|</span>  <span class="token number">640</span> <span class="token operator">|</span>  <span class="token number">100</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">5</span> <span class="token operator">|</span>  <span class="token number">120</span> <span class="token operator">|</span>  <span class="token number">520</span> <span class="token operator">|</span>  <span class="token number">640</span> <span class="token operator">|</span>  <span class="token number">100</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">6</span> <span class="token operator">|</span> <span class="token number">5223</span> <span class="token operator">|</span>  <span class="token number">544</span> <span class="token operator">|</span> <span class="token number">5767</span> <span class="token operator">|</span> <span class="token number">1001</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+------+</span>
<span class="token number">6</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">update</span> emp1 <span class="token keyword">set</span> d<span class="token operator">=</span><span class="token number">1002</span> <span class="token keyword">where</span> d<span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">5</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>
<span class="token keyword">Rows</span> <span class="token keyword">matched</span>: <span class="token number">5</span>  Changed: <span class="token number">5</span>  <span class="token keyword">Warnings</span>: <span class="token number">0</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp1<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> a    <span class="token operator">|</span> b    <span class="token operator">|</span> c    <span class="token operator">|</span> d    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+------+</span>
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span>  <span class="token number">100</span> <span class="token operator">|</span>  <span class="token number">200</span> <span class="token operator">|</span>  <span class="token number">300</span> <span class="token operator">|</span> <span class="token number">1002</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">2</span> <span class="token operator">|</span> <span class="token number">1000</span> <span class="token operator">|</span> <span class="token number">2000</span> <span class="token operator">|</span> <span class="token number">3000</span> <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">3</span> <span class="token operator">|</span>  <span class="token number">120</span> <span class="token operator">|</span>  <span class="token number">520</span> <span class="token operator">|</span>  <span class="token number">640</span> <span class="token operator">|</span> <span class="token number">1002</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">4</span> <span class="token operator">|</span>  <span class="token number">120</span> <span class="token operator">|</span>  <span class="token number">520</span> <span class="token operator">|</span>  <span class="token number">640</span> <span class="token operator">|</span> <span class="token number">1002</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">5</span> <span class="token operator">|</span>  <span class="token number">120</span> <span class="token operator">|</span>  <span class="token number">520</span> <span class="token operator">|</span>  <span class="token number">640</span> <span class="token operator">|</span> <span class="token number">1002</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">6</span> <span class="token operator">|</span> <span class="token number">5223</span> <span class="token operator">|</span>  <span class="token number">544</span> <span class="token operator">|</span> <span class="token number">5767</span> <span class="token operator">|</span> <span class="token number">1002</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+------+</span>
<span class="token number">6</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">update</span> emp1 <span class="token keyword">set</span> d<span class="token operator">=</span><span class="token number">1002</span> <span class="token keyword">where</span> d <span class="token operator">is</span> <span class="token boolean">null</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">row</span> affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
<span class="token keyword">Rows</span> <span class="token keyword">matched</span>: <span class="token number">1</span>  Changed: <span class="token number">1</span>  <span class="token keyword">Warnings</span>: <span class="token number">0</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp1<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> a    <span class="token operator">|</span> b    <span class="token operator">|</span> c    <span class="token operator">|</span> d    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+------+</span>
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span>  <span class="token number">100</span> <span class="token operator">|</span>  <span class="token number">200</span> <span class="token operator">|</span>  <span class="token number">300</span> <span class="token operator">|</span> <span class="token number">1002</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">2</span> <span class="token operator">|</span> <span class="token number">1000</span> <span class="token operator">|</span> <span class="token number">2000</span> <span class="token operator">|</span> <span class="token number">3000</span> <span class="token operator">|</span> <span class="token number">1002</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">3</span> <span class="token operator">|</span>  <span class="token number">120</span> <span class="token operator">|</span>  <span class="token number">520</span> <span class="token operator">|</span>  <span class="token number">640</span> <span class="token operator">|</span> <span class="token number">1002</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">4</span> <span class="token operator">|</span>  <span class="token number">120</span> <span class="token operator">|</span>  <span class="token number">520</span> <span class="token operator">|</span>  <span class="token number">640</span> <span class="token operator">|</span> <span class="token number">1002</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">5</span> <span class="token operator">|</span>  <span class="token number">120</span> <span class="token operator">|</span>  <span class="token number">520</span> <span class="token operator">|</span>  <span class="token number">640</span> <span class="token operator">|</span> <span class="token number">1002</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">6</span> <span class="token operator">|</span> <span class="token number">5223</span> <span class="token operator">|</span>  <span class="token number">544</span> <span class="token operator">|</span> <span class="token number">5767</span> <span class="token operator">|</span> <span class="token number">1002</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+------+</span>
<span class="token number">6</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="delete" tabindex="-1"><a class="header-anchor" href="#delete" aria-hidden="true">#</a> Delete</h5><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">#SQL DELETE è¯­å¥</span>
<span class="token keyword">DELETE</span> è¯­å¥ç”¨äºåˆ é™¤è¡¨ä¸­çš„è¡Œ
<span class="token comment">-- SQL DELETE è¯­æ³•</span>
<span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> table_name
<span class="token keyword">WHERE</span> some_column<span class="token operator">=</span>some_value<span class="token punctuation">;</span><span class="token comment">-- WHERE å­å¥è§„å®šå“ªæ¡è®°å½•æˆ–è€…å“ªäº›è®°å½•éœ€è¦åˆ é™¤ã€‚å¦‚æœæ‚¨çœç•¥äº† WHERE å­å¥ï¼Œæ‰€æœ‰çš„è®°å½•éƒ½å°†è¢«åˆ é™¤ï¼</span>

<span class="token comment">-- For instance</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp1<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> a    <span class="token operator">|</span> b    <span class="token operator">|</span> c    <span class="token operator">|</span> d    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+------+</span>
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span>  <span class="token number">100</span> <span class="token operator">|</span>  <span class="token number">200</span> <span class="token operator">|</span>  <span class="token number">300</span> <span class="token operator">|</span>   <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">2</span> <span class="token operator">|</span> <span class="token number">1000</span> <span class="token operator">|</span> <span class="token number">2000</span> <span class="token operator">|</span> <span class="token number">3000</span> <span class="token operator">|</span>   <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">3</span> <span class="token operator">|</span>  <span class="token number">120</span> <span class="token operator">|</span>  <span class="token number">520</span> <span class="token operator">|</span>  <span class="token number">640</span> <span class="token operator">|</span>   <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">4</span> <span class="token operator">|</span>  <span class="token number">120</span> <span class="token operator">|</span>  <span class="token number">520</span> <span class="token operator">|</span>  <span class="token number">640</span> <span class="token operator">|</span>   <span class="token number">40</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">5</span> <span class="token operator">|</span>  <span class="token number">120</span> <span class="token operator">|</span>  <span class="token number">520</span> <span class="token operator">|</span>  <span class="token number">640</span> <span class="token operator">|</span>   <span class="token number">50</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">6</span> <span class="token operator">|</span> <span class="token number">5223</span> <span class="token operator">|</span>  <span class="token number">544</span> <span class="token operator">|</span> <span class="token number">5767</span> <span class="token operator">|</span>   <span class="token number">60</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+------+</span>
<span class="token number">6</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">delete</span> <span class="token keyword">from</span> emp1 <span class="token keyword">where</span> d <span class="token operator">between</span> <span class="token number">40</span> <span class="token operator">and</span> <span class="token number">50</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">2</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp1<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> a    <span class="token operator">|</span> b    <span class="token operator">|</span> c    <span class="token operator">|</span> d    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+------+</span>
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span>  <span class="token number">100</span> <span class="token operator">|</span>  <span class="token number">200</span> <span class="token operator">|</span>  <span class="token number">300</span> <span class="token operator">|</span>   <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">2</span> <span class="token operator">|</span> <span class="token number">1000</span> <span class="token operator">|</span> <span class="token number">2000</span> <span class="token operator">|</span> <span class="token number">3000</span> <span class="token operator">|</span>   <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">3</span> <span class="token operator">|</span>  <span class="token number">120</span> <span class="token operator">|</span>  <span class="token number">520</span> <span class="token operator">|</span>  <span class="token number">640</span> <span class="token operator">|</span>   <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">6</span> <span class="token operator">|</span> <span class="token number">5223</span> <span class="token operator">|</span>  <span class="token number">544</span> <span class="token operator">|</span> <span class="token number">5767</span> <span class="token operator">|</span>   <span class="token number">60</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+------+</span>
<span class="token number">4</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

åˆ é™¤æ‰€æœ‰æ•°æ®
å¯ä»¥åœ¨ä¸åˆ é™¤è¡¨çš„æƒ…å†µä¸‹ï¼Œåˆ é™¤è¡¨ä¸­æ‰€æœ‰çš„è¡Œã€‚è¿™æ„å‘³ç€è¡¨ç»“æ„ã€å±æ€§ã€ç´¢å¼•å°†ä¿æŒä¸å˜ï¼š

<span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> table_name<span class="token punctuation">;</span>
æ³¨é‡Šï¼šåœ¨åˆ é™¤è®°å½•æ—¶è¦æ ¼å¤–å°å¿ƒï¼å› ä¸ºæ‚¨ä¸èƒ½é‡æ¥ï¼
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp1<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> a    <span class="token operator">|</span> b    <span class="token operator">|</span> c    <span class="token operator">|</span> d    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+------+</span>
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span>  <span class="token number">100</span> <span class="token operator">|</span>  <span class="token number">200</span> <span class="token operator">|</span>  <span class="token number">300</span> <span class="token operator">|</span>   <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">2</span> <span class="token operator">|</span> <span class="token number">1000</span> <span class="token operator">|</span> <span class="token number">2000</span> <span class="token operator">|</span> <span class="token number">3000</span> <span class="token operator">|</span>   <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">3</span> <span class="token operator">|</span>  <span class="token number">120</span> <span class="token operator">|</span>  <span class="token number">520</span> <span class="token operator">|</span>  <span class="token number">640</span> <span class="token operator">|</span>   <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">6</span> <span class="token operator">|</span> <span class="token number">5223</span> <span class="token operator">|</span>  <span class="token number">544</span> <span class="token operator">|</span> <span class="token number">5767</span> <span class="token operator">|</span>   <span class="token number">60</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+------+</span>
<span class="token number">4</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp2<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> a    <span class="token operator">|</span> b    <span class="token operator">|</span> sum  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+</span>
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span>   <span class="token number">22</span> <span class="token operator">|</span>   <span class="token number">33</span> <span class="token operator">|</span>   <span class="token number">55</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">2</span> <span class="token operator">|</span> <span class="token number">1000</span> <span class="token operator">|</span> <span class="token number">2000</span> <span class="token operator">|</span> <span class="token number">3000</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">3</span> <span class="token operator">|</span>  <span class="token number">120</span> <span class="token operator">|</span>  <span class="token number">520</span> <span class="token operator">|</span>  <span class="token number">640</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">4</span> <span class="token operator">|</span>  <span class="token number">120</span> <span class="token operator">|</span>  <span class="token number">520</span> <span class="token operator">|</span>  <span class="token number">640</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">5</span> <span class="token operator">|</span>  <span class="token number">120</span> <span class="token operator">|</span>  <span class="token number">520</span> <span class="token operator">|</span>  <span class="token number">640</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">6</span> <span class="token operator">|</span> <span class="token number">5223</span> <span class="token operator">|</span>  <span class="token number">544</span> <span class="token operator">|</span> <span class="token number">5767</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+</span>
<span class="token number">6</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">delete</span> <span class="token keyword">from</span> emp2<span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">6</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp2<span class="token punctuation">;</span>
Empty <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="selectâ˜…" tabindex="-1"><a class="header-anchor" href="#selectâ˜…" aria-hidden="true">#</a> Selectâ˜…</h5><h6 id="å•è¡¨" tabindex="-1"><a class="header-anchor" href="#å•è¡¨" aria-hidden="true">#</a> å•è¡¨</h6><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>åŸºæœ¬çš„<span class="token keyword">SELECT</span>è¯­å¥
<span class="token comment">#SELECT...</span>
<span class="token comment">#SELECT 1; #æ²¡æœ‰ä»»ä½•å­å¥</span>
<span class="token comment">#SELECT 9/2; #æ²¡æœ‰ä»»ä½•å­å¥</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp1<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> a    <span class="token operator">|</span> b    <span class="token operator">|</span> c    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+</span>
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span>  <span class="token number">100</span> <span class="token operator">|</span>  <span class="token number">200</span> <span class="token operator">|</span>  <span class="token number">300</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">2</span> <span class="token operator">|</span> <span class="token number">1000</span> <span class="token operator">|</span> <span class="token number">2000</span> <span class="token operator">|</span> <span class="token number">3000</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+</span>
<span class="token number">2</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token number">2000</span><span class="token punctuation">;</span><span class="token comment">-- æ²¡æœ‰ä»»ä½•å­å¥</span>
<span class="token operator">+</span><span class="token comment">------+</span>
<span class="token operator">|</span> <span class="token number">2000</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+</span>
<span class="token operator">|</span> <span class="token number">2000</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------------+</span>
<span class="token operator">|</span> <span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------+</span>
<span class="token operator">|</span> db02       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span>

<span class="token comment">#SELECT ... FROM--åœ¨selectåé¢å¯ä»¥ä½¿ç”¨è¡¨è¾¾å¼å¯¹æŸ¥è¯¢çš„åˆ—è¿›è¡Œè¿ç®— åŒæ—¶å¯ä½¿ç”¨ASç»™åˆ—å®šä¹‰ä¸€ä¸ªåˆ«å</span>
<span class="token keyword">SELECT</span> æ ‡è¯†é€‰æ‹©å“ªäº›åˆ—
<span class="token keyword">FROM</span> æ ‡è¯†ä»å“ªä¸ªè¡¨ä¸­é€‰æ‹©
<span class="token comment">#select * from è¡¨å è¿”å›æŒ‡å®šè¡¨çš„æ‰€æœ‰åˆ—</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp1<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> a    <span class="token operator">|</span> b    <span class="token operator">|</span> c    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+</span>
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span>  <span class="token number">100</span> <span class="token operator">|</span>  <span class="token number">200</span> <span class="token operator">|</span>  <span class="token number">300</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">2</span> <span class="token operator">|</span> <span class="token number">1000</span> <span class="token operator">|</span> <span class="token number">2000</span> <span class="token operator">|</span> <span class="token number">3000</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+</span>
<span class="token number">2</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

<span class="token comment">#SELECT department_id, location_id,(åˆ—å),(åˆ—æ˜) FROM departmentsï¼ˆè¡¨åï¼‰where ï¼ˆæ¡ä»¶ï¼‰;-- è¿”å›æŒ‡å®šè¡¨ä¸­æ»¡è¶³whereåæ¡ä»¶çš„çš„æŒ‡å®šåˆ—</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> id<span class="token punctuation">,</span>a<span class="token punctuation">,</span>b <span class="token keyword">from</span> emp1 <span class="token keyword">where</span> c<span class="token operator">=</span><span class="token number">3000</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+------+------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> a    <span class="token operator">|</span> b    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+------+------+</span>
<span class="token operator">|</span>    <span class="token number">2</span> <span class="token operator">|</span> <span class="token number">1000</span> <span class="token operator">|</span> <span class="token number">2000</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+------+------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

<span class="token comment">#select id,(a + b)--å¯ä»¥è¿›è¡Œè¿ç®— from emp2;-- è¿”å›æŒ‡å®šè¡¨ä¸­æŒ‡å®šåˆ—ä¸”æŒ‡å®šåˆ—ä¹‹é—´è¿ç®—çš„åˆ—-- åœ¨selectåé¢å¯ä»¥ä½¿ç”¨è¡¨è¾¾å¼å¯¹æŸ¥è¯¢çš„åˆ—è¿›è¡Œè¿ç®—</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> id<span class="token punctuation">,</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span> <span class="token keyword">from</span> emp2<span class="token punctuation">;</span>
Empty <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> id<span class="token punctuation">,</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span> <span class="token keyword">from</span> emp1<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+---------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> <span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+---------+</span>
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span>     <span class="token number">300</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">2</span> <span class="token operator">|</span>    <span class="token number">3000</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+---------+</span>
<span class="token number">2</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

<span class="token comment">#select id,(a + b)å¯ä»¥è¿›è¡Œè¿ç®— as &#39;sum&#39; é€šè¿‡ASç»™è¿ç®—åçš„åˆ—å®šä¹‰ä¸€ä¸ª&#39;åˆ«å&#39; from emp1;-- è¿”å›æŒ‡å®šè¡¨ä¸­æŒ‡å®šåˆ—ä¸”æŒ‡å®šåˆ—ä¹‹é—´è¿ç®—çš„å®šä¹‰åˆ«ååçš„åˆ—</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> id<span class="token punctuation">,</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">&#39;sum&#39;</span> <span class="token keyword">from</span> emp1<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> sum  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+------+</span>
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span>  <span class="token number">300</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">2</span> <span class="token operator">|</span> <span class="token number">3000</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+------+</span>
<span class="token number">2</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span>

<span class="token comment">-- ä½¿ç”¨WHERE å­å¥ï¼Œå°†ä¸æ»¡è¶³æ¡ä»¶çš„è¡Œè¿‡æ»¤æ‰</span>
<span class="token comment">-- WHEREå­å¥ç´§éš FROMå­å¥</span>
<span class="token keyword">SELECT</span> å­—æ®µ<span class="token number">1</span><span class="token punctuation">,</span>å­—æ®µ<span class="token number">2</span>
<span class="token keyword">FROM</span> è¡¨å
<span class="token keyword">WHERE</span> è¿‡æ»¤æ¡ä»¶
<span class="token comment">-- For instance:</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp1 <span class="token keyword">where</span> c<span class="token operator">&gt;=</span><span class="token number">640</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> a    <span class="token operator">|</span> b    <span class="token operator">|</span> c    <span class="token operator">|</span> d    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+------+</span>
<span class="token operator">|</span>    <span class="token number">2</span> <span class="token operator">|</span> <span class="token number">1000</span> <span class="token operator">|</span> <span class="token number">2000</span> <span class="token operator">|</span> <span class="token number">3000</span> <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">3</span> <span class="token operator">|</span>  <span class="token number">120</span> <span class="token operator">|</span>  <span class="token number">520</span> <span class="token operator">|</span>  <span class="token number">640</span> <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">4</span> <span class="token operator">|</span>  <span class="token number">120</span> <span class="token operator">|</span>  <span class="token number">520</span> <span class="token operator">|</span>  <span class="token number">640</span> <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">5</span> <span class="token operator">|</span>  <span class="token number">120</span> <span class="token operator">|</span>  <span class="token number">520</span> <span class="token operator">|</span>  <span class="token number">640</span> <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+------+</span>
<span class="token number">4</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span>

<span class="token comment">#åˆ—çš„åˆ«å</span>
<span class="token comment">-- é‡å‘½åä¸€ä¸ªåˆ—</span>
<span class="token comment">-- ä¾¿äºè®¡ç®—</span>
<span class="token comment">-- ç´§è·Ÿåˆ—åï¼Œä¹Ÿå¯ä»¥åœ¨åˆ—åå’Œåˆ«åä¹‹é—´åŠ å…¥å…³é”®å­—ASï¼Œåˆ«åä½¿ç”¨åŒå¼•å·ï¼Œä»¥ä¾¿åœ¨åˆ«åä¸­åŒ…å«ç©ºæ ¼æˆ–ç‰¹</span>
<span class="token comment">-- æ®Šçš„å­—ç¬¦å¹¶åŒºåˆ†å¤§å°å†™ã€‚</span>
<span class="token comment">-- AS å¯ä»¥çœç•¥</span>
<span class="token comment">-- å»ºè®®åˆ«åç®€çŸ­ï¼Œè§åçŸ¥æ„</span>
<span class="token comment">-- ä¸¾ä¾‹</span>
<span class="token keyword">SELECT</span> last_name <span class="token keyword">AS</span> name<span class="token punctuation">,</span> commission_pct comm
<span class="token keyword">FROM</span> employees<span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> id<span class="token punctuation">,</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">&#39;sum&#39;</span> <span class="token keyword">from</span> emp1<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> sum  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+------+</span>
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span>  <span class="token number">300</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">2</span> <span class="token operator">|</span> <span class="token number">3000</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+------+</span>
<span class="token number">2</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

<span class="token keyword">SELECT</span> last_name <span class="token string">&quot;Name&quot;</span><span class="token punctuation">,</span> salary<span class="token operator">*</span><span class="token number">12</span> <span class="token string">&quot;Annual Salary&quot;</span>
<span class="token keyword">FROM</span> employees<span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> id<span class="token punctuation">,</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">&quot;SumNumber&quot;</span> <span class="token keyword">from</span> emp1<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+-----------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> SumNumber <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+-----------+</span>
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span>       <span class="token number">300</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">2</span> <span class="token operator">|</span>      <span class="token number">3000</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+-----------+</span>
<span class="token number">2</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span>
<span class="token comment">-- é»˜è®¤æƒ…å†µä¸‹ï¼ŒæŸ¥è¯¢ä¼šè¿”å›å…¨éƒ¨è¡Œï¼ŒåŒ…æ‹¬é‡å¤è¡Œã€‚</span>

<span class="token comment">#å»é™¤é‡å¤è¡Œ</span>
<span class="token comment">#åœ¨SELECTè¯­å¥ä¸­ä½¿ç”¨å…³é”®å­—DISTINCTå»é™¤é‡å¤è¡Œ</span>
<span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> department_id<span class="token comment">-- æ­¤å¤„çš„åˆ—è¡¨ç¤ºè¦ä»¥å“ªäº›åˆ—ä»¥åŠå‡ ä¸ªåˆ—ä¸ºæ¡ä»¶åˆ¤æ–­æ˜¯å¦ä¸ºé‡å¤</span>
<span class="token keyword">FROM</span> employees<span class="token punctuation">;</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp1<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> a    <span class="token operator">|</span> b    <span class="token operator">|</span> c    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+</span>
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span>  <span class="token number">100</span> <span class="token operator">|</span>  <span class="token number">200</span> <span class="token operator">|</span>  <span class="token number">300</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">2</span> <span class="token operator">|</span> <span class="token number">1000</span> <span class="token operator">|</span> <span class="token number">2000</span> <span class="token operator">|</span> <span class="token number">3000</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">3</span> <span class="token operator">|</span>  <span class="token number">120</span> <span class="token operator">|</span>  <span class="token number">520</span> <span class="token operator">|</span>  <span class="token number">640</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">4</span> <span class="token operator">|</span>  <span class="token number">120</span> <span class="token operator">|</span>  <span class="token number">520</span> <span class="token operator">|</span>  <span class="token number">640</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">5</span> <span class="token operator">|</span>  <span class="token number">120</span> <span class="token operator">|</span>  <span class="token number">520</span> <span class="token operator">|</span>  <span class="token number">640</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+</span>
<span class="token number">5</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token keyword">distinct</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp1<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> a    <span class="token operator">|</span> b    <span class="token operator">|</span> c    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+</span>
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span>  <span class="token number">100</span> <span class="token operator">|</span>  <span class="token number">200</span> <span class="token operator">|</span>  <span class="token number">300</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">2</span> <span class="token operator">|</span> <span class="token number">1000</span> <span class="token operator">|</span> <span class="token number">2000</span> <span class="token operator">|</span> <span class="token number">3000</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">3</span> <span class="token operator">|</span>  <span class="token number">120</span> <span class="token operator">|</span>  <span class="token number">520</span> <span class="token operator">|</span>  <span class="token number">640</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">4</span> <span class="token operator">|</span>  <span class="token number">120</span> <span class="token operator">|</span>  <span class="token number">520</span> <span class="token operator">|</span>  <span class="token number">640</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">5</span> <span class="token operator">|</span>  <span class="token number">120</span> <span class="token operator">|</span>  <span class="token number">520</span> <span class="token operator">|</span>  <span class="token number">640</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+</span>
<span class="token number">5</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token keyword">distinct</span> a <span class="token keyword">from</span> emp1<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+</span>
<span class="token operator">|</span> a    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+</span>
<span class="token operator">|</span>  <span class="token number">100</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">1000</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">120</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+</span>
<span class="token number">3</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token keyword">distinct</span> id<span class="token punctuation">,</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c form emp1<span class="token punctuation">;</span>
ERROR <span class="token number">1064</span> <span class="token punctuation">(</span><span class="token number">42000</span><span class="token punctuation">)</span>: You have an error <span class="token operator">in</span> your <span class="token keyword">SQL</span> syntax<span class="token punctuation">;</span> <span class="token keyword">check</span> the manual that corresponds <span class="token keyword">to</span> your MySQL server version <span class="token keyword">for</span> the <span class="token keyword">right</span> syntax <span class="token keyword">to</span> <span class="token keyword">use</span> near <span class="token string">&#39;emp1&#39;</span> at line <span class="token number">1</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token keyword">distinct</span> id<span class="token punctuation">,</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c <span class="token keyword">from</span> emp1<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> a    <span class="token operator">|</span> b    <span class="token operator">|</span> c    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+</span>
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span>  <span class="token number">100</span> <span class="token operator">|</span>  <span class="token number">200</span> <span class="token operator">|</span>  <span class="token number">300</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">2</span> <span class="token operator">|</span> <span class="token number">1000</span> <span class="token operator">|</span> <span class="token number">2000</span> <span class="token operator">|</span> <span class="token number">3000</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">3</span> <span class="token operator">|</span>  <span class="token number">120</span> <span class="token operator">|</span>  <span class="token number">520</span> <span class="token operator">|</span>  <span class="token number">640</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">4</span> <span class="token operator">|</span>  <span class="token number">120</span> <span class="token operator">|</span>  <span class="token number">520</span> <span class="token operator">|</span>  <span class="token number">640</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">5</span> <span class="token operator">|</span>  <span class="token number">120</span> <span class="token operator">|</span>  <span class="token number">520</span> <span class="token operator">|</span>  <span class="token number">640</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+</span>
<span class="token number">5</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token keyword">distinct</span> c <span class="token keyword">from</span> emp1<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+</span>
<span class="token operator">|</span> c    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+</span>
<span class="token operator">|</span>  <span class="token number">300</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">3000</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">640</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+</span>
<span class="token number">3</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span>

<span class="token comment">#ç©ºå€¼å‚ä¸è¿ç®—</span>
<span class="token comment">-- æ³¨æ„ï¼Œåœ¨ MySQL é‡Œé¢ï¼Œ ç©ºå€¼ä¸ç­‰äºç©ºå­—ç¬¦ä¸²ã€‚ä¸€ä¸ªç©ºå­—ç¬¦ä¸²çš„é•¿åº¦æ˜¯ 0ï¼Œè€Œä¸€ä¸ªç©ºå€¼çš„é•¿åº¦æ˜¯ç©ºã€‚è€Œä¸”ï¼Œåœ¨ MySQL é‡Œé¢ï¼Œç©ºå€¼æ˜¯å ç”¨ç©ºé—´çš„</span>
<span class="token comment">#æ‰€æœ‰è¿ç®—ç¬¦æˆ–åˆ—å€¼é‡åˆ°nullå€¼ï¼Œè¿ç®—çš„ç»“æœéƒ½ä¸ºnull</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">alter</span> <span class="token keyword">table</span> emp1 <span class="token keyword">add</span> <span class="token punctuation">(</span>d <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>
Records: <span class="token number">0</span>  Duplicates: <span class="token number">0</span>  <span class="token keyword">Warnings</span>: <span class="token number">0</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp1<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> a    <span class="token operator">|</span> b    <span class="token operator">|</span> c    <span class="token operator">|</span> d    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+------+</span>
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span>  <span class="token number">100</span> <span class="token operator">|</span>  <span class="token number">200</span> <span class="token operator">|</span>  <span class="token number">300</span> <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">2</span> <span class="token operator">|</span> <span class="token number">1000</span> <span class="token operator">|</span> <span class="token number">2000</span> <span class="token operator">|</span> <span class="token number">3000</span> <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">3</span> <span class="token operator">|</span>  <span class="token number">120</span> <span class="token operator">|</span>  <span class="token number">520</span> <span class="token operator">|</span>  <span class="token number">640</span> <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">4</span> <span class="token operator">|</span>  <span class="token number">120</span> <span class="token operator">|</span>  <span class="token number">520</span> <span class="token operator">|</span>  <span class="token number">640</span> <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">5</span> <span class="token operator">|</span>  <span class="token number">120</span> <span class="token operator">|</span>  <span class="token number">520</span> <span class="token operator">|</span>  <span class="token number">640</span> <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+------+</span>
<span class="token number">5</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> id<span class="token punctuation">,</span><span class="token punctuation">(</span>c <span class="token operator">+</span> d<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">&#39;sum&#39;</span> <span class="token keyword">from</span> emp1<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> sum  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+------+</span>
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">2</span> <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">3</span> <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">4</span> <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">5</span> <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+------+</span>
<span class="token number">5</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span>

<span class="token comment">#ç€é‡å· ``</span>
<span class="token comment">-- æˆ‘ä»¬éœ€è¦ä¿è¯è¡¨ä¸­çš„å­—æ®µã€è¡¨åç­‰æ²¡æœ‰å’Œä¿ç•™å­—ã€æ•°æ®åº“ç³»ç»Ÿæˆ–å¸¸ç”¨æ–¹æ³•å†²çªã€‚å¦‚æœçœŸçš„ç›¸åŒï¼Œè¯·åœ¨SQLè¯­å¥ä¸­ä½¿ç”¨ä¸€å¯¹``ï¼ˆç€é‡å·ï¼‰å¼•èµ·æ¥</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> student5<span class="token punctuation">(</span>
    id <span class="token keyword">TINYINT</span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>password<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">,</span>birthday <span class="token keyword">DATA</span><span class="token punctuation">)</span>
    <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8 <span class="token keyword">COLLATE</span> utf8_bin <span class="token keyword">ENGINE</span> <span class="token keyword">INNODB</span>

<span class="token comment"># æ˜¾ç¤ºè¡¨ç»“æ„</span>
<span class="token comment">-- ä½¿ç”¨DESCRIBE æˆ– DESC å‘½ä»¤ï¼Œè¡¨ç¤ºè¡¨ç»“æ„</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">describe</span> emp1<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-------+------+------+-----+---------+-------------------+</span>
<span class="token operator">|</span> Field <span class="token operator">|</span> <span class="token keyword">Type</span> <span class="token operator">|</span> <span class="token boolean">Null</span> <span class="token operator">|</span> <span class="token keyword">Key</span> <span class="token operator">|</span> <span class="token keyword">Default</span> <span class="token operator">|</span> Extra             <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+------+------+-----+---------+-------------------+</span>
<span class="token operator">|</span> id    <span class="token operator">|</span> <span class="token keyword">int</span>  <span class="token operator">|</span> YES  <span class="token operator">|</span>     <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span>                   <span class="token operator">|</span>
<span class="token operator">|</span> a     <span class="token operator">|</span> <span class="token keyword">int</span>  <span class="token operator">|</span> YES  <span class="token operator">|</span>     <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span>                   <span class="token operator">|</span>
<span class="token operator">|</span> b     <span class="token operator">|</span> <span class="token keyword">int</span>  <span class="token operator">|</span> YES  <span class="token operator">|</span>     <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span>                   <span class="token operator">|</span>
<span class="token operator">|</span> c     <span class="token operator">|</span> <span class="token keyword">int</span>  <span class="token operator">|</span> YES  <span class="token operator">|</span>     <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span> VIRTUAL GENERATED <span class="token operator">|</span>
<span class="token operator">|</span> d     <span class="token operator">|</span> <span class="token keyword">int</span>  <span class="token operator">|</span> YES  <span class="token operator">|</span>     <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span>                   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+------+------+-----+---------+-------------------+</span>
<span class="token number">5</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span>
<span class="token comment">#å…¶ä¸­ï¼Œå„ä¸ªå­—æ®µçš„å«ä¹‰åˆ†åˆ«è§£é‡Šå¦‚ä¸‹ï¼š</span>
<span class="token comment">-- Fieldï¼šè¡¨ç¤ºå­—æ®µåç§°ã€‚</span>
<span class="token comment">-- Typeï¼šè¡¨ç¤ºå­—æ®µç±»å‹ï¼Œè¿™é‡Œ barcodeã€goodsname æ˜¯æ–‡æœ¬å‹çš„ï¼Œprice æ˜¯æ•´æ•°ç±»å‹çš„ã€‚</span>
<span class="token comment">-- Nullï¼šè¡¨ç¤ºè¯¥åˆ—æ˜¯å¦å¯ä»¥å­˜å‚¨NULLå€¼ã€‚</span>
<span class="token comment">-- Keyï¼šè¡¨ç¤ºè¯¥åˆ—æ˜¯å¦å·²ç¼–åˆ¶ç´¢å¼•ã€‚PRIè¡¨ç¤ºè¯¥åˆ—æ˜¯è¡¨ä¸»é”®çš„ä¸€éƒ¨åˆ†ï¼›UNIè¡¨ç¤ºè¯¥åˆ—æ˜¯UNIQUEç´¢å¼•çš„ä¸€éƒ¨åˆ†ï¼›MULè¡¨ç¤ºåœ¨åˆ—ä¸­æŸä¸ªç»™å®šå€¼å…è®¸å‡ºç°å¤šæ¬¡ã€‚</span>
<span class="token comment">-- Defaultï¼šè¡¨ç¤ºè¯¥åˆ—æ˜¯å¦æœ‰é»˜è®¤å€¼ï¼Œå¦‚æœæœ‰ï¼Œé‚£ä¹ˆå€¼æ˜¯å¤šå°‘ã€‚</span>
<span class="token comment">-- Extraï¼šè¡¨ç¤ºå¯ä»¥è·å–çš„ä¸ç»™å®šåˆ—æœ‰å…³çš„é™„åŠ ä¿¡æ¯ï¼Œä¾‹å¦‚AUTO_INCREMENTç­‰ã€‚</span>

<span class="token comment"># æ˜¾ç¤ºè¡¨çš„åˆ›å»ºä¿¡æ¯</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> <span class="token keyword">create</span> <span class="token keyword">from</span> emp1<span class="token punctuation">;</span>
ERROR <span class="token number">1064</span> <span class="token punctuation">(</span><span class="token number">42000</span><span class="token punctuation">)</span>: You have an error <span class="token operator">in</span> your <span class="token keyword">SQL</span> syntax<span class="token punctuation">;</span> <span class="token keyword">check</span> the manual that corresponds <span class="token keyword">to</span> your MySQL server version <span class="token keyword">for</span> the <span class="token keyword">right</span> syntax <span class="token keyword">to</span> <span class="token keyword">use</span> near <span class="token string">&#39;from emp1&#39;</span> at line <span class="token number">1</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> <span class="token keyword">create</span> db01<span class="token punctuation">;</span>
ERROR <span class="token number">1064</span> <span class="token punctuation">(</span><span class="token number">42000</span><span class="token punctuation">)</span>: You have an error <span class="token operator">in</span> your <span class="token keyword">SQL</span> syntax<span class="token punctuation">;</span> <span class="token keyword">check</span> the manual that corresponds <span class="token keyword">to</span> your MySQL server version <span class="token keyword">for</span> the <span class="token keyword">right</span> syntax <span class="token keyword">to</span> <span class="token keyword">use</span> near <span class="token string">&#39;db01&#39;</span> at line <span class="token number">1</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> <span class="token keyword">create</span> <span class="token keyword">table</span> emp1<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span class="token operator">|</span> <span class="token keyword">Table</span> <span class="token operator">|</span> <span class="token keyword">Create</span> <span class="token keyword">Table</span>                                                                                                                                                                                                       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span class="token operator">|</span> emp1  <span class="token operator">|</span> <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>emp1<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">int</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>a<span class="token punctuation">`</span></span> <span class="token keyword">int</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>b<span class="token punctuation">`</span></span> <span class="token keyword">int</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>c<span class="token punctuation">`</span></span> <span class="token keyword">int</span> GENERATED ALWAYS <span class="token keyword">AS</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>a<span class="token punctuation">`</span></span> <span class="token operator">+</span> <span class="token identifier"><span class="token punctuation">`</span>b<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span> VIRTUAL<span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>d<span class="token punctuation">`</span></span> <span class="token keyword">int</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb3 <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="selectè¯­å¥çš„whereå­å¥" tabindex="-1"><a class="header-anchor" href="#selectè¯­å¥çš„whereå­å¥" aria-hidden="true">#</a> <strong>Selectè¯­å¥çš„whereå­å¥</strong></h6><p><strong>where</strong>å¯ä»¥æŒ‡æ˜çº¦æŸæ¡ä»¶-- WHERE å­å¥ç”¨äºè¿‡æ»¤è®°å½•ã€‚</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">#SQL WHERE è¯­æ³•</span>
<span class="token keyword">SELECT</span> column_name<span class="token punctuation">,</span>column_name
<span class="token keyword">FROM</span> table_name
<span class="token keyword">WHERE</span> column_name operator <span class="token keyword">value</span><span class="token punctuation">;</span><span class="token comment">-- æŒ‡æ˜çº¦æŸæ¡ä»¶-- WHERE å­å¥ç”¨äºè¿‡æ»¤è®°å½•ã€‚</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>where</strong>å­å¥ä¸­çš„è¿ç®—ç¬¦</p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20220901125539476.png" alt="image-20220901125539476"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20220901130357689.png" alt="image-20220901130357689"></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">Where</span> <span class="token operator">+</span>æ¡ä»¶ï¼ˆç­›é€‰è¡Œï¼‰
æ¡ä»¶ï¼šåˆ—ï¼Œæ¯”è¾ƒè¿ç®—ç¬¦ï¼Œå€¼

æ¯”è¾ƒè¿ç®—ç¬¦åŒ…æ¶µï¼š<span class="token operator">=</span> <span class="token operator">&gt;</span> <span class="token operator">&lt;</span> <span class="token operator">&gt;=</span> <span class="token punctuation">,</span><span class="token operator">&lt;=</span><span class="token punctuation">,</span> <span class="token operator">!=</span><span class="token punctuation">,</span><span class="token operator">&lt;&gt;</span> è¡¨ç¤ºï¼ˆä¸ç­‰äºï¼‰

<span class="token keyword">Select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> ename<span class="token operator">=</span><span class="token string">&#39;SMITH&#39;</span><span class="token punctuation">;</span>
ä¾‹å­ä¸­çš„ SMITH ç”¨å•å¼•å·å¼•èµ·æ¥ï¼Œè¡¨ç¤ºæ˜¯å­—ç¬¦ä¸²ï¼Œå­—ç¬¦ä¸²è¦åŒºåˆ†å¤§å°å†™ã€‚

é€»è¾‘è¿ç®—
<span class="token operator">And</span>:ä¸ åŒæ—¶æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶çš„å€¼ã€‚

<span class="token keyword">Select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> sal <span class="token operator">&gt;</span> <span class="token number">2000</span> <span class="token operator">and</span> sal <span class="token operator">&lt;</span> <span class="token number">3000</span><span class="token punctuation">;</span>
æŸ¥è¯¢ EMP è¡¨ä¸­ SAL åˆ—ä¸­å¤§äº <span class="token number">2000</span> å°äº <span class="token number">3000</span> çš„å€¼ã€‚

<span class="token operator">Or</span>:æˆ– æ»¡è¶³å…¶ä¸­ä¸€ä¸ªæ¡ä»¶çš„å€¼

<span class="token keyword">Select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> sal <span class="token operator">&gt;</span> <span class="token number">2000</span> <span class="token operator">or</span> comm <span class="token operator">&gt;</span> <span class="token number">500</span><span class="token punctuation">;</span>
æŸ¥è¯¢ emp è¡¨ä¸­ SAL å¤§äº <span class="token number">2000</span> æˆ– COMM å¤§äº<span class="token number">500</span>çš„å€¼ã€‚

<span class="token operator">Not</span>:é æ»¡è¶³ä¸åŒ…å«è¯¥æ¡ä»¶çš„å€¼ã€‚

<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> <span class="token operator">not</span> sal <span class="token operator">&gt;</span> <span class="token number">1500</span><span class="token punctuation">;</span>
æŸ¥è¯¢EMPè¡¨ä¸­ sal å°äºç­‰äº <span class="token number">1500</span> çš„å€¼ã€‚

é€»è¾‘è¿ç®—çš„ä¼˜å…ˆçº§ï¼š

<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token operator">&gt;</span>  <span class="token operator">not</span>    <span class="token operator">&gt;</span>    <span class="token operator">and</span>    <span class="token operator">&gt;</span>     <span class="token operator">or</span>
ç‰¹æ®Šæ¡ä»¶
<span class="token number">1.</span>ç©ºå€¼åˆ¤æ–­ï¼šåˆ¤æ–­æ˜¯å¦ä¸ºç©º <span class="token operator">is</span> <span class="token boolean">null</span> â˜†<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>â˜†

<span class="token keyword">Select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> comm <span class="token operator">is</span> <span class="token boolean">null</span><span class="token punctuation">;</span>
æŸ¥è¯¢ emp è¡¨ä¸­ comm åˆ—ä¸­çš„ç©ºå€¼ã€‚

<span class="token number">2.</span><span class="token operator">between</span> <span class="token operator">and</span> <span class="token punctuation">(</span>åœ¨ ä¹‹é—´çš„å€¼<span class="token punctuation">)</span><span class="token comment">-- æ˜¯é—­åŒºé—´</span>

<span class="token keyword">Select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> sal <span class="token operator">between</span> <span class="token number">1500</span> <span class="token operator">and</span> <span class="token number">3000</span><span class="token punctuation">;</span>
æŸ¥è¯¢ emp è¡¨ä¸­ SAL åˆ—ä¸­å¤§äº <span class="token number">1500</span> çš„å°äº <span class="token number">3000</span> çš„å€¼ã€‚

æ³¨æ„ï¼šå¤§äºç­‰äº <span class="token number">1500</span> ä¸”å°äºç­‰äº <span class="token number">3000</span>ï¼Œ <span class="token number">1500</span> ä¸ºä¸‹é™ï¼Œ<span class="token number">3000</span> ä¸ºä¸Šé™ï¼Œä¸‹é™åœ¨å‰ï¼Œä¸Šé™åœ¨åï¼ŒæŸ¥è¯¢çš„èŒƒå›´åŒ…æ¶µæœ‰ä¸Šä¸‹é™çš„å€¼ã€‚

<span class="token number">3.</span><span class="token operator">In</span><span class="token comment">-- åœ¨ï¼ˆæ¡ä»¶,æ¡ä»¶ï¼Œæ¡ä»¶ï¼‰é‡Œé¢çš„</span>

<span class="token keyword">Select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> sal <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">,</span><span class="token number">3000</span><span class="token punctuation">,</span><span class="token number">1500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
æŸ¥è¯¢ EMP è¡¨ SAL åˆ—ä¸­ç­‰äº <span class="token number">5000</span>ï¼Œ<span class="token number">3000</span>ï¼Œ<span class="token number">1500</span> çš„å€¼ã€‚

<span class="token number">4.</span><span class="token operator">like</span>

<span class="token operator">Like</span>æ¨¡ç³ŠæŸ¥è¯¢

<span class="token keyword">Select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> ename <span class="token operator">like</span> <span class="token string">&#39;M%&#39;</span><span class="token punctuation">;</span>
æŸ¥è¯¢ EMP è¡¨ä¸­ Ename åˆ—ä¸­æœ‰ M çš„å€¼ï¼ŒM ä¸ºè¦æŸ¥è¯¢å†…å®¹ä¸­çš„æ¨¡ç³Šä¿¡æ¯ã€‚

 <span class="token operator">%</span> è¡¨ç¤ºå¤šä¸ªå­—å€¼ï¼Œ_ ä¸‹åˆ’çº¿è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ï¼›
 M<span class="token operator">%</span> : ä¸ºèƒ½é…ç¬¦ï¼Œæ­£åˆ™è¡¨è¾¾å¼ï¼Œè¡¨ç¤ºçš„æ„æ€ä¸ºæ¨¡ç³ŠæŸ¥è¯¢ä¿¡æ¯ä¸º M å¼€å¤´çš„ã€‚
 <span class="token operator">%</span>M<span class="token operator">%</span> : è¡¨ç¤ºæŸ¥è¯¢åŒ…å«Mçš„æ‰€æœ‰å†…å®¹ã€‚
 <span class="token operator">%</span>M_ : è¡¨ç¤ºæŸ¥è¯¢ä»¥Måœ¨å€’æ•°ç¬¬äºŒä½çš„æ‰€æœ‰å†…å®¹ã€‚
 
<span class="token comment">#ä¸å¸¦æ¯”è¾ƒè¿ç®—ç¬¦çš„ WHERE å­å¥ï¼š</span>

<span class="token keyword">WHERE</span> å­å¥å¹¶ä¸ä¸€å®šå¸¦æ¯”è¾ƒè¿ç®—ç¬¦ï¼Œå½“ä¸å¸¦è¿ç®—ç¬¦æ—¶ï¼Œä¼šæ‰§è¡Œä¸€ä¸ªéšå¼è½¬æ¢ã€‚å½“ <span class="token number">0</span> æ—¶è½¬åŒ–ä¸º <span class="token boolean">false</span>ï¼Œ<span class="token number">1</span> è½¬åŒ–ä¸º <span class="token boolean">true</span>ã€‚ä¾‹å¦‚ï¼š

<span class="token keyword">SELECT</span> studentNO <span class="token keyword">FROM</span> student <span class="token keyword">WHERE</span> <span class="token number">0</span>
åˆ™ä¼šè¿”å›ä¸€ä¸ªç©ºé›†ï¼Œå› ä¸ºæ¯ä¸€è¡Œè®°å½• <span class="token keyword">WHERE</span> éƒ½è¿”å› <span class="token boolean">false</span>ã€‚

<span class="token keyword">SELECT</span>  studentNO  <span class="token keyword">FROM</span> student <span class="token keyword">WHERE</span> <span class="token number">1</span>
è¿”å› student è¡¨æ‰€æœ‰è¡Œä¸­ studentNO åˆ—çš„å€¼ã€‚å› ä¸ºæ¯ä¸€è¡Œè®°å½• <span class="token keyword">WHERE</span> éƒ½è¿”å› <span class="token boolean">true</span>ã€‚

<span class="token comment">-- For instance</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp1 <span class="token keyword">where</span> <span class="token number">0</span><span class="token punctuation">;</span>
Empty <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp1 <span class="token keyword">where</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> a    <span class="token operator">|</span> b    <span class="token operator">|</span> c    <span class="token operator">|</span> d    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+------+</span>
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span>  <span class="token number">100</span> <span class="token operator">|</span>  <span class="token number">200</span> <span class="token operator">|</span>  <span class="token number">300</span> <span class="token operator">|</span>   <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">2</span> <span class="token operator">|</span> <span class="token number">1000</span> <span class="token operator">|</span> <span class="token number">2000</span> <span class="token operator">|</span> <span class="token number">3000</span> <span class="token operator">|</span>   <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">3</span> <span class="token operator">|</span>  <span class="token number">120</span> <span class="token operator">|</span>  <span class="token number">520</span> <span class="token operator">|</span>  <span class="token number">640</span> <span class="token operator">|</span>   <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">6</span> <span class="token operator">|</span> <span class="token number">5223</span> <span class="token operator">|</span>  <span class="token number">544</span> <span class="token operator">|</span> <span class="token number">5767</span> <span class="token operator">|</span>   <span class="token number">60</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+------+</span>
<span class="token number">4</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="selectè¯­å¥çš„group-byå­å¥" tabindex="-1"><a class="header-anchor" href="#selectè¯­å¥çš„group-byå­å¥" aria-hidden="true">#</a> <strong>Select</strong>è¯­å¥çš„<strong>group by</strong>å­å¥</h6><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span>
	skusav<span class="token punctuation">.</span>attr_id<span class="token punctuation">,</span><span class="token comment"># ä¸€å®šè¦ä¸è¿›è¡Œgroup byçš„å±æ€§å¯¹åº”</span>
	skusav<span class="token punctuation">.</span>attr_name<span class="token punctuation">,</span><span class="token comment"># ä¸€å®šè¦ä¸è¿›è¡Œgroup byçš„å±æ€§å¯¹åº”</span>
	GROUP_CONCAT<span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> skusav<span class="token punctuation">.</span>attr_value<span class="token punctuation">)</span> attr_values<span class="token comment"># ä½¿ç”¨GROUP_CONCATå‡½æ•°å¤„ç†æ— æ³•å¯¹åº” å´ä¸€å®šè¦æ˜¾ç¤ºçš„æ•°æ®</span>
<span class="token keyword">FROM</span>
	<span class="token identifier"><span class="token punctuation">`</span>pms_sku_info<span class="token punctuation">`</span></span> info
	<span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> <span class="token identifier"><span class="token punctuation">`</span>pms_sku_sale_attr_value<span class="token punctuation">`</span></span> skusav <span class="token keyword">ON</span> skusav<span class="token punctuation">.</span>sku_id <span class="token operator">=</span> info<span class="token punctuation">.</span>sku_id 
<span class="token keyword">WHERE</span>
	info<span class="token punctuation">.</span>spu_id <span class="token operator">=</span> <span class="token number">4</span> 
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span>
	skusav<span class="token punctuation">.</span>attr_id<span class="token punctuation">,</span><span class="token comment"># ä¸€å®šè¦ä¸æ˜¾ç¤ºçš„å±æ€§å¯¹åº”</span>
	skusav<span class="token punctuation">.</span>attr_name<span class="token punctuation">;</span><span class="token comment"># ä¸€å®šè¦ä¸æ˜¾ç¤ºçš„å±æ€§å¯¹åº”</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="selectè¯­å¥çš„order-byå­å¥" tabindex="-1"><a class="header-anchor" href="#selectè¯­å¥çš„order-byå­å¥" aria-hidden="true">#</a> <strong>Select</strong>è¯­å¥çš„<strong>order by</strong>å­å¥</h6><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">#SQL ORDER BY å…³é”®å­—</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> å…³é”®å­—ç”¨äºå¯¹ç»“æœé›†æŒ‰ç…§ä¸€ä¸ªåˆ—æˆ–è€…å¤šä¸ªåˆ—è¿›è¡Œæ’åºã€‚å¯ä»¥ä½¿ç”¨åˆ—çš„åˆ«åè¿›è¡Œæ’åº
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> å…³é”®å­—é»˜è®¤æŒ‰ç…§å‡åº<span class="token punctuation">(</span>ascend<span class="token punctuation">)</span>å¯¹è®°å½•è¿›è¡Œæ’åºã€‚å¦‚æœéœ€è¦æŒ‰ç…§é™åºå¯¹è®°å½•è¿›è¡Œæ’åºï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ <span class="token keyword">DESC</span> ï¼ˆdescendï¼‰é™åºå…³é”®å­—

<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> å¤šåˆ—çš„æ—¶å€™ï¼Œå…ˆæŒ‰ç…§ç¬¬ä¸€ä¸ª<span class="token keyword">column</span> nameæ’åºï¼Œåœ¨æŒ‰ç…§ç¬¬äºŒä¸ª<span class="token keyword">column</span> nameæ’åºï¼›å¦‚ä¸Šè¿°æ•™ç¨‹æœ€åä¸€ä¸ªä¾‹å­ï¼š

 <span class="token number">1</span>ï¼‰ã€å…ˆå°†countryå€¼è¿™ä¸€åˆ—æ’åºï¼ŒåŒä¸ºCNçš„æ’å‰é¢ï¼ŒåŒå±USAçš„æ’åé¢ï¼›
 <span class="token number">2</span>ï¼‰ã€ç„¶ååœ¨åŒå±CNçš„è¿™äº›å¤šè¡Œæ•°æ®ä¸­ï¼Œå†æ ¹æ®alexaå€¼çš„å¤§å°æ’åˆ—ã€‚
 <span class="token number">3</span>ï¼‰ã€<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> æ’åˆ—æ—¶ï¼Œä¸å†™æ˜<span class="token keyword">ASC</span> <span class="token keyword">DESC</span>çš„æ—¶å€™ï¼Œé»˜è®¤æ˜¯<span class="token keyword">ASC</span>
 
 <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> å¤šåˆ—çš„æ—¶å€™ï¼Œeg:

<span class="token keyword">order</span> <span class="token keyword">by</span> A<span class="token punctuation">,</span>B        è¿™ä¸ªæ—¶å€™éƒ½æ˜¯é»˜è®¤æŒ‰å‡åºæ’åˆ—
<span class="token keyword">order</span> <span class="token keyword">by</span> A <span class="token keyword">desc</span><span class="token punctuation">,</span>B   è¿™ä¸ªæ—¶å€™ A é™åºï¼ŒB å‡åºæ’åˆ—
<span class="token keyword">order</span> <span class="token keyword">by</span> A <span class="token punctuation">,</span>B <span class="token keyword">desc</span>  è¿™ä¸ªæ—¶å€™ A å‡åºï¼ŒB é™åºæ’åˆ—
å³ <span class="token keyword">desc</span> æˆ–è€… <span class="token keyword">asc</span> åªå¯¹å®ƒç´§è·Ÿç€çš„ç¬¬ä¸€ä¸ªåˆ—åæœ‰æ•ˆï¼Œå…¶ä»–ä¸å—å½±å“ï¼Œä»ç„¶æ˜¯é»˜è®¤çš„å‡åº
 
<span class="token comment">-- SQL ORDER BY è¯­æ³•</span>
<span class="token keyword">SELECT</span> column_name<span class="token punctuation">,</span>column_name
<span class="token keyword">FROM</span> table_name
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> column_name<span class="token punctuation">,</span>column_name <span class="token keyword">ASC</span><span class="token operator">|</span><span class="token keyword">DESC</span><span class="token punctuation">;</span><span class="token comment">-- é»˜è®¤ä½¿ç”¨ASCå‡åºè¿›è¡Œæ’åº å¯ä»¥æŒ‡å®šæ’åºæ–¹å¼</span>

<span class="token comment">-- For instance-- å•åˆ—</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp1 <span class="token keyword">order</span> <span class="token keyword">by</span> d<span class="token punctuation">;</span><span class="token comment">-- é»˜è®¤ä½¿ç”¨ASCå‡åºè¿›è¡Œæ’åº</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> a    <span class="token operator">|</span> b    <span class="token operator">|</span> c    <span class="token operator">|</span> d    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+------+</span>
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span>  <span class="token number">100</span> <span class="token operator">|</span>  <span class="token number">200</span> <span class="token operator">|</span>  <span class="token number">300</span> <span class="token operator">|</span>   <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">2</span> <span class="token operator">|</span> <span class="token number">1000</span> <span class="token operator">|</span> <span class="token number">2000</span> <span class="token operator">|</span> <span class="token number">3000</span> <span class="token operator">|</span>   <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">3</span> <span class="token operator">|</span>  <span class="token number">120</span> <span class="token operator">|</span>  <span class="token number">520</span> <span class="token operator">|</span>  <span class="token number">640</span> <span class="token operator">|</span>   <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">6</span> <span class="token operator">|</span> <span class="token number">5223</span> <span class="token operator">|</span>  <span class="token number">544</span> <span class="token operator">|</span> <span class="token number">5767</span> <span class="token operator">|</span>   <span class="token number">60</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+------+</span>
<span class="token number">4</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp1 <span class="token keyword">order</span> <span class="token keyword">by</span> c <span class="token keyword">desc</span><span class="token punctuation">;</span><span class="token comment">-- é»˜è®¤ä½¿ç”¨ASCå‡åºè¿›è¡Œæ’åº å¯ä»¥æŒ‡å®šæ’åºæ–¹å¼</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> a    <span class="token operator">|</span> b    <span class="token operator">|</span> c    <span class="token operator">|</span> d    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+------+</span>
<span class="token operator">|</span>    <span class="token number">6</span> <span class="token operator">|</span> <span class="token number">5223</span> <span class="token operator">|</span>  <span class="token number">544</span> <span class="token operator">|</span> <span class="token number">5767</span> <span class="token operator">|</span>   <span class="token number">60</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">2</span> <span class="token operator">|</span> <span class="token number">1000</span> <span class="token operator">|</span> <span class="token number">2000</span> <span class="token operator">|</span> <span class="token number">3000</span> <span class="token operator">|</span>   <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">3</span> <span class="token operator">|</span>  <span class="token number">120</span> <span class="token operator">|</span>  <span class="token number">520</span> <span class="token operator">|</span>  <span class="token number">640</span> <span class="token operator">|</span>   <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span>  <span class="token number">100</span> <span class="token operator">|</span>  <span class="token number">200</span> <span class="token operator">|</span>  <span class="token number">300</span> <span class="token operator">|</span>   <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+------+</span>
<span class="token number">4</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp1 <span class="token keyword">order</span> <span class="token keyword">by</span> c <span class="token keyword">DESC</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> a    <span class="token operator">|</span> b    <span class="token operator">|</span> c    <span class="token operator">|</span> d    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+------+</span>
<span class="token operator">|</span>    <span class="token number">6</span> <span class="token operator">|</span> <span class="token number">5223</span> <span class="token operator">|</span>  <span class="token number">544</span> <span class="token operator">|</span> <span class="token number">5767</span> <span class="token operator">|</span>   <span class="token number">60</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">2</span> <span class="token operator">|</span> <span class="token number">1000</span> <span class="token operator">|</span> <span class="token number">2000</span> <span class="token operator">|</span> <span class="token number">3000</span> <span class="token operator">|</span>   <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">7</span> <span class="token operator">|</span> <span class="token number">1000</span> <span class="token operator">|</span> <span class="token number">2000</span> <span class="token operator">|</span> <span class="token number">3000</span> <span class="token operator">|</span>   <span class="token number">40</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">3</span> <span class="token operator">|</span>  <span class="token number">120</span> <span class="token operator">|</span>  <span class="token number">520</span> <span class="token operator">|</span>  <span class="token number">640</span> <span class="token operator">|</span>   <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span>  <span class="token number">100</span> <span class="token operator">|</span>  <span class="token number">200</span> <span class="token operator">|</span>  <span class="token number">300</span> <span class="token operator">|</span>   <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+------+</span>
<span class="token number">5</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

<span class="token comment">-- For instance-- å¤šåˆ—</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp1 <span class="token keyword">order</span> <span class="token keyword">by</span> c<span class="token punctuation">,</span>d <span class="token keyword">desc</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> a    <span class="token operator">|</span> b    <span class="token operator">|</span> c    <span class="token operator">|</span> d    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+------+</span>
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span>  <span class="token number">100</span> <span class="token operator">|</span>  <span class="token number">200</span> <span class="token operator">|</span>  <span class="token number">300</span> <span class="token operator">|</span>   <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">3</span> <span class="token operator">|</span>  <span class="token number">120</span> <span class="token operator">|</span>  <span class="token number">520</span> <span class="token operator">|</span>  <span class="token number">640</span> <span class="token operator">|</span>   <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">7</span> <span class="token operator">|</span> <span class="token number">1000</span> <span class="token operator">|</span> <span class="token number">2000</span> <span class="token operator">|</span> <span class="token number">3000</span> <span class="token operator">|</span>   <span class="token number">40</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">2</span> <span class="token operator">|</span> <span class="token number">1000</span> <span class="token operator">|</span> <span class="token number">2000</span> <span class="token operator">|</span> <span class="token number">3000</span> <span class="token operator">|</span>   <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">6</span> <span class="token operator">|</span> <span class="token number">5223</span> <span class="token operator">|</span>  <span class="token number">544</span> <span class="token operator">|</span> <span class="token number">5767</span> <span class="token operator">|</span>   <span class="token number">60</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+------+</span>
<span class="token number">5</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp1 <span class="token keyword">order</span> <span class="token keyword">by</span> c <span class="token keyword">desc</span><span class="token punctuation">,</span>d <span class="token keyword">desc</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> a    <span class="token operator">|</span> b    <span class="token operator">|</span> c    <span class="token operator">|</span> d    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+------+</span>
<span class="token operator">|</span>    <span class="token number">6</span> <span class="token operator">|</span> <span class="token number">5223</span> <span class="token operator">|</span>  <span class="token number">544</span> <span class="token operator">|</span> <span class="token number">5767</span> <span class="token operator">|</span>   <span class="token number">60</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">7</span> <span class="token operator">|</span> <span class="token number">1000</span> <span class="token operator">|</span> <span class="token number">2000</span> <span class="token operator">|</span> <span class="token number">3000</span> <span class="token operator">|</span>   <span class="token number">40</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">2</span> <span class="token operator">|</span> <span class="token number">1000</span> <span class="token operator">|</span> <span class="token number">2000</span> <span class="token operator">|</span> <span class="token number">3000</span> <span class="token operator">|</span>   <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">3</span> <span class="token operator">|</span>  <span class="token number">120</span> <span class="token operator">|</span>  <span class="token number">520</span> <span class="token operator">|</span>  <span class="token number">640</span> <span class="token operator">|</span>   <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span>  <span class="token number">100</span> <span class="token operator">|</span>  <span class="token number">200</span> <span class="token operator">|</span>  <span class="token number">300</span> <span class="token operator">|</span>   <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+------+</span>
<span class="token number">5</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span>

<span class="token comment">#å¯ä»¥ä½¿ç”¨åˆ«åè¿›è¡Œæ’åº</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> id<span class="token punctuation">,</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">&#39;sum&#39;</span><span class="token punctuation">,</span>c<span class="token punctuation">,</span>d <span class="token keyword">from</span> emp1 <span class="token keyword">order</span> <span class="token keyword">by</span> sum <span class="token keyword">desc</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+------+------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> a    <span class="token operator">|</span> b    <span class="token operator">|</span> sum  <span class="token operator">|</span> c    <span class="token operator">|</span> d    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+------+------+</span>
<span class="token operator">|</span>    <span class="token number">6</span> <span class="token operator">|</span> <span class="token number">5223</span> <span class="token operator">|</span>  <span class="token number">544</span> <span class="token operator">|</span> <span class="token number">5767</span> <span class="token operator">|</span> <span class="token number">5767</span> <span class="token operator">|</span>   <span class="token number">60</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">2</span> <span class="token operator">|</span> <span class="token number">1000</span> <span class="token operator">|</span> <span class="token number">2000</span> <span class="token operator">|</span> <span class="token number">3000</span> <span class="token operator">|</span> <span class="token number">3000</span> <span class="token operator">|</span>   <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">7</span> <span class="token operator">|</span> <span class="token number">1000</span> <span class="token operator">|</span> <span class="token number">2000</span> <span class="token operator">|</span> <span class="token number">3000</span> <span class="token operator">|</span> <span class="token number">3000</span> <span class="token operator">|</span>   <span class="token number">40</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">3</span> <span class="token operator">|</span>  <span class="token number">120</span> <span class="token operator">|</span>  <span class="token number">520</span> <span class="token operator">|</span>  <span class="token number">640</span> <span class="token operator">|</span>  <span class="token number">640</span> <span class="token operator">|</span>   <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span>  <span class="token number">100</span> <span class="token operator">|</span>  <span class="token number">200</span> <span class="token operator">|</span>  <span class="token number">300</span> <span class="token operator">|</span>  <span class="token number">300</span> <span class="token operator">|</span>   <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+------+------+</span>
<span class="token number">5</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

<span class="token comment">#ç»¼åˆwhere &amp; AS &amp; åŒåˆ— &amp; åˆ—è¿ç®— æ¡ä»¶ä½¿ç”¨order by</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> id<span class="token punctuation">,</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">&#39;sum&#39;</span><span class="token punctuation">,</span>c<span class="token punctuation">,</span>d <span class="token keyword">from</span> emp1 <span class="token keyword">where</span> id <span class="token operator">between</span> <span class="token number">2</span> <span class="token operator">and</span> <span class="token number">6</span> <span class="token keyword">order</span> <span class="token keyword">by</span> sum <span class="token keyword">desc</span><span class="token punctuation">,</span>d <span class="token keyword">desc</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+------+------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> a    <span class="token operator">|</span> b    <span class="token operator">|</span> sum  <span class="token operator">|</span> c    <span class="token operator">|</span> d    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+------+------+</span>
<span class="token operator">|</span>    <span class="token number">6</span> <span class="token operator">|</span> <span class="token number">5223</span> <span class="token operator">|</span>  <span class="token number">544</span> <span class="token operator">|</span> <span class="token number">5767</span> <span class="token operator">|</span> <span class="token number">5767</span> <span class="token operator">|</span>   <span class="token number">60</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">2</span> <span class="token operator">|</span> <span class="token number">1000</span> <span class="token operator">|</span> <span class="token number">2000</span> <span class="token operator">|</span> <span class="token number">3000</span> <span class="token operator">|</span> <span class="token number">3000</span> <span class="token operator">|</span>   <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">3</span> <span class="token operator">|</span>  <span class="token number">120</span> <span class="token operator">|</span>  <span class="token number">520</span> <span class="token operator">|</span>  <span class="token number">640</span> <span class="token operator">|</span>  <span class="token number">640</span> <span class="token operator">|</span>   <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+------+------+------+------+------+</span>
<span class="token number">3</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="å•è¡¨æŸ¥è¯¢åŠ å¼º-group-by" tabindex="-1"><a class="header-anchor" href="#å•è¡¨æŸ¥è¯¢åŠ å¼º-group-by" aria-hidden="true">#</a> å•è¡¨æŸ¥è¯¢åŠ å¼ºï¼ˆGroup By ...ï¼‰</h6><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">-- selectè¯­å¥é¡ºåº group by - having - order by - limit</span>
<span class="token keyword">select</span> <span class="token string">&#39;åˆ—å&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;åˆ—å&#39;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">from</span> <span class="token string">&#39;è¡¨å&#39;</span>
<span class="token keyword">group</span> <span class="token keyword">by</span> <span class="token identifier"><span class="token punctuation">`</span>åˆ—<span class="token punctuation">`</span></span>
<span class="token keyword">having</span> <span class="token identifier"><span class="token punctuation">`</span>condition<span class="token punctuation">`</span></span>
<span class="token keyword">order</span> <span class="token keyword">by</span> <span class="token identifier"><span class="token punctuation">`</span>åˆ—<span class="token punctuation">`</span></span>
<span class="token keyword">limit</span> <span class="token identifier"><span class="token punctuation">`</span>start<span class="token punctuation">`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>rows<span class="token punctuation">`</span></span><span class="token punctuation">;</span>
<span class="token comment">-- For instance ç»Ÿè®¡å„ä¸ªéƒ¨é—¨çš„å¹³å‡å·¥èµ„ä»…ä¿ç•™2ä½å°æ•°ï¼Œå¹¶ä¸”&gt;1000,å¹³å‡å·¥èµ„æŒ‰ç…§é™åºæ’åºï¼Œå¹¶å–å‡ºå‰ä¸¤è¡Œ;</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token function">format</span><span class="token punctuation">(</span><span class="token function">avg</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>deptno <span class="token keyword">from</span> emp
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">group</span> <span class="token keyword">by</span> deptno
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">having</span> <span class="token function">avg</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">1000</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">order</span> <span class="token keyword">by</span> <span class="token function">avg</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span> <span class="token keyword">desc</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">limit</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">--------------------+--------+</span>
<span class="token operator">|</span> <span class="token function">format</span><span class="token punctuation">(</span><span class="token function">avg</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">|</span> deptno <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------------+--------+</span>
<span class="token operator">|</span> <span class="token number">2</span><span class="token punctuation">,</span><span class="token number">916.67</span>           <span class="token operator">|</span>     <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2</span><span class="token punctuation">,</span><span class="token number">443.75</span>           <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------------+--------+</span>
<span class="token number">2</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>


<span class="token comment">#ç»“åˆwhereå­å¥å¯¹dateè¿›è¡Œæ¡ä»¶ç­›é€‰</span>
<span class="token comment">-- æŸ¥è¯¢1991-01-01åå…¥èŒçš„å‘˜å·¥</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> ename<span class="token punctuation">,</span>hiredate <span class="token keyword">from</span> emp <span class="token keyword">where</span> hiredate<span class="token operator">&gt;</span><span class="token string">&#39;1992-01-01&#39;</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">--------+------------+</span>
<span class="token operator">|</span> ename  <span class="token operator">|</span> hiredate   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------+------------+</span>
<span class="token operator">|</span> SCOTT  <span class="token operator">|</span> <span class="token number">1997</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">19</span> <span class="token operator">|</span>
<span class="token operator">|</span> MILLER <span class="token operator">|</span> <span class="token number">1992</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">23</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------+------------+</span>
<span class="token number">2</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

<span class="token comment">#Likeæ¨¡ç³ŠæŸ¥è¯¢</span>

<span class="token keyword">Select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> ename <span class="token operator">like</span> <span class="token string">&#39;M%&#39;</span><span class="token punctuation">;</span>
æŸ¥è¯¢ EMP è¡¨ä¸­ Ename åˆ—ä¸­æœ‰ M çš„å€¼ï¼ŒM ä¸ºè¦æŸ¥è¯¢å†…å®¹ä¸­çš„æ¨¡ç³Šä¿¡æ¯ã€‚

 <span class="token operator">%</span> è¡¨ç¤ºå¤šä¸ªå­—å€¼ï¼Œ_ ä¸‹åˆ’çº¿è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ï¼›
 M<span class="token operator">%</span> : ä¸ºèƒ½é…ç¬¦ï¼Œæ­£åˆ™è¡¨è¾¾å¼ï¼Œè¡¨ç¤ºçš„æ„æ€ä¸ºæ¨¡ç³ŠæŸ¥è¯¢ä¿¡æ¯ä¸º M å¼€å¤´çš„ã€‚
 <span class="token operator">%</span>M<span class="token operator">%</span> : è¡¨ç¤ºæŸ¥è¯¢åŒ…å«Mçš„æ‰€æœ‰å†…å®¹ã€‚
 <span class="token operator">%</span>M_ : è¡¨ç¤ºæŸ¥è¯¢ä»¥Måœ¨å€’æ•°ç¬¬äºŒä½çš„æ‰€æœ‰å†…å®¹ã€‚
 
 <span class="token comment">-- For instance æ˜¾ç¤ºå§“åé¦–å­—æ¯ä¸ºSçš„å‘˜å·¥åŠå…¶å·¥èµ„</span>
 mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> ename<span class="token punctuation">,</span>sal <span class="token keyword">from</span> emp <span class="token keyword">where</span> ename <span class="token operator">like</span> <span class="token string">&#39;S%&#39;</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-------+---------+</span>
<span class="token operator">|</span> ename <span class="token operator">|</span> sal     <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+---------+</span>
<span class="token operator">|</span> SMITH <span class="token operator">|</span>  <span class="token number">800.00</span> <span class="token operator">|</span>
<span class="token operator">|</span> SCOTT <span class="token operator">|</span> <span class="token number">3000.00</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+---------+</span>
<span class="token number">2</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
<span class="token comment">-- For instance æ˜¾ç¤ºå§“åç¬¬ä¸‰ä¸ªå­—æ¯ä¸ºOçš„å‘˜å·¥åŠå…¶å·¥èµ„</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> ename<span class="token punctuation">,</span> sal <span class="token keyword">from</span> emp <span class="token keyword">where</span> ename <span class="token operator">like</span> <span class="token string">&#39;__O%&#39;</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-------+---------+</span>
<span class="token operator">|</span> ename <span class="token operator">|</span> sal     <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+---------+</span>
<span class="token operator">|</span> SCOTT <span class="token operator">|</span> <span class="token number">3000.00</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+---------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

<span class="token comment">#is null åˆ¤æ–­æ˜¯å¦ä¸ºnullå€¼</span>
<span class="token comment">-- For instance æ˜¾ç¤ºæ²¡æœ‰ä¸Šçº§çš„å‘˜å·¥ä¿¡æ¯ï¼ˆä¸Šçº§ç¼–å·mgrä¸ºnullçš„ï¼‰</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> mgr <span class="token operator">is</span> <span class="token boolean">null</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-------+-------+-----------+------+------------+---------+------+--------+</span>
<span class="token operator">|</span> empno <span class="token operator">|</span> ename <span class="token operator">|</span> job       <span class="token operator">|</span> mgr  <span class="token operator">|</span> hiredate   <span class="token operator">|</span> sal     <span class="token operator">|</span> comm <span class="token operator">|</span> deptno <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+-------+-----------+------+------------+---------+------+--------+</span>
<span class="token operator">|</span>  <span class="token number">7839</span> <span class="token operator">|</span> KING  <span class="token operator">|</span> president <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">17</span> <span class="token operator">|</span> <span class="token number">5000.00</span> <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+-------+-----------+------+------------+---------+------+--------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

<span class="token comment">#order by æ’åº-- é»˜è®¤å‡åºï¼ˆä¸æŒ‡æ˜descå³ä¸ºascï¼‰</span>
<span class="token comment">-- For instance</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">order</span> <span class="token keyword">by</span> sal <span class="token keyword">asc</span><span class="token punctuation">;</span><span class="token comment">-- é»˜è®¤å‡åºï¼ˆä¸æŒ‡æ˜descå³ä¸ºascï¼‰</span>
<span class="token operator">+</span><span class="token comment">-------+--------+-----------+------+------------+---------+---------+--------+</span>
<span class="token operator">|</span> empno <span class="token operator">|</span> ename  <span class="token operator">|</span> job       <span class="token operator">|</span> mgr  <span class="token operator">|</span> hiredate   <span class="token operator">|</span> sal     <span class="token operator">|</span> comm    <span class="token operator">|</span> deptno <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+--------+-----------+------+------------+---------+---------+--------+</span>
<span class="token operator">|</span>  <span class="token number">7369</span> <span class="token operator">|</span> SMITH  <span class="token operator">|</span> clerk     <span class="token operator">|</span> <span class="token number">7902</span> <span class="token operator">|</span> <span class="token number">1990</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">17</span> <span class="token operator">|</span>  <span class="token number">800.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7900</span> <span class="token operator">|</span> JAMES  <span class="token operator">|</span> clerk     <span class="token operator">|</span> <span class="token number">7698</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">03</span> <span class="token operator">|</span>  <span class="token number">950.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7521</span> <span class="token operator">|</span> WARD   <span class="token operator">|</span> salesman  <span class="token operator">|</span> <span class="token number">7698</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">22</span> <span class="token operator">|</span> <span class="token number">1250.00</span> <span class="token operator">|</span>  <span class="token number">500.00</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7654</span> <span class="token operator">|</span> MARTIN <span class="token operator">|</span> salesman  <span class="token operator">|</span> <span class="token number">7698</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">28</span> <span class="token operator">|</span> <span class="token number">1250.00</span> <span class="token operator">|</span> <span class="token number">1400.00</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7934</span> <span class="token operator">|</span> MILLER <span class="token operator">|</span> clerk     <span class="token operator">|</span> <span class="token number">7782</span> <span class="token operator">|</span> <span class="token number">1992</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">23</span> <span class="token operator">|</span> <span class="token number">1300.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7844</span> <span class="token operator">|</span> TURNER <span class="token operator">|</span> salesman  <span class="token operator">|</span> <span class="token number">7698</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">08</span> <span class="token operator">|</span> <span class="token number">1500.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7499</span> <span class="token operator">|</span> ALLEN  <span class="token operator">|</span> salesman  <span class="token operator">|</span> <span class="token number">7698</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">20</span> <span class="token operator">|</span> <span class="token number">1600.00</span> <span class="token operator">|</span>  <span class="token number">300.00</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7782</span> <span class="token operator">|</span> CLARK  <span class="token operator">|</span> manager   <span class="token operator">|</span> <span class="token number">7839</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">09</span> <span class="token operator">|</span> <span class="token number">2450.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7698</span> <span class="token operator">|</span> BLAKE  <span class="token operator">|</span> manager   <span class="token operator">|</span> <span class="token number">7839</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">01</span> <span class="token operator">|</span> <span class="token number">2850.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7566</span> <span class="token operator">|</span> JONES  <span class="token operator">|</span> manager   <span class="token operator">|</span> <span class="token number">7839</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">02</span> <span class="token operator">|</span> <span class="token number">2975.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7788</span> <span class="token operator">|</span> SCOTT  <span class="token operator">|</span> analyst   <span class="token operator">|</span> <span class="token number">7566</span> <span class="token operator">|</span> <span class="token number">1997</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">19</span> <span class="token operator">|</span> <span class="token number">3000.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7902</span> <span class="token operator">|</span> FORD   <span class="token operator">|</span> analyst   <span class="token operator">|</span> <span class="token number">7566</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">03</span> <span class="token operator">|</span> <span class="token number">3000.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7839</span> <span class="token operator">|</span> KING   <span class="token operator">|</span> president <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">17</span> <span class="token operator">|</span> <span class="token number">5000.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+--------+-----------+------+------------+---------+---------+--------+</span>
<span class="token number">13</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">order</span> <span class="token keyword">by</span> sal <span class="token keyword">desc</span><span class="token punctuation">;</span><span class="token comment">-- é»˜è®¤å‡åºï¼ˆä¸æŒ‡æ˜descå³ä¸ºascï¼‰</span>
<span class="token operator">+</span><span class="token comment">-------+--------+-----------+------+------------+---------+---------+--------+</span>
<span class="token operator">|</span> empno <span class="token operator">|</span> ename  <span class="token operator">|</span> job       <span class="token operator">|</span> mgr  <span class="token operator">|</span> hiredate   <span class="token operator">|</span> sal     <span class="token operator">|</span> comm    <span class="token operator">|</span> deptno <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+--------+-----------+------+------------+---------+---------+--------+</span>
<span class="token operator">|</span>  <span class="token number">7839</span> <span class="token operator">|</span> KING   <span class="token operator">|</span> president <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">17</span> <span class="token operator">|</span> <span class="token number">5000.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7788</span> <span class="token operator">|</span> SCOTT  <span class="token operator">|</span> analyst   <span class="token operator">|</span> <span class="token number">7566</span> <span class="token operator">|</span> <span class="token number">1997</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">19</span> <span class="token operator">|</span> <span class="token number">3000.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7902</span> <span class="token operator">|</span> FORD   <span class="token operator">|</span> analyst   <span class="token operator">|</span> <span class="token number">7566</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">03</span> <span class="token operator">|</span> <span class="token number">3000.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7566</span> <span class="token operator">|</span> JONES  <span class="token operator">|</span> manager   <span class="token operator">|</span> <span class="token number">7839</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">02</span> <span class="token operator">|</span> <span class="token number">2975.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7698</span> <span class="token operator">|</span> BLAKE  <span class="token operator">|</span> manager   <span class="token operator">|</span> <span class="token number">7839</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">01</span> <span class="token operator">|</span> <span class="token number">2850.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7782</span> <span class="token operator">|</span> CLARK  <span class="token operator">|</span> manager   <span class="token operator">|</span> <span class="token number">7839</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">09</span> <span class="token operator">|</span> <span class="token number">2450.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7499</span> <span class="token operator">|</span> ALLEN  <span class="token operator">|</span> salesman  <span class="token operator">|</span> <span class="token number">7698</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">20</span> <span class="token operator">|</span> <span class="token number">1600.00</span> <span class="token operator">|</span>  <span class="token number">300.00</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7844</span> <span class="token operator">|</span> TURNER <span class="token operator">|</span> salesman  <span class="token operator">|</span> <span class="token number">7698</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">08</span> <span class="token operator">|</span> <span class="token number">1500.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7934</span> <span class="token operator">|</span> MILLER <span class="token operator">|</span> clerk     <span class="token operator">|</span> <span class="token number">7782</span> <span class="token operator">|</span> <span class="token number">1992</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">23</span> <span class="token operator">|</span> <span class="token number">1300.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7521</span> <span class="token operator">|</span> WARD   <span class="token operator">|</span> salesman  <span class="token operator">|</span> <span class="token number">7698</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">22</span> <span class="token operator">|</span> <span class="token number">1250.00</span> <span class="token operator">|</span>  <span class="token number">500.00</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7654</span> <span class="token operator">|</span> MARTIN <span class="token operator">|</span> salesman  <span class="token operator">|</span> <span class="token number">7698</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">28</span> <span class="token operator">|</span> <span class="token number">1250.00</span> <span class="token operator">|</span> <span class="token number">1400.00</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7900</span> <span class="token operator">|</span> JAMES  <span class="token operator">|</span> clerk     <span class="token operator">|</span> <span class="token number">7698</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">03</span> <span class="token operator">|</span>  <span class="token number">950.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7369</span> <span class="token operator">|</span> SMITH  <span class="token operator">|</span> clerk     <span class="token operator">|</span> <span class="token number">7902</span> <span class="token operator">|</span> <span class="token number">1990</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">17</span> <span class="token operator">|</span>  <span class="token number">800.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+--------+-----------+------+------------+---------+---------+--------+</span>
<span class="token number">13</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

<span class="token comment">-- å…ˆæŒ‰ç…§éƒ¨é—¨ç¼–å·å‡åºç„¶åæŒ‰ç…§å·¥èµ„é™åºæ’åºæ˜¾ç¤ºå‘˜å·¥ä¿¡æ¯</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">order</span> <span class="token keyword">by</span> deptno <span class="token keyword">asc</span> <span class="token punctuation">,</span> sal <span class="token keyword">desc</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-------+--------+-----------+------+------------+---------+---------+--------+</span>
<span class="token operator">|</span> empno <span class="token operator">|</span> ename  <span class="token operator">|</span> job       <span class="token operator">|</span> mgr  <span class="token operator">|</span> hiredate   <span class="token operator">|</span> sal     <span class="token operator">|</span> comm    <span class="token operator">|</span> deptno <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+--------+-----------+------+------------+---------+---------+--------+</span>
<span class="token operator">|</span>  <span class="token number">7839</span> <span class="token operator">|</span> KING   <span class="token operator">|</span> president <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">17</span> <span class="token operator">|</span> <span class="token number">5000.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7782</span> <span class="token operator">|</span> CLARK  <span class="token operator">|</span> manager   <span class="token operator">|</span> <span class="token number">7839</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">09</span> <span class="token operator">|</span> <span class="token number">2450.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7934</span> <span class="token operator">|</span> MILLER <span class="token operator">|</span> clerk     <span class="token operator">|</span> <span class="token number">7782</span> <span class="token operator">|</span> <span class="token number">1992</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">23</span> <span class="token operator">|</span> <span class="token number">1300.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7788</span> <span class="token operator">|</span> SCOTT  <span class="token operator">|</span> analyst   <span class="token operator">|</span> <span class="token number">7566</span> <span class="token operator">|</span> <span class="token number">1997</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">19</span> <span class="token operator">|</span> <span class="token number">3000.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7902</span> <span class="token operator">|</span> FORD   <span class="token operator">|</span> analyst   <span class="token operator">|</span> <span class="token number">7566</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">03</span> <span class="token operator">|</span> <span class="token number">3000.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7566</span> <span class="token operator">|</span> JONES  <span class="token operator">|</span> manager   <span class="token operator">|</span> <span class="token number">7839</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">02</span> <span class="token operator">|</span> <span class="token number">2975.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7369</span> <span class="token operator">|</span> SMITH  <span class="token operator">|</span> clerk     <span class="token operator">|</span> <span class="token number">7902</span> <span class="token operator">|</span> <span class="token number">1990</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">17</span> <span class="token operator">|</span>  <span class="token number">800.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7698</span> <span class="token operator">|</span> BLAKE  <span class="token operator">|</span> manager   <span class="token operator">|</span> <span class="token number">7839</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">01</span> <span class="token operator">|</span> <span class="token number">2850.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7499</span> <span class="token operator">|</span> ALLEN  <span class="token operator">|</span> salesman  <span class="token operator">|</span> <span class="token number">7698</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">20</span> <span class="token operator">|</span> <span class="token number">1600.00</span> <span class="token operator">|</span>  <span class="token number">300.00</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7844</span> <span class="token operator">|</span> TURNER <span class="token operator">|</span> salesman  <span class="token operator">|</span> <span class="token number">7698</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">08</span> <span class="token operator">|</span> <span class="token number">1500.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7521</span> <span class="token operator">|</span> WARD   <span class="token operator">|</span> salesman  <span class="token operator">|</span> <span class="token number">7698</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">22</span> <span class="token operator">|</span> <span class="token number">1250.00</span> <span class="token operator">|</span>  <span class="token number">500.00</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7654</span> <span class="token operator">|</span> MARTIN <span class="token operator">|</span> salesman  <span class="token operator">|</span> <span class="token number">7698</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">28</span> <span class="token operator">|</span> <span class="token number">1250.00</span> <span class="token operator">|</span> <span class="token number">1400.00</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7900</span> <span class="token operator">|</span> JAMES  <span class="token operator">|</span> clerk     <span class="token operator">|</span> <span class="token number">7698</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">03</span> <span class="token operator">|</span>  <span class="token number">950.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+--------+-----------+------+------------+---------+---------+--------+</span>
<span class="token number">13</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

<span class="token comment">#åˆ†é¡µæŸ¥è¯¢limit</span>
<span class="token comment">-- åŸºæœ¬è¯­æ³•select...limit startï¼Œrows ä»start + 1è¡Œå¼€å§‹ å–å‡ºrowsè¡Œ startä»0å¼€å§‹è®¡ç®—</span>
<span class="token comment">-- LIMIT 1 OFFSET 1</span>

<span class="token comment">--  The [offset_value] specifies the offset of the first row to return. The offset of the first row is 0, not 1.</span>
<span class="token comment">--  The [row_count] specifies the maximum number of rows to return.</span>

<span class="token comment">-- limit æ¯é¡µæ˜¾è¦æ˜¾ç¤ºçš„è¡Œæ•° *ï¼ˆç¬¬å‡ é¡µ - 1ï¼‰ï¼Œæ¯é¡µæ˜¾è¦æ˜¾ç¤ºçš„è¡Œæ•°</span>
<span class="token comment">-- ç¬¬1é¡µ</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">order</span> <span class="token keyword">by</span> sal <span class="token keyword">desc</span> <span class="token keyword">limit</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">;</span><span class="token comment">-- limit æ¯é¡µæ˜¾è¦æ˜¾ç¤ºçš„è¡Œæ•° *ï¼ˆç¬¬å‡ é¡µ - 1ï¼‰ï¼Œæ¯é¡µæ˜¾è¦æ˜¾ç¤ºçš„è¡Œæ•°</span>
<span class="token operator">+</span><span class="token comment">-------+-------+-----------+------+------------+---------+------+--------+</span>
<span class="token operator">|</span> empno <span class="token operator">|</span> ename <span class="token operator">|</span> job       <span class="token operator">|</span> mgr  <span class="token operator">|</span> hiredate   <span class="token operator">|</span> sal     <span class="token operator">|</span> comm <span class="token operator">|</span> deptno <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+-------+-----------+------+------------+---------+------+--------+</span>
<span class="token operator">|</span>  <span class="token number">7839</span> <span class="token operator">|</span> KING  <span class="token operator">|</span> president <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">17</span> <span class="token operator">|</span> <span class="token number">5000.00</span> <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7788</span> <span class="token operator">|</span> SCOTT <span class="token operator">|</span> analyst   <span class="token operator">|</span> <span class="token number">7566</span> <span class="token operator">|</span> <span class="token number">1997</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">19</span> <span class="token operator">|</span> <span class="token number">3000.00</span> <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7902</span> <span class="token operator">|</span> FORD  <span class="token operator">|</span> analyst   <span class="token operator">|</span> <span class="token number">7566</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">03</span> <span class="token operator">|</span> <span class="token number">3000.00</span> <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7566</span> <span class="token operator">|</span> JONES <span class="token operator">|</span> manager   <span class="token operator">|</span> <span class="token number">7839</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">02</span> <span class="token operator">|</span> <span class="token number">2975.00</span> <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7698</span> <span class="token operator">|</span> BLAKE <span class="token operator">|</span> manager   <span class="token operator">|</span> <span class="token number">7839</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">01</span> <span class="token operator">|</span> <span class="token number">2850.00</span> <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+-------+-----------+------+------------+---------+------+--------+</span>
<span class="token number">5</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
<span class="token comment">-- ç¬¬äºŒé¡µ</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">order</span> <span class="token keyword">by</span> sal <span class="token keyword">desc</span> <span class="token keyword">limit</span> <span class="token number">5</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">;</span><span class="token comment">-- limit æ¯é¡µæ˜¾è¦æ˜¾ç¤ºçš„è¡Œæ•° *ï¼ˆç¬¬å‡ é¡µ - 1ï¼‰ï¼Œæ¯é¡µæ˜¾è¦æ˜¾ç¤ºçš„è¡Œæ•°</span>
<span class="token operator">+</span><span class="token comment">-------+--------+----------+------+------------+---------+--------+--------+</span>
<span class="token operator">|</span> empno <span class="token operator">|</span> ename  <span class="token operator">|</span> job      <span class="token operator">|</span> mgr  <span class="token operator">|</span> hiredate   <span class="token operator">|</span> sal     <span class="token operator">|</span> comm   <span class="token operator">|</span> deptno <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+--------+----------+------+------------+---------+--------+--------+</span>
<span class="token operator">|</span>  <span class="token number">7782</span> <span class="token operator">|</span> CLARK  <span class="token operator">|</span> manager  <span class="token operator">|</span> <span class="token number">7839</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">09</span> <span class="token operator">|</span> <span class="token number">2450.00</span> <span class="token operator">|</span>   <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7499</span> <span class="token operator">|</span> ALLEN  <span class="token operator">|</span> salesman <span class="token operator">|</span> <span class="token number">7698</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">20</span> <span class="token operator">|</span> <span class="token number">1600.00</span> <span class="token operator">|</span> <span class="token number">300.00</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7844</span> <span class="token operator">|</span> TURNER <span class="token operator">|</span> salesman <span class="token operator">|</span> <span class="token number">7698</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">08</span> <span class="token operator">|</span> <span class="token number">1500.00</span> <span class="token operator">|</span>   <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7934</span> <span class="token operator">|</span> MILLER <span class="token operator">|</span> clerk    <span class="token operator">|</span> <span class="token number">7782</span> <span class="token operator">|</span> <span class="token number">1992</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">23</span> <span class="token operator">|</span> <span class="token number">1300.00</span> <span class="token operator">|</span>   <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7521</span> <span class="token operator">|</span> WARD   <span class="token operator">|</span> salesman <span class="token operator">|</span> <span class="token number">7698</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">22</span> <span class="token operator">|</span> <span class="token number">1250.00</span> <span class="token operator">|</span> <span class="token number">500.00</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+--------+----------+------+------------+---------+--------+--------+</span>
<span class="token number">5</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
<span class="token comment">-- ç¬¬ä¸‰é¡µ</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">order</span> <span class="token keyword">by</span> sal <span class="token keyword">desc</span> <span class="token keyword">limit</span> <span class="token number">10</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">;</span><span class="token comment">-- limit æ¯é¡µæ˜¾è¦æ˜¾ç¤ºçš„è¡Œæ•° *ï¼ˆç¬¬å‡ é¡µ - 1ï¼‰ï¼Œæ¯é¡µæ˜¾è¦æ˜¾ç¤ºçš„è¡Œæ•°</span>
<span class="token operator">+</span><span class="token comment">-------+--------+----------+------+------------+---------+---------+--------+</span>
<span class="token operator">|</span> empno <span class="token operator">|</span> ename  <span class="token operator">|</span> job      <span class="token operator">|</span> mgr  <span class="token operator">|</span> hiredate   <span class="token operator">|</span> sal     <span class="token operator">|</span> comm    <span class="token operator">|</span> deptno <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+--------+----------+------+------------+---------+---------+--------+</span>
<span class="token operator">|</span>  <span class="token number">7654</span> <span class="token operator">|</span> MARTIN <span class="token operator">|</span> salesman <span class="token operator">|</span> <span class="token number">7698</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">28</span> <span class="token operator">|</span> <span class="token number">1250.00</span> <span class="token operator">|</span> <span class="token number">1400.00</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7900</span> <span class="token operator">|</span> JAMES  <span class="token operator">|</span> clerk    <span class="token operator">|</span> <span class="token number">7698</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">03</span> <span class="token operator">|</span>  <span class="token number">950.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7369</span> <span class="token operator">|</span> SMITH  <span class="token operator">|</span> clerk    <span class="token operator">|</span> <span class="token number">7902</span> <span class="token operator">|</span> <span class="token number">1990</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">17</span> <span class="token operator">|</span>  <span class="token number">800.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+--------+----------+------+------------+---------+---------+--------+</span>
<span class="token number">3</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

<span class="token comment">#åˆ†ç»„å‡½æ•°&amp;åˆ†ç»„å­å¥GROUP BY</span>
<span class="token comment">-- For instance æ˜¾ç¤ºæ¯ç§å²—ä½çš„é›‡å‘˜æ€»æ•°å’Œå¹³å‡å·¥èµ„</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">avg</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span> <span class="token keyword">from</span> emp <span class="token keyword">group</span> <span class="token keyword">by</span> job<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----------+-------------+</span>
<span class="token operator">|</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token function">avg</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span>    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------+-------------+</span>
<span class="token operator">|</span>        <span class="token number">3</span> <span class="token operator">|</span> <span class="token number">1016.666667</span> <span class="token operator">|</span>
<span class="token operator">|</span>        <span class="token number">4</span> <span class="token operator">|</span> <span class="token number">1400.000000</span> <span class="token operator">|</span>
<span class="token operator">|</span>        <span class="token number">3</span> <span class="token operator">|</span> <span class="token number">2758.333333</span> <span class="token operator">|</span>
<span class="token operator">|</span>        <span class="token number">2</span> <span class="token operator">|</span> <span class="token number">3000.000000</span> <span class="token operator">|</span>
<span class="token operator">|</span>        <span class="token number">1</span> <span class="token operator">|</span> <span class="token number">5000.000000</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------+-------------+</span>
<span class="token number">5</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
<span class="token comment">-- For instance è·å–é›‡å‘˜æ€»æ•°ä»¥åŠè·å¾—äº†è¡¥åŠ©ï¼ˆcommä¸ä¸ºnullçš„ï¼‰çš„é›‡å‘˜æ•°</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">count</span><span class="token punctuation">(</span>comm<span class="token punctuation">)</span> <span class="token keyword">from</span> emp<span class="token punctuation">;</span><span class="token comment">-- countï¼ˆ*ï¼‰ä¸countï¼ˆåˆ—ï¼‰çš„åŒºåˆ«æ˜¯countï¼ˆåˆ—ï¼‰ä¼šè¿‡æ»¤åˆ—ä¸­çš„nullå€¼ è€Œcountï¼ˆ*ï¼‰è¿”å›æ€»åˆ—æ•°</span>
<span class="token operator">+</span><span class="token comment">----------+-------------+</span>
<span class="token operator">|</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token function">count</span><span class="token punctuation">(</span>comm<span class="token punctuation">)</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------+-------------+</span>
<span class="token operator">|</span>       <span class="token number">13</span> <span class="token operator">|</span>           <span class="token number">3</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------+-------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
<span class="token comment">-- For instance è·å–é›‡å‘˜æ€»æ•°ä»¥åŠæ²¡æœ‰è¡¥åŠ©ï¼ˆcommä¸ºnullçš„ï¼‰çš„é›‡å‘˜æ•°</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token keyword">if</span><span class="token punctuation">(</span>comm <span class="token operator">is</span> <span class="token boolean">null</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token boolean">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">from</span> emp<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----------+--------------------------------+</span>
<span class="token operator">|</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token keyword">if</span><span class="token punctuation">(</span>comm <span class="token operator">is</span> <span class="token boolean">null</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token boolean">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------+--------------------------------+</span>
<span class="token operator">|</span>       <span class="token number">13</span> <span class="token operator">|</span>                             <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------+--------------------------------+</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token keyword">if</span><span class="token punctuation">(</span>comm <span class="token operator">is</span> <span class="token boolean">null</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token boolean">null</span><span class="token punctuation">)</span> <span class="token keyword">from</span> emp<span class="token punctuation">;</span>
<span class="token comment">-- å…¶ä¸­ if(comm is null,1,null)</span>
<span class="token operator">+</span><span class="token comment">-------------------------+</span>
<span class="token operator">|</span> <span class="token keyword">if</span><span class="token punctuation">(</span>comm <span class="token operator">is</span> <span class="token boolean">null</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token boolean">null</span><span class="token punctuation">)</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------------------+</span>
<span class="token operator">|</span>                       <span class="token number">1</span> <span class="token operator">|</span>
<span class="token operator">|</span>                    <span class="token boolean">NULL</span> <span class="token operator">|</span>
<span class="token operator">|</span>                    <span class="token boolean">NULL</span> <span class="token operator">|</span>
<span class="token operator">|</span>                       <span class="token number">1</span> <span class="token operator">|</span>
<span class="token operator">|</span>                    <span class="token boolean">NULL</span> <span class="token operator">|</span>
<span class="token operator">|</span>                       <span class="token number">1</span> <span class="token operator">|</span>
<span class="token operator">|</span>                       <span class="token number">1</span> <span class="token operator">|</span>
<span class="token operator">|</span>                       <span class="token number">1</span> <span class="token operator">|</span>
<span class="token operator">|</span>                       <span class="token number">1</span> <span class="token operator">|</span>
<span class="token operator">|</span>                       <span class="token number">1</span> <span class="token operator">|</span>
<span class="token operator">|</span>                       <span class="token number">1</span> <span class="token operator">|</span>
<span class="token operator">|</span>                       <span class="token number">1</span> <span class="token operator">|</span>
<span class="token operator">|</span>                       <span class="token number">1</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------------------+</span>
<span class="token number">13</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
<span class="token comment">-- else method</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token function">count</span><span class="token punctuation">(</span>comm<span class="token punctuation">)</span> <span class="token keyword">from</span> emp<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----------+------------------------+</span>
<span class="token operator">|</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token function">count</span><span class="token punctuation">(</span>comm<span class="token punctuation">)</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------+------------------------+</span>
<span class="token operator">|</span>       <span class="token number">13</span> <span class="token operator">|</span>                     <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------+------------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

<span class="token comment">-- For instance æ˜¾ç¤ºå‘˜å·¥ä¸­managerçš„æ€»æ•°</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span>job<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">&#39;manager_count&#39;</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> job<span class="token operator">=</span><span class="token string">&#39;manager&#39;</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------------+</span>
<span class="token operator">|</span> manager_count <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------+</span>
<span class="token operator">|</span>             <span class="token number">3</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

<span class="token comment">-- For instance æ˜¾ç¤ºå‘˜å·¥çš„å·¥èµ„æœ€å¤§å·®é¢</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token function">max</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token function">min</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">&#39;æœ€å¤§å·¥èµ„å·®é¢&#39;</span> <span class="token keyword">from</span> emp<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">--------------------+</span>
<span class="token operator">|</span> æœ€å¤§å·¥èµ„å·®é¢       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------------+</span>
<span class="token operator">|</span>            <span class="token number">4200.00</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="å¤šè¡¨" tabindex="-1"><a class="header-anchor" href="#å¤šè¡¨" aria-hidden="true">#</a> å¤šè¡¨</h6><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">#å¤šè¡¨æŸ¥è¯¢å³åŸºäºä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„è¡¨æŸ¥è¯¢</span>
<span class="token comment">#ç¬›å¡å°”é›†</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> dept<span class="token punctuation">,</span>emp<span class="token punctuation">,</span>salgrade<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----------+</span>
<span class="token operator">|</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------+</span>
<span class="token operator">|</span>      <span class="token number">260</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------+</span>
countï¼ˆ<span class="token operator">*</span>ï¼‰çš„ç»“æœä¸ºæ¯ä¸ªè¡¨çš„è¡Œæ•°ç›¸Xï¼ˆä¹˜ï¼‰countï¼ˆ<span class="token operator">*</span>ï¼‰<span class="token operator">=</span>dept<span class="token punctuation">.</span><span class="token keyword">rows</span> x emp<span class="token punctuation">.</span><span class="token keyword">rows</span> x salgrade ç¬›å¡å°”é›†
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>
<span class="token comment">-- é¿å…å‡ºç°ç¬›å¡å°”é›† Tipï¼šå¤šè¡¨æŸ¥è¯¢çš„æ¡ä»¶ä¸èƒ½å°‘äº è¡¨çš„ä¸ªæ•° - 1ï¼›</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> ename<span class="token punctuation">,</span>sal<span class="token punctuation">,</span>emp<span class="token punctuation">.</span>deptno <span class="token keyword">from</span> emp<span class="token punctuation">,</span>dept <span class="token keyword">where</span> emp<span class="token punctuation">.</span>deptno<span class="token operator">=</span>dept<span class="token punctuation">.</span>deptno<span class="token punctuation">;</span><span class="token comment">-- å¯ä»¥ç»™ä¸¤ä¸ªè¡¨é™åˆ¶æ¡ä»¶è¿›è¡ŒæŸ¥è¯¢ï¼ˆæ€è€ƒè¿‡æ»¤æ¡ä»¶ï¼‰</span>
<span class="token comment">-- å¦‚æœå¤šè¡¨ä¸­å‡ºç°åŒååˆ— åˆ™éœ€è¦ä½¿ç”¨ è¡¨å.åˆ—å çš„å½¢å¼æŒ‡æ˜åˆ— å¦åˆ™ç³»ç»Ÿæ— æ³•è¯†åˆ«ä¼šæŠ¥é”™</span>
<span class="token operator">+</span><span class="token comment">--------+---------+--------+</span>
<span class="token operator">|</span> ename  <span class="token operator">|</span> sal     <span class="token operator">|</span> deptno <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------+---------+--------+</span>
<span class="token operator">|</span> SMITH  <span class="token operator">|</span>  <span class="token number">800.00</span> <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span> ALLEN  <span class="token operator">|</span> <span class="token number">1600.00</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span> WARD   <span class="token operator">|</span> <span class="token number">1250.00</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span> JONES  <span class="token operator">|</span> <span class="token number">2975.00</span> <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span> MARTIN <span class="token operator">|</span> <span class="token number">1250.00</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span> BLAKE  <span class="token operator">|</span> <span class="token number">2850.00</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span> CLARK  <span class="token operator">|</span> <span class="token number">2450.00</span> <span class="token operator">|</span>     <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">|</span> SCOTT  <span class="token operator">|</span> <span class="token number">3000.00</span> <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span> KING   <span class="token operator">|</span> <span class="token number">5000.00</span> <span class="token operator">|</span>     <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">|</span> TURNER <span class="token operator">|</span> <span class="token number">1500.00</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span> JAMES  <span class="token operator">|</span>  <span class="token number">950.00</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span> FORD   <span class="token operator">|</span> <span class="token number">3000.00</span> <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span> MILLER <span class="token operator">|</span> <span class="token number">1300.00</span> <span class="token operator">|</span>     <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------+---------+--------+</span>
<span class="token number">13</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

<span class="token comment">-- For instance æŸ¥è¯¢æ˜¾ç¤ºå‘˜å·¥çš„å§“å å·¥èµ„ ä»¥åŠ å·¥èµ„ç­‰çº§</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> ename<span class="token punctuation">,</span>sal<span class="token punctuation">,</span>grade <span class="token keyword">from</span> emp<span class="token punctuation">,</span>salgrade <span class="token keyword">where</span> emp<span class="token punctuation">.</span>sal <span class="token operator">between</span> salgrade<span class="token punctuation">.</span>losal <span class="token operator">and</span> salgrade<span class="token punctuation">.</span>hisal
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">--------+---------+-------+</span>
<span class="token operator">|</span> ename  <span class="token operator">|</span> sal     <span class="token operator">|</span> grade <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------+---------+-------+</span>
<span class="token operator">|</span> SMITH  <span class="token operator">|</span>  <span class="token number">800.00</span> <span class="token operator">|</span>     <span class="token number">1</span> <span class="token operator">|</span>
<span class="token operator">|</span> ALLEN  <span class="token operator">|</span> <span class="token number">1600.00</span> <span class="token operator">|</span>     <span class="token number">3</span> <span class="token operator">|</span>
<span class="token operator">|</span> WARD   <span class="token operator">|</span> <span class="token number">1250.00</span> <span class="token operator">|</span>     <span class="token number">2</span> <span class="token operator">|</span>
<span class="token operator">|</span> JONES  <span class="token operator">|</span> <span class="token number">2975.00</span> <span class="token operator">|</span>     <span class="token number">4</span> <span class="token operator">|</span>
<span class="token operator">|</span> MARTIN <span class="token operator">|</span> <span class="token number">1250.00</span> <span class="token operator">|</span>     <span class="token number">2</span> <span class="token operator">|</span>
<span class="token operator">|</span> BLAKE  <span class="token operator">|</span> <span class="token number">2850.00</span> <span class="token operator">|</span>     <span class="token number">4</span> <span class="token operator">|</span>
<span class="token operator">|</span> CLARK  <span class="token operator">|</span> <span class="token number">2450.00</span> <span class="token operator">|</span>     <span class="token number">4</span> <span class="token operator">|</span>
<span class="token operator">|</span> SCOTT  <span class="token operator">|</span> <span class="token number">3000.00</span> <span class="token operator">|</span>     <span class="token number">4</span> <span class="token operator">|</span>
<span class="token operator">|</span> KING   <span class="token operator">|</span> <span class="token number">5000.00</span> <span class="token operator">|</span>     <span class="token number">5</span> <span class="token operator">|</span>
<span class="token operator">|</span> TURNER <span class="token operator">|</span> <span class="token number">1500.00</span> <span class="token operator">|</span>     <span class="token number">3</span> <span class="token operator">|</span>
<span class="token operator">|</span> JAMES  <span class="token operator">|</span>  <span class="token number">950.00</span> <span class="token operator">|</span>     <span class="token number">1</span> <span class="token operator">|</span>
<span class="token operator">|</span> FORD   <span class="token operator">|</span> <span class="token number">3000.00</span> <span class="token operator">|</span>     <span class="token number">4</span> <span class="token operator">|</span>
<span class="token operator">|</span> MILLER <span class="token operator">|</span> <span class="token number">1300.00</span> <span class="token operator">|</span>     <span class="token number">2</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------+---------+-------+</span>
<span class="token number">13</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="å­æŸ¥è¯¢" tabindex="-1"><a class="header-anchor" href="#å­æŸ¥è¯¢" aria-hidden="true">#</a> å­æŸ¥è¯¢</h5><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">#å­æŸ¥è¯¢-- åµŒå¥—æŸ¥è¯¢</span>
<span class="token comment">-- For instance</span>
<span class="token comment">-- æŸ¥è¯¢å’ŒsmithåŒä¸€ä¸ªéƒ¨é—¨çš„æ‰€æœ‰å‘˜å·¥  å…ˆæŸ¥å‡ºsmithæ‰€åœ¨éƒ¨é—¨ ç„¶åæŸ¥æ­¤éƒ¨é—¨çš„æ‰€æœ‰å‘˜å·¥</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> deptno <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">select</span> deptno <span class="token keyword">from</span> emp <span class="token keyword">where</span> ename <span class="token operator">=</span> <span class="token string">&#39;SMITH&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-------+-------+---------+------+------------+---------+------+--------+</span>
<span class="token operator">|</span> empno <span class="token operator">|</span> ename <span class="token operator">|</span> job     <span class="token operator">|</span> mgr  <span class="token operator">|</span> hiredate   <span class="token operator">|</span> sal     <span class="token operator">|</span> comm <span class="token operator">|</span> deptno <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+-------+---------+------+------------+---------+------+--------+</span>
<span class="token operator">|</span>  <span class="token number">7369</span> <span class="token operator">|</span> SMITH <span class="token operator">|</span> clerk   <span class="token operator">|</span> <span class="token number">7902</span> <span class="token operator">|</span> <span class="token number">1990</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">17</span> <span class="token operator">|</span>  <span class="token number">800.00</span> <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7566</span> <span class="token operator">|</span> JONES <span class="token operator">|</span> manager <span class="token operator">|</span> <span class="token number">7839</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">02</span> <span class="token operator">|</span> <span class="token number">2975.00</span> <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7788</span> <span class="token operator">|</span> SCOTT <span class="token operator">|</span> analyst <span class="token operator">|</span> <span class="token number">7566</span> <span class="token operator">|</span> <span class="token number">1997</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">19</span> <span class="token operator">|</span> <span class="token number">3000.00</span> <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7902</span> <span class="token operator">|</span> FORD  <span class="token operator">|</span> analyst <span class="token operator">|</span> <span class="token number">7566</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">03</span> <span class="token operator">|</span> <span class="token number">3000.00</span> <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+-------+---------+------+------------+---------+------+--------+</span>
<span class="token number">4</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="å¤šè¡Œå­æŸ¥è¯¢" tabindex="-1"><a class="header-anchor" href="#å¤šè¡Œå­æŸ¥è¯¢" aria-hidden="true">#</a> å¤šè¡Œå­æŸ¥è¯¢</h5><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">#å¤šè¡Œå­æŸ¥è¯¢ åµŒå¥—æŸ¥è¯¢ å­æŸ¥è¯¢è¿”å›çš„æ˜¯å¤šè¡Œçš„æƒ…å†µ-- Tip:whereåçš„æ¡ä»¶è¿”å›çš„æ˜¯å¤šè¡Œæ—¶ è¦ä½¿ç”¨å…³é”®å­— IN </span>
<span class="token comment">-- For instance</span>
<span class="token comment">-- æŸ¥è¯¢å’Œ20å·éƒ¨é—¨çš„å·¥ä½œç›¸åŒçš„é›‡å‘˜çš„ å§“å å²—ä½ å·¥èµ„ éƒ¨é—¨å· ä½†æ˜¯ä¸åŒ…å«20å·éƒ¨é—¨ä¸­çš„é›‡å‘˜</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> ename<span class="token punctuation">,</span>job<span class="token punctuation">,</span>sal<span class="token punctuation">,</span>deptno <span class="token keyword">from</span> emp
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">where</span> job <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token keyword">distinct</span> job <span class="token keyword">from</span> emp <span class="token keyword">where</span> deptno <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">AND</span> deptno <span class="token operator">&lt;&gt;</span> <span class="token number">20</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">--------+---------+---------+--------+</span>
<span class="token operator">|</span> ename  <span class="token operator">|</span> job     <span class="token operator">|</span> sal     <span class="token operator">|</span> deptno <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------+---------+---------+--------+</span>
<span class="token operator">|</span> BLAKE  <span class="token operator">|</span> manager <span class="token operator">|</span> <span class="token number">2850.00</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span> CLARK  <span class="token operator">|</span> manager <span class="token operator">|</span> <span class="token number">2450.00</span> <span class="token operator">|</span>     <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">|</span> JAMES  <span class="token operator">|</span> clerk   <span class="token operator">|</span>  <span class="token number">950.00</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span> MILLER <span class="token operator">|</span> clerk   <span class="token operator">|</span> <span class="token number">1300.00</span> <span class="token operator">|</span>     <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------+---------+---------+--------+</span>
<span class="token number">4</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="ä¸´æ—¶è¡¨" tabindex="-1"><a class="header-anchor" href="#ä¸´æ—¶è¡¨" aria-hidden="true">#</a> ä¸´æ—¶è¡¨</h5><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">#å­æŸ¥è¯¢å½“ä½œä¸´æ—¶è¡¨æ¥ä½¿ç”¨</span>
<span class="token comment">-- For instance</span>
<span class="token comment">-- æŸ¥è¯¢ecshopä¸­å„ä¸ªç±»åˆ«ä¸­ ä»·æ ¼æœ€é«˜çš„goods-- å¯ä»¥å°†å­æŸ¥è¯¢ä½œä¸ºä¸€å¼ ä¸´æ—¶è¡¨æ¥ä½¿ç”¨</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> goods_id<span class="token punctuation">,</span>cat_id<span class="token punctuation">,</span>goods_name<span class="token punctuation">,</span>shop_price <span class="token keyword">from</span> ecs_goods<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----------+--------+----------------------------------------+------------+</span>
<span class="token operator">|</span> goods_id <span class="token operator">|</span> cat_id <span class="token operator">|</span> goods_name                             <span class="token operator">|</span> shop_price <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------+--------+----------------------------------------+------------+</span>
<span class="token operator">|</span>        <span class="token number">1</span> <span class="token operator">|</span>      <span class="token number">4</span> <span class="token operator">|</span> KD876                                  <span class="token operator">|</span>    <span class="token number">1388.00</span> <span class="token operator">|</span>
<span class="token operator">|</span>        <span class="token number">4</span> <span class="token operator">|</span>      <span class="token number">8</span> <span class="token operator">|</span> è¯ºåŸºäºšN85åŸè£…å……ç”µå™¨                    <span class="token operator">|</span>      <span class="token number">58.00</span> <span class="token operator">|</span>
<span class="token operator">|</span>        <span class="token number">3</span> <span class="token operator">|</span>      <span class="token number">8</span> <span class="token operator">|</span> è¯ºåŸºäºšåŸè£…<span class="token number">5800</span>è€³æœº                     <span class="token operator">|</span>      <span class="token number">68.00</span> <span class="token operator">|</span>
<span class="token operator">|</span>        <span class="token number">5</span> <span class="token operator">|</span>     <span class="token number">11</span> <span class="token operator">|</span> ç´¢çˆ±åŸè£…M2å¡è¯»å¡å™¨                     <span class="token operator">|</span>      <span class="token number">20.00</span> <span class="token operator">|</span>
<span class="token operator">|</span>        <span class="token number">6</span> <span class="token operator">|</span>     <span class="token number">11</span> <span class="token operator">|</span> èƒœåˆ›KINGMAXå†…å­˜å¡                      <span class="token operator">|</span>      <span class="token number">42.00</span> <span class="token operator">|</span>
<span class="token operator">|</span>        <span class="token number">7</span> <span class="token operator">|</span>      <span class="token number">8</span> <span class="token operator">|</span> è¯ºåŸºäºšN85åŸè£…ç«‹ä½“å£°è€³æœºHS<span class="token operator">-</span><span class="token number">82</span>           <span class="token operator">|</span>     <span class="token number">100.00</span> <span class="token operator">|</span>
<span class="token operator">|</span>        <span class="token number">8</span> <span class="token operator">|</span>      <span class="token number">3</span> <span class="token operator">|</span> é£åˆ©æµ¦<span class="token number">9</span><span class="token variable">@9v</span>                             <span class="token operator">|</span>     <span class="token number">399.00</span> <span class="token operator">|</span>
<span class="token operator">|</span>        <span class="token number">9</span> <span class="token operator">|</span>      <span class="token number">3</span> <span class="token operator">|</span> è¯ºåŸºäºšE66                              <span class="token operator">|</span>    <span class="token number">2298.00</span> <span class="token operator">|</span>
<span class="token operator">|</span>       <span class="token number">10</span> <span class="token operator">|</span>      <span class="token number">3</span> <span class="token operator">|</span> ç´¢çˆ±C702c                              <span class="token operator">|</span>    <span class="token number">1328.00</span> <span class="token operator">|</span>
<span class="token operator">|</span>       <span class="token number">11</span> <span class="token operator">|</span>      <span class="token number">3</span> <span class="token operator">|</span> ç´¢çˆ±C702c                              <span class="token operator">|</span>    <span class="token number">1300.00</span> <span class="token operator">|</span>
<span class="token operator">|</span>       <span class="token number">12</span> <span class="token operator">|</span>      <span class="token number">3</span> <span class="token operator">|</span> æ‘©æ‰˜ç½—æ‹‰A810                           <span class="token operator">|</span>     <span class="token number">983.00</span> <span class="token operator">|</span>
<span class="token operator">|</span>       <span class="token number">13</span> <span class="token operator">|</span>      <span class="token number">3</span> <span class="token operator">|</span> è¯ºåŸºäºš<span class="token number">5320</span> XpressMusic                 <span class="token operator">|</span>    <span class="token number">1311.00</span> <span class="token operator">|</span>
<span class="token operator">|</span>       <span class="token number">14</span> <span class="token operator">|</span>      <span class="token number">4</span> <span class="token operator">|</span> è¯ºåŸºäºš<span class="token number">5800</span>XM                           <span class="token operator">|</span>    <span class="token number">2625.00</span> <span class="token operator">|</span>
<span class="token operator">|</span>       <span class="token number">15</span> <span class="token operator">|</span>      <span class="token number">3</span> <span class="token operator">|</span> æ‘©æ‰˜ç½—æ‹‰A810                           <span class="token operator">|</span>     <span class="token number">788.00</span> <span class="token operator">|</span>
<span class="token operator">|</span>       <span class="token number">16</span> <span class="token operator">|</span>      <span class="token number">2</span> <span class="token operator">|</span> æ’åŸºä¼Ÿä¸šG101                           <span class="token operator">|</span>     <span class="token number">823.33</span> <span class="token operator">|</span>
<span class="token operator">|</span>       <span class="token number">17</span> <span class="token operator">|</span>      <span class="token number">3</span> <span class="token operator">|</span> å¤æ–°N7                                 <span class="token operator">|</span>    <span class="token number">2300.00</span> <span class="token operator">|</span>
<span class="token operator">|</span>       <span class="token number">18</span> <span class="token operator">|</span>      <span class="token number">4</span> <span class="token operator">|</span> å¤æ–°T5                                 <span class="token operator">|</span>    <span class="token number">2878.00</span> <span class="token operator">|</span>
<span class="token operator">|</span>       <span class="token number">19</span> <span class="token operator">|</span>      <span class="token number">3</span> <span class="token operator">|</span> ä¸‰æ˜ŸSGH<span class="token operator">-</span>F258                           <span class="token operator">|</span>     <span class="token number">858.00</span> <span class="token operator">|</span>
<span class="token operator">|</span>       <span class="token number">20</span> <span class="token operator">|</span>      <span class="token number">3</span> <span class="token operator">|</span> ä¸‰æ˜ŸBC01                               <span class="token operator">|</span>     <span class="token number">280.00</span> <span class="token operator">|</span>
<span class="token operator">|</span>       <span class="token number">21</span> <span class="token operator">|</span>      <span class="token number">3</span> <span class="token operator">|</span> é‡‘ç«‹ A30                               <span class="token operator">|</span>    <span class="token number">2000.00</span> <span class="token operator">|</span>
<span class="token operator">|</span>       <span class="token number">22</span> <span class="token operator">|</span>      <span class="token number">3</span> <span class="token operator">|</span> å¤šæ™®è¾¾Touch HD                         <span class="token operator">|</span>    <span class="token number">5999.00</span> <span class="token operator">|</span>
<span class="token operator">|</span>       <span class="token number">23</span> <span class="token operator">|</span>      <span class="token number">5</span> <span class="token operator">|</span> è¯ºåŸºäºšN96                              <span class="token operator">|</span>    <span class="token number">3700.00</span> <span class="token operator">|</span>
<span class="token operator">|</span>       <span class="token number">24</span> <span class="token operator">|</span>      <span class="token number">3</span> <span class="token operator">|</span> P806                                   <span class="token operator">|</span>    <span class="token number">2000.00</span> <span class="token operator">|</span>
<span class="token operator">|</span>       <span class="token number">25</span> <span class="token operator">|</span>     <span class="token number">13</span> <span class="token operator">|</span> å°çµé€š<span class="token operator">/</span>å›ºè¯<span class="token number">50</span>å…ƒå……å€¼å¡                  <span class="token operator">|</span>      <span class="token number">48.00</span> <span class="token operator">|</span>
<span class="token operator">|</span>       <span class="token number">26</span> <span class="token operator">|</span>     <span class="token number">13</span> <span class="token operator">|</span> å°çµé€š<span class="token operator">/</span>å›ºè¯<span class="token number">20</span>å…ƒå……å€¼å¡                  <span class="token operator">|</span>      <span class="token number">19.00</span> <span class="token operator">|</span>
<span class="token operator">|</span>       <span class="token number">27</span> <span class="token operator">|</span>     <span class="token number">15</span> <span class="token operator">|</span> è”é€š<span class="token number">100</span>å…ƒå……å€¼å¡                        <span class="token operator">|</span>      <span class="token number">95.00</span> <span class="token operator">|</span>
<span class="token operator">|</span>       <span class="token number">28</span> <span class="token operator">|</span>     <span class="token number">15</span> <span class="token operator">|</span> è”é€š<span class="token number">50</span>å…ƒå……å€¼å¡                         <span class="token operator">|</span>      <span class="token number">45.00</span> <span class="token operator">|</span>
<span class="token operator">|</span>       <span class="token number">29</span> <span class="token operator">|</span>     <span class="token number">14</span> <span class="token operator">|</span> ç§»åŠ¨<span class="token number">100</span>å…ƒå……å€¼å¡                        <span class="token operator">|</span>      <span class="token number">90.00</span> <span class="token operator">|</span>
<span class="token operator">|</span>       <span class="token number">30</span> <span class="token operator">|</span>     <span class="token number">14</span> <span class="token operator">|</span> ç§»åŠ¨<span class="token number">20</span>å…ƒå……å€¼å¡                         <span class="token operator">|</span>      <span class="token number">18.00</span> <span class="token operator">|</span>
<span class="token operator">|</span>       <span class="token number">31</span> <span class="token operator">|</span>      <span class="token number">3</span> <span class="token operator">|</span> æ‘©æ‰˜ç½—æ‹‰E8                             <span class="token operator">|</span>    <span class="token number">1337.00</span> <span class="token operator">|</span>
<span class="token operator">|</span>       <span class="token number">32</span> <span class="token operator">|</span>      <span class="token number">3</span> <span class="token operator">|</span> è¯ºåŸºäºšN85                              <span class="token operator">|</span>    <span class="token number">3010.00</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------+--------+----------------------------------------+------------+</span>
<span class="token number">31</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> goods_id<span class="token punctuation">,</span>ecs_goods<span class="token punctuation">.</span>cat_id<span class="token punctuation">,</span>goods_name<span class="token punctuation">,</span>shop_price
<span class="token comment">-- æ­¤å¤„fromåçš„è¡¨å¯ä»¥ä½¿ç”¨selectå‡ºçš„å­æŸ¥è¯¢ä½œä¸ºä¸´æ—¶è¡¨ å¹¶ç»™ä¸´æ—¶è¡¨å¦å</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> cat_id<span class="token punctuation">,</span><span class="token function">MAX</span><span class="token punctuation">(</span>shop_price<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">&#39;max_shop_price&#39;</span> <span class="token keyword">from</span> ecs_goods <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> cat_id<span class="token punctuation">)</span> <span class="token keyword">temp</span><span class="token punctuation">,</span>ecs_goods
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">where</span> <span class="token keyword">temp</span><span class="token punctuation">.</span>cat_id<span class="token operator">=</span>ecs_goods<span class="token punctuation">.</span>cat_id <span class="token operator">and</span> max_shop_price <span class="token operator">=</span> shop_price
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----------+--------+----------------------------------------+------------+</span>
<span class="token operator">|</span> goods_id <span class="token operator">|</span> cat_id <span class="token operator">|</span> goods_name                             <span class="token operator">|</span> shop_price <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------+--------+----------------------------------------+------------+</span>
<span class="token operator">|</span>       <span class="token number">16</span> <span class="token operator">|</span>      <span class="token number">2</span> <span class="token operator">|</span> æ’åŸºä¼Ÿä¸šG101                           <span class="token operator">|</span>     <span class="token number">823.33</span> <span class="token operator">|</span>
<span class="token operator">|</span>       <span class="token number">22</span> <span class="token operator">|</span>      <span class="token number">3</span> <span class="token operator">|</span> å¤šæ™®è¾¾Touch HD                         <span class="token operator">|</span>    <span class="token number">5999.00</span> <span class="token operator">|</span>
<span class="token operator">|</span>       <span class="token number">18</span> <span class="token operator">|</span>      <span class="token number">4</span> <span class="token operator">|</span> å¤æ–°T5                                 <span class="token operator">|</span>    <span class="token number">2878.00</span> <span class="token operator">|</span>
<span class="token operator">|</span>       <span class="token number">23</span> <span class="token operator">|</span>      <span class="token number">5</span> <span class="token operator">|</span> è¯ºåŸºäºšN96                              <span class="token operator">|</span>    <span class="token number">3700.00</span> <span class="token operator">|</span>
<span class="token operator">|</span>        <span class="token number">7</span> <span class="token operator">|</span>      <span class="token number">8</span> <span class="token operator">|</span> è¯ºåŸºäºšN85åŸè£…ç«‹ä½“å£°è€³æœºHS<span class="token operator">-</span><span class="token number">82</span>           <span class="token operator">|</span>     <span class="token number">100.00</span> <span class="token operator">|</span>
<span class="token operator">|</span>        <span class="token number">6</span> <span class="token operator">|</span>     <span class="token number">11</span> <span class="token operator">|</span> èƒœåˆ›KINGMAXå†…å­˜å¡                      <span class="token operator">|</span>      <span class="token number">42.00</span> <span class="token operator">|</span>
<span class="token operator">|</span>       <span class="token number">25</span> <span class="token operator">|</span>     <span class="token number">13</span> <span class="token operator">|</span> å°çµé€š<span class="token operator">/</span>å›ºè¯<span class="token number">50</span>å…ƒå……å€¼å¡                  <span class="token operator">|</span>      <span class="token number">48.00</span> <span class="token operator">|</span>
<span class="token operator">|</span>       <span class="token number">29</span> <span class="token operator">|</span>     <span class="token number">14</span> <span class="token operator">|</span> ç§»åŠ¨<span class="token number">100</span>å…ƒå……å€¼å¡                        <span class="token operator">|</span>      <span class="token number">90.00</span> <span class="token operator">|</span>
<span class="token operator">|</span>       <span class="token number">27</span> <span class="token operator">|</span>     <span class="token number">15</span> <span class="token operator">|</span> è”é€š<span class="token number">100</span>å…ƒå……å€¼å¡                        <span class="token operator">|</span>      <span class="token number">95.00</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------+--------+----------------------------------------+------------+</span>
<span class="token number">9</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="all-anyçš„ä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#all-anyçš„ä½¿ç”¨" aria-hidden="true">#</a> all&amp;anyçš„ä½¿ç”¨</h5><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">#all&amp;anyçš„ä½¿ç”¨</span>
<span class="token comment">-- all è¡¨ç¤ºæ‰€æœ‰</span>
<span class="token comment">-- For instance</span>
<span class="token comment">-- æ˜¾ç¤ºå·¥èµ„æ¯”éƒ¨é—¨30çš„æ‰€æœ‰å‘˜å·¥éƒ½è¦é«˜çš„å‘˜å·¥çš„å§“åï¼Œå·¥èµ„å’Œéƒ¨é—¨å·-- ç›¸å½“äºæ¯”æœ€é«˜è¿˜è¦é«˜</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> ename<span class="token punctuation">,</span>sal<span class="token punctuation">,</span>deptno <span class="token keyword">from</span> emp
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">where</span> sal <span class="token operator">&gt;</span> <span class="token keyword">ALL</span><span class="token punctuation">(</span><span class="token keyword">select</span> sal <span class="token keyword">from</span> emp <span class="token keyword">where</span> deptno<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-------+---------+--------+</span>
<span class="token operator">|</span> ename <span class="token operator">|</span> sal     <span class="token operator">|</span> deptno <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+---------+--------+</span>
<span class="token operator">|</span> JONES <span class="token operator">|</span> <span class="token number">2975.00</span> <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span> SCOTT <span class="token operator">|</span> <span class="token number">3000.00</span> <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span> KING  <span class="token operator">|</span> <span class="token number">5000.00</span> <span class="token operator">|</span>     <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">|</span> FORD  <span class="token operator">|</span> <span class="token number">3000.00</span> <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+---------+--------+</span>
<span class="token number">4</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

<span class="token comment">-- any è¡¨ç¤ºä»»ä½•ä¸€ä¸ª</span>
<span class="token comment">-- For instance</span>
<span class="token comment">-- æ˜¾ç¤ºå·¥èµ„æ¯”éƒ¨åˆ†30ä¸­çš„å…¶ä¸­ä»»æ„ä¸€ä¸ªå‘˜å·¥å·¥èµ„é«˜çš„å‘˜å·¥çš„å§“åï¼Œå·¥èµ„å’Œéƒ¨é—¨å·-- ç›¸å½“äºåªè¦æ¯”æœ€ä½çš„åˆ°</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> ename<span class="token punctuation">,</span>sal<span class="token punctuation">,</span>deptno <span class="token keyword">from</span> emp
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">where</span> sal <span class="token operator">&gt;</span> <span class="token keyword">any</span><span class="token punctuation">(</span><span class="token keyword">select</span> sal <span class="token keyword">from</span> emp <span class="token keyword">where</span> deptno <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">--------+---------+--------+</span>
<span class="token operator">|</span> ename  <span class="token operator">|</span> sal     <span class="token operator">|</span> deptno <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------+---------+--------+</span>
<span class="token operator">|</span> ALLEN  <span class="token operator">|</span> <span class="token number">1600.00</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span> WARD   <span class="token operator">|</span> <span class="token number">1250.00</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span> JONES  <span class="token operator">|</span> <span class="token number">2975.00</span> <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span> MARTIN <span class="token operator">|</span> <span class="token number">1250.00</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span> BLAKE  <span class="token operator">|</span> <span class="token number">2850.00</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span> CLARK  <span class="token operator">|</span> <span class="token number">2450.00</span> <span class="token operator">|</span>     <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">|</span> SCOTT  <span class="token operator">|</span> <span class="token number">3000.00</span> <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span> KING   <span class="token operator">|</span> <span class="token number">5000.00</span> <span class="token operator">|</span>     <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">|</span> TURNER <span class="token operator">|</span> <span class="token number">1500.00</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span> FORD   <span class="token operator">|</span> <span class="token number">3000.00</span> <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span> MILLER <span class="token operator">|</span> <span class="token number">1300.00</span> <span class="token operator">|</span>     <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------+---------+--------+</span>
<span class="token number">11</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="å¤šåˆ—å­æŸ¥è¯¢" tabindex="-1"><a class="header-anchor" href="#å¤šåˆ—å­æŸ¥è¯¢" aria-hidden="true">#</a> å¤šåˆ—å­æŸ¥è¯¢</h5><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">#å¤šåˆ—å­æŸ¥è¯¢</span>
<span class="token comment">-- å­æŸ¥è¯¢ç»“æœä¸ºå¤šåˆ—çš„ --ï¼ˆåˆ—åï¼Œåˆ—åï¼‰= ï¼ˆå­æŸ¥è¯¢ï¼‰</span>
<span class="token comment">-- For instance</span>
<span class="token comment">-- æŸ¥è¯¢å’ŒALLENçš„éƒ¨é—¨å’Œå²—ä½å®Œå…¨ç›¸åŒçš„æ‰€æœ‰é›‡å‘˜ï¼ˆå¹¶ä¸åŒ…å«ALLENæœ¬äººï¼‰</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">where</span> <span class="token punctuation">(</span>deptno<span class="token punctuation">,</span>job<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">select</span> deptno<span class="token punctuation">,</span>job <span class="token keyword">from</span> emp <span class="token keyword">where</span> ename <span class="token operator">=</span> <span class="token string">&#39;ALLEN&#39;</span><span class="token punctuation">)</span> <span class="token operator">AND</span> ename <span class="token operator">&lt;&gt;</span> <span class="token string">&#39;ALLEN&#39;</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-------+--------+----------+------+------------+---------+---------+--------+</span>
<span class="token operator">|</span> empno <span class="token operator">|</span> ename  <span class="token operator">|</span> job      <span class="token operator">|</span> mgr  <span class="token operator">|</span> hiredate   <span class="token operator">|</span> sal     <span class="token operator">|</span> comm    <span class="token operator">|</span> deptno <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+--------+----------+------+------------+---------+---------+--------+</span>
<span class="token operator">|</span>  <span class="token number">7521</span> <span class="token operator">|</span> WARD   <span class="token operator">|</span> salesman <span class="token operator">|</span> <span class="token number">7698</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">22</span> <span class="token operator">|</span> <span class="token number">1250.00</span> <span class="token operator">|</span>  <span class="token number">500.00</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7654</span> <span class="token operator">|</span> MARTIN <span class="token operator">|</span> salesman <span class="token operator">|</span> <span class="token number">7698</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">28</span> <span class="token operator">|</span> <span class="token number">1250.00</span> <span class="token operator">|</span> <span class="token number">1400.00</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7844</span> <span class="token operator">|</span> TURNER <span class="token operator">|</span> salesman <span class="token operator">|</span> <span class="token number">7698</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">08</span> <span class="token operator">|</span> <span class="token number">1500.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+--------+----------+------+------------+---------+---------+--------+</span>
<span class="token number">3</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

<span class="token comment">-- For instance</span>
<span class="token comment">-- æŸ¥è¯¢å’Œå®‹æ±Ÿ æ•°å­¦ï¼Œè‹±è¯­ï¼Œè¯­æ–‡æˆç»©å®Œå…¨ç›¸åŒçš„åŒå­¦</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> student
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">where</span> <span class="token punctuation">(</span>chinese<span class="token punctuation">,</span>english<span class="token punctuation">,</span>math<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">select</span> chinese<span class="token punctuation">,</span>english<span class="token punctuation">,</span>math <span class="token keyword">from</span> student <span class="token keyword">where</span> name <span class="token operator">=</span> <span class="token string">&#39;å®‹æ±Ÿ&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+--------+---------+---------+------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> name   <span class="token operator">|</span> chinese <span class="token operator">|</span> english <span class="token operator">|</span> math <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+--------+---------+---------+------+</span>
<span class="token operator">|</span>  <span class="token number">3</span> <span class="token operator">|</span> å®‹æ±Ÿ   <span class="token operator">|</span>      <span class="token number">87</span> <span class="token operator">|</span>      <span class="token number">78</span> <span class="token operator">|</span>   <span class="token number">77</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+--------+---------+---------+------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

<span class="token comment">-- For instance</span>
<span class="token comment">-- -- æŸ¥è¯¢æ¯ä¸ªéƒ¨é—¨å·¥èµ„é«˜äºæœ¬éƒ¨é—¨å¹³å‡å·¥èµ„æ°´å¹³çš„äººçš„æ•°æ®</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp<span class="token punctuation">;</span>
<span class="token comment">-- é¦–å…ˆåˆ—å‡ºæ¯ä¸ªéƒ¨é—¨çš„å¹³å‡å·¥èµ„</span>
<span class="token keyword">select</span> <span class="token function">avg</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">&#39;å¹³å‡å·¥èµ„&#39;</span><span class="token punctuation">,</span>deptno <span class="token keyword">from</span> emp <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> deptno<span class="token punctuation">;</span>
<span class="token comment">-- å°†æ¯ä¸ªéƒ¨é—¨çš„å¹³å‡å·¥èµ„å’Œéƒ¨é—¨çš„å¤šåˆ—ç»“æœä½œä¸ºå­æŸ¥è¯¢å¹¶å‘½ä¸ºä¸´æ—¶è¡¨</span>
<span class="token keyword">select</span> ename<span class="token punctuation">,</span>emp<span class="token punctuation">.</span>sal<span class="token punctuation">,</span>emp<span class="token punctuation">.</span>deptno<span class="token punctuation">,</span><span class="token keyword">temp</span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>å¹³å‡å·¥èµ„<span class="token punctuation">`</span></span>
<span class="token keyword">from</span> emp<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token function">avg</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">&#39;å¹³å‡å·¥èµ„&#39;</span><span class="token punctuation">,</span>deptno <span class="token keyword">from</span> emp <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> deptno<span class="token punctuation">)</span> <span class="token keyword">temp</span> 
<span class="token keyword">where</span> emp<span class="token punctuation">.</span>deptno <span class="token operator">=</span> <span class="token keyword">temp</span><span class="token punctuation">.</span>deptno <span class="token operator">and</span> emp<span class="token punctuation">.</span>sal <span class="token operator">&gt;</span> <span class="token keyword">temp</span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>å¹³å‡å·¥èµ„<span class="token punctuation">`</span></span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> emp<span class="token punctuation">.</span>deptno <span class="token keyword">DESC</span><span class="token punctuation">;</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> ename<span class="token punctuation">,</span>emp<span class="token punctuation">.</span>sal<span class="token punctuation">,</span>emp<span class="token punctuation">.</span>deptno<span class="token punctuation">,</span><span class="token keyword">temp</span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>å¹³å‡å·¥èµ„<span class="token punctuation">`</span></span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">from</span> emp<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token function">avg</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">&#39;å¹³å‡å·¥èµ„&#39;</span><span class="token punctuation">,</span>deptno <span class="token keyword">from</span> emp <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> deptno<span class="token punctuation">)</span> <span class="token keyword">temp</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">where</span> emp<span class="token punctuation">.</span>deptno <span class="token operator">=</span> <span class="token keyword">temp</span><span class="token punctuation">.</span>deptno <span class="token operator">and</span> emp<span class="token punctuation">.</span>sal <span class="token operator">&gt;</span> <span class="token keyword">temp</span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>å¹³å‡å·¥èµ„<span class="token punctuation">`</span></span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> emp<span class="token punctuation">.</span>deptno <span class="token keyword">DESC</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-------+---------+--------+--------------+</span>
<span class="token operator">|</span> ename <span class="token operator">|</span> sal     <span class="token operator">|</span> deptno <span class="token operator">|</span> å¹³å‡å·¥èµ„     <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+---------+--------+--------------+</span>
<span class="token operator">|</span> BLAKE <span class="token operator">|</span> <span class="token number">2850.00</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>  <span class="token number">1566.666667</span> <span class="token operator">|</span>
<span class="token operator">|</span> ALLEN <span class="token operator">|</span> <span class="token number">1600.00</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>  <span class="token number">1566.666667</span> <span class="token operator">|</span>
<span class="token operator">|</span> FORD  <span class="token operator">|</span> <span class="token number">3000.00</span> <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>  <span class="token number">2443.750000</span> <span class="token operator">|</span>
<span class="token operator">|</span> SCOTT <span class="token operator">|</span> <span class="token number">3000.00</span> <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>  <span class="token number">2443.750000</span> <span class="token operator">|</span>
<span class="token operator">|</span> JONES <span class="token operator">|</span> <span class="token number">2975.00</span> <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>  <span class="token number">2443.750000</span> <span class="token operator">|</span>
<span class="token operator">|</span> KING  <span class="token operator">|</span> <span class="token number">5000.00</span> <span class="token operator">|</span>     <span class="token number">10</span> <span class="token operator">|</span>  <span class="token number">2916.666667</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+---------+--------+--------------+</span>
<span class="token number">6</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

<span class="token comment">-- For instance</span>
<span class="token comment">-- æ˜¾ç¤ºæ¯ä¸ªéƒ¨é—¨çš„ä¿¡æ¯åŒ…æ‹¬ï¼ˆéƒ¨é—¨åï¼Œç¼–å·ï¼Œåœ°å€ï¼‰ å’Œäººå‘˜çš„æ•°é‡</span>
<span class="token comment">-- é¦–å…ˆå…ˆæ˜¾ç¤ºéƒ¨é—¨çš„ä¿¡æ¯ï¼ˆéƒ¨é—¨åï¼Œç¼–å·ï¼Œåœ°å€ï¼‰</span>
<span class="token keyword">select</span> dept<span class="token punctuation">.</span>deptno<span class="token punctuation">,</span>dept<span class="token punctuation">.</span>dname<span class="token punctuation">,</span>dept<span class="token punctuation">.</span>loc <span class="token keyword">from</span> dept<span class="token punctuation">;</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> dept<span class="token punctuation">.</span>deptno<span class="token punctuation">,</span>dept<span class="token punctuation">.</span>dname<span class="token punctuation">,</span>dept<span class="token punctuation">.</span>loc <span class="token keyword">from</span> dept<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">--------+------------+----------+</span>
<span class="token operator">|</span> deptno <span class="token operator">|</span> dname      <span class="token operator">|</span> loc      <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------+------------+----------+</span>
<span class="token operator">|</span>     <span class="token number">10</span> <span class="token operator">|</span> ACCOUNTING <span class="token operator">|</span> NEW YORK <span class="token operator">|</span>
<span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span> RESEARCH   <span class="token operator">|</span> DALLAS   <span class="token operator">|</span>
<span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span> SALES      <span class="token operator">|</span> CHICAGO  <span class="token operator">|</span>
<span class="token operator">|</span>     <span class="token number">40</span> <span class="token operator">|</span> OPERATIONS <span class="token operator">|</span> BOSTON   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------+------------+----------+</span>
<span class="token number">4</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> dept<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">from</span> dept<span class="token punctuation">;</span><span class="token comment">-- select åˆ—å.* from dept;è¡¨åå°†æ­¤è¡¨ä¸­çš„æ‰€æœ‰åˆ—çš„æ˜¾ç¤ºå‡ºæ¥</span>
<span class="token operator">+</span><span class="token comment">--------+------------+----------+</span>
<span class="token operator">|</span> deptno <span class="token operator">|</span> dname      <span class="token operator">|</span> loc      <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------+------------+----------+</span>
<span class="token operator">|</span>     <span class="token number">10</span> <span class="token operator">|</span> ACCOUNTING <span class="token operator">|</span> NEW YORK <span class="token operator">|</span>
<span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span> RESEARCH   <span class="token operator">|</span> DALLAS   <span class="token operator">|</span>
<span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span> SALES      <span class="token operator">|</span> CHICAGO  <span class="token operator">|</span>
<span class="token operator">|</span>     <span class="token number">40</span> <span class="token operator">|</span> OPERATIONS <span class="token operator">|</span> BOSTON   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------+------------+----------+</span>
<span class="token number">4</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span>
<span class="token keyword">select</span> dept<span class="token punctuation">.</span>deptno<span class="token punctuation">,</span>dept<span class="token punctuation">.</span>dname<span class="token punctuation">,</span>dept<span class="token punctuation">.</span>loc<span class="token punctuation">,</span><span class="token keyword">temp</span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>éƒ¨é—¨çš„äººå‘˜æ•°é‡<span class="token punctuation">`</span></span>
<span class="token keyword">from</span> dept<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span> emp<span class="token punctuation">.</span>deptno<span class="token punctuation">,</span><span class="token function">count</span><span class="token punctuation">(</span>emp<span class="token punctuation">.</span>deptno<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">&#39;éƒ¨é—¨çš„äººå‘˜æ•°é‡&#39;</span> <span class="token keyword">from</span> emp <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> emp<span class="token punctuation">.</span>deptno<span class="token punctuation">)</span> <span class="token keyword">temp</span>
<span class="token keyword">where</span> <span class="token keyword">temp</span><span class="token punctuation">.</span>deptno <span class="token operator">=</span> dept<span class="token punctuation">.</span>deptno<span class="token punctuation">;</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> dept<span class="token punctuation">.</span>deptno<span class="token punctuation">,</span>dept<span class="token punctuation">.</span>dname<span class="token punctuation">,</span>dept<span class="token punctuation">.</span>loc<span class="token punctuation">,</span><span class="token keyword">temp</span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>éƒ¨é—¨çš„äººå‘˜æ•°é‡<span class="token punctuation">`</span></span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">from</span> dept<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span> emp<span class="token punctuation">.</span>deptno<span class="token punctuation">,</span><span class="token function">count</span><span class="token punctuation">(</span>emp<span class="token punctuation">.</span>deptno<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">&#39;éƒ¨é—¨çš„äººå‘˜æ•°é‡&#39;</span> <span class="token keyword">from</span> emp <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> emp<span class="token punctuation">.</span>deptno<span class="token punctuation">)</span> <span class="token keyword">temp</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">where</span> <span class="token keyword">temp</span><span class="token punctuation">.</span>deptno <span class="token operator">=</span> dept<span class="token punctuation">.</span>deptno<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">--------+------------+----------+-----------------------+</span>
<span class="token operator">|</span> deptno <span class="token operator">|</span> dname      <span class="token operator">|</span> loc      <span class="token operator">|</span> éƒ¨é—¨çš„äººå‘˜æ•°é‡        <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------+------------+----------+-----------------------+</span>
<span class="token operator">|</span>     <span class="token number">10</span> <span class="token operator">|</span> ACCOUNTING <span class="token operator">|</span> NEW YORK <span class="token operator">|</span>                     <span class="token number">3</span> <span class="token operator">|</span>
<span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span> RESEARCH   <span class="token operator">|</span> DALLAS   <span class="token operator">|</span>                     <span class="token number">4</span> <span class="token operator">|</span>
<span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span> SALES      <span class="token operator">|</span> CHICAGO  <span class="token operator">|</span>                     <span class="token number">6</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------+------------+----------+-----------------------+</span>
<span class="token number">3</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="è¡¨å¤åˆ¶" tabindex="-1"><a class="header-anchor" href="#è¡¨å¤åˆ¶" aria-hidden="true">#</a> è¡¨å¤åˆ¶</h5><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">#è¡¨å¤åˆ¶-- è‡ªæˆ‘å¤åˆ¶ï¼ˆè •è™«å¤åˆ¶ï¼‰</span>
<span class="token comment">-- åˆ›å»ºä¸€ä¸ªå’Œstudentè¡¨ç›¸åŒç»“æ„çš„my_studentè¡¨</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> my_student1 <span class="token operator">like</span> my_student<span class="token punctuation">;</span><span class="token comment">-- å¯ä»¥ä½¿ç”¨create table æ–°è¡¨ like éœ€è¦å¼•ç”¨ç»“æ„çš„è¡¨</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> my_student <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">int</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">&#39;1&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">COLLATE</span> utf8mb3_bin <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>chinese<span class="token punctuation">`</span></span> <span class="token keyword">float</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">&#39;0&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>english<span class="token punctuation">`</span></span> <span class="token keyword">float</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">&#39;0&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>math<span class="token punctuation">`</span></span> <span class="token keyword">float</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">&#39;0&#39;</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb3 <span class="token keyword">COLLATE</span><span class="token operator">=</span>utf8mb3_bin
<span class="token comment">-- å°†studentè¡¨insert intoè¿›my_studentè¡¨</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> my_student <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> student<span class="token punctuation">;</span>
<span class="token comment">-- my_studentè¡¨è¿›è¡Œå¤šæ¬¡çš„è‡ªæˆ‘å¤åˆ¶ï¼ˆè •è™«å¤åˆ¶ï¼‰</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> my_student <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> my_student<span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> my_student<span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> my_student<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----------+</span>
<span class="token operator">|</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------+</span>
<span class="token operator">|</span>      <span class="token number">224</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="è¡¨å»é‡" tabindex="-1"><a class="header-anchor" href="#è¡¨å»é‡" aria-hidden="true">#</a> è¡¨å»é‡</h5><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">#è¡¨å»é‡</span>
<span class="token comment">-- æ€è·¯ </span>
<span class="token comment">-- â‘ åˆ›å»ºä¸€ä¸ªä¸´æ—¶è¡¨çš„ç»“æ„ä¸æƒ³è¦å»é‡çš„è¡¨çš„ç»“æ„ä¸€è‡´ </span>
<span class="token comment">-- â‘¡å¯¹ä¸´æ—¶è¡¨è¿›è¡Œdistinctå»é‡ </span>
<span class="token comment">-- â‘¢å°†æƒ³è¦å»é‡çš„è¡¨çš„æ•°æ®å…¨éƒ¨åˆ é™¤ </span>
<span class="token comment">-- â‘£å°†ä¸´æ—¶è¡¨çš„æ•°æ®insert intoè¿›åŸè¡¨ </span>
<span class="token comment">-- â‘¤dropé›¶æ—¶è¡¨</span>

<span class="token comment">-- å®ç°æµç¨‹</span>
<span class="token comment">-- åˆ›å»ºä¸€ä¸ªä¸´æ—¶è¡¨çš„ç»“æ„ä¸æƒ³è¦å»é‡çš„è¡¨çš„ç»“æ„ä¸€è‡´ </span>
<span class="token keyword">create</span> <span class="token keyword">table</span> temp_table <span class="token operator">like</span> my_student<span class="token punctuation">;</span>
<span class="token comment">-- å¯¹ä¸´æ—¶è¡¨è¿›è¡Œdistinctå»é‡ </span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> temp_table <span class="token keyword">select</span> <span class="token keyword">distinct</span> <span class="token operator">*</span> <span class="token keyword">from</span> my_student<span class="token punctuation">;</span>
<span class="token comment">-- å°†æƒ³è¦å»é‡çš„è¡¨çš„æ•°æ®å…¨éƒ¨åˆ é™¤</span>
<span class="token keyword">delete</span> <span class="token keyword">from</span> my_student<span class="token punctuation">;</span>
<span class="token comment">-- å°†ä¸´æ—¶è¡¨çš„æ•°æ®insert intoè¿›åŸè¡¨</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> my_student <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> temp_table<span class="token punctuation">;</span>
<span class="token comment">-- dropé›¶æ—¶è¡¨</span>
<span class="token keyword">drop</span> <span class="token keyword">table</span> temp_table<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="unionæ“ä½œç¬¦-åˆå¹¶æŸ¥è¯¢" tabindex="-1"><a class="header-anchor" href="#unionæ“ä½œç¬¦-åˆå¹¶æŸ¥è¯¢" aria-hidden="true">#</a> UNIONæ“ä½œç¬¦ åˆå¹¶æŸ¥è¯¢</h5><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">#UNION</span>
<span class="token comment">#MySQL UNION æ“ä½œç¬¦ç”¨äºè¿æ¥ä¸¤ä¸ªä»¥ä¸Šçš„ SELECT è¯­å¥çš„ç»“æœç»„åˆåˆ°ä¸€ä¸ªç»“æœé›†åˆä¸­ã€‚å¤šä¸ª SELECT è¯­å¥ä¼šåˆ é™¤é‡å¤çš„æ•°æ®ã€‚</span>
<span class="token comment">#MySQL UNION æ“ä½œç¬¦è¯­æ³•æ ¼å¼ï¼š</span>
<span class="token keyword">SELECT</span> expression1<span class="token punctuation">,</span> expression2<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> expression_n
<span class="token keyword">FROM</span> <span class="token keyword">tables</span>
<span class="token punctuation">[</span><span class="token keyword">WHERE</span> conditions<span class="token punctuation">]</span>
<span class="token keyword">UNION</span> <span class="token punctuation">[</span><span class="token keyword">ALL</span> <span class="token operator">|</span> <span class="token keyword">DISTINCT</span><span class="token punctuation">]</span>
<span class="token keyword">SELECT</span> expression1<span class="token punctuation">,</span> expression2<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> expression_n
<span class="token keyword">FROM</span> <span class="token keyword">tables</span>
<span class="token punctuation">[</span><span class="token keyword">WHERE</span> conditions<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">#å‚æ•°</span>
expression1<span class="token punctuation">,</span> expression2<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> expression_n: è¦æ£€ç´¢çš„åˆ—ã€‚

<span class="token keyword">tables</span>: è¦æ£€ç´¢çš„æ•°æ®è¡¨ã€‚

<span class="token keyword">WHERE</span> conditions: å¯é€‰ï¼Œ æ£€ç´¢æ¡ä»¶ã€‚

<span class="token keyword">DISTINCT</span>: å¯é€‰ï¼Œåˆ é™¤ç»“æœé›†ä¸­é‡å¤çš„æ•°æ®ã€‚é»˜è®¤æƒ…å†µä¸‹ <span class="token keyword">UNION</span> æ“ä½œç¬¦å·²ç»åˆ é™¤äº†é‡å¤æ•°æ®ï¼Œæ‰€ä»¥ <span class="token keyword">DISTINCT</span> ä¿®é¥°ç¬¦å¯¹ç»“æœæ²¡å•¥å½±å“ã€‚

<span class="token keyword">ALL</span>: å¯é€‰ï¼Œè¿”å›æ‰€æœ‰ç»“æœé›†ï¼ŒåŒ…å«é‡å¤æ•°æ®
<span class="token comment">-- tip:</span>
<span class="token keyword">UNION</span> è¯­å¥ï¼šç”¨äºå°†ä¸åŒè¡¨ä¸­ç›¸åŒåˆ—ä¸­æŸ¥è¯¢çš„æ•°æ®å±•ç¤ºå‡ºæ¥ï¼›ï¼ˆä¸åŒ…æ‹¬é‡å¤æ•°æ®ï¼‰

<span class="token keyword">UNION</span> <span class="token keyword">ALL</span> è¯­å¥ï¼šç”¨äºå°†ä¸åŒè¡¨ä¸­ç›¸åŒåˆ—ä¸­æŸ¥è¯¢çš„æ•°æ®å±•ç¤ºå‡ºæ¥ï¼›ï¼ˆåŒ…æ‹¬é‡å¤æ•°æ®ï¼‰

ä½¿ç”¨å½¢å¼å¦‚ä¸‹ï¼š

<span class="token keyword">SELECT</span> åˆ—åç§° <span class="token keyword">FROM</span> è¡¨åç§° <span class="token keyword">UNION</span> <span class="token keyword">SELECT</span> åˆ—åç§° <span class="token keyword">FROM</span> è¡¨åç§° <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> åˆ—åç§°ï¼›
<span class="token keyword">SELECT</span> åˆ—åç§° <span class="token keyword">FROM</span> è¡¨åç§° <span class="token keyword">UNION</span> <span class="token keyword">ALL</span> <span class="token keyword">SELECT</span> åˆ—åç§° <span class="token keyword">FROM</span> è¡¨åç§° <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> åˆ—åç§°ï¼›
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="å‡½æ•°â˜…" tabindex="-1"><a class="header-anchor" href="#å‡½æ•°â˜…" aria-hidden="true">#</a> å‡½æ•°â˜…</h4><h5 id="ç»Ÿè®¡å‡½æ•°" tabindex="-1"><a class="header-anchor" href="#ç»Ÿè®¡å‡½æ•°" aria-hidden="true">#</a> ç»Ÿè®¡å‡½æ•°</h5><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment"># SQL å‡½æ•°</span>

<span class="token comment">------</span>

<span class="token keyword">SQL</span> æ‹¥æœ‰å¾ˆå¤šå¯ç”¨äºè®¡æ•°å’Œè®¡ç®—çš„å†…å»ºå‡½æ•°ã€‚

<span class="token comment">------</span>

<span class="token comment">## SQL Aggregate å‡½æ•°</span>

<span class="token keyword">SQL</span> Aggregate å‡½æ•°è®¡ç®—ä»åˆ—ä¸­å–å¾—çš„å€¼ï¼Œè¿”å›ä¸€ä¸ªå•ä¸€çš„å€¼ã€‚

æœ‰ç”¨çš„ Aggregate å‡½æ•°ï¼š

<span class="token operator">-</span> <span class="token function">AVG</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> è¿”å›å¹³å‡å€¼
<span class="token operator">-</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> è¿”å›è¡Œæ•°
<span class="token operator">-</span> <span class="token function">FIRST</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> è¿”å›ç¬¬ä¸€ä¸ªè®°å½•çš„å€¼
<span class="token operator">-</span> <span class="token function">LAST</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> è¿”å›æœ€åä¸€ä¸ªè®°å½•çš„å€¼
<span class="token operator">-</span> <span class="token function">MAX</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> è¿”å›æœ€å¤§å€¼
<span class="token operator">-</span> <span class="token function">MIN</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> è¿”å›æœ€å°å€¼
<span class="token operator">-</span> <span class="token function">SUM</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> è¿”å›æ€»å’Œ

<span class="token comment">------</span>
<span class="token comment"># SQL COUNT() å‡½æ•°</span>

<span class="token comment">------</span>

<span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token punctuation">)</span> å‡½æ•°è¿”å›åŒ¹é…æŒ‡å®šæ¡ä»¶çš„è¡Œæ•°ã€‚

<span class="token comment">------</span>

<span class="token comment">### SQL COUNT(column_name) è¯­æ³•</span>

<span class="token function">COUNT</span><span class="token punctuation">(</span>column_name<span class="token punctuation">)</span> å‡½æ•°è¿”å›æŒ‡å®šåˆ—çš„å€¼çš„æ•°ç›®ï¼ˆ<span class="token boolean">NULL</span> ä¸è®¡å…¥ï¼‰ï¼š<span class="token comment">-- ç»Ÿè®¡æ»¡è¶³æ¡ä»¶çš„æŸåˆ—æœ‰å¤šå°‘ä¸ªï¼ˆä¼šæ’é™¤nullï¼‰</span>

<span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span>column_name<span class="token punctuation">)</span> <span class="token keyword">FROM</span> table_name<span class="token punctuation">;</span>

<span class="token comment">### SQL COUNT(*) è¯­æ³•</span>

<span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> å‡½æ•°è¿”å›è¡¨ä¸­çš„è®°å½•æ•°ï¼š<span class="token comment">-- è¿”å›æ»¡è¶³æ¡ä»¶çš„è®°å½•çš„è¡Œæ•°</span>

<span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> table_name<span class="token punctuation">;</span>

<span class="token comment">### SQL COUNT(DISTINCT column_name) è¯­æ³•</span>

<span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> column_name<span class="token punctuation">)</span> å‡½æ•°è¿”å›æŒ‡å®šåˆ—çš„ä¸åŒå€¼çš„æ•°ç›®ï¼š

<span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> column_name<span class="token punctuation">)</span> <span class="token keyword">FROM</span> table_name<span class="token punctuation">;</span>

<span class="token operator">*</span><span class="token operator">*</span>æ³¨é‡Šï¼š<span class="token operator">*</span><span class="token operator">*</span><span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span><span class="token punctuation">)</span> é€‚ç”¨äº ORACLE å’Œ Microsoft <span class="token keyword">SQL</span> Serverï¼Œä½†æ˜¯æ— æ³•ç”¨äº Microsoft Access

<span class="token comment">-- For instance</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> access1<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+---------+-------+------------+</span>
<span class="token operator">|</span> aid  <span class="token operator">|</span> site_id <span class="token operator">|</span> count <span class="token operator">|</span> <span class="token keyword">date</span>       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+---------+-------+------------+</span>
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span>       <span class="token number">1</span> <span class="token operator">|</span>    <span class="token number">45</span> <span class="token operator">|</span> <span class="token number">2016</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">2</span> <span class="token operator">|</span>       <span class="token number">3</span> <span class="token operator">|</span>   <span class="token number">100</span> <span class="token operator">|</span> <span class="token number">2016</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">13</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">3</span> <span class="token operator">|</span>       <span class="token number">1</span> <span class="token operator">|</span>   <span class="token number">230</span> <span class="token operator">|</span> <span class="token number">2016</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">14</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">4</span> <span class="token operator">|</span>       <span class="token number">2</span> <span class="token operator">|</span>    <span class="token number">10</span> <span class="token operator">|</span> <span class="token number">2016</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">14</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">5</span> <span class="token operator">|</span>       <span class="token number">5</span> <span class="token operator">|</span>   <span class="token number">205</span> <span class="token operator">|</span> <span class="token number">2016</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">14</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">6</span> <span class="token operator">|</span>       <span class="token number">4</span> <span class="token operator">|</span>    <span class="token number">13</span> <span class="token operator">|</span> <span class="token number">2016</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">15</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">7</span> <span class="token operator">|</span>       <span class="token number">3</span> <span class="token operator">|</span>   <span class="token number">220</span> <span class="token operator">|</span> <span class="token number">2016</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">15</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">8</span> <span class="token operator">|</span>       <span class="token number">5</span> <span class="token operator">|</span>   <span class="token number">545</span> <span class="token operator">|</span> <span class="token number">2016</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">16</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">9</span> <span class="token operator">|</span>       <span class="token number">3</span> <span class="token operator">|</span>   <span class="token number">201</span> <span class="token operator">|</span> <span class="token number">2016</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">17</span> <span class="token operator">|</span>
<span class="token operator">|</span>   <span class="token number">10</span> <span class="token operator">|</span>       <span class="token number">3</span> <span class="token operator">|</span>  <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token number">2016</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">25</span> <span class="token operator">|</span>
<span class="token operator">|</span>   <span class="token number">11</span> <span class="token operator">|</span>       <span class="token number">3</span> <span class="token operator">|</span>  <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token number">2016</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">26</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+---------+-------+------------+</span>
<span class="token number">11</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> access1 <span class="token keyword">where</span> site_id<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">;</span><span class="token comment">-- è¿”å›æ»¡è¶³æ¡ä»¶çš„è®°å½•çš„è¡Œæ•°</span>
<span class="token operator">+</span><span class="token comment">----------+</span>
<span class="token operator">|</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------+</span>
<span class="token operator">|</span>        <span class="token number">5</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span> <span class="token keyword">from</span> access1 <span class="token keyword">where</span> site_id<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">;</span><span class="token comment">-- ç»Ÿè®¡æ»¡è¶³æ¡ä»¶çš„æŸåˆ—æœ‰å¤šå°‘ä¸ªï¼ˆä¼šæ’é™¤nullï¼‰</span>
<span class="token operator">+</span><span class="token comment">--------------+</span>
<span class="token operator">|</span> <span class="token function">count</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------+</span>
<span class="token operator">|</span>            <span class="token number">3</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token keyword">distinct</span> site_id<span class="token punctuation">)</span> <span class="token keyword">from</span> access1 <span class="token keyword">where</span> site_id<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">;</span><span class="token comment">-- å‡½æ•°è¿”å›æŒ‡å®šåˆ—çš„ä¸åŒå€¼ï¼ˆéé‡å¤ï¼‰çš„æ•°ç›®ï¼š</span>
<span class="token operator">+</span><span class="token comment">-------------------------+</span>
<span class="token operator">|</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token keyword">distinct</span> site_id<span class="token punctuation">)</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------------------+</span>
<span class="token operator">|</span>                       <span class="token number">1</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span>site_id<span class="token punctuation">)</span> <span class="token keyword">from</span> access1 <span class="token keyword">where</span> site_id<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----------------+</span>
<span class="token operator">|</span> <span class="token function">count</span><span class="token punctuation">(</span>site_id<span class="token punctuation">)</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------+</span>
<span class="token operator">|</span>              <span class="token number">5</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

<span class="token comment">#AVG() å‡½æ•°</span>
<span class="token function">AVG</span><span class="token punctuation">(</span><span class="token punctuation">)</span> å‡½æ•°è¿”å›æ•°å€¼åˆ—çš„å¹³å‡å€¼ã€‚

<span class="token keyword">SQL</span> <span class="token function">AVG</span><span class="token punctuation">(</span><span class="token punctuation">)</span> è¯­æ³•
<span class="token keyword">SELECT</span> <span class="token function">AVG</span><span class="token punctuation">(</span>column_name<span class="token punctuation">)</span> <span class="token keyword">FROM</span> table_name

<span class="token comment">-- For instance</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> access1<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+---------+-------+------------+</span>
<span class="token operator">|</span> aid  <span class="token operator">|</span> site_id <span class="token operator">|</span> count <span class="token operator">|</span> <span class="token keyword">date</span>       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+---------+-------+------------+</span>
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span>       <span class="token number">1</span> <span class="token operator">|</span>    <span class="token number">45</span> <span class="token operator">|</span> <span class="token number">2016</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">2</span> <span class="token operator">|</span>       <span class="token number">3</span> <span class="token operator">|</span>   <span class="token number">100</span> <span class="token operator">|</span> <span class="token number">2016</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">13</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">3</span> <span class="token operator">|</span>       <span class="token number">1</span> <span class="token operator">|</span>   <span class="token number">230</span> <span class="token operator">|</span> <span class="token number">2016</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">14</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">4</span> <span class="token operator">|</span>       <span class="token number">2</span> <span class="token operator">|</span>    <span class="token number">10</span> <span class="token operator">|</span> <span class="token number">2016</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">14</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">5</span> <span class="token operator">|</span>       <span class="token number">5</span> <span class="token operator">|</span>   <span class="token number">205</span> <span class="token operator">|</span> <span class="token number">2016</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">14</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">6</span> <span class="token operator">|</span>       <span class="token number">4</span> <span class="token operator">|</span>    <span class="token number">13</span> <span class="token operator">|</span> <span class="token number">2016</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">15</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">7</span> <span class="token operator">|</span>       <span class="token number">3</span> <span class="token operator">|</span>   <span class="token number">220</span> <span class="token operator">|</span> <span class="token number">2016</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">15</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">8</span> <span class="token operator">|</span>       <span class="token number">5</span> <span class="token operator">|</span>   <span class="token number">545</span> <span class="token operator">|</span> <span class="token number">2016</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">16</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">9</span> <span class="token operator">|</span>       <span class="token number">3</span> <span class="token operator">|</span>   <span class="token number">201</span> <span class="token operator">|</span> <span class="token number">2016</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">17</span> <span class="token operator">|</span>
<span class="token operator">|</span>   <span class="token number">10</span> <span class="token operator">|</span>       <span class="token number">3</span> <span class="token operator">|</span>  <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token number">2016</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">25</span> <span class="token operator">|</span>
<span class="token operator">|</span>   <span class="token number">11</span> <span class="token operator">|</span>       <span class="token number">3</span> <span class="token operator">|</span>  <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token number">2016</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">26</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+---------+-------+------------+</span>
<span class="token number">11</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> average<span class="token punctuation">(</span>count<span class="token punctuation">)</span> <span class="token keyword">from</span> access1<span class="token punctuation">;</span>
ERROR <span class="token number">1305</span> <span class="token punctuation">(</span><span class="token number">42000</span><span class="token punctuation">)</span>: <span class="token keyword">FUNCTION</span> db02<span class="token punctuation">.</span>average does <span class="token operator">not</span> exist
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token function">avg</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token identifier"><span class="token punctuation">`</span>CountAverage<span class="token punctuation">`</span></span> <span class="token keyword">from</span> access1<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">--------------+</span>
<span class="token operator">|</span> CountAverage <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------+</span>
<span class="token operator">|</span>     <span class="token number">174.3333</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> site_id <span class="token keyword">from</span> access1 <span class="token keyword">where</span> count <span class="token operator">&gt;=</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token function">avg</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span> <span class="token keyword">from</span> access1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------+</span>
<span class="token operator">|</span> site_id <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+</span>
<span class="token operator">|</span>       <span class="token number">1</span> <span class="token operator">|</span>
<span class="token operator">|</span>       <span class="token number">5</span> <span class="token operator">|</span>
<span class="token operator">|</span>       <span class="token number">3</span> <span class="token operator">|</span>
<span class="token operator">|</span>       <span class="token number">5</span> <span class="token operator">|</span>
<span class="token operator">|</span>       <span class="token number">3</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+</span>
<span class="token number">5</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.13</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> site_id<span class="token punctuation">,</span>count <span class="token keyword">from</span> access1 <span class="token keyword">where</span> count <span class="token operator">&gt;=</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token function">avg</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span> <span class="token keyword">from</span> access1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------+-------+</span>
<span class="token operator">|</span> site_id <span class="token operator">|</span> count <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+-------+</span>
<span class="token operator">|</span>       <span class="token number">1</span> <span class="token operator">|</span>   <span class="token number">230</span> <span class="token operator">|</span>
<span class="token operator">|</span>       <span class="token number">5</span> <span class="token operator">|</span>   <span class="token number">205</span> <span class="token operator">|</span>
<span class="token operator">|</span>       <span class="token number">3</span> <span class="token operator">|</span>   <span class="token number">220</span> <span class="token operator">|</span>
<span class="token operator">|</span>       <span class="token number">5</span> <span class="token operator">|</span>   <span class="token number">545</span> <span class="token operator">|</span>
<span class="token operator">|</span>       <span class="token number">3</span> <span class="token operator">|</span>   <span class="token number">201</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+-------+</span>
<span class="token number">5</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

<span class="token comment">#SUM() å‡½æ•°</span>
<span class="token function">SUM</span><span class="token punctuation">(</span><span class="token punctuation">)</span> å‡½æ•°è¿”å›æ•°å€¼åˆ—çš„æ€»æ•°ã€‚

<span class="token keyword">SQL</span> <span class="token function">SUM</span><span class="token punctuation">(</span><span class="token punctuation">)</span> è¯­æ³•
<span class="token keyword">SELECT</span> <span class="token function">SUM</span><span class="token punctuation">(</span>column_name<span class="token punctuation">)</span> <span class="token keyword">FROM</span> table_name<span class="token punctuation">;</span><span class="token comment">-- ä»…å¯¹æ•°å€¼èµ·ä½œç”¨</span>

<span class="token comment">-- For instance</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> student_score1<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-----------+--------+------------+---------------+---------------+</span>
<span class="token operator">|</span> name      <span class="token operator">|</span> number <span class="token operator">|</span> Math_score <span class="token operator">|</span> Chinese_score <span class="token operator">|</span> English_score <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------+--------+------------+---------------+---------------+</span>
<span class="token operator">|</span> å¼ é”¦è±ª    <span class="token operator">|</span>   <span class="token number">1001</span> <span class="token operator">|</span>         <span class="token number">99</span> <span class="token operator">|</span>            <span class="token number">95</span> <span class="token operator">|</span>            <span class="token number">91</span> <span class="token operator">|</span>
<span class="token operator">|</span> æ¬§æ–‡      <span class="token operator">|</span>   <span class="token number">1002</span> <span class="token operator">|</span>         <span class="token number">92</span> <span class="token operator">|</span>            <span class="token number">94</span> <span class="token operator">|</span>            <span class="token number">99</span> <span class="token operator">|</span>
<span class="token operator">|</span> è©¹å§†æ–¯    <span class="token operator">|</span>   <span class="token number">1003</span> <span class="token operator">|</span>         <span class="token number">93</span> <span class="token operator">|</span>            <span class="token number">95</span> <span class="token operator">|</span>            <span class="token number">99</span> <span class="token operator">|</span>
<span class="token operator">|</span> æœå…°ç‰¹    <span class="token operator">|</span>   <span class="token number">1004</span> <span class="token operator">|</span>         <span class="token number">92</span> <span class="token operator">|</span>            <span class="token number">91</span> <span class="token operator">|</span>            <span class="token number">99</span> <span class="token operator">|</span>
<span class="token operator">|</span> åº“é‡Œ      <span class="token operator">|</span>   <span class="token number">1005</span> <span class="token operator">|</span>         <span class="token number">92</span> <span class="token operator">|</span>            <span class="token number">92</span> <span class="token operator">|</span>            <span class="token number">98</span> <span class="token operator">|</span>
<span class="token operator">|</span> å“ˆç™»      <span class="token operator">|</span>   <span class="token number">1006</span> <span class="token operator">|</span>         <span class="token number">90</span> <span class="token operator">|</span>            <span class="token number">91</span> <span class="token operator">|</span>            <span class="token number">94</span> <span class="token operator">|</span>
<span class="token operator">|</span> ä¸œä¸ƒä¸ƒ    <span class="token operator">|</span>   <span class="token number">1007</span> <span class="token operator">|</span>         <span class="token number">91</span> <span class="token operator">|</span>            <span class="token number">93</span> <span class="token operator">|</span>            <span class="token number">98</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------+--------+------------+---------------+---------------+</span>
<span class="token number">7</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token function">sum</span><span class="token punctuation">(</span>Math_score <span class="token operator">+</span> Chinese_score <span class="token operator">+</span> English_score<span class="token punctuation">)</span> <span class="token keyword">as</span> sum_score <span class="token keyword">from</span> student_score1<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-----------+</span>
<span class="token operator">|</span> sum_score <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------+</span>
<span class="token operator">|</span>      <span class="token number">1978</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token function">sum</span><span class="token punctuation">(</span>Math_score <span class="token operator">+</span> Chinese_score <span class="token operator">+</span> English_score<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">as</span> sum_score <span class="token keyword">from</span> student_score1<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">--------------------+</span>
<span class="token operator">|</span> sum_score          <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------------+</span>
<span class="token operator">|</span> <span class="token number">282.57142857142856</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span>

<span class="token comment">#MAX() å‡½æ•°</span>
<span class="token function">MAX</span><span class="token punctuation">(</span><span class="token punctuation">)</span> å‡½æ•°è¿”å›æŒ‡å®šåˆ—çš„æœ€å¤§å€¼ã€‚

<span class="token keyword">SQL</span> <span class="token function">MAX</span><span class="token punctuation">(</span><span class="token punctuation">)</span> è¯­æ³•
<span class="token keyword">SELECT</span> <span class="token function">MAX</span><span class="token punctuation">(</span>column_name<span class="token punctuation">)</span> <span class="token keyword">FROM</span> table_name<span class="token punctuation">;</span>
<span class="token comment">#MIN() å‡½æ•°</span>
<span class="token function">MIN</span><span class="token punctuation">(</span><span class="token punctuation">)</span> å‡½æ•°è¿”å›æŒ‡å®šåˆ—çš„æœ€å°å€¼ã€‚

<span class="token keyword">SQL</span> <span class="token function">MIN</span><span class="token punctuation">(</span><span class="token punctuation">)</span> è¯­æ³•
<span class="token keyword">SELECT</span> <span class="token function">MIN</span><span class="token punctuation">(</span>column_name<span class="token punctuation">)</span> <span class="token keyword">FROM</span> table_name<span class="token punctuation">;</span>

<span class="token comment">-- For instance</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> access1<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+---------+-------+------------+</span>
<span class="token operator">|</span> aid  <span class="token operator">|</span> site_id <span class="token operator">|</span> count <span class="token operator">|</span> <span class="token keyword">date</span>       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+---------+-------+------------+</span>
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span>       <span class="token number">1</span> <span class="token operator">|</span>    <span class="token number">45</span> <span class="token operator">|</span> <span class="token number">2016</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">2</span> <span class="token operator">|</span>       <span class="token number">3</span> <span class="token operator">|</span>   <span class="token number">100</span> <span class="token operator">|</span> <span class="token number">2016</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">13</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">3</span> <span class="token operator">|</span>       <span class="token number">1</span> <span class="token operator">|</span>   <span class="token number">230</span> <span class="token operator">|</span> <span class="token number">2016</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">14</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">4</span> <span class="token operator">|</span>       <span class="token number">2</span> <span class="token operator">|</span>    <span class="token number">10</span> <span class="token operator">|</span> <span class="token number">2016</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">14</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">5</span> <span class="token operator">|</span>       <span class="token number">5</span> <span class="token operator">|</span>   <span class="token number">205</span> <span class="token operator">|</span> <span class="token number">2016</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">14</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">6</span> <span class="token operator">|</span>       <span class="token number">4</span> <span class="token operator">|</span>    <span class="token number">13</span> <span class="token operator">|</span> <span class="token number">2016</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">15</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">7</span> <span class="token operator">|</span>       <span class="token number">3</span> <span class="token operator">|</span>   <span class="token number">220</span> <span class="token operator">|</span> <span class="token number">2016</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">15</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">8</span> <span class="token operator">|</span>       <span class="token number">5</span> <span class="token operator">|</span>   <span class="token number">545</span> <span class="token operator">|</span> <span class="token number">2016</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">16</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">9</span> <span class="token operator">|</span>       <span class="token number">3</span> <span class="token operator">|</span>   <span class="token number">201</span> <span class="token operator">|</span> <span class="token number">2016</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">17</span> <span class="token operator">|</span>
<span class="token operator">|</span>   <span class="token number">10</span> <span class="token operator">|</span>       <span class="token number">3</span> <span class="token operator">|</span>  <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token number">2016</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">25</span> <span class="token operator">|</span>
<span class="token operator">|</span>   <span class="token number">11</span> <span class="token operator">|</span>       <span class="token number">3</span> <span class="token operator">|</span>  <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token number">2016</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">26</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+---------+-------+------------+</span>
<span class="token number">11</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token function">max</span><span class="token punctuation">(</span>Math_score <span class="token operator">+</span> Chinese_score <span class="token operator">+</span> English_score<span class="token punctuation">)</span> <span class="token keyword">as</span> max_sum_score <span class="token keyword">from</span> student_score1<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------------+</span>
<span class="token operator">|</span> max_sum_score <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------+</span>
<span class="token operator">|</span>           <span class="token number">287</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token function">min</span><span class="token punctuation">(</span>Math_score <span class="token operator">+</span> Chinese_score <span class="token operator">+</span> English_score<span class="token punctuation">)</span> <span class="token keyword">as</span> min_sum_score <span class="token keyword">from</span> student_score1<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------------+</span>
<span class="token operator">|</span> min_sum_score <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------+</span>
<span class="token operator">|</span>           <span class="token number">275</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span>

<span class="token comment">#SQL GROUP BY è¯­å¥</span>
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> è¯­å¥
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> è¯­å¥ç”¨äºç»“åˆèšåˆå‡½æ•°ï¼Œæ ¹æ®ä¸€ä¸ªæˆ–å¤šä¸ªåˆ—å¯¹ç»“æœé›†è¿›è¡Œåˆ†ç»„ã€‚

<span class="token keyword">SQL</span> <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> è¯­æ³•
<span class="token keyword">SELECT</span> column_name<span class="token punctuation">,</span> aggregate_function<span class="token punctuation">(</span>column_name<span class="token punctuation">)</span>
<span class="token keyword">FROM</span> table_name
<span class="token keyword">WHERE</span> column_name operator <span class="token keyword">value</span>
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> column_name<span class="token punctuation">;</span>
<span class="token comment">#SQL HAVING å­å¥</span>
<span class="token keyword">HAVING</span> å­å¥
åœ¨ <span class="token keyword">SQL</span> ä¸­å¢åŠ  <span class="token keyword">HAVING</span> å­å¥åŸå› æ˜¯ï¼Œ<span class="token keyword">WHERE</span> å…³é”®å­—æ— æ³•ä¸èšåˆå‡½æ•°ä¸€èµ·ä½¿ç”¨ã€‚

<span class="token keyword">HAVING</span> å­å¥å¯ä»¥è®©æˆ‘ä»¬ç­›é€‰åˆ†ç»„åçš„å„ç»„æ•°æ®ã€‚

<span class="token keyword">SQL</span> <span class="token keyword">HAVING</span> è¯­æ³•
<span class="token keyword">SQL</span> <span class="token keyword">HAVING</span> è¯­æ³•
<span class="token keyword">SELECT</span> column_name<span class="token punctuation">,</span> aggregate_function<span class="token punctuation">(</span>column_name<span class="token punctuation">)</span>
<span class="token keyword">FROM</span> table_name
<span class="token keyword">WHERE</span> column_name operator <span class="token keyword">value</span>
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> column_name
<span class="token keyword">HAVING</span> aggregate_function<span class="token punctuation">(</span>column_name<span class="token punctuation">)</span> operator <span class="token keyword">value</span><span class="token punctuation">;</span>

<span class="token comment">-- For instance</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-------+--------+-----------+------+------------+---------+---------+--------+</span>
<span class="token operator">|</span> empno <span class="token operator">|</span> ename  <span class="token operator">|</span> job       <span class="token operator">|</span> mgr  <span class="token operator">|</span> hiredate   <span class="token operator">|</span> sal     <span class="token operator">|</span> comm    <span class="token operator">|</span> deptno <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+--------+-----------+------+------------+---------+---------+--------+</span>
<span class="token operator">|</span>  <span class="token number">7369</span> <span class="token operator">|</span> SMITH  <span class="token operator">|</span> CLERK     <span class="token operator">|</span> <span class="token number">7902</span> <span class="token operator">|</span> <span class="token number">1990</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">17</span> <span class="token operator">|</span>  <span class="token number">800.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7499</span> <span class="token operator">|</span> ALLEN  <span class="token operator">|</span> SALESMAN  <span class="token operator">|</span> <span class="token number">7698</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">20</span> <span class="token operator">|</span> <span class="token number">1600.00</span> <span class="token operator">|</span>  <span class="token number">300.00</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7521</span> <span class="token operator">|</span> WARD   <span class="token operator">|</span> SALESMAN  <span class="token operator">|</span> <span class="token number">7698</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">22</span> <span class="token operator">|</span> <span class="token number">1250.00</span> <span class="token operator">|</span>  <span class="token number">500.00</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7566</span> <span class="token operator">|</span> JONES  <span class="token operator">|</span> MANAGER   <span class="token operator">|</span> <span class="token number">7839</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">02</span> <span class="token operator">|</span> <span class="token number">2975.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7654</span> <span class="token operator">|</span> MARTIN <span class="token operator">|</span> SALESMAN  <span class="token operator">|</span> <span class="token number">7698</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">28</span> <span class="token operator">|</span> <span class="token number">1250.00</span> <span class="token operator">|</span> <span class="token number">1400.00</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7698</span> <span class="token operator">|</span> BLAKE  <span class="token operator">|</span> MANAGER   <span class="token operator">|</span> <span class="token number">7839</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">01</span> <span class="token operator">|</span> <span class="token number">2850.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7782</span> <span class="token operator">|</span> CLARK  <span class="token operator">|</span> MANAGER   <span class="token operator">|</span> <span class="token number">7839</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">09</span> <span class="token operator">|</span> <span class="token number">2450.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7788</span> <span class="token operator">|</span> SCOTT  <span class="token operator">|</span> ANALYST   <span class="token operator">|</span> <span class="token number">7566</span> <span class="token operator">|</span> <span class="token number">1997</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">19</span> <span class="token operator">|</span> <span class="token number">3000.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7839</span> <span class="token operator">|</span> KING   <span class="token operator">|</span> PRESIDENT <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">17</span> <span class="token operator">|</span> <span class="token number">5000.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7844</span> <span class="token operator">|</span> TURNER <span class="token operator">|</span> SALESMAN  <span class="token operator">|</span> <span class="token number">7698</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">08</span> <span class="token operator">|</span> <span class="token number">1500.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7900</span> <span class="token operator">|</span> JAMES  <span class="token operator">|</span> CLERK     <span class="token operator">|</span> <span class="token number">7698</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">03</span> <span class="token operator">|</span>  <span class="token number">950.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7902</span> <span class="token operator">|</span> FORD   <span class="token operator">|</span> ANALYST   <span class="token operator">|</span> <span class="token number">7566</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">03</span> <span class="token operator">|</span> <span class="token number">3000.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7934</span> <span class="token operator">|</span> MILLER <span class="token operator">|</span> CLERK     <span class="token operator">|</span> <span class="token number">7782</span> <span class="token operator">|</span> <span class="token number">1992</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">23</span> <span class="token operator">|</span> <span class="token number">1300.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+--------+-----------+------+------------+---------+---------+--------+</span>
<span class="token number">13</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> salgrade
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token punctuation">(</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> grade <span class="token keyword">MEDIUMINT</span> <span class="token keyword">UNSIGNED</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">/*å·¥èµ„çº§åˆ«*/</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> losal <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">17</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token comment">/* è¯¥çº§åˆ«çš„æœ€ä½å·¥èµ„ */</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> hisal <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">17</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token comment">/* è¯¥çº§åˆ«çš„æœ€é«˜å·¥èµ„*/</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> salgrade <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">700</span><span class="token punctuation">,</span><span class="token number">1200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">row</span> affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> salgrade <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1201</span><span class="token punctuation">,</span><span class="token number">1400</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">row</span> affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> salgrade <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1401</span><span class="token punctuation">,</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">row</span> affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> salgrade <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">2001</span><span class="token punctuation">,</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">row</span> affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> salgrade <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">3001</span><span class="token punctuation">,</span><span class="token number">9999</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">row</span> affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> salgrade<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-------+---------+---------+</span>
<span class="token operator">|</span> grade <span class="token operator">|</span> losal   <span class="token operator">|</span> hisal   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+---------+---------+</span>
<span class="token operator">|</span>     <span class="token number">1</span> <span class="token operator">|</span>  <span class="token number">700.00</span> <span class="token operator">|</span> <span class="token number">1200.00</span> <span class="token operator">|</span>
<span class="token operator">|</span>     <span class="token number">2</span> <span class="token operator">|</span> <span class="token number">1201.00</span> <span class="token operator">|</span> <span class="token number">1400.00</span> <span class="token operator">|</span>
<span class="token operator">|</span>     <span class="token number">3</span> <span class="token operator">|</span> <span class="token number">1401.00</span> <span class="token operator">|</span> <span class="token number">2000.00</span> <span class="token operator">|</span>
<span class="token operator">|</span>     <span class="token number">4</span> <span class="token operator">|</span> <span class="token number">2001.00</span> <span class="token operator">|</span> <span class="token number">3000.00</span> <span class="token operator">|</span>
<span class="token operator">|</span>     <span class="token number">5</span> <span class="token operator">|</span> <span class="token number">3001.00</span> <span class="token operator">|</span> <span class="token number">9999.00</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+---------+---------+</span>
<span class="token number">5</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token function">avg</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token identifier"><span class="token punctuation">`</span>avg<span class="token punctuation">`</span></span><span class="token punctuation">,</span><span class="token function">max</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token identifier"><span class="token punctuation">`</span>max<span class="token punctuation">`</span></span> <span class="token keyword">from</span> emp<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-------------+---------+</span>
<span class="token operator">|</span> avg         <span class="token operator">|</span> max     <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------+---------+</span>
<span class="token operator">|</span> <span class="token number">2148.076923</span> <span class="token operator">|</span> <span class="token number">5000.00</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------+---------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token function">avg</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">max</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span><span class="token punctuation">,</span>deptno <span class="token keyword">from</span> emp <span class="token keyword">group</span> <span class="token keyword">by</span> deptno<span class="token punctuation">;</span><span class="token comment">-- group by æ ¹æ®åˆ—è¿›è¡Œåˆ†ç»„</span>
<span class="token operator">+</span><span class="token comment">-------------+----------+--------+</span>
<span class="token operator">|</span> <span class="token function">avg</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span>    <span class="token operator">|</span> <span class="token function">max</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span> <span class="token operator">|</span> deptno <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------+----------+--------+</span>
<span class="token operator">|</span> <span class="token number">2443.750000</span> <span class="token operator">|</span>  <span class="token number">3000.00</span> <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">1566.666667</span> <span class="token operator">|</span>  <span class="token number">2850.00</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2916.666667</span> <span class="token operator">|</span>  <span class="token number">5000.00</span> <span class="token operator">|</span>     <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------+----------+--------+</span>
<span class="token number">3</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token function">avg</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">max</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span><span class="token punctuation">,</span>deptno <span class="token keyword">from</span> emp <span class="token keyword">group</span> <span class="token keyword">by</span> deptno <span class="token keyword">having</span> <span class="token function">avg</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">2000.00</span><span class="token punctuation">;</span><span class="token comment">-- group by æ ¹æ®åˆ—è¿›è¡Œåˆ†ç»„ having æ¡ä»¶ç­›é€‰</span>
<span class="token operator">+</span><span class="token comment">-------------+----------+--------+</span>
<span class="token operator">|</span> <span class="token function">avg</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span>    <span class="token operator">|</span> <span class="token function">max</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span> <span class="token operator">|</span> deptno <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------+----------+--------+</span>
<span class="token operator">|</span> <span class="token number">2443.750000</span> <span class="token operator">|</span>  <span class="token number">3000.00</span> <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2916.666667</span> <span class="token operator">|</span>  <span class="token number">5000.00</span> <span class="token operator">|</span>     <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------+----------+--------+</span>
<span class="token number">2</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="æ—¶é—´æ—¥æœŸ" tabindex="-1"><a class="header-anchor" href="#æ—¶é—´æ—¥æœŸ" aria-hidden="true">#</a> æ—¶é—´æ—¥æœŸ</h5><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">#CURDATE()	è¿”å›å½“å‰æ—¥æœŸ	</span>
<span class="token keyword">SELECT</span> CURDATE<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">2018</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">19</span>
<span class="token comment">#CURRENT_DATE()	è¿”å›å½“å‰æ—¥æœŸ	</span>
<span class="token keyword">SELECT</span> <span class="token keyword">CURRENT_DATE</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">2018</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">19</span>

<span class="token comment">#CURRENT_TIME	è¿”å›å½“å‰æ—¶é—´	</span>
<span class="token keyword">SELECT</span> <span class="token keyword">CURRENT_TIME</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">19</span>:<span class="token number">59</span>:<span class="token number">02</span>

<span class="token comment">#LAST_DAY   è¿”å›æŸä¸ªæœˆçš„æœ€åä¸€å¤©</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> last_day<span class="token punctuation">(</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-----------------+</span>
<span class="token operator">|</span> last_day<span class="token punctuation">(</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------------+</span>
<span class="token operator">|</span> <span class="token number">2022</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">30</span>      <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> LAST_DAY<span class="token punctuation">(</span><span class="token string">&#39;2022-08-04&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------------------------+</span>
<span class="token operator">|</span> LAST_DAY<span class="token punctuation">(</span><span class="token string">&#39;2022-08-04&#39;</span><span class="token punctuation">)</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------------------+</span>
<span class="token operator">|</span> <span class="token number">2022</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">31</span>             <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

<span class="token comment">#CURTIME()	è¿”å›å½“å‰æ—¶é—´	</span>
<span class="token keyword">SELECT</span> CURTIME<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">19</span>:<span class="token number">59</span>:<span class="token number">02</span>

<span class="token comment">#CURRENT_TIMESTAMP()	è¿”å›å½“å‰æ—¥æœŸå’Œæ—¶é—´(æ—¶é—´æˆ³)	</span>
<span class="token keyword">SELECT</span> <span class="token keyword">CURRENT_TIMESTAMP</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">2018</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">19</span> <span class="token number">20</span>:<span class="token number">57</span>:<span class="token number">43</span>

<span class="token comment">#DATE()	ä»æ—¥æœŸæˆ–æ—¥æœŸæ—¶é—´è¡¨è¾¾å¼ä¸­æå–æ—¥æœŸå€¼	</span>
<span class="token keyword">SELECT</span> <span class="token keyword">DATE</span><span class="token punctuation">(</span><span class="token string">&quot;2017-06-15&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
<span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">2017</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">15</span>
<span class="token comment">-- For instance</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token keyword">current_timestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------------------+</span>
<span class="token operator">|</span> <span class="token keyword">current_timestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------------+</span>
<span class="token operator">|</span> <span class="token number">2022</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">02</span> <span class="token number">19</span>:<span class="token number">38</span>:<span class="token number">25</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token keyword">date</span><span class="token punctuation">(</span><span class="token keyword">current_timestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------------------------+</span>
<span class="token operator">|</span> <span class="token keyword">date</span><span class="token punctuation">(</span><span class="token keyword">current_timestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------------------+</span>
<span class="token operator">|</span> <span class="token number">2022</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">02</span>                <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

<span class="token comment">#DATE_ADD(dï¼ŒINTERVAL expr type)	è®¡ç®—èµ·å§‹æ—¥æœŸ d åŠ ä¸Šä¸€ä¸ªæ—¶é—´æ®µåçš„æ—¥æœŸï¼Œtype å€¼å¯ä»¥æ˜¯ï¼š</span>
MICROSECOND
<span class="token keyword">SECOND</span>
<span class="token keyword">MINUTE</span>
<span class="token keyword">HOUR</span>
<span class="token keyword">DAY</span>
WEEK
<span class="token keyword">MONTH</span>
QUARTER
<span class="token keyword">YEAR</span>
SECOND_MICROSECOND
MINUTE_MICROSECOND
MINUTE_SECOND
HOUR_MICROSECOND
HOUR_SECOND
HOUR_MINUTE
DAY_MICROSECOND
DAY_SECOND
DAY_MINUTE
DAY_HOUR
YEAR_MONTH
<span class="token keyword">SELECT</span> DATE_ADD<span class="token punctuation">(</span><span class="token string">&quot;2017-06-15&quot;</span><span class="token punctuation">,</span> <span class="token keyword">INTERVAL</span> <span class="token number">10</span> <span class="token keyword">DAY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
<span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">2017</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">25</span>

<span class="token keyword">SELECT</span> DATE_ADD<span class="token punctuation">(</span><span class="token string">&quot;2017-06-15 09:34:21&quot;</span><span class="token punctuation">,</span> <span class="token keyword">INTERVAL</span> <span class="token number">15</span> <span class="token keyword">MINUTE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">2017</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">15</span> <span class="token number">09</span>:<span class="token number">49</span>:<span class="token number">21</span>

<span class="token keyword">SELECT</span> DATE_ADD<span class="token punctuation">(</span><span class="token string">&quot;2017-06-15 09:34:21&quot;</span><span class="token punctuation">,</span> <span class="token keyword">INTERVAL</span> <span class="token operator">-</span><span class="token number">3</span> <span class="token keyword">HOUR</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token number">2017</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">15</span> <span class="token number">06</span>:<span class="token number">34</span>:<span class="token number">21</span>

<span class="token keyword">SELECT</span> DATE_ADD<span class="token punctuation">(</span><span class="token string">&quot;2017-06-15 09:34:21&quot;</span><span class="token punctuation">,</span> <span class="token keyword">INTERVAL</span> <span class="token operator">-</span><span class="token number">3</span> <span class="token keyword">MONTH</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token number">2017</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">15</span>
<span class="token comment">-- For instance</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token keyword">current_timestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------------------+</span>
<span class="token operator">|</span> <span class="token keyword">current_timestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------------+</span>
<span class="token operator">|</span> <span class="token number">2022</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">02</span> <span class="token number">19</span>:<span class="token number">43</span>:<span class="token number">51</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> date_add<span class="token punctuation">(</span><span class="token keyword">current_timestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">interval</span> <span class="token number">3</span> <span class="token keyword">month</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------------------------------------------------+</span>
<span class="token operator">|</span> date_add<span class="token punctuation">(</span><span class="token keyword">current_timestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">interval</span> <span class="token number">3</span> <span class="token keyword">month</span><span class="token punctuation">)</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------------------------------------------+</span>
<span class="token operator">|</span> <span class="token number">2022</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">02</span> <span class="token number">19</span>:<span class="token number">43</span>:<span class="token number">08</span>                            <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------------------------------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

<span class="token comment">-- å¼€å‘ä¸­å¸¸ç”¨:åˆ¤æ–­æ˜¯å¦äºæŸä¸ªæ—¶é—´æ®µå†…çš„</span>
<span class="token comment">-- æŸ¥çœ‹å‘˜å·¥è¡¨ä¸­å·¥é¾„è¾¾åˆ°31yearçš„å‘˜å·¥åŠå…¶å…¥èŒæ—¥æœŸ</span>



<span class="token comment">#DATE_SUB(date,INTERVAL expr type)	å‡½æ•°ä»æ—¥æœŸå‡å»æŒ‡å®šçš„æ—¶é—´é—´éš”ã€‚	</span>
Orders è¡¨ä¸­ OrderDate å­—æ®µå‡å» <span class="token number">2</span> å¤©ï¼š
<span class="token keyword">SELECT</span> OrderId<span class="token punctuation">,</span>DATE_SUB<span class="token punctuation">(</span>OrderDate<span class="token punctuation">,</span><span class="token keyword">INTERVAL</span> <span class="token number">2</span> <span class="token keyword">DAY</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> OrderPayDate
<span class="token keyword">FROM</span> Orders
<span class="token comment">-- For instance</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token keyword">current_timestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------------------+</span>
<span class="token operator">|</span> <span class="token keyword">current_timestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------------+</span>
<span class="token operator">|</span> <span class="token number">2022</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">02</span> <span class="token number">19</span>:<span class="token number">43</span>:<span class="token number">51</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> date_sub<span class="token punctuation">(</span><span class="token keyword">current_timestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">interval</span> <span class="token number">3</span> <span class="token keyword">month</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------------------------------------------------+</span>
<span class="token operator">|</span> date_sub<span class="token punctuation">(</span><span class="token keyword">current_timestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">interval</span> <span class="token number">3</span> <span class="token keyword">month</span><span class="token punctuation">)</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------------------------------------------+</span>
<span class="token operator">|</span> <span class="token number">2022</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">02</span> <span class="token number">19</span>:<span class="token number">46</span>:<span class="token number">16</span>                            <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------------------------------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

<span class="token comment">#TIMEDIFF(time1, time2)	è®¡ç®—æ—¶é—´å·®å€¼	å•ä½æ˜¯ æ—¶:åˆ†:ç§’</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">SELECT</span> TIMEDIFF<span class="token punctuation">(</span><span class="token string">&quot;13:10:11&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;13:10:10&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">01</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">SELECT</span> TIMEDIFF<span class="token punctuation">(</span><span class="token string">&#39;2000:01:01 00:00:00&#39;</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span>                 <span class="token string">&#39;2000:01:01 00:00:00.000001&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token string">&#39;-00:00:00.000001&#39;</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">SELECT</span> TIMEDIFF<span class="token punctuation">(</span><span class="token string">&#39;2008-12-31 23:59:59.000001&#39;</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span>                 <span class="token string">&#39;2008-12-30 01:01:01.000002&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token string">&#39;46:58:57.999999&#39;</span>

<span class="token comment">#DATEDIFF(d1,d2)	è®¡ç®—æ—¥æœŸ d1-&gt;d2 ä¹‹é—´ç›¸éš”çš„å¤©æ•°	å•ä½æ˜¯ å¤©</span>
<span class="token keyword">SELECT</span> DATEDIFF<span class="token punctuation">(</span><span class="token string">&#39;2001-01-01&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;2001-02-02&#39;</span><span class="token punctuation">)</span>
<span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">32</span>
<span class="token comment">-- å‡è®¾æ´»åˆ°80å² çœ‹çœ‹ä»ç°åœ¨å¼€å§‹è¿˜èƒ½æ´»å‡ å¤©</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> datediff<span class="token punctuation">(</span>date_add<span class="token punctuation">(</span><span class="token string">&#39;2001-01-01&#39;</span><span class="token punctuation">,</span><span class="token keyword">interval</span> <span class="token number">80</span> <span class="token keyword">year</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">current_date</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----------------------------------------------------------------+</span>
<span class="token operator">|</span> datediff<span class="token punctuation">(</span>date_add<span class="token punctuation">(</span><span class="token string">&#39;2001-01-01&#39;</span><span class="token punctuation">,</span><span class="token keyword">interval</span> <span class="token number">80</span> <span class="token keyword">year</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">current_date</span><span class="token punctuation">)</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------------------------------------------------+</span>
<span class="token operator">|</span>                                                          <span class="token number">21306</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------------------------------------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

<span class="token comment">#TO_DAYS(d)	è®¡ç®—æ—¥æœŸ d è·ç¦» 0000 å¹´ 1 æœˆ 1 æ—¥çš„å¤©æ•°	</span>
<span class="token keyword">SELECT</span> TO_DAYS<span class="token punctuation">(</span><span class="token string">&#39;0001-01-01 01:01:01&#39;</span><span class="token punctuation">)</span>
<span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">366</span>

<span class="token comment">#NOW()	è¿”å›å½“å‰æ—¥æœŸå’Œæ—¶é—´	</span>
<span class="token keyword">SELECT</span> <span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">2018</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">19</span> <span class="token number">20</span>:<span class="token number">57</span>:<span class="token number">43</span>
<span class="token comment">-- For instance</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------------------+</span>
<span class="token operator">|</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>               <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------------+</span>
<span class="token operator">|</span> <span class="token number">2022</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">02</span> <span class="token number">19</span>:<span class="token number">50</span>:<span class="token number">49</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token keyword">year</span><span class="token punctuation">(</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-------------+</span>
<span class="token operator">|</span> <span class="token keyword">year</span><span class="token punctuation">(</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------+</span>
<span class="token operator">|</span>        <span class="token number">2022</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token keyword">month</span><span class="token punctuation">(</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">--------------+</span>
<span class="token operator">|</span> <span class="token keyword">month</span><span class="token punctuation">(</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------+</span>
<span class="token operator">|</span>            <span class="token number">9</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token keyword">day</span><span class="token punctuation">(</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------------+</span>
<span class="token operator">|</span> <span class="token keyword">day</span><span class="token punctuation">(</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------+</span>
<span class="token operator">|</span>          <span class="token number">2</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

<span class="token comment"># unix_timestamp()è¿”å›1970å¹´1æœˆ1æ—¥è‡³æ­¤çš„æ¯«ç§’æ•°</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> unix_timestamp<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------------------+</span>
<span class="token operator">|</span> unix_timestamp<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------------+</span>
<span class="token operator">|</span>       <span class="token number">1662128229</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

<span class="token comment"># from_unixtime(ä¸€ä¸ªæ—¶é—´æˆ³,&#39;æŒ‡å®šæ ¼å¼&#39;)-- å¯ä»¥æŠŠæ—¶é—´æˆ³è½¬æˆæŒ‡å®šçš„æ ¼å¼</span>
<span class="token comment">-- åœ¨å¼€å‘ä¸­ä¼šä½¿ç”¨ä¸€ä¸ªintæ¥ä¿å­˜unixæ—¶é—´æˆ³ ç„¶åè¿›è¡Œè½¬æ¢</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> from_unixtime<span class="token punctuation">(</span><span class="token number">1662128229</span><span class="token punctuation">,</span><span class="token string">&#39;%y-%m-%d&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">-- å›ºå®šæ ¼å¼</span>
<span class="token operator">+</span><span class="token comment">--------------------------------------+</span>
<span class="token operator">|</span> from_unixtime<span class="token punctuation">(</span><span class="token number">1662128229</span><span class="token punctuation">,</span><span class="token string">&#39;%y-%m-%d&#39;</span><span class="token punctuation">)</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------------------------------+</span>
<span class="token operator">|</span> <span class="token number">22</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">02</span>                             <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------------------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> from_unixtime<span class="token punctuation">(</span><span class="token number">1662128229</span><span class="token punctuation">,</span><span class="token string">&#39;%Y-%m-%d&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">-- å›ºå®šæ ¼å¼</span>
<span class="token operator">+</span><span class="token comment">--------------------------------------+</span>
<span class="token operator">|</span> from_unixtime<span class="token punctuation">(</span><span class="token number">1662128229</span><span class="token punctuation">,</span><span class="token string">&#39;%Y-%m-%d&#39;</span><span class="token punctuation">)</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------------------------------+</span>
<span class="token operator">|</span> <span class="token number">2022</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">02</span>                           <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------------------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> from_unixtime<span class="token punctuation">(</span><span class="token number">1662128229</span><span class="token punctuation">,</span><span class="token string">&#39;%Y-%m-%d %H:%i:%s&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">-- å›ºå®šæ ¼å¼</span>
<span class="token operator">+</span><span class="token comment">-----------------------------------------------+</span>
<span class="token operator">|</span> from_unixtime<span class="token punctuation">(</span><span class="token number">1662128229</span><span class="token punctuation">,</span><span class="token string">&#39;%Y-%m-%d %H:%i:%s&#39;</span><span class="token punctuation">)</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------------------------------------------+</span>
<span class="token operator">|</span> <span class="token number">2022</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">02</span> <span class="token number">22</span>:<span class="token number">17</span>:<span class="token number">09</span>                           <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------------------------------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="å­—ç¬¦ä¸²å‡½æ•°" tabindex="-1"><a class="header-anchor" href="#å­—ç¬¦ä¸²å‡½æ•°" aria-hidden="true">#</a> å­—ç¬¦ä¸²å‡½æ•°</h5><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">## SQL Scalar å‡½æ•°</span>

<span class="token keyword">SQL</span> Scalar å‡½æ•°åŸºäºè¾“å…¥å€¼ï¼Œè¿”å›ä¸€ä¸ªå•ä¸€çš„å€¼ã€‚

æœ‰ç”¨çš„ Scalar å‡½æ•°ï¼š

<span class="token operator">-</span> <span class="token function">UCASE</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> å°†æŸä¸ªå­—æ®µè½¬æ¢ä¸ºå¤§å†™
<span class="token operator">-</span> <span class="token function">LCASE</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> å°†æŸä¸ªå­—æ®µè½¬æ¢ä¸ºå°å†™
<span class="token operator">-</span> <span class="token function">MID</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> ä»æŸä¸ªæ–‡æœ¬å­—æ®µæå–å­—ç¬¦ï¼ŒMySql ä¸­ä½¿ç”¨
<span class="token operator">-</span> SubString<span class="token punctuation">(</span>å­—æ®µï¼Œ<span class="token number">1</span>ï¼Œ<span class="token keyword">end</span><span class="token punctuation">)</span> <span class="token operator">-</span> ä»æŸä¸ªæ–‡æœ¬å­—æ®µæå–å­—ç¬¦
<span class="token operator">-</span> <span class="token function">LEN</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> è¿”å›æŸä¸ªæ–‡æœ¬å­—æ®µçš„é•¿åº¦
<span class="token operator">-</span> <span class="token function">ROUND</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> å¯¹æŸä¸ªæ•°å€¼å­—æ®µè¿›è¡ŒæŒ‡å®šå°æ•°ä½æ•°çš„å››èˆäº”å…¥
<span class="token operator">-</span> <span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> è¿”å›å½“å‰çš„ç³»ç»Ÿæ—¥æœŸå’Œæ—¶é—´
<span class="token operator">-</span> <span class="token function">FORMAT</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> æ ¼å¼åŒ–æŸä¸ªå­—æ®µçš„æ˜¾ç¤ºæ–¹å¼

<span class="token comment">#UCASE() å‡½æ•°</span>
<span class="token function">UCASE</span><span class="token punctuation">(</span><span class="token punctuation">)</span> å‡½æ•°æŠŠå­—æ®µçš„å€¼è½¬æ¢ä¸ºå¤§å†™ã€‚

<span class="token keyword">SQL</span> <span class="token function">UCASE</span><span class="token punctuation">(</span><span class="token punctuation">)</span> è¯­æ³•
<span class="token keyword">SELECT</span> <span class="token function">UCASE</span><span class="token punctuation">(</span>column_name<span class="token punctuation">)</span> <span class="token keyword">FROM</span> table_name<span class="token punctuation">;</span>
ç”¨äº <span class="token keyword">SQL</span> Server çš„è¯­æ³•
<span class="token keyword">SELECT</span> UPPER<span class="token punctuation">(</span>column_name<span class="token punctuation">)</span> <span class="token keyword">FROM</span> table_name<span class="token punctuation">;</span>
<span class="token comment">-- For instance</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-------+--------+-----------+------+------------+---------+---------+--------+</span>
<span class="token operator">|</span> empno <span class="token operator">|</span> ename  <span class="token operator">|</span> job       <span class="token operator">|</span> mgr  <span class="token operator">|</span> hiredate   <span class="token operator">|</span> sal     <span class="token operator">|</span> comm    <span class="token operator">|</span> deptno <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+--------+-----------+------+------------+---------+---------+--------+</span>
<span class="token operator">|</span>  <span class="token number">7369</span> <span class="token operator">|</span> SMITH  <span class="token operator">|</span> clerk     <span class="token operator">|</span> <span class="token number">7902</span> <span class="token operator">|</span> <span class="token number">1990</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">17</span> <span class="token operator">|</span>  <span class="token number">800.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7499</span> <span class="token operator">|</span> ALLEN  <span class="token operator">|</span> salesman  <span class="token operator">|</span> <span class="token number">7698</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">20</span> <span class="token operator">|</span> <span class="token number">1600.00</span> <span class="token operator">|</span>  <span class="token number">300.00</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7521</span> <span class="token operator">|</span> WARD   <span class="token operator">|</span> salesman  <span class="token operator">|</span> <span class="token number">7698</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">22</span> <span class="token operator">|</span> <span class="token number">1250.00</span> <span class="token operator">|</span>  <span class="token number">500.00</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7566</span> <span class="token operator">|</span> JONES  <span class="token operator">|</span> manager   <span class="token operator">|</span> <span class="token number">7839</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">02</span> <span class="token operator">|</span> <span class="token number">2975.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7654</span> <span class="token operator">|</span> MARTIN <span class="token operator">|</span> salesman  <span class="token operator">|</span> <span class="token number">7698</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">28</span> <span class="token operator">|</span> <span class="token number">1250.00</span> <span class="token operator">|</span> <span class="token number">1400.00</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7698</span> <span class="token operator">|</span> BLAKE  <span class="token operator">|</span> manager   <span class="token operator">|</span> <span class="token number">7839</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">01</span> <span class="token operator">|</span> <span class="token number">2850.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7782</span> <span class="token operator">|</span> CLARK  <span class="token operator">|</span> manager   <span class="token operator">|</span> <span class="token number">7839</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">09</span> <span class="token operator">|</span> <span class="token number">2450.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7788</span> <span class="token operator">|</span> SCOTT  <span class="token operator">|</span> analyst   <span class="token operator">|</span> <span class="token number">7566</span> <span class="token operator">|</span> <span class="token number">1997</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">19</span> <span class="token operator">|</span> <span class="token number">3000.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7839</span> <span class="token operator">|</span> KING   <span class="token operator">|</span> president <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">17</span> <span class="token operator">|</span> <span class="token number">5000.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7844</span> <span class="token operator">|</span> TURNER <span class="token operator">|</span> salesman  <span class="token operator">|</span> <span class="token number">7698</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">08</span> <span class="token operator">|</span> <span class="token number">1500.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7900</span> <span class="token operator">|</span> JAMES  <span class="token operator">|</span> clerk     <span class="token operator">|</span> <span class="token number">7698</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">03</span> <span class="token operator">|</span>  <span class="token number">950.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7902</span> <span class="token operator">|</span> FORD   <span class="token operator">|</span> analyst   <span class="token operator">|</span> <span class="token number">7566</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">03</span> <span class="token operator">|</span> <span class="token number">3000.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7934</span> <span class="token operator">|</span> MILLER <span class="token operator">|</span> clerk     <span class="token operator">|</span> <span class="token number">7782</span> <span class="token operator">|</span> <span class="token number">1992</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">23</span> <span class="token operator">|</span> <span class="token number">1300.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+--------+-----------+------+------------+---------+---------+--------+</span>
<span class="token number">13</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">update</span> emp <span class="token keyword">set</span> job<span class="token operator">=</span><span class="token function">ucase</span><span class="token punctuation">(</span>job<span class="token punctuation">)</span> <span class="token keyword">where</span> job<span class="token operator">=</span><span class="token string">&#39;salesman&#39;</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">4</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
<span class="token keyword">Rows</span> <span class="token keyword">matched</span>: <span class="token number">4</span>  Changed: <span class="token number">4</span>  <span class="token keyword">Warnings</span>: <span class="token number">0</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-------+--------+-----------+------+------------+---------+---------+--------+</span>
<span class="token operator">|</span> empno <span class="token operator">|</span> ename  <span class="token operator">|</span> job       <span class="token operator">|</span> mgr  <span class="token operator">|</span> hiredate   <span class="token operator">|</span> sal     <span class="token operator">|</span> comm    <span class="token operator">|</span> deptno <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+--------+-----------+------+------------+---------+---------+--------+</span>
<span class="token operator">|</span>  <span class="token number">7369</span> <span class="token operator">|</span> SMITH  <span class="token operator">|</span> clerk     <span class="token operator">|</span> <span class="token number">7902</span> <span class="token operator">|</span> <span class="token number">1990</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">17</span> <span class="token operator">|</span>  <span class="token number">800.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7499</span> <span class="token operator">|</span> ALLEN  <span class="token operator">|</span> SALESMAN  <span class="token operator">|</span> <span class="token number">7698</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">20</span> <span class="token operator">|</span> <span class="token number">1600.00</span> <span class="token operator">|</span>  <span class="token number">300.00</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7521</span> <span class="token operator">|</span> WARD   <span class="token operator">|</span> SALESMAN  <span class="token operator">|</span> <span class="token number">7698</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">22</span> <span class="token operator">|</span> <span class="token number">1250.00</span> <span class="token operator">|</span>  <span class="token number">500.00</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7566</span> <span class="token operator">|</span> JONES  <span class="token operator">|</span> manager   <span class="token operator">|</span> <span class="token number">7839</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">02</span> <span class="token operator">|</span> <span class="token number">2975.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7654</span> <span class="token operator">|</span> MARTIN <span class="token operator">|</span> SALESMAN  <span class="token operator">|</span> <span class="token number">7698</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">28</span> <span class="token operator">|</span> <span class="token number">1250.00</span> <span class="token operator">|</span> <span class="token number">1400.00</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7698</span> <span class="token operator">|</span> BLAKE  <span class="token operator">|</span> manager   <span class="token operator">|</span> <span class="token number">7839</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">01</span> <span class="token operator">|</span> <span class="token number">2850.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7782</span> <span class="token operator">|</span> CLARK  <span class="token operator">|</span> manager   <span class="token operator">|</span> <span class="token number">7839</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">09</span> <span class="token operator">|</span> <span class="token number">2450.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7788</span> <span class="token operator">|</span> SCOTT  <span class="token operator">|</span> analyst   <span class="token operator">|</span> <span class="token number">7566</span> <span class="token operator">|</span> <span class="token number">1997</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">19</span> <span class="token operator">|</span> <span class="token number">3000.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7839</span> <span class="token operator">|</span> KING   <span class="token operator">|</span> president <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">17</span> <span class="token operator">|</span> <span class="token number">5000.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7844</span> <span class="token operator">|</span> TURNER <span class="token operator">|</span> SALESMAN  <span class="token operator">|</span> <span class="token number">7698</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">08</span> <span class="token operator">|</span> <span class="token number">1500.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7900</span> <span class="token operator">|</span> JAMES  <span class="token operator">|</span> clerk     <span class="token operator">|</span> <span class="token number">7698</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">03</span> <span class="token operator">|</span>  <span class="token number">950.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7902</span> <span class="token operator">|</span> FORD   <span class="token operator">|</span> analyst   <span class="token operator">|</span> <span class="token number">7566</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">03</span> <span class="token operator">|</span> <span class="token number">3000.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7934</span> <span class="token operator">|</span> MILLER <span class="token operator">|</span> clerk     <span class="token operator">|</span> <span class="token number">7782</span> <span class="token operator">|</span> <span class="token number">1992</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">23</span> <span class="token operator">|</span> <span class="token number">1300.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+--------+-----------+------+------------+---------+---------+--------+</span>
<span class="token number">13</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

<span class="token comment">#LCASE() å‡½æ•°</span>
<span class="token function">LCASE</span><span class="token punctuation">(</span><span class="token punctuation">)</span> å‡½æ•°æŠŠå­—æ®µçš„å€¼è½¬æ¢ä¸ºå°å†™ã€‚

<span class="token keyword">SQL</span> <span class="token function">LCASE</span><span class="token punctuation">(</span><span class="token punctuation">)</span> è¯­æ³•
<span class="token keyword">SELECT</span> <span class="token function">LCASE</span><span class="token punctuation">(</span>column_name<span class="token punctuation">)</span> <span class="token keyword">FROM</span> table_name<span class="token punctuation">;</span>
ç”¨äº <span class="token keyword">SQL</span> Server çš„è¯­æ³•
<span class="token keyword">SELECT</span> LOWER<span class="token punctuation">(</span>column_name<span class="token punctuation">)</span> <span class="token keyword">FROM</span> table_name<span class="token punctuation">;</span>

<span class="token comment">-- For instance</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-------+--------+-----------+------+------------+---------+---------+--------+</span>
<span class="token operator">|</span> empno <span class="token operator">|</span> ename  <span class="token operator">|</span> job       <span class="token operator">|</span> mgr  <span class="token operator">|</span> hiredate   <span class="token operator">|</span> sal     <span class="token operator">|</span> comm    <span class="token operator">|</span> deptno <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+--------+-----------+------+------------+---------+---------+--------+</span>
<span class="token operator">|</span>  <span class="token number">7369</span> <span class="token operator">|</span> SMITH  <span class="token operator">|</span> clerk     <span class="token operator">|</span> <span class="token number">7902</span> <span class="token operator">|</span> <span class="token number">1990</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">17</span> <span class="token operator">|</span>  <span class="token number">800.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7499</span> <span class="token operator">|</span> ALLEN  <span class="token operator">|</span> SALESMAN  <span class="token operator">|</span> <span class="token number">7698</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">20</span> <span class="token operator">|</span> <span class="token number">1600.00</span> <span class="token operator">|</span>  <span class="token number">300.00</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7521</span> <span class="token operator">|</span> WARD   <span class="token operator">|</span> SALESMAN  <span class="token operator">|</span> <span class="token number">7698</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">22</span> <span class="token operator">|</span> <span class="token number">1250.00</span> <span class="token operator">|</span>  <span class="token number">500.00</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7566</span> <span class="token operator">|</span> JONES  <span class="token operator">|</span> manager   <span class="token operator">|</span> <span class="token number">7839</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">02</span> <span class="token operator">|</span> <span class="token number">2975.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7654</span> <span class="token operator">|</span> MARTIN <span class="token operator">|</span> SALESMAN  <span class="token operator">|</span> <span class="token number">7698</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">28</span> <span class="token operator">|</span> <span class="token number">1250.00</span> <span class="token operator">|</span> <span class="token number">1400.00</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7698</span> <span class="token operator">|</span> BLAKE  <span class="token operator">|</span> manager   <span class="token operator">|</span> <span class="token number">7839</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">01</span> <span class="token operator">|</span> <span class="token number">2850.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7782</span> <span class="token operator">|</span> CLARK  <span class="token operator">|</span> manager   <span class="token operator">|</span> <span class="token number">7839</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">09</span> <span class="token operator">|</span> <span class="token number">2450.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7788</span> <span class="token operator">|</span> SCOTT  <span class="token operator">|</span> analyst   <span class="token operator">|</span> <span class="token number">7566</span> <span class="token operator">|</span> <span class="token number">1997</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">19</span> <span class="token operator">|</span> <span class="token number">3000.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7839</span> <span class="token operator">|</span> KING   <span class="token operator">|</span> president <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">17</span> <span class="token operator">|</span> <span class="token number">5000.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7844</span> <span class="token operator">|</span> TURNER <span class="token operator">|</span> SALESMAN  <span class="token operator">|</span> <span class="token number">7698</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">08</span> <span class="token operator">|</span> <span class="token number">1500.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7900</span> <span class="token operator">|</span> JAMES  <span class="token operator">|</span> clerk     <span class="token operator">|</span> <span class="token number">7698</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">03</span> <span class="token operator">|</span>  <span class="token number">950.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7902</span> <span class="token operator">|</span> FORD   <span class="token operator">|</span> analyst   <span class="token operator">|</span> <span class="token number">7566</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">03</span> <span class="token operator">|</span> <span class="token number">3000.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7934</span> <span class="token operator">|</span> MILLER <span class="token operator">|</span> clerk     <span class="token operator">|</span> <span class="token number">7782</span> <span class="token operator">|</span> <span class="token number">1992</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">23</span> <span class="token operator">|</span> <span class="token number">1300.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+--------+-----------+------+------------+---------+---------+--------+</span>
<span class="token number">13</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">update</span> emp <span class="token keyword">set</span> job<span class="token operator">=</span><span class="token function">lcase</span><span class="token punctuation">(</span>job<span class="token punctuation">)</span> <span class="token keyword">where</span> job<span class="token operator">=</span><span class="token string">&#39;SALESMAN&#39;</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">4</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
<span class="token keyword">Rows</span> <span class="token keyword">matched</span>: <span class="token number">4</span>  Changed: <span class="token number">4</span>  <span class="token keyword">Warnings</span>: <span class="token number">0</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-------+--------+-----------+------+------------+---------+---------+--------+</span>
<span class="token operator">|</span> empno <span class="token operator">|</span> ename  <span class="token operator">|</span> job       <span class="token operator">|</span> mgr  <span class="token operator">|</span> hiredate   <span class="token operator">|</span> sal     <span class="token operator">|</span> comm    <span class="token operator">|</span> deptno <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+--------+-----------+------+------------+---------+---------+--------+</span>
<span class="token operator">|</span>  <span class="token number">7369</span> <span class="token operator">|</span> SMITH  <span class="token operator">|</span> clerk     <span class="token operator">|</span> <span class="token number">7902</span> <span class="token operator">|</span> <span class="token number">1990</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">17</span> <span class="token operator">|</span>  <span class="token number">800.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7499</span> <span class="token operator">|</span> ALLEN  <span class="token operator">|</span> salesman  <span class="token operator">|</span> <span class="token number">7698</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">20</span> <span class="token operator">|</span> <span class="token number">1600.00</span> <span class="token operator">|</span>  <span class="token number">300.00</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7521</span> <span class="token operator">|</span> WARD   <span class="token operator">|</span> salesman  <span class="token operator">|</span> <span class="token number">7698</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">22</span> <span class="token operator">|</span> <span class="token number">1250.00</span> <span class="token operator">|</span>  <span class="token number">500.00</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7566</span> <span class="token operator">|</span> JONES  <span class="token operator">|</span> manager   <span class="token operator">|</span> <span class="token number">7839</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">02</span> <span class="token operator">|</span> <span class="token number">2975.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7654</span> <span class="token operator">|</span> MARTIN <span class="token operator">|</span> salesman  <span class="token operator">|</span> <span class="token number">7698</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">28</span> <span class="token operator">|</span> <span class="token number">1250.00</span> <span class="token operator">|</span> <span class="token number">1400.00</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7698</span> <span class="token operator">|</span> BLAKE  <span class="token operator">|</span> manager   <span class="token operator">|</span> <span class="token number">7839</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">01</span> <span class="token operator">|</span> <span class="token number">2850.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7782</span> <span class="token operator">|</span> CLARK  <span class="token operator">|</span> manager   <span class="token operator">|</span> <span class="token number">7839</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">09</span> <span class="token operator">|</span> <span class="token number">2450.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7788</span> <span class="token operator">|</span> SCOTT  <span class="token operator">|</span> analyst   <span class="token operator">|</span> <span class="token number">7566</span> <span class="token operator">|</span> <span class="token number">1997</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">19</span> <span class="token operator">|</span> <span class="token number">3000.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7839</span> <span class="token operator">|</span> KING   <span class="token operator">|</span> president <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">17</span> <span class="token operator">|</span> <span class="token number">5000.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7844</span> <span class="token operator">|</span> TURNER <span class="token operator">|</span> salesman  <span class="token operator">|</span> <span class="token number">7698</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">08</span> <span class="token operator">|</span> <span class="token number">1500.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7900</span> <span class="token operator">|</span> JAMES  <span class="token operator">|</span> clerk     <span class="token operator">|</span> <span class="token number">7698</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">03</span> <span class="token operator">|</span>  <span class="token number">950.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7902</span> <span class="token operator">|</span> FORD   <span class="token operator">|</span> analyst   <span class="token operator">|</span> <span class="token number">7566</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">03</span> <span class="token operator">|</span> <span class="token number">3000.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7934</span> <span class="token operator">|</span> MILLER <span class="token operator">|</span> clerk     <span class="token operator">|</span> <span class="token number">7782</span> <span class="token operator">|</span> <span class="token number">1992</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">23</span> <span class="token operator">|</span> <span class="token number">1300.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+--------+-----------+------+------------+---------+---------+--------+</span>
<span class="token number">13</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

<span class="token comment">#MID() å‡½æ•°</span>
<span class="token comment">-- MID() å‡½æ•°ç”¨äºä»æ–‡æœ¬å­—æ®µä¸­æå–å­—ç¬¦ã€‚-- ç›¸å½“äºsubstr</span>
<span class="token keyword">SQL</span> <span class="token function">MID</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">SELECT</span> <span class="token function">MID</span><span class="token punctuation">(</span>column_name<span class="token punctuation">,</span><span class="token keyword">start</span><span class="token punctuation">[</span><span class="token punctuation">,</span>length<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> table_name<span class="token punctuation">;</span>
<span class="token comment">-- å‚æ•°	       æè¿°</span>
<span class="token comment">-- column_name	å¿…éœ€ã€‚è¦æå–å­—ç¬¦çš„å­—æ®µã€‚</span>
<span class="token comment">-- start	    å¿…éœ€ã€‚è§„å®šå¼€å§‹ä½ç½®ï¼ˆèµ·å§‹å€¼æ˜¯ 1ï¼‰ã€‚</span>
<span class="token comment">-- length	    å¯é€‰ã€‚è¦è¿”å›çš„å­—ç¬¦æ•°ã€‚å¦‚æœçœç•¥ï¼Œåˆ™ MID() å‡½æ•°è¿”å›å‰©ä½™æ–‡æœ¬ã€‚</span>

<span class="token comment">-- For instance</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-------+--------+-----------+------+------------+---------+---------+--------+</span>
<span class="token operator">|</span> empno <span class="token operator">|</span> ename  <span class="token operator">|</span> job       <span class="token operator">|</span> mgr  <span class="token operator">|</span> hiredate   <span class="token operator">|</span> sal     <span class="token operator">|</span> comm    <span class="token operator">|</span> deptno <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+--------+-----------+------+------------+---------+---------+--------+</span>
<span class="token operator">|</span>  <span class="token number">7369</span> <span class="token operator">|</span> SMITH  <span class="token operator">|</span> clerk     <span class="token operator">|</span> <span class="token number">7902</span> <span class="token operator">|</span> <span class="token number">1990</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">17</span> <span class="token operator">|</span>  <span class="token number">800.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7499</span> <span class="token operator">|</span> ALLEN  <span class="token operator">|</span> salesman  <span class="token operator">|</span> <span class="token number">7698</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">20</span> <span class="token operator">|</span> <span class="token number">1600.00</span> <span class="token operator">|</span>  <span class="token number">300.00</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7521</span> <span class="token operator">|</span> WARD   <span class="token operator">|</span> salesman  <span class="token operator">|</span> <span class="token number">7698</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">22</span> <span class="token operator">|</span> <span class="token number">1250.00</span> <span class="token operator">|</span>  <span class="token number">500.00</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7566</span> <span class="token operator">|</span> JONES  <span class="token operator">|</span> manager   <span class="token operator">|</span> <span class="token number">7839</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">02</span> <span class="token operator">|</span> <span class="token number">2975.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7654</span> <span class="token operator">|</span> MARTIN <span class="token operator">|</span> salesman  <span class="token operator">|</span> <span class="token number">7698</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">28</span> <span class="token operator">|</span> <span class="token number">1250.00</span> <span class="token operator">|</span> <span class="token number">1400.00</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7698</span> <span class="token operator">|</span> BLAKE  <span class="token operator">|</span> manager   <span class="token operator">|</span> <span class="token number">7839</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">01</span> <span class="token operator">|</span> <span class="token number">2850.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7782</span> <span class="token operator">|</span> CLARK  <span class="token operator">|</span> manager   <span class="token operator">|</span> <span class="token number">7839</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">09</span> <span class="token operator">|</span> <span class="token number">2450.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7788</span> <span class="token operator">|</span> SCOTT  <span class="token operator">|</span> analyst   <span class="token operator">|</span> <span class="token number">7566</span> <span class="token operator">|</span> <span class="token number">1997</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">19</span> <span class="token operator">|</span> <span class="token number">3000.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7839</span> <span class="token operator">|</span> KING   <span class="token operator">|</span> president <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">17</span> <span class="token operator">|</span> <span class="token number">5000.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7844</span> <span class="token operator">|</span> TURNER <span class="token operator">|</span> salesman  <span class="token operator">|</span> <span class="token number">7698</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">08</span> <span class="token operator">|</span> <span class="token number">1500.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7900</span> <span class="token operator">|</span> JAMES  <span class="token operator">|</span> clerk     <span class="token operator">|</span> <span class="token number">7698</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">03</span> <span class="token operator">|</span>  <span class="token number">950.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7902</span> <span class="token operator">|</span> FORD   <span class="token operator">|</span> analyst   <span class="token operator">|</span> <span class="token number">7566</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">03</span> <span class="token operator">|</span> <span class="token number">3000.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7934</span> <span class="token operator">|</span> MILLER <span class="token operator">|</span> clerk     <span class="token operator">|</span> <span class="token number">7782</span> <span class="token operator">|</span> <span class="token number">1992</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">23</span> <span class="token operator">|</span> <span class="token number">1300.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+--------+-----------+------+------------+---------+---------+--------+</span>
<span class="token number">13</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token function">mid</span><span class="token punctuation">(</span>hiredate<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token keyword">from</span> emp<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-------------------+</span>
<span class="token operator">|</span> <span class="token function">mid</span><span class="token punctuation">(</span>hiredate<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------------+</span>
<span class="token operator">|</span> <span class="token number">1990</span>              <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">1991</span>              <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">1991</span>              <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">1991</span>              <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">1991</span>              <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">1991</span>              <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">1991</span>              <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">1997</span>              <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">1991</span>              <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">1991</span>              <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">1991</span>              <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">1991</span>              <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">1992</span>              <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------------+</span>
<span class="token number">13</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token function">mid</span><span class="token punctuation">(</span>hiredate<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">&#39;HireDate&#39;</span> <span class="token keyword">from</span> emp<span class="token punctuation">;</span><span class="token comment">-- length	    å¯é€‰ã€‚è¦è¿”å›çš„å­—ç¬¦æ•°ã€‚å¦‚æœçœç•¥ï¼Œåˆ™ MID() å‡½æ•°è¿”å›å‰©ä½™æ–‡æœ¬ã€‚</span>
<span class="token operator">+</span><span class="token comment">------------+</span>
<span class="token operator">|</span> HireDate   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------+</span>
<span class="token operator">|</span> <span class="token number">1990</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">17</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">22</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">02</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">28</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">01</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">09</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">1997</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">19</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">17</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">08</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">03</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">03</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">1992</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">23</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------+</span>
<span class="token number">13</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span>

<span class="token comment">#LEN() å‡½æ•°</span>
<span class="token function">LEN</span><span class="token punctuation">(</span><span class="token punctuation">)</span> å‡½æ•°è¿”å›æ–‡æœ¬å­—æ®µä¸­å€¼çš„é•¿åº¦ã€‚

<span class="token keyword">SQL</span> <span class="token function">LEN</span><span class="token punctuation">(</span><span class="token punctuation">)</span> è¯­æ³•
<span class="token keyword">SELECT</span> <span class="token function">LEN</span><span class="token punctuation">(</span>column_name<span class="token punctuation">)</span> <span class="token keyword">FROM</span> table_name<span class="token punctuation">;</span>
MySQL ä¸­å‡½æ•°ä¸º LENGTH<span class="token punctuation">(</span><span class="token punctuation">)</span>:

<span class="token keyword">SELECT</span> LENGTH<span class="token punctuation">(</span>column_name<span class="token punctuation">)</span> <span class="token keyword">FROM</span> table_name<span class="token punctuation">;</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-------+--------+-----------+------+------------+---------+---------+--------+</span>
<span class="token operator">|</span> empno <span class="token operator">|</span> ename  <span class="token operator">|</span> job       <span class="token operator">|</span> mgr  <span class="token operator">|</span> hiredate   <span class="token operator">|</span> sal     <span class="token operator">|</span> comm    <span class="token operator">|</span> deptno <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+--------+-----------+------+------------+---------+---------+--------+</span>
<span class="token operator">|</span>  <span class="token number">7369</span> <span class="token operator">|</span> SMITH  <span class="token operator">|</span> clerk     <span class="token operator">|</span> <span class="token number">7902</span> <span class="token operator">|</span> <span class="token number">1990</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">17</span> <span class="token operator">|</span>  <span class="token number">800.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7499</span> <span class="token operator">|</span> ALLEN  <span class="token operator">|</span> salesman  <span class="token operator">|</span> <span class="token number">7698</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">20</span> <span class="token operator">|</span> <span class="token number">1600.00</span> <span class="token operator">|</span>  <span class="token number">300.00</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7521</span> <span class="token operator">|</span> WARD   <span class="token operator">|</span> salesman  <span class="token operator">|</span> <span class="token number">7698</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">22</span> <span class="token operator">|</span> <span class="token number">1250.00</span> <span class="token operator">|</span>  <span class="token number">500.00</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7566</span> <span class="token operator">|</span> JONES  <span class="token operator">|</span> manager   <span class="token operator">|</span> <span class="token number">7839</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">02</span> <span class="token operator">|</span> <span class="token number">2975.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7654</span> <span class="token operator">|</span> MARTIN <span class="token operator">|</span> salesman  <span class="token operator">|</span> <span class="token number">7698</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">28</span> <span class="token operator">|</span> <span class="token number">1250.00</span> <span class="token operator">|</span> <span class="token number">1400.00</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7698</span> <span class="token operator">|</span> BLAKE  <span class="token operator">|</span> manager   <span class="token operator">|</span> <span class="token number">7839</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">01</span> <span class="token operator">|</span> <span class="token number">2850.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7782</span> <span class="token operator">|</span> CLARK  <span class="token operator">|</span> manager   <span class="token operator">|</span> <span class="token number">7839</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">09</span> <span class="token operator">|</span> <span class="token number">2450.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7788</span> <span class="token operator">|</span> SCOTT  <span class="token operator">|</span> analyst   <span class="token operator">|</span> <span class="token number">7566</span> <span class="token operator">|</span> <span class="token number">1997</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">19</span> <span class="token operator">|</span> <span class="token number">3000.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7839</span> <span class="token operator">|</span> KING   <span class="token operator">|</span> president <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">17</span> <span class="token operator">|</span> <span class="token number">5000.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7844</span> <span class="token operator">|</span> TURNER <span class="token operator">|</span> salesman  <span class="token operator">|</span> <span class="token number">7698</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">08</span> <span class="token operator">|</span> <span class="token number">1500.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7900</span> <span class="token operator">|</span> JAMES  <span class="token operator">|</span> clerk     <span class="token operator">|</span> <span class="token number">7698</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">03</span> <span class="token operator">|</span>  <span class="token number">950.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7902</span> <span class="token operator">|</span> FORD   <span class="token operator">|</span> analyst   <span class="token operator">|</span> <span class="token number">7566</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">03</span> <span class="token operator">|</span> <span class="token number">3000.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7934</span> <span class="token operator">|</span> MILLER <span class="token operator">|</span> clerk     <span class="token operator">|</span> <span class="token number">7782</span> <span class="token operator">|</span> <span class="token number">1992</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">23</span> <span class="token operator">|</span> <span class="token number">1300.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+--------+-----------+------+------------+---------+---------+--------+</span>
<span class="token number">13</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> length<span class="token punctuation">(</span>ename<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">&#39;EmployeeNameLength&#39;</span> <span class="token keyword">from</span> emp<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">--------------------+</span>
<span class="token operator">|</span> EmployeeNameLength <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------------+</span>
<span class="token operator">|</span>                  <span class="token number">5</span> <span class="token operator">|</span>
<span class="token operator">|</span>                  <span class="token number">5</span> <span class="token operator">|</span>
<span class="token operator">|</span>                  <span class="token number">4</span> <span class="token operator">|</span>
<span class="token operator">|</span>                  <span class="token number">5</span> <span class="token operator">|</span>
<span class="token operator">|</span>                  <span class="token number">6</span> <span class="token operator">|</span>
<span class="token operator">|</span>                  <span class="token number">5</span> <span class="token operator">|</span>
<span class="token operator">|</span>                  <span class="token number">5</span> <span class="token operator">|</span>
<span class="token operator">|</span>                  <span class="token number">5</span> <span class="token operator">|</span>
<span class="token operator">|</span>                  <span class="token number">4</span> <span class="token operator">|</span>
<span class="token operator">|</span>                  <span class="token number">6</span> <span class="token operator">|</span>
<span class="token operator">|</span>                  <span class="token number">5</span> <span class="token operator">|</span>
<span class="token operator">|</span>                  <span class="token number">4</span> <span class="token operator">|</span>
<span class="token operator">|</span>                  <span class="token number">6</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------------+</span>
<span class="token number">13</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span>

<span class="token comment">#CONCAT(s1,s2...sn)	å­—ç¬¦ä¸² s1,s2 ç­‰å¤šä¸ªå­—ç¬¦ä¸²åˆå¹¶ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²	</span>
<span class="token comment">-- åˆå¹¶å¤šä¸ªå­—ç¬¦ä¸²</span>

<span class="token keyword">SELECT</span> CONCAT<span class="token punctuation">(</span><span class="token string">&quot;SQL &quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Runoob &quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Gooogle &quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Facebook&quot;</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> ConcatenatedString<span class="token punctuation">;</span>

<span class="token comment">-- For instance</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-------+--------+-----------+------+------------+---------+---------+--------+</span>
<span class="token operator">|</span> empno <span class="token operator">|</span> ename  <span class="token operator">|</span> job       <span class="token operator">|</span> mgr  <span class="token operator">|</span> hiredate   <span class="token operator">|</span> sal     <span class="token operator">|</span> comm    <span class="token operator">|</span> deptno <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+--------+-----------+------+------------+---------+---------+--------+</span>
<span class="token operator">|</span>  <span class="token number">7369</span> <span class="token operator">|</span> SMITH  <span class="token operator">|</span> clerk     <span class="token operator">|</span> <span class="token number">7902</span> <span class="token operator">|</span> <span class="token number">1990</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">17</span> <span class="token operator">|</span>  <span class="token number">800.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7499</span> <span class="token operator">|</span> ALLEN  <span class="token operator">|</span> salesman  <span class="token operator">|</span> <span class="token number">7698</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">20</span> <span class="token operator">|</span> <span class="token number">1600.00</span> <span class="token operator">|</span>  <span class="token number">300.00</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7521</span> <span class="token operator">|</span> WARD   <span class="token operator">|</span> salesman  <span class="token operator">|</span> <span class="token number">7698</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">22</span> <span class="token operator">|</span> <span class="token number">1250.00</span> <span class="token operator">|</span>  <span class="token number">500.00</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7566</span> <span class="token operator">|</span> JONES  <span class="token operator">|</span> manager   <span class="token operator">|</span> <span class="token number">7839</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">02</span> <span class="token operator">|</span> <span class="token number">2975.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7654</span> <span class="token operator">|</span> MARTIN <span class="token operator">|</span> salesman  <span class="token operator">|</span> <span class="token number">7698</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">28</span> <span class="token operator">|</span> <span class="token number">1250.00</span> <span class="token operator">|</span> <span class="token number">1400.00</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7698</span> <span class="token operator">|</span> BLAKE  <span class="token operator">|</span> manager   <span class="token operator">|</span> <span class="token number">7839</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">01</span> <span class="token operator">|</span> <span class="token number">2850.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7782</span> <span class="token operator">|</span> CLARK  <span class="token operator">|</span> manager   <span class="token operator">|</span> <span class="token number">7839</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">09</span> <span class="token operator">|</span> <span class="token number">2450.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7788</span> <span class="token operator">|</span> SCOTT  <span class="token operator">|</span> analyst   <span class="token operator">|</span> <span class="token number">7566</span> <span class="token operator">|</span> <span class="token number">1997</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">19</span> <span class="token operator">|</span> <span class="token number">3000.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7839</span> <span class="token operator">|</span> KING   <span class="token operator">|</span> president <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">17</span> <span class="token operator">|</span> <span class="token number">5000.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7844</span> <span class="token operator">|</span> TURNER <span class="token operator">|</span> salesman  <span class="token operator">|</span> <span class="token number">7698</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">08</span> <span class="token operator">|</span> <span class="token number">1500.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7900</span> <span class="token operator">|</span> JAMES  <span class="token operator">|</span> clerk     <span class="token operator">|</span> <span class="token number">7698</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">03</span> <span class="token operator">|</span>  <span class="token number">950.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7902</span> <span class="token operator">|</span> FORD   <span class="token operator">|</span> analyst   <span class="token operator">|</span> <span class="token number">7566</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">03</span> <span class="token operator">|</span> <span class="token number">3000.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7934</span> <span class="token operator">|</span> MILLER <span class="token operator">|</span> clerk     <span class="token operator">|</span> <span class="token number">7782</span> <span class="token operator">|</span> <span class="token number">1992</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">23</span> <span class="token operator">|</span> <span class="token number">1300.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+--------+-----------+------+------------+---------+---------+--------+</span>
<span class="token number">13</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> concat<span class="token punctuation">(</span>ename<span class="token punctuation">,</span><span class="token string">&quot;--&quot;</span><span class="token punctuation">,</span>job<span class="token punctuation">)</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> sal<span class="token operator">&gt;=</span><span class="token number">3000.00</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------------------------+</span>
<span class="token operator">|</span> concat<span class="token punctuation">(</span>ename<span class="token punctuation">,</span><span class="token string">&quot;--&quot;</span><span class="token punctuation">,</span>job<span class="token punctuation">)</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------------------+</span>
<span class="token operator">|</span> SCOTT<span class="token comment">--analyst         |</span>
<span class="token operator">|</span> KING<span class="token comment">--president        |</span>
<span class="token operator">|</span> FORD<span class="token comment">--analyst          |</span>
<span class="token operator">+</span><span class="token comment">------------------------+</span>
<span class="token number">3</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

<span class="token comment">#CONCAT(s1,s2...sn)	å­—ç¬¦ä¸² s1,s2 ç­‰å¤šä¸ªå­—ç¬¦ä¸²åˆå¹¶ä¸ºä¸€ä¸ªå­—ç¬¦ä¸² å¯ä»¥æ˜¯è¿ç®—æˆ–è€…æ—¥æœŸåŠ ä¸Šå­—ç¬¦ä¸²åˆå¹¶æˆä¸€ä¸ªå­—ç¬¦ä¸²</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> ename<span class="token punctuation">,</span>CONCAT<span class="token punctuation">(</span><span class="token string">&#39;å·²å…¥èŒ:&#39;</span><span class="token punctuation">,</span><span class="token keyword">TRUNCATE</span><span class="token punctuation">(</span><span class="token punctuation">(</span>DATEDIFF<span class="token punctuation">(</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>hiredate<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">365</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&#39;å¹´&#39;</span><span class="token punctuation">,</span><span class="token keyword">TRUNCATE</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">TRUNCATE</span><span class="token punctuation">(</span><span class="token punctuation">(</span>DATEDIFF<span class="token punctuation">(</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>hiredate<span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">365</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&#39;æœˆ&#39;</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">TRUNCATE</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">TRUNCATE</span><span class="token punctuation">(</span><span class="token punctuation">(</span>DATEDIFF<span class="token punctuation">(</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>hiredate<span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">365</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&#39;å¤©&#39;</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token string">&#39;å…¥èŒå¹´é™&#39;</span> <span class="token keyword">from</span> emp<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">--------+---------------------------+</span>
<span class="token operator">|</span> ename  <span class="token operator">|</span> å…¥èŒå¹´é™                  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------+---------------------------+</span>
<span class="token operator">|</span> SMITH  <span class="token operator">|</span> å·²å…¥èŒ:<span class="token number">31</span>å¹´<span class="token number">9</span>æœˆ<span class="token number">1</span>å¤©         <span class="token operator">|</span>
<span class="token operator">|</span> ALLEN  <span class="token operator">|</span> å·²å…¥èŒ:<span class="token number">31</span>å¹´<span class="token number">6</span>æœˆ<span class="token number">26</span>å¤©        <span class="token operator">|</span>
<span class="token operator">|</span> WARD   <span class="token operator">|</span> å·²å…¥èŒ:<span class="token number">31</span>å¹´<span class="token number">6</span>æœˆ<span class="token number">24</span>å¤©        <span class="token operator">|</span>
<span class="token operator">|</span> JONES  <span class="token operator">|</span> å·²å…¥èŒ:<span class="token number">31</span>å¹´<span class="token number">5</span>æœˆ<span class="token number">15</span>å¤©        <span class="token operator">|</span>
<span class="token operator">|</span> MARTIN <span class="token operator">|</span> å·²å…¥èŒ:<span class="token number">30</span>å¹´<span class="token number">11</span>æœˆ<span class="token number">21</span>å¤©       <span class="token operator">|</span>
<span class="token operator">|</span> BLAKE  <span class="token operator">|</span> å·²å…¥èŒ:<span class="token number">31</span>å¹´<span class="token number">4</span>æœˆ<span class="token number">16</span>å¤©        <span class="token operator">|</span>
<span class="token operator">|</span> CLARK  <span class="token operator">|</span> å·²å…¥èŒ:<span class="token number">31</span>å¹´<span class="token number">3</span>æœˆ<span class="token number">7</span>å¤©         <span class="token operator">|</span>
<span class="token operator">|</span> SCOTT  <span class="token operator">|</span> å·²å…¥èŒ:<span class="token number">25</span>å¹´<span class="token number">4</span>æœˆ<span class="token number">26</span>å¤©        <span class="token operator">|</span>
<span class="token operator">|</span> KING   <span class="token operator">|</span> å·²å…¥èŒ:<span class="token number">30</span>å¹´<span class="token number">10</span>æœˆ<span class="token number">1</span>å¤©        <span class="token operator">|</span>
<span class="token operator">|</span> TURNER <span class="token operator">|</span> å·²å…¥èŒ:<span class="token number">31</span>å¹´<span class="token number">0</span>æœˆ<span class="token number">6</span>å¤©         <span class="token operator">|</span>
<span class="token operator">|</span> JAMES  <span class="token operator">|</span> å·²å…¥èŒ:<span class="token number">30</span>å¹´<span class="token number">9</span>æœˆ<span class="token number">15</span>å¤©        <span class="token operator">|</span>
<span class="token operator">|</span> FORD   <span class="token operator">|</span> å·²å…¥èŒ:<span class="token number">30</span>å¹´<span class="token number">9</span>æœˆ<span class="token number">15</span>å¤©        <span class="token operator">|</span>
<span class="token operator">|</span> MILLER <span class="token operator">|</span> å·²å…¥èŒ:<span class="token number">30</span>å¹´<span class="token number">7</span>æœˆ<span class="token number">24</span>å¤©        <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------+---------------------------+</span>
<span class="token number">13</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">update</span> emp <span class="token keyword">set</span> job<span class="token operator">=</span>concat<span class="token punctuation">(</span>upper<span class="token punctuation">(</span><span class="token keyword">left</span><span class="token punctuation">(</span>job<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">mid</span><span class="token punctuation">(</span>job<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- ä¿®æ”¹å­—æ®µä¸­çš„å­—ç¬¦ä¸²å°†é¦–å­—ç¬¦æ”¹æˆå°å†™</span>
<span class="token comment">-- 1.ä½¿ç”¨leftï¼ˆåˆ—åï¼Œ1ï¼‰å°†å­—ç¬¦ä¸²ä¸­çš„é¦–å­—æ¯æ‹¿åˆ°</span>
<span class="token comment">-- 1.1ä½¿ç”¨upperï¼ˆ1ï¼‰å°†æ‹¿åˆ°çš„å­—ç¬¦ä¸²é¦–å­—æ¯è½¬æ¢æˆå¤§å†™çš„</span>
<span class="token comment">-- 2.ä½¿ç”¨midï¼ˆåˆ—åï¼Œ2ï¼‰å°†å­—ç¬¦ä¸²ä¸­é™¤äº†é¦–å­—æ¯çš„å‰©ä½™å­—ç¬¦æ‹¿åˆ°</span>
<span class="token comment">-- 3.ä½¿ç”¨concatï¼ˆ1.1ï¼Œ2ï¼‰å°†æ‹¿åˆ°çš„ä¸¤ä¸ªéƒ¨åˆ†ç»„åˆèµ·æ¥</span>
<span class="token comment">-- 4.ä½¿ç”¨update è¡¨å set åˆ—å=3ï¼›ä½¿ç”¨updateæ–¹æ³•è¿›è¡Œä¿®æ”¹</span>
Query OK<span class="token punctuation">,</span> <span class="token number">13</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>
<span class="token keyword">Rows</span> <span class="token keyword">matched</span>: <span class="token number">13</span>  Changed: <span class="token number">13</span>  <span class="token keyword">Warnings</span>: <span class="token number">0</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-------+--------+-----------+------+------------+---------+---------+--------+</span>
<span class="token operator">|</span> empno <span class="token operator">|</span> ename  <span class="token operator">|</span> job       <span class="token operator">|</span> mgr  <span class="token operator">|</span> hiredate   <span class="token operator">|</span> sal     <span class="token operator">|</span> comm    <span class="token operator">|</span> deptno <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+--------+-----------+------+------------+---------+---------+--------+</span>
<span class="token operator">|</span>  <span class="token number">7369</span> <span class="token operator">|</span> SMITH  <span class="token operator">|</span> Clerk     <span class="token operator">|</span> <span class="token number">7902</span> <span class="token operator">|</span> <span class="token number">1990</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">17</span> <span class="token operator">|</span>  <span class="token number">800.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7499</span> <span class="token operator">|</span> ALLEN  <span class="token operator">|</span> Salesman  <span class="token operator">|</span> <span class="token number">7698</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">20</span> <span class="token operator">|</span> <span class="token number">1600.00</span> <span class="token operator">|</span>  <span class="token number">300.00</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7521</span> <span class="token operator">|</span> WARD   <span class="token operator">|</span> Salesman  <span class="token operator">|</span> <span class="token number">7698</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">22</span> <span class="token operator">|</span> <span class="token number">1250.00</span> <span class="token operator">|</span>  <span class="token number">500.00</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7566</span> <span class="token operator">|</span> JONES  <span class="token operator">|</span> Manager   <span class="token operator">|</span> <span class="token number">7839</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">02</span> <span class="token operator">|</span> <span class="token number">2975.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7654</span> <span class="token operator">|</span> MARTIN <span class="token operator">|</span> Salesman  <span class="token operator">|</span> <span class="token number">7698</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">28</span> <span class="token operator">|</span> <span class="token number">1250.00</span> <span class="token operator">|</span> <span class="token number">1400.00</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7698</span> <span class="token operator">|</span> BLAKE  <span class="token operator">|</span> Manager   <span class="token operator">|</span> <span class="token number">7839</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">01</span> <span class="token operator">|</span> <span class="token number">2850.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7782</span> <span class="token operator">|</span> CLARK  <span class="token operator">|</span> Manager   <span class="token operator">|</span> <span class="token number">7839</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">09</span> <span class="token operator">|</span> <span class="token number">2450.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7788</span> <span class="token operator">|</span> SCOTT  <span class="token operator">|</span> Analyst   <span class="token operator">|</span> <span class="token number">7566</span> <span class="token operator">|</span> <span class="token number">1997</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">19</span> <span class="token operator">|</span> <span class="token number">3000.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7839</span> <span class="token operator">|</span> KING   <span class="token operator">|</span> President <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">17</span> <span class="token operator">|</span> <span class="token number">5000.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7844</span> <span class="token operator">|</span> TURNER <span class="token operator">|</span> Salesman  <span class="token operator">|</span> <span class="token number">7698</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">08</span> <span class="token operator">|</span> <span class="token number">1500.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7900</span> <span class="token operator">|</span> JAMES  <span class="token operator">|</span> Clerk     <span class="token operator">|</span> <span class="token number">7698</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">03</span> <span class="token operator">|</span>  <span class="token number">950.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7902</span> <span class="token operator">|</span> FORD   <span class="token operator">|</span> Analyst   <span class="token operator">|</span> <span class="token number">7566</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">03</span> <span class="token operator">|</span> <span class="token number">3000.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7934</span> <span class="token operator">|</span> MILLER <span class="token operator">|</span> Clerk     <span class="token operator">|</span> <span class="token number">7782</span> <span class="token operator">|</span> <span class="token number">1992</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">23</span> <span class="token operator">|</span> <span class="token number">1300.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+--------+-----------+------+------------+---------+---------+--------+</span>
<span class="token number">13</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">update</span> emp <span class="token keyword">set</span> ename<span class="token operator">=</span>concat<span class="token punctuation">(</span><span class="token keyword">left</span><span class="token punctuation">(</span>ename<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>lower<span class="token punctuation">(</span><span class="token function">mid</span><span class="token punctuation">(</span>ename<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">13</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
<span class="token keyword">Rows</span> <span class="token keyword">matched</span>: <span class="token number">13</span>  Changed: <span class="token number">13</span>  <span class="token keyword">Warnings</span>: <span class="token number">0</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-------+--------+-----------+------+------------+---------+---------+--------+</span>
<span class="token operator">|</span> empno <span class="token operator">|</span> ename  <span class="token operator">|</span> job       <span class="token operator">|</span> mgr  <span class="token operator">|</span> hiredate   <span class="token operator">|</span> sal     <span class="token operator">|</span> comm    <span class="token operator">|</span> deptno <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+--------+-----------+------+------------+---------+---------+--------+</span>
<span class="token operator">|</span>  <span class="token number">7369</span> <span class="token operator">|</span> Smith  <span class="token operator">|</span> clerk     <span class="token operator">|</span> <span class="token number">7902</span> <span class="token operator">|</span> <span class="token number">1990</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">17</span> <span class="token operator">|</span>  <span class="token number">800.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7499</span> <span class="token operator">|</span> Allen  <span class="token operator">|</span> salesman  <span class="token operator">|</span> <span class="token number">7698</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">20</span> <span class="token operator">|</span> <span class="token number">1600.00</span> <span class="token operator">|</span>  <span class="token number">300.00</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7521</span> <span class="token operator">|</span> Ward   <span class="token operator">|</span> salesman  <span class="token operator">|</span> <span class="token number">7698</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">22</span> <span class="token operator">|</span> <span class="token number">1250.00</span> <span class="token operator">|</span>  <span class="token number">500.00</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7566</span> <span class="token operator">|</span> Jones  <span class="token operator">|</span> manager   <span class="token operator">|</span> <span class="token number">7839</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">02</span> <span class="token operator">|</span> <span class="token number">2975.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7654</span> <span class="token operator">|</span> Martin <span class="token operator">|</span> salesman  <span class="token operator">|</span> <span class="token number">7698</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">28</span> <span class="token operator">|</span> <span class="token number">1250.00</span> <span class="token operator">|</span> <span class="token number">1400.00</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7698</span> <span class="token operator">|</span> Blake  <span class="token operator">|</span> manager   <span class="token operator">|</span> <span class="token number">7839</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">01</span> <span class="token operator">|</span> <span class="token number">2850.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7782</span> <span class="token operator">|</span> Clark  <span class="token operator">|</span> manager   <span class="token operator">|</span> <span class="token number">7839</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">09</span> <span class="token operator">|</span> <span class="token number">2450.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7788</span> <span class="token operator">|</span> Scott  <span class="token operator">|</span> analyst   <span class="token operator">|</span> <span class="token number">7566</span> <span class="token operator">|</span> <span class="token number">1997</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">19</span> <span class="token operator">|</span> <span class="token number">3000.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7839</span> <span class="token operator">|</span> King   <span class="token operator">|</span> president <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">17</span> <span class="token operator">|</span> <span class="token number">5000.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7844</span> <span class="token operator">|</span> Turner <span class="token operator">|</span> salesman  <span class="token operator">|</span> <span class="token number">7698</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">08</span> <span class="token operator">|</span> <span class="token number">1500.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7900</span> <span class="token operator">|</span> James  <span class="token operator">|</span> clerk     <span class="token operator">|</span> <span class="token number">7698</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">03</span> <span class="token operator">|</span>  <span class="token number">950.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7902</span> <span class="token operator">|</span> Ford   <span class="token operator">|</span> analyst   <span class="token operator">|</span> <span class="token number">7566</span> <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">03</span> <span class="token operator">|</span> <span class="token number">3000.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7934</span> <span class="token operator">|</span> Miller <span class="token operator">|</span> clerk     <span class="token operator">|</span> <span class="token number">7782</span> <span class="token operator">|</span> <span class="token number">1992</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">23</span> <span class="token operator">|</span> <span class="token number">1300.00</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span>     <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+--------+-----------+------+------------+---------+---------+--------+</span>
<span class="token number">13</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>


<span class="token comment">#REPLACE(s,s1,s2)	å°†å­—ç¬¦ä¸² s2 æ›¿ä»£å­—ç¬¦ä¸² s ä¸­çš„å­—ç¬¦ä¸² s1	</span>
<span class="token comment">-- å°†å­—ç¬¦ä¸² abc ä¸­çš„å­—ç¬¦ a æ›¿æ¢ä¸ºå­—ç¬¦ xï¼š</span>

<span class="token keyword">SELECT</span> <span class="token keyword">REPLACE</span><span class="token punctuation">(</span><span class="token string">&#39;abc&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;a&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;x&#39;</span><span class="token punctuation">)</span> <span class="token comment">--xbc</span>

<span class="token comment">-- For instance</span>
<span class="token comment">-- å°†empè¡¨ä¸­çš„jobåˆ—çš„æ•°æ®é¦–å­—ç¬¦çš„å°å†™å­—æ¯replaceä¸ºå¤§å†™å­—æ¯</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token keyword">replace</span><span class="token punctuation">(</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> job<span class="token punctuation">,</span><span class="token keyword">left</span><span class="token punctuation">(</span>job<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>upper<span class="token punctuation">(</span><span class="token keyword">left</span><span class="token punctuation">(</span>job<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token punctuation">)</span> <span class="token keyword">from</span> emp<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-----------------------------------------------+</span>
<span class="token operator">|</span> <span class="token keyword">replace</span><span class="token punctuation">(</span>
job<span class="token punctuation">,</span><span class="token keyword">left</span><span class="token punctuation">(</span>job<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>upper<span class="token punctuation">(</span><span class="token keyword">left</span><span class="token punctuation">(</span>job<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------------------------------------------+</span>
<span class="token operator">|</span> Clerk                                         <span class="token operator">|</span>
<span class="token operator">|</span> SaleSman                                      <span class="token operator">|</span>
<span class="token operator">|</span> SaleSman                                      <span class="token operator">|</span>
<span class="token operator">|</span> Manager                                       <span class="token operator">|</span>
<span class="token operator">|</span> SaleSman                                      <span class="token operator">|</span>
<span class="token operator">|</span> Manager                                       <span class="token operator">|</span>
<span class="token operator">|</span> Manager                                       <span class="token operator">|</span>
<span class="token operator">|</span> AnAlyst                                       <span class="token operator">|</span>
<span class="token operator">|</span> President                                     <span class="token operator">|</span>
<span class="token operator">|</span> SaleSman                                      <span class="token operator">|</span>
<span class="token operator">|</span> Clerk                                         <span class="token operator">|</span>
<span class="token operator">|</span> AnAlyst                                       <span class="token operator">|</span>
<span class="token operator">|</span> Clerk                                         <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------------------------------------------+</span>
<span class="token number">13</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="æ•°å­¦å‡½æ•°" tabindex="-1"><a class="header-anchor" href="#æ•°å­¦å‡½æ•°" aria-hidden="true">#</a> æ•°å­¦å‡½æ•°</h5><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">#ABS(x)	è¿”å› x çš„ç»å¯¹å€¼ã€€ã€€	</span>
<span class="token comment">-- è¿”å› -1 çš„ç»å¯¹å€¼ï¼š</span>
<span class="token keyword">SELECT</span> ABS<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">-- è¿”å›1</span>
<span class="token comment">-- For instance</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> abs<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">125</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-----------+</span>
<span class="token operator">|</span> abs<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">125</span><span class="token punctuation">)</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------+</span>
<span class="token operator">|</span>       <span class="token number">125</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

<span class="token comment">#BIN(x)	è¿”å› x çš„äºŒè¿›åˆ¶ç¼–ç 	</span>
<span class="token comment">-- 15 çš„ 2 è¿›åˆ¶ç¼–ç :</span>
<span class="token keyword">SELECT</span> BIN<span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">-- 1111</span>
<span class="token comment">-- For instance</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> bin<span class="token punctuation">(</span><span class="token number">56</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------+</span>
<span class="token operator">|</span> bin<span class="token punctuation">(</span><span class="token number">56</span><span class="token punctuation">)</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+</span>
<span class="token operator">|</span> <span class="token number">111000</span>  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

<span class="token comment">#CONV(x,f1,f2)	è¿”å› f1 è¿›åˆ¶æ•°å˜æˆ f2 è¿›åˆ¶æ•°	</span>
<span class="token keyword">SELECT</span> CONV<span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">1111</span>

<span class="token comment">#CEILING(x)	è¿”å›å¤§äºæˆ–ç­‰äº x çš„æœ€å°æ•´æ•°ã€€</span>
<span class="token keyword">SELECT</span> CEILING<span class="token punctuation">(</span><span class="token number">1.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">-- è¿”å›2</span>
<span class="token comment">-- For instance</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> ceiling<span class="token punctuation">(</span><span class="token number">1.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">--------------+</span>
<span class="token operator">|</span> ceiling<span class="token punctuation">(</span><span class="token number">1.1</span><span class="token punctuation">)</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------+</span>
<span class="token operator">|</span>            <span class="token number">2</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> ceiling<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2.9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------------+</span>
<span class="token operator">|</span> ceiling<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2.9</span><span class="token punctuation">)</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------+</span>
<span class="token operator">|</span>            <span class="token operator">-</span><span class="token number">2</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

<span class="token comment">#FLOOR(x)	è¿”å›å°äºæˆ–ç­‰äº x çš„æœ€å¤§æ•´æ•°ã€€ã€€</span>
<span class="token comment">-- å°äºæˆ–ç­‰äº 1.5 çš„æ•´æ•°ï¼š</span>
<span class="token keyword">SELECT</span> FLOOR<span class="token punctuation">(</span><span class="token number">1.5</span><span class="token punctuation">)</span> <span class="token comment">-- è¿”å›1</span>
<span class="token comment">-- For instance</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> floor<span class="token punctuation">(</span><span class="token number">1.9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------------+</span>
<span class="token operator">|</span> floor<span class="token punctuation">(</span><span class="token number">1.9</span><span class="token punctuation">)</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------+</span>
<span class="token operator">|</span>          <span class="token number">1</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> floor<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-------------+</span>
<span class="token operator">|</span> floor<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1.1</span><span class="token punctuation">)</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------+</span>
<span class="token operator">|</span>          <span class="token operator">-</span><span class="token number">2</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

<span class="token comment">#TRUNCATE(x,y)	è¿”å›æ•°å€¼ x ä¿ç•™åˆ°å°æ•°ç‚¹å y ä½çš„å€¼ï¼ˆæœ€åä¸€ä½ä¸ä¼šè¿›è¡Œå››èˆäº”å…¥ï¼‰</span>
<span class="token keyword">SELECT</span> <span class="token keyword">TRUNCATE</span><span class="token punctuation">(</span><span class="token number">1.23456</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment">-- 1.234</span>

<span class="token comment">#FORMAT(x,n)	å‡½æ•°å¯ä»¥å°†æ•°å­— x è¿›è¡Œæ ¼å¼åŒ– &quot;#,###.##&quot;, å°† x ä¿ç•™åˆ°å°æ•°ç‚¹å n ä½ï¼Œæœ€åä¸€ä½å››èˆäº”å…¥ã€‚	</span>
<span class="token comment">-- æ ¼å¼åŒ–æ•°å­— &quot;#,###.##&quot; å½¢å¼ï¼š</span>
<span class="token keyword">SELECT</span> <span class="token function">FORMAT</span><span class="token punctuation">(</span><span class="token number">250500.5634</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">-- è¾“å‡º 250,500.56</span>
<span class="token comment">-- For instance</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> sal <span class="token keyword">from</span> emp<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------+</span>
<span class="token operator">|</span> sal     <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+</span>
<span class="token operator">|</span>  <span class="token number">800.00</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">1600.00</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">1250.00</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2975.00</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">1250.00</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2850.00</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2450.00</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">3000.00</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">5000.00</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">1500.00</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">950.00</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">3000.00</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">1300.00</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+</span>
<span class="token number">13</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token function">format</span><span class="token punctuation">(</span>sal<span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token keyword">from</span> emp<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------------+</span>
<span class="token operator">|</span> <span class="token function">format</span><span class="token punctuation">(</span>sal<span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------+</span>
<span class="token operator">|</span> <span class="token number">800.00000</span>     <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">600.00000</span>   <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">250.00000</span>   <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2</span><span class="token punctuation">,</span><span class="token number">975.00000</span>   <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">250.00000</span>   <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2</span><span class="token punctuation">,</span><span class="token number">850.00000</span>   <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2</span><span class="token punctuation">,</span><span class="token number">450.00000</span>   <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">3</span><span class="token punctuation">,</span><span class="token number">000.00000</span>   <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">5</span><span class="token punctuation">,</span><span class="token number">000.00000</span>   <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">500.00000</span>   <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">950.00000</span>     <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">3</span><span class="token punctuation">,</span><span class="token number">000.00000</span>   <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">300.00000</span>   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------+</span>
<span class="token number">13</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

<span class="token comment">#LEAST(expr1, expr2, expr3, ...)	è¿”å›åˆ—è¡¨ä¸­çš„æœ€å°å€¼	</span>
<span class="token comment">-- è¿”å›ä»¥ä¸‹æ•°å­—åˆ—è¡¨ä¸­çš„æœ€å°å€¼ï¼š</span>
<span class="token keyword">SELECT</span> LEAST<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">34</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">-- 3</span>
<span class="token comment">-- è¿”å›ä»¥ä¸‹å­—ç¬¦ä¸²åˆ—è¡¨ä¸­çš„æœ€å°å€¼ï¼š</span>
<span class="token keyword">SELECT</span> LEAST<span class="token punctuation">(</span><span class="token string">&quot;Google&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Runoob&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Apple&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">-- Apple</span>

<span class="token comment">#MOD(x,y)	è¿”å› x é™¤ä»¥ y ä»¥åçš„ä½™æ•°ã€€	</span>
<span class="token comment">-- 5 é™¤äº 2 çš„ä½™æ•°ï¼š</span>
<span class="token keyword">SELECT</span> <span class="token function">MOD</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">-- 1</span>

<span class="token comment">#RAND()	è¿”å› 0 åˆ° 1 çš„éšæœºæ•°ã€€ã€€	</span>
<span class="token keyword">SELECT</span> RAND<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">--0.93099315644334</span>
<span class="token comment">-- RAND(seed) åœ¨å¼€å‘ä¸­æŒ‡å®šäº†seedåˆ™ä¼šå›ºå®šå¾—åˆ°ä¸€ä¸ª0-1çš„éšæœºæ•°</span>
<span class="token comment">-- For instance</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> rand<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">--------------------+</span>
<span class="token operator">|</span> rand<span class="token punctuation">(</span><span class="token punctuation">)</span>             <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------------+</span>
<span class="token operator">|</span> <span class="token number">0.9477880121653788</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> rand<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">--------------------+</span>
<span class="token operator">|</span> rand<span class="token punctuation">(</span><span class="token punctuation">)</span>             <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------------+</span>
<span class="token operator">|</span> <span class="token number">0.7799059001541752</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> rand<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------------------+</span>
<span class="token operator">|</span> rand<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>             <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------------+</span>
<span class="token operator">|</span> <span class="token number">0.40613597483014313</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
<span class="token comment">-- RAND(seed) åœ¨å¼€å‘ä¸­æŒ‡å®šäº†seedåˆ™ä¼šå›ºå®šå¾—åˆ°ä¸€ä¸ª0-1çš„éšæœºæ•°</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> rand<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------------------+</span>
<span class="token operator">|</span> rand<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>             <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------------+</span>
<span class="token operator">|</span> <span class="token number">0.40613597483014313</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> rand<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------------------+</span>
<span class="token operator">|</span> rand<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>             <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------------+</span>
<span class="token operator">|</span> <span class="token number">0.40613597483014313</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

<span class="token comment">#ROUND(x)	è¿”å›ç¦» x æœ€è¿‘çš„æ•´æ•°	</span>
<span class="token keyword">SELECT</span> <span class="token function">ROUND</span><span class="token punctuation">(</span><span class="token number">1.23456</span><span class="token punctuation">)</span> <span class="token comment">--1</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="ç³»ç»Ÿå‡½æ•°-åŠ å¯†å‡½æ•°" tabindex="-1"><a class="header-anchor" href="#ç³»ç»Ÿå‡½æ•°-åŠ å¯†å‡½æ•°" aria-hidden="true">#</a> ç³»ç»Ÿå‡½æ•°&amp;åŠ å¯†å‡½æ•°</h5><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">#USER()	è¿”å›å½“å‰ç”¨æˆ·	</span>
<span class="token keyword">SELECT</span> <span class="token keyword">USER</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">-</span><span class="token operator">&gt;</span> guest@<span class="token operator">%</span>

<span class="token comment">#DATABASE()	è¿”å›å½“å‰æ•°æ®åº“å	</span>
<span class="token keyword">SELECT</span> <span class="token keyword">DATABASE</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   
<span class="token operator">-</span><span class="token operator">&gt;</span> runoob

<span class="token comment"># MD5ï¼ˆstrï¼‰ ä¸ºå­—ç¬¦ä¸²ç®—å‡ºä¸€ä¸ªMD5 char(32) çš„å­—ç¬¦ä¸²--ç”¨æˆ·å¯†ç åŠ å¯†</span>
<span class="token comment">-- root å¯†ç å­˜å…¥çš„æ˜¯åŠ å¯†åçš„</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> MD5<span class="token punctuation">(</span><span class="token string">&#39;zjhzjhzjh&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----------------------------------+</span>
<span class="token operator">|</span> MD5<span class="token punctuation">(</span><span class="token string">&#39;zjhzjhzjh&#39;</span><span class="token punctuation">)</span>                 <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------------------+</span>
<span class="token operator">|</span> <span class="token number">4192290</span>b1061348ea435f0595e65e933 <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">insert</span> <span class="token keyword">into</span> student4 <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">1001</span><span class="token punctuation">,</span><span class="token string">&#39;å¼ é”¦è±ª&#39;</span><span class="token punctuation">,</span>MD5<span class="token punctuation">(</span><span class="token string">&#39;zjh20001207&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">current_date</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">row</span> affected <span class="token punctuation">(</span><span class="token number">0.14</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> student4<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+-----------+----------------------------------+------------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> name      <span class="token operator">|</span> password                         <span class="token operator">|</span> birthday   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+-----------+----------------------------------+------------+</span>
<span class="token operator">|</span> <span class="token number">1001</span> <span class="token operator">|</span> å¼ é”¦è±ª    <span class="token operator">|</span> dd60ed8124010280d53bda4cfd3bb6a5 <span class="token operator">|</span> <span class="token number">2022</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">02</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+-----------+----------------------------------+------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="æµç¨‹æ§åˆ¶" tabindex="-1"><a class="header-anchor" href="#æµç¨‹æ§åˆ¶" aria-hidden="true">#</a> æµç¨‹æ§åˆ¶</h5><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">#IF(expr,v1,v2)	å¦‚æœè¡¨è¾¾å¼ expr æˆç«‹ï¼Œè¿”å›ç»“æœ v1ï¼›å¦åˆ™ï¼Œè¿”å›ç»“æœ v2ã€‚	</span>
<span class="token keyword">SELECT</span> <span class="token keyword">IF</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&#39;æ­£ç¡®&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;é”™è¯¯&#39;</span><span class="token punctuation">)</span>    
<span class="token operator">-</span><span class="token operator">&gt;</span>æ­£ç¡®

<span class="token comment">#IFNULL(v1,v2)	å¦‚æœ v1 çš„å€¼ä¸ä¸º NULLï¼Œåˆ™è¿”å› v1ï¼Œå¦åˆ™è¿”å› v2ã€‚	</span>
<span class="token keyword">SELECT</span> IFNULL<span class="token punctuation">(</span><span class="token boolean">null</span><span class="token punctuation">,</span><span class="token string">&#39;Hello Word&#39;</span><span class="token punctuation">)</span>
<span class="token operator">-</span><span class="token operator">&gt;</span>Hello Word

<span class="token comment">#CASE expression</span>
    <span class="token keyword">WHEN</span> condition1 <span class="token keyword">THEN</span> result1
    <span class="token keyword">WHEN</span> condition2 <span class="token keyword">THEN</span> result2
   <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">WHEN</span> conditionN <span class="token keyword">THEN</span> resultN
    <span class="token keyword">ELSE</span> result
	<span class="token keyword">END</span>	
<span class="token keyword">CASE</span> è¡¨ç¤ºå‡½æ•°å¼€å§‹ï¼Œ<span class="token keyword">END</span> è¡¨ç¤ºå‡½æ•°ç»“æŸã€‚å¦‚æœ condition1 æˆç«‹ï¼Œåˆ™è¿”å› result1<span class="token punctuation">,</span> å¦‚æœ condition2 æˆç«‹ï¼Œåˆ™è¿”å› result2ï¼Œå½“å…¨éƒ¨ä¸æˆç«‹åˆ™è¿”å› resultï¼Œè€Œå½“æœ‰ä¸€ä¸ªæˆç«‹ä¹‹åï¼Œåé¢çš„å°±ä¸æ‰§è¡Œäº†ã€‚	
<span class="token keyword">SELECT</span> <span class="token keyword">CASE</span> 
ã€€ã€€<span class="token keyword">WHEN</span> <span class="token number">1</span> <span class="token operator">&gt;</span> <span class="token number">0</span>
ã€€ã€€<span class="token keyword">THEN</span> <span class="token string">&#39;1 &gt; 0&#39;</span>
ã€€ã€€<span class="token keyword">WHEN</span> <span class="token number">2</span> <span class="token operator">&gt;</span> <span class="token number">0</span>
ã€€ã€€<span class="token keyword">THEN</span> <span class="token string">&#39;2 &gt; 0&#39;</span>
ã€€ã€€<span class="token keyword">ELSE</span> <span class="token string">&#39;3 &gt; 0&#39;</span>
ã€€ã€€<span class="token keyword">END</span>
<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token number">1</span> <span class="token operator">&gt;</span> <span class="token number">0</span>

<span class="token comment">-- For instance</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token keyword">case</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span>     <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">when</span> job<span class="token operator">=</span><span class="token string">&#39;clerk&#39;</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span>     <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">then</span> <span class="token string">&#39;èŒå‘˜&#39;</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span>     <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">when</span> job<span class="token operator">=</span><span class="token string">&#39;manager&#39;</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span>     <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">then</span> <span class="token string">&#39;ç»ç†&#39;</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span>     <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">when</span> job<span class="token operator">=</span><span class="token string">&#39;salesman&#39;</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span>     <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">when</span> job<span class="token operator">=</span><span class="token string">&#39;salesman&#39;</span><span class="token operator">^</span>C
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token keyword">case</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">when</span> job<span class="token operator">=</span><span class="token string">&#39;clerk&#39;</span> <span class="token keyword">then</span> <span class="token string">&#39;èŒå‘˜&#39;</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">when</span> job<span class="token operator">=</span><span class="token string">&#39;manager&#39;</span> <span class="token keyword">then</span> <span class="token string">&#39;ç»ç†&#39;</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">when</span> job<span class="token operator">=</span><span class="token string">&#39;salesman&#39;</span> <span class="token keyword">then</span> <span class="token string">&#39;é”€å”®&#39;</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">else</span> job
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">end</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">from</span> emp<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------------------------------------------------------------------------------------------------------------------+</span>
<span class="token operator">|</span> <span class="token keyword">case</span>
<span class="token keyword">when</span> job<span class="token operator">=</span><span class="token string">&#39;clerk&#39;</span> <span class="token keyword">then</span> <span class="token string">&#39;èŒå‘˜&#39;</span>
<span class="token keyword">when</span> job<span class="token operator">=</span><span class="token string">&#39;manager&#39;</span> <span class="token keyword">then</span> <span class="token string">&#39;ç»ç†&#39;</span>
<span class="token keyword">when</span> job<span class="token operator">=</span><span class="token string">&#39;salesman&#39;</span> <span class="token keyword">then</span> <span class="token string">&#39;é”€å”®&#39;</span>
<span class="token keyword">else</span> job
<span class="token keyword">end</span>       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------------------------------------------------------------------------------------------------------------+</span>
<span class="token operator">|</span> èŒå‘˜                                                                                                                <span class="token operator">|</span>
<span class="token operator">|</span> é”€å”®                                                                                                                <span class="token operator">|</span>
<span class="token operator">|</span> é”€å”®                                                                                                                <span class="token operator">|</span>
<span class="token operator">|</span> ç»ç†                                                                                                                <span class="token operator">|</span>
<span class="token operator">|</span> é”€å”®                                                                                                                <span class="token operator">|</span>
<span class="token operator">|</span> ç»ç†                                                                                                                <span class="token operator">|</span>
<span class="token operator">|</span> ç»ç†                                                                                                                <span class="token operator">|</span>
<span class="token operator">|</span> analyst                                                                                                             <span class="token operator">|</span>
<span class="token operator">|</span> president                                                                                                           <span class="token operator">|</span>
<span class="token operator">|</span> é”€å”®                                                                                                                <span class="token operator">|</span>
<span class="token operator">|</span> èŒå‘˜                                                                                                                <span class="token operator">|</span>
<span class="token operator">|</span> analyst                                                                                                             <span class="token operator">|</span>
<span class="token operator">|</span> èŒå‘˜                                                                                                                <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------------------------------------------------------------------------------------------------------------+</span>
<span class="token number">13</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="å†…è¿æ¥" tabindex="-1"><a class="header-anchor" href="#å†…è¿æ¥" aria-hidden="true">#</a> å†…è¿æ¥</h4><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">#è‡ªè¿æ¥-- æŠŠåŒä¸€å¼ è¡¨å½“ä½œä¸¤å¼ è¡¨æ¥ä½¿ç”¨ éœ€è¦ç»™è¡¨å‘½åˆ«åæ¥åŒºåˆ† ï¼ˆè¡¨å åˆ«å è¡¨å åˆ«åï¼‰åˆ—åä¸æ˜ç¡®æ—¶è¦ç»™åˆ— AS åˆ«å</span>
<span class="token comment">#å¼€å‘ä¸­å¸¸ç”¨</span>
<span class="token comment">-- For instance</span>
<span class="token comment">-- æŠŠä¸€å¼ è¡¨å½“ä½œä¸¤å¼ è¡¨æ¥ä½¿ç”¨ fromåç»™åŒä¸€å¼ è¡¨å‘½ä¸¤ä¸ªåˆ«åæ¥ä½œä¸ºä¸¤å¼ è¡¨è¿›è¡ŒåŒºåˆ† åˆ—çš„è¾“å…¥ä½¿ç”¨ è¡¨åˆ«å.åˆ—çš„å½¢å¼ æ¡ä»¶é™åˆ¶æ‰¾åˆ°å…³è”å¤„</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> worker<span class="token punctuation">.</span>ename <span class="token keyword">as</span> <span class="token string">&#39;woker&#39;</span><span class="token punctuation">,</span>leader<span class="token punctuation">.</span>ename <span class="token keyword">as</span> <span class="token string">&#39;leader&#39;</span> <span class="token keyword">from</span> emp worker<span class="token punctuation">,</span>emp leader <span class="token keyword">where</span> worker<span class="token punctuation">.</span>mgr<span class="token operator">=</span>leader<span class="token punctuation">.</span>empno<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">--------+--------+</span>
<span class="token operator">|</span> woker  <span class="token operator">|</span> leader <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------+--------+</span>
<span class="token operator">|</span> FORD   <span class="token operator">|</span> JONES  <span class="token operator">|</span>
<span class="token operator">|</span> SCOTT  <span class="token operator">|</span> JONES  <span class="token operator">|</span>
<span class="token operator">|</span> JAMES  <span class="token operator">|</span> BLAKE  <span class="token operator">|</span>
<span class="token operator">|</span> TURNER <span class="token operator">|</span> BLAKE  <span class="token operator">|</span>
<span class="token operator">|</span> MARTIN <span class="token operator">|</span> BLAKE  <span class="token operator">|</span>
<span class="token operator">|</span> WARD   <span class="token operator">|</span> BLAKE  <span class="token operator">|</span>
<span class="token operator">|</span> ALLEN  <span class="token operator">|</span> BLAKE  <span class="token operator">|</span>
<span class="token operator">|</span> MILLER <span class="token operator">|</span> CLARK  <span class="token operator">|</span>
<span class="token operator">|</span> CLARK  <span class="token operator">|</span> KING   <span class="token operator">|</span>
<span class="token operator">|</span> BLAKE  <span class="token operator">|</span> KING   <span class="token operator">|</span>
<span class="token operator">|</span> JONES  <span class="token operator">|</span> KING   <span class="token operator">|</span>
<span class="token operator">|</span> SMITH  <span class="token operator">|</span> FORD   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------+--------+</span>
<span class="token number">12</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="å¤–è¿æ¥â˜…" tabindex="-1"><a class="header-anchor" href="#å¤–è¿æ¥â˜…" aria-hidden="true">#</a> å¤–è¿æ¥â˜…</h4><blockquote><p>â‘ A inner join Bï¼šå–äº¤é›†</p><p>â‘¡A left join Bï¼šå–Aå…¨éƒ¨ï¼ŒBæ²¡æœ‰å¯¹åº”çš„å€¼ï¼Œåˆ™ä¸ºnull</p><p>â‘¢A right join Bï¼šå–Bå…¨éƒ¨ï¼ŒAæ²¡æœ‰å¯¹åº”çš„å€¼ï¼Œåˆ™ä¸ºnull</p><p>â‘£A full outer join Bï¼šå–å¹¶é›†ï¼Œå½¼æ­¤æ²¡æœ‰å¯¹åº”çš„å€¼ä¸ºnull</p></blockquote><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230612133415889.png" alt=""></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">#JOIN æŒ‰ç…§åŠŸèƒ½å¤§è‡´åˆ†ä¸ºå¦‚ä¸‹ä¸‰ç±»ï¼š</span>

<span class="token keyword">INNER</span> <span class="token keyword">JOIN</span>ï¼ˆå†…è¿æ¥<span class="token punctuation">,</span>æˆ–ç­‰å€¼è¿æ¥ï¼‰ï¼šè·å–ä¸¤ä¸ªè¡¨ä¸­å­—æ®µåŒ¹é…å…³ç³»çš„è®°å½•ã€‚
<span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span>ï¼ˆå·¦è¿æ¥ï¼‰ï¼šè·å–å·¦è¡¨æ‰€æœ‰è®°å½•ï¼Œå³ä½¿å³è¡¨æ²¡æœ‰å¯¹åº”åŒ¹é…çš„è®°å½•ã€‚
<span class="token keyword">RIGHT</span> <span class="token keyword">JOIN</span>ï¼ˆå³è¿æ¥ï¼‰ï¼š ä¸ <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> ç›¸åï¼Œç”¨äºè·å–å³è¡¨æ‰€æœ‰è®°å½•ï¼Œå³ä½¿å·¦è¡¨æ²¡æœ‰å¯¹åº”åŒ¹é…çš„è®°å½•ã€‚

<span class="token comment">-- </span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb1<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+---------------+--------------+------------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> title         <span class="token operator">|</span> author       <span class="token operator">|</span> <span class="token keyword">date</span>       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+---------------+--------------+------------+</span>
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span> å­¦ä¹  PHP      <span class="token operator">|</span> èœé¸Ÿæ•™ç¨‹     <span class="token operator">|</span> <span class="token number">2017</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">12</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">2</span> <span class="token operator">|</span> å­¦ä¹  MySQL    <span class="token operator">|</span> èœé¸Ÿæ•™ç¨‹     <span class="token operator">|</span> <span class="token number">2017</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">12</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">3</span> <span class="token operator">|</span> å­¦ä¹  Java     <span class="token operator">|</span> RUNOOB<span class="token punctuation">.</span>COM   <span class="token operator">|</span> <span class="token number">2015</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">01</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">4</span> <span class="token operator">|</span> å­¦ä¹  Python   <span class="token operator">|</span> RUNOOB<span class="token punctuation">.</span>COM   <span class="token operator">|</span> <span class="token number">2016</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">06</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">5</span> <span class="token operator">|</span> å­¦ä¹  C        <span class="token operator">|</span> FK           <span class="token operator">|</span> <span class="token boolean">NULL</span>       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+---------------+--------------+------------+</span>
<span class="token number">5</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb2<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">--------------+-------+</span>
<span class="token operator">|</span> author       <span class="token operator">|</span> count <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------+-------+</span>
<span class="token operator">|</span> èœé¸Ÿæ•™ç¨‹     <span class="token operator">|</span>    <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">|</span> RUNOOB<span class="token punctuation">.</span>COM   <span class="token operator">|</span>    <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span> Google       <span class="token operator">|</span>    <span class="token number">22</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------+-------+</span>
<span class="token number">3</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

<span class="token comment">#INNER JOINï¼ˆå†…è¿æ¥,æˆ–ç­‰å€¼è¿æ¥ï¼‰ï¼šè·å–ä¸¤ä¸ªè¡¨ä¸­å­—æ®µåŒ¹é…å…³ç³»çš„è®°å½•ã€‚</span>
<span class="token comment">-- For instance -- (inner) join on</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb1 <span class="token keyword">join</span> tb2 <span class="token keyword">on</span> tb1<span class="token punctuation">.</span>author <span class="token operator">=</span> tb2<span class="token punctuation">.</span>author<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+---------------+--------------+------------+--------------+-------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> title         <span class="token operator">|</span> author       <span class="token operator">|</span> <span class="token keyword">date</span>       <span class="token operator">|</span> author       <span class="token operator">|</span> count <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+---------------+--------------+------------+--------------+-------+</span>
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span> å­¦ä¹  PHP      <span class="token operator">|</span> èœé¸Ÿæ•™ç¨‹     <span class="token operator">|</span> <span class="token number">2017</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">12</span> <span class="token operator">|</span> èœé¸Ÿæ•™ç¨‹     <span class="token operator">|</span>    <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">2</span> <span class="token operator">|</span> å­¦ä¹  MySQL    <span class="token operator">|</span> èœé¸Ÿæ•™ç¨‹     <span class="token operator">|</span> <span class="token number">2017</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">12</span> <span class="token operator">|</span> èœé¸Ÿæ•™ç¨‹     <span class="token operator">|</span>    <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">3</span> <span class="token operator">|</span> å­¦ä¹  Java     <span class="token operator">|</span> RUNOOB<span class="token punctuation">.</span>COM   <span class="token operator">|</span> <span class="token number">2015</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">01</span> <span class="token operator">|</span> RUNOOB<span class="token punctuation">.</span>COM   <span class="token operator">|</span>    <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">4</span> <span class="token operator">|</span> å­¦ä¹  Python   <span class="token operator">|</span> RUNOOB<span class="token punctuation">.</span>COM   <span class="token operator">|</span> <span class="token number">2016</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">06</span> <span class="token operator">|</span> RUNOOB<span class="token punctuation">.</span>COM   <span class="token operator">|</span>    <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+---------------+--------------+------------+--------------+-------+</span>
<span class="token number">4</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
<span class="token comment">-- ç›¸å½“äºä½¿ç”¨whereå­å¥</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb1 <span class="token punctuation">,</span>tb2 <span class="token keyword">where</span> tb1<span class="token punctuation">.</span>author <span class="token operator">=</span> tb2<span class="token punctuation">.</span>author<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+---------------+--------------+------------+--------------+-------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> title         <span class="token operator">|</span> author       <span class="token operator">|</span> <span class="token keyword">date</span>       <span class="token operator">|</span> author       <span class="token operator">|</span> count <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+---------------+--------------+------------+--------------+-------+</span>
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span> å­¦ä¹  PHP      <span class="token operator">|</span> èœé¸Ÿæ•™ç¨‹     <span class="token operator">|</span> <span class="token number">2017</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">12</span> <span class="token operator">|</span> èœé¸Ÿæ•™ç¨‹     <span class="token operator">|</span>    <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">2</span> <span class="token operator">|</span> å­¦ä¹  MySQL    <span class="token operator">|</span> èœé¸Ÿæ•™ç¨‹     <span class="token operator">|</span> <span class="token number">2017</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">12</span> <span class="token operator">|</span> èœé¸Ÿæ•™ç¨‹     <span class="token operator">|</span>    <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">3</span> <span class="token operator">|</span> å­¦ä¹  Java     <span class="token operator">|</span> RUNOOB<span class="token punctuation">.</span>COM   <span class="token operator">|</span> <span class="token number">2015</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">01</span> <span class="token operator">|</span> RUNOOB<span class="token punctuation">.</span>COM   <span class="token operator">|</span>    <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">4</span> <span class="token operator">|</span> å­¦ä¹  Python   <span class="token operator">|</span> RUNOOB<span class="token punctuation">.</span>COM   <span class="token operator">|</span> <span class="token number">2016</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">06</span> <span class="token operator">|</span> RUNOOB<span class="token punctuation">.</span>COM   <span class="token operator">|</span>    <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+---------------+--------------+------------+--------------+-------+</span>
<span class="token number">4</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

<span class="token comment">#LEFT JOINï¼ˆå·¦è¿æ¥ï¼‰ï¼šè·å–å·¦è¡¨æ‰€æœ‰è®°å½•ï¼Œå³ä½¿å³è¡¨æ²¡æœ‰å¯¹åº”åŒ¹é…çš„è®°å½•ã€‚</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb1 <span class="token keyword">left</span> <span class="token keyword">join</span> tb2 <span class="token keyword">on</span> tb1<span class="token punctuation">.</span>author <span class="token operator">=</span> tb2<span class="token punctuation">.</span>author<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+---------------+--------------+------------+--------------+-------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> title         <span class="token operator">|</span> author       <span class="token operator">|</span> <span class="token keyword">date</span>       <span class="token operator">|</span> author       <span class="token operator">|</span> count <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+---------------+--------------+------------+--------------+-------+</span>
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span> å­¦ä¹  PHP      <span class="token operator">|</span> èœé¸Ÿæ•™ç¨‹     <span class="token operator">|</span> <span class="token number">2017</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">12</span> <span class="token operator">|</span> èœé¸Ÿæ•™ç¨‹     <span class="token operator">|</span>    <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">2</span> <span class="token operator">|</span> å­¦ä¹  MySQL    <span class="token operator">|</span> èœé¸Ÿæ•™ç¨‹     <span class="token operator">|</span> <span class="token number">2017</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">12</span> <span class="token operator">|</span> èœé¸Ÿæ•™ç¨‹     <span class="token operator">|</span>    <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">3</span> <span class="token operator">|</span> å­¦ä¹  Java     <span class="token operator">|</span> RUNOOB<span class="token punctuation">.</span>COM   <span class="token operator">|</span> <span class="token number">2015</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">01</span> <span class="token operator">|</span> RUNOOB<span class="token punctuation">.</span>COM   <span class="token operator">|</span>    <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">4</span> <span class="token operator">|</span> å­¦ä¹  Python   <span class="token operator">|</span> RUNOOB<span class="token punctuation">.</span>COM   <span class="token operator">|</span> <span class="token number">2016</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">06</span> <span class="token operator">|</span> RUNOOB<span class="token punctuation">.</span>COM   <span class="token operator">|</span>    <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">5</span> <span class="token operator">|</span> å­¦ä¹  C        <span class="token operator">|</span> FK           <span class="token operator">|</span> <span class="token boolean">NULL</span>       <span class="token operator">|</span> <span class="token boolean">NULL</span>         <span class="token operator">|</span>  <span class="token boolean">NULL</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+---------------+--------------+------------+--------------+-------+</span>
<span class="token number">5</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

<span class="token comment">#RIGHT JOINï¼ˆå³è¿æ¥ï¼‰ï¼š ä¸ LEFT JOIN ç›¸åï¼Œç”¨äºè·å–å³è¡¨æ‰€æœ‰è®°å½•ï¼Œå³ä½¿å·¦è¡¨æ²¡æœ‰å¯¹åº”åŒ¹é…çš„è®°å½•ã€‚</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb1 <span class="token keyword">right</span> <span class="token keyword">join</span> tb2 <span class="token keyword">on</span> tb1<span class="token punctuation">.</span>author <span class="token operator">=</span> tb2<span class="token punctuation">.</span>author<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+---------------+--------------+------------+--------------+-------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> title         <span class="token operator">|</span> author       <span class="token operator">|</span> <span class="token keyword">date</span>       <span class="token operator">|</span> author       <span class="token operator">|</span> count <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+---------------+--------------+------------+--------------+-------+</span>
<span class="token operator">|</span>    <span class="token number">2</span> <span class="token operator">|</span> å­¦ä¹  MySQL    <span class="token operator">|</span> èœé¸Ÿæ•™ç¨‹     <span class="token operator">|</span> <span class="token number">2017</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">12</span> <span class="token operator">|</span> èœé¸Ÿæ•™ç¨‹     <span class="token operator">|</span>    <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span> å­¦ä¹  PHP      <span class="token operator">|</span> èœé¸Ÿæ•™ç¨‹     <span class="token operator">|</span> <span class="token number">2017</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">12</span> <span class="token operator">|</span> èœé¸Ÿæ•™ç¨‹     <span class="token operator">|</span>    <span class="token number">10</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">4</span> <span class="token operator">|</span> å­¦ä¹  Python   <span class="token operator">|</span> RUNOOB<span class="token punctuation">.</span>COM   <span class="token operator">|</span> <span class="token number">2016</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">06</span> <span class="token operator">|</span> RUNOOB<span class="token punctuation">.</span>COM   <span class="token operator">|</span>    <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">3</span> <span class="token operator">|</span> å­¦ä¹  Java     <span class="token operator">|</span> RUNOOB<span class="token punctuation">.</span>COM   <span class="token operator">|</span> <span class="token number">2015</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">01</span> <span class="token operator">|</span> RUNOOB<span class="token punctuation">.</span>COM   <span class="token operator">|</span>    <span class="token number">20</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>          <span class="token operator">|</span> <span class="token boolean">NULL</span>         <span class="token operator">|</span> <span class="token boolean">NULL</span>       <span class="token operator">|</span> Google       <span class="token operator">|</span>    <span class="token number">22</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+---------------+--------------+------------+--------------+-------+</span>
<span class="token number">5</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="union" tabindex="-1"><a class="header-anchor" href="#union" aria-hidden="true">#</a> UNION</h4><p><strong>UNION è¯­å¥</strong>ï¼šç”¨äºå°†ä¸åŒè¡¨ä¸­ç›¸åŒåˆ—ä¸­æŸ¥è¯¢çš„æ•°æ®å±•ç¤ºå‡ºæ¥ï¼›ï¼ˆä¸åŒ…æ‹¬é‡å¤æ•°æ®ï¼‰</p><p><strong>UNION ALL è¯­å¥</strong>ï¼šç”¨äºå°†ä¸åŒè¡¨ä¸­ç›¸åŒåˆ—ä¸­æŸ¥è¯¢çš„æ•°æ®å±•ç¤ºå‡ºæ¥ï¼›ï¼ˆåŒ…æ‹¬é‡å¤æ•°æ®ï¼‰</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SELECT åˆ—åç§° FROM è¡¨åç§° UNION SELECT åˆ—åç§° FROM è¡¨åç§° ORDER BY åˆ—åç§°ï¼›
SELECT åˆ—åç§° FROM è¡¨åç§° UNION ALL SELECT åˆ—åç§° FROM è¡¨åç§° ORDER BY åˆ—åç§°ï¼›
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="çº¦æŸ" tabindex="-1"><a class="header-anchor" href="#çº¦æŸ" aria-hidden="true">#</a> çº¦æŸ</h4><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">#çº¦æŸ</span>
<span class="token comment">-- SQL çº¦æŸï¼ˆConstraintsï¼‰</span>
<span class="token comment">-- SQL çº¦æŸç”¨äºè§„å®šè¡¨ä¸­çš„æ•°æ®è§„åˆ™ã€‚</span>

<span class="token comment">-- å¦‚æœå­˜åœ¨è¿åçº¦æŸçš„æ•°æ®è¡Œä¸ºï¼Œè¡Œä¸ºä¼šè¢«çº¦æŸç»ˆæ­¢ã€‚</span>

<span class="token comment">-- çº¦æŸå¯ä»¥åœ¨åˆ›å»ºè¡¨æ—¶è§„å®šï¼ˆé€šè¿‡ CREATE TABLE è¯­å¥ï¼‰ï¼Œæˆ–è€…åœ¨è¡¨åˆ›å»ºä¹‹åè§„å®šï¼ˆé€šè¿‡ ALTER TABLE è¯­å¥ï¼‰ã€‚</span>

<span class="token keyword">SQL</span> <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token operator">+</span> <span class="token keyword">CONSTRAINT</span> è¯­æ³•
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> table_name
<span class="token punctuation">(</span>
column_name1 data_type<span class="token punctuation">(</span>size<span class="token punctuation">)</span> constraint_name<span class="token punctuation">,</span>
column_name2 data_type<span class="token punctuation">(</span>size<span class="token punctuation">)</span> constraint_name<span class="token punctuation">,</span>
column_name3 data_type<span class="token punctuation">(</span>size<span class="token punctuation">)</span> constraint_name<span class="token punctuation">,</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
åœ¨ <span class="token keyword">SQL</span> ä¸­ï¼Œæˆ‘ä»¬æœ‰å¦‚ä¸‹çº¦æŸï¼š

<span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token operator">-</span> æŒ‡ç¤ºæŸåˆ—ä¸èƒ½å­˜å‚¨ <span class="token boolean">NULL</span> å€¼ã€‚
<span class="token keyword">UNIQUE</span> <span class="token operator">-</span> ä¿è¯æŸåˆ—çš„æ¯è¡Œå¿…é¡»æœ‰å”¯ä¸€çš„å€¼ã€‚
<span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token operator">-</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> å’Œ <span class="token keyword">UNIQUE</span> çš„ç»“åˆã€‚ç¡®ä¿æŸåˆ—ï¼ˆæˆ–ä¸¤ä¸ªåˆ—å¤šä¸ªåˆ—çš„ç»“åˆï¼‰æœ‰å”¯ä¸€æ ‡è¯†ï¼Œæœ‰åŠ©äºæ›´å®¹æ˜“æ›´å¿«é€Ÿåœ°æ‰¾åˆ°è¡¨ä¸­çš„ä¸€ä¸ªç‰¹å®šçš„è®°å½•ã€‚
<span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token operator">-</span> ä¿è¯ä¸€ä¸ªè¡¨ä¸­çš„æ•°æ®åŒ¹é…å¦ä¸€ä¸ªè¡¨ä¸­çš„å€¼çš„å‚ç…§å®Œæ•´æ€§ã€‚
<span class="token keyword">CHECK</span> <span class="token operator">-</span> ä¿è¯åˆ—ä¸­çš„å€¼ç¬¦åˆæŒ‡å®šçš„æ¡ä»¶ã€‚
<span class="token keyword">DEFAULT</span> <span class="token operator">-</span> è§„å®šæ²¡æœ‰ç»™åˆ—èµ‹å€¼æ—¶çš„é»˜è®¤å€¼

<span class="token comment">-- é€šè¿‡ show create table è¡¨å å¯ä»¥æŸ¥çœ‹æ‰€æœ‰constraint -- å°¤å…¶æ˜¯å¯ä»¥æŸ¥çœ‹åˆ°å¿˜è®°å‘½åçš„constraint ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆçš„constraintå‘½å</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> <span class="token keyword">create</span> <span class="token keyword">table</span> student_test2<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span class="token operator">|</span> <span class="token keyword">Table</span>         <span class="token operator">|</span> <span class="token keyword">Create</span> <span class="token keyword">Table</span>                                                                                                                                                                                                                                                                                                                                                                                                                                               <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span class="token operator">|</span> student_test2 <span class="token operator">|</span> <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>student_test2<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">int</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">&#39;0&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>address<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span> <span class="token keyword">COLLATE</span> utf8mb3_bin <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">&#39;CHINA&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>birthday<span class="token punctuation">`</span></span> <span class="token keyword">date</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">&#39;2000-01-01&#39;</span><span class="token punctuation">,</span>
  <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>fk_id<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">CONSTRAINT</span> <span class="token identifier"><span class="token punctuation">`</span>fk_id<span class="token punctuation">`</span></span> <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> <span class="token identifier"><span class="token punctuation">`</span>student_test1<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">CONSTRAINT</span> <span class="token identifier"><span class="token punctuation">`</span>chk_birthday<span class="token punctuation">`</span></span> <span class="token keyword">CHECK</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>birthday<span class="token punctuation">`</span></span> <span class="token operator">between</span> _utf8mb3<span class="token string">&#39;1983-01-01&#39;</span> <span class="token operator">and</span> _utf8mb3<span class="token string">&#39;2002-01-01&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">CONSTRAINT</span> <span class="token identifier"><span class="token punctuation">`</span>student_test2_chk_1<span class="token punctuation">`</span></span> <span class="token keyword">CHECK</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token operator">between</span> <span class="token number">0</span> <span class="token operator">and</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb3 <span class="token keyword">COLLATE</span><span class="token operator">=</span>utf8mb3_bin <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="not-null" tabindex="-1"><a class="header-anchor" href="#not-null" aria-hidden="true">#</a> not null</h5><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">#not null</span>
<span class="token keyword">SQL</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> çº¦æŸ
<span class="token comment">#åœ¨é»˜è®¤çš„æƒ…å†µä¸‹ï¼Œè¡¨çš„åˆ—æ¥å— NULL å€¼ã€‚</span>

<span class="token keyword">SQL</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> çº¦æŸ
<span class="token operator">NOT</span> <span class="token boolean">NULL</span> çº¦æŸå¼ºåˆ¶åˆ—ä¸æ¥å— <span class="token boolean">NULL</span> å€¼ã€‚

<span class="token operator">NOT</span> <span class="token boolean">NULL</span> çº¦æŸå¼ºåˆ¶å­—æ®µå§‹ç»ˆåŒ…å«å€¼ã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœä¸å‘å­—æ®µæ·»åŠ å€¼ï¼Œå°±æ— æ³•æ’å…¥æ–°è®°å½•æˆ–è€…æ›´æ–°è®°å½•ã€‚

ä¸‹é¢çš„ <span class="token keyword">SQL</span> å¼ºåˆ¶ <span class="token string">&quot;ID&quot;</span> åˆ—ã€ <span class="token string">&quot;LastName&quot;</span> åˆ—ä»¥åŠ <span class="token string">&quot;FirstName&quot;</span> åˆ—ä¸æ¥å— <span class="token boolean">NULL</span> å€¼ï¼š

å®ä¾‹
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> Persons <span class="token punctuation">(</span>
    ID <span class="token keyword">int</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    LastName <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    FirstName <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    Age <span class="token keyword">int</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">#æ·»åŠ  NOT NULL çº¦æŸ</span>
åœ¨ä¸€ä¸ªå·²åˆ›å»ºçš„è¡¨çš„ <span class="token string">&quot;Age&quot;</span> å­—æ®µä¸­æ·»åŠ  <span class="token operator">NOT</span> <span class="token boolean">NULL</span> çº¦æŸå¦‚ä¸‹æ‰€ç¤ºï¼š

å®ä¾‹
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> Persons
<span class="token keyword">MODIFY</span> Age <span class="token keyword">int</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">describe</span> student_test1<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-------+-------------+------+-----+---------+-------+</span>
<span class="token operator">|</span> Field <span class="token operator">|</span> <span class="token keyword">Type</span>        <span class="token operator">|</span> <span class="token boolean">Null</span> <span class="token operator">|</span> <span class="token keyword">Key</span> <span class="token operator">|</span> <span class="token keyword">Default</span> <span class="token operator">|</span> Extra <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+-------------+------+-----+---------+-------+</span>
<span class="token operator">|</span> id    <span class="token operator">|</span> <span class="token keyword">int</span>         <span class="token operator">|</span> YES  <span class="token operator">|</span>     <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span>       <span class="token operator">|</span>
<span class="token operator">|</span> name  <span class="token operator">|</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token keyword">NO</span>   <span class="token operator">|</span>     <span class="token operator">|</span> å­¦ç”Ÿ    <span class="token operator">|</span>       <span class="token operator">|</span>
<span class="token operator">|</span> major <span class="token operator">|</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token keyword">NO</span>   <span class="token operator">|</span>     <span class="token operator">|</span> IT      <span class="token operator">|</span>       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+-------------+------+-----+---------+-------+</span>
<span class="token number">3</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">alter</span> <span class="token keyword">table</span> student_test1 <span class="token keyword">modify</span> id <span class="token keyword">int</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.05</span> sec<span class="token punctuation">)</span>
Records: <span class="token number">0</span>  Duplicates: <span class="token number">0</span>  <span class="token keyword">Warnings</span>: <span class="token number">0</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">describe</span> student_test1<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-------+-------------+------+-----+---------+-------+</span>
<span class="token operator">|</span> Field <span class="token operator">|</span> <span class="token keyword">Type</span>        <span class="token operator">|</span> <span class="token boolean">Null</span> <span class="token operator">|</span> <span class="token keyword">Key</span> <span class="token operator">|</span> <span class="token keyword">Default</span> <span class="token operator">|</span> Extra <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+-------------+------+-----+---------+-------+</span>
<span class="token operator">|</span> id    <span class="token operator">|</span> <span class="token keyword">int</span>         <span class="token operator">|</span> <span class="token keyword">NO</span>   <span class="token operator">|</span>     <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span>       <span class="token operator">|</span>
<span class="token operator">|</span> name  <span class="token operator">|</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token keyword">NO</span>   <span class="token operator">|</span>     <span class="token operator">|</span> å­¦ç”Ÿ    <span class="token operator">|</span>       <span class="token operator">|</span>
<span class="token operator">|</span> major <span class="token operator">|</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token keyword">NO</span>   <span class="token operator">|</span>     <span class="token operator">|</span> IT      <span class="token operator">|</span>       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+-------------+------+-----+---------+-------+</span>
<span class="token number">3</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
<span class="token comment">#åˆ é™¤ NOT NULL çº¦æŸ</span>
åœ¨ä¸€ä¸ªå·²åˆ›å»ºçš„è¡¨çš„ <span class="token string">&quot;Age&quot;</span> å­—æ®µä¸­åˆ é™¤ <span class="token operator">NOT</span> <span class="token boolean">NULL</span> çº¦æŸå¦‚ä¸‹æ‰€ç¤ºï¼š

å®ä¾‹
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> Persons
<span class="token keyword">MODIFY</span> Age <span class="token keyword">int</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">describe</span> student_test1<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-------+-------------+------+-----+---------+-------+</span>
<span class="token operator">|</span> Field <span class="token operator">|</span> <span class="token keyword">Type</span>        <span class="token operator">|</span> <span class="token boolean">Null</span> <span class="token operator">|</span> <span class="token keyword">Key</span> <span class="token operator">|</span> <span class="token keyword">Default</span> <span class="token operator">|</span> Extra <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+-------------+------+-----+---------+-------+</span>
<span class="token operator">|</span> id    <span class="token operator">|</span> <span class="token keyword">int</span>         <span class="token operator">|</span> <span class="token keyword">NO</span>   <span class="token operator">|</span>     <span class="token operator">|</span> <span class="token number">0</span>       <span class="token operator">|</span>       <span class="token operator">|</span>
<span class="token operator">|</span> name  <span class="token operator">|</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token keyword">NO</span>   <span class="token operator">|</span>     <span class="token operator">|</span> å­¦ç”Ÿ    <span class="token operator">|</span>       <span class="token operator">|</span>
<span class="token operator">|</span> major <span class="token operator">|</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token keyword">NO</span>   <span class="token operator">|</span>     <span class="token operator">|</span> IT      <span class="token operator">|</span>       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+-------------+------+-----+---------+-------+</span>
<span class="token number">3</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">alter</span> <span class="token keyword">table</span> student_test1 <span class="token keyword">modify</span> id <span class="token keyword">int</span> <span class="token boolean">null</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.06</span> sec<span class="token punctuation">)</span>
Records: <span class="token number">0</span>  Duplicates: <span class="token number">0</span>  <span class="token keyword">Warnings</span>: <span class="token number">0</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">describe</span> student_test1<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-------+-------------+------+-----+---------+-------+</span>
<span class="token operator">|</span> Field <span class="token operator">|</span> <span class="token keyword">Type</span>        <span class="token operator">|</span> <span class="token boolean">Null</span> <span class="token operator">|</span> <span class="token keyword">Key</span> <span class="token operator">|</span> <span class="token keyword">Default</span> <span class="token operator">|</span> Extra <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+-------------+------+-----+---------+-------+</span>
<span class="token operator">|</span> id    <span class="token operator">|</span> <span class="token keyword">int</span>         <span class="token operator">|</span> YES  <span class="token operator">|</span>     <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span>       <span class="token operator">|</span>
<span class="token operator">|</span> name  <span class="token operator">|</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token keyword">NO</span>   <span class="token operator">|</span>     <span class="token operator">|</span> å­¦ç”Ÿ    <span class="token operator">|</span>       <span class="token operator">|</span>
<span class="token operator">|</span> major <span class="token operator">|</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token keyword">NO</span>   <span class="token operator">|</span>     <span class="token operator">|</span> IT      <span class="token operator">|</span>       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+-------------+------+-----+---------+-------+</span>
<span class="token number">3</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="unique" tabindex="-1"><a class="header-anchor" href="#unique" aria-hidden="true">#</a> unique</h5><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">#SQL UNIQUE çº¦æŸ-- å¦‚æœæ²¡æœ‰æŒ‡å®šnot null åˆ™uniqueå­—æ®µå¯ä»¥æœ‰å¤šä¸ªnullï¼›</span>
<span class="token comment">-- å¦‚æœåˆ¶å®šäº†not null åŒæ—¶æŒ‡å®šäº†unique ç­‰åŒäºprimary key</span>
<span class="token keyword">UNIQUE</span> çº¦æŸå”¯ä¸€æ ‡è¯†æ•°æ®åº“è¡¨ä¸­çš„æ¯æ¡è®°å½•ã€‚

<span class="token keyword">UNIQUE</span> å’Œ <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> çº¦æŸå‡ä¸ºåˆ—æˆ–åˆ—é›†åˆæä¾›äº†å”¯ä¸€æ€§çš„ä¿è¯ã€‚

<span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> çº¦æŸæ‹¥æœ‰è‡ªåŠ¨å®šä¹‰çš„ <span class="token keyword">UNIQUE</span> çº¦æŸã€‚

è¯·æ³¨æ„ï¼Œæ¯ä¸ªè¡¨å¯ä»¥æœ‰å¤šä¸ª <span class="token keyword">UNIQUE</span> çº¦æŸï¼Œä½†æ˜¯æ¯ä¸ªè¡¨åªèƒ½æœ‰ä¸€ä¸ª <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> çº¦æŸã€‚

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> æ—¶çš„ <span class="token keyword">SQL</span> <span class="token keyword">UNIQUE</span> çº¦æŸ
ä¸‹é¢çš„ <span class="token keyword">SQL</span> åœ¨ <span class="token string">&quot;Persons&quot;</span> è¡¨åˆ›å»ºæ—¶åœ¨ <span class="token string">&quot;P_Id&quot;</span> åˆ—ä¸Šåˆ›å»º <span class="token keyword">UNIQUE</span> çº¦æŸï¼š

MySQLï¼š

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> Persons
<span class="token punctuation">(</span>
P_Id <span class="token keyword">int</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
LastName <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
FirstName <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
Address <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
City <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token keyword">UNIQUE</span> <span class="token punctuation">(</span>P_Id<span class="token punctuation">)</span>
<span class="token punctuation">)</span>
<span class="token comment">#ALTER TABLE æ—¶çš„ SQL UNIQUE çº¦æŸ</span>
å½“è¡¨å·²è¢«åˆ›å»ºæ—¶ï¼Œå¦‚éœ€åœ¨ <span class="token string">&quot;P_Id&quot;</span> åˆ—åˆ›å»º <span class="token keyword">UNIQUE</span> çº¦æŸï¼Œè¯·ä½¿ç”¨ä¸‹é¢çš„ <span class="token keyword">SQL</span>ï¼š

MySQL <span class="token operator">/</span> <span class="token keyword">SQL</span> Server <span class="token operator">/</span> Oracle <span class="token operator">/</span> MS Accessï¼š

<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> Persons
<span class="token keyword">ADD</span> <span class="token keyword">UNIQUE</span> <span class="token punctuation">(</span>P_Id<span class="token punctuation">)</span>
å¦‚éœ€å‘½å <span class="token keyword">UNIQUE</span> çº¦æŸï¼Œå¹¶å®šä¹‰å¤šä¸ªåˆ—çš„ <span class="token keyword">UNIQUE</span> çº¦æŸï¼Œè¯·ä½¿ç”¨ä¸‹é¢çš„ <span class="token keyword">SQL</span> è¯­æ³•ï¼š

MySQL <span class="token operator">/</span> <span class="token keyword">SQL</span> Server <span class="token operator">/</span> Oracle <span class="token operator">/</span> MS Accessï¼š

<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> Persons
<span class="token keyword">ADD</span> <span class="token keyword">CONSTRAINT</span> uc_PersonID <span class="token keyword">UNIQUE</span> <span class="token punctuation">(</span>P_Id<span class="token punctuation">,</span>LastName<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">alter</span> <span class="token keyword">table</span> student_test1 <span class="token keyword">add</span> <span class="token keyword">constraint</span> <span class="token keyword">unique</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.07</span> sec<span class="token punctuation">)</span>
Records: <span class="token number">0</span>  Duplicates: <span class="token number">0</span>  <span class="token keyword">Warnings</span>: <span class="token number">0</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">describe</span> student_test1<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-------+-------------+------+-----+---------+-------+</span>
<span class="token operator">|</span> Field <span class="token operator">|</span> <span class="token keyword">Type</span>        <span class="token operator">|</span> <span class="token boolean">Null</span> <span class="token operator">|</span> <span class="token keyword">Key</span> <span class="token operator">|</span> <span class="token keyword">Default</span> <span class="token operator">|</span> Extra <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+-------------+------+-----+---------+-------+</span>
<span class="token operator">|</span> id    <span class="token operator">|</span> <span class="token keyword">int</span>         <span class="token operator">|</span> <span class="token keyword">NO</span>   <span class="token operator">|</span> PRI <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span>       <span class="token operator">|</span>
<span class="token operator">|</span> name  <span class="token operator">|</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token keyword">NO</span>   <span class="token operator">|</span>     <span class="token operator">|</span> å­¦ç”Ÿ    <span class="token operator">|</span>       <span class="token operator">|</span>
<span class="token operator">|</span> major <span class="token operator">|</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token keyword">NO</span>   <span class="token operator">|</span>     <span class="token operator">|</span> IT      <span class="token operator">|</span>       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+-------------+------+-----+---------+-------+</span>
<span class="token number">3</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

<span class="token comment">#æ’¤é”€ UNIQUE çº¦æŸ</span>
å¦‚éœ€æ’¤é”€ <span class="token keyword">UNIQUE</span> çº¦æŸï¼Œè¯·ä½¿ç”¨ä¸‹é¢çš„ <span class="token keyword">SQL</span>ï¼š

MySQLï¼š

<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> Persons
<span class="token keyword">DROP</span> <span class="token keyword">INDEX</span> uc_PersonID
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="primary-key" tabindex="-1"><a class="header-anchor" href="#primary-key" aria-hidden="true">#</a> primary key</h5><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">#ä¸»é”®</span>
<span class="token keyword">SQL</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> çº¦æŸ
<span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> çº¦æŸå”¯ä¸€æ ‡è¯†æ•°æ®åº“è¡¨ä¸­çš„æ¯æ¡è®°å½•ã€‚

ä¸»é”®å¿…é¡»åŒ…å«å”¯ä¸€çš„å€¼ã€‚

ä¸»é”®åˆ—ä¸èƒ½åŒ…å« <span class="token boolean">NULL</span> å€¼ã€‚

æ¯ä¸ªè¡¨éƒ½åº”è¯¥æœ‰ä¸€ä¸ªä¸»é”®ï¼Œå¹¶ä¸”æ¯ä¸ªè¡¨åªèƒ½æœ‰ä¸€ä¸ªä¸»é”®

<span class="token comment">#å•åˆ—ä¸»é”®</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token keyword">table</span> sutdennt_test1 
<span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">int</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> <span class="token string">&quot;å­¦ç”Ÿ&quot;</span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>major<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> <span class="token string">&quot;IT&quot;</span><span class="token punctuation">,</span>
 <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span>
 <span class="token keyword">character</span> <span class="token keyword">set</span> utf8 <span class="token keyword">collate</span> utf8_bin<span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected<span class="token punctuation">,</span> <span class="token number">2</span> <span class="token keyword">warnings</span> <span class="token punctuation">(</span><span class="token number">0.15</span> sec<span class="token punctuation">)</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">describe</span> student_test1<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-------+-------------+------+-----+---------+-------+</span>
<span class="token operator">|</span> Field <span class="token operator">|</span> <span class="token keyword">Type</span>        <span class="token operator">|</span> <span class="token boolean">Null</span> <span class="token operator">|</span> <span class="token keyword">Key</span> <span class="token operator">|</span> <span class="token keyword">Default</span> <span class="token operator">|</span> Extra <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+-------------+------+-----+---------+-------+</span>
<span class="token operator">|</span> id    <span class="token operator">|</span> <span class="token keyword">int</span>         <span class="token operator">|</span> <span class="token keyword">NO</span>   <span class="token operator">|</span> PRI <span class="token operator">|</span> <span class="token number">0</span>       <span class="token operator">|</span>       <span class="token operator">|</span>
<span class="token operator">|</span> name  <span class="token operator">|</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token keyword">NO</span>   <span class="token operator">|</span>     <span class="token operator">|</span> å­¦ç”Ÿ    <span class="token operator">|</span>       <span class="token operator">|</span>
<span class="token operator">|</span> major <span class="token operator">|</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token keyword">NO</span>   <span class="token operator">|</span>     <span class="token operator">|</span> IT      <span class="token operator">|</span>       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+-------------+------+-----+---------+-------+</span>
<span class="token number">3</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">insert</span> <span class="token keyword">into</span> student_test1 <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">1002</span><span class="token punctuation">,</span><span class="token string">&#39;James&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;Basketball&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">1003</span><span class="token punctuation">,</span><span class="token string">&#39;Ivring&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;Basketball&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">2</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>
Records: <span class="token number">2</span>  Duplicates: <span class="token number">0</span>  <span class="token keyword">Warnings</span>: <span class="token number">0</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> student_test1<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+------------+------------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> name       <span class="token operator">|</span> major      <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+------------+------------+</span>
<span class="token operator">|</span> <span class="token number">1001</span> <span class="token operator">|</span> EddieZhang <span class="token operator">|</span> Java       <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">1002</span> <span class="token operator">|</span> James      <span class="token operator">|</span> Basketball <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">1003</span> <span class="token operator">|</span> Ivring     <span class="token operator">|</span> Basketball <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+------------+------------+</span>
<span class="token number">3</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">insert</span> <span class="token keyword">into</span> student_test1 <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">1001</span><span class="token punctuation">,</span><span class="token string">&#39;Durant&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;Basketball&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">-- ä¸»é”®çš„æ•°æ®å¿…é¡»éç©ºä¸”å”¯ä¸€</span>
ERROR <span class="token number">1062</span> <span class="token punctuation">(</span><span class="token number">23000</span><span class="token punctuation">)</span>: <span class="token keyword">Duplicate</span> entry <span class="token string">&#39;1001&#39;</span> <span class="token keyword">for</span> <span class="token keyword">key</span> <span class="token string">&#39;student_test1.PRIMARY&#39;</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">insert</span> <span class="token keyword">into</span> student_test1 <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">1004</span><span class="token punctuation">,</span><span class="token string">&#39;Durant&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;Basketball&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">row</span> affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
<span class="token comment">#ï¼ˆå¤åˆä¸»é”®ï¼‰å¤šåˆ—ä¸»é”®-- å°†å¤šä¸ªåˆ—ä½œä¸ºä¸»é”® </span>
<span class="token comment">#åªæœ‰åŒæ—¶æ»¡è¶³ä¸»é”®çš„å¤šä¸ªåˆ—éƒ½ç›¸ç­‰æ—¶æ‰ä¼šERROR 1062 (23000): Duplicate entry &#39;1001-EddieZhang&#39; for key &#39;student_test1.PRIMARY&#39;</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">alter</span> <span class="token keyword">table</span> student_test1 <span class="token keyword">add</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.05</span> sec<span class="token punctuation">)</span>
Records: <span class="token number">0</span>  Duplicates: <span class="token number">0</span>  <span class="token keyword">Warnings</span>: <span class="token number">0</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">describe</span> student_test1<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-------+-------------+------+-----+---------+-------+</span>
<span class="token operator">|</span> Field <span class="token operator">|</span> <span class="token keyword">Type</span>        <span class="token operator">|</span> <span class="token boolean">Null</span> <span class="token operator">|</span> <span class="token keyword">Key</span> <span class="token operator">|</span> <span class="token keyword">Default</span> <span class="token operator">|</span> Extra <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+-------------+------+-----+---------+-------+</span>
<span class="token operator">|</span> id    <span class="token operator">|</span> <span class="token keyword">int</span>         <span class="token operator">|</span> <span class="token keyword">NO</span>   <span class="token operator">|</span> PRI <span class="token operator">|</span> <span class="token number">0</span>       <span class="token operator">|</span>       <span class="token operator">|</span>
<span class="token operator">|</span> name  <span class="token operator">|</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token keyword">NO</span>   <span class="token operator">|</span> PRI <span class="token operator">|</span> å­¦ç”Ÿ    <span class="token operator">|</span>       <span class="token operator">|</span>
<span class="token operator">|</span> major <span class="token operator">|</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token keyword">NO</span>   <span class="token operator">|</span>     <span class="token operator">|</span> IT      <span class="token operator">|</span>       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+-------------+------+-----+---------+-------+</span>
<span class="token number">3</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">insert</span> <span class="token keyword">into</span> student_test1 <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">1001</span><span class="token punctuation">,</span><span class="token string">&#39;EddieZ&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;Java&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">row</span> affected <span class="token punctuation">(</span><span class="token number">0.14</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> student_test1<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+------------+------------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> name       <span class="token operator">|</span> major      <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+------------+------------+</span>
<span class="token operator">|</span> <span class="token number">1001</span> <span class="token operator">|</span> EddieZ     <span class="token operator">|</span> Java       <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">1001</span> <span class="token operator">|</span> EddieZhang <span class="token operator">|</span> Java       <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">1002</span> <span class="token operator">|</span> James      <span class="token operator">|</span> Basketball <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">1003</span> <span class="token operator">|</span> Ivring     <span class="token operator">|</span> Basketball <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">1004</span> <span class="token operator">|</span> Durant     <span class="token operator">|</span> Basketball <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+------------+------------+</span>
<span class="token number">5</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">insert</span> <span class="token keyword">into</span> student_test1 <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">1001</span><span class="token punctuation">,</span><span class="token string">&#39;EddieZhang&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;Java&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ERROR <span class="token number">1062</span> <span class="token punctuation">(</span><span class="token number">23000</span><span class="token punctuation">)</span>: <span class="token keyword">Duplicate</span> entry <span class="token string">&#39;1001-EddieZhang&#39;</span> <span class="token keyword">for</span> <span class="token keyword">key</span> <span class="token string">&#39;student_test1.PRIMARY&#39;</span>
mysql<span class="token operator">&gt;</span>
<span class="token comment">#alter table addä¸»é”®</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">alter</span> <span class="token keyword">table</span> student_test1 <span class="token keyword">add</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.05</span> sec<span class="token punctuation">)</span>
Records: <span class="token number">0</span>  Duplicates: <span class="token number">0</span>  <span class="token keyword">Warnings</span>: <span class="token number">0</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">describe</span> student_test1<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-------+-------------+------+-----+---------+-------+</span>
<span class="token operator">|</span> Field <span class="token operator">|</span> <span class="token keyword">Type</span>        <span class="token operator">|</span> <span class="token boolean">Null</span> <span class="token operator">|</span> <span class="token keyword">Key</span> <span class="token operator">|</span> <span class="token keyword">Default</span> <span class="token operator">|</span> Extra <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+-------------+------+-----+---------+-------+</span>
<span class="token operator">|</span> id    <span class="token operator">|</span> <span class="token keyword">int</span>         <span class="token operator">|</span> <span class="token keyword">NO</span>   <span class="token operator">|</span> PRI <span class="token operator">|</span> <span class="token number">0</span>       <span class="token operator">|</span>       <span class="token operator">|</span>
<span class="token operator">|</span> name  <span class="token operator">|</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token keyword">NO</span>   <span class="token operator">|</span> PRI <span class="token operator">|</span> å­¦ç”Ÿ    <span class="token operator">|</span>       <span class="token operator">|</span>
<span class="token operator">|</span> major <span class="token operator">|</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token keyword">NO</span>   <span class="token operator">|</span>     <span class="token operator">|</span> IT      <span class="token operator">|</span>       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+-------------+------+-----+---------+-------+</span>
<span class="token number">3</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
<span class="token comment">#drop åˆ é™¤ä¸»é”®</span>
åˆ é™¤<span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span>çº¦æŸæ—¶ï¼Œä¸è®ºçº¦æŸæ¡ä»¶ä¸ºä¸€åˆ—è¿˜æ˜¯å¤šåˆ—ï¼Œå¯¹äºMySQLï¼Œæ’¤é”€éƒ½æ˜¯

<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> Persons
<span class="token keyword">DROP</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span>
ç”±äº<span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span>å”¯ä¸€æ€§ï¼ŒMYSQLå¤„ç†åŠæ³•ç®€å•
mysql<span class="token operator">&gt;</span> <span class="token keyword">insert</span> <span class="token keyword">into</span> student_test1 <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">1001</span><span class="token punctuation">,</span><span class="token string">&#39;EddieZhang&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;Java&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ERROR <span class="token number">1062</span> <span class="token punctuation">(</span><span class="token number">23000</span><span class="token punctuation">)</span>: <span class="token keyword">Duplicate</span> entry <span class="token string">&#39;1001-EddieZhang&#39;</span> <span class="token keyword">for</span> <span class="token keyword">key</span> <span class="token string">&#39;student_test1.PRIMARY&#39;</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">describe</span> student_test1<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-------+-------------+------+-----+---------+-------+</span>
<span class="token operator">|</span> Field <span class="token operator">|</span> <span class="token keyword">Type</span>        <span class="token operator">|</span> <span class="token boolean">Null</span> <span class="token operator">|</span> <span class="token keyword">Key</span> <span class="token operator">|</span> <span class="token keyword">Default</span> <span class="token operator">|</span> Extra <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+-------------+------+-----+---------+-------+</span>
<span class="token operator">|</span> id    <span class="token operator">|</span> <span class="token keyword">int</span>         <span class="token operator">|</span> <span class="token keyword">NO</span>   <span class="token operator">|</span> PRI <span class="token operator">|</span> <span class="token number">0</span>       <span class="token operator">|</span>       <span class="token operator">|</span>
<span class="token operator">|</span> name  <span class="token operator">|</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token keyword">NO</span>   <span class="token operator">|</span> PRI <span class="token operator">|</span> å­¦ç”Ÿ    <span class="token operator">|</span>       <span class="token operator">|</span>
<span class="token operator">|</span> major <span class="token operator">|</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token keyword">NO</span>   <span class="token operator">|</span>     <span class="token operator">|</span> IT      <span class="token operator">|</span>       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+-------------+------+-----+---------+-------+</span>
<span class="token number">3</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">alter</span> <span class="token keyword">table</span> student_test1 <span class="token keyword">drop</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">5</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.02</span> sec<span class="token punctuation">)</span>
Records: <span class="token number">5</span>  Duplicates: <span class="token number">0</span>  <span class="token keyword">Warnings</span>: <span class="token number">0</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">describe</span> student_test1<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-------+-------------+------+-----+---------+-------+</span>
<span class="token operator">|</span> Field <span class="token operator">|</span> <span class="token keyword">Type</span>        <span class="token operator">|</span> <span class="token boolean">Null</span> <span class="token operator">|</span> <span class="token keyword">Key</span> <span class="token operator">|</span> <span class="token keyword">Default</span> <span class="token operator">|</span> Extra <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+-------------+------+-----+---------+-------+</span>
<span class="token operator">|</span> id    <span class="token operator">|</span> <span class="token keyword">int</span>         <span class="token operator">|</span> <span class="token keyword">NO</span>   <span class="token operator">|</span>     <span class="token operator">|</span> <span class="token number">0</span>       <span class="token operator">|</span>       <span class="token operator">|</span>
<span class="token operator">|</span> name  <span class="token operator">|</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token keyword">NO</span>   <span class="token operator">|</span>     <span class="token operator">|</span> å­¦ç”Ÿ    <span class="token operator">|</span>       <span class="token operator">|</span>
<span class="token operator">|</span> major <span class="token operator">|</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token keyword">NO</span>   <span class="token operator">|</span>     <span class="token operator">|</span> IT      <span class="token operator">|</span>       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+-------------+------+-----+---------+-------+</span>
<span class="token number">3</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="foreign-key" tabindex="-1"><a class="header-anchor" href="#foreign-key" aria-hidden="true">#</a> foreign key</h5><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">#SQL FOREIGN KEY çº¦æŸ-- ç”¨äºå®šä¹‰ä¸»è¡¨å’Œä»è¡¨ä¹‹é—´çš„å…³ç³»</span>
<span class="token comment">-- å¤–é”®çº¦æŸè¦å®šä¹‰åœ¨ä»è¡¨ä¸Šï¼Œä¸»è¡¨åˆ™å¿…é¡»å…·æœ‰ä¸»é”®çº¦æŸæˆ–è€…uniqueçº¦æŸã€‚</span>
<span class="token comment">-- å½“å®šä¹‰å¤–é”®åï¼Œè¦æ±‚å¤–é”®åˆ—æ•°æ®å¿…é¡»åœ¨åœ¨ä¸»è¡¨çš„ä¸»é”®åˆ—å­˜åœ¨æˆ–è€…ä¸ºnull;</span>
<span class="token comment">-- FOREIGN KEY çº¦æŸç”¨äºé¢„é˜²ç ´åè¡¨ä¹‹é—´è¿æ¥çš„è¡Œä¸ºã€‚</span>
<span class="token comment">-- FOREIGN KEY çº¦æŸä¹Ÿèƒ½é˜²æ­¢éæ³•æ•°æ®æ’å…¥å¤–é”®åˆ—ï¼Œå› ä¸ºå®ƒå¿…é¡»æ˜¯å®ƒæŒ‡å‘çš„é‚£ä¸ªè¡¨ä¸­çš„å€¼ä¹‹ä¸€</span>
<span class="token comment">-- è¡¨çš„engineå¿…é¡»æ˜¯innodb è¿™æ ·çš„è¡¨æ‰æ”¯æŒå¤–é”®;</span>
<span class="token comment">-- å¤–é”®å­—æ®µç±»å‹è¦ä¸ä¸»é”®å­—æ®µç±»å‹ä¸€è‡´ï¼ˆé•¿åº¦å¯ä»¥ä¸åŒï¼‰</span>
ä¸€ä¸ªè¡¨ä¸­çš„ <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> æŒ‡å‘å¦ä¸€ä¸ªè¡¨ä¸­çš„ <span class="token keyword">UNIQUE</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>å”¯ä¸€çº¦æŸçš„é”®<span class="token punctuation">)</span>
<span class="token comment">-- åœ¨åˆ›å»ºå¤–é”®çº¦æŸæ—¶ï¼Œå¿…é¡»å…ˆåˆ›å»ºå¤–é”®çº¦æŸæ‰€ä¾èµ–çš„è¡¨ï¼ˆå…ˆåˆ›å»ºä¸»è¡¨ï¼‰ï¼Œå¹¶ä¸”è¯¥åˆ—ä¸ºè¯¥è¡¨çš„ä¸»é”®</span>
<span class="token comment">-- å­è¡¨ï¼šè°åˆ›å»ºå¤–é”®è°å°±æ˜¯å­è¡¨ çˆ¶è¡¨ï¼šè¿™ä¸ªå¤–é”®æ‰€ä¾èµ–çš„è¡¨</span>
ä¸€ã€åˆ é™¤æ—¶ï¼ŒæœªæŒ‡å®š<span class="token keyword">cascade</span>æ—¶

  <span class="token number">1</span>ï¼‰åˆ é™¤çˆ¶è¡¨<span class="token operator">/</span>æ•°æ®

      a<span class="token punctuation">.</span>å› ä¸ºå­è¡¨ä¸çˆ¶è¡¨ä¸€ä¸€å¯¹åº”ï¼Œåˆ é™¤çˆ¶è¡¨æ•°æ®æ—¶ï¼Œéœ€è¦å…ˆæŠŠå­è¡¨å¯¹åº”æ•°æ®åˆ é™¤å¦åˆ™æ— æ³•åˆ é™¤

     b<span class="token punctuation">.</span> åŒç†ï¼Œåˆ é™¤è¡¨çš„æ—¶å€™ï¼Œä¹Ÿéœ€è¦å…ˆåˆ é™¤å­è¡¨å†åˆ é™¤çˆ¶è¡¨

è§£å†³æ–¹æ¡ˆï¼š

     a<span class="token punctuation">.</span>æŒ‡å®š<span class="token keyword">cascade</span>ï¼Œåˆ é™¤çˆ¶è¡¨ã€æ•°æ®

        <span class="token keyword">CASCADE</span>æŒ‡å½“åˆ é™¤ä¸»è¡¨ä¸­è¢«å¼•ç”¨åˆ—çš„æ•°æ®æ—¶ï¼Œçº§è”åˆ é™¤å­è¡¨ä¸­ç›¸åº”çš„æ•°æ®è¡Œã€‚

     b<span class="token punctuation">.</span>ç¦ç”¨çº¦æŸï¼ˆå­è¡¨çš„å¤–é”®çº¦æŸï¼‰

         <span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> è¡¨å <span class="token keyword">disable</span> <span class="token keyword">constraint</span> çº¦æŸå<span class="token punctuation">;</span>

 <span class="token number">2</span>ï¼‰åˆ é™¤å­è¡¨ï¼šå¯ä»¥åˆ é™¤å­è¡¨æˆ–è€…æ•°æ®ä¸æŠ¥é”™

äºŒã€æ›´æ–°æ—¶

        a<span class="token punctuation">.</span>æ›´æ–°çˆ¶è¡¨ä¼šè¿åçº¦æŸ

        b<span class="token punctuation">.</span>å¯ä»¥æ›´æ–°å­è¡¨

        c<span class="token punctuation">.</span>æ²¡æœ‰é’ˆå¯¹çº¦æŸçš„çº§è”æ›´æ–°

ä¸‰ã€æ’å…¥æ—¶

         a<span class="token punctuation">.</span>çˆ¶è¡¨å¯ä»¥æ’å…¥

         b<span class="token punctuation">.</span>å­è¡¨æ’å…¥ä¼šè¿åçº¦æŸ
         
<span class="token comment">#åœ¨åˆ›å»ºè¡¨çš„æ—¶å€™æŒ‡å®šå¤–é”®çº¦æŸ</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> è¡¨å
    <span class="token punctuation">(</span>
        column1 datatype <span class="token boolean">null</span><span class="token operator">/</span><span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
        column2 datatype <span class="token boolean">null</span><span class="token operator">/</span><span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token keyword">CONSTRAINT</span> å¤–é”®çº¦æŸå <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span>  <span class="token punctuation">(</span>column1<span class="token punctuation">,</span>column2<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> column_n<span class="token punctuation">)</span> 
        <span class="token keyword">REFERENCES</span> å¤–é”®ä¾èµ–çš„è¡¨ <span class="token punctuation">(</span>column1<span class="token punctuation">,</span>column2<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>column_n<span class="token punctuation">)</span>
        <span class="token keyword">ON</span> <span class="token keyword">DELETE</span> <span class="token keyword">CASCADE</span><span class="token comment">--çº§è”åˆ é™¤</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    mysql<span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token keyword">table</span> student_test2 <span class="token punctuation">(</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">int</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token identifier"><span class="token punctuation">`</span>address<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> <span class="token string">&#39;CHINA&#39;</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token identifier"><span class="token punctuation">`</span>birthday<span class="token punctuation">`</span></span> <span class="token keyword">date</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> <span class="token string">&#39;2000-01-01&#39;</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">constraint</span> fk_id <span class="token keyword">foreign</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token keyword">references</span> student_test1 <span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">character</span> <span class="token keyword">set</span> utf8 <span class="token keyword">collate</span> utf8_bin<span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected<span class="token punctuation">,</span> <span class="token number">2</span> <span class="token keyword">warnings</span> <span class="token punctuation">(</span><span class="token number">0.03</span> sec<span class="token punctuation">)</span>

<span class="token comment">#åœ¨åˆ›å»ºè¡¨åå¢åŠ å¤–é”®çº¦æŸ</span>

<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> è¡¨å
    <span class="token keyword">ADD</span> <span class="token keyword">CONSTRAINT</span> å¤–é”®çº¦æŸå
    <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>column1<span class="token punctuation">,</span> column2<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>column_n<span class="token punctuation">)</span> 
    <span class="token keyword">REFERENCES</span> å¤–é”®æ‰€ä¾èµ–çš„è¡¨ <span class="token punctuation">(</span>column1<span class="token punctuation">,</span>column2<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>column_n<span class="token punctuation">)</span>
    <span class="token keyword">ON</span> <span class="token keyword">DELETE</span> <span class="token keyword">CASCADE</span><span class="token punctuation">;</span><span class="token comment">--çº§è”åˆ é™¤</span>
    
    mysql<span class="token operator">&gt;</span> <span class="token keyword">alter</span> <span class="token keyword">table</span> student_test2 <span class="token keyword">add</span> <span class="token keyword">constraint</span> fk_id <span class="token keyword">foreign</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token keyword">references</span> student_test1 <span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">4</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.15</span> sec<span class="token punctuation">)</span>
Records: <span class="token number">4</span>  Duplicates: <span class="token number">0</span>  <span class="token keyword">Warnings</span>: <span class="token number">0</span>
    
<span class="token comment">#æ’¤é”€ FOREIGN KEY çº¦æŸ</span>
å¦‚éœ€æ’¤é”€ <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> çº¦æŸï¼Œè¯·ä½¿ç”¨ä¸‹é¢çš„ <span class="token keyword">SQL</span>ï¼š

MySQLï¼š

<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> Orders
<span class="token keyword">DROP</span> <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> fk_PerOrders

mysql<span class="token operator">&gt;</span> <span class="token keyword">alter</span> <span class="token keyword">table</span> student_test2 <span class="token keyword">drop</span> <span class="token keyword">constraint</span> fk_id<span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="check" tabindex="-1"><a class="header-anchor" href="#check" aria-hidden="true">#</a> check</h5><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">#check</span>
<span class="token keyword">SQL</span> <span class="token keyword">CHECK</span> çº¦æŸ
<span class="token keyword">CHECK</span> çº¦æŸç”¨äºé™åˆ¶åˆ—ä¸­çš„å€¼çš„èŒƒå›´ã€‚

å¦‚æœå¯¹å•ä¸ªåˆ—å®šä¹‰ <span class="token keyword">CHECK</span> çº¦æŸï¼Œé‚£ä¹ˆè¯¥åˆ—åªå…è®¸ç‰¹å®šçš„å€¼ã€‚

å¦‚æœå¯¹ä¸€ä¸ªè¡¨å®šä¹‰ <span class="token keyword">CHECK</span> çº¦æŸï¼Œé‚£ä¹ˆæ­¤çº¦æŸä¼šåŸºäºè¡Œä¸­å…¶ä»–åˆ—çš„å€¼åœ¨ç‰¹å®šçš„åˆ—ä¸­å¯¹å€¼è¿›è¡Œé™åˆ¶

<span class="token comment">#CREATE TABLE æ—¶çš„ SQL CHECK çº¦æŸ</span>
MySQLï¼š

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> Persons
<span class="token punctuation">(</span>
P_Id <span class="token keyword">int</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
LastName <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
FirstName <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
Address <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
City <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token keyword">CHECK</span> <span class="token punctuation">(</span>P_Id<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token keyword">table</span> student_test3 <span class="token punctuation">(</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">int</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token identifier"><span class="token punctuation">`</span>address<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> <span class="token string">&#39;CHINA&#39;</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token identifier"><span class="token punctuation">`</span>birthday<span class="token punctuation">`</span></span> <span class="token keyword">date</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> <span class="token string">&#39;2000-01-01&#39;</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">constraint</span> fk_student_test3_id <span class="token keyword">foreign</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token keyword">references</span> student_test1 <span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">constraint</span> chk_id <span class="token keyword">check</span> <span class="token punctuation">(</span>id <span class="token operator">between</span> <span class="token number">0</span> <span class="token operator">and</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">character</span> <span class="token keyword">set</span> utf8 <span class="token keyword">collate</span> utf8_bin <span class="token keyword">engine</span> <span class="token keyword">innodb</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected<span class="token punctuation">,</span> <span class="token number">2</span> <span class="token keyword">warnings</span> <span class="token punctuation">(</span><span class="token number">0.02</span> sec<span class="token punctuation">)</span>

<span class="token comment">#ALTER TABLE æ—¶çš„ SQL CHECK çº¦æŸ</span>
MySQL <span class="token operator">/</span> <span class="token keyword">SQL</span> Server <span class="token operator">/</span> Oracle <span class="token operator">/</span> MS Access:

<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> Persons
<span class="token keyword">ADD</span> <span class="token keyword">CHECK</span> <span class="token punctuation">(</span>P_Id<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">alter</span> <span class="token keyword">table</span> student_test3
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">add</span> <span class="token keyword">constraint</span> chk_birth <span class="token keyword">check</span> <span class="token punctuation">(</span>birthday <span class="token operator">between</span> <span class="token string">&#39;1985-01-01&#39;</span> <span class="token operator">and</span> <span class="token string">&#39;2002-01-01&#39;</span><span class="token punctuation">)</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.04</span> sec<span class="token punctuation">)</span>

<span class="token comment">#å¦‚éœ€å‘½å CHECK çº¦æŸï¼Œå¹¶å®šä¹‰å¤šä¸ªåˆ—çš„ CHECK çº¦æŸï¼Œè¯·ä½¿ç”¨ä¸‹é¢çš„ SQL è¯­æ³•</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> Persons
<span class="token punctuation">(</span>
P_Id <span class="token keyword">int</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
LastName <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
FirstName <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
Address <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
City <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token keyword">CONSTRAINT</span> chk_Person <span class="token keyword">CHECK</span> <span class="token punctuation">(</span>P_Id<span class="token operator">&gt;</span><span class="token number">0</span> <span class="token operator">AND</span> City<span class="token operator">=</span><span class="token string">&#39;Sandnes&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">alter</span> <span class="token keyword">table</span> student_test3 <span class="token keyword">add</span> <span class="token keyword">constraint</span> chk_student_test3 <span class="token keyword">check</span> <span class="token punctuation">(</span>id <span class="token operator">between</span> <span class="token number">0</span> <span class="token operator">and</span> <span class="token number">100</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token operator">and</span> birthday <span class="token operator">between</span> <span class="token string">&#39;1985-01-01&#39;</span> <span class="token operator">and</span> <span class="token string">&#39;2002-01-01&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.04</span> sec<span class="token punctuation">)</span>
Records: <span class="token number">0</span>  Duplicates: <span class="token number">0</span>  <span class="token keyword">Warnings</span>: <span class="token number">0</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> <span class="token keyword">create</span> <span class="token keyword">table</span> student_test3<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span class="token operator">|</span> <span class="token keyword">Table</span>         <span class="token operator">|</span> <span class="token keyword">Create</span> <span class="token keyword">Table</span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span class="token operator">|</span> student_test3 <span class="token operator">|</span> <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>student_test3<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">int</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">&#39;0&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>address<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span> <span class="token keyword">COLLATE</span> utf8mb3_bin <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">&#39;CHINA&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>birthday<span class="token punctuation">`</span></span> <span class="token keyword">date</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">&#39;2000-01-01&#39;</span><span class="token punctuation">,</span>
  <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>fk_student_test3_id<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">CONSTRAINT</span> <span class="token identifier"><span class="token punctuation">`</span>fk_student_test3_id<span class="token punctuation">`</span></span> <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> <span class="token identifier"><span class="token punctuation">`</span>student_test1<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">CONSTRAINT</span> <span class="token identifier"><span class="token punctuation">`</span>chk_student_test3<span class="token punctuation">`</span></span> <span class="token keyword">CHECK</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token operator">between</span> <span class="token number">0</span> <span class="token operator">and</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">and</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>birthday<span class="token punctuation">`</span></span> <span class="token operator">between</span> _utf8mb3<span class="token string">&#39;1985-01-01&#39;</span> <span class="token operator">and</span> _utf8mb3<span class="token string">&#39;2002-01-01&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb3 <span class="token keyword">COLLATE</span><span class="token operator">=</span>utf8mb3_bin <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
<span class="token comment">#æ’¤é”€ CHECK çº¦æŸ</span>
<span class="token keyword">SQL</span> Server <span class="token operator">/</span> Oracle <span class="token operator">/</span> MS Accessï¼š

<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> Persons
<span class="token keyword">DROP</span> <span class="token keyword">CONSTRAINT</span> chk_Person

mysql<span class="token operator">&gt;</span> <span class="token keyword">alter</span> <span class="token keyword">table</span> student_test3
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">add</span> <span class="token keyword">constraint</span> chk_birth <span class="token keyword">check</span> <span class="token punctuation">(</span>birthday <span class="token operator">between</span> <span class="token string">&#39;1985-01-01&#39;</span> <span class="token operator">and</span> <span class="token string">&#39;2002-01-01&#39;</span><span class="token punctuation">)</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.04</span> sec<span class="token punctuation">)</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20220904211021997.png" alt="image-20220904211021997"></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">#ä¾‹é¢˜è®­ç»ƒ</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> goods <span class="token punctuation">(</span>
goods_id <span class="token keyword">int</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> <span class="token number">0</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">key</span><span class="token punctuation">,</span>
goods_name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span>
unitprice <span class="token keyword">double</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> <span class="token number">0</span><span class="token punctuation">,</span>
category <span class="token keyword">int</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> <span class="token number">0</span><span class="token punctuation">,</span>
provider <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">35</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">character</span> <span class="token keyword">set</span> utf8 <span class="token keyword">collate</span> utf8_bin <span class="token keyword">engine</span> <span class="token keyword">innodb</span><span class="token punctuation">;</span>
<span class="token keyword">alter</span> <span class="token keyword">table</span> goods <span class="token keyword">modify</span> unitprice <span class="token keyword">int</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> <span class="token number">0</span> <span class="token keyword">constraint</span> chk_price <span class="token keyword">check</span> <span class="token punctuation">(</span>unitprice <span class="token operator">&gt;=</span> <span class="token number">1.0</span> <span class="token operator">and</span> unitprice <span class="token operator">&lt;=</span> <span class="token number">9999.99</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">create</span> <span class="token keyword">table</span> customer <span class="token punctuation">(</span>
customer_id <span class="token keyword">int</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> <span class="token number">0</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span>
<span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span>
<span class="token identifier"><span class="token punctuation">`</span>address<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">55</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span>
<span class="token identifier"><span class="token punctuation">`</span>email<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">55</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> <span class="token string">&#39;&#39;</span> <span class="token keyword">unique</span><span class="token punctuation">,</span>
<span class="token identifier"><span class="token punctuation">`</span>sex<span class="token punctuation">`</span></span> <span class="token keyword">enum</span> <span class="token punctuation">(</span><span class="token string">&#39;ç”·&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;å¥³&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
card_id <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">35</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">character</span> <span class="token keyword">set</span> utf8 <span class="token keyword">collate</span> utf8_bin<span class="token punctuation">;</span>

<span class="token keyword">create</span> <span class="token keyword">table</span> purchase <span class="token punctuation">(</span>
order_id <span class="token keyword">int</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> <span class="token number">0</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span>
customer_id <span class="token keyword">int</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> <span class="token number">0</span><span class="token punctuation">,</span>
goods_id <span class="token keyword">int</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> <span class="token number">0</span><span class="token punctuation">,</span>
<span class="token keyword">constraint</span> fk_customer <span class="token keyword">foreign</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>customer_id<span class="token punctuation">)</span> <span class="token keyword">references</span> customer <span class="token punctuation">(</span>customer_id<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token keyword">constraint</span> fk_goods <span class="token keyword">foreign</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>goods_id<span class="token punctuation">)</span> <span class="token keyword">references</span> goods <span class="token punctuation">(</span>goods_id<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token keyword">character</span> <span class="token keyword">set</span> utf8 <span class="token keyword">collate</span> utf8_bin <span class="token keyword">engine</span> <span class="token keyword">innodb</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="auto-increment" tabindex="-1"><a class="header-anchor" href="#auto-increment" aria-hidden="true">#</a> auto_increment</h5><p><strong>æ¸…ç©ºæ•°æ®è¡¨å¹¶ä¸”è‡ªå¢ä»å¤´å¼€å§‹çš„sqlå‘½ä»¤</strong></p><p><strong>truncate</strong> table table_name; <em>//table_name è¯¥æ•°æ®è¡¨åç§°</em></p><p>åˆ é™¤å®Œè¿˜æ²¡æœ‰æ–°å¢æ•°æ®ï¼Œå³è¿˜æ²¡æœ‰å‡ºç°ä¸è¿è´¯çš„æ•°æ®IDæ—¶ï¼Œæ‰§è¡Œä»¥ä¸‹è¯­å¥ï¼š</p><p>ALTER TABLE è¡¨å AUTO_INCREMENT = 1; 1 <strong>å¦‚æœå·²çŸ¥ä¸‹ä¸€æ¡æ•°æ®è‡ªå¢çš„IDï¼ˆå‡è®¾æ˜¯10ï¼‰ï¼Œå¯ä»¥ç›´æ¥å†™æˆALTER TABLE è¡¨å AUTO_INCREMENT = 10;è¿™æ ·å†æ’å…¥æ•°æ®æ—¶ï¼Œè‡ªå¢IDä¼šä»10å¼€å§‹</strong>ï¼Œä¹Ÿå¯ä»¥ç”¨è¿™ä¸ªè¯­æ³•æ¥è·³è¿‡ä¸€äº›ç¼–å·ã€‚æ­¤å¤–ï¼Œå¦‚æœAUTO_INCREMENT çš„å€¼å°äºIDçš„æœ€å¤§å€¼ï¼Œé‚£ä¹ˆIDæ˜¯ä»MAX(ID)+1å¼€å§‹è‡ªå¢ï¼Œæ‰€ä»¥å½“AUTO_INCREMENT = 1æ—¶ï¼Œä¸€èˆ¬é»˜è®¤IDæ˜¯ä»æœ€å¤§å€¼åŠ ä¸€å¼€å§‹è‡ªå¢çš„ã€‚</p><p>è¡¨ä¸­å·²ç»å‡ºç°ä¸è¿è´¯çš„æ•°æ®IDæ—¶ï¼Œæ‰§è¡Œä»¥ä¸‹è¯­å¥è¿›è¡Œä¿®æ”¹</p><p>SET @auto_id = 0; UPDATE è¡¨å SET è‡ªå¢å­—æ®µå = (@auto_id := @auto_id + 1); ALTER TABLE è¡¨å AUTO_INCREMENT = 1;</p><p>å¦‚æœéœ€è¦æ¸…ç©ºè¡¨çš„æ•°æ®çš„è¯ï¼Œæœ€å¥½ä½¿ç”¨TRUNCATE TABLE è¡¨åæ¥åˆ é™¤ï¼Œè¿™æ ·æ–°å¢çš„æ•°æ®è‡ªå¢IDä¼šä»1å¼€å§‹ï¼Œå¦‚æœä½¿ç”¨DELETEæ¥åˆ é™¤ï¼Œæ–°å¢çš„æ•°æ®ä¼šæ²¿ç€ä¹‹å‰çš„ID</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">#è‡ªå¢é•¿ auto increment</span>
<span class="token comment">#AUTO INCREMENT å­—æ®µ</span>
æˆ‘ä»¬é€šå¸¸å¸Œæœ›åœ¨æ¯æ¬¡æ’å…¥æ–°è®°å½•æ—¶ï¼Œè‡ªåŠ¨åœ°åˆ›å»ºä¸»é”®å­—æ®µçš„å€¼ã€‚

æˆ‘ä»¬å¯ä»¥åœ¨è¡¨ä¸­åˆ›å»ºä¸€ä¸ª auto<span class="token operator">-</span>increment å­—æ®µã€‚

ç”¨äº MySQL çš„è¯­æ³•
ä¸‹é¢çš„ <span class="token keyword">SQL</span> è¯­å¥æŠŠ <span class="token string">&quot;Persons&quot;</span> è¡¨ä¸­çš„ <span class="token string">&quot;ID&quot;</span> åˆ—å®šä¹‰ä¸º auto<span class="token operator">-</span>increment ä¸»é”®å­—æ®µï¼š

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> Persons
<span class="token punctuation">(</span>
ID <span class="token keyword">int</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
LastName <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
FirstName <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
Address <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
City <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>ID<span class="token punctuation">)</span>
<span class="token punctuation">)</span>
MySQL ä½¿ç”¨ <span class="token keyword">AUTO_INCREMENT</span> å…³é”®å­—æ¥æ‰§è¡Œ auto<span class="token operator">-</span>increment ä»»åŠ¡ã€‚

é»˜è®¤åœ°ï¼Œ<span class="token keyword">AUTO_INCREMENT</span> çš„å¼€å§‹å€¼æ˜¯ <span class="token number">1</span>ï¼Œæ¯æ¡æ–°è®°å½•é€’å¢ <span class="token number">1</span>ã€‚

è¦è®© <span class="token keyword">AUTO_INCREMENT</span> åºåˆ—ä»¥å…¶ä»–çš„å€¼èµ·å§‹ï¼Œè¯·ä½¿ç”¨ä¸‹é¢çš„ <span class="token keyword">SQL</span> è¯­æ³•ï¼š

<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> Persons <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">100</span>
è¦åœ¨ <span class="token string">&quot;Persons&quot;</span> è¡¨ä¸­æ’å…¥æ–°è®°å½•ï¼Œæˆ‘ä»¬ä¸å¿…ä¸º <span class="token string">&quot;ID&quot;</span> åˆ—è§„å®šå€¼ï¼ˆä¼šè‡ªåŠ¨æ·»åŠ ä¸€ä¸ªå”¯ä¸€çš„å€¼ï¼‰ï¼š

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> Persons <span class="token punctuation">(</span>FirstName<span class="token punctuation">,</span>LastName<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">&#39;Lars&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;Monsen&#39;</span><span class="token punctuation">)</span>
ä¸Šé¢çš„ <span class="token keyword">SQL</span> è¯­å¥ä¼šåœ¨ <span class="token string">&quot;Persons&quot;</span> è¡¨ä¸­æ’å…¥ä¸€æ¡æ–°è®°å½•ã€‚<span class="token string">&quot;ID&quot;</span> åˆ—ä¼šè¢«èµ‹äºˆä¸€ä¸ªå”¯ä¸€çš„å€¼ã€‚<span class="token string">&quot;FirstName&quot;</span> åˆ—ä¼šè¢«è®¾ç½®ä¸º <span class="token string">&quot;Lars&quot;</span>ï¼Œ<span class="token string">&quot;LastName&quot;</span> åˆ—ä¼šè¢«è®¾ç½®ä¸º <span class="token string">&quot;Monsen&quot;</span>

<span class="token comment">#ç»™å·²ç»å­˜åœ¨çš„columeæ·»åŠ è‡ªå¢è¯­æ³•ï¼š</span>

<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> table_name CHANGE column_name column_name data_type<span class="token punctuation">(</span>size<span class="token punctuation">)</span> constraint_name <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">;</span>
æ¯”å¦‚ï¼š

<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> student CHANGE id id <span class="token keyword">INT</span><span class="token punctuation">(</span> <span class="token number">11</span> <span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">;</span>

<span class="token comment">#åœ¨æ·»åŠ æ•°æ®æ—¶ç»™è‡ªå¢é•¿å­—æ®µåˆ—æŒ‡å®šå€¼ï¼›åˆ™ä»¥æŒ‡å®šçš„å€¼ä¸ºå‡†ä¸”åç»­çš„å€¼æŒ‰ç…§æŒ‡å®šå€¼å¼€å§‹è‡ªå¢é•¿</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> student_test4<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-----+-----------+</span>
<span class="token operator">|</span> id  <span class="token operator">|</span> name      <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----+-----------+</span>
<span class="token operator">|</span> <span class="token number">100</span> <span class="token operator">|</span> å¼ é”¦è±ª    <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">101</span> <span class="token operator">|</span> æ¬§æ–‡      <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">102</span> <span class="token operator">|</span> è©¹å§†æ–¯    <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">103</span> <span class="token operator">|</span> æœå…°ç‰¹    <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">104</span> <span class="token operator">|</span> åº“é‡Œ      <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----+-----------+</span>
<span class="token number">5</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">insert</span> <span class="token keyword">into</span> student_test4 <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">660</span><span class="token punctuation">,</span><span class="token string">&#39;ä¸œä¸ƒä¸ƒ&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">row</span> affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">insert</span> <span class="token keyword">into</span> student_test4 <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">&#39;å¡”å›¾å§†&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">row</span> affected <span class="token punctuation">(</span><span class="token number">0.12</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> student_test4<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-----+-----------+</span>
<span class="token operator">|</span> id  <span class="token operator">|</span> name      <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----+-----------+</span>
<span class="token operator">|</span> <span class="token number">100</span> <span class="token operator">|</span> å¼ é”¦è±ª    <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">101</span> <span class="token operator">|</span> æ¬§æ–‡      <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">102</span> <span class="token operator">|</span> è©¹å§†æ–¯    <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">103</span> <span class="token operator">|</span> æœå…°ç‰¹    <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">104</span> <span class="token operator">|</span> åº“é‡Œ      <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">660</span> <span class="token operator">|</span> ä¸œä¸ƒä¸ƒ    <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">661</span> <span class="token operator">|</span> å¡”å›¾å§†    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----+-----------+</span>
<span class="token number">7</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ç´¢å¼•â˜…" tabindex="-1"><a class="header-anchor" href="#ç´¢å¼•â˜…" aria-hidden="true">#</a> ç´¢å¼•â˜…</h4><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>MySQLç´¢å¼•çš„å»ºç«‹å¯¹äºMySQLçš„é«˜æ•ˆè¿è¡Œæ˜¯å¾ˆé‡è¦çš„ï¼Œç´¢å¼•å¯ä»¥å¤§å¤§æé«˜MySQLçš„æ£€ç´¢é€Ÿåº¦ã€‚åªå¯¹åˆ›å»ºäº†ç´¢å¼•çš„åˆ—æœ‰æ•ˆ

æ‰“ä¸ªæ¯”æ–¹ï¼Œå¦‚æœåˆç†çš„è®¾è®¡ä¸”ä½¿ç”¨ç´¢å¼•çš„MySQLæ˜¯ä¸€è¾†å…°åšåŸºå°¼çš„è¯ï¼Œé‚£ä¹ˆæ²¡æœ‰è®¾è®¡å’Œä½¿ç”¨ç´¢å¼•çš„MySQLå°±æ˜¯ä¸€ä¸ªäººåŠ›ä¸‰è½®è½¦ã€‚

æ‹¿æ±‰è¯­å­—å…¸çš„ç›®å½•é¡µï¼ˆç´¢å¼•ï¼‰æ‰“æ¯”æ–¹ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰æ‹¼éŸ³ã€ç¬”ç”»ã€åæ—éƒ¨é¦–ç­‰æ’åºçš„ç›®å½•ï¼ˆç´¢å¼•ï¼‰å¿«é€ŸæŸ¥æ‰¾åˆ°éœ€è¦çš„å­—ã€‚

ç´¢å¼•åˆ†å•åˆ—ç´¢å¼•å’Œç»„åˆç´¢å¼•ã€‚å•åˆ—ç´¢å¼•ï¼Œå³ä¸€ä¸ªç´¢å¼•åªåŒ…å«å•ä¸ªåˆ—ï¼Œä¸€ä¸ªè¡¨å¯ä»¥æœ‰å¤šä¸ªå•åˆ—ç´¢å¼•ï¼Œä½†è¿™ä¸æ˜¯ç»„åˆç´¢å¼•ã€‚ç»„åˆç´¢å¼•ï¼Œå³ä¸€ä¸ªç´¢å¼•åŒ…å«å¤šä¸ªåˆ—ã€‚

åˆ›å»ºç´¢å¼•æ—¶ï¼Œä½ éœ€è¦ç¡®ä¿è¯¥ç´¢å¼•æ˜¯åº”ç”¨åœ¨ <span class="token keyword">SQL</span> æŸ¥è¯¢è¯­å¥çš„æ¡ä»¶<span class="token punctuation">(</span>ä¸€èˆ¬ä½œä¸º <span class="token keyword">WHERE</span> å­å¥çš„æ¡ä»¶<span class="token punctuation">)</span>ã€‚

å®é™…ä¸Šï¼Œç´¢å¼•ä¹Ÿæ˜¯ä¸€å¼ è¡¨ï¼Œè¯¥è¡¨ä¿å­˜äº†ä¸»é”®ä¸ç´¢å¼•å­—æ®µï¼Œå¹¶æŒ‡å‘å®ä½“è¡¨çš„è®°å½•ã€‚

ä¸Šé¢éƒ½åœ¨è¯´ä½¿ç”¨ç´¢å¼•çš„å¥½å¤„ï¼Œä½†è¿‡å¤šçš„ä½¿ç”¨ç´¢å¼•å°†ä¼šé€ æˆæ»¥ç”¨ã€‚å› æ­¤ç´¢å¼•ä¹Ÿä¼šæœ‰å®ƒçš„ç¼ºç‚¹ï¼šè™½ç„¶ç´¢å¼•å¤§å¤§æé«˜äº†æŸ¥è¯¢é€Ÿåº¦ï¼ŒåŒæ—¶å´ä¼šé™ä½æ›´æ–°è¡¨çš„é€Ÿåº¦ï¼Œå¦‚å¯¹è¡¨è¿›è¡Œ<span class="token keyword">INSERT</span>ã€<span class="token keyword">UPDATE</span>å’Œ<span class="token keyword">DELETE</span>ã€‚å› ä¸ºæ›´æ–°è¡¨æ—¶ï¼ŒMySQLä¸ä»…è¦ä¿å­˜æ•°æ®ï¼Œè¿˜è¦ä¿å­˜ä¸€ä¸‹ç´¢å¼•æ–‡ä»¶ã€‚

å»ºç«‹ç´¢å¼•ä¼šå ç”¨ç£ç›˜ç©ºé—´çš„ç´¢å¼•æ–‡ä»¶

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20220905074911013.png" alt="image-20220905074911013"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20220905075120329.png" alt="image-20220905075120329"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20220905102533069.png" alt="image-20220905102533069"></p><h5 id="ä¸»é”®ç´¢å¼•" tabindex="-1"><a class="header-anchor" href="#ä¸»é”®ç´¢å¼•" aria-hidden="true">#</a> ä¸»é”®ç´¢å¼•</h5><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">#ä¸»é”®ç´¢å¼•</span>
ä¸»é”®è‡ªåŠ¨ä¸ºä¸»ç´¢å¼•ï¼ˆç±»å‹<span class="token keyword">primary</span> <span class="token keyword">key</span>ï¼‰
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="å”¯ä¸€ç´¢å¼•-unique" tabindex="-1"><a class="header-anchor" href="#å”¯ä¸€ç´¢å¼•-unique" aria-hidden="true">#</a> å”¯ä¸€ç´¢å¼•ï¼ˆUNIQUEï¼‰</h5><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">#å”¯ä¸€ç´¢å¼•</span>
å®ƒä¸å‰é¢çš„æ™®é€šç´¢å¼•ç±»ä¼¼ï¼Œä¸åŒçš„å°±æ˜¯ï¼šç´¢å¼•åˆ—çš„å€¼å¿…é¡»å”¯ä¸€ï¼Œä½†å…è®¸æœ‰ç©ºå€¼ã€‚å¦‚æœæ˜¯ç»„åˆç´¢å¼•ï¼Œåˆ™åˆ—å€¼çš„ç»„åˆå¿…é¡»å”¯ä¸€ã€‚å®ƒæœ‰ä»¥ä¸‹å‡ ç§åˆ›å»ºæ–¹å¼ï¼š

åˆ›å»ºç´¢å¼•
<span class="token keyword">CREATE</span> <span class="token keyword">UNIQUE</span> <span class="token keyword">INDEX</span> indexName <span class="token keyword">ON</span> mytable<span class="token punctuation">(</span>username<span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">)</span> 

<span class="token keyword">create</span> <span class="token keyword">unique</span> <span class="token keyword">index</span> index_emp <span class="token keyword">on</span> emp<span class="token punctuation">(</span>empno<span class="token punctuation">)</span><span class="token punctuation">;</span>

ä¿®æ”¹è¡¨ç»“æ„
<span class="token keyword">ALTER</span> <span class="token keyword">table</span> mytable <span class="token keyword">ADD</span> <span class="token keyword">UNIQUE</span> <span class="token punctuation">[</span>indexName<span class="token punctuation">]</span> <span class="token punctuation">(</span>username<span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">)</span>
åˆ›å»ºè¡¨çš„æ—¶å€™ç›´æ¥æŒ‡å®š
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> mytable<span class="token punctuation">(</span>  
 
ID <span class="token keyword">INT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>   
 
username <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>  
 
<span class="token keyword">UNIQUE</span> <span class="token punctuation">[</span>indexName<span class="token punctuation">]</span> <span class="token punctuation">(</span>username<span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">)</span>  
 
<span class="token punctuation">)</span><span class="token punctuation">;</span>  
ä½¿ç”¨<span class="token keyword">ALTER</span> å‘½ä»¤æ·»åŠ å’Œåˆ é™¤ç´¢å¼•
æœ‰å››ç§æ–¹å¼æ¥æ·»åŠ æ•°æ®è¡¨çš„ç´¢å¼•ï¼š

<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> tbl_name <span class="token keyword">ADD</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>column_list<span class="token punctuation">)</span>: è¯¥è¯­å¥æ·»åŠ ä¸€ä¸ªä¸»é”®ï¼Œè¿™æ„å‘³ç€ç´¢å¼•å€¼å¿…é¡»æ˜¯å”¯ä¸€çš„ï¼Œä¸”ä¸èƒ½ä¸º<span class="token boolean">NULL</span>ã€‚
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> tbl_name <span class="token keyword">ADD</span> <span class="token keyword">UNIQUE</span> index_name <span class="token punctuation">(</span>column_list<span class="token punctuation">)</span>: è¿™æ¡è¯­å¥åˆ›å»ºç´¢å¼•çš„å€¼å¿…é¡»æ˜¯å”¯ä¸€çš„ï¼ˆé™¤äº†<span class="token boolean">NULL</span>å¤–ï¼Œ<span class="token boolean">NULL</span>å¯èƒ½ä¼šå‡ºç°å¤šæ¬¡ï¼‰ã€‚
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> tbl_name <span class="token keyword">ADD</span> <span class="token keyword">INDEX</span> index_name <span class="token punctuation">(</span>column_list<span class="token punctuation">)</span>: æ·»åŠ æ™®é€šç´¢å¼•ï¼Œç´¢å¼•å€¼å¯å‡ºç°å¤šæ¬¡ã€‚
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> tbl_name <span class="token keyword">ADD</span> FULLTEXT index_name <span class="token punctuation">(</span>column_list<span class="token punctuation">)</span>:è¯¥è¯­å¥æŒ‡å®šäº†ç´¢å¼•ä¸º FULLTEXT ï¼Œç”¨äºå…¨æ–‡ç´¢å¼•ã€‚
ä»¥ä¸‹å®ä¾‹ä¸ºåœ¨è¡¨ä¸­æ·»åŠ ç´¢å¼•ã€‚

mysql<span class="token operator">&gt;</span> <span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> testalter_tbl <span class="token keyword">ADD</span> <span class="token keyword">INDEX</span> <span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
ä½ è¿˜å¯ä»¥åœ¨ <span class="token keyword">ALTER</span> å‘½ä»¤ä¸­ä½¿ç”¨ <span class="token keyword">DROP</span> å­å¥æ¥åˆ é™¤ç´¢å¼•ã€‚å°è¯•ä»¥ä¸‹å®ä¾‹åˆ é™¤ç´¢å¼•:

mysql<span class="token operator">&gt;</span> <span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> testalter_tbl <span class="token keyword">DROP</span> <span class="token keyword">INDEX</span> c<span class="token punctuation">;</span>
ä½¿ç”¨ <span class="token keyword">ALTER</span> å‘½ä»¤æ·»åŠ å’Œåˆ é™¤ä¸»é”®
ä¸»é”®ä½œç”¨äºåˆ—ä¸Šï¼ˆå¯ä»¥ä¸€ä¸ªåˆ—æˆ–å¤šä¸ªåˆ—è”åˆä¸»é”®ï¼‰ï¼Œæ·»åŠ ä¸»é”®ç´¢å¼•æ—¶ï¼Œä½ éœ€è¦ç¡®ä¿è¯¥ä¸»é”®é»˜è®¤ä¸ä¸ºç©ºï¼ˆ<span class="token operator">NOT</span> <span class="token boolean">NULL</span>ï¼‰ã€‚å®ä¾‹å¦‚ä¸‹ï¼š

mysql<span class="token operator">&gt;</span> <span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> testalter_tbl <span class="token keyword">MODIFY</span> i <span class="token keyword">INT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> testalter_tbl <span class="token keyword">ADD</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ <span class="token keyword">ALTER</span> å‘½ä»¤åˆ é™¤ä¸»é”®ï¼š

mysql<span class="token operator">&gt;</span> <span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> testalter_tbl <span class="token keyword">DROP</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">;</span>
åˆ é™¤ä¸»é”®æ—¶åªéœ€æŒ‡å®š <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span>ï¼Œä½†åœ¨åˆ é™¤ç´¢å¼•æ—¶ï¼Œä½ å¿…é¡»çŸ¥é“ç´¢å¼•å

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="æ™®é€šç´¢å¼•-index" tabindex="-1"><a class="header-anchor" href="#æ™®é€šç´¢å¼•-index" aria-hidden="true">#</a> æ™®é€šç´¢å¼•ï¼ˆINDEXï¼‰</h5><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">#æ™®é€šç´¢å¼•</span>
åˆ›å»ºç´¢å¼•
è¿™æ˜¯æœ€åŸºæœ¬çš„ç´¢å¼•ï¼Œå®ƒæ²¡æœ‰ä»»ä½•é™åˆ¶ã€‚å®ƒæœ‰ä»¥ä¸‹å‡ ç§åˆ›å»ºæ–¹å¼ï¼š

<span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> indexName <span class="token keyword">ON</span> table_name <span class="token punctuation">(</span>column_name<span class="token punctuation">)</span>
å¦‚æœæ˜¯<span class="token keyword">CHAR</span>ï¼Œ<span class="token keyword">VARCHAR</span>ç±»å‹ï¼Œlengthå¯ä»¥å°äºå­—æ®µå®é™…é•¿åº¦ï¼›å¦‚æœæ˜¯<span class="token keyword">BLOB</span>å’Œ<span class="token keyword">TEXT</span>ç±»å‹ï¼Œå¿…é¡»æŒ‡å®š length

<span class="token keyword">create</span> <span class="token keyword">index</span> index_emp <span class="token keyword">on</span> emp <span class="token punctuation">(</span>empno<span class="token punctuation">)</span><span class="token punctuation">;</span>

ä¿®æ”¹è¡¨ç»“æ„<span class="token punctuation">(</span>æ·»åŠ ç´¢å¼•<span class="token punctuation">)</span>
<span class="token keyword">ALTER</span> <span class="token keyword">table</span> tableName <span class="token keyword">ADD</span> <span class="token keyword">INDEX</span> indexName<span class="token punctuation">(</span>columnName<span class="token punctuation">)</span>

<span class="token keyword">alter</span> <span class="token keyword">table</span> emp<span class="token punctuation">.</span>emp <span class="token keyword">add</span> <span class="token keyword">index</span> index_emp <span class="token punctuation">(</span>empno<span class="token punctuation">)</span><span class="token punctuation">;</span>

åˆ›å»ºè¡¨çš„æ—¶å€™ç›´æ¥æŒ‡å®š
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> mytable<span class="token punctuation">(</span>  
 
ID <span class="token keyword">INT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>   
 
username <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>  
 
<span class="token keyword">INDEX</span> <span class="token punctuation">[</span>indexName<span class="token punctuation">]</span> <span class="token punctuation">(</span>username<span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">)</span>  
 
<span class="token punctuation">)</span><span class="token punctuation">;</span>  
åˆ é™¤ç´¢å¼•çš„è¯­æ³•
<span class="token keyword">DROP</span> <span class="token keyword">INDEX</span> <span class="token punctuation">[</span>indexName<span class="token punctuation">]</span> <span class="token keyword">ON</span> mytable<span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="å…¨æ–‡ç´¢å¼•" tabindex="-1"><a class="header-anchor" href="#å…¨æ–‡ç´¢å¼•" aria-hidden="true">#</a> å…¨æ–‡ç´¢å¼•</h5><h4 id="äº‹åŠ¡" tabindex="-1"><a class="header-anchor" href="#äº‹åŠ¡" aria-hidden="true">#</a> äº‹åŠ¡</h4><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20220905103719377.png" alt="image-20220905103719377"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20220905104030470.png" alt="image-20220905104030470"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20220905235904013.png" alt="image-20220905235904013"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20220905104709042.png" alt="image-20220905104709042"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20220905104832325.png" alt="image-20220905104832325"></p><h5 id="äº‹åŠ¡ç®¡ç†" tabindex="-1"><a class="header-anchor" href="#äº‹åŠ¡ç®¡ç†" aria-hidden="true">#</a> äº‹åŠ¡ç®¡ç†</h5><h5 id="save-point" tabindex="-1"><a class="header-anchor" href="#save-point" aria-hidden="true">#</a> save point</h5><h5 id="rollback" tabindex="-1"><a class="header-anchor" href="#rollback" aria-hidden="true">#</a> rollback</h5><h5 id="commit" tabindex="-1"><a class="header-anchor" href="#commit" aria-hidden="true">#</a> commit</h5><h5 id="äº‹åŠ¡æ§åˆ¶è¯­å¥" tabindex="-1"><a class="header-anchor" href="#äº‹åŠ¡æ§åˆ¶è¯­å¥" aria-hidden="true">#</a> äº‹åŠ¡æ§åˆ¶è¯­å¥</h5><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">BEGIN</span> æˆ– <span class="token keyword">START</span> <span class="token keyword">TRANSACTION</span> æ˜¾å¼åœ°å¼€å¯ä¸€ä¸ªäº‹åŠ¡ï¼›

<span class="token keyword">COMMIT</span> ä¹Ÿå¯ä»¥ä½¿ç”¨ <span class="token keyword">COMMIT</span> <span class="token keyword">WORK</span>ï¼Œä¸è¿‡äºŒè€…æ˜¯ç­‰ä»·çš„ã€‚<span class="token keyword">COMMIT</span> ä¼šæäº¤äº‹åŠ¡ï¼Œå¹¶ä½¿å·²å¯¹æ•°æ®åº“è¿›è¡Œçš„æ‰€æœ‰ä¿®æ”¹æˆä¸ºæ°¸ä¹…æ€§çš„ï¼›

<span class="token keyword">ROLLBACK</span> ä¹Ÿå¯ä»¥ä½¿ç”¨ <span class="token keyword">ROLLBACK</span> <span class="token keyword">WORK</span>ï¼Œä¸è¿‡äºŒè€…æ˜¯ç­‰ä»·çš„ã€‚å›æ»šä¼šç»“æŸç”¨æˆ·çš„äº‹åŠ¡ï¼Œå¹¶æ’¤é”€æ­£åœ¨è¿›è¡Œçš„æ‰€æœ‰æœªæäº¤çš„ä¿®æ”¹ï¼›

<span class="token keyword">SAVEPOINT</span> identifierï¼Œ<span class="token keyword">SAVEPOINT</span> å…è®¸åœ¨äº‹åŠ¡ä¸­åˆ›å»ºä¸€ä¸ªä¿å­˜ç‚¹ï¼Œä¸€ä¸ªäº‹åŠ¡ä¸­å¯ä»¥æœ‰å¤šä¸ª <span class="token keyword">SAVEPOINT</span>ï¼›

<span class="token keyword">RELEASE</span> <span class="token keyword">SAVEPOINT</span> identifier åˆ é™¤ä¸€ä¸ªäº‹åŠ¡çš„ä¿å­˜ç‚¹ï¼Œå½“æ²¡æœ‰æŒ‡å®šçš„ä¿å­˜ç‚¹æ—¶ï¼Œæ‰§è¡Œè¯¥è¯­å¥ä¼šæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼›

<span class="token keyword">ROLLBACK</span> <span class="token keyword">TO</span> identifier æŠŠäº‹åŠ¡å›æ»šåˆ°æ ‡è®°ç‚¹ï¼›

<span class="token keyword">SET</span> <span class="token keyword">TRANSACTION</span> ç”¨æ¥è®¾ç½®äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ã€‚<span class="token keyword">InnoDB</span> å­˜å‚¨å¼•æ“æä¾›äº‹åŠ¡çš„éš”ç¦»çº§åˆ«æœ‰<span class="token keyword">READ</span> <span class="token keyword">UNCOMMITTED</span>ã€<span class="token keyword">READ</span> <span class="token keyword">COMMITTED</span>ã€<span class="token keyword">REPEATABLE</span> <span class="token keyword">READ</span> å’Œ <span class="token keyword">SERIALIZABLE</span>ã€‚
MYSQL äº‹åŠ¡å¤„ç†ä¸»è¦æœ‰ä¸¤ç§æ–¹æ³•ï¼š
<span class="token number">1</span>ã€ç”¨ <span class="token keyword">BEGIN</span><span class="token punctuation">,</span> <span class="token keyword">ROLLBACK</span><span class="token punctuation">,</span> <span class="token keyword">COMMIT</span>æ¥å®ç°

<span class="token keyword">BEGIN</span> å¼€å§‹ä¸€ä¸ªäº‹åŠ¡
<span class="token keyword">ROLLBACK</span> äº‹åŠ¡å›æ»š
<span class="token keyword">COMMIT</span> äº‹åŠ¡ç¡®è®¤
<span class="token number">2</span>ã€ç›´æ¥ç”¨ <span class="token keyword">SET</span> æ¥æ”¹å˜ MySQL çš„è‡ªåŠ¨æäº¤æ¨¡å¼:

<span class="token keyword">SET</span> AUTOCOMMIT<span class="token operator">=</span><span class="token number">0</span> ç¦æ­¢è‡ªåŠ¨æäº¤
<span class="token keyword">SET</span> AUTOCOMMIT<span class="token operator">=</span><span class="token number">1</span> å¼€å¯è‡ªåŠ¨æäº¤
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="éš”ç¦»çº§åˆ«" tabindex="-1"><a class="header-anchor" href="#éš”ç¦»çº§åˆ«" aria-hidden="true">#</a> éš”ç¦»çº§åˆ«</h5><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment"># You can set the isolationlevel for the whole server in the configuration file, or just foryour session:</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">SET</span> <span class="token keyword">SESSION</span> <span class="token keyword">TRANSACTION</span> <span class="token keyword">ISOLATION</span> <span class="token keyword">LEVEL</span> <span class="token keyword">READ</span> <span class="token keyword">COMMITTED</span><span class="token punctuation">;</span>
<span class="token comment"># You can set the isolationlevel for the whole server(global) in the configuration file, or just foryour session:</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">set</span> <span class="token keyword">global</span> <span class="token keyword">transaction</span> <span class="token keyword">isolation</span> <span class="token keyword">level</span> <span class="token keyword">read</span> <span class="token keyword">committed</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20220905105530766.png" alt="image-20220905105530766"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20220905105812053.png" alt="image-20220905105812053"></p><h5 id="acid" tabindex="-1"><a class="header-anchor" href="#acid" aria-hidden="true">#</a> ACID</h5><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>äº‹åŠ¡æ˜¯å¿…é¡»æ»¡è¶³<span class="token number">4</span>ä¸ªæ¡ä»¶ï¼ˆACIDï¼‰ï¼š
åŸå­æ€§ï¼ˆAtomicityï¼Œæˆ–ç§°ä¸å¯åˆ†å‰²æ€§ï¼‰ã€
ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ã€
éš”ç¦»æ€§ï¼ˆ<span class="token keyword">Isolation</span>ï¼Œåˆç§°ç‹¬ç«‹æ€§ï¼‰ã€
æŒä¹…æ€§ï¼ˆDurabilityï¼‰ã€‚

åŸå­æ€§ï¼šä¸€ä¸ªäº‹åŠ¡ï¼ˆ<span class="token keyword">transaction</span>ï¼‰ä¸­çš„æ‰€æœ‰æ“ä½œï¼Œè¦ä¹ˆå…¨éƒ¨å®Œæˆï¼Œè¦ä¹ˆå…¨éƒ¨ä¸å®Œæˆï¼Œä¸ä¼šç»“æŸåœ¨ä¸­é—´æŸä¸ªç¯èŠ‚ã€‚äº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼Œä¼šè¢«å›æ»šï¼ˆ<span class="token keyword">Rollback</span>ï¼‰åˆ°äº‹åŠ¡å¼€å§‹å‰çš„çŠ¶æ€ï¼Œå°±åƒè¿™ä¸ªäº‹åŠ¡ä»æ¥æ²¡æœ‰æ‰§è¡Œè¿‡ä¸€æ ·ã€‚

ä¸€è‡´æ€§ï¼šåœ¨äº‹åŠ¡å¼€å§‹ä¹‹å‰å’Œäº‹åŠ¡ç»“æŸä»¥åï¼Œæ•°æ®åº“çš„å®Œæ•´æ€§æ²¡æœ‰è¢«ç ´åã€‚è¿™è¡¨ç¤ºå†™å…¥çš„èµ„æ–™å¿…é¡»å®Œå…¨ç¬¦åˆæ‰€æœ‰çš„é¢„è®¾è§„åˆ™ï¼Œè¿™åŒ…å«èµ„æ–™çš„ç²¾ç¡®åº¦ã€ä¸²è”æ€§ä»¥åŠåç»­æ•°æ®åº“å¯ä»¥è‡ªå‘æ€§åœ°å®Œæˆé¢„å®šçš„å·¥ä½œã€‚

éš”ç¦»æ€§ï¼šæ•°æ®åº“å…è®¸å¤šä¸ªå¹¶å‘äº‹åŠ¡åŒæ—¶å¯¹å…¶æ•°æ®è¿›è¡Œè¯»å†™å’Œä¿®æ”¹çš„èƒ½åŠ›ï¼Œéš”ç¦»æ€§å¯ä»¥é˜²æ­¢å¤šä¸ªäº‹åŠ¡å¹¶å‘æ‰§è¡Œæ—¶ç”±äºäº¤å‰æ‰§è¡Œè€Œå¯¼è‡´æ•°æ®çš„ä¸ä¸€è‡´ã€‚äº‹åŠ¡éš”ç¦»åˆ†ä¸ºä¸åŒçº§åˆ«ï¼ŒåŒ…æ‹¬è¯»æœªæäº¤ï¼ˆ<span class="token keyword">Read</span> <span class="token keyword">uncommitted</span>ï¼‰ã€è¯»æäº¤ï¼ˆ<span class="token keyword">read</span> <span class="token keyword">committed</span>ï¼‰ã€å¯é‡å¤è¯»ï¼ˆ<span class="token keyword">repeatable</span> <span class="token keyword">read</span>ï¼‰å’Œä¸²è¡ŒåŒ–ï¼ˆ<span class="token keyword">Serializable</span>ï¼‰ã€‚

æŒä¹…æ€§ï¼šäº‹åŠ¡å¤„ç†ç»“æŸåï¼Œå¯¹æ•°æ®çš„ä¿®æ”¹å°±æ˜¯æ°¸ä¹…çš„ï¼Œå³ä¾¿ç³»ç»Ÿæ•…éšœä¹Ÿä¸ä¼šä¸¢å¤±ã€‚
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="è§†å›¾" tabindex="-1"><a class="header-anchor" href="#è§†å›¾" aria-hidden="true">#</a> è§†å›¾</h4><p>è§†å›¾çš„ç†è§£</p><p>1.å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªè™šæ‹Ÿçš„è¡¨ï¼Œæœ¬èº«ä¸å­˜å‚¨æ•°æ® è¯•å›¾çš„å¯ä»¥ç†è§£ä¸ºå­˜å‚¨èµ·æ¥çš„selectè¯­å¥</p><p>2.è¯•å›¾åˆ›å»ºæ—¶selectè¯­å¥è®¾è®¡çš„è¡¨ ç§°ä¹‹ä¸ºåŸºè¡¨</p><p>3.é’ˆå¯¹å¯¹è§†å›¾è¿›è¡Œçš„DMLæ“ä½œ ä¼šå½±å“åˆ°åŸºè¡¨ åä¹‹äº¦ç„¶</p><p>4.åˆ é™¤è§†å›¾ ä¸ä¼šå¯¼è‡´åˆ°åŸºè¡¨æœ¬èº«çš„æ•°æ®è¢«åˆ é™¤</p><p>5.è§†å›¾çš„åº”ç”¨åœºæ™¯ é’ˆå¯¹äºå°å‹é¡¹ç›®ä¸å»ºè®®ä½¿ç”¨è§†å›¾ é’ˆå¯¹äºå¤§å‹é¡¹ç›®æ¨èä½¿ç”¨è§†å›¾</p><p>6.è§†å›¾çš„ä½œç”¨åŠä¼˜ç‚¹ ç®€åŒ–æŸ¥è¯¢ï¼ˆå°†ä¸€æ¬¡æŸ¥è¯¢æŒä¹…å‚¨å­˜èµ·æ¥ï¼‰ï¼›æƒé™ç®¡ç† ï¼ˆè®©ä¸åŒæƒé™çš„äººå‘˜ çœ‹åˆ°è¡¨ä¸­ä¸åŒèŒƒå›´çš„æ•°æ® æ§åˆ¶æ•°æ®çš„è®¿é—®ï¼‰</p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20220905144613234.png" alt="image-20220905144613234"></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">#SQL è§†å›¾ï¼ˆViewsï¼‰</span>
è§†å›¾æ˜¯å¯è§†åŒ–çš„è¡¨ã€‚

æœ¬ç« è®²è§£å¦‚ä½•åˆ›å»ºã€æ›´æ–°å’Œåˆ é™¤è§†å›¾ã€‚

<span class="token keyword">SQL</span> <span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> è¯­å¥
åœ¨ <span class="token keyword">SQL</span> ä¸­ï¼Œè§†å›¾æ˜¯åŸºäº <span class="token keyword">SQL</span> è¯­å¥çš„ç»“æœé›†çš„å¯è§†åŒ–çš„è¡¨ã€‚

è§†å›¾åŒ…å«è¡Œå’Œåˆ—ï¼Œå°±åƒä¸€ä¸ªçœŸå®çš„è¡¨ã€‚è§†å›¾ä¸­çš„å­—æ®µå°±æ˜¯æ¥è‡ªä¸€ä¸ªæˆ–å¤šä¸ªæ•°æ®åº“ä¸­çš„çœŸå®çš„è¡¨ä¸­çš„å­—æ®µã€‚

æ‚¨å¯ä»¥å‘è§†å›¾æ·»åŠ  <span class="token keyword">SQL</span> å‡½æ•°ã€<span class="token keyword">WHERE</span> ä»¥åŠ <span class="token keyword">JOIN</span> è¯­å¥ï¼Œä¹Ÿå¯ä»¥å‘ˆç°æ•°æ®ï¼Œå°±åƒè¿™äº›æ•°æ®æ¥è‡ªäºæŸä¸ªå•ä¸€çš„è¡¨ä¸€æ ·ã€‚

<span class="token keyword">SQL</span> <span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> è¯­æ³•

<span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> view_name <span class="token keyword">AS</span>
<span class="token keyword">SELECT</span> column_name<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
<span class="token keyword">FROM</span> table_name
<span class="token keyword">WHERE</span> condition
æ³¨é‡Šï¼šè§†å›¾æ€»æ˜¯æ˜¾ç¤ºæœ€æ–°çš„æ•°æ®ï¼æ¯å½“ç”¨æˆ·æŸ¥è¯¢è§†å›¾æ—¶ï¼Œæ•°æ®åº“å¼•æ“é€šè¿‡ä½¿ç”¨è§†å›¾çš„ <span class="token keyword">SQL</span> è¯­å¥é‡å»ºæ•°æ®

<span class="token comment">-- For instance</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token keyword">view</span> view_emp1 <span class="token keyword">as</span> <span class="token keyword">select</span> empno<span class="token punctuation">,</span>ename<span class="token punctuation">,</span>job <span class="token keyword">from</span> emp <span class="token keyword">where</span> deptno <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> view_emp1<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-------+--------+----------+</span>
<span class="token operator">|</span> empno <span class="token operator">|</span> ename  <span class="token operator">|</span> job      <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+--------+----------+</span>
<span class="token operator">|</span>  <span class="token number">7499</span> <span class="token operator">|</span> ALLEN  <span class="token operator">|</span> salesman <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7521</span> <span class="token operator">|</span> WARD   <span class="token operator">|</span> salesman <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7654</span> <span class="token operator">|</span> MARTIN <span class="token operator">|</span> salesman <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7698</span> <span class="token operator">|</span> BLAKE  <span class="token operator">|</span> manager  <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7844</span> <span class="token operator">|</span> TURNER <span class="token operator">|</span> salesman <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7900</span> <span class="token operator">|</span> JAMES  <span class="token operator">|</span> clerk    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+--------+----------+</span>
<span class="token number">6</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

<span class="token comment">#SQL æ›´æ–°è§†å›¾</span>
æ‚¨å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„è¯­æ³•æ¥æ›´æ–°è§†å›¾ï¼š

<span class="token keyword">SQL</span> <span class="token keyword">CREATE</span> <span class="token operator">OR</span> <span class="token keyword">REPLACE</span> <span class="token keyword">VIEW</span> è¯­æ³•

<span class="token keyword">CREATE</span> <span class="token operator">OR</span> <span class="token keyword">REPLACE</span> <span class="token keyword">VIEW</span> view_name <span class="token keyword">AS</span>
<span class="token keyword">SELECT</span> column_name<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
<span class="token keyword">FROM</span> table_name
<span class="token keyword">WHERE</span> condition
ç°åœ¨ï¼Œæˆ‘ä»¬å¸Œæœ›å‘ <span class="token string">&quot;Current Product List&quot;</span> è§†å›¾æ·»åŠ  <span class="token string">&quot;Category&quot;</span> åˆ—ã€‚æˆ‘ä»¬å°†é€šè¿‡ä¸‹åˆ— <span class="token keyword">SQL</span> æ›´æ–°è§†å›¾ï¼š

<span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> <span class="token punctuation">[</span><span class="token keyword">Current</span> Product List<span class="token punctuation">]</span> <span class="token keyword">AS</span>
<span class="token keyword">SELECT</span> ProductID<span class="token punctuation">,</span>ProductName<span class="token punctuation">,</span>Category
<span class="token keyword">FROM</span> Products
<span class="token keyword">WHERE</span> Discontinued<span class="token operator">=</span><span class="token keyword">No</span>

<span class="token comment">-- For instance</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token operator">or</span> <span class="token keyword">replace</span> <span class="token keyword">view</span> view_emp1 <span class="token keyword">as</span> <span class="token keyword">select</span> empno<span class="token punctuation">,</span>ename<span class="token punctuation">,</span>job<span class="token punctuation">,</span>deptno <span class="token keyword">from</span> emp <span class="token keyword">where</span> deptno <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.12</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> view_emp1<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-------+--------+----------+--------+</span>
<span class="token operator">|</span> empno <span class="token operator">|</span> ename  <span class="token operator">|</span> job      <span class="token operator">|</span> deptno <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+--------+----------+--------+</span>
<span class="token operator">|</span>  <span class="token number">7499</span> <span class="token operator">|</span> ALLEN  <span class="token operator">|</span> salesman <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7521</span> <span class="token operator">|</span> WARD   <span class="token operator">|</span> salesman <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7654</span> <span class="token operator">|</span> MARTIN <span class="token operator">|</span> salesman <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7698</span> <span class="token operator">|</span> BLAKE  <span class="token operator">|</span> manager  <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7844</span> <span class="token operator">|</span> TURNER <span class="token operator">|</span> salesman <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7900</span> <span class="token operator">|</span> JAMES  <span class="token operator">|</span> clerk    <span class="token operator">|</span>     <span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+--------+----------+--------+</span>
<span class="token number">6</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

<span class="token comment">#SQL æ’¤é”€è§†å›¾</span>
æ‚¨å¯ä»¥é€šè¿‡ <span class="token keyword">DROP</span> <span class="token keyword">VIEW</span> å‘½ä»¤æ¥åˆ é™¤è§†å›¾ã€‚

<span class="token keyword">SQL</span> <span class="token keyword">DROP</span> <span class="token keyword">VIEW</span> è¯­æ³•
<span class="token keyword">DROP</span> <span class="token keyword">VIEW</span> view_name

<span class="token comment">-- For instance</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">drop</span> <span class="token keyword">view</span> view_emp1<span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> view_emp1<span class="token punctuation">;</span>
<span class="token comment">#ERROR 1146 (42S02): Table &#39;db02.view_emp1&#39; doesn&#39;t exist</span>


<span class="token comment">#è§†å›¾çš„ä½œç”¨ï¼š</span>

<span class="token number">1</span>ã€è§†å›¾éšè—äº†åº•å±‚çš„è¡¨ç»“æ„ï¼Œç®€åŒ–äº†æ•°æ®è®¿é—®æ“ä½œï¼Œå®¢æˆ·ç«¯ä¸å†éœ€è¦çŸ¥é“åº•å±‚è¡¨çš„ç»“æ„åŠå…¶ä¹‹é—´çš„å…³ç³»ã€‚

<span class="token number">2</span>ã€è§†å›¾æä¾›äº†ä¸€ä¸ªç»Ÿä¸€è®¿é—®æ•°æ®çš„æ¥å£ã€‚ï¼ˆå³å¯ä»¥å…è®¸ç”¨æˆ·é€šè¿‡è§†å›¾è®¿é—®æ•°æ®çš„å®‰å…¨æœºåˆ¶ï¼Œè€Œä¸æˆäºˆç”¨æˆ·ç›´æ¥è®¿é—®åº•å±‚è¡¨çš„æƒé™ï¼‰

<span class="token number">3</span>ã€ä»è€ŒåŠ å¼ºäº†å®‰å…¨æ€§ï¼Œä½¿ç”¨æˆ·åªèƒ½çœ‹åˆ°è§†å›¾æ‰€æ˜¾ç¤ºçš„æ•°æ®ã€‚

<span class="token number">4</span>ã€è§†å›¾è¿˜å¯ä»¥è¢«åµŒå¥—ï¼Œä¸€ä¸ªè§†å›¾ä¸­å¯ä»¥åµŒå¥—å¦ä¸€ä¸ªè§†å›¾ã€‚
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="mysqlç”¨æˆ·ç®¡ç†" tabindex="-1"><a class="header-anchor" href="#mysqlç”¨æˆ·ç®¡ç†" aria-hidden="true">#</a> Mysqlç”¨æˆ·ç®¡ç†</h4><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">#Mysqlç”¨æˆ·ç®¡ç†</span>
<span class="token comment">-- åº”ç”¨åœºæ™¯:å½“æˆ‘ä»¬åšé¡¹ç›®å¼€å‘æ—¶ï¼Œå¯ä»¥æ ¹æ®ä¸åŒçš„å¼€å‘äººå‘˜ï¼Œèµ‹ç»™ä»–ä»¬ç›¸åº”çš„Mysqlæ“ä½œæƒé™	</span>
<span class="token comment">-- Mysqlæ•°æ®åº“ç®¡ç†äººå‘˜ï¼ˆrootï¼‰ å¯ä»¥æ ¹æ®éœ€è¦åˆ›å»ºä¸åŒçš„ç”¨æˆ·ï¼Œèµ‹äºˆç›¸åº”çš„æƒé™ï¼Œä¾›äººå‘˜ä½¿ç”¨</span>

<span class="token comment">#åˆ›å»ºæ–°çš„ç”¨æˆ·</span>
<span class="token keyword">create</span> <span class="token keyword">user</span> <span class="token string">&#39;EddieZ&#39;</span><span class="token variable">@&#39;localhost&#39;</span> identified <span class="token keyword">by</span> <span class="token string">&#39;eddiez&#39;</span><span class="token punctuation">;</span>
<span class="token comment">-- &#39;ç”¨æˆ·å&#39;@&#39;æŒ‡å®šç«¯å£å·&#39; identified by &#39;å¯†ç &#39;; -- Tip:å­˜å…¥åˆ°Mysql.userè¡¨æ—¶çš„å¯†ç æ˜¯åŠ å¯†è¿‡çš„</span>

<span class="token comment">#æŸ¥çœ‹ç”¨æˆ·</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> mysql<span class="token punctuation">.</span><span class="token keyword">user</span><span class="token comment">-- æŸ¥çœ‹æ‰€æœ‰ä¿¡æ¯</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token identifier"><span class="token punctuation">`</span>user<span class="token punctuation">`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>host<span class="token punctuation">`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>authentication_string<span class="token punctuation">`</span></span> <span class="token keyword">from</span> mysql<span class="token punctuation">.</span><span class="token keyword">user</span><span class="token punctuation">;</span><span class="token comment">--æŸ¥çœ‹æŒ‡å®šä¿¡æ¯</span>

<span class="token comment">#åˆ é™¤ç”¨æˆ·</span>
<span class="token keyword">drop</span> <span class="token keyword">user</span> <span class="token string">&#39;EddieZ&#39;</span><span class="token variable">@&#39;localhost&#39;</span>

<span class="token comment">#ç™»å½•</span>
<span class="token comment">-- ä¸åŒçš„ç”¨æˆ·ç™»å½•åˆ°æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼ˆDBMSï¼‰åï¼Œæ ¹æ®è‡ªèº«çš„ç›¸åº”æƒé™ï¼Œå¯ä»¥æ“ä½œçš„æ•°æ®åº“å’Œæ•°æ®å¯¹è±¡ï¼ˆè¡¨ï¼Œè¯•å›¾ï¼Œè§¦å‘å™¨ï¼‰éƒ½ä¸ä¸€æ ·ã€‚</span>

<span class="token comment">#ä¿®æ”¹å¯†ç </span>
<span class="token comment">-- è‡ªå·±æœ‰æƒé™ä¿®æ”¹è‡ªå·±çš„å¯†ç </span>
<span class="token keyword">set</span> password <span class="token operator">=</span> password<span class="token punctuation">(</span><span class="token string">&#39;newpassword&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- érootæ— æƒä¿®æ”¹åˆ«çš„ç”¨æˆ·çš„å¯†ç </span>

<span class="token comment">-- rootæœ‰æƒé™ä¿®æ”¹åˆ«çš„ç”¨æˆ·çš„å¯†ç </span>
<span class="token keyword">set</span> password <span class="token keyword">for</span> <span class="token string">&#39;EddieZ&#39;</span><span class="token variable">@&#39;localhost&#39;</span> <span class="token operator">=</span> password<span class="token punctuation">(</span><span class="token string">&#39;newpassword&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸åŒçš„ç”¨æˆ·ç™»å½•åˆ°æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼ˆDBMSï¼‰åï¼Œæ ¹æ®è‡ªèº«çš„ç›¸åº”æƒé™ï¼Œå¯ä»¥æ“ä½œçš„æ•°æ®åº“å’Œæ•°æ®å¯¹è±¡ï¼ˆè¡¨ï¼Œè¯•å›¾ï¼Œè§¦å‘å™¨ï¼‰éƒ½ä¸ä¸€æ ·ã€‚</p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20220906135039895.png" alt="image-20220906135039895"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20220906142425068.png" alt="image-20220906142425068"></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token keyword">user</span> eddiez<span class="token punctuation">;</span><span class="token comment">-- åˆ›å»ºç”¨æˆ·çš„æ—¶å€™æœªæŒ‡å®šhost åˆ™hostä¸º% å³è¡¨ç¤ºæ‰€æœ‰çš„ipéƒ½æœ‰è¿æ¥æƒé™</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token identifier"><span class="token punctuation">`</span>user<span class="token punctuation">`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>host<span class="token punctuation">`</span></span> <span class="token keyword">from</span> mysql<span class="token punctuation">.</span><span class="token keyword">user</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------------------+-----------+</span>
<span class="token operator">|</span> <span class="token keyword">user</span>             <span class="token operator">|</span> host      <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------------+-----------+</span>
<span class="token operator">|</span> eddiez           <span class="token operator">|</span> <span class="token operator">%</span>         <span class="token operator">|</span>
<span class="token operator">|</span> mysql<span class="token punctuation">.</span>infoschema <span class="token operator">|</span> localhost <span class="token operator">|</span>
<span class="token operator">|</span> mysql<span class="token punctuation">.</span><span class="token keyword">session</span>    <span class="token operator">|</span> localhost <span class="token operator">|</span>
<span class="token operator">|</span> mysql<span class="token punctuation">.</span>sys        <span class="token operator">|</span> localhost <span class="token operator">|</span>
<span class="token operator">|</span> root             <span class="token operator">|</span> localhost <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------------+-----------+</span>
<span class="token number">5</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">drop</span> <span class="token keyword">user</span> eddiez<span class="token punctuation">;</span><span class="token comment">-- å¦‚æœåˆ é™¤çš„ç”¨æˆ·ä¸ºæŒ‡æ˜ç«¯å£ åˆ™åªéœ€è¦è¾“å…¥ç”¨æˆ·åå³å¯</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token keyword">user</span> <span class="token string">&#39;eddiez&#39;</span><span class="token variable">@&#39;192.168.1.%&#39;</span><span class="token punctuation">;</span><span class="token comment">-- åˆ›å»ºç”¨æˆ·çš„æ—¶å€™æŒ‡å®š&#39;192.168.1.%&#39;ç«¯å£å·è¡¨ç¤ºç”¨æˆ·å¯ä»¥åœ¨192.168.1.*çš„ipï¼ˆè¿™ä¸ªipèŒƒå›´ä¸­ï¼‰éƒ½å¯ä»¥ç™»å½•</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.12</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token identifier"><span class="token punctuation">`</span>user<span class="token punctuation">`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>host<span class="token punctuation">`</span></span> <span class="token keyword">from</span> mysql<span class="token punctuation">.</span><span class="token keyword">user</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------------------+-------------+</span>
<span class="token operator">|</span> <span class="token keyword">user</span>             <span class="token operator">|</span> host        <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------------+-------------+</span>
<span class="token operator">|</span> eddiez           <span class="token operator">|</span> <span class="token number">192.168</span><span class="token number">.1</span><span class="token punctuation">.</span><span class="token operator">%</span> <span class="token operator">|</span>
<span class="token operator">|</span> mysql<span class="token punctuation">.</span>infoschema <span class="token operator">|</span> localhost   <span class="token operator">|</span>
<span class="token operator">|</span> mysql<span class="token punctuation">.</span><span class="token keyword">session</span>    <span class="token operator">|</span> localhost   <span class="token operator">|</span>
<span class="token operator">|</span> mysql<span class="token punctuation">.</span>sys        <span class="token operator">|</span> localhost   <span class="token operator">|</span>
<span class="token operator">|</span> root             <span class="token operator">|</span> localhost   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------------+-------------+</span>
<span class="token number">5</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">drop</span> <span class="token keyword">user</span> <span class="token string">&#39;eddiez&#39;</span><span class="token variable">@&#39;192.168.1.%&#39;</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span><span class="token comment">-- åˆ é™¤çš„ç”¨æˆ·æŒ‡æ˜äº†ç«¯å£çš„ è¦è¾“å…¥ç”¨æˆ·å®Œæ•´çš„æ ¼å¼ä¿¡æ¯æ‰èƒ½åˆ é™¤</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="mysqlæƒé™ç®¡ç†" tabindex="-1"><a class="header-anchor" href="#mysqlæƒé™ç®¡ç†" aria-hidden="true">#</a> Mysqlæƒé™ç®¡ç†</h4><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20220906135412880.png" alt="image-20220906135412880"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20220906135605307.png" alt="image-20220906135605307"></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">-- rootç”¨æˆ·ç»™å…¶ä»–ç”¨æˆ·èµ‹äºˆæƒé™</span>
<span class="token keyword">grant</span> <span class="token keyword">select</span><span class="token punctuation">,</span><span class="token keyword">insert</span> <span class="token keyword">on</span> db03<span class="token punctuation">.</span>salgrade <span class="token keyword">to</span> <span class="token string">&#39;EddieZ&#39;</span><span class="token variable">@&#39;localhost&#39;</span><span class="token punctuation">;</span>
<span class="token comment">-- grant æƒé™åˆ—è¡¨ on åº“.å¯¹è±¡å to ç”¨æˆ·å </span>

<span class="token comment">-- rootç”¨æˆ·ç»™å…¶ä»–ç”¨æˆ·å¢åŠ æƒé™</span>
<span class="token keyword">grant</span> <span class="token keyword">update</span> <span class="token keyword">on</span> db03<span class="token punctuation">.</span>salgrade <span class="token keyword">to</span> <span class="token string">&#39;EddieZ&#39;</span><span class="token variable">@&#39;localhost&#39;</span><span class="token punctuation">;</span>

<span class="token comment">-- rootç”¨æˆ·å›æ”¶å…¶ä»–ç”¨æˆ·çš„æƒé™</span>
<span class="token keyword">revoke</span> <span class="token keyword">update</span> <span class="token keyword">on</span> db03<span class="token punctuation">.</span>salgrade <span class="token keyword">from</span> <span class="token string">&#39;Eddie&#39;</span><span class="token variable">@&#39;localhost&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">revoke</span> <span class="token keyword">all</span> <span class="token keyword">on</span> db03<span class="token punctuation">.</span>salgrade <span class="token keyword">from</span> <span class="token string">&#39;Eddie&#39;</span><span class="token variable">@&#39;localhost&#39;</span><span class="token punctuation">;</span><span class="token comment">-- å›æ”¶æ‰€æœ‰æƒé™</span>
<span class="token comment">-- rootç”¨æˆ·ä¿®æ”¹å…¶ä»–ç”¨æˆ·çš„å¯†ç </span>
<span class="token keyword">set</span> password <span class="token keyword">for</span> <span class="token string">&#39;EddieZ&#39;</span><span class="token variable">@&#39;localhost&#39;</span> <span class="token operator">=</span> password<span class="token punctuation">(</span><span class="token string">&#39;newpassword&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">#test</span>
<span class="token comment">#ä½¿ç”¨ç®€å•æŸ¥è¯¢è¯­å¥</span>
<span class="token comment">-- æ˜¾ç¤ºæ‰€æœ‰éƒ¨é—¨åç§°</span>
<span class="token keyword">select</span> <span class="token keyword">distinct</span> dname <span class="token keyword">from</span> dept<span class="token punctuation">;</span>
<span class="token comment">-- æ˜¾ç¤ºæ‰€æœ‰é›‡å‘˜åä»¥åŠå…¶å…¨å¹´çš„æ”¶å…¥ 13æœˆï¼ˆå·¥èµ„åŠ è¡¥åŠ©ï¼‰æŒ‡æ˜åˆ«å å¹´æ”¶å…¥</span>
<span class="token keyword">select</span> ename<span class="token punctuation">,</span><span class="token punctuation">(</span>sal <span class="token operator">+</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>comm <span class="token operator">is</span> <span class="token boolean">null</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span>comm<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">13</span> <span class="token keyword">as</span> <span class="token string">&#39;å¹´æ”¶å…¥&#39;</span> <span class="token keyword">from</span> emp<span class="token punctuation">;</span>
<span class="token comment">#é™åˆ¶æŸ¥è¯¢è¯­å¥</span>
<span class="token comment">-- æ˜¾ç¤ºå·¥èµ„è¶…è¿‡2850çš„é›‡å‘˜çš„å§“åå’Œå·¥èµ„</span>
<span class="token keyword">select</span> ename<span class="token punctuation">,</span>sal <span class="token keyword">from</span> emp <span class="token keyword">where</span> sal <span class="token operator">&gt;</span> <span class="token number">2850</span><span class="token punctuation">;</span>
<span class="token comment">-- æ˜¾ç¤ºå·¥èµ„ä¸åœ¨1500åˆ°2850ä¹‹é—´çš„æ‰€æœ‰é›‡å‘˜ååŠå…¶å·¥èµ„</span>
<span class="token keyword">select</span> ename<span class="token punctuation">,</span>sal <span class="token keyword">from</span> emp <span class="token keyword">where</span> <span class="token operator">NOT</span> <span class="token punctuation">(</span>sal <span class="token operator">between</span> <span class="token number">1500</span> <span class="token operator">and</span> <span class="token number">2850</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- æ˜¾ç¤ºç¼–å·ä¸º7566çš„é›‡å‘˜å§“ååŠå…¶æ‰€åœ¨éƒ¨é—¨ç¼–å·</span>
<span class="token keyword">select</span> ename<span class="token punctuation">,</span>deptno <span class="token keyword">from</span> emp <span class="token keyword">where</span> empno <span class="token operator">=</span> <span class="token number">7566</span><span class="token punctuation">;</span>
<span class="token comment">-- æ˜¾ç¤ºéƒ¨é—¨10å’Œ30ä¸­å·¥èµ„è¶…è¿‡1500çš„é›‡å‘˜ååŠå·¥èµ„</span>
<span class="token keyword">select</span> ename<span class="token punctuation">,</span>sal <span class="token keyword">from</span> emp <span class="token keyword">where</span> 
<span class="token punctuation">(</span>deptno <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">or</span> deptno <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">)</span> <span class="token operator">and</span> sal <span class="token operator">&gt;=</span> <span class="token number">1500</span><span class="token punctuation">;</span>
<span class="token comment">-- æ˜¾ç¤ºæ— ç®¡ç†è€…çš„é›‡å‘˜ååŠå²—ä½</span>
<span class="token keyword">select</span> ename<span class="token punctuation">,</span>job <span class="token keyword">from</span> emp <span class="token keyword">where</span> mgr <span class="token operator">is</span> <span class="token boolean">null</span><span class="token punctuation">;</span>
<span class="token comment">#æ’åºæ•°æ®</span>
<span class="token comment">-- æ˜¾ç¤ºåœ¨1991-02-01åˆ°1991-05-01ä¹‹é—´é›‡ä½£çš„é›‡å‘˜åï¼Œå²—ä½ï¼ŒåŠé›‡ä½£æ—¥æœŸï¼Œå¹¶ä»¥é›‡ä½£æ—¥æœŸè¿›è¡Œæ’åº</span>
<span class="token keyword">select</span> ename<span class="token punctuation">,</span>job<span class="token punctuation">,</span>hiredate <span class="token keyword">from</span> emp <span class="token keyword">where</span> hiredate <span class="token operator">between</span> <span class="token string">&#39;1991-02-01&#39;</span> <span class="token operator">and</span> <span class="token string">&#39;1991-05-01&#39;</span> <span class="token keyword">order</span> <span class="token keyword">by</span> hiredate <span class="token keyword">desc</span> <span class="token punctuation">;</span>
<span class="token comment">-- æ˜¾ç¤ºè·å¾—è¡¥åŠ©çš„æ‰€æœ‰å‘˜å·¥åï¼Œå·¥èµ„åŠè¡¥åŠ© å¹¶ä»¥å·¥èµ„é™åºæ’åº</span>
<span class="token keyword">select</span> ename<span class="token punctuation">,</span>sal<span class="token punctuation">,</span>comm <span class="token keyword">from</span> emp <span class="token keyword">where</span> comm <span class="token operator">is</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">order</span> <span class="token keyword">by</span> sal <span class="token keyword">desc</span><span class="token punctuation">;</span>
<span class="token comment">#6.</span>
<span class="token comment">-- 1.</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> deptno <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>
<span class="token comment">-- 2.</span>
<span class="token keyword">select</span> ename<span class="token punctuation">,</span>empno<span class="token punctuation">,</span>deptno <span class="token keyword">from</span> emp <span class="token keyword">where</span> job <span class="token operator">=</span> <span class="token string">&#39;clerk&#39;</span><span class="token punctuation">;</span>
<span class="token comment">-- 3.</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> comm <span class="token operator">&gt;</span> sal<span class="token punctuation">;</span>
<span class="token comment">-- 4.</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> comm <span class="token operator">&gt;</span> <span class="token punctuation">(</span>sal<span class="token operator">*</span><span class="token number">0.6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- 5.</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> <span class="token punctuation">(</span>deptno <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">and</span> job <span class="token operator">=</span> <span class="token string">&#39;manager&#39;</span><span class="token punctuation">)</span> <span class="token operator">or</span> <span class="token punctuation">(</span>deptno <span class="token operator">=</span> <span class="token number">20</span> <span class="token operator">and</span> job <span class="token operator">=</span> <span class="token string">&#39;clerk&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- 6.</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> <span class="token punctuation">(</span>deptno <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">and</span> job <span class="token operator">=</span> <span class="token string">&#39;manager&#39;</span><span class="token punctuation">)</span> <span class="token operator">or</span> <span class="token punctuation">(</span>deptno <span class="token operator">=</span> <span class="token number">20</span> <span class="token operator">and</span> job <span class="token operator">=</span> <span class="token string">&#39;clerk&#39;</span><span class="token punctuation">)</span> <span class="token operator">or</span> <span class="token punctuation">(</span>job <span class="token operator">&lt;&gt;</span> <span class="token string">&#39;manager&#39;</span> <span class="token operator">and</span> job <span class="token operator">&lt;&gt;</span> <span class="token string">&#39;clerk&#39;</span> <span class="token operator">and</span> sal <span class="token operator">&gt;=</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- 7.</span>
<span class="token keyword">select</span> <span class="token keyword">distinct</span> job <span class="token keyword">from</span> emp <span class="token keyword">where</span> comm <span class="token operator">is</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">;</span>
<span class="token comment">-- 8.</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> comm <span class="token operator">is</span> <span class="token boolean">null</span> <span class="token operator">or</span> comm <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span>
<span class="token comment">-- 9.</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> DATEDIFF<span class="token punctuation">(</span>LAST_DAY<span class="token punctuation">(</span>hiredate<span class="token punctuation">)</span><span class="token punctuation">,</span>hiredate<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token comment">-- 10.</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> DATE_ADD<span class="token punctuation">(</span>hiredate<span class="token punctuation">,</span><span class="token keyword">interval</span> <span class="token number">31</span> <span class="token keyword">YEAR</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- 11.</span>
<span class="token keyword">select</span> CONCAT<span class="token punctuation">(</span><span class="token function">LCASE</span><span class="token punctuation">(</span><span class="token function">MID</span><span class="token punctuation">(</span>ename<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token function">MID</span><span class="token punctuation">(</span>ename<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">from</span> emp<span class="token punctuation">;</span>
<span class="token comment">-- 12.</span>
<span class="token keyword">select</span> ename <span class="token keyword">from</span> emp <span class="token keyword">where</span> LENGTH<span class="token punctuation">(</span>ename<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
<span class="token comment">-- 13.</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> ename <span class="token operator">not</span> <span class="token operator">like</span> <span class="token string">&#39;%R%&#39;</span><span class="token punctuation">;</span>
<span class="token comment">-- 14.</span>
<span class="token keyword">select</span> <span class="token function">MID</span><span class="token punctuation">(</span>ename<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token keyword">from</span> emp<span class="token punctuation">;</span>
<span class="token comment">-- 15.</span>
<span class="token keyword">select</span> <span class="token keyword">REPLACE</span><span class="token punctuation">(</span>ename<span class="token punctuation">,</span><span class="token string">&#39;A&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;a&#39;</span><span class="token punctuation">)</span> <span class="token keyword">from</span> emp<span class="token punctuation">;</span>
<span class="token comment">-- 16.</span>
<span class="token keyword">select</span> ename<span class="token punctuation">,</span>hiredate <span class="token keyword">from</span> emp <span class="token keyword">where</span> DATE_ADD<span class="token punctuation">(</span>hiredate<span class="token punctuation">,</span><span class="token keyword">INTERVAL</span> <span class="token number">12</span> <span class="token keyword">year</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- 17.</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> ename <span class="token keyword">DESC</span><span class="token punctuation">;</span>
<span class="token comment">-- 18.</span>
<span class="token keyword">select</span> ename<span class="token punctuation">,</span>hiredate <span class="token keyword">from</span> emp <span class="token keyword">order</span> <span class="token keyword">by</span> hiredate <span class="token keyword">asc</span><span class="token punctuation">;</span>
<span class="token comment">-- 19.</span>
<span class="token keyword">select</span> ename<span class="token punctuation">,</span>job<span class="token punctuation">,</span>sal <span class="token keyword">from</span> emp <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> job <span class="token keyword">desc</span> <span class="token punctuation">,</span> sal <span class="token keyword">asc</span><span class="token punctuation">;</span>
<span class="token comment">-- 20.</span>
<span class="token keyword">select</span> ename<span class="token punctuation">,</span><span class="token keyword">YEAR</span><span class="token punctuation">(</span>hiredate<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">MONTH</span><span class="token punctuation">(</span>hiredate<span class="token punctuation">)</span><span class="token punctuation">,</span>hiredate <span class="token keyword">from</span> emp <span class="token keyword">order</span> <span class="token keyword">by</span> <span class="token keyword">MONTH</span><span class="token punctuation">(</span>hiredate<span class="token punctuation">)</span> <span class="token punctuation">,</span> <span class="token keyword">DAY</span><span class="token punctuation">(</span>hiredate<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- 21.</span>
<span class="token keyword">select</span> <span class="token keyword">TRUNCATE</span><span class="token punctuation">(</span>sal<span class="token operator">/</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">&#39;æ—¥è–ªèµ„&#39;</span> <span class="token keyword">from</span> emp<span class="token punctuation">;</span>
<span class="token comment">-- 22.</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> <span class="token keyword">MONTH</span><span class="token punctuation">(</span>hiredate<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token comment">-- 23.</span>
<span class="token keyword">select</span> DATEDIFF<span class="token punctuation">(</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>hiredate<span class="token punctuation">)</span> <span class="token keyword">from</span> emp<span class="token punctuation">;</span>
<span class="token comment">-- 24.</span>
<span class="token keyword">select</span> ename <span class="token keyword">from</span> emp <span class="token keyword">where</span> ename <span class="token operator">like</span> <span class="token string">&#39;%A%&#39;</span><span class="token punctuation">;</span>
<span class="token comment">-- 25.</span>
<span class="token keyword">select</span> ename<span class="token punctuation">,</span>CONCAT<span class="token punctuation">(</span><span class="token string">&#39;å·²å…¥èŒ:&#39;</span><span class="token punctuation">,</span><span class="token keyword">TRUNCATE</span><span class="token punctuation">(</span><span class="token punctuation">(</span>DATEDIFF<span class="token punctuation">(</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>hiredate<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">365</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&#39;å¹´&#39;</span><span class="token punctuation">,</span><span class="token keyword">TRUNCATE</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">TRUNCATE</span><span class="token punctuation">(</span><span class="token punctuation">(</span>DATEDIFF<span class="token punctuation">(</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>hiredate<span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">365</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&#39;æœˆ&#39;</span><span class="token punctuation">,</span>
<span class="token keyword">TRUNCATE</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">TRUNCATE</span><span class="token punctuation">(</span><span class="token punctuation">(</span>DATEDIFF<span class="token punctuation">(</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>hiredate<span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">365</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&#39;å¤©&#39;</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token string">&#39;å…¥èŒå¹´é™&#39;</span> <span class="token keyword">from</span> emp<span class="token punctuation">;</span>
<span class="token comment">#7</span>
<span class="token comment">-- 1.</span>
<span class="token keyword">select</span> <span class="token keyword">distinct</span> emp<span class="token punctuation">.</span>deptno <span class="token keyword">from</span> emp<span class="token punctuation">,</span>dept <span class="token keyword">where</span> emp<span class="token punctuation">.</span>deptno <span class="token operator">=</span> dept<span class="token punctuation">.</span>deptno<span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">&#39;num&#39;</span><span class="token punctuation">,</span>deptno <span class="token keyword">from</span> emp <span class="token keyword">group</span> <span class="token keyword">by</span> deptno <span class="token keyword">HAVING</span> num <span class="token operator">&gt;=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token comment">-- 2.</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> sal <span class="token operator">&gt;</span> <span class="token punctuation">(</span><span class="token keyword">select</span> sal <span class="token keyword">from</span> emp <span class="token keyword">where</span> ename <span class="token operator">=</span> <span class="token string">&#39;SMITH&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- 3.-- æŠŠä¸€å¼ è¡¨çœ‹ä½œæ˜¯ä¸¤å¼ è¡¨æ¥å¤„ç†</span>
<span class="token keyword">select</span> worker<span class="token punctuation">.</span>ename <span class="token keyword">as</span> <span class="token string">&#39;å‘˜å·¥å&#39;</span><span class="token punctuation">,</span>worker<span class="token punctuation">.</span>hiredate <span class="token keyword">as</span> <span class="token string">&#39;å‘˜å·¥å…¥èŒæ—¶é—´&#39;</span><span class="token punctuation">,</span>leader<span class="token punctuation">.</span>ename <span class="token keyword">as</span> <span class="token string">&#39;ç›´æ¥ä¸Šçº§å&#39;</span><span class="token punctuation">,</span>leader<span class="token punctuation">.</span>hiredate <span class="token keyword">as</span> <span class="token string">&#39;ä¸Šçº§å…¥èŒæ—¶é—´&#39;</span>
			<span class="token keyword">from</span> emp <span class="token keyword">as</span> worker<span class="token punctuation">,</span>emp <span class="token keyword">as</span> leader
			<span class="token keyword">where</span> worker<span class="token punctuation">.</span>hiredate <span class="token operator">&gt;</span> leader<span class="token punctuation">.</span>hiredate <span class="token operator">and</span> worker<span class="token punctuation">.</span>mgr <span class="token operator">=</span> leader<span class="token punctuation">.</span>empno<span class="token punctuation">;</span>
<span class="token comment">-- 4.-- ä½¿ç”¨å¤–è¿æ¥</span>
<span class="token keyword">select</span> dept<span class="token punctuation">.</span>dname<span class="token punctuation">,</span>emp<span class="token punctuation">.</span><span class="token operator">*</span>
			<span class="token keyword">from</span> dept <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> emp <span class="token keyword">on</span> dept<span class="token punctuation">.</span>deptno <span class="token operator">=</span> emp<span class="token punctuation">.</span>deptno<span class="token punctuation">;</span>
<span class="token comment">-- 5.</span>
<span class="token keyword">select</span> emp<span class="token punctuation">.</span>ename<span class="token punctuation">,</span>dept<span class="token punctuation">.</span>dname
			<span class="token keyword">from</span> emp<span class="token punctuation">,</span>dept <span class="token keyword">where</span> job <span class="token operator">=</span> <span class="token string">&#39;clerk&#39;</span> <span class="token operator">and</span> emp<span class="token punctuation">.</span>deptno <span class="token operator">=</span> dept<span class="token punctuation">.</span>deptno<span class="token punctuation">;</span>
<span class="token comment">-- 6.</span>
<span class="token keyword">select</span> <span class="token keyword">distinct</span> job <span class="token keyword">from</span> emp <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> job <span class="token keyword">HAVING</span> <span class="token function">min</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1500</span><span class="token punctuation">;</span>
<span class="token comment">-- 7.</span>
<span class="token keyword">select</span> ename <span class="token keyword">from</span> emp <span class="token keyword">where</span> deptno <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>
<span class="token comment">-- 8.</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> sal <span class="token operator">&gt;</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token function">avg</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span> <span class="token keyword">from</span> emp<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">#7</span>
<span class="token comment">-- 9.</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> job <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">select</span> job <span class="token keyword">from</span> emp <span class="token keyword">where</span> ename <span class="token operator">=</span> <span class="token string">&#39;SCOTT&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- 10.</span>
<span class="token keyword">select</span> ename<span class="token punctuation">,</span>sal <span class="token keyword">from</span> emp <span class="token keyword">where</span> sal <span class="token operator">&gt;</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token function">max</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> deptno <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- 11.</span>
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">&#39;éƒ¨é—¨äººæ•°&#39;</span><span class="token punctuation">,</span><span class="token function">avg</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">&#39;å¹³å‡å·¥èµ„&#39;</span><span class="token punctuation">,</span><span class="token function">FORMAT</span><span class="token punctuation">(</span><span class="token function">avg</span><span class="token punctuation">(</span>DATEDIFF<span class="token punctuation">(</span><span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>hiredate<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">356</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">&#39;å¹³å‡æœåŠ¡æœŸé™ï¼ˆå•ä½å¹´ï¼‰&#39;</span> <span class="token keyword">from</span> emp <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> deptno<span class="token punctuation">;</span>
<span class="token comment">-- 12.</span>
<span class="token keyword">select</span> emp<span class="token punctuation">.</span>ename<span class="token punctuation">,</span>dept<span class="token punctuation">.</span>dname<span class="token punctuation">,</span>emp<span class="token punctuation">.</span>sal
      <span class="token keyword">from</span> emp<span class="token punctuation">,</span>dept
			<span class="token keyword">where</span> emp<span class="token punctuation">.</span>deptno <span class="token operator">=</span> dept<span class="token punctuation">.</span>deptno<span class="token punctuation">;</span>
<span class="token comment">-- 13.</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> dept<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">&#39;éƒ¨é—¨äººæ•°&#39;</span><span class="token punctuation">,</span>deptno <span class="token keyword">from</span> emp <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> deptno<span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token keyword">temp</span> <span class="token keyword">where</span> <span class="token keyword">temp</span><span class="token punctuation">.</span>deptno <span class="token operator">=</span> dept<span class="token punctuation">.</span>deptno<span class="token punctuation">;</span>
<span class="token comment">-- 14.</span>
<span class="token keyword">select</span> job<span class="token punctuation">,</span><span class="token function">min</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">&#39;æœ€ä½å·¥èµ„&#39;</span> <span class="token keyword">from</span> emp <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> job<span class="token punctuation">;</span>
<span class="token comment">-- 15.</span>
<span class="token keyword">select</span> <span class="token function">min</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">&#39;managerçš„æœ€ä½å·¥èµ„&#39;</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> job <span class="token operator">=</span> <span class="token string">&#39;manager&#39;</span><span class="token punctuation">;</span>
<span class="token comment">-- 16.</span>
<span class="token keyword">select</span> ename<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">(</span>sal <span class="token operator">+</span> IFNULL<span class="token punctuation">(</span>comm<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">13</span><span class="token punctuation">)</span> <span class="token keyword">as</span> yearsal <span class="token keyword">from</span> emp <span class="token keyword">order</span> <span class="token keyword">by</span> yearsal <span class="token keyword">desc</span><span class="token punctuation">;</span>

<span class="token comment">#8</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> <span class="token identifier"><span class="token punctuation">`</span>class<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
classid <span class="token keyword">int</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> <span class="token number">0</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>subject<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>deptname<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span>
enrolltime <span class="token keyword">date</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> <span class="token string">&#39;2000-01-01&#39;</span><span class="token punctuation">)</span><span class="token keyword">character</span> <span class="token keyword">set</span> utf8 <span class="token keyword">collate</span> utf8_bin <span class="token keyword">engine</span> <span class="token keyword">innodb</span><span class="token punctuation">;</span>
<span class="token keyword">desc</span> class<span class="token punctuation">;</span>
<span class="token keyword">alter</span> <span class="token keyword">table</span> class <span class="token keyword">modify</span> enrolltime <span class="token keyword">YEAR</span><span class="token punctuation">;</span>
<span class="token keyword">alter</span> <span class="token keyword">table</span> class <span class="token keyword">add</span> num <span class="token keyword">tinyint</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">desc</span> class<span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> class <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token string">&#39;è½¯ä»¶&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;è®¡ç®—æœº&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;1995&#39;</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">102</span><span class="token punctuation">,</span><span class="token string">&#39;å¾®ç”µå­&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;è®¡ç®—æœº&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;1996&#39;</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">111</span><span class="token punctuation">,</span><span class="token string">&#39;æ— æœºåŒ–å­¦&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;åŒ–å­¦&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;1995&#39;</span><span class="token punctuation">,</span><span class="token number">29</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">112</span><span class="token punctuation">,</span><span class="token string">&#39;é«˜åˆ†å­åŒ–å­¦&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;åŒ–å­¦&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;1996&#39;</span><span class="token punctuation">,</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">121</span><span class="token punctuation">,</span><span class="token string">&#39;ç»Ÿè®¡æ•°å­¦&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;æ•°å­¦&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;1995&#39;</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">131</span><span class="token punctuation">,</span><span class="token string">&#39;ç°ä»£è¯­è¨€&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;ä¸­æ–‡&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;1996&#39;</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">141</span><span class="token punctuation">,</span><span class="token string">&#39;å›½é™…è´¸æ˜“&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;ç»æµ&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;1997&#39;</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">142</span><span class="token punctuation">,</span><span class="token string">&#39;å›½é™…é‡‘è&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;ç»æµ&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;1996&#39;</span><span class="token punctuation">,</span><span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> class<span class="token punctuation">;</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> <span class="token identifier"><span class="token punctuation">`</span>student_table<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
<span class="token identifier"><span class="token punctuation">`</span>studentid<span class="token punctuation">`</span></span> <span class="token keyword">int</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> <span class="token number">0</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>age<span class="token punctuation">`</span></span> <span class="token keyword">tinyint</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> <span class="token number">0</span><span class="token punctuation">,</span>
classid <span class="token keyword">int</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> <span class="token number">0</span><span class="token punctuation">,</span>
<span class="token keyword">constraint</span> fk_classid <span class="token keyword">foreign</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>classid<span class="token punctuation">)</span> <span class="token keyword">references</span> class <span class="token punctuation">(</span>classid<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">character</span> <span class="token keyword">set</span> utf8 <span class="token keyword">collate</span> utf8_bin <span class="token keyword">engine</span> <span class="token keyword">innodb</span><span class="token punctuation">;</span>
<span class="token keyword">desc</span> student_table<span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> student_table <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token number">8101</span><span class="token punctuation">,</span><span class="token string">&#39;å¼ ä¸‰&#39;</span><span class="token punctuation">,</span><span class="token number">18</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">8102</span><span class="token punctuation">,</span><span class="token string">&#39;é’±å››&#39;</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">121</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">8103</span><span class="token punctuation">,</span><span class="token string">&#39;ç‰ç²&#39;</span><span class="token punctuation">,</span><span class="token number">17</span><span class="token punctuation">,</span><span class="token number">131</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">8105</span><span class="token punctuation">,</span><span class="token string">&#39;æé£&#39;</span><span class="token punctuation">,</span><span class="token number">19</span><span class="token punctuation">,</span><span class="token number">102</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">8109</span><span class="token punctuation">,</span><span class="token string">&#39;èµµå››&#39;</span><span class="token punctuation">,</span><span class="token number">18</span><span class="token punctuation">,</span><span class="token number">141</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">8110</span><span class="token punctuation">,</span><span class="token string">&#39;æå¯&#39;</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">142</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">8201</span><span class="token punctuation">,</span><span class="token string">&#39;å¼ é£&#39;</span><span class="token punctuation">,</span><span class="token number">18</span><span class="token punctuation">,</span><span class="token number">111</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">8302</span><span class="token punctuation">,</span><span class="token string">&#39;å‘¨ç‘œ&#39;</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">112</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">8303</span><span class="token punctuation">,</span><span class="token string">&#39;ç‹äº®&#39;</span><span class="token punctuation">,</span><span class="token number">17</span><span class="token punctuation">,</span><span class="token number">111</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">8305</span><span class="token punctuation">,</span><span class="token string">&#39;è‘£åº†&#39;</span><span class="token punctuation">,</span><span class="token number">19</span><span class="token punctuation">,</span><span class="token number">102</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">8409</span><span class="token punctuation">,</span><span class="token string">&#39;èµµé¾™&#39;</span><span class="token punctuation">,</span><span class="token number">18</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">8510</span><span class="token punctuation">,</span><span class="token string">&#39;æä¸½&#39;</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">142</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> student_table<span class="token punctuation">;</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> <span class="token identifier"><span class="token punctuation">`</span>department<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
departmentid <span class="token keyword">int</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> <span class="token number">0</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span>deptname <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span>
<span class="token keyword">constraint</span> <span class="token keyword">unique</span> <span class="token punctuation">(</span>deptname<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">character</span> <span class="token keyword">set</span> utf8 <span class="token keyword">collate</span> utf8_bin <span class="token keyword">engine</span> <span class="token keyword">innodb</span><span class="token punctuation">;</span>
<span class="token keyword">desc</span> department<span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> department <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token number">001</span><span class="token punctuation">,</span><span class="token string">&#39;æ•°å­¦&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">002</span><span class="token punctuation">,</span><span class="token string">&#39;è®¡ç®—æœº&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">003</span><span class="token punctuation">,</span><span class="token string">&#39;åŒ–å­¦&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">004</span><span class="token punctuation">,</span><span class="token string">&#39;ä¸­æ–‡&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">005</span><span class="token punctuation">,</span><span class="token string">&#39;ç»æµ&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> department<span class="token punctuation">;</span>

<span class="token comment">#test</span>
<span class="token comment">-- 1.</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> student_table <span class="token keyword">where</span> name <span class="token operator">like</span> <span class="token string">&#39;æ%&#39;</span><span class="token punctuation">;</span>
<span class="token comment">-- 2.</span>
<span class="token keyword">select</span> <span class="token keyword">distinct</span> class<span class="token punctuation">.</span>deptname <span class="token keyword">from</span> class<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span> deptname<span class="token punctuation">,</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">as</span> num <span class="token keyword">from</span> class <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> deptname<span class="token punctuation">)</span> <span class="token keyword">as</span> temp_table <span class="token keyword">where</span> temp_table<span class="token punctuation">.</span>num <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token operator">and</span> 
temp_table<span class="token punctuation">.</span>deptname <span class="token operator">=</span> class<span class="token punctuation">.</span>deptname<span class="token punctuation">;</span>
<span class="token comment">-- 3.</span>
<span class="token keyword">select</span> <span class="token keyword">distinct</span> department<span class="token punctuation">.</span>departmentid<span class="token punctuation">,</span>department<span class="token punctuation">.</span>deptname<span class="token punctuation">,</span>temp_table1<span class="token punctuation">.</span>sum
			<span class="token keyword">from</span> department<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span> class<span class="token punctuation">.</span>deptname<span class="token punctuation">,</span><span class="token function">sum</span><span class="token punctuation">(</span>class<span class="token punctuation">.</span>num<span class="token punctuation">)</span> <span class="token keyword">as</span> sum <span class="token keyword">from</span> class <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> deptname<span class="token punctuation">)</span> <span class="token keyword">as</span> temp_table1 <span class="token keyword">where</span> department<span class="token punctuation">.</span>deptname <span class="token operator">=</span> temp_table1<span class="token punctuation">.</span>deptname <span class="token operator">and</span> temp_table1<span class="token punctuation">.</span>sum <span class="token operator">&gt;=</span> <span class="token number">30</span><span class="token punctuation">;</span>
<span class="token comment">-- 4.</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> department <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token number">006</span><span class="token punctuation">,</span><span class="token string">&#39;ç‰©ç†&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> department<span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> class<span class="token punctuation">;</span>
<span class="token comment">-- 5.-- ä½¿ç”¨äº‹åŠ¡</span>
<span class="token comment">-- å¼€å¯äº‹åŠ¡</span>
<span class="token keyword">start</span> <span class="token keyword">transaction</span><span class="token punctuation">;</span>
<span class="token comment">-- è¿›è¡Œæ“ä½œ</span>

<span class="token keyword">update</span> class <span class="token keyword">set</span> num <span class="token operator">=</span> <span class="token punctuation">(</span>num <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">where</span> classid <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">select</span> student_table<span class="token punctuation">.</span>classid <span class="token keyword">from</span> student_table <span class="token keyword">where</span> student_table<span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span> <span class="token operator">=</span> <span class="token string">&#39;å¼ ä¸‰&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">-- å°†ç­è¡¨ä¸­çš„äººæ•°å˜æ›´</span>
<span class="token keyword">delete</span> <span class="token keyword">from</span> student_table <span class="token keyword">where</span> student_table<span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span> <span class="token operator">=</span> <span class="token string">&#39;å¼ ä¸‰&#39;</span><span class="token punctuation">;</span><span class="token comment">-- ä»å­¦ç”Ÿè¡¨ä¸­åˆ é™¤</span>
<span class="token comment">-- ç¡®è®¤æ— è¯¯ æäº¤äº‹åŠ¡</span>
<span class="token keyword">commit</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> class<span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> student_table<span class="token punctuation">;</span>



<span class="token comment">-- æŠŠç³»è¡¨ä¸­çš„idç±»å‹æ”¹ä¸ºvarchar(10)</span>
<span class="token keyword">delete</span> <span class="token keyword">from</span> department<span class="token punctuation">;</span>
<span class="token keyword">alter</span> <span class="token keyword">table</span> department <span class="token keyword">MODIFY</span> departmentid <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> department <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token string">&#39;001&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;æ•°å­¦&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">&#39;002&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;è®¡ç®—æœº&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">&#39;003&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;åŒ–å­¦&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">&#39;004&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;ä¸­æ–‡&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">&#39;005&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;ç»æµ&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> department <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token string">&#39;006&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;ç‰©ç†&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">desc</span> department<span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> department<span class="token punctuation">;</span>
			



</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="mysqlç³»ç»Ÿå˜é‡æŸ¥è¯¢" tabindex="-1"><a class="header-anchor" href="#mysqlç³»ç»Ÿå˜é‡æŸ¥è¯¢" aria-hidden="true">#</a> Mysqlç³»ç»Ÿå˜é‡æŸ¥è¯¢</h2><p>åœ¨ MySQL æ•°æ®åº“ï¼Œå˜é‡åˆ†ä¸º<strong>ç³»ç»Ÿå˜é‡</strong>å’Œ<strong>ç”¨æˆ·è‡ªå®šä¹‰å˜é‡</strong>ã€‚</p><p><strong>ç³»ç»Ÿå˜é‡ä»¥ @@ å¼€å¤´</strong>ï¼Œ</p><ul><li>@@global ä»…ä»…ç”¨äºæ ‡è®°å…¨å±€å˜é‡ï¼›</li><li>@@session ä»…ä»…ç”¨äºæ ‡è®°ä¼šè¯å˜é‡ï¼›</li><li>@@ é¦–å…ˆæ ‡è®°ä¼šè¯å˜é‡ï¼Œå¦‚æœä¼šè¯å˜é‡ä¸å­˜åœ¨ï¼Œåˆ™æ ‡è®°å…¨å±€å˜é‡ã€‚</li></ul><p><strong>ç”¨æˆ·è‡ªå®šä¹‰å˜é‡ä»¥ @ å¼€å¤´</strong>ã€‚</p><p>æœåŠ¡å™¨ç»´æŠ¤ç€ä¸¤ç§ç³»ç»Ÿå˜é‡ï¼Œå³</p><p><strong>å…¨å±€å˜é‡ï¼ˆGLOBAL VARIABLESï¼‰<strong>å’Œ</strong>ä¼šè¯å˜é‡ï¼ˆSESSION VARIABLESï¼‰</strong>ã€‚</p><p>å…¨å±€å˜é‡å½±å“ MySQL æœåŠ¡çš„æ•´ä½“è¿è¡Œæ–¹å¼ï¼Œä¼šè¯å˜é‡å½±å“å…·ä½“å®¢æˆ·ç«¯è¿æ¥çš„æ“ä½œã€‚</p><p>æ¯ä¸€ä¸ªå®¢æˆ·ç«¯æˆåŠŸè¿æ¥æœåŠ¡å™¨åï¼Œéƒ½ä¼šäº§ç”Ÿä¸ä¹‹å¯¹åº”çš„ä¼šè¯ã€‚ä¼šè¯æœŸé—´ï¼ŒMySQL æœåŠ¡å®ä¾‹ä¼šåœ¨æœåŠ¡å™¨å†…å­˜ä¸­ç”Ÿæˆä¸è¯¥ä¼šè¯å¯¹åº”çš„ä¼šè¯å˜é‡ï¼Œè¿™äº›ä¼šè¯å˜é‡çš„åˆå§‹å€¼æ˜¯å…¨å±€å˜é‡å€¼çš„æ‹·è´ã€‚</p><h3 id="æŸ¥è¯¢è®¾ç½®å…¨å±€å˜é‡-show-global-variables-g" tabindex="-1"><a class="header-anchor" href="#æŸ¥è¯¢è®¾ç½®å…¨å±€å˜é‡-show-global-variables-g" aria-hidden="true">#</a> æŸ¥è¯¢è®¾ç½®å…¨å±€å˜é‡ï¼šshow global variables \G;</h3><p><strong>æ²¡æœ‰æŒ‡å®š</strong>ä¿®æ”¹å…¨å±€å˜é‡è¿˜æ˜¯ä¼šè¯å˜é‡ï¼Œ<strong>æœåŠ¡å™¨ä¼šå½“ä½œä¼šè¯å˜é‡</strong>æ¥<strong>å¤„ç†</strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SHOW</span> <span class="token keyword">GLOBAL</span> VARIABLES<span class="token punctuation">;</span> 
<span class="token keyword">SHOW</span> <span class="token keyword">GLOBAL</span> VARIABLES <span class="token operator">LIKE</span> <span class="token string">&#39;innodb_data_file_path&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">SHOW</span> <span class="token keyword">GLOBAL</span> VARIABLES <span class="token operator">LIKE</span> <span class="token string">&#39;character_set_client&#39;</span><span class="token punctuation">;</span>


<span class="token keyword">SET</span> @<span class="token variable">@global.innodb_file_per_table</span><span class="token operator">=</span><span class="token keyword">default</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> @<span class="token variable">@global.innodb_file_per_table</span><span class="token operator">=</span><span class="token keyword">ON</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> <span class="token keyword">global</span> innodb_file_per_table<span class="token operator">=</span><span class="token keyword">ON</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æŸ¥è¯¢è®¾ç½®ä¼šè¯å˜é‡-show-session-variables-g-æˆ–show-variables" tabindex="-1"><a class="header-anchor" href="#æŸ¥è¯¢è®¾ç½®ä¼šè¯å˜é‡-show-session-variables-g-æˆ–show-variables" aria-hidden="true">#</a> æŸ¥è¯¢è®¾ç½®ä¼šè¯å˜é‡ï¼šshow session variables \G;æˆ–show variablesï¼›</h3><p><strong>æ²¡æœ‰æŒ‡å®š</strong>ä¿®æ”¹å…¨å±€å˜é‡è¿˜æ˜¯ä¼šè¯å˜é‡ï¼Œ<strong>æœåŠ¡å™¨ä¼šå½“ä½œä¼šè¯å˜é‡</strong>æ¥<strong>å¤„ç†</strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SHOW</span> <span class="token keyword">SESSION</span> VARIABLES <span class="token operator">LIKE</span> <span class="token string">&#39;character_set_client&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">SHOW</span> VARIABLES <span class="token operator">LIKE</span> <span class="token string">&#39;character_set_client&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">SHOW</span> <span class="token keyword">SESSION</span> VARIABLES <span class="token operator">LIKE</span> <span class="token string">&#39;pseudo_thread_id&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">SHOW</span> <span class="token keyword">SESSION</span> VARIABLES <span class="token operator">LIKE</span> <span class="token string">&#39;innodb_data_file_path&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">SHOW</span> VARIABLES <span class="token operator">LIKE</span> <span class="token string">&#39;innodb_data_file_path&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">SHOW</span> <span class="token keyword">SESSION</span> VARIABLES<span class="token punctuation">;</span>


<span class="token keyword">SET</span> @<span class="token variable">@session.pseudo_thread_id</span><span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> <span class="token keyword">session</span> pseudo_thread_id<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> @<span class="token variable">@pseudo_thread_id</span><span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> pseudo_thread_id <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> @<span class="token variable">@sort_buffer_size</span> <span class="token operator">=</span> <span class="token number">50000</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="most-popular-mysql-commands" tabindex="-1"><a class="header-anchor" href="#most-popular-mysql-commands" aria-hidden="true">#</a> Most Popular MySQL Commands</h2><h3 id="crud" tabindex="-1"><a class="header-anchor" href="#crud" aria-hidden="true">#</a> CRUD</h3><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> employee<span class="token punctuation">(</span>ID <span class="token keyword">INT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span> First_Name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Last_Name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Salary <span class="token keyword">INT</span><span class="token punctuation">,</span> Email_Id <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> Table_Name <span class="token punctuation">(</span>ColumnName1<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> ColumnNameN<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token keyword">Value</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token keyword">Value</span> N<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">Value</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token keyword">Value</span> N<span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> TableName <span class="token keyword">WHERE</span> CONDITION<span class="token punctuation">;</span>

<span class="token keyword">UPDATE</span> Table_Name <span class="token keyword">SET</span> ColumnName <span class="token operator">=</span> <span class="token keyword">Value</span> <span class="token keyword">WHERE</span> CONDITION<span class="token punctuation">;</span>

<span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> TableName <span class="token keyword">WHERE</span> CONDITION<span class="token punctuation">;</span>  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="reset-autoincrement-primary-id" tabindex="-1"><a class="header-anchor" href="#reset-autoincrement-primary-id" aria-hidden="true">#</a> Reset AutoIncrement_Primary_Id</h3><blockquote><p><strong>Solve</strong> the problem that <strong>the primary key id is not continuous</strong></p></blockquote><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>set @rownum = 0;
update tableName set IncreaseId= @rownum := @rownum+1;

alter table tableName auto_increment = 1;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="users-management-commands" tabindex="-1"><a class="header-anchor" href="#users-management-commands" aria-hidden="true">#</a> Users Management Commands</h3><ul><li>CREATE USER</li><li>DROP USER</li><li>SHOW USER</li></ul><h4 id="_1-create-user" tabindex="-1"><a class="header-anchor" href="#_1-create-user" aria-hidden="true">#</a> 1. CREATE USER</h4><p>With the help of this command, you can create users in the database server.</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">USER</span> AccountName IDENTIFIED <span class="token keyword">BY</span> <span class="token string">&#39;PASSWORD&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Example:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">USER</span> SahitiKappagantula IDENTIFIED <span class="token keyword">BY</span> <span class="token string">&#39;InfoEdge@123&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="_2-drop-user" tabindex="-1"><a class="header-anchor" href="#_2-drop-user" aria-hidden="true">#</a> 2. DROP USER</h4><p>Used to delete a user from the database server permanently.</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">DROP</span> <span class="token keyword">USER</span> AccountName<span class="token punctuation">;</span>  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Example:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">DROP</span> <span class="token keyword">USER</span> SahitiKappagantula<span class="token punctuation">;</span>  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="_3-show-user" tabindex="-1"><a class="header-anchor" href="#_3-show-user" aria-hidden="true">#</a> 3. SHOW USER</h4><p>Used to display the list of users having access to a particular database server.</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token keyword">USER</span> <span class="token keyword">from</span> MYSQL<span class="token punctuation">.</span>DATABASENAME<span class="token punctuation">;</span>   
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Example:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token keyword">USER</span> <span class="token keyword">from</span> MYSQL<span class="token punctuation">.</span>Patients<span class="token punctuation">;</span>   
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="database-management-commands" tabindex="-1"><a class="header-anchor" href="#database-management-commands" aria-hidden="true">#</a> Database Management Commands</h3><p>Database management commands are those commands which are used to create a database and view them. The commands are:</p><ul><li>CREATE DATABASE</li><li>SHOW DATABASE</li><li>DROP DATABASE</li><li>USE DATABASE</li></ul><h4 id="_4-create-database" tabindex="-1"><a class="header-anchor" href="#_4-create-database" aria-hidden="true">#</a> 4. CREATE DATABASE</h4><p>Used to create a database.</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">SCHEMA</span> SchemaName<span class="token punctuation">;</span>
 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>Example:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">SCHEMA</span> PatientsDatabase<span class="token punctuation">;</span>
 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-show-database" tabindex="-1"><a class="header-anchor" href="#_5-show-database" aria-hidden="true">#</a> 5. SHOW DATABASE</h4><p>Used to list all the databases created till date.</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SHOW</span> <span class="token keyword">DATABASES</span><span class="token punctuation">;</span>
<span class="token operator">-</span>â€“<span class="token operator">OR</span>
<span class="token keyword">SHOW</span> SCHEMAS<span class="token punctuation">;</span>
 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Example:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SHOW</span> <span class="token keyword">DATABASES</span><span class="token punctuation">;</span>
 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_6-drop-database" tabindex="-1"><a class="header-anchor" href="#_6-drop-database" aria-hidden="true">#</a> 6. DROP DATABASE</h4><p>Used to delete a database along with the data present in the database.</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">DROP</span> <span class="token keyword">SCHEMA</span> SchemaName<span class="token punctuation">;</span>
â€“<span class="token operator">OR</span>
<span class="token keyword">DROP</span> <span class="token keyword">DATABASE</span> DatabaseName<span class="token punctuation">;</span>
 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Example:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">DROP</span> <span class="token keyword">SCHEMA</span> PatientsDatabase<span class="token punctuation">;</span>
 
<span class="token keyword">DROP</span> <span class="token keyword">DATABASE</span> PatientsDatabase<span class="token punctuation">;</span>
 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_7-use-database" tabindex="-1"><a class="header-anchor" href="#_7-use-database" aria-hidden="true">#</a> 7. USE DATABASE</h4><p>Used by the clients to inform which database to be chosen to perform all data manipulation tasks.</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">USE</span> SchemaName<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Example:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">USE</span> PatientsDatabase<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="table-commands" tabindex="-1"><a class="header-anchor" href="#table-commands" aria-hidden="true">#</a> Table Commands</h3><p>In this section of commands, let us understand the various commands used to create tables and manipulate data in the tables. The following commands will be discussed here:</p><ul><li>CREATE TABLE</li><li>SHOW TABLE</li><li>ALTER TABLE</li><li>DESCRIBE TABLE</li><li>TRUNCATE TABLE</li><li>DROP TABLE</li><li>RENAME TABLE</li><li>INSERT INTO</li><li>UPDATE TABLE</li><li>DELETE TABLE</li><li>ADD COLUMNS</li><li>DELETE COLUMNS</li><li>SHOW COLUMNS</li><li>RENAME COLUMNS</li></ul><h4 id="_8-create-table" tabindex="-1"><a class="header-anchor" href="#_8-create-table" aria-hidden="true">#</a> 8. CREATE TABLE</h4><p>Used to create a new table in a database.</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> TableName <span class="token punctuation">(</span>
	Column1 Datatype<span class="token punctuation">,</span>
	Column2 Datatype<span class="token punctuation">,</span>
	Column3 Datatype<span class="token punctuation">,</span>
   <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Example:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> Patients
<span class="token punctuation">(</span>
PatientID <span class="token keyword">int</span><span class="token punctuation">,</span>
PatientName <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
Sex <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
Age <span class="token keyword">int</span><span class="token punctuation">,</span>
Address <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
PostalCode <span class="token keyword">int</span><span class="token punctuation">,</span>
State <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
Country <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
RegDate <span class="token keyword">date</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_9-create-table-as" tabindex="-1"><a class="header-anchor" href="#_9-create-table-as" aria-hidden="true">#</a> 9. CREATE TABLE AS</h4><p>Used to create a new table from an existing table.</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> NewTableName <span class="token keyword">AS</span>
    <span class="token keyword">SELECT</span> Column1<span class="token punctuation">,</span> Column2<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">FROM</span> ExistingTableName
    <span class="token keyword">WHERE</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Example:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> SamplePatientsTable <span class="token keyword">AS</span>
<span class="token keyword">SELECT</span> PatientID<span class="token punctuation">,</span> PatientName<span class="token punctuation">,</span> Age
<span class="token keyword">FROM</span> Patients<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_10-show-table" tabindex="-1"><a class="header-anchor" href="#_10-show-table" aria-hidden="true">#</a> 10. SHOW TABLE</h4><p>Used to list all the tables created in a database. Here, please note that you have to use the database first before displaying the database</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SHOW</span> <span class="token keyword">TABLES</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Example:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">USE</span> PatientsDatabase<span class="token punctuation">;</span>
<span class="token keyword">SHOW</span> <span class="token keyword">TABLES</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_11-alter-table" tabindex="-1"><a class="header-anchor" href="#_11-alter-table" aria-hidden="true">#</a> 11. ALTER TABLE</h4><p>Used to manipulate columns or constraints by addition, modification or deletion.</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> TableName
<span class="token keyword">ADD</span> ColumnName datatype<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>Example:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> Patients
<span class="token keyword">ADD</span> <span class="token keyword">INT</span> BP<span class="token punctuation">;</span>

<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> Patients
<span class="token keyword">MODIFY</span> BP BP1<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_12-describe-table" tabindex="-1"><a class="header-anchor" href="#_12-describe-table" aria-hidden="true">#</a> 12. DESCRIBE TABLE</h4><p>Used to display the structure of the tables. It will display the column names, their data types, default values, and keys.</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">DESCRIBE</span> TableName<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Example:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">DESCRIBE</span> Patients<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="_13-truncate-table" tabindex="-1"><a class="header-anchor" href="#_13-truncate-table" aria-hidden="true">#</a> 13. TRUNCATE TABLE</h4><p>Used to delete the data present in the tables, without deleting the table.</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">TRUNCATE</span> <span class="token keyword">TABLE</span> TableName<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Example:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">TRUNCATE</span> <span class="token keyword">TABLE</span> Patients<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="_14-drop-table" tabindex="-1"><a class="header-anchor" href="#_14-drop-table" aria-hidden="true">#</a> 14. DROP TABLE</h4><p>Used to delete a table including its data permanently.</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> TableName<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Example:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> Patients<span class="token punctuation">;</span>
 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_15-rename-table" tabindex="-1"><a class="header-anchor" href="#_15-rename-table" aria-hidden="true">#</a> 15. RENAME TABLE</h4><p>Used to rename a table.</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">RENAME</span> <span class="token keyword">TABLE</span> TableName1 <span class="token keyword">TO</span> TableName2<span class="token punctuation">;</span>
 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>Example:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">RENAME</span> <span class="token keyword">TABLE</span> Patients <span class="token keyword">TO</span> PatientsInfo<span class="token punctuation">;</span>
 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_16-insert-into" tabindex="-1"><a class="header-anchor" href="#_16-insert-into" aria-hidden="true">#</a> 16. INSERT INTO</h4><p>Used to insert new records into a table.</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> TableName <span class="token punctuation">(</span>Column1<span class="token punctuation">,</span> Column2<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span>Value1<span class="token punctuation">,</span> Value2<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token comment">--OR</span>
 
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> TableName
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span>Value1<span class="token punctuation">,</span> Value2<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Example:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> Patients
<span class="token punctuation">(</span>
PatientID<span class="token punctuation">,</span>PatientName<span class="token punctuation">,</span>Sex<span class="token punctuation">,</span>Age<span class="token punctuation">,</span>Address<span class="token punctuation">,</span>PostalCode<span class="token punctuation">,</span>State<span class="token punctuation">,</span>Country<span class="token punctuation">,</span>RegDate <span class="token keyword">date</span>
<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">&#39;06&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;Suhana&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;F&#39;</span><span class="token punctuation">,</span> â€˜<span class="token number">12</span>â€™<span class="token punctuation">,</span> <span class="token string">&#39;House No 34C Jubilee Hills&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;500046&#39;</span><span class="token punctuation">,</span> â€˜Telanganaâ€™<span class="token punctuation">,</span> <span class="token string">&#39;India&#39;</span><span class="token punctuation">,</span> â€˜<span class="token number">02</span><span class="token operator">/</span><span class="token number">09</span><span class="token operator">/</span><span class="token number">2021</span>â€™<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
â€“<span class="token operator">OR</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> Patients
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">&#39;06&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;Suhana&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;F&#39;</span><span class="token punctuation">,</span> â€˜<span class="token number">12</span>â€™<span class="token punctuation">,</span> <span class="token string">&#39;House No 34C Jubilee Hills&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;500046&#39;</span><span class="token punctuation">,</span> â€˜Telanganaâ€™<span class="token punctuation">,</span> <span class="token string">&#39;India&#39;</span><span class="token punctuation">,</span> â€˜<span class="token number">02</span><span class="token operator">/</span><span class="token number">09</span><span class="token operator">/</span><span class="token number">2021</span>â€™<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_17-update-table" tabindex="-1"><a class="header-anchor" href="#_17-update-table" aria-hidden="true">#</a> 17. UPDATE TABLE</h4><p>Used to modify the existing data items in a table.</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">UPDATE</span> TableName
<span class="token keyword">SET</span> column1 <span class="token operator">=</span> value1<span class="token punctuation">,</span> column2 <span class="token operator">=</span> value2<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">WHERE</span> condition<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Example:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">UPDATE</span> Patients
<span class="token keyword">SET</span> PatientName <span class="token operator">=</span> <span class="token string">&#39;Afsana&#39;</span><span class="token punctuation">,</span> PostalCode<span class="token operator">=</span> <span class="token string">&#39;500034&#39;</span>
<span class="token keyword">WHERE</span> PatientID <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="18"><li>DELETE TABLE</li></ol><p>Used to delete the existing data items in a table.</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> TableName
<span class="token keyword">WHERE</span> condition<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>Example:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> Patients
<span class="token keyword">WHERE</span> PatientName<span class="token operator">=</span><span class="token string">&#39;Anay&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_19-add-columns-in-a-table" tabindex="-1"><a class="header-anchor" href="#_19-add-columns-in-a-table" aria-hidden="true">#</a> 19. ADD COLUMNS IN A TABLE</h4><p>Used to add new columns in a table.</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> TableName   
    <span class="token keyword">ADD</span> <span class="token keyword">COLUMN</span> NewColumnName ColumnDataType<span class="token punctuation">;</span>
â€“<span class="token operator">OR</span> 
â€“<span class="token keyword">To</span> <span class="token keyword">add</span> <span class="token keyword">after</span> a particular <span class="token keyword">column</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> TableName   
    <span class="token keyword">ADD</span> <span class="token keyword">COLUMN</span> NewColumnName ColumnDataType <span class="token keyword">AFTER</span> ColumnName<span class="token punctuation">;</span>
â€“<span class="token operator">OR</span>
â€“<span class="token keyword">To</span> <span class="token keyword">add</span> multiple <span class="token keyword">columns</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> TableName   <span class="token punctuation">(</span>
    <span class="token keyword">ADD</span> <span class="token keyword">COLUMN</span> NewColumnName ColumnDataType <span class="token keyword">AFTER</span> ColumnName<span class="token punctuation">,</span>
    <span class="token keyword">ADD</span> <span class="token keyword">COLUMN</span> NewColumnName ColumnDataType <span class="token keyword">AFTER</span> ColumnName <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Example:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> Patients   
    <span class="token keyword">ADD</span> <span class="token keyword">COLUMN</span> BP <span class="token keyword">int</span><span class="token punctuation">;</span>
â€“<span class="token operator">OR</span> 
â€“<span class="token keyword">To</span> <span class="token keyword">add</span> <span class="token keyword">after</span> a particular <span class="token keyword">column</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> Patients   
    <span class="token keyword">ADD</span> <span class="token keyword">COLUMN</span> BP <span class="token keyword">int</span> <span class="token keyword">AFTER</span> Age<span class="token punctuation">;</span>
â€“<span class="token operator">OR</span>
â€“<span class="token keyword">To</span> <span class="token keyword">add</span> multiple <span class="token keyword">columns</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> TableName <span class="token punctuation">(</span>  
    <span class="token keyword">ADD</span> <span class="token keyword">COLUMN</span> BP <span class="token keyword">int</span> <span class="token keyword">AFTER</span> Age<span class="token punctuation">,</span>
    <span class="token keyword">ADD</span> <span class="token keyword">COLUMN</span> Weight <span class="token keyword">int</span> <span class="token keyword">AFTER</span> BP<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_20-delete-columns-in-a-table" tabindex="-1"><a class="header-anchor" href="#_20-delete-columns-in-a-table" aria-hidden="true">#</a> 20. DELETE COLUMNS IN A TABLE</h4><p>Used to delete columns from a table.</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> TableName   
    <span class="token keyword">DROP</span> <span class="token keyword">COLUMN</span> ColumnName<span class="token punctuation">;</span>
â€“<span class="token operator">OR</span>
â€“<span class="token keyword">To</span> <span class="token keyword">drop</span> multiple <span class="token keyword">columns</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> TableName   <span class="token punctuation">(</span>
    <span class="token keyword">DROP</span> <span class="token keyword">COLUMN</span> ColumnName<span class="token punctuation">,</span>
    <span class="token keyword">DROP</span> <span class="token keyword">COLUMN</span> ColumnName<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Example:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> Patients   
    <span class="token keyword">ADD</span> <span class="token keyword">COLUMN</span> BP <span class="token keyword">int</span><span class="token punctuation">;</span>
â€“<span class="token operator">OR</span> 
â€“<span class="token keyword">To</span> <span class="token keyword">add</span> <span class="token keyword">after</span> a particular <span class="token keyword">column</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> Patients   
    <span class="token keyword">ADD</span> <span class="token keyword">COLUMN</span> BP <span class="token keyword">int</span> <span class="token keyword">AFTER</span> Age<span class="token punctuation">;</span>
â€“<span class="token operator">OR</span>
â€“<span class="token keyword">To</span> <span class="token keyword">add</span> multiple <span class="token keyword">columns</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> TableName <span class="token punctuation">(</span>  
    <span class="token keyword">ADD</span> <span class="token keyword">COLUMN</span> BP <span class="token keyword">int</span> <span class="token keyword">AFTER</span> Age<span class="token punctuation">,</span>
    <span class="token keyword">ADD</span> <span class="token keyword">COLUMN</span> Weight <span class="token keyword">int</span> <span class="token keyword">AFTER</span> BP<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_21-show-columns-in-a-table" tabindex="-1"><a class="header-anchor" href="#_21-show-columns-in-a-table" aria-hidden="true">#</a> 21. SHOW COLUMNS IN A TABLE</h4><p>Used to display all the columns present in the database.</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SHOW</span> <span class="token keyword">COLUMNS</span> <span class="token keyword">FROM</span> TableName <span class="token keyword">FROM</span> DatabaseName<span class="token punctuation">;</span>  
<span class="token comment">--OR  </span>
<span class="token keyword">SHOW</span> <span class="token keyword">COLUMNS</span> <span class="token keyword">FROM</span> DatabaseName<span class="token punctuation">.</span>TableName<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Example:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SHOW</span> <span class="token keyword">COLUMNS</span> <span class="token keyword">FROM</span> Patients <span class="token keyword">FROM</span> PatientsDatabase<span class="token punctuation">;</span>  
<span class="token comment">--OR  </span>
<span class="token keyword">SHOW</span> <span class="token keyword">COLUMNS</span> <span class="token keyword">FROM</span> PatientsDatabase<span class="token punctuation">.</span>Patients<span class="token punctuation">;</span> 
 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_22-rename-columns-in-a-table" tabindex="-1"><a class="header-anchor" href="#_22-rename-columns-in-a-table" aria-hidden="true">#</a> 22. RENAME COLUMNS IN A TABLE</h4><p>Used to rename columns present in a table.</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> TableName   
CHANGE <span class="token keyword">COLUMN</span> OldColumnName NewColumnName DataType<span class="token punctuation">;</span>
<span class="token comment">--OR</span>
â€“<span class="token keyword">To</span> change multiple <span class="token keyword">column</span> names <span class="token keyword">with</span> CHANGE query
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> TableName  <span class="token punctuation">(</span>
CHANGE <span class="token keyword">COLUMN</span> OldColumnName NewColumnName DataType<span class="token punctuation">,</span>
CHANGE <span class="token keyword">COLUMN</span> OldColumnName NewColumnName DataType<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">--OR</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> TableName   
<span class="token keyword">RENAME</span> <span class="token keyword">COLUMN</span> OldColumnName <span class="token keyword">TO</span> NewColumnName<span class="token punctuation">;</span>  
<span class="token comment">--OR</span>
â€“<span class="token keyword">To</span> change multiple <span class="token keyword">column</span> names <span class="token keyword">with</span> <span class="token keyword">RENAME</span> query
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> TableName   <span class="token punctuation">(</span>
<span class="token keyword">RENAME</span> <span class="token keyword">COLUMN</span> OldColumnName <span class="token keyword">TO</span> NewColumnName<span class="token punctuation">,</span>
<span class="token keyword">RENAME</span> <span class="token keyword">COLUMN</span> OldColumnName <span class="token keyword">TO</span> NewColumnName <span class="token punctuation">)</span><span class="token punctuation">;</span>
 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Example:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> Patients   
CHANGE <span class="token keyword">COLUMN</span> Address PatientAddress <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">--OR</span>
<span class="token keyword">To</span> change multiple <span class="token keyword">column</span> names <span class="token keyword">with</span> CHANGE query
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> Patients   <span class="token punctuation">(</span>
CHANGE <span class="token keyword">COLUMN</span> Address PatientAddress <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
CHANGE <span class="token keyword">COLUMN</span> BP PatientBP <span class="token keyword">INT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
â€”<span class="token operator">OR</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> Patients    
<span class="token keyword">RENAME</span> <span class="token keyword">COLUMN</span> Address <span class="token keyword">TO</span> PatientAddress<span class="token punctuation">;</span>  
â€“<span class="token operator">OR</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> Patients    <span class="token punctuation">(</span>
<span class="token keyword">RENAME</span> <span class="token keyword">COLUMN</span> Address <span class="token keyword">TO</span> PatientAddress<span class="token punctuation">,</span>
<span class="token keyword">RENAME</span> <span class="token keyword">COLUMN</span> BP <span class="token keyword">TO</span> PatientBP<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="keys-in-mysql" tabindex="-1"><a class="header-anchor" href="#keys-in-mysql" aria-hidden="true">#</a> Keys in MySQL</h3><p>Multiple tables are uniquely identified with the help of the various keys present in the tables. These keys help the users build relationships between multiple tables.</p><p>The following are 5 different types of keys used commonly.</p><ul><li>Primary Key</li><li>Foreign Key <ul><li>Candidate Key</li><li>Super Key</li><li>Alternate Key</li></ul></li></ul><h4 id="_23-primary-key" tabindex="-1"><a class="header-anchor" href="#_23-primary-key" aria-hidden="true">#</a> 23. Primary Key</h4><p>A set of attributes that can be used to uniquely identify every tuple is a primary key. If there are multiple candidate keys present in a relationship, out of those, only one can be chosen as a primary key.</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> TableName <span class="token punctuation">(</span>
	Column1 Datatype<span class="token punctuation">,</span>
	Column2 Datatype <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>
	Column3 Datatype<span class="token punctuation">,</span>
   <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Example:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> Patients
<span class="token punctuation">(</span>
PatientID <span class="token keyword">int</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>
PatientName <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
Sex <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
Age <span class="token keyword">int</span><span class="token punctuation">,</span>
Address <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
PostalCode <span class="token keyword">int</span><span class="token punctuation">,</span>
State <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
Country <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
RegDate <span class="token keyword">date</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_24-foreign-key" tabindex="-1"><a class="header-anchor" href="#_24-foreign-key" aria-hidden="true">#</a> 24. Foreign Key</h4><p>Attributes that can only take the data values present as the value of some other attribute are known as the foreign key to the attribute to which it refers.</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> TableName <span class="token punctuation">(</span>
	Column1 Datatype<span class="token punctuation">,</span>
	Column2 Datatype <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>
	Column3 Datatype<span class="token punctuation">,</span>
     <span class="token keyword">CONSTRAINT</span> FKeyName <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>CurrenTableColumn<span class="token punctuation">)</span>  
     <span class="token keyword">REFERENCES</span> ParentTableColumn  
   <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Example:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> Doctors
<span class="token punctuation">(</span>
DoctorID <span class="token keyword">int</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>
DoctorName <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token keyword">CONSTRAINT</span> DocPatient <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>DoctorID<span class="token punctuation">)</span>  
<span class="token keyword">REFERENCES</span> PatientID
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="constraints-in-mysql" tabindex="-1"><a class="header-anchor" href="#constraints-in-mysql" aria-hidden="true">#</a> Constraints in MySQL</h3><p>Constraints are used in the database to enforce certain data rules while creating tables. They are also used to check values in the database. The most popular constraints are:</p><ul><li>UNIQUE</li><li>NOT NULL</li><li>CHECK</li><li>DEFAULT</li></ul><h4 id="_25-unique-constraint" tabindex="-1"><a class="header-anchor" href="#_25-unique-constraint" aria-hidden="true">#</a> 25. UNIQUE Constraint</h4><p>Make sure all the data values in that particular column are unique. More than one column can have the UNIQUE constraint</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> TableName <span class="token punctuation">(</span>
	Column1 Datatype<span class="token punctuation">,</span>
	Column2 Datatype <span class="token keyword">UNIQUE</span><span class="token punctuation">,</span>
	Column3 Datatype<span class="token punctuation">,</span>
   <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Example:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> Patients
<span class="token punctuation">(</span>
PatientID <span class="token keyword">int</span> <span class="token keyword">UNIQUE</span><span class="token punctuation">,</span>
PatientName <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
Sex <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
Age <span class="token keyword">int</span><span class="token punctuation">,</span>
Address <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
PostalCode <span class="token keyword">int</span><span class="token punctuation">,</span>
State <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
Country <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
RegDate <span class="token keyword">date</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_26-not-null-constraint" tabindex="-1"><a class="header-anchor" href="#_26-not-null-constraint" aria-hidden="true">#</a> 26. NOT NULL Constraint</h4><p>Make sure that no null value can be stored in a column of a table. More than one column can have the NOT NULL constraint</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> TableName <span class="token punctuation">(</span>
	Column1 Datatype<span class="token punctuation">,</span>
	Column2 Datatype <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
	Column3 Datatype<span class="token punctuation">,</span>
   <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Example:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> Patients
<span class="token punctuation">(</span>
PatientID <span class="token keyword">int</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
PatientName <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
Sex <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
Age <span class="token keyword">int</span><span class="token punctuation">,</span>
Address <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
PostalCode <span class="token keyword">int</span><span class="token punctuation">,</span>
State <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
Country <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
RegDate <span class="token keyword">date</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_27-check-constraint" tabindex="-1"><a class="header-anchor" href="#_27-check-constraint" aria-hidden="true">#</a> 27. CHECK Constraint</h4><p>Make sure that all the values in a column satisfy the mentioned condition</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> TableName <span class="token punctuation">(</span>
	Column1 Datatype<span class="token punctuation">,</span>
	Column2 Datatype <span class="token keyword">CHECK</span> <span class="token punctuation">(</span>Column2 Condition<span class="token punctuation">)</span><span class="token punctuation">,</span>
	Column3 Datatype<span class="token punctuation">,</span>
   <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Example:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> Patients
<span class="token punctuation">(</span>
PatientID <span class="token keyword">int</span><span class="token punctuation">,</span>
PatientName <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
Sex <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span>
Age <span class="token keyword">int</span> <span class="token keyword">CHECK</span> <span class="token punctuation">(</span>Age <span class="token operator">&gt;=</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
Address <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
PostalCode <span class="token keyword">int</span><span class="token punctuation">,</span>
State <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
Country <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
RegDate <span class="token keyword">date</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_28-default-constraint" tabindex="-1"><a class="header-anchor" href="#_28-default-constraint" aria-hidden="true">#</a> 28. DEFAULT Constraint</h4><p>Make sure that the mentioned default value is taken automatically when no value is specified for that data record.</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> TableName <span class="token punctuation">(</span>
	Column1 Datatype<span class="token punctuation">,</span>
	Column2 Datatype <span class="token keyword">DEFAULT</span> DefaultValue<span class="token punctuation">,</span>
	Column3 Datatype<span class="token punctuation">,</span>
   <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Example:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> Patients
<span class="token punctuation">(</span>
PatientID <span class="token keyword">int</span><span class="token punctuation">,</span>
PatientName <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
Sex <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
Age <span class="token keyword">int</span> <span class="token keyword">DEFAULT</span> â€˜<span class="token number">0</span>â€™<span class="token punctuation">,</span>
Address <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
PostalCode <span class="token keyword">int</span><span class="token punctuation">,</span>
State <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
Country <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
RegDate <span class="token keyword">date</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="views" tabindex="-1"><a class="header-anchor" href="#views" aria-hidden="true">#</a> Views</h3><p>Views are used to <strong>create a virtual table based on the output of the SQL query given by the users.</strong></p><p>Views have a similar outlook as that of a table. They have rows and columns and can have data fields from multiple tables in the database.</p><h4 id="_29-create-view" tabindex="-1"><a class="header-anchor" href="#_29-create-view" aria-hidden="true">#</a> 29. CREATE VIEW</h4><p>Used to create a view from single or multiple tables.</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> ViewName <span class="token keyword">AS</span>
	<span class="token keyword">SELECT</span> Column1<span class="token punctuation">,</span> Column2<span class="token punctuation">,</span> â€¦
	<span class="token keyword">FROM</span> TableName
     <span class="token keyword">WHERE</span> Condition<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Example:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> Kids
<span class="token punctuation">(</span>
<span class="token keyword">SELECT</span> PatientID <span class="token keyword">int</span><span class="token punctuation">,</span>PatientName <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>Sex <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>Age <span class="token keyword">int</span>
<span class="token keyword">FROM</span> Patients
<span class="token keyword">WHERE</span> Age <span class="token operator">&lt;=</span><span class="token number">18</span><span class="token punctuation">;</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_30-update-view" tabindex="-1"><a class="header-anchor" href="#_30-update-view" aria-hidden="true">#</a> 30. UPDATE VIEW</h4><p>A view can be updated by using the CREATE OR REPLACE VIEW command.</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token operator">OR</span> <span class="token keyword">REPLACE</span> <span class="token keyword">VIEW</span> ViewName <span class="token keyword">AS</span>
	<span class="token keyword">SELECT</span> Column1<span class="token punctuation">,</span> Column2<span class="token punctuation">,</span> â€¦
	<span class="token keyword">FROM</span> TableName
     <span class="token keyword">WHERE</span> Condition<span class="token punctuation">;</span>
 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Example:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token operator">OR</span> <span class="token keyword">REPLACE</span> <span class="token keyword">VIEW</span> Kids
<span class="token punctuation">(</span>
PatientID <span class="token keyword">int</span><span class="token punctuation">,</span>PatientName <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>Sex <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>Age <span class="token keyword">int</span>
<span class="token keyword">FROM</span> Patients
<span class="token keyword">WHERE</span> Age <span class="token operator">&lt;=</span><span class="token number">18</span><span class="token punctuation">;</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_31-drop-view" tabindex="-1"><a class="header-anchor" href="#_31-drop-view" aria-hidden="true">#</a> 31. DROP VIEW</h4><p>Used to delete a view.</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">DROP</span> <span class="token keyword">VIEW</span> ViewName<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Example:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">DROP</span> <span class="token keyword">VIEW</span> Kids<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="manipulation-commandsâ˜…" tabindex="-1"><a class="header-anchor" href="#manipulation-commandsâ˜…" aria-hidden="true">#</a> Manipulation Commandsâ˜…</h3><p>Data Manipulation commands are used to manipulate, alter and update the data according to the client requirements. The commands in this section are:</p><ul><li>SELECT</li><li>SELECT CLAUSES</li><li>CONDITIONAL OPERATORS</li><li>AGGREGATE FUNCTIONS</li><li>SET OPERATIONS</li></ul><h4 id="_32-select" tabindex="-1"><a class="header-anchor" href="#_32-select" aria-hidden="true">#</a> 32. SELECT</h4><p>Used to select a set of data points from a database. It stores the data returned as output in the result set.</p><p>Syntax:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>SELECT column1, column2, ...
FROM TableName;
--(*)-&gt; select all from the table
SELECT * FROM TableName;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Example:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>SELECT PatientName, State FROM Patients;
SELECT * FROM Patients;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="mysql-clauses" tabindex="-1"><a class="header-anchor" href="#mysql-clauses" aria-hidden="true">#</a> MySQL Clauses</h4><p>MySQL Clauses used with the SELECT statement are as follows:</p><ul><li>DISTINCT</li><li>FROM</li><li>WHERE</li><li>GROUP BY</li><li>HAVING</li><li>ORDER BY</li><li>LIMIT</li></ul><h4 id="_33-distinct" tabindex="-1"><a class="header-anchor" href="#_33-distinct" aria-hidden="true">#</a> 33. DISTINCT</h4><p>Used to return only the distinct values from a dataset.</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> Column1<span class="token punctuation">,</span> Column2<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">FROM</span> TableName<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>Example:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> State <span class="token keyword">FROM</span> Patients<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="_34-from" tabindex="-1"><a class="header-anchor" href="#_34-from" aria-hidden="true">#</a> 34. FROM</h4><p>Used to retrieve data from a table.</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> Column1<span class="token punctuation">,</span> Column2<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">FROM</span> TableName<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>Example:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> PatientID<span class="token punctuation">,</span> State <span class="token keyword">FROM</span> Patients<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="_35-where" tabindex="-1"><a class="header-anchor" href="#_35-where" aria-hidden="true">#</a> 35. WHERE</h4><p>Used to filter the data by mentioning conditions. This clause is generally used with the SELECT, INSERT, UPDATE, and DELETE commands.</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> column1<span class="token punctuation">,</span> column2<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">FROM</span> TableName <span class="token keyword">WHERE</span> Conditions<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>Example:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> PatientName<span class="token punctuation">,</span> State <span class="token keyword">FROM</span> Patients <span class="token keyword">WHERE</span> Age <span class="token operator">&gt;</span> <span class="token number">20</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="_36-group-by" tabindex="-1"><a class="header-anchor" href="#_36-group-by" aria-hidden="true">#</a> 36. GROUP BY</h4><p>Most commonly used with the aggregate functions to group the output by one or more columns.</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> Column1<span class="token punctuation">,</span> Column2<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">FROM</span> TableName
<span class="token keyword">WHERE</span> Conditions
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> Column1<span class="token punctuation">,</span> Column2<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> 
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> Column1<span class="token punctuation">,</span> Column2<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">DESC</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Example:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span>PatientID<span class="token punctuation">)</span><span class="token punctuation">,</span> State
<span class="token keyword">FROM</span> Patients
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> State
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token function">COUNT</span><span class="token punctuation">(</span>PatientID<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_37-having" tabindex="-1"><a class="header-anchor" href="#_37-having" aria-hidden="true">#</a> 37. HAVING</h4><p>Used with the aggregate functions to mention conditions, and filter data.</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> Column1<span class="token punctuation">,</span> Column2<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">FROM</span> TableName
<span class="token keyword">WHERE</span> Conditions
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> Column1<span class="token punctuation">,</span> Column2<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> 
<span class="token keyword">HAVING</span> Conditions
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> Column1<span class="token punctuation">,</span> Column2<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Example:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span>PatientID<span class="token punctuation">)</span><span class="token punctuation">,</span> State
<span class="token keyword">FROM</span> Patients
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> State
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token function">COUNT</span><span class="token punctuation">(</span>Age<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">40</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_38-order-by" tabindex="-1"><a class="header-anchor" href="#_38-order-by" aria-hidden="true">#</a> 38. ORDER BY</h4><p>Used to sort the results in an ascending or descending order. Here, you should know that by default, the results are sorted in ascending order. If you wish to sort the data in descending order, then you have to use the <em>DESC</em> keyword.</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> Column1<span class="token punctuation">,</span> Column2<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">FROM</span> TableName
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> Column1<span class="token punctuation">,</span> Column2<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">DESC</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Example:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> Patients
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> Age<span class="token punctuation">;</span>  
 
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> Patients
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> Age <span class="token keyword">DESC</span><span class="token punctuation">;</span>
 
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> Patients
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> Age<span class="token punctuation">,</span> PatientName<span class="token punctuation">;</span>
 
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> Patients
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> Age <span class="token keyword">DESC</span><span class="token punctuation">,</span> PatientName <span class="token keyword">ASC</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="limit" tabindex="-1"><a class="header-anchor" href="#limit" aria-hidden="true">#</a> LIMIT</h4><p>The LIMIT clause is used to <strong>specify the number of records to return</strong>.</p><p>The LIMIT clause is useful on large tables with thousands of records. Returning a large number of records can impact performance.</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> 
    customerNumber<span class="token punctuation">,</span> 
    customerName
<span class="token keyword">FROM</span>
    customers
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> customerName    
<span class="token keyword">LIMIT</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token comment">-- åŸºæœ¬è¯­æ³•select...limit startï¼Œrows ä»start + 1è¡Œå¼€å§‹ å–å‡ºrowsè¡Œ startä»0å¼€å§‹è®¡ç®—</span>

<span class="token comment"># åˆ†é¡µæŸ¥è¯¢å…¬å¼ n:å½“å‰é¡µ m:ä¸€é¡µæ˜¾ç¤ºçš„æ•°æ®æ¡æ•°</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tablename <span class="token keyword">limit</span> <span class="token punctuation">(</span>n<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span>m<span class="token punctuation">,</span>m<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> 
    select_list
<span class="token keyword">FROM</span>
    table_name
<span class="token keyword">LIMIT</span> row_count <span class="token keyword">offset</span> offset_value<span class="token punctuation">;</span>
<span class="token comment">-- LIMIT 1 OFFSET 1</span>
<span class="token comment">--  The [offset_value] specifies the offset of the first row to return. The offset of the first row is 0, not 1.</span>
<span class="token comment">--  The [row_count] specifies the maximum number of rows to return.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="conditional-operators" tabindex="-1"><a class="header-anchor" href="#conditional-operators" aria-hidden="true">#</a> CONDITIONAL OPERATORS</h4><p>This section of MySQL commands consists of the various conditional operators used to manipulate data. Commands covered in this section of the article are as follows:</p><ul><li>AND</li><li>OR</li><li>NOT</li><li>BETWEEN</li><li>LIKE</li><li>IS NULL</li><li>IS NOT NULL</li><li>IN</li><li>EXISTS</li><li>ALL</li><li>ANY</li></ul><h4 id="_39-and" tabindex="-1"><a class="header-anchor" href="#_39-and" aria-hidden="true">#</a> 39. AND</h4><p>Used to filter records based on one or more conditions. It displays all those records that satisfy all the conditions separated by AND and generates an output as TRUE.</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> Column1<span class="token punctuation">,</span> Column2<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">FROM</span> TableName
<span class="token keyword">WHERE</span> Condition1 <span class="token operator">AND</span> Condition2 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Example:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> Patients
<span class="token keyword">WHERE</span> State<span class="token operator">=</span><span class="token string">&#39;Telangana&#39;</span> <span class="token operator">AND</span> Age <span class="token operator">&gt;</span> <span class="token number">23</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_40-or" tabindex="-1"><a class="header-anchor" href="#_40-or" aria-hidden="true">#</a> 40. OR</h4><p>Used to filter records that satisfy either of the conditions and generate output as TRUE.</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> Column1<span class="token punctuation">,</span> Column2<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">FROM</span> TableName
<span class="token keyword">WHERE</span> Condition1 <span class="token operator">OR</span> Condition2 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Example:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> Patients
<span class="token keyword">WHERE</span> State<span class="token operator">=</span><span class="token string">&#39;Telangana&#39;</span> <span class="token operator">OR</span> Age <span class="token operator">&gt;</span> <span class="token number">23</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_41-not" tabindex="-1"><a class="header-anchor" href="#_41-not" aria-hidden="true">#</a> 41. NOT</h4><p>Used to display those records which do not satisfy a condition.</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> Column1<span class="token punctuation">,</span> Column2<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">FROM</span> TableName
<span class="token keyword">WHERE</span> <span class="token operator">NOT</span> Condition<span class="token punctuation">;</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Example:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> Patients
<span class="token keyword">WHERE</span> <span class="token operator">NOT</span> State<span class="token operator">=</span><span class="token string">&#39;Telangana&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_42-between" tabindex="-1"><a class="header-anchor" href="#_42-between" aria-hidden="true">#</a> 42. BETWEEN</h4><p>Used to select values from a given range.</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> Column1<span class="token punctuation">,</span> Column2<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">FROM</span> TableName
<span class="token keyword">WHERE</span> ColumnName <span class="token operator">BETWEEN</span> Value1 <span class="token operator">AND</span> Value2<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Example:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> Patients
<span class="token keyword">WHERE</span> Age <span class="token operator">BETWEEN</span> <span class="token number">15</span> <span class="token operator">AND</span> <span class="token number">18</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_43-like" tabindex="-1"><a class="header-anchor" href="#_43-like" aria-hidden="true">#</a> 43. LIKE</h4><p>Most commonly used in a WHERE clause to search for a pattern in a column of a table with the help of wildcards.</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> Column1<span class="token punctuation">,</span> Column2<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">FROM</span> TableName
<span class="token keyword">WHERE</span> ColumnName <span class="token operator">LIKE</span> Pattern<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Example:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> Patients
<span class="token keyword">WHERE</span> PatientName <span class="token operator">LIKE</span> â€˜A<span class="token operator">%</span>â€™<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_44-is-null" tabindex="-1"><a class="header-anchor" href="#_44-is-null" aria-hidden="true">#</a> 44. IS NULL</h4><p>Used to mention NULL as a value for a single column or multiple columns.</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> Column1<span class="token punctuation">,</span> Column2<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">FROM</span> TableName
<span class="token keyword">WHERE</span> ColumnName <span class="token operator">IS</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Example:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> Patients
<span class="token keyword">WHERE</span> State <span class="token operator">IS</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_45-is-not-null" tabindex="-1"><a class="header-anchor" href="#_45-is-not-null" aria-hidden="true">#</a> 45. IS NOT NULL</h4><p>Used to restrict a single column or multiple columns having NULL values.</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> Column1<span class="token punctuation">,</span> Column2<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">FROM</span> TableName
<span class="token keyword">WHERE</span> ColumnName <span class="token operator">IS</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Example:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> Patients
<span class="token keyword">WHERE</span> State <span class="token operator">IS</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_46-in" tabindex="-1"><a class="header-anchor" href="#_46-in" aria-hidden="true">#</a> 46. IN</h4><p>Used to specify multiple values in a WHERE clause.</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> Column1<span class="token punctuation">,</span> Column2<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">FROM</span> TableName
<span class="token keyword">WHERE</span> ColumnName <span class="token operator">IN</span> <span class="token punctuation">(</span>Value1<span class="token punctuation">,</span> Value2<span class="token punctuation">,</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Example:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> Patients
<span class="token keyword">WHERE</span> State <span class="token operator">IN</span> <span class="token punctuation">(</span>â€˜Rajasthanâ€™<span class="token punctuation">,</span> â€˜Telanganaâ€™<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_47-exists" tabindex="-1"><a class="header-anchor" href="#_47-exists" aria-hidden="true">#</a> 47. EXISTS</h4><p>Used to test if the required record exists or not.</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> Column1<span class="token punctuation">,</span> Column2<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">FROM</span> TableName
<span class="token keyword">WHERE</span> <span class="token keyword">EXISTS</span>
<span class="token punctuation">(</span><span class="token keyword">SELECT</span> ColumnName <span class="token keyword">FROM</span> TableName <span class="token keyword">WHERE</span> Conditions<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Example:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> PatientNameFROM PatientsWHERE <span class="token keyword">EXISTS</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> Sex <span class="token keyword">FROM</span> Patients <span class="token keyword">WHERE</span> PatientId <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">OR</span> Age <span class="token operator">&lt;</span> <span class="token number">35</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="_48-all" tabindex="-1"><a class="header-anchor" href="#_48-all" aria-hidden="true">#</a> 48. ALL</h4><p>Used with a WHERE or HAVING clause to return all the records which meet conditions.</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> Column1<span class="token punctuation">,</span> Column2<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">FROM</span> TableName
<span class="token keyword">WHERE</span> ColumnName Operator <span class="token keyword">ALL</span>
<span class="token punctuation">(</span><span class="token keyword">SELECT</span> ColumnName <span class="token keyword">FROM</span> TableName <span class="token keyword">WHERE</span> Conditions<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Example:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> PatientName
<span class="token keyword">FROM</span> Patients
<span class="token keyword">WHERE</span> PatientID <span class="token operator">=</span> <span class="token keyword">ALL</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> PatientID <span class="token keyword">FROM</span> Patients <span class="token keyword">WHERE</span> Age <span class="token operator">&lt;</span> <span class="token number">35</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_49-any" tabindex="-1"><a class="header-anchor" href="#_49-any" aria-hidden="true">#</a> 49. ANY</h4><p>Used with a WHERE or HAVING clause to return only those records which meet conditions.</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> Column1<span class="token punctuation">,</span> Column2<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">FROM</span> TableName
<span class="token keyword">WHERE</span> ColumnName Operator <span class="token keyword">ANY</span>
<span class="token punctuation">(</span><span class="token keyword">SELECT</span> ColumnName <span class="token keyword">FROM</span> TableName <span class="token keyword">WHERE</span> Conditions<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Example:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> PatientName
<span class="token keyword">FROM</span> Patients
<span class="token keyword">WHERE</span> PatientID <span class="token operator">=</span> <span class="token keyword">ANY</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> PatientID <span class="token keyword">FROM</span> Patients <span class="token keyword">WHERE</span> <span class="token operator">BETWEEN</span> <span class="token number">20</span> <span class="token operator">AND</span> <span class="token number">35</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_50-not-equal" tabindex="-1"><a class="header-anchor" href="#_50-not-equal" aria-hidden="true">#</a> 50. NOT EQUAL</h4><p>Used for returning a set of rows that are not equal.</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> Column1<span class="token punctuation">,</span> Column2<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">FROM</span> TableName<span class="token punctuation">,</span>
<span class="token keyword">WHERE</span> ColumnName <span class="token operator">&lt;&gt;</span> Conditions<span class="token punctuation">;</span> 
â€“<span class="token operator">OR</span>
<span class="token keyword">SELECT</span> Column1<span class="token punctuation">,</span> Column2<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">FROM</span> TableName<span class="token punctuation">,</span>
<span class="token keyword">WHERE</span> ColumnName <span class="token operator">!=</span> Conditions<span class="token punctuation">;</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Example:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> PatientName
<span class="token keyword">FROM</span> Patients
<span class="token keyword">WHERE</span> Age <span class="token operator">&lt;&gt;</span> â€˜<span class="token number">35</span>â€™<span class="token punctuation">;</span>
â€“<span class="token operator">OR</span>
<span class="token keyword">SELECT</span> PatientName
<span class="token keyword">FROM</span> Patients
<span class="token keyword">WHERE</span> Age <span class="token operator">!=</span> â€˜<span class="token number">35</span>â€™<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="aggregate-functions" tabindex="-1"><a class="header-anchor" href="#aggregate-functions" aria-hidden="true">#</a> AGGREGATE FUNCTIONS</h4><p>Aggregate functions as the name suggests, help the users perform simple operations in MySQL as follows</p><ul><li>SUM()</li><li>AVG()</li><li>MIN()</li><li>MAX()</li><li>COUNT()</li><li>FIRST()</li><li>LAST()</li></ul><h4 id="_51-sum" tabindex="-1"><a class="header-anchor" href="#_51-sum" aria-hidden="true">#</a> 51. SUM</h4><p>Used to return the addition of a numeric column from a table.</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token function">SUM</span><span class="token punctuation">(</span>ColumnName<span class="token punctuation">)</span>
<span class="token keyword">FROM</span> TableName<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>Example:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token function">SUM</span><span class="token punctuation">(</span>Age<span class="token punctuation">)</span>
<span class="token keyword">FROM</span> Patients<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_52-avg" tabindex="-1"><a class="header-anchor" href="#_52-avg" aria-hidden="true">#</a> 52. AVG</h4><p>Used to return the average value of a numeric column from a table.</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token function">AVG</span><span class="token punctuation">(</span>ColumnName<span class="token punctuation">)</span>
<span class="token keyword">FROM</span> TableName<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>Example:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token function">AVG</span><span class="token punctuation">(</span>Age<span class="token punctuation">)</span>
<span class="token keyword">FROM</span> Patients<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_53-min" tabindex="-1"><a class="header-anchor" href="#_53-min" aria-hidden="true">#</a> 53. MIN</h4><p>Used to return the smallest value from a column of a table.</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token function">MIN</span><span class="token punctuation">(</span>ColumnName<span class="token punctuation">)</span>
<span class="token keyword">FROM</span> TableName<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>Example:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token function">MIN</span><span class="token punctuation">(</span>Age<span class="token punctuation">)</span>
<span class="token keyword">FROM</span> Patients<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_54-max" tabindex="-1"><a class="header-anchor" href="#_54-max" aria-hidden="true">#</a> 54. MAX</h4><p>Used to return the largest value from a column of a table.</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token function">MAX</span><span class="token punctuation">(</span>ColumnName<span class="token punctuation">)</span>
<span class="token keyword">FROM</span> TableName<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>Example:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token function">MAX</span><span class="token punctuation">(</span>Age<span class="token punctuation">)</span>
<span class="token keyword">FROM</span> Patients<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_55-count" tabindex="-1"><a class="header-anchor" href="#_55-count" aria-hidden="true">#</a> 55. COUNT</h4><p>Used to return the count of elements in a column of a table.</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span>ColumnName<span class="token punctuation">)</span>
<span class="token keyword">FROM</span> TableName<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>Example:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span>Age<span class="token punctuation">)</span>
<span class="token keyword">FROM</span> Patients<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_56-first" tabindex="-1"><a class="header-anchor" href="#_56-first" aria-hidden="true">#</a> 56. FIRST</h4><p>Used to return the first value of a column from a table.</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> ColumnName
<span class="token keyword">FROM</span> TableName
<span class="token keyword">LIMIT</span> <span class="token number">1</span><span class="token punctuation">;</span>
â€“<span class="token keyword">Select</span> <span class="token keyword">first</span> <span class="token number">3</span> records
<span class="token keyword">SELECT</span> ColumnName
<span class="token keyword">FROM</span> TableName
<span class="token keyword">LIMIT</span> <span class="token number">3</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Example:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> PatientID<span class="token punctuation">,</span> Age
<span class="token keyword">FROM</span> Patients
<span class="token keyword">LIMIT</span> <span class="token number">1</span><span class="token punctuation">;</span>
â€“ <span class="token keyword">Select</span> <span class="token keyword">first</span> <span class="token number">3</span> records
<span class="token keyword">SELECT</span> PatientID<span class="token punctuation">,</span> Age
<span class="token keyword">FROM</span> Patients
<span class="token keyword">LIMIT</span> <span class="token number">3</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_57-last" tabindex="-1"><a class="header-anchor" href="#_57-last" aria-hidden="true">#</a> 57. LAST</h4><p>Used to return the last value of a column from a table.</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> ColumnName
<span class="token keyword">FROM</span> TableName
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> ColumnName <span class="token keyword">DESC</span>
<span class="token keyword">LIMIT</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Example:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> PatientID<span class="token punctuation">,</span> Age
<span class="token keyword">FROM</span> Patients
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> PatientID <span class="token keyword">DESC</span>
<span class="token keyword">LIMIT</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="set-operations" tabindex="-1"><a class="header-anchor" href="#set-operations" aria-hidden="true">#</a> SET OPERATIONS</h4><p>There are three set operations used on a daily basis in manipulating databases. They are:</p><ul><li>UNION</li><li>INTERSECT</li><li>MINUS</li></ul><h4 id="_58-union" tabindex="-1"><a class="header-anchor" href="#_58-union" aria-hidden="true">#</a> 58. UNION</h4><p>Used to combine the output of two or more SELECT queries. Here, you should remember that the data types and the number of columns must be the same. Also, once the rows are combined, the UNION operation removes duplicate rows.</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> ColumnName <span class="token keyword">FROM</span> Table1
<span class="token keyword">UNION</span>
<span class="token keyword">SELECT</span> ColumnName <span class="token keyword">FROM</span> Table2<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Example:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> PatientID <span class="token keyword">FROM</span> Patients
<span class="token keyword">UNION</span>
<span class="token keyword">SELECT</span> PatientID <span class="token keyword">FROM</span> Patients2<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_59-union-all" tabindex="-1"><a class="header-anchor" href="#_59-union-all" aria-hidden="true">#</a> 59. UNION ALL</h4><p>Used to combine the output of two or more SELECT queries. Here, you should remember that the data types and the number of columns must be the same. Also, once the rows are combined, the UNION ALL operation DOES NOT remove duplicate rows.</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> ColumnName <span class="token keyword">FROM</span> Table1
<span class="token keyword">UNION</span> <span class="token keyword">ALL</span>
<span class="token keyword">SELECT</span> ColumnName <span class="token keyword">FROM</span> Table2<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Example:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> PatientID <span class="token keyword">FROM</span> Patients
<span class="token keyword">UNION</span> <span class="token keyword">ALL</span>
<span class="token keyword">SELECT</span> PatientID <span class="token keyword">FROM</span> Patients2<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_60-intersect" tabindex="-1"><a class="header-anchor" href="#_60-intersect" aria-hidden="true">#</a> 60. INTERSECT</h4><p>Used to return the common records from two or more SELECT queries. Here, you should remember that the data types and the number of columns must be the same. Also, the INTERSECT operation will sort the data in ascending order automatically.</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> ColumnName <span class="token keyword">FROM</span> Table1
<span class="token keyword">INTERSECT</span>
<span class="token keyword">SELECT</span> ColumnName <span class="token keyword">FROM</span> Table2<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Example:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> PatientID <span class="token keyword">FROM</span> Patients
<span class="token keyword">INTERSECT</span>
<span class="token keyword">SELECT</span> PatientID <span class="token keyword">FROM</span> Patients2<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_61-minus" tabindex="-1"><a class="header-anchor" href="#_61-minus" aria-hidden="true">#</a> 61. MINUS</h4><p>Used to return rows either from the first query and not return the second query.</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> ColumnName <span class="token keyword">FROM</span> Table1
MINUS
<span class="token keyword">SELECT</span> ColumnName <span class="token keyword">FROM</span> Table2<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Example:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> PatientID <span class="token keyword">FROM</span> Patients
MINUS
<span class="token keyword">SELECT</span> PatientID <span class="token keyword">FROM</span> Patients2<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="joins" tabindex="-1"><a class="header-anchor" href="#joins" aria-hidden="true">#</a> Joins</h3><p>JOINS in MySQL are used to combine records from two or more tables, based on a relationship between tables. Letâ€™s consider the following table apart from the above Patients table, to understand the syntax of joins.</p><ul><li>LEFT JOIN</li><li>RIGHT JOIN</li><li>INNER JOIN</li><li>FULL JOIN</li></ul><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230612133415889.png" alt="image-20230612133415889"></p><h4 id="_62-left-join" tabindex="-1"><a class="header-anchor" href="#_62-left-join" aria-hidden="true">#</a> 62. LEFT JOIN:</h4><p>Returns all records from the left table along with all the records from the right table, which satisfy the condition.</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> Column1<span class="token punctuation">,</span> Column2 â€¦<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
<span class="token keyword">FROM</span> Table1
<span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span>  Table2 <span class="token keyword">ON</span> Table1<span class="token punctuation">.</span>ColumnName <span class="token operator">=</span> Table2<span class="token punctuation">.</span>ColumnName<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Example:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> Diseases<span class="token punctuation">.</span>DiseaseID<span class="token punctuation">,</span> Patients<span class="token punctuation">.</span>PatientName
<span class="token keyword">FROM</span> Diseases
<span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> Patients <span class="token keyword">ON</span> Diseases<span class="token punctuation">.</span>PatientID <span class="token operator">=</span> Patients<span class="token punctuation">.</span>PatientID
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> Diseases<span class="token punctuation">.</span>DiseaseID<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_63-right-join" tabindex="-1"><a class="header-anchor" href="#_63-right-join" aria-hidden="true">#</a> 63. RIGHT JOIN:</h4><p>Returns all records from the right table along with all the records from the left table, which satisfy the condition.</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> Column1<span class="token punctuation">,</span> Column2 â€¦<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
<span class="token keyword">FROM</span> Table1
<span class="token keyword">RIGHT</span> <span class="token keyword">JOIN</span>  Table2 <span class="token keyword">ON</span> Table1<span class="token punctuation">.</span>ColumnName <span class="token operator">=</span> Table2<span class="token punctuation">.</span>ColumnName<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Example:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> Diseases<span class="token punctuation">.</span>DiseaseID<span class="token punctuation">,</span> Patients<span class="token punctuation">.</span>PatientName
<span class="token keyword">FROM</span> Diseases
RIGHTJOIN Patients <span class="token keyword">ON</span> Diseases<span class="token punctuation">.</span>PatientID <span class="token operator">=</span> Patients<span class="token punctuation">.</span>PatientID
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> Diseases<span class="token punctuation">.</span>DiseaseID<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_64-inner-join" tabindex="-1"><a class="header-anchor" href="#_64-inner-join" aria-hidden="true">#</a> 64. INNER JOIN:</h4><p>Returns records that have matching values in both the tables.</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> Column1<span class="token punctuation">,</span> Column2 â€¦<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
<span class="token keyword">FROM</span> Table1
<span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> Table2 <span class="token keyword">ON</span> Table1<span class="token punctuation">.</span>ColumnName <span class="token operator">=</span> Table2<span class="token punctuation">.</span>ColumnName<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Example:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> Diseases<span class="token punctuation">.</span>DiseaseID<span class="token punctuation">,</span> Patients<span class="token punctuation">.</span>PatientName
<span class="token keyword">FROM</span> Diseases
<span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> Patients <span class="token keyword">ON</span> Diseases<span class="token punctuation">.</span>PatientID <span class="token operator">=</span> Patients<span class="token punctuation">.</span>PatientID<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="65"><li>FULL JOIN:</li></ol><p>Returns records that either have a match in the left or the right table.</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> Column1<span class="token punctuation">,</span> Column2 â€¦<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
<span class="token keyword">FROM</span> Table1
<span class="token keyword">FULL</span> <span class="token keyword">OUTER</span> <span class="token keyword">JOIN</span>  Table2 <span class="token keyword">ON</span> Table1<span class="token punctuation">.</span>ColumnName <span class="token operator">=</span> Table2<span class="token punctuation">.</span>ColumnName<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Example:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> Diseases<span class="token punctuation">.</span>DiseaseID<span class="token punctuation">,</span> Patients<span class="token punctuation">.</span>PatientName
<span class="token keyword">FROM</span> Diseases
<span class="token keyword">FULL</span> <span class="token keyword">OUTER</span> <span class="token keyword">JOIN</span> Patients <span class="token keyword">ON</span> Diseases<span class="token punctuation">.</span>PatientID <span class="token operator">=</span> Patients<span class="token punctuation">.</span>PatientID<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="index" tabindex="-1"><a class="header-anchor" href="#index" aria-hidden="true">#</a> Index</h3><p>Indexes are lookup tables used to retrieve data. An index as the name suggests acts as a pointer to the data present in the table.</p><ul><li>CREATE INDEX</li><li>ALTER INDEX</li><li>DROP INDEX</li></ul><h4 id="_66-create-index" tabindex="-1"><a class="header-anchor" href="#_66-create-index" aria-hidden="true">#</a> 66. CREATE INDEX</h4><p>Used to create an index for a table.</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> IndexName <span class="token keyword">ON</span> TableName<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Example:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> SampleIndex <span class="token keyword">ON</span> Patients<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="_67-alter-index" tabindex="-1"><a class="header-anchor" href="#_67-alter-index" aria-hidden="true">#</a> 67. ALTER INDEX</h4><p>Used to alter an index</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">ALTER</span> <span class="token keyword">INDEX</span> IndexName <span class="token keyword">ON</span> ObjectName<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Example:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">ALTER</span> <span class="token keyword">INDEX</span> SampleIndex <span class="token keyword">ON</span> PatName<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="_68-drop-index" tabindex="-1"><a class="header-anchor" href="#_68-drop-index" aria-hidden="true">#</a> 68. DROP INDEX</h4><p>Used to delete or remove an index</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">DROP</span> <span class="token keyword">INDEX</span> IndexName<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Example:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">DROP</span> <span class="token keyword">INDEX</span> SampleIndex<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="privilege-commands" tabindex="-1"><a class="header-anchor" href="#privilege-commands" aria-hidden="true">#</a> Privilege Commands</h3><p>The Data Control commands are used to control the privileges of a database. The commands are:</p><ul><li>GRANT</li><li>REVOKE</li></ul><h4 id="_69-grant" tabindex="-1"><a class="header-anchor" href="#_69-grant" aria-hidden="true">#</a> 69. GRANT</h4><p>Used to provide users with the privileges for a database.</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">GRANT</span> <span class="token keyword">Privileges</span> <span class="token keyword">ON</span> Objects <span class="token keyword">TO</span> <span class="token keyword">user</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Example:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">GRANT</span> <span class="token keyword">CREATE</span> <span class="token keyword">ANY</span> <span class="token keyword">TABLE</span> <span class="token keyword">TO</span> localhost<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="_70-revoke" tabindex="-1"><a class="header-anchor" href="#_70-revoke" aria-hidden="true">#</a> 70. REVOKE</h4><p>Used to withdraw the privileges given to the users.</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">REVOKE</span> <span class="token keyword">privileges</span> <span class="token keyword">ON</span> object <span class="token keyword">FROM</span> <span class="token keyword">user</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Example:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">REVOKE</span> <span class="token keyword">INSERT</span> <span class="token keyword">ON</span> <span class="token operator">*</span><span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">FROM</span> Patients<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="triggers" tabindex="-1"><a class="header-anchor" href="#triggers" aria-hidden="true">#</a> Triggers</h3><p>Triggers are a set of SQL statements that are invoked automatically in response to an event. Every trigger, associated with a table, is activated by DML commands such as INSERT, UPDATE, and DELETE.</p><p><em>There are two types of triggers:</em></p><ul><li><strong>Row-Level Trigger:</strong> Activated for each row, affected by INSERT, UPDATE or DELETE commands.</li><li><strong>Statement-Level Trigger:</strong> Activated for each of the events which occurs, irrespective of any of the DML commands.</li></ul><blockquote><p><strong>Types of Actions in Triggers</strong></p><ul><li><strong>Before Insert:</strong> Activated before the data is inserted into the table.</li><li><strong>After Insert:</strong> Activated after the data is inserted into the table..</li><li><strong>Before Delete:</strong> Activated before the removal of data from the table.</li><li><strong>After Delete:</strong> Activated after the removal of data from the table.</li><li><strong>Before Update:</strong> Activated before the data being updated in the table.</li><li><strong>After Update:</strong> Activated after the data being updated in the table</li></ul></blockquote><h4 id="_71-create-trigger" tabindex="-1"><a class="header-anchor" href="#_71-create-trigger" aria-hidden="true">#</a> 71. CREATE TRIGGER</h4><p>Used to create a trigger in MySQL.</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TRIGGER</span> TriggerName    
    <span class="token punctuation">(</span><span class="token keyword">AFTER</span> <span class="token operator">|</span> BEFORE<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">INSERT</span> <span class="token operator">|</span> <span class="token keyword">UPDATE</span> <span class="token operator">|</span> <span class="token keyword">DELETE</span><span class="token punctuation">)</span>  
         <span class="token keyword">ON</span> TableName <span class="token keyword">FOR EACH ROW</span>    
         <span class="token keyword">BEGIN</span>    
        <span class="token comment">--Declarations    </span>
        <span class="token comment">--Trigger Code    </span>
        <span class="token keyword">END</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="transaction-commands" tabindex="-1"><a class="header-anchor" href="#transaction-commands" aria-hidden="true">#</a> Transaction Commands</h3><p>Transaction commands deal with all the transactions related to the database. The commands are:</p><ul><li>COMMIT</li><li>ROLLBACK</li><li>SAVEPOINT <ul><li>RELEASE SAVEPOINT</li></ul></li><li>SET TRANSACTION</li></ul><h4 id="_72-commit" tabindex="-1"><a class="header-anchor" href="#_72-commit" aria-hidden="true">#</a> 72. COMMIT</h4><p>Used to save all the transactions of the database since the last COMMIT or ROLLBACK command.</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">COMMIT</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Example:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> Patients <span class="token keyword">WHERE</span> Age <span class="token operator">&gt;</span> <span class="token number">45</span><span class="token punctuation">;</span>
<span class="token keyword">COMMIT</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_73-rollback" tabindex="-1"><a class="header-anchor" href="#_73-rollback" aria-hidden="true">#</a> 73. ROLLBACK</h4><p>Used to undo all the transactions since the last COMMIT or ROLLBACK.</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">ROLLBACK</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Example:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> Patients <span class="token keyword">WHERE</span> Age <span class="token operator">&gt;</span> <span class="token number">45</span><span class="token punctuation">;</span>
<span class="token keyword">ROLLBACK</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_74-savepoint" tabindex="-1"><a class="header-anchor" href="#_74-savepoint" aria-hidden="true">#</a> 74. SAVEPOINT</h4><p>Used to roll the transaction back to a certain point without actually rolling back the entire transaction.</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">--Save the SAVEPOINT</span>
<span class="token keyword">SAVEPOINT</span> SAVEPOINTNAME<span class="token punctuation">;</span> 
<span class="token comment">--Rollback to the Savepoint</span>
<span class="token keyword">ROLLBACK</span> <span class="token keyword">TO</span> SAVEPOINTNAME<span class="token punctuation">;</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Example:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SAVEPOINT</span> EX1<span class="token punctuation">;</span>
<span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> Patients <span class="token keyword">WHERE</span> Age <span class="token operator">&gt;</span> <span class="token number">45</span><span class="token punctuation">;</span>
<span class="token keyword">SAVEPOINT</span> EX2<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_74-1-release-savepoint" tabindex="-1"><a class="header-anchor" href="#_74-1-release-savepoint" aria-hidden="true">#</a> 74.1 RELEASE SAVEPOINT</h4><p>Used to remove a SAVEPOINT created previously.</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">RELEASE</span> <span class="token keyword">SAVEPOINT</span> SAVEPOINTNAME<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Example:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">RELEASE</span> <span class="token keyword">SAVEPOINT</span> EX1<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="_75-set-transaction" tabindex="-1"><a class="header-anchor" href="#_75-set-transaction" aria-hidden="true">#</a> 75. SET TRANSACTION</h4><p>Used to give a name to the transaction.</p><p>Syntax:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SET</span> <span class="token keyword">TRANSACTION</span> <span class="token punctuation">[</span> <span class="token keyword">READ</span> <span class="token keyword">WRITE</span> <span class="token operator">|</span> <span class="token keyword">READ</span> ONLY <span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="mysqlå®æˆ˜45è®²ç²¾é€‰" tabindex="-1"><a class="header-anchor" href="#mysqlå®æˆ˜45è®²ç²¾é€‰" aria-hidden="true">#</a> MySQLå®æˆ˜45è®²ç²¾é€‰</h2><blockquote><p>https://funnylog.gitee.io/mysql45/</p></blockquote><h3 id="_00å¼€ç¯‡è¯-è¿™ä¸€æ¬¡-è®©æˆ‘ä»¬ä¸€èµ·æ¥ææ‡‚mysql" tabindex="-1"><a class="header-anchor" href="#_00å¼€ç¯‡è¯-è¿™ä¸€æ¬¡-è®©æˆ‘ä»¬ä¸€èµ·æ¥ææ‡‚mysql" aria-hidden="true">#</a> 00å¼€ç¯‡è¯ è¿™ä¸€æ¬¡ï¼Œè®©æˆ‘ä»¬ä¸€èµ·æ¥ææ‡‚MySQL</h3><p>ä½ å¥½ï¼Œæˆ‘æ˜¯æ—æ™“æ–Œï¼Œç½‘åâ€œä¸å¥‡â€ï¼Œæ¬¢è¿åŠ å…¥æˆ‘çš„ä¸“æ ï¼Œå’Œæˆ‘ä¸€èµ·å¼€å§‹ MySQL å­¦ä¹ ä¹‹æ—…ã€‚æˆ‘æ›¾å…ˆååœ¨ç™¾åº¦å’Œé˜¿é‡Œä»»èŒï¼Œä»äº‹ MySQL æ•°æ®åº“æ–¹é¢çš„å·¥ä½œï¼Œä¸€æ­¥æ­¥åœ°ä»ä¸€ä¸ªæ•°æ®åº“å°ç™½æˆä¸º MySQL å†…æ ¸å¼€å‘äººå‘˜ã€‚å›æƒ³èµ·æ¥ï¼Œä»æˆ‘ç¬¬ä¸€æ¬¡å¸¦ç€ç–‘é—®ç¿» MySQL çš„æºç æŸ¥åˆ°ç­”æ¡ˆè‡³ä»Šï¼Œå·²ç»æœ‰åä¸ªå¹´å¤´äº†ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œèµ°äº†ä¸å°‘å¼¯è·¯ï¼Œä½†åŒæ—¶ä¹Ÿæ”¶è·äº†å¾ˆå¤šçš„çŸ¥è¯†å’Œæ€è€ƒï¼Œå¸Œæœ›èƒ½åœ¨è¿™ä¸ªä¸“æ é‡Œåˆ†äº«ç»™ä½ ã€‚</p><p>è®°å¾—åˆšå¼€å§‹æ¥è§¦ MySQLï¼Œæ˜¯æˆ‘åœ¨ç™¾åº¦è´´å§åšæƒé™ç³»ç»Ÿçš„æ—¶å€™ã€‚æˆ‘ä»¬é‡åˆ°äº†ä¸€ä¸ªå¥‡æ€ªçš„é—®é¢˜ï¼Œä¸€ä¸ªæ­£å¸¸ 10 æ¯«ç§’å°±èƒ½å®Œæˆçš„ SQL æŸ¥è¯¢è¯·æ±‚å¶å°”è¦æ‰§è¡Œ 100 å¤šæ¯«ç§’æ‰ç»“æŸã€‚å½“æ—¶ä¸»ç®¡é—®æˆ‘æ˜¯ä»€ä¹ˆåŸå› ï¼Œæˆ‘å…¶å®ä¹Ÿæä¸æ¸…æ¥šï¼Œå°±ä¸Šç½‘æŸ¥ç­”æ¡ˆï¼Œä½†æ€ä¹ˆæ‰¾éƒ½æ‰¾ä¸åˆ°ï¼Œåˆè„¸çš®è–„ä¸æƒ³è¯´è‡ªå·±ä¸çŸ¥é“ï¼Œåªå¥½ç¡¬ç€å¤´çš®ç¿»æºç ã€‚åæ¥é‡åˆ°äº†è¶Šæ¥è¶Šå¤šçš„é—®é¢˜ï¼Œä¹Ÿæ˜¯ç±»ä¼¼çš„æƒ…æ™¯ï¼Œæ‰€ä»¥æˆ‘é€æ­¥å…»æˆäº†é€šè¿‡åˆ†ææºç ç†è§£åŸç†çš„ä¹ æƒ¯ã€‚</p><p>å½“æ—¶ï¼Œæˆ‘è‡ªå·±çš„æ„Ÿè§‰æ˜¯ï¼Œå³ä½¿æˆ‘åªæ˜¯ä¸€ä¸ªå¼€å‘å·¥ç¨‹å¸ˆï¼Œåªæ˜¯ MySQL çš„ç”¨æˆ·ï¼Œåœ¨äº†è§£äº†ä¸€ä¸ªä¸ªç³»ç»Ÿæ¨¡å—çš„åŸç†åï¼Œå†æ¥ä½¿ç”¨å®ƒï¼Œæ„Ÿè§‰æ˜¯å®Œå…¨ä¸ä¸€æ ·çš„ã€‚å½“åœ¨ä»£ç é‡Œå†™ä¸‹ä¸€è¡Œæ•°æ®åº“å‘½ä»¤çš„æ—¶å€™ï¼Œæˆ‘å°±èƒ½æƒ³åˆ°å®ƒåœ¨æ•°æ®åº“ç«¯å°†æ€ä¹ˆæ‰§è¡Œï¼Œå®ƒçš„æ€§èƒ½æ˜¯æ€ä¹ˆæ ·çš„ï¼Œæ€æ ·å†™èƒ½è®©æˆ‘çš„åº”ç”¨ç¨‹åºè®¿é—®æ•°æ®åº“çš„æ€§èƒ½æœ€é«˜ã€‚è¿›ä¸€æ­¥ï¼Œå“ªäº›æ•°æ®å¤„ç†è®©æ•°æ®åº“ç³»ç»Ÿæ¥åšæ€§èƒ½ä¼šæ›´å¥½ï¼Œå“ªäº›æ•°æ®å¤„ç†åœ¨ç¼“å­˜é‡Œåšæ€§èƒ½ä¼šæ›´å¥½ï¼Œæˆ‘å¿ƒé‡Œä¹Ÿä¼šæ›´æ¸…æ¥šã€‚åœ¨å»ºè¡¨å’Œå»ºç´¢å¼•çš„æ—¶å€™ï¼Œæˆ‘ä¹Ÿä¼šæ›´æœ‰æ„è¯†åœ°ä¸ºå°†æ¥çš„æŸ¥è¯¢ä¼˜åŒ–åšç»¼åˆè€ƒè™‘ï¼Œæ¯”å¦‚ç¡®å®šæ˜¯å¦ä½¿ç”¨é€’å¢ä¸»é”®ã€ä¸»é”®çš„åˆ—æ€æ ·é€‰æ‹©ï¼Œç­‰ç­‰ã€‚</p><p>ä½†éšåæˆ‘åˆæœ‰äº†ä¸€ä¸ªæ–°çš„å›°æƒ‘ï¼Œæˆ‘è§‰å¾—è‡ªå·±äº†è§£çš„ MySQL çŸ¥è¯†ç‚¹æ˜¯é›¶æ•£çš„ï¼Œæ²¡æœ‰å½¢æˆç½‘ç»œã€‚äºæ˜¯è§£å†³å®Œä¸€ä¸ªé—®é¢˜åï¼Œå¾ˆå®¹æ˜“å¿˜è®°ã€‚å†ç¢°åˆ°ç±»ä¼¼çš„é—®é¢˜ï¼Œæˆ‘åˆå¾—å†ç¿»ä¸€æ¬¡ä»£ç ã€‚</p><p>æ‰€å¹¸åœ¨é˜¿é‡Œå·¥ä½œçš„æ—¶å€™ï¼Œæˆ‘å‚ä¸äº†é˜¿é‡Œäº‘å…³ç³»å‹æ•°æ®åº“æœåŠ¡å†…æ ¸çš„å¼€å‘ï¼Œå¹¶ä¸”è´Ÿè´£å¼€å‘å¼€æºåˆ†æ”¯ AliSQLï¼Œè®©æˆ‘å¯¹ MySQL å†…æ ¸å’Œæºç æœ‰äº†æ›´æ·±å±‚æ¬¡çš„ç ”ç©¶å’Œç†è§£ã€‚åœ¨æœåŠ¡å†…éƒ¨å®¢æˆ·å’Œå…¬æœ‰äº‘å®¢æˆ·çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘æœ‰æœºä¼šé¢å¯¹å’Œè§£å†³è¶³å¤Ÿå¤šçš„é—®é¢˜ï¼Œå†é€šè¿‡æ‰‹å†Œè¿›è¡Œç³»ç»Ÿçš„å­¦ä¹ ï¼Œç®—æ˜¯æ¯”è¾ƒåå·åœ°å°† MySQL çš„çŸ¥è¯†ç½‘ç»œè¡¥äº†èµ·æ¥ã€‚</p><p>æ‰€ä»¥ï¼Œåœ¨å›é¡¾è¿™ä¸ªè¿‡ç¨‹çš„æ—¶å€™ï¼Œæˆ‘çš„ç¬¬ä¸€ä¸ªæ„Ÿå—æ˜¯ï¼Œå¦‚æœä¸€å¼€å§‹å°±æœ‰ä¸€äº›ä»ç†è®ºåˆ°å®æˆ˜çš„ç³»ç»Ÿæ€§æŒ‡å¯¼ï¼Œé‚£è¯¥å¤šå¥½å•Šï¼Œä¹Ÿè®¸æˆ‘å¯ä»¥å­¦ä¹ å¾—æ›´å¿«äº›ã€‚</p><p>åœ¨æå®¢æ—¶é—´å›¢é˜Ÿè·Ÿæˆ‘è”ç³»ç­–åˆ’è¿™ä¸ªä¸“æ çš„æ—¶å€™ï¼Œæˆ‘è¿˜æ˜¯æŒæ€€ç–‘æ€åº¦çš„ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿç°åœ¨ä¸æ¯”å½“å¹´äº†ï¼ŒçŠ¹è®°å¾—åä½™å¹´å‰ï¼Œä½ ä½¿ç”¨ MySQL çš„è¿‡ç¨‹ä¸­ç¢°åˆ°é—®é¢˜çš„è¯ï¼ŒåŸºæœ¬ä¸Šéƒ½åªèƒ½åˆ°ä»£ç é‡Œå»æ‰¾ç­”æ¡ˆï¼Œå› ä¸ºé‚£æ—¶ç½‘ä¸Šçš„èµ„æ–™å¤ªå°‘äº†ã€‚</p><p>è€Œè¿‘åå¹´æ¥ï¼ŒMySQL åœ¨ä¸­å›½å¹¿æ³›æ™®åŠï¼ŒæŠ€æœ¯åˆ†äº«æ–‡ç« å¯ä»¥è¯´æ˜¯æµ©å¦‚çƒŸæµ·ã€‚æ‰€ä»¥ï¼Œç°åœ¨è¦ç³»ç»Ÿåœ°ä»‹ç»ä¸€é MySQL çš„è¯ï¼Œææ€•é‡Œé¢æåŠçš„å¤§å¤šæ•°çŸ¥è¯†ç‚¹ï¼Œéƒ½å¯ä»¥åœ¨ç¤¾åŒºæ–‡ç« ä¸­æ‰¾åˆ°ã€‚é‚£ä¹ˆæˆ‘ä»¬åšè¿™ä¸ªä¸“æ çš„æ„ä¹‰åœ¨å“ªé‡Œï¼Œè€Œå®ƒåˆå‡­ä»€ä¹ˆå¯ä»¥æ”¶è´¹å‘¢ï¼Ÿ</p><p>ç›´åˆ°æ”¶åˆ°æå®¢æ—¶é—´å›¢é˜Ÿçš„ç­”å¤ï¼Œæˆ‘æ‰å¼€å§‹å¯¹è¿™ä¸ªä¸“æ â€œæƒ³åšå’Œå¯ä»¥åšâ€çš„äº‹æƒ…æ„Ÿè§‰æ¸…æ™°èµ·æ¥ã€‚æ•°æ®åº“æ˜¯ä¸€ä¸ªç»¼åˆç³»ç»Ÿï¼Œå…¶èƒŒåæ˜¯å‘å±•äº†å‡ åå¹´çš„æ•°æ®åº“ç†è®ºã€‚åŒæ—¶ï¼Œæ•°æ®åº“ç³»ç»Ÿä¹Ÿæ˜¯ä¸€ä¸ªåº”ç”¨ç³»ç»Ÿï¼Œå¯èƒ½ä¸€ä¸ªä¸šåŠ¡å¼€å‘äººå‘˜ç”¨äº†ä¸¤ä¸‰å¹´ MySQLï¼Œè¿˜æœªå¿…æ¸…æ¥šé‚£äº›è‡ªå·±ä¸€ç›´åœ¨ç”¨çš„â€œæœ€ä½³å®è·µâ€ä¸ºä»€ä¹ˆæ˜¯æœ€ä½³çš„ã€‚</p><p>äºæ˜¯ï¼Œæˆ‘å¸Œæœ›è¿™ä¸ªä¸“æ èƒ½å¤Ÿå¸®åŠ©è¿™æ ·çš„ä¸€äº›å¼€å‘è€…ï¼šä»–ä»¬æ­£åœ¨ä½¿ç”¨ MySQLï¼ŒçŸ¥é“å¦‚ä½•å†™å‡ºé€»è¾‘æ­£ç¡®çš„ SQL è¯­å¥æ¥å®ç°ä¸šåŠ¡ç›®æ ‡ï¼Œå´ä¸ç¡®å®šè¿™ä¸ªè¯­å¥æ˜¯ä¸æ˜¯æœ€ä¼˜çš„ï¼›ä»–ä»¬å¬è¯´äº†ä¸€äº›ä½¿ç”¨æ•°æ®åº“çš„æœ€ä½³å®è·µï¼Œä½†æ˜¯æ›´æƒ³äº†è§£ä¸ºä»€ä¹ˆè¿™ä¹ˆåšï¼›ä»–ä»¬ä½¿ç”¨çš„æ•°æ®åº“å¶å°”ä¼šå‡ºé—®é¢˜ï¼ŒäºŸéœ€äº†è§£å¦‚ä½•æ›´å¿«é€Ÿã€æ›´å‡†ç¡®åœ°å®šä½é—®é¢˜ï¼Œç”šè‡³è‡ªå·±è§£å†³é—®é¢˜â€¦â€¦</p><p>åœ¨è¿‡å»çš„ä¸ƒå¹´é‡Œï¼Œæˆ‘å¸¦è¿‡åå‡ ä¸ªåº”å±Šæ¯•ä¸šç”Ÿï¼Œçœ‹ç€ä»–ä»¬æˆé•¿ï¼Œè¦æ±‚ä»–ä»¬åŸç†å…ˆè¡Œï¼Œå†å®è·µéªŒè¯ã€‚å‡ å¹´ä¸‹æ¥ï¼Œä»–ä»¬çš„æˆé•¿é€Ÿåº¦éƒ½å¾ˆå¿«ï¼Œå…¶ä¸­å¥½å‡ ä¸ªæ¯•ä¸šæ²¡ä¸¤å¹´å°±æˆä¸ºå›¢é˜Ÿçš„éª¨å¹²åŠ›é‡äº†ã€‚æˆ‘ä¹Ÿåœ¨ç¤¾æ‹›çš„æ—¶å€™é¢è¯•è¿‡å¾ˆå¤šæœ‰ç€ä¸é”™çš„è¿ç»´å®è·µç»éªŒå’Œèƒ½åŠ›çš„å€™é€‰äººï¼Œä½†éƒ½å› ä¸ºå¯¹æ•°æ®åº“åŸç†ä»…æœ‰ä¸€çŸ¥åŠè§£çš„äº†è§£ï¼Œè€Œæœ€ç»ˆé—æ†¾åœ°æ²¡æœ‰é€šè¿‡é¢è¯•ã€‚</p><p>å› æ­¤ï¼Œæˆ‘å¸Œæœ›è¿™ä¸ªä¸“æ èƒ½å¤Ÿæ¿€å‘å¼€å‘è€…å¯¹æ•°æ®åº“åŸç†çš„æ¢ç´¢æ¬²ï¼Œä»è€Œæ›´å¥½åœ°ç†è§£å·¥ä½œä¸­é‡åˆ°çš„é—®é¢˜ï¼Œæ›´èƒ½çŸ¥é“èƒŒåçš„ä¸ºä»€ä¹ˆã€‚æ‰€ä»¥<strong>æˆ‘ä¼šé€‰é‚£äº›å¹³æ—¶ä½¿ç”¨æ•°æ®åº“æ—¶é«˜é¢‘å‡ºç°çš„çŸ¥è¯†ï¼Œå¦‚äº‹åŠ¡ã€ç´¢å¼•ã€é”ç­‰å†…å®¹æ„æˆä¸“æ çš„ä¸»çº¿</strong>ã€‚è¿™äº›ä¸»çº¿ä¸Šæ˜¯ä¸€ä¸ªä¸ªçš„çŸ¥è¯†ç‚¹ã€‚æ¯ä¸ªç‚¹å°±æ˜¯ä¸€ä¸ªæ¦‚å¿µã€ä¸€ä¸ªæœºåˆ¶æˆ–è€…ä¸€ä¸ªåŸç†è¯´æ˜ã€‚åœ¨æ¯ä¸ªè¯´æ˜ä¹‹åï¼Œæˆ‘ä¼šå’Œä½ è®¨è®ºä¸€ä¸ªå®è·µç›¸å…³çš„é—®é¢˜ã€‚</p><p>å¸Œæœ›èƒ½ä»¥è¿™æ ·çš„æ–¹å¼ï¼Œè®©ä½ å¯¹ MySQL çš„å‡ æ¡ä¸»çº¿æœ‰ä¸€ä¸ªæ•´ä½“çš„è®¤è¯†ï¼Œå¹¶ä¸”äº†è§£åŸºæœ¬æ¦‚å¿µã€‚åœ¨ä¹‹åçš„å®è·µç¯‡ä¸­ï¼Œæˆ‘ä¼šå¼•ç”¨åˆ°è¿™äº›ä¸»çº¿çš„çŸ¥è¯†èƒŒæ™¯ï¼Œå¹¶ç€åŠ›è¯´æ˜å®ƒä»¬æ˜¯æ€æ ·æŒ‡å¯¼å®è·µçš„ã€‚è¿™æ ·ï¼Œ<strong>ä½ å¯ä»¥ä»ç‚¹åˆ°çº¿ï¼Œå†åˆ°é¢ï¼Œå½¢æˆè‡ªå·±çš„ MySQL çŸ¥è¯†ç½‘ç»œã€‚</strong></p><p>åœ¨è¿™é‡Œï¼Œæœ‰ä¸€ä»½ç›®å½•ï¼Œä½ ä¹Ÿå¯ä»¥å…ˆäº†è§£ä¸‹æ•´ä¸ªä¸“æ çš„çŸ¥è¯†ç»“æ„ã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/a78db0b99bbf1149c39b7960f7183c7e-1584367387923.jpg" alt="img"></p><p>å¦‚å‰é¢è¯´çš„ï¼Œè¿™å‡ æ¡ä¸»çº¿ä¸Šçš„æ¯ä¸ªçŸ¥è¯†ç‚¹å‡ ä¹éƒ½ä¸æ˜¯æœ€æ–°çš„ï¼Œæœ‰äº›ç”šè‡³åå¹´å‰å°±è¿™æ ·ï¼Œå¹¶æ²¡æœ‰æ”¹è¿‡ã€‚ä½†æˆ‘å¸Œæœ›é’ˆå¯¹è¿™äº›ç‚¹çš„è¯´æ˜ï¼Œå¯ä»¥è®©ä½ åœ¨ä½¿ç”¨ MySQL æ—¶å¿ƒé‡Œæ›´æœ‰åº•ï¼ŒçŸ¥é“æ€ä¹ˆåšé€‰æ‹©ï¼Œå¹¶ä¸”æ˜ç™½ä¸ºä»€ä¹ˆã€‚äº†è§£äº†åŸç†ï¼Œæ‰èƒ½åœ¨å®è·µä¸­ä¸æ–­åˆ›æ–°ï¼Œæå‡ä¸ªäººçš„ä»·å€¼å’Œå·¥ä½œè¾“å‡ºã€‚</p><p>ä»è¿™é‡Œå¼€å§‹ï¼Œè·Ÿæˆ‘ä¸€èµ·ææ‡‚ MySQL!</p><h3 id="_01-åŸºç¡€æ¶æ„-ä¸€æ¡sqlæŸ¥è¯¢è¯­å¥æ˜¯å¦‚ä½•æ‰§è¡Œçš„" tabindex="-1"><a class="header-anchor" href="#_01-åŸºç¡€æ¶æ„-ä¸€æ¡sqlæŸ¥è¯¢è¯­å¥æ˜¯å¦‚ä½•æ‰§è¡Œçš„" aria-hidden="true">#</a> 01 åŸºç¡€æ¶æ„ï¼šä¸€æ¡SQLæŸ¥è¯¢è¯­å¥æ˜¯å¦‚ä½•æ‰§è¡Œçš„ï¼Ÿ</h3><p>ä½ å¥½ï¼Œæˆ‘æ˜¯æ—æ™“æ–Œã€‚</p><p>è¿™æ˜¯ä¸“æ çš„ç¬¬ä¸€ç¯‡æ–‡ç« ï¼Œæˆ‘æƒ³æ¥è·Ÿä½ èŠèŠ MySQL çš„åŸºç¡€æ¶æ„ã€‚æˆ‘ä»¬ç»å¸¸è¯´ï¼Œçœ‹ä¸€ä¸ªäº‹å„¿åƒä¸‡ä¸è¦ç›´æ¥é™·å…¥ç»†èŠ‚é‡Œï¼Œä½ åº”è¯¥å…ˆé¸Ÿç°å…¶å…¨è²Œï¼Œè¿™æ ·èƒ½å¤Ÿå¸®åŠ©ä½ ä»é«˜ç»´åº¦ç†è§£é—®é¢˜ã€‚åŒæ ·ï¼Œå¯¹äº MySQL çš„å­¦ä¹ ä¹Ÿæ˜¯è¿™æ ·ã€‚å¹³æ—¶æˆ‘ä»¬ä½¿ç”¨æ•°æ®åº“ï¼Œçœ‹åˆ°çš„é€šå¸¸éƒ½æ˜¯ä¸€ä¸ªæ•´ä½“ã€‚æ¯”å¦‚ï¼Œä½ æœ‰ä¸ªæœ€ç®€å•çš„è¡¨ï¼Œè¡¨é‡Œåªæœ‰ä¸€ä¸ª ID å­—æ®µï¼Œåœ¨æ‰§è¡Œä¸‹é¢è¿™ä¸ªæŸ¥è¯¢è¯­å¥æ—¶ï¼š</p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> T <span class="token keyword">where</span> <span class="token class-name">ID</span><span class="token operator">=</span><span class="token number">10</span>ï¼›
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æˆ‘ä»¬çœ‹åˆ°çš„åªæ˜¯è¾“å…¥ä¸€æ¡è¯­å¥ï¼Œè¿”å›ä¸€ä¸ªç»“æœï¼Œå´ä¸çŸ¥é“è¿™æ¡è¯­å¥åœ¨ MySQL å†…éƒ¨çš„æ‰§è¡Œè¿‡ç¨‹ã€‚</p><p>æ‰€ä»¥ä»Šå¤©æˆ‘æƒ³å’Œä½ ä¸€èµ·æŠŠ MySQL æ‹†è§£ä¸€ä¸‹ï¼Œçœ‹çœ‹é‡Œé¢éƒ½æœ‰å“ªäº›â€œé›¶ä»¶â€ï¼Œå¸Œæœ›å€Ÿç”±è¿™ä¸ªæ‹†è§£è¿‡ç¨‹ï¼Œè®©ä½ å¯¹ MySQL æœ‰æ›´æ·±å…¥çš„ç†è§£ã€‚è¿™æ ·å½“æˆ‘ä»¬ç¢°åˆ° MySQL çš„ä¸€äº›å¼‚å¸¸æˆ–è€…é—®é¢˜æ—¶ï¼Œå°±èƒ½å¤Ÿç›´æˆ³æœ¬è´¨ï¼Œæ›´ä¸ºå¿«é€Ÿåœ°å®šä½å¹¶è§£å†³é—®é¢˜ã€‚</p><p>ä¸‹é¢æˆ‘ç»™å‡ºçš„æ˜¯ MySQL çš„åŸºæœ¬æ¶æ„ç¤ºæ„å›¾ï¼Œä»ä¸­ä½ å¯ä»¥æ¸…æ¥šåœ°çœ‹åˆ° SQL è¯­å¥åœ¨ MySQL çš„å„ä¸ªåŠŸèƒ½æ¨¡å—ä¸­çš„æ‰§è¡Œè¿‡ç¨‹ã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/0d2070e8f84c4801adbfa03bda1f98d9-1584367388001.png" alt="img"></p><p>MySQL çš„é€»è¾‘æ¶æ„å›¾</p><p>å¤§ä½“æ¥è¯´ï¼ŒMySQL å¯ä»¥åˆ†ä¸º Server å±‚å’Œå­˜å‚¨å¼•æ“å±‚ä¸¤éƒ¨åˆ†ã€‚</p><p>Server å±‚åŒ…æ‹¬è¿æ¥å™¨ã€æŸ¥è¯¢ç¼“å­˜ã€åˆ†æå™¨ã€ä¼˜åŒ–å™¨ã€æ‰§è¡Œå™¨ç­‰ï¼Œæ¶µç›– MySQL çš„å¤§å¤šæ•°æ ¸å¿ƒæœåŠ¡åŠŸèƒ½ï¼Œä»¥åŠæ‰€æœ‰çš„å†…ç½®å‡½æ•°ï¼ˆå¦‚æ—¥æœŸã€æ—¶é—´ã€æ•°å­¦å’ŒåŠ å¯†å‡½æ•°ç­‰ï¼‰ï¼Œæ‰€æœ‰è·¨å­˜å‚¨å¼•æ“çš„åŠŸèƒ½éƒ½åœ¨è¿™ä¸€å±‚å®ç°ï¼Œæ¯”å¦‚å­˜å‚¨è¿‡ç¨‹ã€è§¦å‘å™¨ã€è§†å›¾ç­‰ã€‚</p><p>è€Œå­˜å‚¨å¼•æ“å±‚è´Ÿè´£æ•°æ®çš„å­˜å‚¨å’Œæå–ã€‚å…¶æ¶æ„æ¨¡å¼æ˜¯æ’ä»¶å¼çš„ï¼Œæ”¯æŒ InnoDBã€MyISAMã€Memory ç­‰å¤šä¸ªå­˜å‚¨å¼•æ“ã€‚ç°åœ¨æœ€å¸¸ç”¨çš„å­˜å‚¨å¼•æ“æ˜¯ InnoDBï¼Œå®ƒä» MySQL 5.5.5 ç‰ˆæœ¬å¼€å§‹æˆä¸ºäº†é»˜è®¤å­˜å‚¨å¼•æ“ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œä½ æ‰§è¡Œ create table å»ºè¡¨çš„æ—¶å€™ï¼Œå¦‚æœä¸æŒ‡å®šå¼•æ“ç±»å‹ï¼Œé»˜è®¤ä½¿ç”¨çš„å°±æ˜¯ InnoDBã€‚ä¸è¿‡ï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡æŒ‡å®šå­˜å‚¨å¼•æ“çš„ç±»å‹æ¥é€‰æ‹©åˆ«çš„å¼•æ“ï¼Œæ¯”å¦‚åœ¨ create table è¯­å¥ä¸­ä½¿ç”¨ engine=memory, æ¥æŒ‡å®šä½¿ç”¨å†…å­˜å¼•æ“åˆ›å»ºè¡¨ã€‚ä¸åŒå­˜å‚¨å¼•æ“çš„è¡¨æ•°æ®å­˜å–æ–¹å¼ä¸åŒï¼Œæ”¯æŒçš„åŠŸèƒ½ä¹Ÿä¸åŒï¼Œåœ¨åé¢çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä¼šè®¨è®ºåˆ°å¼•æ“çš„é€‰æ‹©ã€‚</p><p>ä»å›¾ä¸­ä¸éš¾çœ‹å‡ºï¼Œä¸åŒçš„å­˜å‚¨å¼•æ“å…±ç”¨ä¸€ä¸ª<strong>Server å±‚</strong>ï¼Œä¹Ÿå°±æ˜¯ä»è¿æ¥å™¨åˆ°æ‰§è¡Œå™¨çš„éƒ¨åˆ†ã€‚ä½ å¯ä»¥å…ˆå¯¹æ¯ä¸ªç»„ä»¶çš„åå­—æœ‰ä¸ªå°è±¡ï¼Œæ¥ä¸‹æ¥æˆ‘ä¼šç»“åˆå¼€å¤´æåˆ°çš„é‚£æ¡ SQL è¯­å¥ï¼Œå¸¦ä½ èµ°ä¸€éæ•´ä¸ªæ‰§è¡Œæµç¨‹ï¼Œä¾æ¬¡çœ‹ä¸‹æ¯ä¸ªç»„ä»¶çš„ä½œç”¨ã€‚</p><h4 id="è¿æ¥å™¨" tabindex="-1"><a class="header-anchor" href="#è¿æ¥å™¨" aria-hidden="true">#</a> è¿æ¥å™¨</h4><p>ç¬¬ä¸€æ­¥ï¼Œä½ ä¼šå…ˆè¿æ¥åˆ°è¿™ä¸ªæ•°æ®åº“ä¸Šï¼Œè¿™æ—¶å€™æ¥å¾…ä½ çš„å°±æ˜¯è¿æ¥å™¨ã€‚è¿æ¥å™¨è´Ÿè´£è·Ÿå®¢æˆ·ç«¯å»ºç«‹è¿æ¥ã€è·å–æƒé™ã€ç»´æŒå’Œç®¡ç†è¿æ¥ã€‚è¿æ¥å‘½ä»¤ä¸€èˆ¬æ˜¯è¿™ä¹ˆå†™çš„ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysql -h<span class="token variable">$ip</span> -P<span class="token variable">$port</span> -u<span class="token variable">$user</span> <span class="token parameter variable">-p</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>è¾“å®Œå‘½ä»¤ä¹‹åï¼Œä½ å°±éœ€è¦åœ¨äº¤äº’å¯¹è¯é‡Œé¢è¾“å…¥å¯†ç ã€‚è™½ç„¶å¯†ç ä¹Ÿå¯ä»¥ç›´æ¥è·Ÿåœ¨ -p åé¢å†™åœ¨å‘½ä»¤è¡Œä¸­ï¼Œä½†è¿™æ ·å¯èƒ½ä¼šå¯¼è‡´ä½ çš„å¯†ç æ³„éœ²ã€‚å¦‚æœä½ è¿çš„æ˜¯ç”Ÿäº§æœåŠ¡å™¨ï¼Œå¼ºçƒˆå»ºè®®ä½ ä¸è¦è¿™ä¹ˆåšã€‚</p><p>è¿æ¥å‘½ä»¤ä¸­çš„ mysql æ˜¯å®¢æˆ·ç«¯å·¥å…·ï¼Œç”¨æ¥è·ŸæœåŠ¡ç«¯å»ºç«‹è¿æ¥ã€‚åœ¨å®Œæˆç»å…¸çš„ TCP æ¡æ‰‹åï¼Œè¿æ¥å™¨å°±è¦å¼€å§‹è®¤è¯ä½ çš„èº«ä»½ï¼Œè¿™ä¸ªæ—¶å€™ç”¨çš„å°±æ˜¯ä½ è¾“å…¥çš„ç”¨æˆ·åå’Œå¯†ç ã€‚</p><ul><li>å¦‚æœç”¨æˆ·åæˆ–å¯†ç ä¸å¯¹ï¼Œä½ å°±ä¼šæ”¶åˆ°ä¸€ä¸ª&quot;Access denied for user&quot;çš„é”™è¯¯ï¼Œç„¶åå®¢æˆ·ç«¯ç¨‹åºç»“æŸæ‰§è¡Œã€‚</li><li>å¦‚æœç”¨æˆ·åå¯†ç è®¤è¯é€šè¿‡ï¼Œè¿æ¥å™¨ä¼šåˆ°æƒé™è¡¨é‡Œé¢æŸ¥å‡ºä½ æ‹¥æœ‰çš„æƒé™ã€‚ä¹‹åï¼Œè¿™ä¸ªè¿æ¥é‡Œé¢çš„æƒé™åˆ¤æ–­é€»è¾‘ï¼Œéƒ½å°†ä¾èµ–äºæ­¤æ—¶è¯»åˆ°çš„æƒé™ã€‚</li></ul><p>è¿™å°±æ„å‘³ç€ï¼Œä¸€ä¸ªç”¨æˆ·æˆåŠŸå»ºç«‹è¿æ¥åï¼Œå³ä½¿ä½ ç”¨ç®¡ç†å‘˜è´¦å·å¯¹è¿™ä¸ªç”¨æˆ·çš„æƒé™åšäº†ä¿®æ”¹ï¼Œä¹Ÿä¸ä¼šå½±å“å·²ç»å­˜åœ¨è¿æ¥çš„æƒé™ã€‚ä¿®æ”¹å®Œæˆåï¼Œåªæœ‰å†æ–°å»ºçš„è¿æ¥æ‰ä¼šä½¿ç”¨æ–°çš„æƒé™è®¾ç½®ã€‚</p><p>è¿æ¥å®Œæˆåï¼Œå¦‚æœä½ æ²¡æœ‰åç»­çš„åŠ¨ä½œï¼Œè¿™ä¸ªè¿æ¥å°±å¤„äºç©ºé—²çŠ¶æ€ï¼Œä½ å¯ä»¥åœ¨ show processlist å‘½ä»¤ä¸­çœ‹åˆ°å®ƒã€‚æ–‡æœ¬ä¸­è¿™ä¸ªå›¾æ˜¯ show processlist çš„ç»“æœï¼Œå…¶ä¸­çš„ Command åˆ—æ˜¾ç¤ºä¸ºâ€œSleepâ€çš„è¿™ä¸€è¡Œï¼Œå°±è¡¨ç¤ºç°åœ¨ç³»ç»Ÿé‡Œé¢æœ‰ä¸€ä¸ªç©ºé—²è¿æ¥ã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/f2da4aa3a672d48ec05df97b9f992fed-1584367388034.png" alt="img">å®¢æˆ·ç«¯å¦‚æœå¤ªé•¿æ—¶é—´æ²¡åŠ¨é™ï¼Œè¿æ¥å™¨å°±ä¼šè‡ªåŠ¨å°†å®ƒæ–­å¼€ã€‚è¿™ä¸ªæ—¶é—´æ˜¯ç”±å‚æ•° wait_timeout æ§åˆ¶çš„ï¼Œé»˜è®¤å€¼æ˜¯ 8 å°æ—¶ã€‚</p><p>å¦‚æœåœ¨è¿æ¥è¢«æ–­å¼€ä¹‹åï¼Œå®¢æˆ·ç«¯å†æ¬¡å‘é€è¯·æ±‚çš„è¯ï¼Œå°±ä¼šæ”¶åˆ°ä¸€ä¸ªé”™è¯¯æé†’ï¼š Lost connection to MySQL server during queryã€‚è¿™æ—¶å€™å¦‚æœä½ è¦ç»§ç»­ï¼Œå°±éœ€è¦é‡è¿ï¼Œç„¶åå†æ‰§è¡Œè¯·æ±‚äº†ã€‚</p><p>æ•°æ®åº“é‡Œé¢ï¼Œé•¿è¿æ¥æ˜¯æŒ‡è¿æ¥æˆåŠŸåï¼Œå¦‚æœå®¢æˆ·ç«¯æŒç»­æœ‰è¯·æ±‚ï¼Œåˆ™ä¸€ç›´ä½¿ç”¨åŒä¸€ä¸ªè¿æ¥ã€‚çŸ­è¿æ¥åˆ™æ˜¯æŒ‡æ¯æ¬¡æ‰§è¡Œå®Œå¾ˆå°‘çš„å‡ æ¬¡æŸ¥è¯¢å°±æ–­å¼€è¿æ¥ï¼Œä¸‹æ¬¡æŸ¥è¯¢å†é‡æ–°å»ºç«‹ä¸€ä¸ªã€‚</p><p>å»ºç«‹è¿æ¥çš„è¿‡ç¨‹é€šå¸¸æ˜¯æ¯”è¾ƒå¤æ‚çš„ï¼Œæ‰€ä»¥æˆ‘å»ºè®®ä½ åœ¨ä½¿ç”¨ä¸­è¦å°½é‡å‡å°‘å»ºç«‹è¿æ¥çš„åŠ¨ä½œï¼Œä¹Ÿå°±æ˜¯å°½é‡ä½¿ç”¨é•¿è¿æ¥ã€‚</p><p>ä½†æ˜¯å…¨éƒ¨ä½¿ç”¨é•¿è¿æ¥åï¼Œä½ å¯èƒ½ä¼šå‘ç°ï¼Œæœ‰äº›æ—¶å€™ MySQL å ç”¨å†…å­˜æ¶¨å¾—ç‰¹åˆ«å¿«ï¼Œè¿™æ˜¯å› ä¸º MySQL åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸´æ—¶ä½¿ç”¨çš„å†…å­˜æ˜¯ç®¡ç†åœ¨è¿æ¥å¯¹è±¡é‡Œé¢çš„ã€‚è¿™äº›èµ„æºä¼šåœ¨è¿æ¥æ–­å¼€çš„æ—¶å€™æ‰é‡Šæ”¾ã€‚æ‰€ä»¥å¦‚æœé•¿è¿æ¥ç´¯ç§¯ä¸‹æ¥ï¼Œå¯èƒ½å¯¼è‡´å†…å­˜å ç”¨å¤ªå¤§ï¼Œè¢«ç³»ç»Ÿå¼ºè¡Œæ€æ‰ï¼ˆOOMï¼‰ï¼Œä»ç°è±¡çœ‹å°±æ˜¯ MySQL å¼‚å¸¸é‡å¯äº†ã€‚</p><p>æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿä½ å¯ä»¥è€ƒè™‘ä»¥ä¸‹ä¸¤ç§æ–¹æ¡ˆã€‚</p><ol><li>å®šæœŸæ–­å¼€é•¿è¿æ¥ã€‚ä½¿ç”¨ä¸€æ®µæ—¶é—´ï¼Œæˆ–è€…ç¨‹åºé‡Œé¢åˆ¤æ–­æ‰§è¡Œè¿‡ä¸€ä¸ªå ç”¨å†…å­˜çš„å¤§æŸ¥è¯¢åï¼Œæ–­å¼€è¿æ¥ï¼Œä¹‹åè¦æŸ¥è¯¢å†é‡è¿ã€‚</li><li>å¦‚æœä½ ç”¨çš„æ˜¯ MySQL 5.7 æˆ–æ›´æ–°ç‰ˆæœ¬ï¼Œå¯ä»¥åœ¨æ¯æ¬¡æ‰§è¡Œä¸€ä¸ªæ¯”è¾ƒå¤§çš„æ“ä½œåï¼Œé€šè¿‡æ‰§è¡Œ mysql_reset_connection æ¥é‡æ–°åˆå§‹åŒ–è¿æ¥èµ„æºã€‚è¿™ä¸ªè¿‡ç¨‹ä¸éœ€è¦é‡è¿å’Œé‡æ–°åšæƒé™éªŒè¯ï¼Œä½†æ˜¯ä¼šå°†è¿æ¥æ¢å¤åˆ°åˆšåˆšåˆ›å»ºå®Œæ—¶çš„çŠ¶æ€ã€‚</li></ol><h4 id="æŸ¥è¯¢ç¼“å­˜" tabindex="-1"><a class="header-anchor" href="#æŸ¥è¯¢ç¼“å­˜" aria-hidden="true">#</a> æŸ¥è¯¢ç¼“å­˜</h4><p>è¿æ¥å»ºç«‹å®Œæˆåï¼Œä½ å°±å¯ä»¥æ‰§è¡Œ select è¯­å¥äº†ã€‚æ‰§è¡Œé€»è¾‘å°±ä¼šæ¥åˆ°ç¬¬äºŒæ­¥ï¼šæŸ¥è¯¢ç¼“å­˜ã€‚</p><p>MySQL æ‹¿åˆ°ä¸€ä¸ªæŸ¥è¯¢è¯·æ±‚åï¼Œä¼šå…ˆåˆ°æŸ¥è¯¢ç¼“å­˜çœ‹çœ‹ï¼Œä¹‹å‰æ˜¯ä¸æ˜¯æ‰§è¡Œè¿‡è¿™æ¡è¯­å¥ã€‚ä¹‹å‰æ‰§è¡Œè¿‡çš„è¯­å¥åŠå…¶ç»“æœå¯èƒ½ä¼šä»¥ key-value å¯¹çš„å½¢å¼ï¼Œè¢«ç›´æ¥ç¼“å­˜åœ¨å†…å­˜ä¸­ã€‚key æ˜¯æŸ¥è¯¢çš„è¯­å¥ï¼Œvalue æ˜¯æŸ¥è¯¢çš„ç»“æœã€‚å¦‚æœä½ çš„æŸ¥è¯¢èƒ½å¤Ÿç›´æ¥åœ¨è¿™ä¸ªç¼“å­˜ä¸­æ‰¾åˆ° keyï¼Œé‚£ä¹ˆè¿™ä¸ª value å°±ä¼šè¢«ç›´æ¥è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p><p>å¦‚æœè¯­å¥ä¸åœ¨æŸ¥è¯¢ç¼“å­˜ä¸­ï¼Œå°±ä¼šç»§ç»­åé¢çš„æ‰§è¡Œé˜¶æ®µã€‚æ‰§è¡Œå®Œæˆåï¼Œæ‰§è¡Œç»“æœä¼šè¢«å­˜å…¥æŸ¥è¯¢ç¼“å­˜ä¸­ã€‚ä½ å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœæŸ¥è¯¢å‘½ä¸­ç¼“å­˜ï¼ŒMySQL ä¸éœ€è¦æ‰§è¡Œåé¢çš„å¤æ‚æ“ä½œï¼Œå°±å¯ä»¥ç›´æ¥è¿”å›ç»“æœï¼Œè¿™ä¸ªæ•ˆç‡ä¼šå¾ˆé«˜ã€‚</p><p><strong>ä½†æ˜¯å¤§å¤šæ•°æƒ…å†µä¸‹æˆ‘ä¼šå»ºè®®ä½ ä¸è¦ä½¿ç”¨æŸ¥è¯¢ç¼“å­˜ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºæŸ¥è¯¢ç¼“å­˜å¾€å¾€å¼Šå¤§äºåˆ©ã€‚</strong></p><p>æŸ¥è¯¢ç¼“å­˜çš„å¤±æ•ˆéå¸¸é¢‘ç¹ï¼Œåªè¦æœ‰å¯¹ä¸€ä¸ªè¡¨çš„æ›´æ–°ï¼Œè¿™ä¸ªè¡¨ä¸Šæ‰€æœ‰çš„æŸ¥è¯¢ç¼“å­˜éƒ½ä¼šè¢«æ¸…ç©ºã€‚å› æ­¤å¾ˆå¯èƒ½ä½ è´¹åŠ²åœ°æŠŠç»“æœå­˜èµ·æ¥ï¼Œè¿˜æ²¡ä½¿ç”¨å‘¢ï¼Œå°±è¢«ä¸€ä¸ªæ›´æ–°å…¨æ¸…ç©ºäº†ã€‚å¯¹äºæ›´æ–°å‹åŠ›å¤§çš„æ•°æ®åº“æ¥è¯´ï¼ŒæŸ¥è¯¢ç¼“å­˜çš„å‘½ä¸­ç‡ä¼šéå¸¸ä½ã€‚é™¤éä½ çš„ä¸šåŠ¡å°±æ˜¯æœ‰ä¸€å¼ é™æ€è¡¨ï¼Œå¾ˆé•¿æ—¶é—´æ‰ä¼šæ›´æ–°ä¸€æ¬¡ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªç³»ç»Ÿé…ç½®è¡¨ï¼Œé‚£è¿™å¼ è¡¨ä¸Šçš„æŸ¥è¯¢æ‰é€‚åˆä½¿ç”¨æŸ¥è¯¢ç¼“å­˜ã€‚</p><p>å¥½åœ¨ MySQL ä¹Ÿæä¾›äº†è¿™ç§â€œæŒ‰éœ€ä½¿ç”¨â€çš„æ–¹å¼ã€‚ä½ å¯ä»¥å°†å‚æ•° query_cache_type è®¾ç½®æˆ DEMANDï¼Œè¿™æ ·å¯¹äºé»˜è®¤çš„ SQL è¯­å¥éƒ½ä¸ä½¿ç”¨æŸ¥è¯¢ç¼“å­˜ã€‚è€Œå¯¹äºä½ ç¡®å®šè¦ä½¿ç”¨æŸ¥è¯¢ç¼“å­˜çš„è¯­å¥ï¼Œå¯ä»¥ç”¨ SQL_CACHE æ˜¾å¼æŒ‡å®šï¼Œåƒä¸‹é¢è¿™ä¸ªè¯­å¥ä¸€æ ·ï¼š</p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> SQL_CACHE <span class="token operator">*</span> <span class="token keyword">from</span> T <span class="token keyword">where</span> <span class="token class-name">ID</span><span class="token operator">=</span><span class="token number">10</span>ï¼›
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒMySQL 8.0 ç‰ˆæœ¬ç›´æ¥å°†æŸ¥è¯¢ç¼“å­˜çš„æ•´å—åŠŸèƒ½åˆ æ‰äº†ï¼Œä¹Ÿå°±æ˜¯è¯´ 8.0 å¼€å§‹å½»åº•æ²¡æœ‰è¿™ä¸ªåŠŸèƒ½äº†ã€‚</p><h4 id="åˆ†æå™¨" tabindex="-1"><a class="header-anchor" href="#åˆ†æå™¨" aria-hidden="true">#</a> åˆ†æå™¨</h4><p>å¦‚æœæ²¡æœ‰å‘½ä¸­æŸ¥è¯¢ç¼“å­˜ï¼Œå°±è¦å¼€å§‹çœŸæ­£æ‰§è¡Œè¯­å¥äº†ã€‚é¦–å…ˆï¼ŒMySQL éœ€è¦çŸ¥é“ä½ è¦åšä»€ä¹ˆï¼Œå› æ­¤éœ€è¦å¯¹ SQL è¯­å¥åšè§£æã€‚</p><p>åˆ†æå™¨å…ˆä¼šåšâ€œè¯æ³•åˆ†æâ€ã€‚ä½ è¾“å…¥çš„æ˜¯ç”±å¤šä¸ªå­—ç¬¦ä¸²å’Œç©ºæ ¼ç»„æˆçš„ä¸€æ¡ SQL è¯­å¥ï¼ŒMySQL éœ€è¦è¯†åˆ«å‡ºé‡Œé¢çš„å­—ç¬¦ä¸²åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Œä»£è¡¨ä»€ä¹ˆã€‚</p><p>MySQL ä»ä½ è¾“å…¥çš„&quot;select&quot;è¿™ä¸ªå…³é”®å­—è¯†åˆ«å‡ºæ¥ï¼Œè¿™æ˜¯ä¸€ä¸ªæŸ¥è¯¢è¯­å¥ã€‚å®ƒä¹Ÿè¦æŠŠå­—ç¬¦ä¸²â€œTâ€è¯†åˆ«æˆâ€œè¡¨å Tâ€ï¼ŒæŠŠå­—ç¬¦ä¸²â€œIDâ€è¯†åˆ«æˆâ€œåˆ— IDâ€ã€‚</p><p>åšå®Œäº†è¿™äº›è¯†åˆ«ä»¥åï¼Œå°±è¦åšâ€œè¯­æ³•åˆ†æâ€ã€‚æ ¹æ®è¯æ³•åˆ†æçš„ç»“æœï¼Œè¯­æ³•åˆ†æå™¨ä¼šæ ¹æ®è¯­æ³•è§„åˆ™ï¼Œåˆ¤æ–­ä½ è¾“å…¥çš„è¿™ä¸ª SQL è¯­å¥æ˜¯å¦æ»¡è¶³ MySQL è¯­æ³•ã€‚</p><p>å¦‚æœä½ çš„è¯­å¥ä¸å¯¹ï¼Œå°±ä¼šæ”¶åˆ°â€œYou have an error in your SQL syntaxâ€çš„é”™è¯¯æé†’ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ä¸ªè¯­å¥ select å°‘æ‰“äº†å¼€å¤´çš„å­—æ¯â€œsâ€ã€‚</p><div class="language-vbnet line-numbers-mode" data-ext="vbnet"><pre class="language-vbnet"><code>mysql<span class="token operator">&gt;</span> elect <span class="token operator">*</span> from t where ID<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> 
<span class="token keyword">ERROR</span> <span class="token number">1064</span> <span class="token punctuation">(</span><span class="token number">42000</span><span class="token punctuation">)</span><span class="token punctuation">:</span> You have an <span class="token keyword">error</span> <span class="token keyword">in</span> your SQL syntax<span class="token punctuation">;</span> check the manual that corresponds <span class="token keyword">to</span> your MySQL server version <span class="token keyword">for</span> the <span class="token function">right</span> syntax <span class="token keyword">to</span> <span class="token function">use</span> near <span class="token comment">&#39;elect * from t where ID=1&#39; at line 1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸€èˆ¬è¯­æ³•é”™è¯¯ä¼šæç¤ºç¬¬ä¸€ä¸ªå‡ºç°é”™è¯¯çš„ä½ç½®ï¼Œæ‰€ä»¥ä½ è¦å…³æ³¨çš„æ˜¯ç´§æ¥â€œuse nearâ€çš„å†…å®¹ã€‚</p><h4 id="ä¼˜åŒ–å™¨" tabindex="-1"><a class="header-anchor" href="#ä¼˜åŒ–å™¨" aria-hidden="true">#</a> ä¼˜åŒ–å™¨</h4><p>ç»è¿‡äº†åˆ†æå™¨ï¼ŒMySQL å°±çŸ¥é“ä½ è¦åšä»€ä¹ˆäº†ã€‚åœ¨å¼€å§‹æ‰§è¡Œä¹‹å‰ï¼Œè¿˜è¦å…ˆç»è¿‡ä¼˜åŒ–å™¨çš„å¤„ç†ã€‚</p><p>ä¼˜åŒ–å™¨æ˜¯åœ¨è¡¨é‡Œé¢æœ‰å¤šä¸ªç´¢å¼•çš„æ—¶å€™ï¼Œå†³å®šä½¿ç”¨å“ªä¸ªç´¢å¼•ï¼›æˆ–è€…åœ¨ä¸€ä¸ªè¯­å¥æœ‰å¤šè¡¨å…³è”ï¼ˆjoinï¼‰çš„æ—¶å€™ï¼Œå†³å®šå„ä¸ªè¡¨çš„è¿æ¥é¡ºåºã€‚æ¯”å¦‚ä½ æ‰§è¡Œä¸‹é¢è¿™æ ·çš„è¯­å¥ï¼Œè¿™ä¸ªè¯­å¥æ˜¯æ‰§è¡Œä¸¤ä¸ªè¡¨çš„ joinï¼š</p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t1 <span class="token keyword">join</span> t2 <span class="token keyword">using</span><span class="token punctuation">(</span>ID<span class="token punctuation">)</span>  <span class="token keyword">where</span> <span class="token class-name">t1</span><span class="token punctuation">.</span>c<span class="token operator">=</span><span class="token number">10</span> <span class="token keyword">and</span> t2<span class="token punctuation">.</span>d<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>æ—¢å¯ä»¥å…ˆä»è¡¨ t1 é‡Œé¢å–å‡º c=10 çš„è®°å½•çš„ ID å€¼ï¼Œå†æ ¹æ® ID å€¼å…³è”åˆ°è¡¨ t2ï¼Œå†åˆ¤æ–­ t2 é‡Œé¢ d çš„å€¼æ˜¯å¦ç­‰äº 20ã€‚</li><li>ä¹Ÿå¯ä»¥å…ˆä»è¡¨ t2 é‡Œé¢å–å‡º d=20 çš„è®°å½•çš„ ID å€¼ï¼Œå†æ ¹æ® ID å€¼å…³è”åˆ° t1ï¼Œå†åˆ¤æ–­ t1 é‡Œé¢ c çš„å€¼æ˜¯å¦ç­‰äº 10ã€‚</li></ul><p>è¿™ä¸¤ç§æ‰§è¡Œæ–¹æ³•çš„é€»è¾‘ç»“æœæ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯æ‰§è¡Œçš„æ•ˆç‡ä¼šæœ‰ä¸åŒï¼Œè€Œä¼˜åŒ–å™¨çš„ä½œç”¨å°±æ˜¯å†³å®šé€‰æ‹©ä½¿ç”¨å“ªä¸€ä¸ªæ–¹æ¡ˆã€‚</p><p>ä¼˜åŒ–å™¨é˜¶æ®µå®Œæˆåï¼Œè¿™ä¸ªè¯­å¥çš„æ‰§è¡Œæ–¹æ¡ˆå°±ç¡®å®šä¸‹æ¥äº†ï¼Œç„¶åè¿›å…¥æ‰§è¡Œå™¨é˜¶æ®µã€‚å¦‚æœä½ è¿˜æœ‰ä¸€äº›ç–‘é—®ï¼Œæ¯”å¦‚ä¼˜åŒ–å™¨æ˜¯æ€ä¹ˆé€‰æ‹©ç´¢å¼•çš„ï¼Œæœ‰æ²¡æœ‰å¯èƒ½é€‰æ‹©é”™ç­‰ç­‰ï¼Œæ²¡å…³ç³»ï¼Œæˆ‘ä¼šåœ¨åé¢çš„æ–‡ç« ä¸­å•ç‹¬å±•å¼€è¯´æ˜ä¼˜åŒ–å™¨çš„å†…å®¹ã€‚</p><h4 id="æ‰§è¡Œå™¨" tabindex="-1"><a class="header-anchor" href="#æ‰§è¡Œå™¨" aria-hidden="true">#</a> æ‰§è¡Œå™¨</h4><p>MySQL é€šè¿‡åˆ†æå™¨çŸ¥é“äº†ä½ è¦åšä»€ä¹ˆï¼Œé€šè¿‡ä¼˜åŒ–å™¨çŸ¥é“äº†è¯¥æ€ä¹ˆåšï¼Œäºæ˜¯å°±è¿›å…¥äº†æ‰§è¡Œå™¨é˜¶æ®µï¼Œå¼€å§‹æ‰§è¡Œè¯­å¥ã€‚</p><p>å¼€å§‹æ‰§è¡Œçš„æ—¶å€™ï¼Œè¦å…ˆåˆ¤æ–­ä¸€ä¸‹ä½ å¯¹è¿™ä¸ªè¡¨ T æœ‰æ²¡æœ‰æ‰§è¡ŒæŸ¥è¯¢çš„æƒé™ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå°±ä¼šè¿”å›æ²¡æœ‰æƒé™çš„é”™è¯¯ï¼Œå¦‚ä¸‹æ‰€ç¤º (åœ¨å·¥ç¨‹å®ç°ä¸Šï¼Œå¦‚æœå‘½ä¸­æŸ¥è¯¢ç¼“å­˜ï¼Œä¼šåœ¨æŸ¥è¯¢ç¼“å­˜è¿”å›ç»“æœçš„æ—¶å€™ï¼Œåšæƒé™éªŒè¯ã€‚æŸ¥è¯¢ä¹Ÿä¼šåœ¨ä¼˜åŒ–å™¨ä¹‹å‰è°ƒç”¨ precheck éªŒè¯æƒé™)ã€‚</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> T <span class="token keyword">where</span> ID<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">;</span> 
ERROR <span class="token number">1142</span> <span class="token punctuation">(</span><span class="token number">42000</span><span class="token punctuation">)</span>: <span class="token keyword">SELECT</span> command denied <span class="token keyword">to</span> <span class="token keyword">user</span> <span class="token string">&#39;b&#39;</span><span class="token variable">@&#39;localhost&#39;</span> <span class="token keyword">for</span> <span class="token keyword">table</span> <span class="token string">&#39;T&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœæœ‰æƒé™ï¼Œå°±æ‰“å¼€è¡¨ç»§ç»­æ‰§è¡Œã€‚æ‰“å¼€è¡¨çš„æ—¶å€™ï¼Œæ‰§è¡Œå™¨å°±ä¼šæ ¹æ®è¡¨çš„å¼•æ“å®šä¹‰ï¼Œå»ä½¿ç”¨è¿™ä¸ªå¼•æ“æä¾›çš„æ¥å£ã€‚</p><p>æ¯”å¦‚æˆ‘ä»¬è¿™ä¸ªä¾‹å­ä¸­çš„è¡¨ T ä¸­ï¼ŒID å­—æ®µæ²¡æœ‰ç´¢å¼•ï¼Œé‚£ä¹ˆæ‰§è¡Œå™¨çš„æ‰§è¡Œæµç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><ol><li>è°ƒç”¨ InnoDB å¼•æ“æ¥å£å–è¿™ä¸ªè¡¨çš„ç¬¬ä¸€è¡Œï¼Œåˆ¤æ–­ ID å€¼æ˜¯ä¸æ˜¯ 10ï¼Œå¦‚æœä¸æ˜¯åˆ™è·³è¿‡ï¼Œå¦‚æœæ˜¯åˆ™å°†è¿™è¡Œå­˜åœ¨ç»“æœé›†ä¸­ï¼›</li><li>è°ƒç”¨å¼•æ“æ¥å£å–â€œä¸‹ä¸€è¡Œâ€ï¼Œé‡å¤ç›¸åŒçš„åˆ¤æ–­é€»è¾‘ï¼Œç›´åˆ°å–åˆ°è¿™ä¸ªè¡¨çš„æœ€åä¸€è¡Œã€‚</li><li>æ‰§è¡Œå™¨å°†ä¸Šè¿°éå†è¿‡ç¨‹ä¸­æ‰€æœ‰æ»¡è¶³æ¡ä»¶çš„è¡Œç»„æˆçš„è®°å½•é›†ä½œä¸ºç»“æœé›†è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</li></ol><p>è‡³æ­¤ï¼Œè¿™ä¸ªè¯­å¥å°±æ‰§è¡Œå®Œæˆäº†ã€‚</p><p>å¯¹äºæœ‰ç´¢å¼•çš„è¡¨ï¼Œæ‰§è¡Œçš„é€»è¾‘ä¹Ÿå·®ä¸å¤šã€‚ç¬¬ä¸€æ¬¡è°ƒç”¨çš„æ˜¯â€œå–æ»¡è¶³æ¡ä»¶çš„ç¬¬ä¸€è¡Œâ€è¿™ä¸ªæ¥å£ï¼Œä¹‹åå¾ªç¯å–â€œæ»¡è¶³æ¡ä»¶çš„ä¸‹ä¸€è¡Œâ€è¿™ä¸ªæ¥å£ï¼Œè¿™äº›æ¥å£éƒ½æ˜¯å¼•æ“ä¸­å·²ç»å®šä¹‰å¥½çš„ã€‚</p><p>ä½ ä¼šåœ¨æ•°æ®åº“çš„æ…¢æŸ¥è¯¢æ—¥å¿—ä¸­çœ‹åˆ°ä¸€ä¸ª rows_examined çš„å­—æ®µï¼Œè¡¨ç¤ºè¿™ä¸ªè¯­å¥æ‰§è¡Œè¿‡ç¨‹ä¸­æ‰«æäº†å¤šå°‘è¡Œã€‚è¿™ä¸ªå€¼å°±æ˜¯åœ¨æ‰§è¡Œå™¨æ¯æ¬¡è°ƒç”¨å¼•æ“è·å–æ•°æ®è¡Œçš„æ—¶å€™ç´¯åŠ çš„ã€‚</p><p>åœ¨æœ‰äº›åœºæ™¯ä¸‹ï¼Œæ‰§è¡Œå™¨è°ƒç”¨ä¸€æ¬¡ï¼Œåœ¨å¼•æ“å†…éƒ¨åˆ™æ‰«æäº†å¤šè¡Œï¼Œå› æ­¤**å¼•æ“æ‰«æè¡Œæ•°è·Ÿ rows_examined å¹¶ä¸æ˜¯å®Œå…¨ç›¸åŒçš„ã€‚**æˆ‘ä»¬åé¢ä¼šä¸“é—¨æœ‰ä¸€ç¯‡æ–‡ç« æ¥è®²å­˜å‚¨å¼•æ“çš„å†…éƒ¨æœºåˆ¶ï¼Œé‡Œé¢ä¼šæœ‰è¯¦ç»†çš„è¯´æ˜ã€‚</p><h4 id="å°ç»“" tabindex="-1"><a class="header-anchor" href="#å°ç»“" aria-hidden="true">#</a> å°ç»“</h4><p>ä»Šå¤©æˆ‘ç»™ä½ ä»‹ç»äº† MySQL çš„é€»è¾‘æ¶æ„ï¼Œå¸Œæœ›ä½ å¯¹ä¸€ä¸ª SQL è¯­å¥å®Œæ•´æ‰§è¡Œæµç¨‹çš„å„ä¸ªé˜¶æ®µæœ‰äº†ä¸€ä¸ªåˆæ­¥çš„å°è±¡ã€‚ç”±äºç¯‡å¹…çš„é™åˆ¶ï¼Œæˆ‘åªæ˜¯ç”¨ä¸€ä¸ªæŸ¥è¯¢çš„ä¾‹å­å°†å„ä¸ªç¯èŠ‚è¿‡äº†ä¸€éã€‚å¦‚æœä½ è¿˜å¯¹æ¯ä¸ªç¯èŠ‚çš„å±•å¼€ç»†èŠ‚å­˜æœ‰ç–‘é—®ï¼Œä¹Ÿä¸ç”¨æ‹…å¿ƒï¼Œåç»­åœ¨å®æˆ˜ç« èŠ‚ä¸­æˆ‘è¿˜ä¼šå†æåˆ°å®ƒä»¬ã€‚</p><p>æˆ‘ç»™ä½ ç•™ä¸€ä¸ªé—®é¢˜å§ï¼Œå¦‚æœè¡¨ T ä¸­æ²¡æœ‰å­—æ®µ kï¼Œè€Œä½ æ‰§è¡Œäº†è¿™ä¸ªè¯­å¥ select * from T where k=1, é‚£è‚¯å®šæ˜¯ä¼šæŠ¥â€œä¸å­˜åœ¨è¿™ä¸ªåˆ—â€çš„é”™è¯¯ï¼š â€œUnknown column â€˜kâ€™ in â€˜where clauseâ€™â€ã€‚ä½ è§‰å¾—è¿™ä¸ªé”™è¯¯æ˜¯åœ¨æˆ‘ä»¬ä¸Šé¢æåˆ°çš„å“ªä¸ªé˜¶æ®µæŠ¥å‡ºæ¥çš„å‘¢ï¼Ÿ</p><p>æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œæ¬¢è¿ä½ ç»™æˆ‘ç•™è¨€ï¼Œä¹Ÿæ¬¢è¿åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚</p><h3 id="_02-æ—¥å¿—ç³»ç»Ÿ-ä¸€æ¡sqlæ›´æ–°è¯­å¥æ˜¯å¦‚ä½•æ‰§è¡Œçš„" tabindex="-1"><a class="header-anchor" href="#_02-æ—¥å¿—ç³»ç»Ÿ-ä¸€æ¡sqlæ›´æ–°è¯­å¥æ˜¯å¦‚ä½•æ‰§è¡Œçš„" aria-hidden="true">#</a> 02 æ—¥å¿—ç³»ç»Ÿï¼šä¸€æ¡SQLæ›´æ–°è¯­å¥æ˜¯å¦‚ä½•æ‰§è¡Œçš„ï¼Ÿ</h3><p>å‰é¢æˆ‘ä»¬ç³»ç»Ÿäº†è§£äº†ä¸€ä¸ªæŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œæµç¨‹ï¼Œå¹¶ä»‹ç»äº†æ‰§è¡Œè¿‡ç¨‹ä¸­æ¶‰åŠçš„å¤„ç†æ¨¡å—ã€‚ç›¸ä¿¡ä½ è¿˜è®°å¾—ï¼Œä¸€æ¡æŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œè¿‡ç¨‹ä¸€èˆ¬æ˜¯ç»è¿‡è¿æ¥å™¨ã€åˆ†æå™¨ã€ä¼˜åŒ–å™¨ã€æ‰§è¡Œå™¨ç­‰åŠŸèƒ½æ¨¡å—ï¼Œæœ€ååˆ°è¾¾å­˜å‚¨å¼•æ“ã€‚</p><p>é‚£ä¹ˆï¼Œä¸€æ¡æ›´æ–°è¯­å¥çš„æ‰§è¡Œæµç¨‹åˆæ˜¯æ€æ ·çš„å‘¢ï¼Ÿ</p><p>ä¹‹å‰ä½ å¯èƒ½ç»å¸¸å¬ DBA åŒäº‹è¯´ï¼ŒMySQL å¯ä»¥æ¢å¤åˆ°åŠä¸ªæœˆå†…ä»»æ„ä¸€ç§’çš„çŠ¶æ€ï¼ŒæƒŠå¹çš„åŒæ—¶ï¼Œä½ æ˜¯ä¸æ˜¯å¿ƒä¸­ä¹Ÿä¼šä¸å…ä¼šå¥½å¥‡ï¼Œè¿™æ˜¯æ€æ ·åšåˆ°çš„å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬è¿˜æ˜¯ä»ä¸€ä¸ªè¡¨çš„ä¸€æ¡æ›´æ–°è¯­å¥è¯´èµ·ï¼Œä¸‹é¢æ˜¯è¿™ä¸ªè¡¨çš„åˆ›å»ºè¯­å¥ï¼Œè¿™ä¸ªè¡¨æœ‰ä¸€ä¸ªä¸»é”® ID å’Œä¸€ä¸ªæ•´å‹å­—æ®µ cï¼š</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token keyword">table</span> T<span class="token punctuation">(</span>ID <span class="token keyword">int</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span> c <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å¦‚æœè¦å°† ID=2 è¿™ä¸€è¡Œçš„å€¼åŠ  1ï¼ŒSQL è¯­å¥å°±ä¼šè¿™ä¹ˆå†™ï¼š</p><div class="language-r line-numbers-mode" data-ext="r"><pre class="language-r"><code>mysql<span class="token operator">&gt;</span> update T set c<span class="token operator">=</span>c<span class="token operator">+</span><span class="token number">1</span> where ID<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å‰é¢æˆ‘æœ‰è·Ÿä½ ä»‹ç»è¿‡ SQL è¯­å¥åŸºæœ¬çš„æ‰§è¡Œé“¾è·¯ï¼Œè¿™é‡Œæˆ‘å†æŠŠé‚£å¼ å›¾æ‹¿è¿‡æ¥ï¼Œä½ ä¹Ÿå¯ä»¥å…ˆç®€å•çœ‹çœ‹è¿™ä¸ªå›¾å›é¡¾ä¸‹ã€‚é¦–å…ˆï¼Œå¯ä»¥ç¡®å®šçš„è¯´ï¼ŒæŸ¥è¯¢è¯­å¥çš„é‚£ä¸€å¥—æµç¨‹ï¼Œæ›´æ–°è¯­å¥ä¹Ÿæ˜¯åŒæ ·ä¼šèµ°ä¸€éã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/0d2070e8f84c4801adbfa03bda1f98d9-1550568677558-1584367387960.png" alt="img"></p><p>MySQL çš„é€»è¾‘æ¶æ„å›¾</p><p>ä½ æ‰§è¡Œè¯­å¥å‰è¦å…ˆè¿æ¥æ•°æ®åº“ï¼Œè¿™æ˜¯è¿æ¥å™¨çš„å·¥ä½œã€‚</p><p>å‰é¢æˆ‘ä»¬è¯´è¿‡ï¼Œåœ¨ä¸€ä¸ªè¡¨ä¸Šæœ‰æ›´æ–°çš„æ—¶å€™ï¼Œè·Ÿè¿™ä¸ªè¡¨æœ‰å…³çš„æŸ¥è¯¢ç¼“å­˜ä¼šå¤±æ•ˆï¼Œæ‰€ä»¥è¿™æ¡è¯­å¥å°±ä¼šæŠŠè¡¨ T ä¸Šæ‰€æœ‰ç¼“å­˜ç»“æœéƒ½æ¸…ç©ºã€‚è¿™ä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸€èˆ¬ä¸å»ºè®®ä½¿ç”¨æŸ¥è¯¢ç¼“å­˜çš„åŸå› ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œåˆ†æå™¨ä¼šé€šè¿‡è¯æ³•å’Œè¯­æ³•è§£æçŸ¥é“è¿™æ˜¯ä¸€æ¡æ›´æ–°è¯­å¥ã€‚ä¼˜åŒ–å™¨å†³å®šè¦ä½¿ç”¨ ID è¿™ä¸ªç´¢å¼•ã€‚ç„¶åï¼Œæ‰§è¡Œå™¨è´Ÿè´£å…·ä½“æ‰§è¡Œï¼Œæ‰¾åˆ°è¿™ä¸€è¡Œï¼Œç„¶åæ›´æ–°ã€‚</p><p>ä¸æŸ¥è¯¢æµç¨‹ä¸ä¸€æ ·çš„æ˜¯ï¼Œæ›´æ–°æµç¨‹è¿˜æ¶‰åŠä¸¤ä¸ªé‡è¦çš„æ—¥å¿—æ¨¡å—ï¼Œå®ƒä»¬æ­£æ˜¯æˆ‘ä»¬ä»Šå¤©è¦è®¨è®ºçš„ä¸»è§’ï¼šredo logï¼ˆé‡åšæ—¥å¿—ï¼‰å’Œ binlogï¼ˆå½’æ¡£æ—¥å¿—ï¼‰ã€‚å¦‚æœæ¥è§¦ MySQLï¼Œé‚£è¿™ä¸¤ä¸ªè¯è‚¯å®šæ˜¯ç»•ä¸è¿‡çš„ï¼Œæˆ‘åé¢çš„å†…å®¹é‡Œä¹Ÿä¼šä¸æ–­åœ°å’Œä½ å¼ºè°ƒã€‚ä¸è¿‡è¯è¯´å›æ¥ï¼Œredo log å’Œ binlog åœ¨è®¾è®¡ä¸Šæœ‰å¾ˆå¤šæœ‰æ„æ€çš„åœ°æ–¹ï¼Œè¿™äº›è®¾è®¡æ€è·¯ä¹Ÿå¯ä»¥ç”¨åˆ°ä½ è‡ªå·±çš„ç¨‹åºé‡Œã€‚</p><h4 id="é‡è¦çš„æ—¥å¿—æ¨¡å—-redo-log" tabindex="-1"><a class="header-anchor" href="#é‡è¦çš„æ—¥å¿—æ¨¡å—-redo-log" aria-hidden="true">#</a> é‡è¦çš„æ—¥å¿—æ¨¡å—ï¼šredo log</h4><p>ä¸çŸ¥é“ä½ è¿˜è®°ä¸è®°å¾—ã€Šå­”ä¹™å·±ã€‹è¿™ç¯‡æ–‡ç« ï¼Œé…’åº—æŒæŸœæœ‰ä¸€ä¸ªç²‰æ¿ï¼Œä¸“é—¨ç”¨æ¥è®°å½•å®¢äººçš„èµŠè´¦è®°å½•ã€‚å¦‚æœèµŠè´¦çš„äººä¸å¤šï¼Œé‚£ä¹ˆä»–å¯ä»¥æŠŠé¡¾å®¢åå’Œè´¦ç›®å†™åœ¨æ¿ä¸Šã€‚ä½†å¦‚æœèµŠè´¦çš„äººå¤šäº†ï¼Œç²‰æ¿æ€»ä¼šæœ‰è®°ä¸ä¸‹çš„æ—¶å€™ï¼Œè¿™ä¸ªæ—¶å€™æŒæŸœä¸€å®šè¿˜æœ‰ä¸€ä¸ªä¸“é—¨è®°å½•èµŠè´¦çš„è´¦æœ¬ã€‚</p><p>å¦‚æœæœ‰äººè¦èµŠè´¦æˆ–è€…è¿˜è´¦çš„è¯ï¼ŒæŒæŸœä¸€èˆ¬æœ‰ä¸¤ç§åšæ³•ï¼š</p><ul><li>ä¸€ç§åšæ³•æ˜¯ç›´æ¥æŠŠè´¦æœ¬ç¿»å‡ºæ¥ï¼ŒæŠŠè¿™æ¬¡èµŠçš„è´¦åŠ ä¸Šå»æˆ–è€…æ‰£é™¤æ‰ï¼›</li><li>å¦ä¸€ç§åšæ³•æ˜¯å…ˆåœ¨ç²‰æ¿ä¸Šè®°ä¸‹è¿™æ¬¡çš„è´¦ï¼Œç­‰æ‰“çƒŠä»¥åå†æŠŠè´¦æœ¬ç¿»å‡ºæ¥æ ¸ç®—ã€‚</li></ul><p>åœ¨ç”Ÿæ„çº¢ç«æŸœå°å¾ˆå¿™æ—¶ï¼ŒæŒæŸœä¸€å®šä¼šé€‰æ‹©åè€…ï¼Œå› ä¸ºå‰è€…æ“ä½œå®åœ¨æ˜¯å¤ªéº»çƒ¦äº†ã€‚é¦–å…ˆï¼Œä½ å¾—æ‰¾åˆ°è¿™ä¸ªäººçš„èµŠè´¦æ€»é¢é‚£æ¡è®°å½•ã€‚ä½ æƒ³æƒ³ï¼Œå¯†å¯†éº»éº»å‡ åé¡µï¼ŒæŒæŸœè¦æ‰¾åˆ°é‚£ä¸ªåå­—ï¼Œå¯èƒ½è¿˜å¾—å¸¦ä¸Šè€èŠ±é•œæ…¢æ…¢æ‰¾ï¼Œæ‰¾åˆ°ä¹‹åå†æ‹¿å‡ºç®—ç›˜è®¡ç®—ï¼Œæœ€åå†å°†ç»“æœå†™å›åˆ°è´¦æœ¬ä¸Šã€‚</p><p>è¿™æ•´ä¸ªè¿‡ç¨‹æƒ³æƒ³éƒ½éº»çƒ¦ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œè¿˜æ˜¯å…ˆåœ¨ç²‰æ¿ä¸Šè®°ä¸€ä¸‹æ–¹ä¾¿ã€‚ä½ æƒ³æƒ³ï¼Œå¦‚æœæŒæŸœæ²¡æœ‰ç²‰æ¿çš„å¸®åŠ©ï¼Œæ¯æ¬¡è®°è´¦éƒ½å¾—ç¿»è´¦æœ¬ï¼Œæ•ˆç‡æ˜¯ä¸æ˜¯ä½å¾—è®©äººéš¾ä»¥å¿å—ï¼Ÿ</p><p>åŒæ ·ï¼Œåœ¨ MySQL é‡Œä¹Ÿæœ‰è¿™ä¸ªé—®é¢˜ï¼Œå¦‚æœæ¯ä¸€æ¬¡çš„æ›´æ–°æ“ä½œéƒ½éœ€è¦å†™è¿›ç£ç›˜ï¼Œç„¶åç£ç›˜ä¹Ÿè¦æ‰¾åˆ°å¯¹åº”çš„é‚£æ¡è®°å½•ï¼Œç„¶åå†æ›´æ–°ï¼Œæ•´ä¸ªè¿‡ç¨‹ IO æˆæœ¬ã€æŸ¥æ‰¾æˆæœ¬éƒ½å¾ˆé«˜ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒMySQL çš„è®¾è®¡è€…å°±ç”¨äº†ç±»ä¼¼é…’åº—æŒæŸœç²‰æ¿çš„æ€è·¯æ¥æå‡æ›´æ–°æ•ˆç‡ã€‚</p><p>è€Œç²‰æ¿å’Œè´¦æœ¬é…åˆçš„æ•´ä¸ªè¿‡ç¨‹ï¼Œå…¶å®å°±æ˜¯ MySQL é‡Œç»å¸¸è¯´åˆ°çš„ WAL æŠ€æœ¯ï¼ŒWAL çš„å…¨ç§°æ˜¯ Write-Ahead Loggingï¼Œå®ƒçš„å…³é”®ç‚¹å°±æ˜¯å…ˆå†™æ—¥å¿—ï¼Œå†å†™ç£ç›˜ï¼Œä¹Ÿå°±æ˜¯å…ˆå†™ç²‰æ¿ï¼Œç­‰ä¸å¿™çš„æ—¶å€™å†å†™è´¦æœ¬ã€‚</p><p>å…·ä½“æ¥è¯´ï¼Œå½“æœ‰ä¸€æ¡è®°å½•éœ€è¦æ›´æ–°çš„æ—¶å€™ï¼ŒInnoDB å¼•æ“å°±ä¼šå…ˆæŠŠè®°å½•å†™åˆ° redo logï¼ˆç²‰æ¿ï¼‰é‡Œé¢ï¼Œå¹¶æ›´æ–°å†…å­˜ï¼Œè¿™ä¸ªæ—¶å€™æ›´æ–°å°±ç®—å®Œæˆäº†ã€‚åŒæ—¶ï¼ŒInnoDB å¼•æ“ä¼šåœ¨é€‚å½“çš„æ—¶å€™ï¼Œå°†è¿™ä¸ªæ“ä½œè®°å½•æ›´æ–°åˆ°ç£ç›˜é‡Œé¢ï¼Œè€Œè¿™ä¸ªæ›´æ–°å¾€å¾€æ˜¯åœ¨ç³»ç»Ÿæ¯”è¾ƒç©ºé—²çš„æ—¶å€™åšï¼Œè¿™å°±åƒæ‰“çƒŠä»¥åæŒæŸœåšçš„äº‹ã€‚</p><p>å¦‚æœä»Šå¤©èµŠè´¦çš„ä¸å¤šï¼ŒæŒæŸœå¯ä»¥ç­‰æ‰“çƒŠåå†æ•´ç†ã€‚ä½†å¦‚æœæŸå¤©èµŠè´¦çš„ç‰¹åˆ«å¤šï¼Œç²‰æ¿å†™æ»¡äº†ï¼Œåˆæ€ä¹ˆåŠå‘¢ï¼Ÿè¿™ä¸ªæ—¶å€™æŒæŸœåªå¥½æ”¾ä¸‹æ‰‹ä¸­çš„æ´»å„¿ï¼ŒæŠŠç²‰æ¿ä¸­çš„ä¸€éƒ¨åˆ†èµŠè´¦è®°å½•æ›´æ–°åˆ°è´¦æœ¬ä¸­ï¼Œç„¶åæŠŠè¿™äº›è®°å½•ä»ç²‰æ¿ä¸Šæ“¦æ‰ï¼Œä¸ºè®°æ–°è´¦è…¾å‡ºç©ºé—´ã€‚</p><p>ä¸æ­¤ç±»ä¼¼ï¼ŒInnoDB çš„ redo log æ˜¯å›ºå®šå¤§å°çš„ï¼Œæ¯”å¦‚å¯ä»¥é…ç½®ä¸ºä¸€ç»„ 4 ä¸ªæ–‡ä»¶ï¼Œæ¯ä¸ªæ–‡ä»¶çš„å¤§å°æ˜¯ 1GBï¼Œé‚£ä¹ˆè¿™å—â€œç²‰æ¿â€æ€»å…±å°±å¯ä»¥è®°å½• 4GB çš„æ“ä½œã€‚ä»å¤´å¼€å§‹å†™ï¼Œå†™åˆ°æœ«å°¾å°±åˆå›åˆ°å¼€å¤´å¾ªç¯å†™ï¼Œå¦‚ä¸‹é¢è¿™ä¸ªå›¾æ‰€ç¤ºã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/b075250cad8d9f6c791a52b6a600f69c-1584367387977.jpg" alt="img"></p><p>write pos æ˜¯å½“å‰è®°å½•çš„ä½ç½®ï¼Œä¸€è¾¹å†™ä¸€è¾¹åç§»ï¼Œå†™åˆ°ç¬¬ 3 å·æ–‡ä»¶æœ«å°¾åå°±å›åˆ° 0 å·æ–‡ä»¶å¼€å¤´ã€‚checkpoint æ˜¯å½“å‰è¦æ“¦é™¤çš„ä½ç½®ï¼Œä¹Ÿæ˜¯å¾€åæ¨ç§»å¹¶ä¸”å¾ªç¯çš„ï¼Œæ“¦é™¤è®°å½•å‰è¦æŠŠè®°å½•æ›´æ–°åˆ°æ•°æ®æ–‡ä»¶ã€‚</p><p>write pos å’Œ checkpoint ä¹‹é—´çš„æ˜¯â€œç²‰æ¿â€ä¸Šè¿˜ç©ºç€çš„éƒ¨åˆ†ï¼Œå¯ä»¥ç”¨æ¥è®°å½•æ–°çš„æ“ä½œã€‚å¦‚æœ write pos è¿½ä¸Š checkpointï¼Œè¡¨ç¤ºâ€œç²‰æ¿â€æ»¡äº†ï¼Œè¿™æ—¶å€™ä¸èƒ½å†æ‰§è¡Œæ–°çš„æ›´æ–°ï¼Œå¾—åœä¸‹æ¥å…ˆæ“¦æ‰ä¸€äº›è®°å½•ï¼ŒæŠŠ checkpoint æ¨è¿›ä¸€ä¸‹ã€‚</p><p>æœ‰äº† redo logï¼ŒInnoDB å°±å¯ä»¥ä¿è¯å³ä½¿æ•°æ®åº“å‘ç”Ÿå¼‚å¸¸é‡å¯ï¼Œä¹‹å‰æäº¤çš„è®°å½•éƒ½ä¸ä¼šä¸¢å¤±ï¼Œè¿™ä¸ªèƒ½åŠ›ç§°ä¸º<strong>crash-safe</strong>ã€‚</p><p>è¦ç†è§£ crash-safe è¿™ä¸ªæ¦‚å¿µï¼Œå¯ä»¥æƒ³æƒ³æˆ‘ä»¬å‰é¢èµŠè´¦è®°å½•çš„ä¾‹å­ã€‚åªè¦èµŠè´¦è®°å½•è®°åœ¨äº†ç²‰æ¿ä¸Šæˆ–å†™åœ¨äº†è´¦æœ¬ä¸Šï¼Œä¹‹åå³ä½¿æŒæŸœå¿˜è®°äº†ï¼Œæ¯”å¦‚çªç„¶åœä¸šå‡ å¤©ï¼Œæ¢å¤ç”Ÿæ„åä¾ç„¶å¯ä»¥é€šè¿‡è´¦æœ¬å’Œç²‰æ¿ä¸Šçš„æ•°æ®æ˜ç¡®èµŠè´¦è´¦ç›®ã€‚</p><h4 id="é‡è¦çš„æ—¥å¿—æ¨¡å—-binlog" tabindex="-1"><a class="header-anchor" href="#é‡è¦çš„æ—¥å¿—æ¨¡å—-binlog" aria-hidden="true">#</a> é‡è¦çš„æ—¥å¿—æ¨¡å—ï¼šbinlog</h4><p>å‰é¢æˆ‘ä»¬è®²è¿‡ï¼ŒMySQL æ•´ä½“æ¥çœ‹ï¼Œå…¶å®å°±æœ‰ä¸¤å—ï¼šä¸€å—æ˜¯ Server å±‚ï¼Œå®ƒä¸»è¦åšçš„æ˜¯ MySQL åŠŸèƒ½å±‚é¢çš„äº‹æƒ…ï¼›è¿˜æœ‰ä¸€å—æ˜¯å¼•æ“å±‚ï¼Œè´Ÿè´£å­˜å‚¨ç›¸å…³çš„å…·ä½“äº‹å®œã€‚ä¸Šé¢æˆ‘ä»¬èŠåˆ°çš„ç²‰æ¿ redo log æ˜¯ InnoDB å¼•æ“ç‰¹æœ‰çš„æ—¥å¿—ï¼Œè€Œ Server å±‚ä¹Ÿæœ‰è‡ªå·±çš„æ—¥å¿—ï¼Œç§°ä¸º binlogï¼ˆå½’æ¡£æ—¥å¿—ï¼‰ã€‚</p><p>æˆ‘æƒ³ä½ è‚¯å®šä¼šé—®ï¼Œä¸ºä»€ä¹ˆä¼šæœ‰ä¸¤ä»½æ—¥å¿—å‘¢ï¼Ÿ</p><p>å› ä¸ºæœ€å¼€å§‹ MySQL é‡Œå¹¶æ²¡æœ‰ InnoDB å¼•æ“ã€‚MySQL è‡ªå¸¦çš„å¼•æ“æ˜¯ MyISAMï¼Œä½†æ˜¯ MyISAM æ²¡æœ‰ crash-safe çš„èƒ½åŠ›ï¼Œbinlog æ—¥å¿—åªèƒ½ç”¨äºå½’æ¡£ã€‚è€Œ InnoDB æ˜¯å¦ä¸€ä¸ªå…¬å¸ä»¥æ’ä»¶å½¢å¼å¼•å…¥ MySQL çš„ï¼Œæ—¢ç„¶åªä¾é  binlog æ˜¯æ²¡æœ‰ crash-safe èƒ½åŠ›çš„ï¼Œæ‰€ä»¥ InnoDB ä½¿ç”¨å¦å¤–ä¸€å¥—æ—¥å¿—ç³»ç»Ÿâ€”â€”ä¹Ÿå°±æ˜¯ redo log æ¥å®ç° crash-safe èƒ½åŠ›ã€‚</p><p>è¿™ä¸¤ç§æ—¥å¿—æœ‰ä»¥ä¸‹ä¸‰ç‚¹ä¸åŒã€‚</p><ol><li>redo log æ˜¯ InnoDB å¼•æ“ç‰¹æœ‰çš„ï¼›binlog æ˜¯ MySQL çš„ Server å±‚å®ç°çš„ï¼Œæ‰€æœ‰å¼•æ“éƒ½å¯ä»¥ä½¿ç”¨ã€‚</li><li>redo log æ˜¯ç‰©ç†æ—¥å¿—ï¼Œè®°å½•çš„æ˜¯â€œåœ¨æŸä¸ªæ•°æ®é¡µä¸Šåšäº†ä»€ä¹ˆä¿®æ”¹â€ï¼›binlog æ˜¯é€»è¾‘æ—¥å¿—ï¼Œè®°å½•çš„æ˜¯è¿™ä¸ªè¯­å¥çš„åŸå§‹é€»è¾‘ï¼Œæ¯”å¦‚â€œç»™ ID=2 è¿™ä¸€è¡Œçš„ c å­—æ®µåŠ  1 â€ã€‚</li><li>redo log æ˜¯å¾ªç¯å†™çš„ï¼Œç©ºé—´å›ºå®šä¼šç”¨å®Œï¼›binlog æ˜¯å¯ä»¥è¿½åŠ å†™å…¥çš„ã€‚â€œè¿½åŠ å†™â€æ˜¯æŒ‡ binlog æ–‡ä»¶å†™åˆ°ä¸€å®šå¤§å°åä¼šåˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªï¼Œå¹¶ä¸ä¼šè¦†ç›–ä»¥å‰çš„æ—¥å¿—ã€‚</li></ol><p>æœ‰äº†å¯¹è¿™ä¸¤ä¸ªæ—¥å¿—çš„æ¦‚å¿µæ€§ç†è§£ï¼Œæˆ‘ä»¬å†æ¥çœ‹æ‰§è¡Œå™¨å’Œ InnoDB å¼•æ“åœ¨æ‰§è¡Œè¿™ä¸ªç®€å•çš„ update è¯­å¥æ—¶çš„å†…éƒ¨æµç¨‹ã€‚</p><ol><li>æ‰§è¡Œå™¨å…ˆæ‰¾å¼•æ“å– ID=2 è¿™ä¸€è¡Œã€‚ID æ˜¯ä¸»é”®ï¼Œå¼•æ“ç›´æ¥ç”¨æ ‘æœç´¢æ‰¾åˆ°è¿™ä¸€è¡Œã€‚å¦‚æœ ID=2 è¿™ä¸€è¡Œæ‰€åœ¨çš„æ•°æ®é¡µæœ¬æ¥å°±åœ¨å†…å­˜ä¸­ï¼Œå°±ç›´æ¥è¿”å›ç»™æ‰§è¡Œå™¨ï¼›å¦åˆ™ï¼Œéœ€è¦å…ˆä»ç£ç›˜è¯»å…¥å†…å­˜ï¼Œç„¶åå†è¿”å›ã€‚</li><li>æ‰§è¡Œå™¨æ‹¿åˆ°å¼•æ“ç»™çš„è¡Œæ•°æ®ï¼ŒæŠŠè¿™ä¸ªå€¼åŠ ä¸Š 1ï¼Œæ¯”å¦‚åŸæ¥æ˜¯ Nï¼Œç°åœ¨å°±æ˜¯ N+1ï¼Œå¾—åˆ°æ–°çš„ä¸€è¡Œæ•°æ®ï¼Œå†è°ƒç”¨å¼•æ“æ¥å£å†™å…¥è¿™è¡Œæ–°æ•°æ®ã€‚</li><li>å¼•æ“å°†è¿™è¡Œæ–°æ•°æ®æ›´æ–°åˆ°å†…å­˜ä¸­ï¼ŒåŒæ—¶å°†è¿™ä¸ªæ›´æ–°æ“ä½œè®°å½•åˆ° redo log é‡Œé¢ï¼Œæ­¤æ—¶ redo log å¤„äº prepare çŠ¶æ€ã€‚ç„¶åå‘ŠçŸ¥æ‰§è¡Œå™¨æ‰§è¡Œå®Œæˆäº†ï¼Œéšæ—¶å¯ä»¥æäº¤äº‹åŠ¡ã€‚</li><li>æ‰§è¡Œå™¨ç”Ÿæˆè¿™ä¸ªæ“ä½œçš„ binlogï¼Œå¹¶æŠŠ binlog å†™å…¥ç£ç›˜ã€‚</li><li>æ‰§è¡Œå™¨è°ƒç”¨å¼•æ“çš„æäº¤äº‹åŠ¡æ¥å£ï¼Œå¼•æ“æŠŠåˆšåˆšå†™å…¥çš„ redo log æ”¹æˆæäº¤ï¼ˆcommitï¼‰çŠ¶æ€ï¼Œæ›´æ–°å®Œæˆã€‚</li></ol><p>è¿™é‡Œæˆ‘ç»™å‡ºè¿™ä¸ª update è¯­å¥çš„æ‰§è¡Œæµç¨‹å›¾ï¼Œå›¾ä¸­æµ…è‰²æ¡†è¡¨ç¤ºæ˜¯åœ¨ InnoDB å†…éƒ¨æ‰§è¡Œçš„ï¼Œæ·±è‰²æ¡†è¡¨ç¤ºæ˜¯åœ¨æ‰§è¡Œå™¨ä¸­æ‰§è¡Œçš„ã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/2e5bff4910ec189fe1ee6e2ecc7b4bbe-1584367387984.png" alt="img"></p><p>update è¯­å¥æ‰§è¡Œæµç¨‹</p><p>ä½ å¯èƒ½æ³¨æ„åˆ°äº†ï¼Œæœ€åä¸‰æ­¥çœ‹ä¸Šå»æœ‰ç‚¹â€œç»•â€ï¼Œå°† redo log çš„å†™å…¥æ‹†æˆäº†ä¸¤ä¸ªæ­¥éª¤ï¼šprepare å’Œ commitï¼Œè¿™å°±æ˜¯&quot;ä¸¤é˜¶æ®µæäº¤&quot;ã€‚</p><h4 id="ä¸¤é˜¶æ®µæäº¤" tabindex="-1"><a class="header-anchor" href="#ä¸¤é˜¶æ®µæäº¤" aria-hidden="true">#</a> ä¸¤é˜¶æ®µæäº¤</h4><p>ä¸ºä»€ä¹ˆå¿…é¡»æœ‰â€œä¸¤é˜¶æ®µæäº¤â€å‘¢ï¼Ÿè¿™æ˜¯ä¸ºäº†è®©ä¸¤ä»½æ—¥å¿—ä¹‹é—´çš„é€»è¾‘ä¸€è‡´ã€‚è¦è¯´æ˜è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¾—ä»æ–‡ç« å¼€å¤´çš„é‚£ä¸ªé—®é¢˜è¯´èµ·ï¼š<strong>æ€æ ·è®©æ•°æ®åº“æ¢å¤åˆ°åŠä¸ªæœˆå†…ä»»æ„ä¸€ç§’çš„çŠ¶æ€ï¼Ÿ</strong></p><p>å‰é¢æˆ‘ä»¬è¯´è¿‡äº†ï¼Œbinlog ä¼šè®°å½•æ‰€æœ‰çš„é€»è¾‘æ“ä½œï¼Œå¹¶ä¸”æ˜¯é‡‡ç”¨â€œè¿½åŠ å†™â€çš„å½¢å¼ã€‚å¦‚æœä½ çš„ DBA æ‰¿è¯ºè¯´åŠä¸ªæœˆå†…å¯ä»¥æ¢å¤ï¼Œé‚£ä¹ˆå¤‡ä»½ç³»ç»Ÿä¸­ä¸€å®šä¼šä¿å­˜æœ€è¿‘åŠä¸ªæœˆçš„æ‰€æœ‰ binlogï¼ŒåŒæ—¶ç³»ç»Ÿä¼šå®šæœŸåšæ•´åº“å¤‡ä»½ã€‚è¿™é‡Œçš„â€œå®šæœŸâ€å–å†³äºç³»ç»Ÿçš„é‡è¦æ€§ï¼Œå¯ä»¥æ˜¯ä¸€å¤©ä¸€å¤‡ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€å‘¨ä¸€å¤‡ã€‚</p><p>å½“éœ€è¦æ¢å¤åˆ°æŒ‡å®šçš„æŸä¸€ç§’æ—¶ï¼Œæ¯”å¦‚æŸå¤©ä¸‹åˆä¸¤ç‚¹å‘ç°ä¸­åˆåäºŒç‚¹æœ‰ä¸€æ¬¡è¯¯åˆ è¡¨ï¼Œéœ€è¦æ‰¾å›æ•°æ®ï¼Œé‚£ä½ å¯ä»¥è¿™ä¹ˆåšï¼š</p><ul><li>é¦–å…ˆï¼Œæ‰¾åˆ°æœ€è¿‘çš„ä¸€æ¬¡å…¨é‡å¤‡ä»½ï¼Œå¦‚æœä½ è¿æ°”å¥½ï¼Œå¯èƒ½å°±æ˜¯æ˜¨å¤©æ™šä¸Šçš„ä¸€ä¸ªå¤‡ä»½ï¼Œä»è¿™ä¸ªå¤‡ä»½æ¢å¤åˆ°ä¸´æ—¶åº“ï¼›</li><li>ç„¶åï¼Œä»å¤‡ä»½çš„æ—¶é—´ç‚¹å¼€å§‹ï¼Œå°†å¤‡ä»½çš„ binlog ä¾æ¬¡å–å‡ºæ¥ï¼Œé‡æ”¾åˆ°ä¸­åˆè¯¯åˆ è¡¨ä¹‹å‰çš„é‚£ä¸ªæ—¶åˆ»ã€‚</li></ul><p>è¿™æ ·ä½ çš„ä¸´æ—¶åº“å°±è·Ÿè¯¯åˆ ä¹‹å‰çš„çº¿ä¸Šåº“ä¸€æ ·äº†ï¼Œç„¶åä½ å¯ä»¥æŠŠè¡¨æ•°æ®ä»ä¸´æ—¶åº“å–å‡ºæ¥ï¼ŒæŒ‰éœ€è¦æ¢å¤åˆ°çº¿ä¸Šåº“å»ã€‚</p><p>å¥½äº†ï¼Œè¯´å®Œäº†æ•°æ®æ¢å¤è¿‡ç¨‹ï¼Œæˆ‘ä»¬å›æ¥è¯´è¯´ï¼Œä¸ºä»€ä¹ˆæ—¥å¿—éœ€è¦â€œä¸¤é˜¶æ®µæäº¤â€ã€‚è¿™é‡Œä¸å¦¨ç”¨åè¯æ³•æ¥è¿›è¡Œè§£é‡Šã€‚</p><p>ç”±äº redo log å’Œ binlog æ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„é€»è¾‘ï¼Œå¦‚æœä¸ç”¨ä¸¤é˜¶æ®µæäº¤ï¼Œè¦ä¹ˆå°±æ˜¯å…ˆå†™å®Œ redo log å†å†™ binlogï¼Œæˆ–è€…é‡‡ç”¨åè¿‡æ¥çš„é¡ºåºã€‚æˆ‘ä»¬çœ‹çœ‹è¿™ä¸¤ç§æ–¹å¼ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ã€‚</p><p>ä»ç„¶ç”¨å‰é¢çš„ update è¯­å¥æ¥åšä¾‹å­ã€‚å‡è®¾å½“å‰ ID=2 çš„è¡Œï¼Œå­—æ®µ c çš„å€¼æ˜¯ 0ï¼Œå†å‡è®¾æ‰§è¡Œ update è¯­å¥è¿‡ç¨‹ä¸­åœ¨å†™å®Œç¬¬ä¸€ä¸ªæ—¥å¿—åï¼Œç¬¬äºŒä¸ªæ—¥å¿—è¿˜æ²¡æœ‰å†™å®ŒæœŸé—´å‘ç”Ÿäº† crashï¼Œä¼šå‡ºç°ä»€ä¹ˆæƒ…å†µå‘¢ï¼Ÿ</p><ol><li><strong>å…ˆå†™ redo log åå†™ binlog</strong>ã€‚å‡è®¾åœ¨ redo log å†™å®Œï¼Œbinlog è¿˜æ²¡æœ‰å†™å®Œçš„æ—¶å€™ï¼ŒMySQL è¿›ç¨‹å¼‚å¸¸é‡å¯ã€‚ç”±äºæˆ‘ä»¬å‰é¢è¯´è¿‡çš„ï¼Œredo log å†™å®Œä¹‹åï¼Œç³»ç»Ÿå³ä½¿å´©æºƒï¼Œä»ç„¶èƒ½å¤ŸæŠŠæ•°æ®æ¢å¤å›æ¥ï¼Œæ‰€ä»¥æ¢å¤åè¿™ä¸€è¡Œ c çš„å€¼æ˜¯ 1ã€‚ ä½†æ˜¯ç”±äº binlog æ²¡å†™å®Œå°± crash äº†ï¼Œè¿™æ—¶å€™ binlog é‡Œé¢å°±æ²¡æœ‰è®°å½•è¿™ä¸ªè¯­å¥ã€‚å› æ­¤ï¼Œä¹‹åå¤‡ä»½æ—¥å¿—çš„æ—¶å€™ï¼Œå­˜èµ·æ¥çš„ binlog é‡Œé¢å°±æ²¡æœ‰è¿™æ¡è¯­å¥ã€‚ ç„¶åä½ ä¼šå‘ç°ï¼Œå¦‚æœéœ€è¦ç”¨è¿™ä¸ª binlog æ¥æ¢å¤ä¸´æ—¶åº“çš„è¯ï¼Œç”±äºè¿™ä¸ªè¯­å¥çš„ binlog ä¸¢å¤±ï¼Œè¿™ä¸ªä¸´æ—¶åº“å°±ä¼šå°‘äº†è¿™ä¸€æ¬¡æ›´æ–°ï¼Œæ¢å¤å‡ºæ¥çš„è¿™ä¸€è¡Œ c çš„å€¼å°±æ˜¯ 0ï¼Œä¸åŸåº“çš„å€¼ä¸åŒã€‚</li><li><strong>å…ˆå†™ binlog åå†™ redo log</strong>ã€‚å¦‚æœåœ¨ binlog å†™å®Œä¹‹å crashï¼Œç”±äº redo log è¿˜æ²¡å†™ï¼Œå´©æºƒæ¢å¤ä»¥åè¿™ä¸ªäº‹åŠ¡æ— æ•ˆï¼Œæ‰€ä»¥è¿™ä¸€è¡Œ c çš„å€¼æ˜¯ 0ã€‚ä½†æ˜¯ binlog é‡Œé¢å·²ç»è®°å½•äº†â€œæŠŠ c ä» 0 æ”¹æˆ 1â€è¿™ä¸ªæ—¥å¿—ã€‚æ‰€ä»¥ï¼Œåœ¨ä¹‹åç”¨ binlog æ¥æ¢å¤çš„æ—¶å€™å°±å¤šäº†ä¸€ä¸ªäº‹åŠ¡å‡ºæ¥ï¼Œæ¢å¤å‡ºæ¥çš„è¿™ä¸€è¡Œ c çš„å€¼å°±æ˜¯ 1ï¼Œä¸åŸåº“çš„å€¼ä¸åŒã€‚</li></ol><p>å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœä¸ä½¿ç”¨â€œä¸¤é˜¶æ®µæäº¤â€ï¼Œé‚£ä¹ˆæ•°æ®åº“çš„çŠ¶æ€å°±æœ‰å¯èƒ½å’Œç”¨å®ƒçš„æ—¥å¿—æ¢å¤å‡ºæ¥çš„åº“çš„çŠ¶æ€ä¸ä¸€è‡´ã€‚</p><p>ä½ å¯èƒ½ä¼šè¯´ï¼Œè¿™ä¸ªæ¦‚ç‡æ˜¯ä¸æ˜¯å¾ˆä½ï¼Œå¹³æ—¶ä¹Ÿæ²¡æœ‰ä»€ä¹ˆåŠ¨ä¸åŠ¨å°±éœ€è¦æ¢å¤ä¸´æ—¶åº“çš„åœºæ™¯å‘€ï¼Ÿ</p><p>å…¶å®ä¸æ˜¯çš„ï¼Œä¸åªæ˜¯è¯¯æ“ä½œåéœ€è¦ç”¨è¿™ä¸ªè¿‡ç¨‹æ¥æ¢å¤æ•°æ®ã€‚å½“ä½ éœ€è¦æ‰©å®¹çš„æ—¶å€™ï¼Œä¹Ÿå°±æ˜¯éœ€è¦å†å¤šæ­å»ºä¸€äº›å¤‡åº“æ¥å¢åŠ ç³»ç»Ÿçš„è¯»èƒ½åŠ›çš„æ—¶å€™ï¼Œç°åœ¨å¸¸è§çš„åšæ³•ä¹Ÿæ˜¯ç”¨å…¨é‡å¤‡ä»½åŠ ä¸Šåº”ç”¨ binlog æ¥å®ç°çš„ï¼Œè¿™ä¸ªâ€œä¸ä¸€è‡´â€å°±ä¼šå¯¼è‡´ä½ çš„çº¿ä¸Šå‡ºç°ä¸»ä»æ•°æ®åº“ä¸ä¸€è‡´çš„æƒ…å†µã€‚</p><p>ç®€å•è¯´ï¼Œredo log å’Œ binlog éƒ½å¯ä»¥ç”¨äºè¡¨ç¤ºäº‹åŠ¡çš„æäº¤çŠ¶æ€ï¼Œè€Œä¸¤é˜¶æ®µæäº¤å°±æ˜¯è®©è¿™ä¸¤ä¸ªçŠ¶æ€ä¿æŒé€»è¾‘ä¸Šçš„ä¸€è‡´ã€‚</p><h4 id="å°ç»“-1" tabindex="-1"><a class="header-anchor" href="#å°ç»“-1" aria-hidden="true">#</a> å°ç»“</h4><p>ä»Šå¤©ï¼Œæˆ‘ä»‹ç»äº† MySQL é‡Œé¢æœ€é‡è¦çš„ä¸¤ä¸ªæ—¥å¿—ï¼Œå³ç‰©ç†æ—¥å¿— redo log å’Œé€»è¾‘æ—¥å¿— binlogã€‚</p><p>redo log ç”¨äºä¿è¯ crash-safe èƒ½åŠ›ã€‚innodb_flush_log_at_trx_commit è¿™ä¸ªå‚æ•°è®¾ç½®æˆ 1 çš„æ—¶å€™ï¼Œè¡¨ç¤ºæ¯æ¬¡äº‹åŠ¡çš„ redo log éƒ½ç›´æ¥æŒä¹…åŒ–åˆ°ç£ç›˜ã€‚è¿™ä¸ªå‚æ•°æˆ‘å»ºè®®ä½ è®¾ç½®æˆ 1ï¼Œè¿™æ ·å¯ä»¥ä¿è¯ MySQL å¼‚å¸¸é‡å¯ä¹‹åæ•°æ®ä¸ä¸¢å¤±ã€‚</p><p>sync_binlog è¿™ä¸ªå‚æ•°è®¾ç½®æˆ 1 çš„æ—¶å€™ï¼Œè¡¨ç¤ºæ¯æ¬¡äº‹åŠ¡çš„ binlog éƒ½æŒä¹…åŒ–åˆ°ç£ç›˜ã€‚è¿™ä¸ªå‚æ•°æˆ‘ä¹Ÿå»ºè®®ä½ è®¾ç½®æˆ 1ï¼Œè¿™æ ·å¯ä»¥ä¿è¯ MySQL å¼‚å¸¸é‡å¯ä¹‹å binlog ä¸ä¸¢å¤±ã€‚</p><p>æˆ‘è¿˜è·Ÿä½ ä»‹ç»äº†ä¸ MySQL æ—¥å¿—ç³»ç»Ÿå¯†åˆ‡ç›¸å…³çš„â€œä¸¤é˜¶æ®µæäº¤â€ã€‚ä¸¤é˜¶æ®µæäº¤æ˜¯è·¨ç³»ç»Ÿç»´æŒæ•°æ®é€»è¾‘ä¸€è‡´æ€§æ—¶å¸¸ç”¨çš„ä¸€ä¸ªæ–¹æ¡ˆï¼Œå³ä½¿ä½ ä¸åšæ•°æ®åº“å†…æ ¸å¼€å‘ï¼Œæ—¥å¸¸å¼€å‘ä¸­ä¹Ÿæœ‰å¯èƒ½ä¼šç”¨åˆ°ã€‚</p><p>æ–‡ç« çš„æœ€åï¼Œæˆ‘ç»™ä½ ç•™ä¸€ä¸ªæ€è€ƒé¢˜å§ã€‚å‰é¢æˆ‘è¯´åˆ°å®šæœŸå…¨é‡å¤‡ä»½çš„å‘¨æœŸâ€œå–å†³äºç³»ç»Ÿé‡è¦æ€§ï¼Œæœ‰çš„æ˜¯ä¸€å¤©ä¸€å¤‡ï¼Œæœ‰çš„æ˜¯ä¸€å‘¨ä¸€å¤‡â€ã€‚é‚£ä¹ˆåœ¨ä»€ä¹ˆåœºæ™¯ä¸‹ï¼Œä¸€å¤©ä¸€å¤‡ä¼šæ¯”ä¸€å‘¨ä¸€å¤‡æ›´æœ‰ä¼˜åŠ¿å‘¢ï¼Ÿæˆ–è€…è¯´ï¼Œå®ƒå½±å“äº†è¿™ä¸ªæ•°æ®åº“ç³»ç»Ÿçš„å“ªä¸ªæŒ‡æ ‡ï¼Ÿ</p><p>ä½ å¯ä»¥æŠŠä½ çš„æ€è€ƒå’Œè§‚ç‚¹å†™åœ¨ç•™è¨€åŒºé‡Œï¼Œæˆ‘ä¼šåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« çš„æœ«å°¾ç»™å‡ºæˆ‘çš„ç­”æ¡ˆã€‚</p><p>æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚</p><h3 id="_03-äº‹åŠ¡éš”ç¦»-ä¸ºä»€ä¹ˆä½ æ”¹äº†æˆ‘è¿˜çœ‹ä¸è§" tabindex="-1"><a class="header-anchor" href="#_03-äº‹åŠ¡éš”ç¦»-ä¸ºä»€ä¹ˆä½ æ”¹äº†æˆ‘è¿˜çœ‹ä¸è§" aria-hidden="true">#</a> 03 äº‹åŠ¡éš”ç¦»ï¼šä¸ºä»€ä¹ˆä½ æ”¹äº†æˆ‘è¿˜çœ‹ä¸è§ï¼Ÿ</h3><p>æåˆ°äº‹åŠ¡ï¼Œä½ è‚¯å®šä¸é™Œç”Ÿï¼Œå’Œæ•°æ®åº“æ‰“äº¤é“çš„æ—¶å€™ï¼Œæˆ‘ä»¬æ€»æ˜¯ä¼šç”¨åˆ°äº‹åŠ¡ã€‚æœ€ç»å…¸çš„ä¾‹å­å°±æ˜¯è½¬è´¦ï¼Œä½ è¦ç»™æœ‹å‹å°ç‹è½¬ 100 å—é’±ï¼Œè€Œæ­¤æ—¶ä½ çš„é“¶è¡Œå¡åªæœ‰ 100 å—é’±ã€‚</p><p>è½¬è´¦è¿‡ç¨‹å…·ä½“åˆ°ç¨‹åºé‡Œä¼šæœ‰ä¸€ç³»åˆ—çš„æ“ä½œï¼Œæ¯”å¦‚æŸ¥è¯¢ä½™é¢ã€åšåŠ å‡æ³•ã€æ›´æ–°ä½™é¢ç­‰ï¼Œè¿™äº›æ“ä½œå¿…é¡»ä¿è¯æ˜¯ä¸€ä½“çš„ï¼Œä¸ç„¶ç­‰ç¨‹åºæŸ¥å®Œä¹‹åï¼Œè¿˜æ²¡åšå‡æ³•ä¹‹å‰ï¼Œä½ è¿™ 100 å—é’±ï¼Œå®Œå…¨å¯ä»¥å€Ÿç€è¿™ä¸ªæ—¶é—´å·®å†æŸ¥ä¸€æ¬¡ï¼Œç„¶åå†ç»™å¦å¤–ä¸€ä¸ªæœ‹å‹è½¬è´¦ï¼Œå¦‚æœé“¶è¡Œè¿™ä¹ˆæ•´ï¼Œä¸å°±ä¹±äº†ä¹ˆï¼Ÿè¿™æ—¶å°±è¦ç”¨åˆ°â€œäº‹åŠ¡â€è¿™ä¸ªæ¦‚å¿µäº†ã€‚</p><p>ç®€å•æ¥è¯´ï¼Œäº‹åŠ¡å°±æ˜¯è¦ä¿è¯ä¸€ç»„æ•°æ®åº“æ“ä½œï¼Œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚åœ¨ MySQL ä¸­ï¼Œäº‹åŠ¡æ”¯æŒæ˜¯åœ¨å¼•æ“å±‚å®ç°çš„ã€‚ä½ ç°åœ¨çŸ¥é“ï¼ŒMySQL æ˜¯ä¸€ä¸ªæ”¯æŒå¤šå¼•æ“çš„ç³»ç»Ÿï¼Œä½†å¹¶ä¸æ˜¯æ‰€æœ‰çš„å¼•æ“éƒ½æ”¯æŒäº‹åŠ¡ã€‚æ¯”å¦‚ MySQL åŸç”Ÿçš„ MyISAM å¼•æ“å°±ä¸æ”¯æŒäº‹åŠ¡ï¼Œè¿™ä¹Ÿæ˜¯ MyISAM è¢« InnoDB å–ä»£çš„é‡è¦åŸå› ä¹‹ä¸€ã€‚</p><p>ä»Šå¤©çš„æ–‡ç« é‡Œï¼Œæˆ‘å°†ä¼šä»¥ InnoDB ä¸ºä¾‹ï¼Œå‰–æ MySQL åœ¨äº‹åŠ¡æ”¯æŒæ–¹é¢çš„ç‰¹å®šå®ç°ï¼Œå¹¶åŸºäºåŸç†ç»™å‡ºç›¸åº”çš„å®è·µå»ºè®®ï¼Œå¸Œæœ›è¿™äº›æ¡ˆä¾‹èƒ½åŠ æ·±ä½ å¯¹ MySQL äº‹åŠ¡åŸç†çš„ç†è§£ã€‚</p><h4 id="éš”ç¦»æ€§ä¸éš”ç¦»çº§åˆ«" tabindex="-1"><a class="header-anchor" href="#éš”ç¦»æ€§ä¸éš”ç¦»çº§åˆ«" aria-hidden="true">#</a> éš”ç¦»æ€§ä¸éš”ç¦»çº§åˆ«</h4><p>æåˆ°äº‹åŠ¡ï¼Œä½ è‚¯å®šä¼šæƒ³åˆ° ACIDï¼ˆAtomicityã€Consistencyã€Isolationã€Durabilityï¼Œå³åŸå­æ€§ã€ä¸€è‡´æ€§ã€éš”ç¦»æ€§ã€æŒä¹…æ€§ï¼‰ï¼Œä»Šå¤©æˆ‘ä»¬å°±æ¥è¯´è¯´å…¶ä¸­ Iï¼Œä¹Ÿå°±æ˜¯â€œéš”ç¦»æ€§â€ã€‚</p><p>å½“æ•°æ®åº“ä¸Šæœ‰å¤šä¸ªäº‹åŠ¡åŒæ—¶æ‰§è¡Œçš„æ—¶å€™ï¼Œå°±å¯èƒ½å‡ºç°è„è¯»ï¼ˆdirty readï¼‰ã€ä¸å¯é‡å¤è¯»ï¼ˆnon-repeatable readï¼‰ã€å¹»è¯»ï¼ˆphantom readï¼‰çš„é—®é¢˜ï¼Œä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œå°±æœ‰äº†â€œéš”ç¦»çº§åˆ«â€çš„æ¦‚å¿µã€‚</p><p>åœ¨è°ˆéš”ç¦»çº§åˆ«ä¹‹å‰ï¼Œä½ é¦–å…ˆè¦çŸ¥é“ï¼Œä½ éš”ç¦»å¾—è¶Šä¸¥å®ï¼Œæ•ˆç‡å°±ä¼šè¶Šä½ã€‚å› æ­¤å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬éƒ½è¦åœ¨äºŒè€…ä¹‹é—´å¯»æ‰¾ä¸€ä¸ªå¹³è¡¡ç‚¹ã€‚SQL æ ‡å‡†çš„äº‹åŠ¡éš”ç¦»çº§åˆ«åŒ…æ‹¬ï¼šè¯»æœªæäº¤ï¼ˆread uncommittedï¼‰ã€è¯»æäº¤ï¼ˆread committedï¼‰ã€å¯é‡å¤è¯»ï¼ˆrepeatable readï¼‰å’Œä¸²è¡ŒåŒ–ï¼ˆserializable ï¼‰ã€‚ä¸‹é¢æˆ‘é€ä¸€ä¸ºä½ è§£é‡Šï¼š</p><ul><li>è¯»æœªæäº¤æ˜¯æŒ‡ï¼Œä¸€ä¸ªäº‹åŠ¡è¿˜æ²¡æäº¤æ—¶ï¼Œå®ƒåšçš„å˜æ›´å°±èƒ½è¢«åˆ«çš„äº‹åŠ¡çœ‹åˆ°ã€‚</li><li>è¯»æäº¤æ˜¯æŒ‡ï¼Œä¸€ä¸ªäº‹åŠ¡æäº¤ä¹‹åï¼Œå®ƒåšçš„å˜æ›´æ‰ä¼šè¢«å…¶ä»–äº‹åŠ¡çœ‹åˆ°ã€‚</li><li>å¯é‡å¤è¯»æ˜¯æŒ‡ï¼Œä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­çœ‹åˆ°çš„æ•°æ®ï¼Œæ€»æ˜¯è·Ÿè¿™ä¸ªäº‹åŠ¡åœ¨å¯åŠ¨æ—¶çœ‹åˆ°çš„æ•°æ®æ˜¯ä¸€è‡´çš„ã€‚å½“ç„¶åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹ï¼Œæœªæäº¤å˜æ›´å¯¹å…¶ä»–äº‹åŠ¡ä¹Ÿæ˜¯ä¸å¯è§çš„ã€‚</li><li>ä¸²è¡ŒåŒ–ï¼Œé¡¾åæ€ä¹‰æ˜¯å¯¹äºåŒä¸€è¡Œè®°å½•ï¼Œâ€œå†™â€ä¼šåŠ â€œå†™é”â€ï¼Œâ€œè¯»â€ä¼šåŠ â€œè¯»é”â€ã€‚å½“å‡ºç°è¯»å†™é”å†²çªçš„æ—¶å€™ï¼Œåè®¿é—®çš„äº‹åŠ¡å¿…é¡»ç­‰å‰ä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œå®Œæˆï¼Œæ‰èƒ½ç»§ç»­æ‰§è¡Œã€‚</li></ul><p>å…¶ä¸­â€œè¯»æäº¤â€å’Œâ€œå¯é‡å¤è¯»â€æ¯”è¾ƒéš¾ç†è§£ï¼Œæ‰€ä»¥æˆ‘ç”¨ä¸€ä¸ªä¾‹å­è¯´æ˜è¿™å‡ ç§éš”ç¦»çº§åˆ«ã€‚å‡è®¾æ•°æ®è¡¨ T ä¸­åªæœ‰ä¸€åˆ—ï¼Œå…¶ä¸­ä¸€è¡Œçš„å€¼ä¸º 1ï¼Œä¸‹é¢æ˜¯æŒ‰ç…§æ—¶é—´é¡ºåºæ‰§è¡Œä¸¤ä¸ªäº‹åŠ¡çš„è¡Œä¸ºã€‚</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token keyword">table</span> T<span class="token punctuation">(</span>c <span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token keyword">engine</span><span class="token operator">=</span><span class="token keyword">InnoDB</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> T<span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/7dea45932a6b722eb069d2264d0066f8-1584367388045.png" alt="img">æˆ‘ä»¬æ¥çœ‹çœ‹åœ¨ä¸åŒçš„éš”ç¦»çº§åˆ«ä¸‹ï¼Œäº‹åŠ¡ A ä¼šæœ‰å“ªäº›ä¸åŒçš„è¿”å›ç»“æœï¼Œä¹Ÿå°±æ˜¯å›¾é‡Œé¢ V1ã€V2ã€V3 çš„è¿”å›å€¼åˆ†åˆ«æ˜¯ä»€ä¹ˆã€‚</p><ul><li>è‹¥éš”ç¦»çº§åˆ«æ˜¯â€œè¯»æœªæäº¤â€ï¼Œ åˆ™ V1 çš„å€¼å°±æ˜¯ 2ã€‚è¿™æ—¶å€™äº‹åŠ¡ B è™½ç„¶è¿˜æ²¡æœ‰æäº¤ï¼Œä½†æ˜¯ç»“æœå·²ç»è¢« A çœ‹åˆ°äº†ã€‚å› æ­¤ï¼ŒV2ã€V3 ä¹Ÿéƒ½æ˜¯ 2ã€‚</li><li>è‹¥éš”ç¦»çº§åˆ«æ˜¯â€œè¯»æäº¤â€ï¼Œåˆ™ V1 æ˜¯ 1ï¼ŒV2 çš„å€¼æ˜¯ 2ã€‚äº‹åŠ¡ B çš„æ›´æ–°åœ¨æäº¤åæ‰èƒ½è¢« A çœ‹åˆ°ã€‚æ‰€ä»¥ï¼Œ V3 çš„å€¼ä¹Ÿæ˜¯ 2ã€‚</li><li>è‹¥éš”ç¦»çº§åˆ«æ˜¯â€œå¯é‡å¤è¯»â€ï¼Œåˆ™ V1ã€V2 æ˜¯ 1ï¼ŒV3 æ˜¯ 2ã€‚ä¹‹æ‰€ä»¥ V2 è¿˜æ˜¯ 1ï¼Œéµå¾ªçš„å°±æ˜¯è¿™ä¸ªè¦æ±‚ï¼šäº‹åŠ¡åœ¨æ‰§è¡ŒæœŸé—´çœ‹åˆ°çš„æ•°æ®å‰åå¿…é¡»æ˜¯ä¸€è‡´çš„ã€‚</li><li>è‹¥éš”ç¦»çº§åˆ«æ˜¯â€œä¸²è¡ŒåŒ–â€ï¼Œåˆ™åœ¨äº‹åŠ¡ B æ‰§è¡Œâ€œå°† 1 æ”¹æˆ 2â€çš„æ—¶å€™ï¼Œä¼šè¢«é”ä½ã€‚ç›´åˆ°äº‹åŠ¡ A æäº¤åï¼Œäº‹åŠ¡ B æ‰å¯ä»¥ç»§ç»­æ‰§è¡Œã€‚æ‰€ä»¥ä» A çš„è§’åº¦çœ‹ï¼Œ V1ã€V2 å€¼æ˜¯ 1ï¼ŒV3 çš„å€¼æ˜¯ 2ã€‚</li></ul><p>åœ¨å®ç°ä¸Šï¼Œæ•°æ®åº“é‡Œé¢ä¼šåˆ›å»ºä¸€ä¸ªè§†å›¾ï¼Œè®¿é—®çš„æ—¶å€™ä»¥è§†å›¾çš„é€»è¾‘ç»“æœä¸ºå‡†ã€‚åœ¨â€œå¯é‡å¤è¯»â€éš”ç¦»çº§åˆ«ä¸‹ï¼Œè¿™ä¸ªè§†å›¾æ˜¯åœ¨äº‹åŠ¡å¯åŠ¨æ—¶åˆ›å»ºçš„ï¼Œæ•´ä¸ªäº‹åŠ¡å­˜åœ¨æœŸé—´éƒ½ç”¨è¿™ä¸ªè§†å›¾ã€‚åœ¨â€œè¯»æäº¤â€éš”ç¦»çº§åˆ«ä¸‹ï¼Œè¿™ä¸ªè§†å›¾æ˜¯åœ¨æ¯ä¸ª SQL è¯­å¥å¼€å§‹æ‰§è¡Œçš„æ—¶å€™åˆ›å»ºçš„ã€‚è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œâ€œè¯»æœªæäº¤â€éš”ç¦»çº§åˆ«ä¸‹ç›´æ¥è¿”å›è®°å½•ä¸Šçš„æœ€æ–°å€¼ï¼Œæ²¡æœ‰è§†å›¾æ¦‚å¿µï¼›è€Œâ€œä¸²è¡ŒåŒ–â€éš”ç¦»çº§åˆ«ä¸‹ç›´æ¥ç”¨åŠ é”çš„æ–¹å¼æ¥é¿å…å¹¶è¡Œè®¿é—®ã€‚</p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨ä¸åŒçš„éš”ç¦»çº§åˆ«ä¸‹ï¼Œæ•°æ®åº“è¡Œä¸ºæ˜¯æœ‰æ‰€ä¸åŒçš„ã€‚Oracle æ•°æ®åº“çš„é»˜è®¤éš”ç¦»çº§åˆ«å…¶å®å°±æ˜¯â€œè¯»æäº¤â€ï¼Œå› æ­¤å¯¹äºä¸€äº›ä» Oracle è¿ç§»åˆ° MySQL çš„åº”ç”¨ï¼Œä¸ºä¿è¯æ•°æ®åº“éš”ç¦»çº§åˆ«çš„ä¸€è‡´ï¼Œä½ ä¸€å®šè¦è®°å¾—å°† MySQL çš„éš”ç¦»çº§åˆ«è®¾ç½®ä¸ºâ€œè¯»æäº¤â€ã€‚</p><p>é…ç½®çš„æ–¹å¼æ˜¯ï¼Œå°†å¯åŠ¨å‚æ•° transaction-isolation çš„å€¼è®¾ç½®æˆ READ-COMMITTEDã€‚ä½ å¯ä»¥ç”¨ show variables æ¥æŸ¥çœ‹å½“å‰çš„å€¼ã€‚</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">&#39;transaction_isolation&#39;</span><span class="token punctuation">;</span> 
<span class="token operator">+</span><span class="token comment">-----------------------+----------------+ </span>
<span class="token operator">|</span> Variable_name <span class="token operator">|</span> <span class="token keyword">Value</span> <span class="token operator">|</span> 
<span class="token operator">+</span><span class="token comment">-----------------------+----------------+ </span>
<span class="token operator">|</span> transaction_isolation <span class="token operator">|</span> <span class="token keyword">READ</span><span class="token operator">-</span><span class="token keyword">COMMITTED</span> <span class="token operator">|</span> 
<span class="token operator">+</span><span class="token comment">-----------------------+----------------+</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ€»ç»“æ¥è¯´ï¼Œå­˜åœ¨å³åˆç†ï¼Œå“ªä¸ªéš”ç¦»çº§åˆ«éƒ½æœ‰å®ƒè‡ªå·±çš„ä½¿ç”¨åœºæ™¯ï¼Œä½ è¦æ ¹æ®è‡ªå·±çš„ä¸šåŠ¡æƒ…å†µæ¥å®šã€‚æˆ‘æƒ³<strong>ä½ å¯èƒ½ä¼šé—®é‚£ä»€ä¹ˆæ—¶å€™éœ€è¦â€œå¯é‡å¤è¯»â€çš„åœºæ™¯å‘¢</strong>ï¼Ÿæˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªæ•°æ®æ ¡å¯¹é€»è¾‘çš„æ¡ˆä¾‹ã€‚</p><p>å‡è®¾ä½ åœ¨ç®¡ç†ä¸€ä¸ªä¸ªäººé“¶è¡Œè´¦æˆ·è¡¨ã€‚ä¸€ä¸ªè¡¨å­˜äº†æ¯ä¸ªæœˆæœˆåº•çš„ä½™é¢ï¼Œä¸€ä¸ªè¡¨å­˜äº†è´¦å•æ˜ç»†ã€‚è¿™æ—¶å€™ä½ è¦åšæ•°æ®æ ¡å¯¹ï¼Œä¹Ÿå°±æ˜¯åˆ¤æ–­ä¸Šä¸ªæœˆçš„ä½™é¢å’Œå½“å‰ä½™é¢çš„å·®é¢ï¼Œæ˜¯å¦ä¸æœ¬æœˆçš„è´¦å•æ˜ç»†ä¸€è‡´ã€‚ä½ ä¸€å®šå¸Œæœ›åœ¨æ ¡å¯¹è¿‡ç¨‹ä¸­ï¼Œå³ä½¿æœ‰ç”¨æˆ·å‘ç”Ÿäº†ä¸€ç¬”æ–°çš„äº¤æ˜“ï¼Œä¹Ÿä¸å½±å“ä½ çš„æ ¡å¯¹ç»“æœã€‚</p><p>è¿™æ—¶å€™ä½¿ç”¨â€œå¯é‡å¤è¯»â€éš”ç¦»çº§åˆ«å°±å¾ˆæ–¹ä¾¿ã€‚äº‹åŠ¡å¯åŠ¨æ—¶çš„è§†å›¾å¯ä»¥è®¤ä¸ºæ˜¯é™æ€çš„ï¼Œä¸å—å…¶ä»–äº‹åŠ¡æ›´æ–°çš„å½±å“ã€‚</p><h4 id="äº‹åŠ¡éš”ç¦»çš„å®ç°" tabindex="-1"><a class="header-anchor" href="#äº‹åŠ¡éš”ç¦»çš„å®ç°" aria-hidden="true">#</a> äº‹åŠ¡éš”ç¦»çš„å®ç°</h4><p>ç†è§£äº†äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹äº‹åŠ¡éš”ç¦»å…·ä½“æ˜¯æ€ä¹ˆå®ç°çš„ã€‚è¿™é‡Œæˆ‘ä»¬å±•å¼€è¯´æ˜â€œå¯é‡å¤è¯»â€ã€‚</p><p>åœ¨ MySQL ä¸­ï¼Œå®é™…ä¸Šæ¯æ¡è®°å½•åœ¨æ›´æ–°çš„æ—¶å€™éƒ½ä¼šåŒæ—¶è®°å½•ä¸€æ¡å›æ»šæ“ä½œã€‚è®°å½•ä¸Šçš„æœ€æ–°å€¼ï¼Œé€šè¿‡å›æ»šæ“ä½œï¼Œéƒ½å¯ä»¥å¾—åˆ°å‰ä¸€ä¸ªçŠ¶æ€çš„å€¼ã€‚</p><p>å‡è®¾ä¸€ä¸ªå€¼ä» 1 è¢«æŒ‰é¡ºåºæ”¹æˆäº† 2ã€3ã€4ï¼Œåœ¨å›æ»šæ—¥å¿—é‡Œé¢å°±ä¼šæœ‰ç±»ä¼¼ä¸‹é¢çš„è®°å½•ã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/d9c313809e5ac148fc39feff532f0fee-1584367388025.png" alt="img">å½“å‰å€¼æ˜¯ 4ï¼Œä½†æ˜¯åœ¨æŸ¥è¯¢è¿™æ¡è®°å½•çš„æ—¶å€™ï¼Œä¸åŒæ—¶åˆ»å¯åŠ¨çš„äº‹åŠ¡ä¼šæœ‰ä¸åŒçš„ read-viewã€‚å¦‚å›¾ä¸­çœ‹åˆ°çš„ï¼Œåœ¨è§†å›¾ Aã€Bã€C é‡Œé¢ï¼Œè¿™ä¸€ä¸ªè®°å½•çš„å€¼åˆ†åˆ«æ˜¯ 1ã€2ã€4ï¼ŒåŒä¸€æ¡è®°å½•åœ¨ç³»ç»Ÿä¸­å¯ä»¥å­˜åœ¨å¤šä¸ªç‰ˆæœ¬ï¼Œå°±æ˜¯æ•°æ®åº“çš„å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼ˆMVCCï¼‰ã€‚å¯¹äº read-view Aï¼Œè¦å¾—åˆ° 1ï¼Œå°±å¿…é¡»å°†å½“å‰å€¼ä¾æ¬¡æ‰§è¡Œå›¾ä¸­æ‰€æœ‰çš„å›æ»šæ“ä½œå¾—åˆ°ã€‚</p><p>åŒæ—¶ä½ ä¼šå‘ç°ï¼Œå³ä½¿ç°åœ¨æœ‰å¦å¤–ä¸€ä¸ªäº‹åŠ¡æ­£åœ¨å°† 4 æ”¹æˆ 5ï¼Œè¿™ä¸ªäº‹åŠ¡è·Ÿ read-view Aã€Bã€C å¯¹åº”çš„äº‹åŠ¡æ˜¯ä¸ä¼šå†²çªçš„ã€‚</p><p>ä½ ä¸€å®šä¼šé—®ï¼Œå›æ»šæ—¥å¿—æ€»ä¸èƒ½ä¸€ç›´ä¿ç•™å§ï¼Œä»€ä¹ˆæ—¶å€™åˆ é™¤å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ï¼Œåœ¨ä¸éœ€è¦çš„æ—¶å€™æ‰åˆ é™¤ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç³»ç»Ÿä¼šåˆ¤æ–­ï¼Œå½“æ²¡æœ‰äº‹åŠ¡å†éœ€è¦ç”¨åˆ°è¿™äº›å›æ»šæ—¥å¿—æ—¶ï¼Œå›æ»šæ—¥å¿—ä¼šè¢«åˆ é™¤ã€‚</p><p>ä»€ä¹ˆæ—¶å€™æ‰ä¸éœ€è¦äº†å‘¢ï¼Ÿå°±æ˜¯å½“ç³»ç»Ÿé‡Œæ²¡æœ‰æ¯”è¿™ä¸ªå›æ»šæ—¥å¿—æ›´æ—©çš„ read-view çš„æ—¶å€™ã€‚</p><p>åŸºäºä¸Šé¢çš„è¯´æ˜ï¼Œæˆ‘ä»¬æ¥è®¨è®ºä¸€ä¸‹ä¸ºä»€ä¹ˆå»ºè®®ä½ å°½é‡ä¸è¦ä½¿ç”¨é•¿äº‹åŠ¡ã€‚</p><p>é•¿äº‹åŠ¡æ„å‘³ç€ç³»ç»Ÿé‡Œé¢ä¼šå­˜åœ¨å¾ˆè€çš„äº‹åŠ¡è§†å›¾ã€‚ç”±äºè¿™äº›äº‹åŠ¡éšæ—¶å¯èƒ½è®¿é—®æ•°æ®åº“é‡Œé¢çš„ä»»ä½•æ•°æ®ï¼Œæ‰€ä»¥è¿™ä¸ªäº‹åŠ¡æäº¤ä¹‹å‰ï¼Œæ•°æ®åº“é‡Œé¢å®ƒå¯èƒ½ç”¨åˆ°çš„å›æ»šè®°å½•éƒ½å¿…é¡»ä¿ç•™ï¼Œè¿™å°±ä¼šå¯¼è‡´å¤§é‡å ç”¨å­˜å‚¨ç©ºé—´ã€‚</p><p>åœ¨ MySQL 5.5 åŠä»¥å‰çš„ç‰ˆæœ¬ï¼Œå›æ»šæ—¥å¿—æ˜¯è·Ÿæ•°æ®å­—å…¸ä¸€èµ·æ”¾åœ¨ ibdata æ–‡ä»¶é‡Œçš„ï¼Œå³ä½¿é•¿äº‹åŠ¡æœ€ç»ˆæäº¤ï¼Œå›æ»šæ®µè¢«æ¸…ç†ï¼Œæ–‡ä»¶ä¹Ÿä¸ä¼šå˜å°ã€‚æˆ‘è§è¿‡æ•°æ®åªæœ‰ 20GBï¼Œè€Œå›æ»šæ®µæœ‰ 200GB çš„åº“ã€‚æœ€ç»ˆåªå¥½ä¸ºäº†æ¸…ç†å›æ»šæ®µï¼Œé‡å»ºæ•´ä¸ªåº“ã€‚</p><p>é™¤äº†å¯¹å›æ»šæ®µçš„å½±å“ï¼Œé•¿äº‹åŠ¡è¿˜å ç”¨é”èµ„æºï¼Œä¹Ÿå¯èƒ½æ‹–å®æ•´ä¸ªåº“ï¼Œè¿™ä¸ªæˆ‘ä»¬ä¼šåœ¨åé¢è®²é”çš„æ—¶å€™å±•å¼€ã€‚</p><p>äº‹åŠ¡çš„å¯åŠ¨æ–¹å¼</p><p>å¦‚å‰é¢æ‰€è¿°ï¼Œé•¿äº‹åŠ¡æœ‰è¿™äº›æ½œåœ¨é£é™©ï¼Œæˆ‘å½“ç„¶æ˜¯å»ºè®®ä½ å°½é‡é¿å…ã€‚å…¶å®å¾ˆå¤šæ—¶å€™ä¸šåŠ¡å¼€å‘åŒå­¦å¹¶ä¸æ˜¯æœ‰æ„ä½¿ç”¨é•¿äº‹åŠ¡ï¼Œé€šå¸¸æ˜¯ç”±äºè¯¯ç”¨æ‰€è‡´ã€‚MySQL çš„äº‹åŠ¡å¯åŠ¨æ–¹å¼æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p><ol><li>æ˜¾å¼å¯åŠ¨äº‹åŠ¡è¯­å¥ï¼Œ begin æˆ– start transactionã€‚é…å¥—çš„æäº¤è¯­å¥æ˜¯ commitï¼Œå›æ»šè¯­å¥æ˜¯ rollbackã€‚</li><li>set autocommit=0ï¼Œè¿™ä¸ªå‘½ä»¤ä¼šå°†è¿™ä¸ªçº¿ç¨‹çš„è‡ªåŠ¨æäº¤å…³æ‰ã€‚æ„å‘³ç€å¦‚æœä½ åªæ‰§è¡Œä¸€ä¸ª select è¯­å¥ï¼Œè¿™ä¸ªäº‹åŠ¡å°±å¯åŠ¨äº†ï¼Œè€Œä¸”å¹¶ä¸ä¼šè‡ªåŠ¨æäº¤ã€‚è¿™ä¸ªäº‹åŠ¡æŒç»­å­˜åœ¨ç›´åˆ°ä½ ä¸»åŠ¨æ‰§è¡Œ commit æˆ– rollback è¯­å¥ï¼Œæˆ–è€…æ–­å¼€è¿æ¥ã€‚</li></ol><p>æœ‰äº›å®¢æˆ·ç«¯è¿æ¥æ¡†æ¶ä¼šé»˜è®¤è¿æ¥æˆåŠŸåå…ˆæ‰§è¡Œä¸€ä¸ª set autocommit=0 çš„å‘½ä»¤ã€‚è¿™å°±å¯¼è‡´æ¥ä¸‹æ¥çš„æŸ¥è¯¢éƒ½åœ¨äº‹åŠ¡ä¸­ï¼Œå¦‚æœæ˜¯é•¿è¿æ¥ï¼Œå°±å¯¼è‡´äº†æ„å¤–çš„é•¿äº‹åŠ¡ã€‚</p><p>å› æ­¤ï¼Œæˆ‘ä¼šå»ºè®®ä½ æ€»æ˜¯ä½¿ç”¨ set autocommit=1, é€šè¿‡æ˜¾å¼è¯­å¥çš„æ–¹å¼æ¥å¯åŠ¨äº‹åŠ¡ã€‚</p><p>ä½†æ˜¯æœ‰çš„å¼€å‘åŒå­¦ä¼šçº ç»“â€œå¤šä¸€æ¬¡äº¤äº’â€çš„é—®é¢˜ã€‚å¯¹äºä¸€ä¸ªéœ€è¦é¢‘ç¹ä½¿ç”¨äº‹åŠ¡çš„ä¸šåŠ¡ï¼Œç¬¬äºŒç§æ–¹å¼æ¯ä¸ªäº‹åŠ¡åœ¨å¼€å§‹æ—¶éƒ½ä¸éœ€è¦ä¸»åŠ¨æ‰§è¡Œä¸€æ¬¡ â€œbeginâ€ï¼Œå‡å°‘äº†è¯­å¥çš„äº¤äº’æ¬¡æ•°ã€‚å¦‚æœä½ ä¹Ÿæœ‰è¿™ä¸ªé¡¾è™‘ï¼Œæˆ‘å»ºè®®ä½ ä½¿ç”¨ commit work and chain è¯­æ³•ã€‚</p><p>åœ¨ autocommit ä¸º 1 çš„æƒ…å†µä¸‹ï¼Œç”¨ begin æ˜¾å¼å¯åŠ¨çš„äº‹åŠ¡ï¼Œå¦‚æœæ‰§è¡Œ commit åˆ™æäº¤äº‹åŠ¡ã€‚å¦‚æœæ‰§è¡Œ commit work and chainï¼Œåˆ™æ˜¯æäº¤äº‹åŠ¡å¹¶è‡ªåŠ¨å¯åŠ¨ä¸‹ä¸€ä¸ªäº‹åŠ¡ï¼Œè¿™æ ·ä¹Ÿçœå»äº†å†æ¬¡æ‰§è¡Œ begin è¯­å¥çš„å¼€é”€ã€‚åŒæ—¶å¸¦æ¥çš„å¥½å¤„æ˜¯ä»ç¨‹åºå¼€å‘çš„è§’åº¦æ˜ç¡®åœ°çŸ¥é“æ¯ä¸ªè¯­å¥æ˜¯å¦å¤„äºäº‹åŠ¡ä¸­ã€‚</p><p>ä½ å¯ä»¥åœ¨ information_schema åº“çš„ innodb_trx è¿™ä¸ªè¡¨ä¸­æŸ¥è¯¢é•¿äº‹åŠ¡ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ä¸ªè¯­å¥ï¼Œç”¨äºæŸ¥æ‰¾æŒç»­æ—¶é—´è¶…è¿‡ 60s çš„äº‹åŠ¡ã€‚</p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> information_schema<span class="token punctuation">.</span>innodb_trx <span class="token keyword">where</span> <span class="token class-name">TIME_TO_SEC</span><span class="token punctuation">(</span><span class="token function">timediff</span><span class="token punctuation">(</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>trx_started<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">60</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="å°ç»“-2" tabindex="-1"><a class="header-anchor" href="#å°ç»“-2" aria-hidden="true">#</a> å°ç»“</h4><p>è¿™ç¯‡æ–‡ç« é‡Œé¢ï¼Œæˆ‘ä»‹ç»äº† MySQL çš„äº‹åŠ¡éš”ç¦»çº§åˆ«çš„ç°è±¡å’Œå®ç°ï¼Œæ ¹æ®å®ç°åŸç†åˆ†æäº†é•¿äº‹åŠ¡å­˜åœ¨çš„é£é™©ï¼Œä»¥åŠå¦‚ä½•ç”¨æ­£ç¡®çš„æ–¹å¼é¿å…é•¿äº‹åŠ¡ã€‚å¸Œæœ›æˆ‘ä¸¾çš„ä¾‹å­èƒ½å¤Ÿå¸®åŠ©ä½ ç†è§£äº‹åŠ¡ï¼Œå¹¶æ›´å¥½åœ°ä½¿ç”¨ MySQL çš„äº‹åŠ¡ç‰¹æ€§ã€‚</p><p>æˆ‘ç»™ä½ ç•™ä¸€ä¸ªé—®é¢˜å§ã€‚ä½ ç°åœ¨çŸ¥é“äº†ç³»ç»Ÿé‡Œé¢åº”è¯¥é¿å…é•¿äº‹åŠ¡ï¼Œå¦‚æœä½ æ˜¯ä¸šåŠ¡å¼€å‘è´Ÿè´£äººåŒæ—¶ä¹Ÿæ˜¯æ•°æ®åº“è´Ÿè´£äººï¼Œä½ ä¼šæœ‰ä»€ä¹ˆæ–¹æ¡ˆæ¥é¿å…å‡ºç°æˆ–è€…å¤„ç†è¿™ç§æƒ…å†µå‘¢ï¼Ÿ</p><p>ä½ å¯ä»¥æŠŠä½ çš„æ€è€ƒå’Œè§‚ç‚¹å†™åœ¨ç•™è¨€åŒºé‡Œï¼Œæˆ‘ä¼šåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« çš„æœ«å°¾å’Œä½ è®¨è®ºè¿™ä¸ªé—®é¢˜ã€‚æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚</p><h3 id="_04-æ·±å…¥æµ…å‡ºç´¢å¼•-ä¸Š" tabindex="-1"><a class="header-anchor" href="#_04-æ·±å…¥æµ…å‡ºç´¢å¼•-ä¸Š" aria-hidden="true">#</a> 04 æ·±å…¥æµ…å‡ºç´¢å¼•ï¼ˆä¸Šï¼‰</h3><p>æåˆ°æ•°æ®åº“ç´¢å¼•ï¼Œæˆ‘æƒ³ä½ å¹¶ä¸é™Œç”Ÿï¼Œåœ¨æ—¥å¸¸å·¥ä½œä¸­ä¼šç»å¸¸æ¥è§¦åˆ°ã€‚æ¯”å¦‚æŸä¸€ä¸ª SQL æŸ¥è¯¢æ¯”è¾ƒæ…¢ï¼Œåˆ†æå®ŒåŸå› ä¹‹åï¼Œä½ å¯èƒ½å°±ä¼šè¯´â€œç»™æŸä¸ªå­—æ®µåŠ ä¸ªç´¢å¼•å§â€ä¹‹ç±»çš„è§£å†³æ–¹æ¡ˆã€‚ä½†åˆ°åº•ä»€ä¹ˆæ˜¯ç´¢å¼•ï¼Œç´¢å¼•åˆæ˜¯å¦‚ä½•å·¥ä½œçš„å‘¢ï¼Ÿä»Šå¤©å°±è®©æˆ‘ä»¬ä¸€èµ·æ¥èŠèŠè¿™ä¸ªè¯é¢˜å§ã€‚</p><p>æ•°æ®åº“ç´¢å¼•çš„å†…å®¹æ¯”è¾ƒå¤šï¼Œæˆ‘åˆ†æˆäº†ä¸Šä¸‹ä¸¤ç¯‡æ–‡ç« ã€‚ç´¢å¼•æ˜¯æ•°æ®åº“ç³»ç»Ÿé‡Œé¢æœ€é‡è¦çš„æ¦‚å¿µä¹‹ä¸€ï¼Œæ‰€ä»¥æˆ‘å¸Œæœ›ä½ èƒ½å¤Ÿè€å¿ƒçœ‹å®Œã€‚åœ¨åé¢çš„å®æˆ˜æ–‡ç« ä¸­ï¼Œæˆ‘ä¹Ÿä¼šç»å¸¸å¼•ç”¨è¿™ä¸¤ç¯‡æ–‡ç« ä¸­æåˆ°çš„çŸ¥è¯†ç‚¹ï¼ŒåŠ æ·±ä½ å¯¹æ•°æ®åº“ç´¢å¼•çš„ç†è§£ã€‚</p><p>ä¸€å¥è¯ç®€å•æ¥è¯´ï¼Œç´¢å¼•çš„å‡ºç°å…¶å®å°±æ˜¯ä¸ºäº†æé«˜æ•°æ®æŸ¥è¯¢çš„æ•ˆç‡ï¼Œå°±åƒä¹¦çš„ç›®å½•ä¸€æ ·ã€‚ä¸€æœ¬ 500 é¡µçš„ä¹¦ï¼Œå¦‚æœä½ æƒ³å¿«é€Ÿæ‰¾åˆ°å…¶ä¸­çš„æŸä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼Œåœ¨ä¸å€ŸåŠ©ç›®å½•çš„æƒ…å†µä¸‹ï¼Œé‚£æˆ‘ä¼°è®¡ä½ å¯å¾—æ‰¾ä¸€ä¼šå„¿ã€‚åŒæ ·ï¼Œå¯¹äºæ•°æ®åº“çš„è¡¨è€Œè¨€ï¼Œç´¢å¼•å…¶å®å°±æ˜¯å®ƒçš„â€œç›®å½•â€ã€‚</p><h4 id="ç´¢å¼•çš„å¸¸è§æ¨¡å‹" tabindex="-1"><a class="header-anchor" href="#ç´¢å¼•çš„å¸¸è§æ¨¡å‹" aria-hidden="true">#</a> ç´¢å¼•çš„å¸¸è§æ¨¡å‹</h4><p>ç´¢å¼•çš„å‡ºç°æ˜¯ä¸ºäº†æé«˜æŸ¥è¯¢æ•ˆç‡ï¼Œä½†æ˜¯å®ç°ç´¢å¼•çš„æ–¹å¼å´æœ‰å¾ˆå¤šç§ï¼Œæ‰€ä»¥è¿™é‡Œä¹Ÿå°±å¼•å…¥äº†ç´¢å¼•æ¨¡å‹çš„æ¦‚å¿µã€‚å¯ä»¥ç”¨äºæé«˜è¯»å†™æ•ˆç‡çš„æ•°æ®ç»“æ„å¾ˆå¤šï¼Œè¿™é‡Œæˆ‘å…ˆç»™ä½ ä»‹ç»ä¸‰ç§å¸¸è§ã€ä¹Ÿæ¯”è¾ƒç®€å•çš„æ•°æ®ç»“æ„ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯å“ˆå¸Œè¡¨ã€æœ‰åºæ•°ç»„å’Œæœç´¢æ ‘ã€‚</p><p>ä¸‹é¢æˆ‘ä¸»è¦ä»ä½¿ç”¨çš„è§’åº¦ï¼Œä¸ºä½ ç®€å•åˆ†æä¸€ä¸‹è¿™ä¸‰ç§æ¨¡å‹çš„åŒºåˆ«ã€‚</p><p>å“ˆå¸Œè¡¨æ˜¯ä¸€ç§ä»¥é”® - å€¼ï¼ˆkey-valueï¼‰å­˜å‚¨æ•°æ®çš„ç»“æ„ï¼Œæˆ‘ä»¬åªè¦è¾“å…¥å¾…æŸ¥æ‰¾çš„å€¼å³ keyï¼Œå°±å¯ä»¥æ‰¾åˆ°å…¶å¯¹åº”çš„å€¼å³ Valueã€‚å“ˆå¸Œçš„æ€è·¯å¾ˆç®€å•ï¼ŒæŠŠå€¼æ”¾åœ¨æ•°ç»„é‡Œï¼Œç”¨ä¸€ä¸ªå“ˆå¸Œå‡½æ•°æŠŠ key æ¢ç®—æˆä¸€ä¸ªç¡®å®šçš„ä½ç½®ï¼Œç„¶åæŠŠ value æ”¾åœ¨æ•°ç»„çš„è¿™ä¸ªä½ç½®ã€‚</p><p>ä¸å¯é¿å…åœ°ï¼Œå¤šä¸ª key å€¼ç»è¿‡å“ˆå¸Œå‡½æ•°çš„æ¢ç®—ï¼Œä¼šå‡ºç°åŒä¸€ä¸ªå€¼çš„æƒ…å†µã€‚å¤„ç†è¿™ç§æƒ…å†µçš„ä¸€ç§æ–¹æ³•æ˜¯ï¼Œæ‹‰å‡ºä¸€ä¸ªé“¾è¡¨ã€‚</p><p>å‡è®¾ï¼Œä½ ç°åœ¨ç»´æŠ¤ç€ä¸€ä¸ªèº«ä»½è¯ä¿¡æ¯å’Œå§“åçš„è¡¨ï¼Œéœ€è¦æ ¹æ®èº«ä»½è¯å·æŸ¥æ‰¾å¯¹åº”çš„åå­—ï¼Œè¿™æ—¶å¯¹åº”çš„å“ˆå¸Œç´¢å¼•çš„ç¤ºæ„å›¾å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/0c62b601afda86fe5d0fe57346ace957-1584367388037.png" alt="img"></p><p>å›¾ 1 å“ˆå¸Œè¡¨ç¤ºæ„å›¾</p><p>å›¾ä¸­ï¼ŒUser2 å’Œ User4 æ ¹æ®èº«ä»½è¯å·ç®—å‡ºæ¥çš„å€¼éƒ½æ˜¯ Nï¼Œä½†æ²¡å…³ç³»ï¼Œåé¢è¿˜è·Ÿäº†ä¸€ä¸ªé“¾è¡¨ã€‚å‡è®¾ï¼Œè¿™æ—¶å€™ä½ è¦æŸ¥ ID_card_n2 å¯¹åº”çš„åå­—æ˜¯ä»€ä¹ˆï¼Œå¤„ç†æ­¥éª¤å°±æ˜¯ï¼šé¦–å…ˆï¼Œå°† ID_card_n2 é€šè¿‡å“ˆå¸Œå‡½æ•°ç®—å‡º Nï¼›ç„¶åï¼ŒæŒ‰é¡ºåºéå†ï¼Œæ‰¾åˆ° User2ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå›¾ä¸­å››ä¸ª ID_card_n çš„å€¼å¹¶ä¸æ˜¯é€’å¢çš„ï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯å¢åŠ æ–°çš„ User æ—¶é€Ÿåº¦ä¼šå¾ˆå¿«ï¼Œåªéœ€è¦å¾€åè¿½åŠ ã€‚ä½†ç¼ºç‚¹æ˜¯ï¼Œå› ä¸ºä¸æ˜¯æœ‰åºçš„ï¼Œæ‰€ä»¥å“ˆå¸Œç´¢å¼•åšåŒºé—´æŸ¥è¯¢çš„é€Ÿåº¦æ˜¯å¾ˆæ…¢çš„ã€‚</p><p>ä½ å¯ä»¥è®¾æƒ³ä¸‹ï¼Œå¦‚æœä½ ç°åœ¨è¦æ‰¾èº«ä»½è¯å·åœ¨ [ID_card_X, ID_card_Y] è¿™ä¸ªåŒºé—´çš„æ‰€æœ‰ç”¨æˆ·ï¼Œå°±å¿…é¡»å…¨éƒ¨æ‰«æä¸€éäº†ã€‚</p><p>æ‰€ä»¥ï¼Œ<strong>å“ˆå¸Œè¡¨è¿™ç§ç»“æ„é€‚ç”¨äºåªæœ‰ç­‰å€¼æŸ¥è¯¢çš„åœºæ™¯</strong>ï¼Œæ¯”å¦‚ Memcached åŠå…¶ä»–ä¸€äº› NoSQL å¼•æ“ã€‚</p><p>è€Œ<strong>æœ‰åºæ•°ç»„åœ¨ç­‰å€¼æŸ¥è¯¢å’ŒèŒƒå›´æŸ¥è¯¢åœºæ™¯ä¸­çš„æ€§èƒ½å°±éƒ½éå¸¸ä¼˜ç§€</strong>ã€‚è¿˜æ˜¯ä¸Šé¢è¿™ä¸ªæ ¹æ®èº«ä»½è¯å·æŸ¥åå­—çš„ä¾‹å­ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨æœ‰åºæ•°ç»„æ¥å®ç°çš„è¯ï¼Œç¤ºæ„å›¾å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/bfc907a92f99cadf5493cf0afac9ca49-1584367388058.png" alt="img"></p><p>å›¾ 2 æœ‰åºæ•°ç»„ç¤ºæ„å›¾</p><p>è¿™é‡Œæˆ‘ä»¬å‡è®¾èº«ä»½è¯å·æ²¡æœ‰é‡å¤ï¼Œè¿™ä¸ªæ•°ç»„å°±æ˜¯æŒ‰ç…§èº«ä»½è¯å·é€’å¢çš„é¡ºåºä¿å­˜çš„ã€‚è¿™æ—¶å€™å¦‚æœä½ è¦æŸ¥ ID_card_n2 å¯¹åº”çš„åå­—ï¼Œç”¨äºŒåˆ†æ³•å°±å¯ä»¥å¿«é€Ÿå¾—åˆ°ï¼Œè¿™ä¸ªæ—¶é—´å¤æ‚åº¦æ˜¯ O(log(N))ã€‚</p><p>åŒæ—¶å¾ˆæ˜¾ç„¶ï¼Œè¿™ä¸ªç´¢å¼•ç»“æ„æ”¯æŒèŒƒå›´æŸ¥è¯¢ã€‚ä½ è¦æŸ¥èº«ä»½è¯å·åœ¨ [ID_card_X, ID_card_Y] åŒºé—´çš„ Userï¼Œå¯ä»¥å…ˆç”¨äºŒåˆ†æ³•æ‰¾åˆ° ID_card_Xï¼ˆå¦‚æœä¸å­˜åœ¨ ID_card_Xï¼Œå°±æ‰¾åˆ°å¤§äº ID_card_X çš„ç¬¬ä¸€ä¸ª Userï¼‰ï¼Œç„¶åå‘å³éå†ï¼Œç›´åˆ°æŸ¥åˆ°ç¬¬ä¸€ä¸ªå¤§äº ID_card_Y çš„èº«ä»½è¯å·ï¼Œé€€å‡ºå¾ªç¯ã€‚</p><p>å¦‚æœä»…ä»…çœ‹æŸ¥è¯¢æ•ˆç‡ï¼Œæœ‰åºæ•°ç»„å°±æ˜¯æœ€å¥½çš„æ•°æ®ç»“æ„äº†ã€‚ä½†æ˜¯ï¼Œåœ¨éœ€è¦æ›´æ–°æ•°æ®çš„æ—¶å€™å°±éº»çƒ¦äº†ï¼Œä½ å¾€ä¸­é—´æ’å…¥ä¸€ä¸ªè®°å½•å°±å¿…é¡»å¾—æŒªåŠ¨åé¢æ‰€æœ‰çš„è®°å½•ï¼Œæˆæœ¬å¤ªé«˜ã€‚</p><p>æ‰€ä»¥ï¼Œ<strong>æœ‰åºæ•°ç»„ç´¢å¼•åªé€‚ç”¨äºé™æ€å­˜å‚¨å¼•æ“</strong>ï¼Œæ¯”å¦‚ä½ è¦ä¿å­˜çš„æ˜¯ 2017 å¹´æŸä¸ªåŸå¸‚çš„æ‰€æœ‰äººå£ä¿¡æ¯ï¼Œè¿™ç±»ä¸ä¼šå†ä¿®æ”¹çš„æ•°æ®ã€‚</p><p>äºŒå‰æœç´¢æ ‘ä¹Ÿæ˜¯è¯¾æœ¬é‡Œçš„ç»å…¸æ•°æ®ç»“æ„äº†ã€‚è¿˜æ˜¯ä¸Šé¢æ ¹æ®èº«ä»½è¯å·æŸ¥åå­—çš„ä¾‹å­ï¼Œå¦‚æœæˆ‘ä»¬ç”¨äºŒå‰æœç´¢æ ‘æ¥å®ç°çš„è¯ï¼Œç¤ºæ„å›¾å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/04fb9d24065635a6a637c25ba9ddde68-1584367388076.png" alt="img"></p><p>å›¾ 3 äºŒå‰æœç´¢æ ‘ç¤ºæ„å›¾</p><p>äºŒå‰æœç´¢æ ‘çš„ç‰¹ç‚¹æ˜¯ï¼šæ¯ä¸ªèŠ‚ç‚¹çš„å·¦å„¿å­å°äºçˆ¶èŠ‚ç‚¹ï¼Œçˆ¶èŠ‚ç‚¹åˆå°äºå³å„¿å­ã€‚è¿™æ ·å¦‚æœä½ è¦æŸ¥ ID_card_n2 çš„è¯ï¼ŒæŒ‰ç…§å›¾ä¸­çš„æœç´¢é¡ºåºå°±æ˜¯æŒ‰ç…§ UserA -&gt; UserC -&gt; UserF -&gt; User2 è¿™ä¸ªè·¯å¾„å¾—åˆ°ã€‚è¿™ä¸ªæ—¶é—´å¤æ‚åº¦æ˜¯ O(log(N))ã€‚</p><p>å½“ç„¶ä¸ºäº†ç»´æŒ O(log(N)) çš„æŸ¥è¯¢å¤æ‚åº¦ï¼Œä½ å°±éœ€è¦ä¿æŒè¿™æ£µæ ‘æ˜¯å¹³è¡¡äºŒå‰æ ‘ã€‚ä¸ºäº†åšè¿™ä¸ªä¿è¯ï¼Œæ›´æ–°çš„æ—¶é—´å¤æ‚åº¦ä¹Ÿæ˜¯ O(log(N))ã€‚</p><p>æ ‘å¯ä»¥æœ‰äºŒå‰ï¼Œä¹Ÿå¯ä»¥æœ‰å¤šå‰ã€‚å¤šå‰æ ‘å°±æ˜¯æ¯ä¸ªèŠ‚ç‚¹æœ‰å¤šä¸ªå„¿å­ï¼Œå„¿å­ä¹‹é—´çš„å¤§å°ä¿è¯ä»å·¦åˆ°å³é€’å¢ã€‚äºŒå‰æ ‘æ˜¯æœç´¢æ•ˆç‡æœ€é«˜çš„ï¼Œä½†æ˜¯å®é™…ä¸Šå¤§å¤šæ•°çš„æ•°æ®åº“å­˜å‚¨å´å¹¶ä¸ä½¿ç”¨äºŒå‰æ ‘ã€‚å…¶åŸå› æ˜¯ï¼Œç´¢å¼•ä¸æ­¢å­˜åœ¨å†…å­˜ä¸­ï¼Œè¿˜è¦å†™åˆ°ç£ç›˜ä¸Šã€‚</p><p>ä½ å¯ä»¥æƒ³è±¡ä¸€ä¸‹ä¸€æ£µ 100 ä¸‡èŠ‚ç‚¹çš„å¹³è¡¡äºŒå‰æ ‘ï¼Œæ ‘é«˜ 20ã€‚ä¸€æ¬¡æŸ¥è¯¢å¯èƒ½éœ€è¦è®¿é—® 20 ä¸ªæ•°æ®å—ã€‚åœ¨æœºæ¢°ç¡¬ç›˜æ—¶ä»£ï¼Œä»ç£ç›˜éšæœºè¯»ä¸€ä¸ªæ•°æ®å—éœ€è¦ 10 ms å·¦å³çš„å¯»å€æ—¶é—´ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹äºä¸€ä¸ª 100 ä¸‡è¡Œçš„è¡¨ï¼Œå¦‚æœä½¿ç”¨äºŒå‰æ ‘æ¥å­˜å‚¨ï¼Œå•ç‹¬è®¿é—®ä¸€ä¸ªè¡Œå¯èƒ½éœ€è¦ 20 ä¸ª 10 ms çš„æ—¶é—´ï¼Œè¿™ä¸ªæŸ¥è¯¢å¯çœŸå¤Ÿæ…¢çš„ã€‚</p><p>ä¸ºäº†è®©ä¸€ä¸ªæŸ¥è¯¢å°½é‡å°‘åœ°è¯»ç£ç›˜ï¼Œå°±å¿…é¡»è®©æŸ¥è¯¢è¿‡ç¨‹è®¿é—®å°½é‡å°‘çš„æ•°æ®å—ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬å°±ä¸åº”è¯¥ä½¿ç”¨äºŒå‰æ ‘ï¼Œè€Œæ˜¯è¦ä½¿ç”¨â€œN å‰â€æ ‘ã€‚è¿™é‡Œï¼Œâ€œN å‰â€æ ‘ä¸­çš„â€œNâ€å–å†³äºæ•°æ®å—çš„å¤§å°ã€‚</p><p>ä»¥ InnoDB çš„ä¸€ä¸ªæ•´æ•°å­—æ®µç´¢å¼•ä¸ºä¾‹ï¼Œè¿™ä¸ª N å·®ä¸å¤šæ˜¯ 1200ã€‚è¿™æ£µæ ‘é«˜æ˜¯ 4 çš„æ—¶å€™ï¼Œå°±å¯ä»¥å­˜ 1200 çš„ 3 æ¬¡æ–¹ä¸ªå€¼ï¼Œè¿™å·²ç» 17 äº¿äº†ã€‚è€ƒè™‘åˆ°æ ‘æ ¹çš„æ•°æ®å—æ€»æ˜¯åœ¨å†…å­˜ä¸­çš„ï¼Œä¸€ä¸ª 10 äº¿è¡Œçš„è¡¨ä¸Šä¸€ä¸ªæ•´æ•°å­—æ®µçš„ç´¢å¼•ï¼ŒæŸ¥æ‰¾ä¸€ä¸ªå€¼æœ€å¤šåªéœ€è¦è®¿é—® 3 æ¬¡ç£ç›˜ã€‚å…¶å®ï¼Œæ ‘çš„ç¬¬äºŒå±‚ä¹Ÿæœ‰å¾ˆå¤§æ¦‚ç‡åœ¨å†…å­˜ä¸­ï¼Œé‚£ä¹ˆè®¿é—®ç£ç›˜çš„å¹³å‡æ¬¡æ•°å°±æ›´å°‘äº†ã€‚</p><p>N å‰æ ‘ç”±äºåœ¨è¯»å†™ä¸Šçš„æ€§èƒ½ä¼˜ç‚¹ï¼Œä»¥åŠé€‚é…ç£ç›˜çš„è®¿é—®æ¨¡å¼ï¼Œå·²ç»è¢«å¹¿æ³›åº”ç”¨åœ¨æ•°æ®åº“å¼•æ“ä¸­äº†ã€‚</p><p>ä¸ç®¡æ˜¯å“ˆå¸Œè¿˜æ˜¯æœ‰åºæ•°ç»„ï¼Œæˆ–è€… N å‰æ ‘ï¼Œå®ƒä»¬éƒ½æ˜¯ä¸æ–­è¿­ä»£ã€ä¸æ–­ä¼˜åŒ–çš„äº§ç‰©æˆ–è€…è§£å†³æ–¹æ¡ˆã€‚æ•°æ®åº“æŠ€æœ¯å‘å±•åˆ°ä»Šå¤©ï¼Œè·³è¡¨ã€LSM æ ‘ç­‰æ•°æ®ç»“æ„ä¹Ÿè¢«ç”¨äºå¼•æ“è®¾è®¡ä¸­ï¼Œè¿™é‡Œæˆ‘å°±ä¸å†ä¸€ä¸€å±•å¼€äº†ã€‚</p><p>ä½ å¿ƒé‡Œè¦æœ‰ä¸ªæ¦‚å¿µï¼Œæ•°æ®åº“åº•å±‚å­˜å‚¨çš„æ ¸å¿ƒå°±æ˜¯åŸºäºè¿™äº›æ•°æ®æ¨¡å‹çš„ã€‚æ¯ç¢°åˆ°ä¸€ä¸ªæ–°æ•°æ®åº“ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå…³æ³¨å®ƒçš„æ•°æ®æ¨¡å‹ï¼Œè¿™æ ·æ‰èƒ½ä»ç†è®ºä¸Šåˆ†æå‡ºè¿™ä¸ªæ•°æ®åº“çš„é€‚ç”¨åœºæ™¯ã€‚</p><p>æˆªæ­¢åˆ°è¿™é‡Œï¼Œæˆ‘ç”¨äº†åŠç¯‡æ–‡ç« çš„ç¯‡å¹…å’Œä½ ä»‹ç»äº†ä¸åŒçš„æ•°æ®ç»“æ„ï¼Œä»¥åŠå®ƒä»¬çš„é€‚ç”¨åœºæ™¯ï¼Œä½ å¯èƒ½ä¼šè§‰å¾—æœ‰äº›æ¯ç‡¥ã€‚ä½†æ˜¯ï¼Œæˆ‘å»ºè®®ä½ è¿˜æ˜¯è¦å¤šèŠ±ä¸€äº›æ—¶é—´æ¥ç†è§£è¿™éƒ¨åˆ†å†…å®¹ï¼Œæ¯•ç«Ÿè¿™æ˜¯æ•°æ®åº“å¤„ç†æ•°æ®çš„æ ¸å¿ƒæ¦‚å¿µä¹‹ä¸€ï¼Œåœ¨åˆ†æé—®é¢˜çš„æ—¶å€™ä¼šç»å¸¸ç”¨åˆ°ã€‚å½“ä½ ç†è§£äº†ç´¢å¼•çš„æ¨¡å‹åï¼Œå°±ä¼šå‘ç°åœ¨åˆ†æé—®é¢˜çš„æ—¶å€™ä¼šæœ‰ä¸€ä¸ªæ›´æ¸…æ™°çš„è§†è§’ï¼Œä½“ä¼šåˆ°å¼•æ“è®¾è®¡çš„ç²¾å¦™ä¹‹å¤„ã€‚</p><p>ç°åœ¨ï¼Œæˆ‘ä»¬ä¸€èµ·è¿›å…¥ç›¸å¯¹åå®æˆ˜çš„å†…å®¹å§ã€‚</p><p>åœ¨ MySQL ä¸­ï¼Œç´¢å¼•æ˜¯åœ¨å­˜å‚¨å¼•æ“å±‚å®ç°çš„ï¼Œæ‰€ä»¥å¹¶æ²¡æœ‰ç»Ÿä¸€çš„ç´¢å¼•æ ‡å‡†ï¼Œå³ä¸åŒå­˜å‚¨å¼•æ“çš„ç´¢å¼•çš„å·¥ä½œæ–¹å¼å¹¶ä¸ä¸€æ ·ã€‚è€Œå³ä½¿å¤šä¸ªå­˜å‚¨å¼•æ“æ”¯æŒåŒä¸€ç§ç±»å‹çš„ç´¢å¼•ï¼Œå…¶åº•å±‚çš„å®ç°ä¹Ÿå¯èƒ½ä¸åŒã€‚ç”±äº InnoDB å­˜å‚¨å¼•æ“åœ¨ MySQL æ•°æ®åº“ä¸­ä½¿ç”¨æœ€ä¸ºå¹¿æ³›ï¼Œæ‰€ä»¥ä¸‹é¢æˆ‘å°±ä»¥ InnoDB ä¸ºä¾‹ï¼Œå’Œä½ åˆ†æä¸€ä¸‹å…¶ä¸­çš„ç´¢å¼•æ¨¡å‹ã€‚</p><h4 id="innodb-çš„ç´¢å¼•æ¨¡å‹" tabindex="-1"><a class="header-anchor" href="#innodb-çš„ç´¢å¼•æ¨¡å‹" aria-hidden="true">#</a> InnoDB çš„ç´¢å¼•æ¨¡å‹</h4><p>åœ¨ InnoDB ä¸­ï¼Œè¡¨éƒ½æ˜¯æ ¹æ®ä¸»é”®é¡ºåºä»¥ç´¢å¼•çš„å½¢å¼å­˜æ”¾çš„ï¼Œè¿™ç§å­˜å‚¨æ–¹å¼çš„è¡¨ç§°ä¸ºç´¢å¼•ç»„ç»‡è¡¨ã€‚åˆå› ä¸ºå‰é¢æˆ‘ä»¬æåˆ°çš„ï¼ŒInnoDB ä½¿ç”¨äº† B+ æ ‘ç´¢å¼•æ¨¡å‹ï¼Œæ‰€ä»¥æ•°æ®éƒ½æ˜¯å­˜å‚¨åœ¨ B+ æ ‘ä¸­çš„ã€‚</p><p>æ¯ä¸€ä¸ªç´¢å¼•åœ¨ InnoDB é‡Œé¢å¯¹åº”ä¸€æ£µ B+ æ ‘ã€‚</p><p>å‡è®¾ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªä¸»é”®åˆ—ä¸º ID çš„è¡¨ï¼Œè¡¨ä¸­æœ‰å­—æ®µ kï¼Œå¹¶ä¸”åœ¨ k ä¸Šæœ‰ç´¢å¼•ã€‚</p><p>è¿™ä¸ªè¡¨çš„å»ºè¡¨è¯­å¥æ˜¯ï¼š</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token keyword">table</span> T<span class="token punctuation">(</span>
id <span class="token keyword">int</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span> 
k <span class="token keyword">int</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span> 
name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token keyword">index</span> <span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">engine</span><span class="token operator">=</span><span class="token keyword">InnoDB</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¡¨ä¸­ R1~R5 çš„ (ID,k) å€¼åˆ†åˆ«ä¸º (100,1)ã€(200,2)ã€(300,3)ã€(500,5) å’Œ (600,6)ï¼Œä¸¤æ£µæ ‘çš„ç¤ºä¾‹ç¤ºæ„å›¾å¦‚ä¸‹ã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/dcda101051f28502bd5c4402b292e38d-1584367388237.png" alt="img"></p><p>å›¾ 4 InnoDB çš„ç´¢å¼•ç»„ç»‡ç»“æ„</p><p>ä»å›¾ä¸­ä¸éš¾çœ‹å‡ºï¼Œæ ¹æ®å¶å­èŠ‚ç‚¹çš„å†…å®¹ï¼Œç´¢å¼•ç±»å‹åˆ†ä¸ºä¸»é”®ç´¢å¼•å’Œéä¸»é”®ç´¢å¼•ã€‚</p><p>ä¸»é”®ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜çš„æ˜¯æ•´è¡Œæ•°æ®ã€‚åœ¨ InnoDB é‡Œï¼Œä¸»é”®ç´¢å¼•ä¹Ÿè¢«ç§°ä¸ºèšç°‡ç´¢å¼•ï¼ˆclustered indexï¼‰ã€‚</p><p>éä¸»é”®ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å†…å®¹æ˜¯ä¸»é”®çš„å€¼ã€‚åœ¨ InnoDB é‡Œï¼Œéä¸»é”®ç´¢å¼•ä¹Ÿè¢«ç§°ä¸ºäºŒçº§ç´¢å¼•ï¼ˆsecondary indexï¼‰ã€‚</p><p>æ ¹æ®ä¸Šé¢çš„ç´¢å¼•ç»“æ„è¯´æ˜ï¼Œæˆ‘ä»¬æ¥è®¨è®ºä¸€ä¸ªé—®é¢˜ï¼š<strong>åŸºäºä¸»é”®ç´¢å¼•å’Œæ™®é€šç´¢å¼•çš„æŸ¥è¯¢æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</strong></p><ul><li>å¦‚æœè¯­å¥æ˜¯ select * from T where ID=500ï¼Œå³ä¸»é”®æŸ¥è¯¢æ–¹å¼ï¼Œåˆ™åªéœ€è¦æœç´¢ ID è¿™æ£µ B+ æ ‘ï¼›</li><li>å¦‚æœè¯­å¥æ˜¯ select * from T where k=5ï¼Œå³æ™®é€šç´¢å¼•æŸ¥è¯¢æ–¹å¼ï¼Œåˆ™éœ€è¦å…ˆæœç´¢ k ç´¢å¼•æ ‘ï¼Œå¾—åˆ° ID çš„å€¼ä¸º 500ï¼Œå†åˆ° ID ç´¢å¼•æ ‘æœç´¢ä¸€æ¬¡ã€‚è¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºå›è¡¨ã€‚</li></ul><p>ä¹Ÿå°±æ˜¯è¯´ï¼ŒåŸºäºéä¸»é”®ç´¢å¼•çš„æŸ¥è¯¢éœ€è¦å¤šæ‰«æä¸€æ£µç´¢å¼•æ ‘ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åœ¨åº”ç”¨ä¸­åº”è¯¥å°½é‡ä½¿ç”¨ä¸»é”®æŸ¥è¯¢ã€‚</p><h4 id="ç´¢å¼•ç»´æŠ¤" tabindex="-1"><a class="header-anchor" href="#ç´¢å¼•ç»´æŠ¤" aria-hidden="true">#</a> ç´¢å¼•ç»´æŠ¤</h4><p>B+ æ ‘ä¸ºäº†ç»´æŠ¤ç´¢å¼•æœ‰åºæ€§ï¼Œåœ¨æ’å…¥æ–°å€¼çš„æ—¶å€™éœ€è¦åšå¿…è¦çš„ç»´æŠ¤ã€‚ä»¥ä¸Šé¢è¿™ä¸ªå›¾ä¸ºä¾‹ï¼Œå¦‚æœæ’å…¥æ–°çš„è¡Œ ID å€¼ä¸º 700ï¼Œåˆ™åªéœ€è¦åœ¨ R5 çš„è®°å½•åé¢æ’å…¥ä¸€ä¸ªæ–°è®°å½•ã€‚å¦‚æœæ–°æ’å…¥çš„ ID å€¼ä¸º 400ï¼Œå°±ç›¸å¯¹éº»çƒ¦äº†ï¼Œéœ€è¦é€»è¾‘ä¸ŠæŒªåŠ¨åé¢çš„æ•°æ®ï¼Œç©ºå‡ºä½ç½®ã€‚</p><p>è€Œæ›´ç³Ÿçš„æƒ…å†µæ˜¯ï¼Œå¦‚æœ R5 æ‰€åœ¨çš„æ•°æ®é¡µå·²ç»æ»¡äº†ï¼Œæ ¹æ® B+ æ ‘çš„ç®—æ³•ï¼Œè¿™æ—¶å€™éœ€è¦ç”³è¯·ä¸€ä¸ªæ–°çš„æ•°æ®é¡µï¼Œç„¶åæŒªåŠ¨éƒ¨åˆ†æ•°æ®è¿‡å»ã€‚è¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºé¡µåˆ†è£‚ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ€§èƒ½è‡ªç„¶ä¼šå—å½±å“ã€‚</p><p>é™¤äº†æ€§èƒ½å¤–ï¼Œé¡µåˆ†è£‚æ“ä½œè¿˜å½±å“æ•°æ®é¡µçš„åˆ©ç”¨ç‡ã€‚åŸæœ¬æ”¾åœ¨ä¸€ä¸ªé¡µçš„æ•°æ®ï¼Œç°åœ¨åˆ†åˆ°ä¸¤ä¸ªé¡µä¸­ï¼Œæ•´ä½“ç©ºé—´åˆ©ç”¨ç‡é™ä½å¤§çº¦ 50%ã€‚</p><p>å½“ç„¶æœ‰åˆ†è£‚å°±æœ‰åˆå¹¶ã€‚å½“ç›¸é‚»ä¸¤ä¸ªé¡µç”±äºåˆ é™¤äº†æ•°æ®ï¼Œåˆ©ç”¨ç‡å¾ˆä½ä¹‹åï¼Œä¼šå°†æ•°æ®é¡µåšåˆå¹¶ã€‚åˆå¹¶çš„è¿‡ç¨‹ï¼Œå¯ä»¥è®¤ä¸ºæ˜¯åˆ†è£‚è¿‡ç¨‹çš„é€†è¿‡ç¨‹ã€‚</p><p>åŸºäºä¸Šé¢çš„ç´¢å¼•ç»´æŠ¤è¿‡ç¨‹è¯´æ˜ï¼Œæˆ‘ä»¬æ¥è®¨è®ºä¸€ä¸ªæ¡ˆä¾‹ï¼š</p><blockquote><p>ä½ å¯èƒ½åœ¨ä¸€äº›å»ºè¡¨è§„èŒƒé‡Œé¢è§åˆ°è¿‡ç±»ä¼¼çš„æè¿°ï¼Œè¦æ±‚å»ºè¡¨è¯­å¥é‡Œä¸€å®šè¦æœ‰è‡ªå¢ä¸»é”®ã€‚å½“ç„¶äº‹æ— ç»å¯¹ï¼Œæˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹å“ªäº›åœºæ™¯ä¸‹åº”è¯¥ä½¿ç”¨è‡ªå¢ä¸»é”®ï¼Œè€Œå“ªäº›åœºæ™¯ä¸‹ä¸åº”è¯¥ã€‚</p></blockquote><p>è‡ªå¢ä¸»é”®æ˜¯æŒ‡è‡ªå¢åˆ—ä¸Šå®šä¹‰çš„ä¸»é”®ï¼Œåœ¨å»ºè¡¨è¯­å¥ä¸­ä¸€èˆ¬æ˜¯è¿™ä¹ˆå®šä¹‰çš„ï¼š NOT NULL PRIMARY KEY AUTO_INCREMENTã€‚</p><p>æ’å…¥æ–°è®°å½•çš„æ—¶å€™å¯ä»¥ä¸æŒ‡å®š ID çš„å€¼ï¼Œç³»ç»Ÿä¼šè·å–å½“å‰ ID æœ€å¤§å€¼åŠ  1 ä½œä¸ºä¸‹ä¸€æ¡è®°å½•çš„ ID å€¼ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œè‡ªå¢ä¸»é”®çš„æ’å…¥æ•°æ®æ¨¡å¼ï¼Œæ­£ç¬¦åˆäº†æˆ‘ä»¬å‰é¢æåˆ°çš„é€’å¢æ’å…¥çš„åœºæ™¯ã€‚æ¯æ¬¡æ’å…¥ä¸€æ¡æ–°è®°å½•ï¼Œéƒ½æ˜¯è¿½åŠ æ“ä½œï¼Œéƒ½ä¸æ¶‰åŠåˆ°æŒªåŠ¨å…¶ä»–è®°å½•ï¼Œä¹Ÿä¸ä¼šè§¦å‘å¶å­èŠ‚ç‚¹çš„åˆ†è£‚ã€‚</p><p>è€Œæœ‰ä¸šåŠ¡é€»è¾‘çš„å­—æ®µåšä¸»é”®ï¼Œåˆ™å¾€å¾€ä¸å®¹æ˜“ä¿è¯æœ‰åºæ’å…¥ï¼Œè¿™æ ·å†™æ•°æ®æˆæœ¬ç›¸å¯¹è¾ƒé«˜ã€‚</p><p>é™¤äº†è€ƒè™‘æ€§èƒ½å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä»å­˜å‚¨ç©ºé—´çš„è§’åº¦æ¥çœ‹ã€‚å‡è®¾ä½ çš„è¡¨ä¸­ç¡®å®æœ‰ä¸€ä¸ªå”¯ä¸€å­—æ®µï¼Œæ¯”å¦‚å­—ç¬¦ä¸²ç±»å‹çš„èº«ä»½è¯å·ï¼Œé‚£åº”è¯¥ç”¨èº«ä»½è¯å·åšä¸»é”®ï¼Œè¿˜æ˜¯ç”¨è‡ªå¢å­—æ®µåšä¸»é”®å‘¢ï¼Ÿ</p><p>ç”±äºæ¯ä¸ªéä¸»é”®ç´¢å¼•çš„å¶å­èŠ‚ç‚¹ä¸Šéƒ½æ˜¯ä¸»é”®çš„å€¼ã€‚å¦‚æœç”¨èº«ä»½è¯å·åšä¸»é”®ï¼Œé‚£ä¹ˆæ¯ä¸ªäºŒçº§ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å ç”¨çº¦ 20 ä¸ªå­—èŠ‚ï¼Œè€Œå¦‚æœç”¨æ•´å‹åšä¸»é”®ï¼Œåˆ™åªè¦ 4 ä¸ªå­—èŠ‚ï¼Œå¦‚æœæ˜¯é•¿æ•´å‹ï¼ˆbigintï¼‰åˆ™æ˜¯ 8 ä¸ªå­—èŠ‚ã€‚</p><p><strong>æ˜¾ç„¶ï¼Œä¸»é”®é•¿åº¦è¶Šå°ï¼Œæ™®é€šç´¢å¼•çš„å¶å­èŠ‚ç‚¹å°±è¶Šå°ï¼Œæ™®é€šç´¢å¼•å ç”¨çš„ç©ºé—´ä¹Ÿå°±è¶Šå°ã€‚</strong></p><p>æ‰€ä»¥ï¼Œä»æ€§èƒ½å’Œå­˜å‚¨ç©ºé—´æ–¹é¢è€ƒé‡ï¼Œè‡ªå¢ä¸»é”®å¾€å¾€æ˜¯æ›´åˆç†çš„é€‰æ‹©ã€‚</p><p>æœ‰æ²¡æœ‰ä»€ä¹ˆåœºæ™¯é€‚åˆç”¨ä¸šåŠ¡å­—æ®µç›´æ¥åšä¸»é”®çš„å‘¢ï¼Ÿè¿˜æ˜¯æœ‰çš„ã€‚æ¯”å¦‚ï¼Œæœ‰äº›ä¸šåŠ¡çš„åœºæ™¯éœ€æ±‚æ˜¯è¿™æ ·çš„ï¼š</p><ol><li>åªæœ‰ä¸€ä¸ªç´¢å¼•ï¼›</li><li>è¯¥ç´¢å¼•å¿…é¡»æ˜¯å”¯ä¸€ç´¢å¼•ã€‚</li></ol><p>ä½ ä¸€å®šçœ‹å‡ºæ¥äº†ï¼Œè¿™å°±æ˜¯å…¸å‹çš„ KV åœºæ™¯ã€‚</p><p>ç”±äºæ²¡æœ‰å…¶ä»–ç´¢å¼•ï¼Œæ‰€ä»¥ä¹Ÿå°±ä¸ç”¨è€ƒè™‘å…¶ä»–ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å¤§å°çš„é—®é¢˜ã€‚</p><p>è¿™æ—¶å€™æˆ‘ä»¬å°±è¦ä¼˜å…ˆè€ƒè™‘ä¸Šä¸€æ®µæåˆ°çš„â€œå°½é‡ä½¿ç”¨ä¸»é”®æŸ¥è¯¢â€åŸåˆ™ï¼Œç›´æ¥å°†è¿™ä¸ªç´¢å¼•è®¾ç½®ä¸ºä¸»é”®ï¼Œå¯ä»¥é¿å…æ¯æ¬¡æŸ¥è¯¢éœ€è¦æœç´¢ä¸¤æ£µæ ‘ã€‚</p><h4 id="å°ç»“-3" tabindex="-1"><a class="header-anchor" href="#å°ç»“-3" aria-hidden="true">#</a> å°ç»“</h4><p>ä»Šå¤©ï¼Œæˆ‘è·Ÿä½ åˆ†æäº†æ•°æ®åº“å¼•æ“å¯ç”¨çš„æ•°æ®ç»“æ„ï¼Œä»‹ç»äº† InnoDB é‡‡ç”¨çš„ B+ æ ‘ç»“æ„ï¼Œä»¥åŠä¸ºä»€ä¹ˆ InnoDB è¦è¿™ä¹ˆé€‰æ‹©ã€‚B+ æ ‘èƒ½å¤Ÿå¾ˆå¥½åœ°é…åˆç£ç›˜çš„è¯»å†™ç‰¹æ€§ï¼Œå‡å°‘å•æ¬¡æŸ¥è¯¢çš„ç£ç›˜è®¿é—®æ¬¡æ•°ã€‚</p><p>ç”±äº InnoDB æ˜¯ç´¢å¼•ç»„ç»‡è¡¨ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä¼šå»ºè®®ä½ åˆ›å»ºä¸€ä¸ªè‡ªå¢ä¸»é”®ï¼Œè¿™æ ·éä¸»é”®ç´¢å¼•å ç”¨çš„ç©ºé—´æœ€å°ã€‚ä½†äº‹æ— ç»å¯¹ï¼Œæˆ‘ä¹Ÿè·Ÿä½ è®¨è®ºäº†ä½¿ç”¨ä¸šåŠ¡é€»è¾‘å­—æ®µåšä¸»é”®çš„åº”ç”¨åœºæ™¯ã€‚</p><p>æœ€åï¼Œæˆ‘ç»™ä½ ç•™ä¸‹ä¸€ä¸ªé—®é¢˜å§ã€‚å¯¹äºä¸Šé¢ä¾‹å­ä¸­çš„ InnoDB è¡¨ Tï¼Œå¦‚æœä½ è¦é‡å»ºç´¢å¼• kï¼Œä½ çš„ä¸¤ä¸ª SQL è¯­å¥å¯ä»¥è¿™ä¹ˆå†™ï¼š</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">alter</span> <span class="token keyword">table</span> T <span class="token keyword">drop</span> <span class="token keyword">index</span> k<span class="token punctuation">;</span>
<span class="token keyword">alter</span> <span class="token keyword">table</span> T <span class="token keyword">add</span> <span class="token keyword">index</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœä½ è¦é‡å»ºä¸»é”®ç´¢å¼•ï¼Œä¹Ÿå¯ä»¥è¿™ä¹ˆå†™ï¼š</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">alter</span> <span class="token keyword">table</span> T <span class="token keyword">drop</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">;</span>
<span class="token keyword">alter</span> <span class="token keyword">table</span> T <span class="token keyword">add</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ‘çš„é—®é¢˜æ˜¯ï¼Œå¯¹äºä¸Šé¢è¿™ä¸¤ä¸ªé‡å»ºç´¢å¼•çš„ä½œæ³•ï¼Œè¯´å‡ºä½ çš„ç†è§£ã€‚å¦‚æœæœ‰ä¸åˆé€‚çš„ï¼Œä¸ºä»€ä¹ˆï¼Œæ›´å¥½çš„æ–¹æ³•æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>ä½ å¯ä»¥æŠŠä½ çš„æ€è€ƒå’Œè§‚ç‚¹å†™åœ¨ç•™è¨€åŒºé‡Œï¼Œæˆ‘ä¼šåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« çš„æœ«å°¾ç»™å‡ºæˆ‘çš„å‚è€ƒç­”æ¡ˆã€‚æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚</p><h4 id="ä¸ŠæœŸé—®é¢˜æ—¶é—´" tabindex="-1"><a class="header-anchor" href="#ä¸ŠæœŸé—®é¢˜æ—¶é—´" aria-hidden="true">#</a> ä¸ŠæœŸé—®é¢˜æ—¶é—´</h4><p>æˆ‘åœ¨ä¸Šä¸€ç¯‡æ–‡ç« æœ«å°¾ç»™ä½ ç•™ä¸‹çš„é—®é¢˜æ˜¯ï¼šå¦‚ä½•é¿å…é•¿äº‹åŠ¡å¯¹ä¸šåŠ¡çš„å½±å“ï¼Ÿ</p><p>è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä»åº”ç”¨å¼€å‘ç«¯å’Œæ•°æ®åº“ç«¯æ¥çœ‹ã€‚</p><p><strong>é¦–å…ˆï¼Œä»åº”ç”¨å¼€å‘ç«¯æ¥çœ‹ï¼š</strong></p><ol><li>ç¡®è®¤æ˜¯å¦ä½¿ç”¨äº† set autocommit=0ã€‚è¿™ä¸ªç¡®è®¤å·¥ä½œå¯ä»¥åœ¨æµ‹è¯•ç¯å¢ƒä¸­å¼€å±•ï¼ŒæŠŠ MySQL çš„ general_log å¼€èµ·æ¥ï¼Œç„¶åéšä¾¿è·‘ä¸€ä¸ªä¸šåŠ¡é€»è¾‘ï¼Œé€šè¿‡ general_log çš„æ—¥å¿—æ¥ç¡®è®¤ã€‚ä¸€èˆ¬æ¡†æ¶å¦‚æœä¼šè®¾ç½®è¿™ä¸ªå€¼ï¼Œä¹Ÿå°±ä¼šæä¾›å‚æ•°æ¥æ§åˆ¶è¡Œä¸ºï¼Œä½ çš„ç›®æ ‡å°±æ˜¯æŠŠå®ƒæ”¹æˆ 1ã€‚</li><li>ç¡®è®¤æ˜¯å¦æœ‰ä¸å¿…è¦çš„åªè¯»äº‹åŠ¡ã€‚æœ‰äº›æ¡†æ¶ä¼šä¹ æƒ¯ä¸ç®¡ä»€ä¹ˆè¯­å¥å…ˆç”¨ begin/commit æ¡†èµ·æ¥ã€‚æˆ‘è§è¿‡æœ‰äº›æ˜¯ä¸šåŠ¡å¹¶æ²¡æœ‰è¿™ä¸ªéœ€è¦ï¼Œä½†æ˜¯ä¹ŸæŠŠå¥½å‡ ä¸ª select è¯­å¥æ”¾åˆ°äº†äº‹åŠ¡ä¸­ã€‚è¿™ç§åªè¯»äº‹åŠ¡å¯ä»¥å»æ‰ã€‚</li><li>ä¸šåŠ¡è¿æ¥æ•°æ®åº“çš„æ—¶å€™ï¼Œæ ¹æ®ä¸šåŠ¡æœ¬èº«çš„é¢„ä¼°ï¼Œé€šè¿‡ SET MAX_EXECUTION_TIME å‘½ä»¤ï¼Œæ¥æ§åˆ¶æ¯ä¸ªè¯­å¥æ‰§è¡Œçš„æœ€é•¿æ—¶é—´ï¼Œé¿å…å•ä¸ªè¯­å¥æ„å¤–æ‰§è¡Œå¤ªé•¿æ—¶é—´ã€‚ï¼ˆä¸ºä»€ä¹ˆä¼šæ„å¤–ï¼Ÿåœ¨åç»­çš„æ–‡ç« ä¸­ä¼šæåˆ°è¿™ç±»æ¡ˆä¾‹ï¼‰</li></ol><p><strong>å…¶æ¬¡ï¼Œä»æ•°æ®åº“ç«¯æ¥çœ‹ï¼š</strong></p><ol><li>ç›‘æ§ information_schema.Innodb_trx è¡¨ï¼Œè®¾ç½®é•¿äº‹åŠ¡é˜ˆå€¼ï¼Œè¶…è¿‡å°±æŠ¥è­¦ / æˆ–è€… killï¼›</li><li>Percona çš„ pt-kill è¿™ä¸ªå·¥å…·ä¸é”™ï¼Œæ¨èä½¿ç”¨ï¼›</li><li>åœ¨ä¸šåŠ¡åŠŸèƒ½æµ‹è¯•é˜¶æ®µè¦æ±‚è¾“å‡ºæ‰€æœ‰çš„ general_logï¼Œåˆ†ææ—¥å¿—è¡Œä¸ºæå‰å‘ç°é—®é¢˜ï¼›</li><li>å¦‚æœä½¿ç”¨çš„æ˜¯ MySQL 5.6 æˆ–è€…æ›´æ–°ç‰ˆæœ¬ï¼ŒæŠŠ innodb_undo_tablespaces è®¾ç½®æˆ 2ï¼ˆæˆ–æ›´å¤§çš„å€¼ï¼‰ã€‚å¦‚æœçœŸçš„å‡ºç°å¤§äº‹åŠ¡å¯¼è‡´å›æ»šæ®µè¿‡å¤§ï¼Œè¿™æ ·è®¾ç½®åæ¸…ç†èµ·æ¥æ›´æ–¹ä¾¿ã€‚</li></ol><p>æ„Ÿè°¢ @å£¹ç¬™â˜æ¼‚æ³Š @ç‹å‡¯ @æ˜“ç¿” ç•™ä¸‹çš„é«˜è´¨é‡è¯„è®ºã€‚</p><h3 id="_05-æ·±å…¥æµ…å‡ºç´¢å¼•-ä¸‹" tabindex="-1"><a class="header-anchor" href="#_05-æ·±å…¥æµ…å‡ºç´¢å¼•-ä¸‹" aria-hidden="true">#</a> 05 æ·±å…¥æµ…å‡ºç´¢å¼•ï¼ˆä¸‹ï¼‰</h3><p>åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å’Œä½ ä»‹ç»äº† InnoDB ç´¢å¼•çš„æ•°æ®ç»“æ„æ¨¡å‹ï¼Œä»Šå¤©æˆ‘ä»¬å†ç»§ç»­èŠèŠè·Ÿ MySQL ç´¢å¼•æœ‰å…³çš„æ¦‚å¿µã€‚</p><p>åœ¨å¼€å§‹è¿™ç¯‡æ–‡ç« ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹è¿™ä¸ªé—®é¢˜ï¼š</p><p>åœ¨ä¸‹é¢è¿™ä¸ªè¡¨ T ä¸­ï¼Œå¦‚æœæˆ‘æ‰§è¡Œ select * from T where k between 3 and 5ï¼Œéœ€è¦æ‰§è¡Œå‡ æ¬¡æ ‘çš„æœç´¢æ“ä½œï¼Œä¼šæ‰«æå¤šå°‘è¡Œï¼Ÿ</p><p>ä¸‹é¢æ˜¯è¿™ä¸ªè¡¨çš„åˆå§‹åŒ–è¯­å¥ã€‚</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token keyword">table</span> T <span class="token punctuation">(</span>
ID <span class="token keyword">int</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span>
k <span class="token keyword">int</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token number">0</span><span class="token punctuation">,</span> 
s <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span>
<span class="token keyword">index</span> k<span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">engine</span><span class="token operator">=</span><span class="token keyword">InnoDB</span><span class="token punctuation">;</span> 
<span class="token keyword">insert</span> <span class="token keyword">into</span> T <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&#39;aa&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">&#39;bb&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">&#39;cc&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token string">&#39;ee&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">600</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token string">&#39;ff&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">700</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token string">&#39;gg&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/dcda101051f28502bd5c4402b292e38d-1550568785632-1584367388458.png" alt="img"></p><p>å›¾ 1 InnoDB çš„ç´¢å¼•ç»„ç»‡ç»“æ„</p><p>ç°åœ¨ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹è¿™æ¡ SQL æŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œæµç¨‹ï¼š</p><ol><li>åœ¨ k ç´¢å¼•æ ‘ä¸Šæ‰¾åˆ° k=3 çš„è®°å½•ï¼Œå–å¾— ID = 300ï¼›</li><li>å†åˆ° ID ç´¢å¼•æ ‘æŸ¥åˆ° ID=300 å¯¹åº”çš„ R3ï¼›</li><li>åœ¨ k ç´¢å¼•æ ‘å–ä¸‹ä¸€ä¸ªå€¼ k=5ï¼Œå–å¾— ID=500ï¼›</li><li>å†å›åˆ° ID ç´¢å¼•æ ‘æŸ¥åˆ° ID=500 å¯¹åº”çš„ R4ï¼›</li><li>åœ¨ k ç´¢å¼•æ ‘å–ä¸‹ä¸€ä¸ªå€¼ k=6ï¼Œä¸æ»¡è¶³æ¡ä»¶ï¼Œå¾ªç¯ç»“æŸã€‚</li></ol><p>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œ<strong>å›åˆ°ä¸»é”®ç´¢å¼•æ ‘æœç´¢çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬ç§°ä¸ºå›è¡¨</strong>ã€‚å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªæŸ¥è¯¢è¿‡ç¨‹è¯»äº† k ç´¢å¼•æ ‘çš„ 3 æ¡è®°å½•ï¼ˆæ­¥éª¤ 1ã€3 å’Œ 5ï¼‰ï¼Œå›è¡¨äº†ä¸¤æ¬¡ï¼ˆæ­¥éª¤ 2 å’Œ 4ï¼‰ã€‚</p><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œç”±äºæŸ¥è¯¢ç»“æœæ‰€éœ€è¦çš„æ•°æ®åªåœ¨ä¸»é”®ç´¢å¼•ä¸Šæœ‰ï¼Œæ‰€ä»¥ä¸å¾—ä¸å›è¡¨ã€‚é‚£ä¹ˆï¼Œæœ‰æ²¡æœ‰å¯èƒ½ç»è¿‡ç´¢å¼•ä¼˜åŒ–ï¼Œé¿å…å›è¡¨è¿‡ç¨‹å‘¢ï¼Ÿ</p><h4 id="è¦†ç›–ç´¢å¼•" tabindex="-1"><a class="header-anchor" href="#è¦†ç›–ç´¢å¼•" aria-hidden="true">#</a> è¦†ç›–ç´¢å¼•</h4><p>å¦‚æœæ‰§è¡Œçš„è¯­å¥æ˜¯ select ID from T where k between 3 and 5ï¼Œè¿™æ—¶åªéœ€è¦æŸ¥ ID çš„å€¼ï¼Œè€Œ ID çš„å€¼å·²ç»åœ¨ k ç´¢å¼•æ ‘ä¸Šäº†ï¼Œå› æ­¤å¯ä»¥ç›´æ¥æä¾›æŸ¥è¯¢ç»“æœï¼Œä¸éœ€è¦å›è¡¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨è¿™ä¸ªæŸ¥è¯¢é‡Œé¢ï¼Œç´¢å¼• k å·²ç»â€œè¦†ç›–äº†â€æˆ‘ä»¬çš„æŸ¥è¯¢éœ€æ±‚ï¼Œæˆ‘ä»¬ç§°ä¸ºè¦†ç›–ç´¢å¼•ã€‚</p><p><strong>ç”±äºè¦†ç›–ç´¢å¼•å¯ä»¥å‡å°‘æ ‘çš„æœç´¢æ¬¡æ•°ï¼Œæ˜¾è‘—æå‡æŸ¥è¯¢æ€§èƒ½ï¼Œæ‰€ä»¥ä½¿ç”¨è¦†ç›–ç´¢å¼•æ˜¯ä¸€ä¸ªå¸¸ç”¨çš„æ€§èƒ½ä¼˜åŒ–æ‰‹æ®µã€‚</strong></p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨å¼•æ“å†…éƒ¨ä½¿ç”¨è¦†ç›–ç´¢å¼•åœ¨ç´¢å¼• k ä¸Šå…¶å®è¯»äº†ä¸‰ä¸ªè®°å½•ï¼ŒR3~R5ï¼ˆå¯¹åº”çš„ç´¢å¼• k ä¸Šçš„è®°å½•é¡¹ï¼‰ï¼Œä½†æ˜¯å¯¹äº MySQL çš„ Server å±‚æ¥è¯´ï¼Œå®ƒå°±æ˜¯æ‰¾å¼•æ“æ‹¿åˆ°äº†ä¸¤æ¡è®°å½•ï¼Œå› æ­¤ MySQL è®¤ä¸ºæ‰«æè¡Œæ•°æ˜¯ 2ã€‚</p><blockquote><p>å¤‡æ³¨ï¼šå…³äºå¦‚ä½•æŸ¥çœ‹æ‰«æè¡Œæ•°çš„é—®é¢˜ï¼Œæˆ‘å°†ä¼šåœ¨ç¬¬ 16 æ–‡ç« ã€Šå¦‚ä½•æ­£ç¡®åœ°æ˜¾ç¤ºéšæœºæ¶ˆæ¯ï¼Ÿã€‹ä¸­ï¼Œå’Œä½ è¯¦ç»†è®¨è®ºã€‚</p></blockquote><p>åŸºäºä¸Šé¢è¦†ç›–ç´¢å¼•çš„è¯´æ˜ï¼Œæˆ‘ä»¬æ¥è®¨è®ºä¸€ä¸ªé—®é¢˜ï¼š<strong>åœ¨ä¸€ä¸ªå¸‚æ°‘ä¿¡æ¯è¡¨ä¸Šï¼Œæ˜¯å¦æœ‰å¿…è¦å°†èº«ä»½è¯å·å’Œåå­—å»ºç«‹è”åˆç´¢å¼•ï¼Ÿ</strong></p><p>å‡è®¾è¿™ä¸ªå¸‚æ°‘è¡¨çš„å®šä¹‰æ˜¯è¿™æ ·çš„ï¼š</p><div class="language-r line-numbers-mode" data-ext="r"><pre class="language-r"><code>CREATE TABLE `tuser` <span class="token punctuation">(</span>
  `id` int<span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> NOT <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  `id_card` varchar<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span> DEFAULT <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  `name` varchar<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span> DEFAULT <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  `age` int<span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> DEFAULT <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  `ismale` tinyint<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> DEFAULT <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  PRIMARY KEY <span class="token punctuation">(</span>`id`<span class="token punctuation">)</span><span class="token punctuation">,</span>
  KEY `id_card` <span class="token punctuation">(</span>`id_card`<span class="token punctuation">)</span><span class="token punctuation">,</span>
  KEY `name_age` <span class="token punctuation">(</span>`name`<span class="token punctuation">,</span>`age`<span class="token punctuation">)</span>
<span class="token punctuation">)</span> ENGINE<span class="token operator">=</span>InnoDB
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ‘ä»¬çŸ¥é“ï¼Œèº«ä»½è¯å·æ˜¯å¸‚æ°‘çš„å”¯ä¸€æ ‡è¯†ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæœ‰æ ¹æ®èº«ä»½è¯å·æŸ¥è¯¢å¸‚æ°‘ä¿¡æ¯çš„éœ€æ±‚ï¼Œæˆ‘ä»¬åªè¦åœ¨èº«ä»½è¯å·å­—æ®µä¸Šå»ºç«‹ç´¢å¼•å°±å¤Ÿäº†ã€‚è€Œå†å»ºç«‹ä¸€ä¸ªï¼ˆèº«ä»½è¯å·ã€å§“åï¼‰çš„è”åˆç´¢å¼•ï¼Œæ˜¯ä¸æ˜¯æµªè´¹ç©ºé—´ï¼Ÿ</p><p>å¦‚æœç°åœ¨æœ‰ä¸€ä¸ªé«˜é¢‘è¯·æ±‚ï¼Œè¦æ ¹æ®å¸‚æ°‘çš„èº«ä»½è¯å·æŸ¥è¯¢ä»–çš„å§“åï¼Œè¿™ä¸ªè”åˆç´¢å¼•å°±æœ‰æ„ä¹‰äº†ã€‚å®ƒå¯ä»¥åœ¨è¿™ä¸ªé«˜é¢‘è¯·æ±‚ä¸Šç”¨åˆ°è¦†ç›–ç´¢å¼•ï¼Œä¸å†éœ€è¦å›è¡¨æŸ¥æ•´è¡Œè®°å½•ï¼Œå‡å°‘è¯­å¥çš„æ‰§è¡Œæ—¶é—´ã€‚</p><p>å½“ç„¶ï¼Œç´¢å¼•å­—æ®µçš„ç»´æŠ¤æ€»æ˜¯æœ‰ä»£ä»·çš„ã€‚å› æ­¤ï¼Œåœ¨å»ºç«‹å†—ä½™ç´¢å¼•æ¥æ”¯æŒè¦†ç›–ç´¢å¼•æ—¶å°±éœ€è¦æƒè¡¡è€ƒè™‘äº†ã€‚è¿™æ­£æ˜¯ä¸šåŠ¡ DBAï¼Œæˆ–è€…ç§°ä¸ºä¸šåŠ¡æ•°æ®æ¶æ„å¸ˆçš„å·¥ä½œã€‚</p><h4 id="æœ€å·¦å‰ç¼€åŸåˆ™" tabindex="-1"><a class="header-anchor" href="#æœ€å·¦å‰ç¼€åŸåˆ™" aria-hidden="true">#</a> æœ€å·¦å‰ç¼€åŸåˆ™</h4><p>çœ‹åˆ°è¿™é‡Œä½ ä¸€å®šæœ‰ä¸€ä¸ªç–‘é—®ï¼Œå¦‚æœä¸ºæ¯ä¸€ç§æŸ¥è¯¢éƒ½è®¾è®¡ä¸€ä¸ªç´¢å¼•ï¼Œç´¢å¼•æ˜¯ä¸æ˜¯å¤ªå¤šäº†ã€‚å¦‚æœæˆ‘ç°åœ¨è¦æŒ‰ç…§å¸‚æ°‘çš„èº«ä»½è¯å·å»æŸ¥ä»–çš„å®¶åº­åœ°å€å‘¢ï¼Ÿè™½ç„¶è¿™ä¸ªæŸ¥è¯¢éœ€æ±‚åœ¨ä¸šåŠ¡ä¸­å‡ºç°çš„æ¦‚ç‡ä¸é«˜ï¼Œä½†æ€»ä¸èƒ½è®©å®ƒèµ°å…¨è¡¨æ‰«æå§ï¼Ÿåè¿‡æ¥è¯´ï¼Œå•ç‹¬ä¸ºä¸€ä¸ªä¸é¢‘ç¹çš„è¯·æ±‚åˆ›å»ºä¸€ä¸ªï¼ˆèº«ä»½è¯å·ï¼Œåœ°å€ï¼‰çš„ç´¢å¼•åˆæ„Ÿè§‰æœ‰ç‚¹æµªè´¹ã€‚åº”è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ</p><p>è¿™é‡Œï¼Œæˆ‘å…ˆå’Œä½ è¯´ç»“è®ºå§ã€‚<strong>B+ æ ‘è¿™ç§ç´¢å¼•ç»“æ„ï¼Œå¯ä»¥åˆ©ç”¨ç´¢å¼•çš„â€œæœ€å·¦å‰ç¼€â€ï¼Œæ¥å®šä½è®°å½•ã€‚</strong></p><p>ä¸ºäº†ç›´è§‚åœ°è¯´æ˜è¿™ä¸ªæ¦‚å¿µï¼Œæˆ‘ä»¬ç”¨ï¼ˆnameï¼Œageï¼‰è¿™ä¸ªè”åˆç´¢å¼•æ¥åˆ†æã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/89f74c631110cfbc83298ef27dcd6370-1584367388561.jpg" alt="img"></p><p>å›¾ 2 ï¼ˆnameï¼Œageï¼‰ç´¢å¼•ç¤ºæ„å›¾</p><p>å¯ä»¥çœ‹åˆ°ï¼Œç´¢å¼•é¡¹æ˜¯æŒ‰ç…§ç´¢å¼•å®šä¹‰é‡Œé¢å‡ºç°çš„å­—æ®µé¡ºåºæ’åºçš„ã€‚</p><p>å½“ä½ çš„é€»è¾‘éœ€æ±‚æ˜¯æŸ¥åˆ°æ‰€æœ‰åå­—æ˜¯â€œå¼ ä¸‰â€çš„äººæ—¶ï¼Œå¯ä»¥å¿«é€Ÿå®šä½åˆ° ID4ï¼Œç„¶åå‘åéå†å¾—åˆ°æ‰€æœ‰éœ€è¦çš„ç»“æœã€‚</p><p>å¦‚æœä½ è¦æŸ¥çš„æ˜¯æ‰€æœ‰åå­—ç¬¬ä¸€ä¸ªå­—æ˜¯â€œå¼ â€çš„äººï¼Œä½ çš„ SQL è¯­å¥çš„æ¡ä»¶æ˜¯&quot;where name like â€˜å¼  %â€™&quot;ã€‚è¿™æ—¶ï¼Œä½ ä¹Ÿèƒ½å¤Ÿç”¨ä¸Šè¿™ä¸ªç´¢å¼•ï¼ŒæŸ¥æ‰¾åˆ°ç¬¬ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„è®°å½•æ˜¯ ID3ï¼Œç„¶åå‘åéå†ï¼Œç›´åˆ°ä¸æ»¡è¶³æ¡ä»¶ä¸ºæ­¢ã€‚</p><p>å¯ä»¥çœ‹åˆ°ï¼Œä¸åªæ˜¯ç´¢å¼•çš„å…¨éƒ¨å®šä¹‰ï¼Œåªè¦æ»¡è¶³æœ€å·¦å‰ç¼€ï¼Œå°±å¯ä»¥åˆ©ç”¨ç´¢å¼•æ¥åŠ é€Ÿæ£€ç´¢ã€‚è¿™ä¸ªæœ€å·¦å‰ç¼€å¯ä»¥æ˜¯è”åˆç´¢å¼•çš„æœ€å·¦ N ä¸ªå­—æ®µï¼Œä¹Ÿå¯ä»¥æ˜¯å­—ç¬¦ä¸²ç´¢å¼•çš„æœ€å·¦ M ä¸ªå­—ç¬¦ã€‚</p><p>åŸºäºä¸Šé¢å¯¹æœ€å·¦å‰ç¼€ç´¢å¼•çš„è¯´æ˜ï¼Œæˆ‘ä»¬æ¥è®¨è®ºä¸€ä¸ªé—®é¢˜ï¼š<strong>åœ¨å»ºç«‹è”åˆç´¢å¼•çš„æ—¶å€™ï¼Œå¦‚ä½•å®‰æ’ç´¢å¼•å†…çš„å­—æ®µé¡ºåºã€‚</strong></p><p>è¿™é‡Œæˆ‘ä»¬çš„è¯„ä¼°æ ‡å‡†æ˜¯ï¼Œç´¢å¼•çš„å¤ç”¨èƒ½åŠ›ã€‚å› ä¸ºå¯ä»¥æ”¯æŒæœ€å·¦å‰ç¼€ï¼Œæ‰€ä»¥å½“å·²ç»æœ‰äº† (a,b) è¿™ä¸ªè”åˆç´¢å¼•åï¼Œä¸€èˆ¬å°±ä¸éœ€è¦å•ç‹¬åœ¨ a ä¸Šå»ºç«‹ç´¢å¼•äº†ã€‚å› æ­¤ï¼Œ<strong>ç¬¬ä¸€åŸåˆ™æ˜¯ï¼Œå¦‚æœé€šè¿‡è°ƒæ•´é¡ºåºï¼Œå¯ä»¥å°‘ç»´æŠ¤ä¸€ä¸ªç´¢å¼•ï¼Œé‚£ä¹ˆè¿™ä¸ªé¡ºåºå¾€å¾€å°±æ˜¯éœ€è¦ä¼˜å…ˆè€ƒè™‘é‡‡ç”¨çš„ã€‚</strong></p><p>æ‰€ä»¥ç°åœ¨ä½ çŸ¥é“äº†ï¼Œè¿™æ®µå¼€å¤´çš„é—®é¢˜é‡Œï¼Œæˆ‘ä»¬è¦ä¸ºé«˜é¢‘è¯·æ±‚åˆ›å»º (èº«ä»½è¯å·ï¼Œå§“åï¼‰è¿™ä¸ªè”åˆç´¢å¼•ï¼Œå¹¶ç”¨è¿™ä¸ªç´¢å¼•æ”¯æŒâ€œæ ¹æ®èº«ä»½è¯å·æŸ¥è¯¢åœ°å€â€çš„éœ€æ±‚ã€‚</p><p>é‚£ä¹ˆï¼Œå¦‚æœæ—¢æœ‰è”åˆæŸ¥è¯¢ï¼Œåˆæœ‰åŸºäº aã€b å„è‡ªçš„æŸ¥è¯¢å‘¢ï¼ŸæŸ¥è¯¢æ¡ä»¶é‡Œé¢åªæœ‰ b çš„è¯­å¥ï¼Œæ˜¯æ— æ³•ä½¿ç”¨ (a,b) è¿™ä¸ªè”åˆç´¢å¼•çš„ï¼Œè¿™æ—¶å€™ä½ ä¸å¾—ä¸ç»´æŠ¤å¦å¤–ä¸€ä¸ªç´¢å¼•ï¼Œä¹Ÿå°±æ˜¯è¯´ä½ éœ€è¦åŒæ—¶ç»´æŠ¤ (a,b)ã€(b) è¿™ä¸¤ä¸ªç´¢å¼•ã€‚</p><p>è¿™æ—¶å€™ï¼Œæˆ‘ä»¬è¦<strong>è€ƒè™‘çš„åŸåˆ™å°±æ˜¯ç©ºé—´</strong>äº†ã€‚æ¯”å¦‚ä¸Šé¢è¿™ä¸ªå¸‚æ°‘è¡¨çš„æƒ…å†µï¼Œname å­—æ®µæ˜¯æ¯” age å­—æ®µå¤§çš„ ï¼Œé‚£æˆ‘å°±å»ºè®®ä½ åˆ›å»ºä¸€ä¸ªï¼ˆname,age) çš„è”åˆç´¢å¼•å’Œä¸€ä¸ª (age) çš„å•å­—æ®µç´¢å¼•ã€‚</p><h4 id="ç´¢å¼•ä¸‹æ¨" tabindex="-1"><a class="header-anchor" href="#ç´¢å¼•ä¸‹æ¨" aria-hidden="true">#</a> ç´¢å¼•ä¸‹æ¨</h4><p>ä¸Šä¸€æ®µæˆ‘ä»¬è¯´åˆ°æ»¡è¶³æœ€å·¦å‰ç¼€åŸåˆ™çš„æ—¶å€™ï¼Œæœ€å·¦å‰ç¼€å¯ä»¥ç”¨äºåœ¨ç´¢å¼•ä¸­å®šä½è®°å½•ã€‚è¿™æ—¶ï¼Œä½ å¯èƒ½è¦é—®ï¼Œé‚£äº›ä¸ç¬¦åˆæœ€å·¦å‰ç¼€çš„éƒ¨åˆ†ï¼Œä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬è¿˜æ˜¯ä»¥å¸‚æ°‘è¡¨çš„è”åˆç´¢å¼•ï¼ˆname, ageï¼‰ä¸ºä¾‹ã€‚å¦‚æœç°åœ¨æœ‰ä¸€ä¸ªéœ€æ±‚ï¼šæ£€ç´¢å‡ºè¡¨ä¸­â€œåå­—ç¬¬ä¸€ä¸ªå­—æ˜¯å¼ ï¼Œè€Œä¸”å¹´é¾„æ˜¯ 10 å²çš„æ‰€æœ‰ç”·å­©â€ã€‚é‚£ä¹ˆï¼ŒSQL è¯­å¥æ˜¯è¿™ä¹ˆå†™çš„ï¼š</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tuser <span class="token keyword">where</span> name <span class="token operator">like</span> <span class="token string">&#39;å¼  %&#39;</span> <span class="token operator">and</span> age<span class="token operator">=</span><span class="token number">10</span> <span class="token operator">and</span> ismale<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ä½ å·²ç»çŸ¥é“äº†å‰ç¼€ç´¢å¼•è§„åˆ™ï¼Œæ‰€ä»¥è¿™ä¸ªè¯­å¥åœ¨æœç´¢ç´¢å¼•æ ‘çš„æ—¶å€™ï¼Œåªèƒ½ç”¨ â€œå¼ â€ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„è®°å½• ID3ã€‚å½“ç„¶ï¼Œè¿™è¿˜ä¸é”™ï¼Œæ€»æ¯”å…¨è¡¨æ‰«æè¦å¥½ã€‚</p><p>ç„¶åå‘¢ï¼Ÿ</p><p>å½“ç„¶æ˜¯åˆ¤æ–­å…¶ä»–æ¡ä»¶æ˜¯å¦æ»¡è¶³ã€‚</p><p>åœ¨ MySQL 5.6 ä¹‹å‰ï¼Œåªèƒ½ä» ID3 å¼€å§‹ä¸€ä¸ªä¸ªå›è¡¨ã€‚åˆ°ä¸»é”®ç´¢å¼•ä¸Šæ‰¾å‡ºæ•°æ®è¡Œï¼Œå†å¯¹æ¯”å­—æ®µå€¼ã€‚</p><p>è€Œ MySQL 5.6 å¼•å…¥çš„ç´¢å¼•ä¸‹æ¨ä¼˜åŒ–ï¼ˆindex condition pushdown)ï¼Œ å¯ä»¥åœ¨ç´¢å¼•éå†è¿‡ç¨‹ä¸­ï¼Œå¯¹ç´¢å¼•ä¸­åŒ…å«çš„å­—æ®µå…ˆåšåˆ¤æ–­ï¼Œç›´æ¥è¿‡æ»¤æ‰ä¸æ»¡è¶³æ¡ä»¶çš„è®°å½•ï¼Œå‡å°‘å›è¡¨æ¬¡æ•°ã€‚</p><p>å›¾ 3 å’Œå›¾ 4ï¼Œæ˜¯è¿™ä¸¤ä¸ªè¿‡ç¨‹çš„æ‰§è¡Œæµç¨‹å›¾ã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/b32aa8b1f75611e0759e52f5915539ac-1584367388568.jpg" alt="img"></p><p>å›¾ 3 æ— ç´¢å¼•ä¸‹æ¨æ‰§è¡Œæµç¨‹</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/76e385f3df5a694cc4238c7b65acfe1b-1584367388573.jpg" alt="img"></p><p>å›¾ 4 ç´¢å¼•ä¸‹æ¨æ‰§è¡Œæµç¨‹</p><p>åœ¨å›¾ 3 å’Œ 4 è¿™ä¸¤ä¸ªå›¾é‡Œé¢ï¼Œæ¯ä¸€ä¸ªè™šçº¿ç®­å¤´è¡¨ç¤ºå›è¡¨ä¸€æ¬¡ã€‚</p><p>å›¾ 3 ä¸­ï¼Œåœ¨ (name,age) ç´¢å¼•é‡Œé¢æˆ‘ç‰¹æ„å»æ‰äº† age çš„å€¼ï¼Œè¿™ä¸ªè¿‡ç¨‹ InnoDB å¹¶ä¸ä¼šå»çœ‹ age çš„å€¼ï¼Œåªæ˜¯æŒ‰é¡ºåºæŠŠâ€œname ç¬¬ä¸€ä¸ªå­—æ˜¯â€™å¼ â€™â€çš„è®°å½•ä¸€æ¡æ¡å–å‡ºæ¥å›è¡¨ã€‚å› æ­¤ï¼Œéœ€è¦å›è¡¨ 4 æ¬¡ã€‚</p><p>å›¾ 4 è·Ÿå›¾ 3 çš„åŒºåˆ«æ˜¯ï¼ŒInnoDB åœ¨ (name,age) ç´¢å¼•å†…éƒ¨å°±åˆ¤æ–­äº† age æ˜¯å¦ç­‰äº 10ï¼Œå¯¹äºä¸ç­‰äº 10 çš„è®°å½•ï¼Œç›´æ¥åˆ¤æ–­å¹¶è·³è¿‡ã€‚åœ¨æˆ‘ä»¬çš„è¿™ä¸ªä¾‹å­ä¸­ï¼Œåªéœ€è¦å¯¹ ID4ã€ID5 è¿™ä¸¤æ¡è®°å½•å›è¡¨å–æ•°æ®åˆ¤æ–­ï¼Œå°±åªéœ€è¦å›è¡¨ 2 æ¬¡ã€‚</p><h4 id="å°ç»“-4" tabindex="-1"><a class="header-anchor" href="#å°ç»“-4" aria-hidden="true">#</a> å°ç»“</h4><p>ä»Šå¤©è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘å’Œä½ ç»§ç»­è®¨è®ºäº†æ•°æ®åº“ç´¢å¼•çš„æ¦‚å¿µï¼ŒåŒ…æ‹¬äº†è¦†ç›–ç´¢å¼•ã€å‰ç¼€ç´¢å¼•ã€ç´¢å¼•ä¸‹æ¨ã€‚ä½ å¯ä»¥çœ‹åˆ°ï¼Œåœ¨æ»¡è¶³è¯­å¥éœ€æ±‚çš„æƒ…å†µä¸‹ï¼Œ å°½é‡å°‘åœ°è®¿é—®èµ„æºæ˜¯æ•°æ®åº“è®¾è®¡çš„é‡è¦åŸåˆ™ä¹‹ä¸€ã€‚æˆ‘ä»¬åœ¨ä½¿ç”¨æ•°æ®åº“çš„æ—¶å€™ï¼Œå°¤å…¶æ˜¯åœ¨è®¾è®¡è¡¨ç»“æ„æ—¶ï¼Œä¹Ÿè¦ä»¥å‡å°‘èµ„æºæ¶ˆè€—ä½œä¸ºç›®æ ‡ã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ç»™ä½ ç•™ä¸‹ä¸€ä¸ªé—®é¢˜å§ã€‚</p><p>å®é™…ä¸Šä¸»é”®ç´¢å¼•ä¹Ÿæ˜¯å¯ä»¥ä½¿ç”¨å¤šä¸ªå­—æ®µçš„ã€‚DBA å°å•åœ¨å…¥èŒæ–°å…¬å¸çš„æ—¶å€™ï¼Œå°±å‘ç°è‡ªå·±æ¥æ‰‹ç»´æŠ¤çš„åº“é‡Œé¢ï¼Œæœ‰è¿™ä¹ˆä¸€ä¸ªè¡¨ï¼Œè¡¨ç»“æ„å®šä¹‰ç±»ä¼¼è¿™æ ·çš„ï¼š</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code>CREATE TABLE <span class="token string">`geek`</span> <span class="token punctuation">(</span>
  <span class="token string">`a`</span> <span class="token function">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> NOT NULL<span class="token punctuation">,</span>
  <span class="token string">`b`</span> <span class="token function">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> NOT NULL<span class="token punctuation">,</span>
  <span class="token string">`c`</span> <span class="token function">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> NOT NULL<span class="token punctuation">,</span>
  <span class="token string">`d`</span> <span class="token function">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> NOT NULL<span class="token punctuation">,</span>
  PRIMARY KEY <span class="token punctuation">(</span><span class="token string">`a`</span><span class="token punctuation">,</span><span class="token string">`b`</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  KEY <span class="token string">`c`</span> <span class="token punctuation">(</span><span class="token string">`c`</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  KEY <span class="token string">`ca`</span> <span class="token punctuation">(</span><span class="token string">`c`</span><span class="token punctuation">,</span><span class="token string">`a`</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  KEY <span class="token string">`cb`</span> <span class="token punctuation">(</span><span class="token string">`c`</span><span class="token punctuation">,</span><span class="token string">`b`</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> ENGINE<span class="token operator">=</span>InnoDB<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å…¬å¸çš„åŒäº‹å‘Šè¯‰ä»–è¯´ï¼Œç”±äºå†å²åŸå› ï¼Œè¿™ä¸ªè¡¨éœ€è¦ aã€b åšè”åˆä¸»é”®ï¼Œè¿™ä¸ªå°å•ç†è§£äº†ã€‚</p><p>ä½†æ˜¯ï¼Œå­¦è¿‡æœ¬ç« å†…å®¹çš„å°å•åˆçº³é—·äº†ï¼Œæ—¢ç„¶ä¸»é”®åŒ…å«äº† aã€b è¿™ä¸¤ä¸ªå­—æ®µï¼Œé‚£æ„å‘³ç€å•ç‹¬åœ¨å­—æ®µ c ä¸Šåˆ›å»ºä¸€ä¸ªç´¢å¼•ï¼Œå°±å·²ç»åŒ…å«äº†ä¸‰ä¸ªå­—æ®µäº†å‘€ï¼Œä¸ºä»€ä¹ˆè¦åˆ›å»ºâ€œcaâ€â€œcbâ€è¿™ä¸¤ä¸ªç´¢å¼•ï¼Ÿ</p><p>åŒäº‹å‘Šè¯‰ä»–ï¼Œæ˜¯å› ä¸ºä»–ä»¬çš„ä¸šåŠ¡é‡Œé¢æœ‰è¿™æ ·çš„ä¸¤ç§è¯­å¥ï¼š</p><div class="language-vbnet line-numbers-mode" data-ext="vbnet"><pre class="language-vbnet"><code><span class="token keyword">select</span> <span class="token operator">*</span> from geek where c<span class="token operator">=</span>N order by a limit <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token operator">*</span> from geek where c<span class="token operator">=</span>N order by b limit <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ‘ç»™ä½ çš„é—®é¢˜æ˜¯ï¼Œè¿™ä½åŒäº‹çš„è§£é‡Šå¯¹å—ï¼Œä¸ºäº†è¿™ä¸¤ä¸ªæŸ¥è¯¢æ¨¡å¼ï¼Œè¿™ä¸¤ä¸ªç´¢å¼•æ˜¯å¦éƒ½æ˜¯å¿…é¡»çš„ï¼Ÿä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p><p>ä½ å¯ä»¥æŠŠä½ çš„æ€è€ƒå’Œè§‚ç‚¹å†™åœ¨ç•™è¨€åŒºé‡Œï¼Œæˆ‘ä¼šåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« çš„æœ«å°¾å’Œä½ è®¨è®ºè¿™ä¸ªé—®é¢˜ã€‚æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚</p><h4 id="ä¸ŠæœŸé—®é¢˜æ—¶é—´-1" tabindex="-1"><a class="header-anchor" href="#ä¸ŠæœŸé—®é¢˜æ—¶é—´-1" aria-hidden="true">#</a> ä¸ŠæœŸé—®é¢˜æ—¶é—´</h4><p>ä¸ŠæœŸçš„é—®é¢˜æ˜¯ï¼Œé€šè¿‡ä¸¤ä¸ª alter è¯­å¥é‡å»ºç´¢å¼• kï¼Œä»¥åŠé€šè¿‡ä¸¤ä¸ª alter è¯­å¥é‡å»ºä¸»é”®ç´¢å¼•æ˜¯å¦åˆç†ã€‚</p><p>åœ¨è¯„è®ºåŒºï¼Œæœ‰åŒå­¦é—®åˆ°ä¸ºä»€ä¹ˆè¦é‡å»ºç´¢å¼•ã€‚æˆ‘ä»¬æ–‡ç« é‡Œé¢æœ‰æåˆ°ï¼Œç´¢å¼•å¯èƒ½å› ä¸ºåˆ é™¤ï¼Œæˆ–è€…é¡µåˆ†è£‚ç­‰åŸå› ï¼Œå¯¼è‡´æ•°æ®é¡µæœ‰ç©ºæ´ï¼Œé‡å»ºç´¢å¼•çš„è¿‡ç¨‹ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ç´¢å¼•ï¼ŒæŠŠæ•°æ®æŒ‰é¡ºåºæ’å…¥ï¼Œè¿™æ ·é¡µé¢çš„åˆ©ç”¨ç‡æœ€é«˜ï¼Œä¹Ÿå°±æ˜¯ç´¢å¼•æ›´ç´§å‡‘ã€æ›´çœç©ºé—´ã€‚</p><p>è¿™é“é¢˜ç›®ï¼Œæˆ‘ç»™ä½ çš„â€œå‚è€ƒç­”æ¡ˆâ€æ˜¯ï¼š</p><p>é‡å»ºç´¢å¼• k çš„åšæ³•æ˜¯åˆç†çš„ï¼Œå¯ä»¥è¾¾åˆ°çœç©ºé—´çš„ç›®çš„ã€‚ä½†æ˜¯ï¼Œé‡å»ºä¸»é”®çš„è¿‡ç¨‹ä¸åˆç†ã€‚ä¸è®ºæ˜¯åˆ é™¤ä¸»é”®è¿˜æ˜¯åˆ›å»ºä¸»é”®ï¼Œéƒ½ä¼šå°†æ•´ä¸ªè¡¨é‡å»ºã€‚æ‰€ä»¥è¿ç€æ‰§è¡Œè¿™ä¸¤ä¸ªè¯­å¥çš„è¯ï¼Œç¬¬ä¸€ä¸ªè¯­å¥å°±ç™½åšäº†ã€‚è¿™ä¸¤ä¸ªè¯­å¥ï¼Œä½ å¯ä»¥ç”¨è¿™ä¸ªè¯­å¥ä»£æ›¿ ï¼š alter table T engine=InnoDBã€‚åœ¨ä¸“æ çš„ç¬¬ 12 ç¯‡æ–‡ç« ã€Šä¸ºä»€ä¹ˆè¡¨æ•°æ®åˆ æ‰ä¸€åŠï¼Œè¡¨æ–‡ä»¶å¤§å°ä¸å˜ï¼Ÿã€‹ä¸­ï¼Œæˆ‘ä¼šå’Œä½ åˆ†æè¿™æ¡è¯­å¥çš„æ‰§è¡Œæµç¨‹ã€‚</p><p>è¯„è®ºåŒºç•™è¨€ä¸­ï¼Œ @å£¹ç¬™â˜æ¼‚æ³Š åšäº†å¾ˆè¯¦ç»†çš„ç¬”è®°ï¼Œ@é«˜æ• å¸®åŒå­¦è§£ç­”äº†é—®é¢˜ï¼Œ@çº¦ä¹¦äºš æäº†ä¸€ä¸ªå¾ˆä¸é”™çš„é¢è¯•é—®é¢˜ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘è¦å’Œä½ ä»¬é“ä¸€å£°æ„Ÿè°¢ã€‚</p><p>PSï¼šå¦‚æœä½ åœ¨é¢è¯•ä¸­ï¼Œæ›¾æœ‰è¿‡è¢« MySQL ç›¸å…³é—®é¢˜éš¾ä½çš„ç»å†ï¼Œä¹Ÿå¯ä»¥æŠŠè¿™ä¸ªé—®é¢˜å‘åˆ°è¯„è®ºåŒºï¼Œæˆ‘ä»¬ä¸€èµ·æ¥è®¨è®ºã€‚å¦‚æœè§£ç­”è¿™ä¸ªé—®é¢˜ï¼Œéœ€è¦çš„ç¯‡å¹…ä¼šå¾ˆé•¿çš„è¯ï¼Œæˆ‘å¯ä»¥æ”¾åˆ°ç­”ç–‘æ–‡ç« å±•å¼€ã€‚</p><h3 id="_06-å…¨å±€é”å’Œè¡¨é”-ç»™è¡¨åŠ ä¸ªå­—æ®µæ€ä¹ˆæœ‰è¿™ä¹ˆå¤šé˜»ç¢" tabindex="-1"><a class="header-anchor" href="#_06-å…¨å±€é”å’Œè¡¨é”-ç»™è¡¨åŠ ä¸ªå­—æ®µæ€ä¹ˆæœ‰è¿™ä¹ˆå¤šé˜»ç¢" aria-hidden="true">#</a> 06 å…¨å±€é”å’Œè¡¨é” ï¼šç»™è¡¨åŠ ä¸ªå­—æ®µæ€ä¹ˆæœ‰è¿™ä¹ˆå¤šé˜»ç¢ï¼Ÿ</h3><p>ä»Šå¤©æˆ‘è¦è·Ÿä½ èŠèŠ MySQL çš„é”ã€‚æ•°æ®åº“é”è®¾è®¡çš„åˆè¡·æ˜¯å¤„ç†å¹¶å‘é—®é¢˜ã€‚ä½œä¸ºå¤šç”¨æˆ·å…±äº«çš„èµ„æºï¼Œå½“å‡ºç°å¹¶å‘è®¿é—®çš„æ—¶å€™ï¼Œæ•°æ®åº“éœ€è¦åˆç†åœ°æ§åˆ¶èµ„æºçš„è®¿é—®è§„åˆ™ã€‚è€Œé”å°±æ˜¯ç”¨æ¥å®ç°è¿™äº›è®¿é—®è§„åˆ™çš„é‡è¦æ•°æ®ç»“æ„ã€‚</p><p><strong>æ ¹æ®åŠ é”çš„èŒƒå›´ï¼ŒMySQL é‡Œé¢çš„é”å¤§è‡´å¯ä»¥åˆ†æˆå…¨å±€é”ã€è¡¨çº§é”å’Œè¡Œé”ä¸‰ç±»</strong>ã€‚ä»Šå¤©è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ä¼šå’Œä½ åˆ†äº«å…¨å±€é”å’Œè¡¨çº§é”ã€‚è€Œå…³äºè¡Œé”çš„å†…å®¹ï¼Œæˆ‘ä¼šç•™ç€åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­å†å’Œä½ è¯¦ç»†ä»‹ç»ã€‚</p><p>è¿™é‡Œéœ€è¦è¯´æ˜çš„æ˜¯ï¼Œé”çš„è®¾è®¡æ¯”è¾ƒå¤æ‚ï¼Œè¿™ä¸¤ç¯‡æ–‡ç« ä¸ä¼šæ¶‰åŠé”çš„å…·ä½“å®ç°ç»†èŠ‚ï¼Œä¸»è¦ä»‹ç»çš„æ˜¯ç¢°åˆ°é”æ—¶çš„ç°è±¡å’Œå…¶èƒŒåçš„åŸç†ã€‚</p><h4 id="å…¨å±€é”" tabindex="-1"><a class="header-anchor" href="#å…¨å±€é”" aria-hidden="true">#</a> å…¨å±€é”</h4><p>é¡¾åæ€ä¹‰ï¼Œå…¨å±€é”å°±æ˜¯å¯¹æ•´ä¸ªæ•°æ®åº“å®ä¾‹åŠ é”ã€‚MySQL æä¾›äº†ä¸€ä¸ªåŠ å…¨å±€è¯»é”çš„æ–¹æ³•ï¼Œå‘½ä»¤æ˜¯ Flush tables with read lock (FTWRL)ã€‚å½“ä½ éœ€è¦è®©æ•´ä¸ªåº“å¤„äºåªè¯»çŠ¶æ€çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªå‘½ä»¤ï¼Œä¹‹åå…¶ä»–çº¿ç¨‹çš„ä»¥ä¸‹è¯­å¥ä¼šè¢«é˜»å¡ï¼šæ•°æ®æ›´æ–°è¯­å¥ï¼ˆæ•°æ®çš„å¢åˆ æ”¹ï¼‰ã€æ•°æ®å®šä¹‰è¯­å¥ï¼ˆåŒ…æ‹¬å»ºè¡¨ã€ä¿®æ”¹è¡¨ç»“æ„ç­‰ï¼‰å’Œæ›´æ–°ç±»äº‹åŠ¡çš„æäº¤è¯­å¥ã€‚</p><p>**å…¨å±€é”çš„å…¸å‹ä½¿ç”¨åœºæ™¯æ˜¯ï¼Œåšå…¨åº“é€»è¾‘å¤‡ä»½ã€‚**ä¹Ÿå°±æ˜¯æŠŠæ•´åº“æ¯ä¸ªè¡¨éƒ½ select å‡ºæ¥å­˜æˆæ–‡æœ¬ã€‚</p><p>ä»¥å‰æœ‰ä¸€ç§åšæ³•ï¼Œæ˜¯é€šè¿‡ FTWRL ç¡®ä¿ä¸ä¼šæœ‰å…¶ä»–çº¿ç¨‹å¯¹æ•°æ®åº“åšæ›´æ–°ï¼Œç„¶åå¯¹æ•´ä¸ªåº“åšå¤‡ä»½ã€‚æ³¨æ„ï¼Œåœ¨å¤‡ä»½è¿‡ç¨‹ä¸­æ•´ä¸ªåº“å®Œå…¨å¤„äºåªè¯»çŠ¶æ€ã€‚</p><p>ä½†æ˜¯è®©æ•´åº“éƒ½åªè¯»ï¼Œå¬ä¸Šå»å°±å¾ˆå±é™©ï¼š</p><ul><li>å¦‚æœä½ åœ¨ä¸»åº“ä¸Šå¤‡ä»½ï¼Œé‚£ä¹ˆåœ¨å¤‡ä»½æœŸé—´éƒ½ä¸èƒ½æ‰§è¡Œæ›´æ–°ï¼Œä¸šåŠ¡åŸºæœ¬ä¸Šå°±å¾—åœæ‘†ï¼›</li><li>å¦‚æœä½ åœ¨ä»åº“ä¸Šå¤‡ä»½ï¼Œé‚£ä¹ˆå¤‡ä»½æœŸé—´ä»åº“ä¸èƒ½æ‰§è¡Œä¸»åº“åŒæ­¥è¿‡æ¥çš„ binlogï¼Œä¼šå¯¼è‡´ä¸»ä»å»¶è¿Ÿã€‚</li></ul><p>çœ‹æ¥åŠ å…¨å±€é”ä¸å¤ªå¥½ã€‚ä½†æ˜¯ç»†æƒ³ä¸€ä¸‹ï¼Œå¤‡ä»½ä¸ºä»€ä¹ˆè¦åŠ é”å‘¢ï¼Ÿæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ä¸åŠ é”ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ã€‚</p><p>å‡è®¾ä½ ç°åœ¨è¦ç»´æŠ¤â€œæå®¢æ—¶é—´â€çš„è´­ä¹°ç³»ç»Ÿï¼Œå…³æ³¨çš„æ˜¯ç”¨æˆ·è´¦æˆ·ä½™é¢è¡¨å’Œç”¨æˆ·è¯¾ç¨‹è¡¨ã€‚</p><p>ç°åœ¨å‘èµ·ä¸€ä¸ªé€»è¾‘å¤‡ä»½ã€‚å‡è®¾å¤‡ä»½æœŸé—´ï¼Œæœ‰ä¸€ä¸ªç”¨æˆ·ï¼Œä»–è´­ä¹°äº†ä¸€é—¨è¯¾ç¨‹ï¼Œä¸šåŠ¡é€»è¾‘é‡Œå°±è¦æ‰£æ‰ä»–çš„ä½™é¢ï¼Œç„¶åå¾€å·²è´­è¯¾ç¨‹é‡Œé¢åŠ ä¸Šä¸€é—¨è¯¾ã€‚</p><p>å¦‚æœæ—¶é—´é¡ºåºä¸Šæ˜¯å…ˆå¤‡ä»½è´¦æˆ·ä½™é¢è¡¨ (u_account)ï¼Œç„¶åç”¨æˆ·è´­ä¹°ï¼Œç„¶åå¤‡ä»½ç”¨æˆ·è¯¾ç¨‹è¡¨ (u_course)ï¼Œä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿä½ å¯ä»¥çœ‹ä¸€ä¸‹è¿™ä¸ªå›¾ï¼š</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/cbfd4a0bbb1210792064bcea4e49b0cd-1584367388578.png" alt="img"></p><p>å›¾ 1 ä¸šåŠ¡å’Œå¤‡ä»½çŠ¶æ€å›¾</p><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªå¤‡ä»½ç»“æœé‡Œï¼Œç”¨æˆ· A çš„æ•°æ®çŠ¶æ€æ˜¯â€œè´¦æˆ·ä½™é¢æ²¡æ‰£ï¼Œä½†æ˜¯ç”¨æˆ·è¯¾ç¨‹è¡¨é‡Œé¢å·²ç»å¤šäº†ä¸€é—¨è¯¾â€ã€‚å¦‚æœåé¢ç”¨è¿™ä¸ªå¤‡ä»½æ¥æ¢å¤æ•°æ®çš„è¯ï¼Œç”¨æˆ· A å°±å‘ç°ï¼Œè‡ªå·±èµšäº†ã€‚</p><p>ä½œä¸ºç”¨æˆ·å¯åˆ«è§‰å¾—è¿™æ ·å¯çœŸå¥½å•Šï¼Œä½ å¯ä»¥è¯•æƒ³ä¸€ä¸‹ï¼šå¦‚æœå¤‡ä»½è¡¨çš„é¡ºåºåè¿‡æ¥ï¼Œå…ˆå¤‡ä»½ç”¨æˆ·è¯¾ç¨‹è¡¨å†å¤‡ä»½è´¦æˆ·ä½™é¢è¡¨ï¼Œåˆå¯èƒ½ä¼šå‡ºç°ä»€ä¹ˆç»“æœï¼Ÿ</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸åŠ é”çš„è¯ï¼Œå¤‡ä»½ç³»ç»Ÿå¤‡ä»½çš„å¾—åˆ°çš„åº“ä¸æ˜¯ä¸€ä¸ªé€»è¾‘æ—¶é—´ç‚¹ï¼Œè¿™ä¸ªè§†å›¾æ˜¯é€»è¾‘ä¸ä¸€è‡´çš„ã€‚</p><p>è¯´åˆ°è§†å›¾ä½ è‚¯å®šæƒ³èµ·æ¥äº†ï¼Œæˆ‘ä»¬åœ¨å‰é¢è®²äº‹åŠ¡éš”ç¦»çš„æ—¶å€™ï¼Œå…¶å®æ˜¯æœ‰ä¸€ä¸ªæ–¹æ³•èƒ½å¤Ÿæ‹¿åˆ°ä¸€è‡´æ€§è§†å›¾çš„ï¼Œå¯¹å§ï¼Ÿ</p><p>æ˜¯çš„ï¼Œå°±æ˜¯åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹å¼€å¯ä¸€ä¸ªäº‹åŠ¡ã€‚</p><blockquote><p>å¤‡æ³¨ï¼šå¦‚æœä½ å¯¹äº‹åŠ¡éš”ç¦»çº§åˆ«çš„æ¦‚å¿µä¸æ˜¯å¾ˆæ¸…æ™°çš„è¯ï¼Œå¯ä»¥å†å›é¡¾ä¸€ä¸‹ç¬¬ 3 ç¯‡æ–‡ç« [ã€Šäº‹åŠ¡éš”ç¦»ï¼šä¸ºä»€ä¹ˆä½ æ”¹äº†æˆ‘è¿˜çœ‹ä¸è§ï¼Ÿã€‹]ä¸­çš„ç›¸å…³å†…å®¹ã€‚</p></blockquote><p>å®˜æ–¹è‡ªå¸¦çš„é€»è¾‘å¤‡ä»½å·¥å…·æ˜¯ mysqldumpã€‚å½“ mysqldump ä½¿ç”¨å‚æ•°â€“single-transaction çš„æ—¶å€™ï¼Œå¯¼æ•°æ®ä¹‹å‰å°±ä¼šå¯åŠ¨ä¸€ä¸ªäº‹åŠ¡ï¼Œæ¥ç¡®ä¿æ‹¿åˆ°ä¸€è‡´æ€§è§†å›¾ã€‚è€Œç”±äº MVCC çš„æ”¯æŒï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­æ•°æ®æ˜¯å¯ä»¥æ­£å¸¸æ›´æ–°çš„ã€‚</p><p>ä½ ä¸€å®šåœ¨ç–‘æƒ‘ï¼Œæœ‰äº†è¿™ä¸ªåŠŸèƒ½ï¼Œä¸ºä»€ä¹ˆè¿˜éœ€è¦ FTWRL å‘¢ï¼Ÿ**ä¸€è‡´æ€§è¯»æ˜¯å¥½ï¼Œä½†å‰ææ˜¯å¼•æ“è¦æ”¯æŒè¿™ä¸ªéš”ç¦»çº§åˆ«ã€‚**æ¯”å¦‚ï¼Œå¯¹äº MyISAM è¿™ç§ä¸æ”¯æŒäº‹åŠ¡çš„å¼•æ“ï¼Œå¦‚æœå¤‡ä»½è¿‡ç¨‹ä¸­æœ‰æ›´æ–°ï¼Œæ€»æ˜¯åªèƒ½å–åˆ°æœ€æ–°çš„æ•°æ®ï¼Œé‚£ä¹ˆå°±ç ´åäº†å¤‡ä»½çš„ä¸€è‡´æ€§ã€‚è¿™æ—¶ï¼Œæˆ‘ä»¬å°±éœ€è¦ä½¿ç”¨ FTWRL å‘½ä»¤äº†ã€‚</p><p>æ‰€ä»¥ï¼Œ**single-transaction æ–¹æ³•åªé€‚ç”¨äºæ‰€æœ‰çš„è¡¨ä½¿ç”¨äº‹åŠ¡å¼•æ“çš„åº“ã€‚**å¦‚æœæœ‰çš„è¡¨ä½¿ç”¨äº†ä¸æ”¯æŒäº‹åŠ¡çš„å¼•æ“ï¼Œé‚£ä¹ˆå¤‡ä»½å°±åªèƒ½é€šè¿‡ FTWRL æ–¹æ³•ã€‚è¿™å¾€å¾€æ˜¯ DBA è¦æ±‚ä¸šåŠ¡å¼€å‘äººå‘˜ä½¿ç”¨ InnoDB æ›¿ä»£ MyISAM çš„åŸå› ä¹‹ä¸€ã€‚</p><p>ä½ ä¹Ÿè®¸ä¼šé—®ï¼Œ<strong>æ—¢ç„¶è¦å…¨åº“åªè¯»ï¼Œä¸ºä»€ä¹ˆä¸ä½¿ç”¨ set global readonly=true çš„æ–¹å¼å‘¢</strong>ï¼Ÿç¡®å® readonly æ–¹å¼ä¹Ÿå¯ä»¥è®©å…¨åº“è¿›å…¥åªè¯»çŠ¶æ€ï¼Œä½†æˆ‘è¿˜æ˜¯ä¼šå»ºè®®ä½ ç”¨ FTWRL æ–¹å¼ï¼Œä¸»è¦æœ‰ä¸¤ä¸ªåŸå› ï¼š</p><ul><li>ä¸€æ˜¯ï¼Œåœ¨æœ‰äº›ç³»ç»Ÿä¸­ï¼Œreadonly çš„å€¼ä¼šè¢«ç”¨æ¥åšå…¶ä»–é€»è¾‘ï¼Œæ¯”å¦‚ç”¨æ¥åˆ¤æ–­ä¸€ä¸ªåº“æ˜¯ä¸»åº“è¿˜æ˜¯å¤‡åº“ã€‚å› æ­¤ï¼Œä¿®æ”¹ global å˜é‡çš„æ–¹å¼å½±å“é¢æ›´å¤§ï¼Œæˆ‘ä¸å»ºè®®ä½ ä½¿ç”¨ã€‚</li><li>äºŒæ˜¯ï¼Œåœ¨å¼‚å¸¸å¤„ç†æœºåˆ¶ä¸Šæœ‰å·®å¼‚ã€‚å¦‚æœæ‰§è¡Œ FTWRL å‘½ä»¤ä¹‹åç”±äºå®¢æˆ·ç«¯å‘ç”Ÿå¼‚å¸¸æ–­å¼€ï¼Œé‚£ä¹ˆ MySQL ä¼šè‡ªåŠ¨é‡Šæ”¾è¿™ä¸ªå…¨å±€é”ï¼Œæ•´ä¸ªåº“å›åˆ°å¯ä»¥æ­£å¸¸æ›´æ–°çš„çŠ¶æ€ã€‚è€Œå°†æ•´ä¸ªåº“è®¾ç½®ä¸º readonly ä¹‹åï¼Œå¦‚æœå®¢æˆ·ç«¯å‘ç”Ÿå¼‚å¸¸ï¼Œåˆ™æ•°æ®åº“å°±ä¼šä¸€ç›´ä¿æŒ readonly çŠ¶æ€ï¼Œè¿™æ ·ä¼šå¯¼è‡´æ•´ä¸ªåº“é•¿æ—¶é—´å¤„äºä¸å¯å†™çŠ¶æ€ï¼Œé£é™©è¾ƒé«˜ã€‚</li></ul><p>ä¸šåŠ¡çš„æ›´æ–°ä¸åªæ˜¯å¢åˆ æ”¹æ•°æ®ï¼ˆDML)ï¼Œè¿˜æœ‰å¯èƒ½æ˜¯åŠ å­—æ®µç­‰ä¿®æ”¹è¡¨ç»“æ„çš„æ“ä½œï¼ˆDDLï¼‰ã€‚ä¸è®ºæ˜¯å“ªç§æ–¹æ³•ï¼Œä¸€ä¸ªåº“è¢«å…¨å±€é”ä¸Šä»¥åï¼Œä½ è¦å¯¹é‡Œé¢ä»»ä½•ä¸€ä¸ªè¡¨åšåŠ å­—æ®µæ“ä½œï¼Œéƒ½æ˜¯ä¼šè¢«é”ä½çš„ã€‚</p><p>ä½†æ˜¯ï¼Œå³ä½¿æ²¡æœ‰è¢«å…¨å±€é”ä½ï¼ŒåŠ å­—æ®µä¹Ÿä¸æ˜¯å°±èƒ½ä¸€å¸†é£é¡ºçš„ï¼Œå› ä¸ºä½ è¿˜ä¼šç¢°åˆ°æ¥ä¸‹æ¥æˆ‘ä»¬è¦ä»‹ç»çš„è¡¨çº§é”ã€‚</p><h4 id="è¡¨çº§é”" tabindex="-1"><a class="header-anchor" href="#è¡¨çº§é”" aria-hidden="true">#</a> è¡¨çº§é”</h4><p>MySQL é‡Œé¢è¡¨çº§åˆ«çš„é”æœ‰ä¸¤ç§ï¼šä¸€ç§æ˜¯è¡¨é”ï¼Œä¸€ç§æ˜¯å…ƒæ•°æ®é”ï¼ˆmeta data lockï¼ŒMDL)ã€‚</p><p>**è¡¨é”çš„è¯­æ³•æ˜¯ lock tables â€¦ read/writeã€‚**ä¸ FTWRL ç±»ä¼¼ï¼Œå¯ä»¥ç”¨ unlock tables ä¸»åŠ¨é‡Šæ”¾é”ï¼Œä¹Ÿå¯ä»¥åœ¨å®¢æˆ·ç«¯æ–­å¼€çš„æ—¶å€™è‡ªåŠ¨é‡Šæ”¾ã€‚éœ€è¦æ³¨æ„ï¼Œlock tables è¯­æ³•é™¤äº†ä¼šé™åˆ¶åˆ«çš„çº¿ç¨‹çš„è¯»å†™å¤–ï¼Œä¹Ÿé™å®šäº†æœ¬çº¿ç¨‹æ¥ä¸‹æ¥çš„æ“ä½œå¯¹è±¡ã€‚</p><p>ä¸¾ä¸ªä¾‹å­, å¦‚æœåœ¨æŸä¸ªçº¿ç¨‹ A ä¸­æ‰§è¡Œ lock tables t1 read, t2 write; è¿™ä¸ªè¯­å¥ï¼Œåˆ™å…¶ä»–çº¿ç¨‹å†™ t1ã€è¯»å†™ t2 çš„è¯­å¥éƒ½ä¼šè¢«é˜»å¡ã€‚åŒæ—¶ï¼Œçº¿ç¨‹ A åœ¨æ‰§è¡Œ unlock tables ä¹‹å‰ï¼Œä¹Ÿåªèƒ½æ‰§è¡Œè¯» t1ã€è¯»å†™ t2 çš„æ“ä½œã€‚è¿å†™ t1 éƒ½ä¸å…è®¸ï¼Œè‡ªç„¶ä¹Ÿä¸èƒ½è®¿é—®å…¶ä»–è¡¨ã€‚</p><p>åœ¨è¿˜æ²¡æœ‰å‡ºç°æ›´ç»†ç²’åº¦çš„é”çš„æ—¶å€™ï¼Œè¡¨é”æ˜¯æœ€å¸¸ç”¨çš„å¤„ç†å¹¶å‘çš„æ–¹å¼ã€‚è€Œå¯¹äº InnoDB è¿™ç§æ”¯æŒè¡Œé”çš„å¼•æ“ï¼Œä¸€èˆ¬ä¸ä½¿ç”¨ lock tables å‘½ä»¤æ¥æ§åˆ¶å¹¶å‘ï¼Œæ¯•ç«Ÿé”ä½æ•´ä¸ªè¡¨çš„å½±å“é¢è¿˜æ˜¯å¤ªå¤§ã€‚</p><p>**å¦ä¸€ç±»è¡¨çº§çš„é”æ˜¯ MDLï¼ˆmetadata lock)ã€‚**MDL ä¸éœ€è¦æ˜¾å¼ä½¿ç”¨ï¼Œåœ¨è®¿é—®ä¸€ä¸ªè¡¨çš„æ—¶å€™ä¼šè¢«è‡ªåŠ¨åŠ ä¸Šã€‚MDL çš„ä½œç”¨æ˜¯ï¼Œä¿è¯è¯»å†™çš„æ­£ç¡®æ€§ã€‚ä½ å¯ä»¥æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœä¸€ä¸ªæŸ¥è¯¢æ­£åœ¨éå†ä¸€ä¸ªè¡¨ä¸­çš„æ•°æ®ï¼Œè€Œæ‰§è¡ŒæœŸé—´å¦ä¸€ä¸ªçº¿ç¨‹å¯¹è¿™ä¸ªè¡¨ç»“æ„åšå˜æ›´ï¼Œåˆ äº†ä¸€åˆ—ï¼Œé‚£ä¹ˆæŸ¥è¯¢çº¿ç¨‹æ‹¿åˆ°çš„ç»“æœè·Ÿè¡¨ç»“æ„å¯¹ä¸ä¸Šï¼Œè‚¯å®šæ˜¯ä¸è¡Œçš„ã€‚</p><p>å› æ­¤ï¼Œåœ¨ MySQL 5.5 ç‰ˆæœ¬ä¸­å¼•å…¥äº† MDLï¼Œå½“å¯¹ä¸€ä¸ªè¡¨åšå¢åˆ æ”¹æŸ¥æ“ä½œçš„æ—¶å€™ï¼ŒåŠ  MDL è¯»é”ï¼›å½“è¦å¯¹è¡¨åšç»“æ„å˜æ›´æ“ä½œçš„æ—¶å€™ï¼ŒåŠ  MDL å†™é”ã€‚</p><ul><li>è¯»é”ä¹‹é—´ä¸äº’æ–¥ï¼Œå› æ­¤ä½ å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶å¯¹ä¸€å¼ è¡¨å¢åˆ æ”¹æŸ¥ã€‚</li><li>è¯»å†™é”ä¹‹é—´ã€å†™é”ä¹‹é—´æ˜¯äº’æ–¥çš„ï¼Œç”¨æ¥ä¿è¯å˜æ›´è¡¨ç»“æ„æ“ä½œçš„å®‰å…¨æ€§ã€‚å› æ­¤ï¼Œå¦‚æœæœ‰ä¸¤ä¸ªçº¿ç¨‹è¦åŒæ—¶ç»™ä¸€ä¸ªè¡¨åŠ å­—æ®µï¼Œå…¶ä¸­ä¸€ä¸ªè¦ç­‰å¦ä¸€ä¸ªæ‰§è¡Œå®Œæ‰èƒ½å¼€å§‹æ‰§è¡Œã€‚</li></ul><p>è™½ç„¶ MDL é”æ˜¯ç³»ç»Ÿé»˜è®¤ä¼šåŠ çš„ï¼Œä½†å´æ˜¯ä½ ä¸èƒ½å¿½ç•¥çš„ä¸€ä¸ªæœºåˆ¶ã€‚æ¯”å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼Œæˆ‘ç»å¸¸çœ‹åˆ°æœ‰äººæ‰åˆ°è¿™ä¸ªå‘é‡Œï¼šç»™ä¸€ä¸ªå°è¡¨åŠ ä¸ªå­—æ®µï¼Œå¯¼è‡´æ•´ä¸ªåº“æŒ‚äº†ã€‚</p><p>ä½ è‚¯å®šçŸ¥é“ï¼Œç»™ä¸€ä¸ªè¡¨åŠ å­—æ®µï¼Œæˆ–è€…ä¿®æ”¹å­—æ®µï¼Œæˆ–è€…åŠ ç´¢å¼•ï¼Œéœ€è¦æ‰«æå…¨è¡¨çš„æ•°æ®ã€‚åœ¨å¯¹å¤§è¡¨æ“ä½œçš„æ—¶å€™ï¼Œä½ è‚¯å®šä¼šç‰¹åˆ«å°å¿ƒï¼Œä»¥å…å¯¹çº¿ä¸ŠæœåŠ¡é€ æˆå½±å“ã€‚è€Œå®é™…ä¸Šï¼Œå³ä½¿æ˜¯å°è¡¨ï¼Œæ“ä½œä¸æ…ä¹Ÿä¼šå‡ºé—®é¢˜ã€‚æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ä¸‹é¢çš„æ“ä½œåºåˆ—ï¼Œå‡è®¾è¡¨ t æ˜¯ä¸€ä¸ªå°è¡¨ã€‚</p><blockquote><p>å¤‡æ³¨ï¼šè¿™é‡Œçš„å®éªŒç¯å¢ƒæ˜¯ MySQL 5.6ã€‚</p></blockquote><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/7cf6a3bf90d72d1f0fc156ececdfb0ce-1584367388165.jpg" alt="img"></p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ° session A å…ˆå¯åŠ¨ï¼Œè¿™æ—¶å€™ä¼šå¯¹è¡¨ t åŠ ä¸€ä¸ª MDL è¯»é”ã€‚ç”±äº session B éœ€è¦çš„ä¹Ÿæ˜¯ MDL è¯»é”ï¼Œå› æ­¤å¯ä»¥æ­£å¸¸æ‰§è¡Œã€‚</p><p>ä¹‹å session C ä¼šè¢« blockedï¼Œæ˜¯å› ä¸º session A çš„ MDL è¯»é”è¿˜æ²¡æœ‰é‡Šæ”¾ï¼Œè€Œ session C éœ€è¦ MDL å†™é”ï¼Œå› æ­¤åªèƒ½è¢«é˜»å¡ã€‚</p><p>å¦‚æœåªæœ‰ session C è‡ªå·±è¢«é˜»å¡è¿˜æ²¡ä»€ä¹ˆå…³ç³»ï¼Œä½†æ˜¯ä¹‹åæ‰€æœ‰è¦åœ¨è¡¨ t ä¸Šæ–°ç”³è¯· MDL è¯»é”çš„è¯·æ±‚ä¹Ÿä¼šè¢« session C é˜»å¡ã€‚å‰é¢æˆ‘ä»¬è¯´äº†ï¼Œæ‰€æœ‰å¯¹è¡¨çš„å¢åˆ æ”¹æŸ¥æ“ä½œéƒ½éœ€è¦å…ˆç”³è¯· MDL è¯»é”ï¼Œå°±éƒ½è¢«é”ä½ï¼Œç­‰äºè¿™ä¸ªè¡¨ç°åœ¨å®Œå…¨ä¸å¯è¯»å†™äº†ã€‚</p><p>å¦‚æœæŸä¸ªè¡¨ä¸Šçš„æŸ¥è¯¢è¯­å¥é¢‘ç¹ï¼Œè€Œä¸”å®¢æˆ·ç«¯æœ‰é‡è¯•æœºåˆ¶ï¼Œä¹Ÿå°±æ˜¯è¯´è¶…æ—¶åä¼šå†èµ·ä¸€ä¸ªæ–° session å†è¯·æ±‚çš„è¯ï¼Œè¿™ä¸ªåº“çš„çº¿ç¨‹å¾ˆå¿«å°±ä¼šçˆ†æ»¡ã€‚</p><p>ä½ ç°åœ¨åº”è¯¥çŸ¥é“äº†ï¼Œäº‹åŠ¡ä¸­çš„ MDL é”ï¼Œåœ¨è¯­å¥æ‰§è¡Œå¼€å§‹æ—¶ç”³è¯·ï¼Œä½†æ˜¯è¯­å¥ç»“æŸåå¹¶ä¸ä¼šé©¬ä¸Šé‡Šæ”¾ï¼Œè€Œä¼šç­‰åˆ°æ•´ä¸ªäº‹åŠ¡æäº¤åå†é‡Šæ”¾ã€‚</p><p>åŸºäºä¸Šé¢çš„åˆ†æï¼Œæˆ‘ä»¬æ¥è®¨è®ºä¸€ä¸ªé—®é¢˜ï¼Œ<strong>å¦‚ä½•å®‰å…¨åœ°ç»™å°è¡¨åŠ å­—æ®µï¼Ÿ</strong></p><p>é¦–å…ˆæˆ‘ä»¬è¦è§£å†³é•¿äº‹åŠ¡ï¼Œäº‹åŠ¡ä¸æäº¤ï¼Œå°±ä¼šä¸€ç›´å ç€ MDL é”ã€‚åœ¨ MySQL çš„ information_schema åº“çš„ innodb_trx è¡¨ä¸­ï¼Œä½ å¯ä»¥æŸ¥åˆ°å½“å‰æ‰§è¡Œä¸­çš„äº‹åŠ¡ã€‚å¦‚æœä½ è¦åš DDL å˜æ›´çš„è¡¨åˆšå¥½æœ‰é•¿äº‹åŠ¡åœ¨æ‰§è¡Œï¼Œè¦è€ƒè™‘å…ˆæš‚åœ DDLï¼Œæˆ–è€… kill æ‰è¿™ä¸ªé•¿äº‹åŠ¡ã€‚</p><p>ä½†è€ƒè™‘ä¸€ä¸‹è¿™ä¸ªåœºæ™¯ã€‚å¦‚æœä½ è¦å˜æ›´çš„è¡¨æ˜¯ä¸€ä¸ªçƒ­ç‚¹è¡¨ï¼Œè™½ç„¶æ•°æ®é‡ä¸å¤§ï¼Œä½†æ˜¯ä¸Šé¢çš„è¯·æ±‚å¾ˆé¢‘ç¹ï¼Œè€Œä½ ä¸å¾—ä¸åŠ ä¸ªå­—æ®µï¼Œä½ è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ</p><p>è¿™æ—¶å€™ kill å¯èƒ½æœªå¿…ç®¡ç”¨ï¼Œå› ä¸ºæ–°çš„è¯·æ±‚é©¬ä¸Šå°±æ¥äº†ã€‚æ¯”è¾ƒç†æƒ³çš„æœºåˆ¶æ˜¯ï¼Œåœ¨ alter table è¯­å¥é‡Œé¢è®¾å®šç­‰å¾…æ—¶é—´ï¼Œå¦‚æœåœ¨è¿™ä¸ªæŒ‡å®šçš„ç­‰å¾…æ—¶é—´é‡Œé¢èƒ½å¤Ÿæ‹¿åˆ° MDL å†™é”æœ€å¥½ï¼Œæ‹¿ä¸åˆ°ä¹Ÿä¸è¦é˜»å¡åé¢çš„ä¸šåŠ¡è¯­å¥ï¼Œå…ˆæ”¾å¼ƒã€‚ä¹‹åå¼€å‘äººå‘˜æˆ–è€… DBA å†é€šè¿‡é‡è¯•å‘½ä»¤é‡å¤è¿™ä¸ªè¿‡ç¨‹ã€‚</p><p>MariaDB å·²ç»åˆå¹¶äº† AliSQL çš„è¿™ä¸ªåŠŸèƒ½ï¼Œæ‰€ä»¥è¿™ä¸¤ä¸ªå¼€æºåˆ†æ”¯ç›®å‰éƒ½æ”¯æŒ DDL NOWAIT/WAIT n è¿™ä¸ªè¯­æ³•ã€‚</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> tbl_name NOWAIT <span class="token keyword">add</span> <span class="token keyword">column</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> tbl_name WAIT N <span class="token keyword">add</span> <span class="token keyword">column</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="å°ç»“-5" tabindex="-1"><a class="header-anchor" href="#å°ç»“-5" aria-hidden="true">#</a> å°ç»“</h4><p>ä»Šå¤©ï¼Œæˆ‘è·Ÿä½ ä»‹ç»äº† MySQL çš„å…¨å±€é”å’Œè¡¨çº§é”ã€‚</p><p>å…¨å±€é”ä¸»è¦ç”¨åœ¨é€»è¾‘å¤‡ä»½è¿‡ç¨‹ä¸­ã€‚å¯¹äºå…¨éƒ¨æ˜¯ InnoDB å¼•æ“çš„åº“ï¼Œæˆ‘å»ºè®®ä½ é€‰æ‹©ä½¿ç”¨â€“single-transaction å‚æ•°ï¼Œå¯¹åº”ç”¨ä¼šæ›´å‹å¥½ã€‚</p><p>è¡¨é”ä¸€èˆ¬æ˜¯åœ¨æ•°æ®åº“å¼•æ“ä¸æ”¯æŒè¡Œé”çš„æ—¶å€™æ‰ä¼šè¢«ç”¨åˆ°çš„ã€‚å¦‚æœä½ å‘ç°ä½ çš„åº”ç”¨ç¨‹åºé‡Œæœ‰ lock tables è¿™æ ·çš„è¯­å¥ï¼Œä½ éœ€è¦è¿½æŸ¥ä¸€ä¸‹ï¼Œæ¯”è¾ƒå¯èƒ½çš„æƒ…å†µæ˜¯ï¼š</p><ul><li>è¦ä¹ˆæ˜¯ä½ çš„ç³»ç»Ÿç°åœ¨è¿˜åœ¨ç”¨ MyISAM è¿™ç±»ä¸æ”¯æŒäº‹åŠ¡çš„å¼•æ“ï¼Œé‚£è¦å®‰æ’å‡çº§æ¢å¼•æ“ï¼›</li><li>è¦ä¹ˆæ˜¯ä½ çš„å¼•æ“å‡çº§äº†ï¼Œä½†æ˜¯ä»£ç è¿˜æ²¡å‡çº§ã€‚æˆ‘è§è¿‡è¿™æ ·çš„æƒ…å†µï¼Œæœ€åä¸šåŠ¡å¼€å‘å°±æ˜¯æŠŠ lock tables å’Œ unlock tables æ”¹æˆ begin å’Œ commitï¼Œé—®é¢˜å°±è§£å†³äº†ã€‚</li></ul><p>MDL ä¼šç›´åˆ°äº‹åŠ¡æäº¤æ‰é‡Šæ”¾ï¼Œåœ¨åšè¡¨ç»“æ„å˜æ›´çš„æ—¶å€™ï¼Œä½ ä¸€å®šè¦å°å¿ƒä¸è¦å¯¼è‡´é”ä½çº¿ä¸ŠæŸ¥è¯¢å’Œæ›´æ–°ã€‚</p><p>æœ€åï¼Œæˆ‘ç»™ä½ ç•™ä¸€ä¸ªé—®é¢˜å§ã€‚å¤‡ä»½ä¸€èˆ¬éƒ½ä¼šåœ¨å¤‡åº“ä¸Šæ‰§è¡Œï¼Œä½ åœ¨ç”¨â€“single-transaction æ–¹æ³•åšé€»è¾‘å¤‡ä»½çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœä¸»åº“ä¸Šçš„ä¸€ä¸ªå°è¡¨åšäº†ä¸€ä¸ª DDLï¼Œæ¯”å¦‚ç»™ä¸€ä¸ªè¡¨ä¸ŠåŠ äº†ä¸€åˆ—ã€‚è¿™æ—¶å€™ï¼Œä»å¤‡åº“ä¸Šä¼šçœ‹åˆ°ä»€ä¹ˆç°è±¡å‘¢ï¼Ÿ</p><p>ä½ å¯ä»¥æŠŠä½ çš„æ€è€ƒå’Œè§‚ç‚¹å†™åœ¨ç•™è¨€åŒºé‡Œï¼Œæˆ‘ä¼šåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« çš„æœ«å°¾å’Œä½ è®¨è®ºè¿™ä¸ªé—®é¢˜ã€‚æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚</p><p>è¯´æ˜ï¼šè¿™ç¯‡æ–‡ç« æ²¡æœ‰ä»‹ç»åˆ°ç‰©ç†å¤‡ä»½ï¼Œç‰©ç†å¤‡ä»½ä¼šæœ‰ä¸€ç¯‡å•ç‹¬çš„æ–‡ç« ã€‚</p><h4 id="ä¸ŠæœŸé—®é¢˜æ—¶é—´-2" tabindex="-1"><a class="header-anchor" href="#ä¸ŠæœŸé—®é¢˜æ—¶é—´-2" aria-hidden="true">#</a> ä¸ŠæœŸé—®é¢˜æ—¶é—´</h4><p>ä¸ŠæœŸçš„é—®é¢˜æ˜¯å…³äºå¯¹è”åˆä¸»é”®ç´¢å¼•å’Œ InnoDB ç´¢å¼•ç»„ç»‡è¡¨çš„ç†è§£ã€‚</p><p>æˆ‘ç›´æ¥è´´ @è€æ¨åŒå¿— çš„å›å¤ç•¥ä½œä¿®æ”¹å¦‚ä¸‹ï¼ˆæˆ‘ä¿®æ”¹çš„éƒ¨åˆ†ç”¨æ©™è‰²æ ‡å‡ºï¼‰ï¼š</p><p>è¡¨è®°å½• â€“a--|â€“b--|â€“c--|â€“d-- 1 2 3 d 1 3 2 d 1 4 3 d 2 1 3 d 2 2 2 d 2 3 4 d ä¸»é”® aï¼Œb çš„èšç°‡ç´¢å¼•ç»„ç»‡é¡ºåºç›¸å½“äº order by a,b ï¼Œä¹Ÿå°±æ˜¯å…ˆæŒ‰ a æ’åºï¼Œå†æŒ‰ b æ’åºï¼Œc æ— åºã€‚</p><p>ç´¢å¼• ca çš„ç»„ç»‡æ˜¯å…ˆæŒ‰ c æ’åºï¼Œå†æŒ‰ a æ’åºï¼ŒåŒæ—¶è®°å½•ä¸»é”® â€“c--|â€“a--|â€“ä¸»é”®éƒ¨åˆ†b-- ï¼ˆæ³¨æ„ï¼Œè¿™é‡Œä¸æ˜¯ abï¼Œè€Œæ˜¯åªæœ‰ bï¼‰ 2 1 3 2 2 2 3 1 2 3 1 4 3 2 1 4 2 3 è¿™ä¸ªè·Ÿç´¢å¼• c çš„æ•°æ®æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ã€‚</p><p>ç´¢å¼• cb çš„ç»„ç»‡æ˜¯å…ˆæŒ‰ c æ’åºï¼Œåœ¨æŒ‰ b æ’åºï¼ŒåŒæ—¶è®°å½•ä¸»é”® â€“c--|â€“b--|â€“ä¸»é”®éƒ¨åˆ†a-- ï¼ˆåŒä¸Šï¼‰ 2 2 2 2 3 1 3 1 2 3 2 1 3 4 1 4 3 2</p><p>æ‰€ä»¥ï¼Œç»“è®ºæ˜¯ ca å¯ä»¥å»æ‰ï¼Œcb éœ€è¦ä¿ç•™ã€‚</p><p>è¯„è®ºåŒºç•™è¨€ç‚¹èµï¼š</p><blockquote><p>@æµªé‡Œç™½æ¡ å¸®å¤§å®¶æ€»ç»“äº†å¤ä¹ è¦ç‚¹ï¼› @çº¦ä¹¦äºš çš„é—®é¢˜é‡Œæåˆ°äº† MRR ä¼˜åŒ–ï¼› @HwangZHen ç•™è¨€è¨€ç®€æ„èµ…ã€‚</p></blockquote><h3 id="_07-è¡Œé”åŠŸè¿‡-æ€ä¹ˆå‡å°‘è¡Œé”å¯¹æ€§èƒ½çš„å½±å“" tabindex="-1"><a class="header-anchor" href="#_07-è¡Œé”åŠŸè¿‡-æ€ä¹ˆå‡å°‘è¡Œé”å¯¹æ€§èƒ½çš„å½±å“" aria-hidden="true">#</a> 07 è¡Œé”åŠŸè¿‡ï¼šæ€ä¹ˆå‡å°‘è¡Œé”å¯¹æ€§èƒ½çš„å½±å“ï¼Ÿ</h3><p>åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘è·Ÿä½ ä»‹ç»äº† MySQL çš„å…¨å±€é”å’Œè¡¨çº§é”ï¼Œä»Šå¤©æˆ‘ä»¬å°±æ¥è®²è®² MySQL çš„è¡Œé”ã€‚</p><p>MySQL çš„è¡Œé”æ˜¯åœ¨å¼•æ“å±‚ç”±å„ä¸ªå¼•æ“è‡ªå·±å®ç°çš„ã€‚ä½†å¹¶ä¸æ˜¯æ‰€æœ‰çš„å¼•æ“éƒ½æ”¯æŒè¡Œé”ï¼Œæ¯”å¦‚ MyISAM å¼•æ“å°±ä¸æ”¯æŒè¡Œé”ã€‚ä¸æ”¯æŒè¡Œé”æ„å‘³ç€å¹¶å‘æ§åˆ¶åªèƒ½ä½¿ç”¨è¡¨é”ï¼Œå¯¹äºè¿™ç§å¼•æ“çš„è¡¨ï¼ŒåŒä¸€å¼ è¡¨ä¸Šä»»ä½•æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªæ›´æ–°åœ¨æ‰§è¡Œï¼Œè¿™å°±ä¼šå½±å“åˆ°ä¸šåŠ¡å¹¶å‘åº¦ã€‚InnoDB æ˜¯æ”¯æŒè¡Œé”çš„ï¼Œè¿™ä¹Ÿæ˜¯ MyISAM è¢« InnoDB æ›¿ä»£çš„é‡è¦åŸå› ä¹‹ä¸€ã€‚</p><p>æˆ‘ä»¬ä»Šå¤©å°±ä¸»è¦æ¥èŠèŠ InnoDB çš„è¡Œé”ï¼Œä»¥åŠå¦‚ä½•é€šè¿‡å‡å°‘é”å†²çªæ¥æå‡ä¸šåŠ¡å¹¶å‘åº¦ã€‚</p><p>é¡¾åæ€ä¹‰ï¼Œè¡Œé”å°±æ˜¯é’ˆå¯¹æ•°æ®è¡¨ä¸­è¡Œè®°å½•çš„é”ã€‚è¿™å¾ˆå¥½ç†è§£ï¼Œæ¯”å¦‚äº‹åŠ¡ A æ›´æ–°äº†ä¸€è¡Œï¼Œè€Œè¿™æ—¶å€™äº‹åŠ¡ B ä¹Ÿè¦æ›´æ–°åŒä¸€è¡Œï¼Œåˆ™å¿…é¡»ç­‰äº‹åŠ¡ A çš„æ“ä½œå®Œæˆåæ‰èƒ½è¿›è¡Œæ›´æ–°ã€‚</p><p>å½“ç„¶ï¼Œæ•°æ®åº“ä¸­è¿˜æœ‰ä¸€äº›æ²¡é‚£ä¹ˆä¸€ç›®äº†ç„¶çš„æ¦‚å¿µå’Œè®¾è®¡ï¼Œè¿™äº›æ¦‚å¿µå¦‚æœç†è§£å’Œä½¿ç”¨ä¸å½“ï¼Œå®¹æ˜“å¯¼è‡´ç¨‹åºå‡ºç°éé¢„æœŸè¡Œä¸ºï¼Œæ¯”å¦‚ä¸¤é˜¶æ®µé”ã€‚</p><h4 id="ä»ä¸¤é˜¶æ®µé”è¯´èµ·" tabindex="-1"><a class="header-anchor" href="#ä»ä¸¤é˜¶æ®µé”è¯´èµ·" aria-hidden="true">#</a> ä»ä¸¤é˜¶æ®µé”è¯´èµ·</h4><p>æˆ‘å…ˆç»™ä½ ä¸¾ä¸ªä¾‹å­ã€‚åœ¨ä¸‹é¢çš„æ“ä½œåºåˆ—ä¸­ï¼Œäº‹åŠ¡ B çš„ update è¯­å¥æ‰§è¡Œæ—¶ä¼šæ˜¯ä»€ä¹ˆç°è±¡å‘¢ï¼Ÿå‡è®¾å­—æ®µ id æ˜¯è¡¨ t çš„ä¸»é”®ã€‚<img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/51f501f718e420244b0a2ec2ce858710-1584367388584.jpg" alt="img"></p><p>è¿™ä¸ªé—®é¢˜çš„ç»“è®ºå–å†³äºäº‹åŠ¡ A åœ¨æ‰§è¡Œå®Œä¸¤æ¡ update è¯­å¥åï¼ŒæŒæœ‰å“ªäº›é”ï¼Œä»¥åŠåœ¨ä»€ä¹ˆæ—¶å€™é‡Šæ”¾ã€‚ä½ å¯ä»¥éªŒè¯ä¸€ä¸‹ï¼šå®é™…ä¸Šäº‹åŠ¡ B çš„ update è¯­å¥ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°äº‹åŠ¡ A æ‰§è¡Œ commit ä¹‹åï¼Œäº‹åŠ¡ B æ‰èƒ½ç»§ç»­æ‰§è¡Œã€‚</p><p>çŸ¥é“äº†è¿™ä¸ªç­”æ¡ˆï¼Œä½ ä¸€å®šçŸ¥é“äº†äº‹åŠ¡ A æŒæœ‰çš„ä¸¤ä¸ªè®°å½•çš„è¡Œé”ï¼Œéƒ½æ˜¯åœ¨ commit çš„æ—¶å€™æ‰é‡Šæ”¾çš„ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>åœ¨ InnoDB äº‹åŠ¡ä¸­ï¼Œè¡Œé”æ˜¯åœ¨éœ€è¦çš„æ—¶å€™æ‰åŠ ä¸Šçš„ï¼Œä½†å¹¶ä¸æ˜¯ä¸éœ€è¦äº†å°±ç«‹åˆ»é‡Šæ”¾ï¼Œè€Œæ˜¯è¦ç­‰åˆ°äº‹åŠ¡ç»“æŸæ—¶æ‰é‡Šæ”¾ã€‚è¿™ä¸ªå°±æ˜¯ä¸¤é˜¶æ®µé”åè®®ã€‚</strong></p><p>çŸ¥é“äº†è¿™ä¸ªè®¾å®šï¼Œå¯¹æˆ‘ä»¬ä½¿ç”¨äº‹åŠ¡æœ‰ä»€ä¹ˆå¸®åŠ©å‘¢ï¼Ÿé‚£å°±æ˜¯ï¼Œå¦‚æœä½ çš„äº‹åŠ¡ä¸­éœ€è¦é”å¤šä¸ªè¡Œï¼Œè¦æŠŠæœ€å¯èƒ½é€ æˆé”å†²çªã€æœ€å¯èƒ½å½±å“å¹¶å‘åº¦çš„é”å°½é‡å¾€åæ”¾ã€‚æˆ‘ç»™ä½ ä¸¾ä¸ªä¾‹å­ã€‚</p><p>å‡è®¾ä½ è´Ÿè´£å®ç°ä¸€ä¸ªç”µå½±ç¥¨åœ¨çº¿äº¤æ˜“ä¸šåŠ¡ï¼Œé¡¾å®¢ A è¦åœ¨å½±é™¢ B è´­ä¹°ç”µå½±ç¥¨ã€‚æˆ‘ä»¬ç®€åŒ–ä¸€ç‚¹ï¼Œè¿™ä¸ªä¸šåŠ¡éœ€è¦æ¶‰åŠåˆ°ä»¥ä¸‹æ“ä½œï¼š</p><ol><li>ä»é¡¾å®¢ A è´¦æˆ·ä½™é¢ä¸­æ‰£é™¤ç”µå½±ç¥¨ä»·ï¼›</li><li>ç»™å½±é™¢ B çš„è´¦æˆ·ä½™é¢å¢åŠ è¿™å¼ ç”µå½±ç¥¨ä»·ï¼›</li><li>è®°å½•ä¸€æ¡äº¤æ˜“æ—¥å¿—ã€‚</li></ol><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œè¦å®Œæˆè¿™ä¸ªäº¤æ˜“ï¼Œæˆ‘ä»¬éœ€è¦ update ä¸¤æ¡è®°å½•ï¼Œå¹¶ insert ä¸€æ¡è®°å½•ã€‚å½“ç„¶ï¼Œä¸ºäº†ä¿è¯äº¤æ˜“çš„åŸå­æ€§ï¼Œæˆ‘ä»¬è¦æŠŠè¿™ä¸‰ä¸ªæ“ä½œæ”¾åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­ã€‚é‚£ä¹ˆï¼Œä½ ä¼šæ€æ ·å®‰æ’è¿™ä¸‰ä¸ªè¯­å¥åœ¨äº‹åŠ¡ä¸­çš„é¡ºåºå‘¢ï¼Ÿ</p><p>è¯•æƒ³å¦‚æœåŒæ—¶æœ‰å¦å¤–ä¸€ä¸ªé¡¾å®¢ C è¦åœ¨å½±é™¢ B ä¹°ç¥¨ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªäº‹åŠ¡å†²çªçš„éƒ¨åˆ†å°±æ˜¯è¯­å¥ 2 äº†ã€‚å› ä¸ºå®ƒä»¬è¦æ›´æ–°åŒä¸€ä¸ªå½±é™¢è´¦æˆ·çš„ä½™é¢ï¼Œéœ€è¦ä¿®æ”¹åŒä¸€è¡Œæ•°æ®ã€‚</p><p>æ ¹æ®ä¸¤é˜¶æ®µé”åè®®ï¼Œä¸è®ºä½ æ€æ ·å®‰æ’è¯­å¥é¡ºåºï¼Œæ‰€æœ‰çš„æ“ä½œéœ€è¦çš„è¡Œé”éƒ½æ˜¯åœ¨äº‹åŠ¡æäº¤çš„æ—¶å€™æ‰é‡Šæ”¾çš„ã€‚æ‰€ä»¥ï¼Œå¦‚æœä½ æŠŠè¯­å¥ 2 å®‰æ’åœ¨æœ€åï¼Œæ¯”å¦‚æŒ‰ç…§ 3ã€1ã€2 è¿™æ ·çš„é¡ºåºï¼Œé‚£ä¹ˆå½±é™¢è´¦æˆ·ä½™é¢è¿™ä¸€è¡Œçš„é”æ—¶é—´å°±æœ€å°‘ã€‚è¿™å°±æœ€å¤§ç¨‹åº¦åœ°å‡å°‘äº†äº‹åŠ¡ä¹‹é—´çš„é”ç­‰å¾…ï¼Œæå‡äº†å¹¶å‘åº¦ã€‚</p><p>å¥½äº†ï¼Œç°åœ¨ç”±äºä½ çš„æ­£ç¡®è®¾è®¡ï¼Œå½±é™¢ä½™é¢è¿™ä¸€è¡Œçš„è¡Œé”åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­ä¸ä¼šåœç•™å¾ˆé•¿æ—¶é—´ã€‚ä½†æ˜¯ï¼Œè¿™å¹¶æ²¡æœ‰å®Œå…¨è§£å†³ä½ çš„å›°æ‰°ã€‚</p><p>å¦‚æœè¿™ä¸ªå½±é™¢åšæ´»åŠ¨ï¼Œå¯ä»¥ä½ä»·é¢„å”®ä¸€å¹´å†…æ‰€æœ‰çš„ç”µå½±ç¥¨ï¼Œè€Œä¸”è¿™ä¸ªæ´»åŠ¨åªåšä¸€å¤©ã€‚äºæ˜¯åœ¨æ´»åŠ¨æ—¶é—´å¼€å§‹çš„æ—¶å€™ï¼Œä½ çš„ MySQL å°±æŒ‚äº†ã€‚ä½ ç™»ä¸ŠæœåŠ¡å™¨ä¸€çœ‹ï¼ŒCPU æ¶ˆè€—æ¥è¿‘ 100%ï¼Œä½†æ•´ä¸ªæ•°æ®åº“æ¯ç§’å°±æ‰§è¡Œä¸åˆ° 100 ä¸ªäº‹åŠ¡ã€‚è¿™æ˜¯ä»€ä¹ˆåŸå› å‘¢ï¼Ÿ</p><p>è¿™é‡Œï¼Œæˆ‘å°±è¦è¯´åˆ°æ­»é”å’Œæ­»é”æ£€æµ‹äº†ã€‚</p><h4 id="æ­»é”å’Œæ­»é”æ£€æµ‹" tabindex="-1"><a class="header-anchor" href="#æ­»é”å’Œæ­»é”æ£€æµ‹" aria-hidden="true">#</a> æ­»é”å’Œæ­»é”æ£€æµ‹</h4><p>å½“å¹¶å‘ç³»ç»Ÿä¸­ä¸åŒçº¿ç¨‹å‡ºç°å¾ªç¯èµ„æºä¾èµ–ï¼Œæ¶‰åŠçš„çº¿ç¨‹éƒ½åœ¨ç­‰å¾…åˆ«çš„çº¿ç¨‹é‡Šæ”¾èµ„æºæ—¶ï¼Œå°±ä¼šå¯¼è‡´è¿™å‡ ä¸ªçº¿ç¨‹éƒ½è¿›å…¥æ— é™ç­‰å¾…çš„çŠ¶æ€ï¼Œç§°ä¸ºæ­»é”ã€‚è¿™é‡Œæˆ‘ç”¨æ•°æ®åº“ä¸­çš„è¡Œé”ä¸¾ä¸ªä¾‹å­ã€‚<img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/4d0eeec7b136371b79248a0aed005a52-1584367388586.jpg" alt="img"></p><p>è¿™æ—¶å€™ï¼Œäº‹åŠ¡ A åœ¨ç­‰å¾…äº‹åŠ¡ B é‡Šæ”¾ id=2 çš„è¡Œé”ï¼Œè€Œäº‹åŠ¡ B åœ¨ç­‰å¾…äº‹åŠ¡ A é‡Šæ”¾ id=1 çš„è¡Œé”ã€‚ äº‹åŠ¡ A å’Œäº‹åŠ¡ B åœ¨äº’ç›¸ç­‰å¾…å¯¹æ–¹çš„èµ„æºé‡Šæ”¾ï¼Œå°±æ˜¯è¿›å…¥äº†æ­»é”çŠ¶æ€ã€‚å½“å‡ºç°æ­»é”ä»¥åï¼Œæœ‰ä¸¤ç§ç­–ç•¥ï¼š</p><ul><li>ä¸€ç§ç­–ç•¥æ˜¯ï¼Œç›´æ¥è¿›å…¥ç­‰å¾…ï¼Œç›´åˆ°è¶…æ—¶ã€‚è¿™ä¸ªè¶…æ—¶æ—¶é—´å¯ä»¥é€šè¿‡å‚æ•° innodb_lock_wait_timeout æ¥è®¾ç½®ã€‚</li><li>å¦ä¸€ç§ç­–ç•¥æ˜¯ï¼Œå‘èµ·æ­»é”æ£€æµ‹ï¼Œå‘ç°æ­»é”åï¼Œä¸»åŠ¨å›æ»šæ­»é”é“¾æ¡ä¸­çš„æŸä¸€ä¸ªäº‹åŠ¡ï¼Œè®©å…¶ä»–äº‹åŠ¡å¾—ä»¥ç»§ç»­æ‰§è¡Œã€‚å°†å‚æ•° innodb_deadlock_detect è®¾ç½®ä¸º onï¼Œè¡¨ç¤ºå¼€å¯è¿™ä¸ªé€»è¾‘ã€‚</li></ul><p>åœ¨ InnoDB ä¸­ï¼Œinnodb_lock_wait_timeout çš„é»˜è®¤å€¼æ˜¯ 50sï¼Œæ„å‘³ç€å¦‚æœé‡‡ç”¨ç¬¬ä¸€ä¸ªç­–ç•¥ï¼Œå½“å‡ºç°æ­»é”ä»¥åï¼Œç¬¬ä¸€ä¸ªè¢«é”ä½çš„çº¿ç¨‹è¦è¿‡ 50s æ‰ä¼šè¶…æ—¶é€€å‡ºï¼Œç„¶åå…¶ä»–çº¿ç¨‹æ‰æœ‰å¯èƒ½ç»§ç»­æ‰§è¡Œã€‚å¯¹äºåœ¨çº¿æœåŠ¡æ¥è¯´ï¼Œè¿™ä¸ªç­‰å¾…æ—¶é—´å¾€å¾€æ˜¯æ— æ³•æ¥å—çš„ã€‚</p><p>ä½†æ˜¯ï¼Œæˆ‘ä»¬åˆä¸å¯èƒ½ç›´æ¥æŠŠè¿™ä¸ªæ—¶é—´è®¾ç½®æˆä¸€ä¸ªå¾ˆå°çš„å€¼ï¼Œæ¯”å¦‚ 1sã€‚è¿™æ ·å½“å‡ºç°æ­»é”çš„æ—¶å€™ï¼Œç¡®å®å¾ˆå¿«å°±å¯ä»¥è§£å¼€ï¼Œä½†å¦‚æœä¸æ˜¯æ­»é”ï¼Œè€Œæ˜¯ç®€å•çš„é”ç­‰å¾…å‘¢ï¼Ÿæ‰€ä»¥ï¼Œè¶…æ—¶æ—¶é—´è®¾ç½®å¤ªçŸ­çš„è¯ï¼Œä¼šå‡ºç°å¾ˆå¤šè¯¯ä¼¤ã€‚</p><p>æ‰€ä»¥ï¼Œæ­£å¸¸æƒ…å†µä¸‹æˆ‘ä»¬è¿˜æ˜¯è¦é‡‡ç”¨ç¬¬äºŒç§ç­–ç•¥ï¼Œå³ï¼šä¸»åŠ¨æ­»é”æ£€æµ‹ï¼Œè€Œä¸” innodb_deadlock_detect çš„é»˜è®¤å€¼æœ¬èº«å°±æ˜¯ onã€‚ä¸»åŠ¨æ­»é”æ£€æµ‹åœ¨å‘ç”Ÿæ­»é”çš„æ—¶å€™ï¼Œæ˜¯èƒ½å¤Ÿå¿«é€Ÿå‘ç°å¹¶è¿›è¡Œå¤„ç†çš„ï¼Œä½†æ˜¯å®ƒä¹Ÿæ˜¯æœ‰é¢å¤–è´Ÿæ‹…çš„ã€‚</p><p>ä½ å¯ä»¥æƒ³è±¡ä¸€ä¸‹è¿™ä¸ªè¿‡ç¨‹ï¼šæ¯å½“ä¸€ä¸ªäº‹åŠ¡è¢«é”çš„æ—¶å€™ï¼Œå°±è¦çœ‹çœ‹å®ƒæ‰€ä¾èµ–çš„çº¿ç¨‹æœ‰æ²¡æœ‰è¢«åˆ«äººé”ä½ï¼Œå¦‚æ­¤å¾ªç¯ï¼Œæœ€ååˆ¤æ–­æ˜¯å¦å‡ºç°äº†å¾ªç¯ç­‰å¾…ï¼Œä¹Ÿå°±æ˜¯æ­»é”ã€‚</p><p>é‚£å¦‚æœæ˜¯æˆ‘ä»¬ä¸Šé¢è¯´åˆ°çš„æ‰€æœ‰äº‹åŠ¡éƒ½è¦æ›´æ–°åŒä¸€è¡Œçš„åœºæ™¯å‘¢ï¼Ÿ</p><p>æ¯ä¸ªæ–°æ¥çš„è¢«å µä½çš„çº¿ç¨‹ï¼Œéƒ½è¦åˆ¤æ–­ä¼šä¸ä¼šç”±äºè‡ªå·±çš„åŠ å…¥å¯¼è‡´äº†æ­»é”ï¼Œè¿™æ˜¯ä¸€ä¸ªæ—¶é—´å¤æ‚åº¦æ˜¯ O(n) çš„æ“ä½œã€‚å‡è®¾æœ‰ 1000 ä¸ªå¹¶å‘çº¿ç¨‹è¦åŒæ—¶æ›´æ–°åŒä¸€è¡Œï¼Œé‚£ä¹ˆæ­»é”æ£€æµ‹æ“ä½œå°±æ˜¯ 100 ä¸‡è¿™ä¸ªé‡çº§çš„ã€‚è™½ç„¶æœ€ç»ˆæ£€æµ‹çš„ç»“æœæ˜¯æ²¡æœ‰æ­»é”ï¼Œä½†æ˜¯è¿™æœŸé—´è¦æ¶ˆè€—å¤§é‡çš„ CPU èµ„æºã€‚å› æ­¤ï¼Œä½ å°±ä¼šçœ‹åˆ° CPU åˆ©ç”¨ç‡å¾ˆé«˜ï¼Œä½†æ˜¯æ¯ç§’å´æ‰§è¡Œä¸äº†å‡ ä¸ªäº‹åŠ¡ã€‚</p><p>æ ¹æ®ä¸Šé¢çš„åˆ†æï¼Œæˆ‘ä»¬æ¥è®¨è®ºä¸€ä¸‹ï¼Œæ€ä¹ˆè§£å†³ç”±è¿™ç§çƒ­ç‚¹è¡Œæ›´æ–°å¯¼è‡´çš„æ€§èƒ½é—®é¢˜å‘¢ï¼Ÿé—®é¢˜çš„ç—‡ç»“åœ¨äºï¼Œæ­»é”æ£€æµ‹è¦è€—è´¹å¤§é‡çš„ CPU èµ„æºã€‚</p><p>**ä¸€ç§å¤´ç—›åŒ»å¤´çš„æ–¹æ³•ï¼Œå°±æ˜¯å¦‚æœä½ èƒ½ç¡®ä¿è¿™ä¸ªä¸šåŠ¡ä¸€å®šä¸ä¼šå‡ºç°æ­»é”ï¼Œå¯ä»¥ä¸´æ—¶æŠŠæ­»é”æ£€æµ‹å…³æ‰ã€‚**ä½†æ˜¯è¿™ç§æ“ä½œæœ¬èº«å¸¦æœ‰ä¸€å®šçš„é£é™©ï¼Œå› ä¸ºä¸šåŠ¡è®¾è®¡çš„æ—¶å€™ä¸€èˆ¬ä¸ä¼šæŠŠæ­»é”å½“åšä¸€ä¸ªä¸¥é‡é”™è¯¯ï¼Œæ¯•ç«Ÿå‡ºç°æ­»é”äº†ï¼Œå°±å›æ»šï¼Œç„¶åé€šè¿‡ä¸šåŠ¡é‡è¯•ä¸€èˆ¬å°±æ²¡é—®é¢˜äº†ï¼Œè¿™æ˜¯ä¸šåŠ¡æ— æŸçš„ã€‚è€Œå…³æ‰æ­»é”æ£€æµ‹æ„å‘³ç€å¯èƒ½ä¼šå‡ºç°å¤§é‡çš„è¶…æ—¶ï¼Œè¿™æ˜¯ä¸šåŠ¡æœ‰æŸçš„ã€‚</p><p>**å¦ä¸€ä¸ªæ€è·¯æ˜¯æ§åˆ¶å¹¶å‘åº¦ã€‚**æ ¹æ®ä¸Šé¢çš„åˆ†æï¼Œä½ ä¼šå‘ç°å¦‚æœå¹¶å‘èƒ½å¤Ÿæ§åˆ¶ä½ï¼Œæ¯”å¦‚åŒä¸€è¡ŒåŒæ—¶æœ€å¤šåªæœ‰ 10 ä¸ªçº¿ç¨‹åœ¨æ›´æ–°ï¼Œé‚£ä¹ˆæ­»é”æ£€æµ‹çš„æˆæœ¬å¾ˆä½ï¼Œå°±ä¸ä¼šå‡ºç°è¿™ä¸ªé—®é¢˜ã€‚ä¸€ä¸ªç›´æ¥çš„æƒ³æ³•å°±æ˜¯ï¼Œåœ¨å®¢æˆ·ç«¯åšå¹¶å‘æ§åˆ¶ã€‚ä½†æ˜¯ï¼Œä½ ä¼šå¾ˆå¿«å‘ç°è¿™ä¸ªæ–¹æ³•ä¸å¤ªå¯è¡Œï¼Œå› ä¸ºå®¢æˆ·ç«¯å¾ˆå¤šã€‚æˆ‘è§è¿‡ä¸€ä¸ªåº”ç”¨ï¼Œæœ‰ 600 ä¸ªå®¢æˆ·ç«¯ï¼Œè¿™æ ·å³ä½¿æ¯ä¸ªå®¢æˆ·ç«¯æ§åˆ¶åˆ°åªæœ‰ 5 ä¸ªå¹¶å‘çº¿ç¨‹ï¼Œæ±‡æ€»åˆ°æ•°æ®åº“æœåŠ¡ç«¯ä»¥åï¼Œå³°å€¼å¹¶å‘æ•°ä¹Ÿå¯èƒ½è¦è¾¾åˆ° 3000ã€‚</p><p>å› æ­¤ï¼Œè¿™ä¸ªå¹¶å‘æ§åˆ¶è¦åšåœ¨æ•°æ®åº“æœåŠ¡ç«¯ã€‚å¦‚æœä½ æœ‰ä¸­é—´ä»¶ï¼Œå¯ä»¥è€ƒè™‘åœ¨ä¸­é—´ä»¶å®ç°ï¼›å¦‚æœä½ çš„å›¢é˜Ÿæœ‰èƒ½ä¿®æ”¹ MySQL æºç çš„äººï¼Œä¹Ÿå¯ä»¥åšåœ¨ MySQL é‡Œé¢ã€‚åŸºæœ¬æ€è·¯å°±æ˜¯ï¼Œå¯¹äºç›¸åŒè¡Œçš„æ›´æ–°ï¼Œåœ¨è¿›å…¥å¼•æ“ä¹‹å‰æ’é˜Ÿã€‚è¿™æ ·åœ¨ InnoDB å†…éƒ¨å°±ä¸ä¼šæœ‰å¤§é‡çš„æ­»é”æ£€æµ‹å·¥ä½œäº†ã€‚</p><p>å¯èƒ½ä½ ä¼šé—®ï¼Œ<strong>å¦‚æœå›¢é˜Ÿé‡Œæš‚æ—¶æ²¡æœ‰æ•°æ®åº“æ–¹é¢çš„ä¸“å®¶ï¼Œä¸èƒ½å®ç°è¿™æ ·çš„æ–¹æ¡ˆï¼Œèƒ½ä¸èƒ½ä»è®¾è®¡ä¸Šä¼˜åŒ–è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ</strong></p><p>ä½ å¯ä»¥è€ƒè™‘é€šè¿‡å°†ä¸€è¡Œæ”¹æˆé€»è¾‘ä¸Šçš„å¤šè¡Œæ¥å‡å°‘é”å†²çªã€‚è¿˜æ˜¯ä»¥å½±é™¢è´¦æˆ·ä¸ºä¾‹ï¼Œå¯ä»¥è€ƒè™‘æ”¾åœ¨å¤šæ¡è®°å½•ä¸Šï¼Œæ¯”å¦‚ 10 ä¸ªè®°å½•ï¼Œå½±é™¢çš„è´¦æˆ·æ€»é¢ç­‰äºè¿™ 10 ä¸ªè®°å½•çš„å€¼çš„æ€»å’Œã€‚è¿™æ ·æ¯æ¬¡è¦ç»™å½±é™¢è´¦æˆ·åŠ é‡‘é¢çš„æ—¶å€™ï¼Œéšæœºé€‰å…¶ä¸­ä¸€æ¡è®°å½•æ¥åŠ ã€‚è¿™æ ·æ¯æ¬¡å†²çªæ¦‚ç‡å˜æˆåŸæ¥çš„ 1/10ï¼Œå¯ä»¥å‡å°‘é”ç­‰å¾…ä¸ªæ•°ï¼Œä¹Ÿå°±å‡å°‘äº†æ­»é”æ£€æµ‹çš„ CPU æ¶ˆè€—ã€‚</p><p>è¿™ä¸ªæ–¹æ¡ˆçœ‹ä¸Šå»æ˜¯æ— æŸçš„ï¼Œä½†å…¶å®è¿™ç±»æ–¹æ¡ˆéœ€è¦æ ¹æ®ä¸šåŠ¡é€»è¾‘åšè¯¦ç»†è®¾è®¡ã€‚å¦‚æœè´¦æˆ·ä½™é¢å¯èƒ½ä¼šå‡å°‘ï¼Œæ¯”å¦‚é€€ç¥¨é€»è¾‘ï¼Œé‚£ä¹ˆè¿™æ—¶å€™å°±éœ€è¦è€ƒè™‘å½“ä¸€éƒ¨åˆ†è¡Œè®°å½•å˜æˆ 0 çš„æ—¶å€™ï¼Œä»£ç è¦æœ‰ç‰¹æ®Šå¤„ç†ã€‚</p><h4 id="å°ç»“-6" tabindex="-1"><a class="header-anchor" href="#å°ç»“-6" aria-hidden="true">#</a> å°ç»“</h4><p>ä»Šå¤©ï¼Œæˆ‘å’Œä½ ä»‹ç»äº† MySQL çš„è¡Œé”ï¼Œæ¶‰åŠäº†ä¸¤é˜¶æ®µé”åè®®ã€æ­»é”å’Œæ­»é”æ£€æµ‹è¿™ä¸¤å¤§éƒ¨åˆ†å†…å®¹ã€‚</p><p>å…¶ä¸­ï¼Œæˆ‘ä»¥ä¸¤é˜¶æ®µåè®®ä¸ºèµ·ç‚¹ï¼Œå’Œä½ ä¸€èµ·è®¨è®ºäº†åœ¨å¼€å‘çš„æ—¶å€™å¦‚ä½•å®‰æ’æ­£ç¡®çš„äº‹åŠ¡è¯­å¥ã€‚è¿™é‡Œçš„åŸåˆ™ / æˆ‘ç»™ä½ çš„å»ºè®®æ˜¯ï¼šå¦‚æœä½ çš„äº‹åŠ¡ä¸­éœ€è¦é”å¤šä¸ªè¡Œï¼Œè¦æŠŠæœ€å¯èƒ½é€ æˆé”å†²çªã€æœ€å¯èƒ½å½±å“å¹¶å‘åº¦çš„é”çš„ç”³è¯·æ—¶æœºå°½é‡å¾€åæ”¾ã€‚</p><p>ä½†æ˜¯ï¼Œè°ƒæ•´è¯­å¥é¡ºåºå¹¶ä¸èƒ½å®Œå…¨é¿å…æ­»é”ã€‚æ‰€ä»¥æˆ‘ä»¬å¼•å…¥äº†æ­»é”å’Œæ­»é”æ£€æµ‹çš„æ¦‚å¿µï¼Œä»¥åŠæä¾›äº†ä¸‰ä¸ªæ–¹æ¡ˆï¼Œæ¥å‡å°‘æ­»é”å¯¹æ•°æ®åº“çš„å½±å“ã€‚å‡å°‘æ­»é”çš„ä¸»è¦æ–¹å‘ï¼Œå°±æ˜¯æ§åˆ¶è®¿é—®ç›¸åŒèµ„æºçš„å¹¶å‘äº‹åŠ¡é‡ã€‚</p><p>æœ€åï¼Œæˆ‘ç»™ä½ ç•™ä¸‹ä¸€ä¸ªé—®é¢˜å§ã€‚å¦‚æœä½ è¦åˆ é™¤ä¸€ä¸ªè¡¨é‡Œé¢çš„å‰ 10000 è¡Œæ•°æ®ï¼Œæœ‰ä»¥ä¸‹ä¸‰ç§æ–¹æ³•å¯ä»¥åšåˆ°ï¼š</p><ul><li>ç¬¬ä¸€ç§ï¼Œç›´æ¥æ‰§è¡Œ delete from T limit 10000;</li><li>ç¬¬äºŒç§ï¼Œåœ¨ä¸€ä¸ªè¿æ¥ä¸­å¾ªç¯æ‰§è¡Œ 20 æ¬¡ delete from T limit 500;</li><li>ç¬¬ä¸‰ç§ï¼Œåœ¨ 20 ä¸ªè¿æ¥ä¸­åŒæ—¶æ‰§è¡Œ delete from T limit 500ã€‚</li></ul><p>ä½ ä¼šé€‰æ‹©å“ªä¸€ç§æ–¹æ³•å‘¢ï¼Ÿä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p><p>ä½ å¯ä»¥æŠŠä½ çš„æ€è€ƒå’Œè§‚ç‚¹å†™åœ¨ç•™è¨€åŒºé‡Œï¼Œæˆ‘ä¼šåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« çš„æœ«å°¾å’Œä½ è®¨è®ºè¿™ä¸ªé—®é¢˜ã€‚æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚</p><h4 id="ä¸ŠæœŸé—®é¢˜æ—¶é—´-3" tabindex="-1"><a class="header-anchor" href="#ä¸ŠæœŸé—®é¢˜æ—¶é—´-3" aria-hidden="true">#</a> ä¸ŠæœŸé—®é¢˜æ—¶é—´</h4><p>ä¸ŠæœŸæˆ‘ç»™ä½ ç•™çš„é—®é¢˜æ˜¯ï¼šå½“å¤‡åº“ç”¨â€“single-transaction åšé€»è¾‘å¤‡ä»½çš„æ—¶å€™ï¼Œå¦‚æœä»ä¸»åº“çš„ binlog ä¼ æ¥ä¸€ä¸ª DDL è¯­å¥ä¼šæ€ä¹ˆæ ·ï¼Ÿ</p><p>å‡è®¾è¿™ä¸ª DDL æ˜¯é’ˆå¯¹è¡¨ t1 çš„ï¼Œ è¿™é‡Œæˆ‘æŠŠå¤‡ä»½è¿‡ç¨‹ä¸­å‡ ä¸ªå…³é”®çš„è¯­å¥åˆ—å‡ºæ¥ï¼š</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>Q1:<span class="token keyword">SET</span> <span class="token keyword">SESSION</span> <span class="token keyword">TRANSACTION</span> <span class="token keyword">ISOLATION</span> <span class="token keyword">LEVEL</span> <span class="token keyword">REPEATABLE</span> <span class="token keyword">READ</span><span class="token punctuation">;</span>
Q2:<span class="token keyword">START</span> <span class="token keyword">TRANSACTION</span>  <span class="token keyword">WITH</span> <span class="token keyword">CONSISTENT</span> <span class="token keyword">SNAPSHOT</span>ï¼›
<span class="token comment">/* other tables */</span>
Q3:<span class="token keyword">SAVEPOINT</span> sp<span class="token punctuation">;</span>
<span class="token comment">/* æ—¶åˆ» 1 */</span>
Q4:<span class="token keyword">show</span> <span class="token keyword">create</span> <span class="token keyword">table</span> <span class="token identifier"><span class="token punctuation">`</span>t1<span class="token punctuation">`</span></span><span class="token punctuation">;</span>
<span class="token comment">/* æ—¶åˆ» 2 */</span>
Q5:<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>t1<span class="token punctuation">`</span></span><span class="token punctuation">;</span>
<span class="token comment">/* æ—¶åˆ» 3 */</span>
Q6:<span class="token keyword">ROLLBACK</span> <span class="token keyword">TO</span> <span class="token keyword">SAVEPOINT</span> sp<span class="token punctuation">;</span>
<span class="token comment">/* æ—¶åˆ» 4 */</span>
<span class="token comment">/* other tables */</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨å¤‡ä»½å¼€å§‹çš„æ—¶å€™ï¼Œä¸ºäº†ç¡®ä¿ RRï¼ˆå¯é‡å¤è¯»ï¼‰éš”ç¦»çº§åˆ«ï¼Œå†è®¾ç½®ä¸€æ¬¡ RR éš”ç¦»çº§åˆ« (Q1);</p><p>å¯åŠ¨äº‹åŠ¡ï¼Œè¿™é‡Œç”¨ WITH CONSISTENT SNAPSHOT ç¡®ä¿è¿™ä¸ªè¯­å¥æ‰§è¡Œå®Œå°±å¯ä»¥å¾—åˆ°ä¸€ä¸ªä¸€è‡´æ€§è§†å›¾ï¼ˆQ2)ï¼›</p><p>è®¾ç½®ä¸€ä¸ªä¿å­˜ç‚¹ï¼Œè¿™ä¸ªå¾ˆé‡è¦ï¼ˆQ3ï¼‰ï¼›</p><p>show create æ˜¯ä¸ºäº†æ‹¿åˆ°è¡¨ç»“æ„ (Q4)ï¼Œç„¶åæ­£å¼å¯¼æ•°æ® ï¼ˆQ5ï¼‰ï¼Œå›æ»šåˆ° SAVEPOINT spï¼Œåœ¨è¿™é‡Œçš„ä½œç”¨æ˜¯é‡Šæ”¾ t1 çš„ MDL é” ï¼ˆQ6ï¼‰ã€‚å½“ç„¶è¿™éƒ¨åˆ†å±äºâ€œè¶…çº²â€ï¼Œä¸Šæ–‡æ­£æ–‡é‡Œé¢éƒ½æ²¡æåˆ°ã€‚</p><p>DDL ä»ä¸»åº“ä¼ è¿‡æ¥çš„æ—¶é—´æŒ‰ç…§æ•ˆæœä¸åŒï¼Œæˆ‘æ‰“äº†å››ä¸ªæ—¶åˆ»ã€‚é¢˜ç›®è®¾å®šä¸ºå°è¡¨ï¼Œæˆ‘ä»¬å‡å®šåˆ°è¾¾åï¼Œå¦‚æœå¼€å§‹æ‰§è¡Œï¼Œåˆ™å¾ˆå¿«èƒ½å¤Ÿæ‰§è¡Œå®Œæˆã€‚</p><p>å‚è€ƒç­”æ¡ˆå¦‚ä¸‹ï¼š</p><ol><li>å¦‚æœåœ¨ Q4 è¯­å¥æ‰§è¡Œä¹‹å‰åˆ°è¾¾ï¼Œç°è±¡ï¼šæ²¡æœ‰å½±å“ï¼Œå¤‡ä»½æ‹¿åˆ°çš„æ˜¯ DDL åçš„è¡¨ç»“æ„ã€‚</li><li>å¦‚æœåœ¨â€œæ—¶åˆ» 2â€åˆ°è¾¾ï¼Œåˆ™è¡¨ç»“æ„è¢«æ”¹è¿‡ï¼ŒQ5 æ‰§è¡Œçš„æ—¶å€™ï¼ŒæŠ¥ Table definition has changed, please retry transactionï¼Œç°è±¡ï¼šmysqldump ç»ˆæ­¢ï¼›</li><li>å¦‚æœåœ¨â€œæ—¶åˆ» 2â€å’Œâ€œæ—¶åˆ» 3â€ä¹‹é—´åˆ°è¾¾ï¼Œmysqldump å ç€ t1 çš„ MDL è¯»é”ï¼Œbinlog è¢«é˜»å¡ï¼Œç°è±¡ï¼šä¸»ä»å»¶è¿Ÿï¼Œç›´åˆ° Q6 æ‰§è¡Œå®Œæˆã€‚</li><li>ä»â€œæ—¶åˆ» 4â€å¼€å§‹ï¼Œmysqldump é‡Šæ”¾äº† MDL è¯»é”ï¼Œç°è±¡ï¼šæ²¡æœ‰å½±å“ï¼Œå¤‡ä»½æ‹¿åˆ°çš„æ˜¯ DDL å‰çš„è¡¨ç»“æ„ã€‚</li></ol><p>è¯„è®ºåŒºç•™è¨€ç‚¹èµæ¿ï¼š</p><blockquote><p>@Aurora ç»™äº†æœ€æ¥è¿‘çš„ç­”æ¡ˆï¼› @echoï¼¿é™ˆ é—®äº†ä¸€ä¸ªå¥½é—®é¢˜ï¼› @å£¹ç¬™â˜æ¼‚æ³Š åšäº†å¾ˆå¥½çš„æ€»ç»“ã€‚</p></blockquote><h3 id="_08-äº‹åŠ¡åˆ°åº•æ˜¯éš”ç¦»çš„è¿˜æ˜¯ä¸éš”ç¦»çš„" tabindex="-1"><a class="header-anchor" href="#_08-äº‹åŠ¡åˆ°åº•æ˜¯éš”ç¦»çš„è¿˜æ˜¯ä¸éš”ç¦»çš„" aria-hidden="true">#</a> 08 äº‹åŠ¡åˆ°åº•æ˜¯éš”ç¦»çš„è¿˜æ˜¯ä¸éš”ç¦»çš„ï¼Ÿ</h3><p>æˆ‘åœ¨ç¬¬ 3 ç¯‡æ–‡ç« å’Œä½ è®²äº‹åŠ¡éš”ç¦»çº§åˆ«çš„æ—¶å€™æåˆ°è¿‡ï¼Œå¦‚æœæ˜¯å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ï¼Œäº‹åŠ¡ T å¯åŠ¨çš„æ—¶å€™ä¼šåˆ›å»ºä¸€ä¸ªè§†å›¾ read-viewï¼Œä¹‹åäº‹åŠ¡ T æ‰§è¡ŒæœŸé—´ï¼Œå³ä½¿æœ‰å…¶ä»–äº‹åŠ¡ä¿®æ”¹äº†æ•°æ®ï¼Œäº‹åŠ¡ T çœ‹åˆ°çš„ä»ç„¶è·Ÿåœ¨å¯åŠ¨æ—¶çœ‹åˆ°çš„ä¸€æ ·ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªåœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹æ‰§è¡Œçš„äº‹åŠ¡ï¼Œå¥½åƒä¸ä¸–æ— äº‰ï¼Œä¸å—å¤–ç•Œå½±å“ã€‚</p><p>ä½†æ˜¯ï¼Œæˆ‘åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œå’Œä½ åˆ†äº«è¡Œé”çš„æ—¶å€™åˆæåˆ°ï¼Œä¸€ä¸ªäº‹åŠ¡è¦æ›´æ–°ä¸€è¡Œï¼Œå¦‚æœåˆšå¥½æœ‰å¦å¤–ä¸€ä¸ªäº‹åŠ¡æ‹¥æœ‰è¿™ä¸€è¡Œçš„è¡Œé”ï¼Œå®ƒåˆä¸èƒ½è¿™ä¹ˆè¶…ç„¶äº†ï¼Œä¼šè¢«é”ä½ï¼Œè¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚é—®é¢˜æ˜¯ï¼Œæ—¢ç„¶è¿›å…¥äº†ç­‰å¾…çŠ¶æ€ï¼Œé‚£ä¹ˆç­‰åˆ°è¿™ä¸ªäº‹åŠ¡è‡ªå·±è·å–åˆ°è¡Œé”è¦æ›´æ–°æ•°æ®çš„æ—¶å€™ï¼Œå®ƒè¯»åˆ°çš„å€¼åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><p>æˆ‘ç»™ä½ ä¸¾ä¸€ä¸ªä¾‹å­å§ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªåªæœ‰ä¸¤è¡Œçš„è¡¨çš„åˆå§‹åŒ–è¯­å¥ã€‚</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>t<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>k<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> t<span class="token punctuation">(</span>id<span class="token punctuation">,</span> k<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/823acf76e53c0bdba7beab45e72e90d6-1584367388592.png" alt="img"></p><p>å›¾ 1 äº‹åŠ¡ Aã€Bã€C çš„æ‰§è¡Œæµç¨‹</p><p>è¿™é‡Œï¼Œæˆ‘ä»¬éœ€è¦æ³¨æ„çš„æ˜¯äº‹åŠ¡çš„å¯åŠ¨æ—¶æœºã€‚</p><p>begin/start transaction å‘½ä»¤å¹¶ä¸æ˜¯ä¸€ä¸ªäº‹åŠ¡çš„èµ·ç‚¹ï¼Œåœ¨æ‰§è¡Œåˆ°å®ƒä»¬ä¹‹åçš„ç¬¬ä¸€ä¸ªæ“ä½œ InnoDB è¡¨çš„è¯­å¥ï¼ˆç¬¬ä¸€ä¸ªå¿«ç…§è¯»è¯­å¥ï¼‰ï¼Œäº‹åŠ¡æ‰çœŸæ­£å¯åŠ¨ã€‚å¦‚æœä½ æƒ³è¦é©¬ä¸Šå¯åŠ¨ä¸€ä¸ªäº‹åŠ¡ï¼Œå¯ä»¥ä½¿ç”¨ start transaction with consistent snapshot è¿™ä¸ªå‘½ä»¤ã€‚</p><p>è¿˜éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨æ•´ä¸ªä¸“æ é‡Œé¢ï¼Œæˆ‘ä»¬çš„ä¾‹å­ä¸­å¦‚æœæ²¡æœ‰ç‰¹åˆ«è¯´æ˜ï¼Œéƒ½æ˜¯é»˜è®¤ autocommit=1ã€‚</p><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œäº‹åŠ¡ C æ²¡æœ‰æ˜¾å¼åœ°ä½¿ç”¨ begin/commitï¼Œè¡¨ç¤ºè¿™ä¸ª update è¯­å¥æœ¬èº«å°±æ˜¯ä¸€ä¸ªäº‹åŠ¡ï¼Œè¯­å¥å®Œæˆçš„æ—¶å€™ä¼šè‡ªåŠ¨æäº¤ã€‚äº‹åŠ¡ B åœ¨æ›´æ–°äº†è¡Œä¹‹åæŸ¥è¯¢ ; äº‹åŠ¡ A åœ¨ä¸€ä¸ªåªè¯»äº‹åŠ¡ä¸­æŸ¥è¯¢ï¼Œå¹¶ä¸”æ—¶é—´é¡ºåºä¸Šæ˜¯åœ¨äº‹åŠ¡ B çš„æŸ¥è¯¢ä¹‹åã€‚</p><p>è¿™æ—¶ï¼Œå¦‚æœæˆ‘å‘Šè¯‰ä½ äº‹åŠ¡ B æŸ¥åˆ°çš„ k çš„å€¼æ˜¯ 3ï¼Œè€Œäº‹åŠ¡ A æŸ¥åˆ°çš„ k çš„å€¼æ˜¯ 1ï¼Œä½ æ˜¯ä¸æ˜¯æ„Ÿè§‰æœ‰ç‚¹æ™•å‘¢ï¼Ÿ</p><p>æ‰€ä»¥ï¼Œä»Šå¤©è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘å…¶å®å°±æ˜¯æƒ³å’Œä½ è¯´æ˜ç™½è¿™ä¸ªé—®é¢˜ï¼Œå¸Œæœ›å€Ÿç”±æŠŠè¿™ä¸ªç–‘æƒ‘è§£å¼€çš„è¿‡ç¨‹ï¼Œèƒ½å¤Ÿå¸®åŠ©ä½ å¯¹ InnoDB çš„äº‹åŠ¡å’Œé”æœ‰æ›´è¿›ä¸€æ­¥çš„ç†è§£ã€‚</p><p>åœ¨ MySQL é‡Œï¼Œæœ‰ä¸¤ä¸ªâ€œè§†å›¾â€çš„æ¦‚å¿µï¼š</p><ul><li>ä¸€ä¸ªæ˜¯ viewã€‚å®ƒæ˜¯ä¸€ä¸ªç”¨æŸ¥è¯¢è¯­å¥å®šä¹‰çš„è™šæ‹Ÿè¡¨ï¼Œåœ¨è°ƒç”¨çš„æ—¶å€™æ‰§è¡ŒæŸ¥è¯¢è¯­å¥å¹¶ç”Ÿæˆç»“æœã€‚åˆ›å»ºè§†å›¾çš„è¯­æ³•æ˜¯ create view ... ï¼Œè€Œå®ƒçš„æŸ¥è¯¢æ–¹æ³•ä¸è¡¨ä¸€æ ·ã€‚</li><li>å¦ä¸€ä¸ªæ˜¯ InnoDB åœ¨å®ç° MVCC æ—¶ç”¨åˆ°çš„ä¸€è‡´æ€§è¯»è§†å›¾ï¼Œå³ consistent read viewï¼Œç”¨äºæ”¯æŒ RCï¼ˆRead Committedï¼Œè¯»æäº¤ï¼‰å’Œ RRï¼ˆRepeatable Readï¼Œå¯é‡å¤è¯»ï¼‰éš”ç¦»çº§åˆ«çš„å®ç°ã€‚</li></ul><p>å®ƒæ²¡æœ‰ç‰©ç†ç»“æ„ï¼Œä½œç”¨æ˜¯äº‹åŠ¡æ‰§è¡ŒæœŸé—´ç”¨æ¥å®šä¹‰â€œæˆ‘èƒ½çœ‹åˆ°ä»€ä¹ˆæ•°æ®â€ã€‚</p><p>åœ¨ç¬¬ 3 ç¯‡æ–‡ç« [ã€Šäº‹åŠ¡éš”ç¦»ï¼šä¸ºä»€ä¹ˆä½ æ”¹äº†æˆ‘è¿˜çœ‹ä¸è§ï¼Ÿã€‹]ä¸­ï¼Œæˆ‘è·Ÿä½ è§£é‡Šè¿‡ä¸€é MVCC çš„å®ç°é€»è¾‘ã€‚ä»Šå¤©ä¸ºäº†è¯´æ˜æŸ¥è¯¢å’Œæ›´æ–°çš„åŒºåˆ«ï¼Œæˆ‘æ¢ä¸€ä¸ªæ–¹å¼æ¥è¯´æ˜ï¼ŒæŠŠ read view æ‹†å¼€ã€‚ä½ å¯ä»¥ç»“åˆè¿™ä¸¤ç¯‡æ–‡ç« çš„è¯´æ˜æ¥æ›´æ·±ä¸€æ­¥åœ°ç†è§£ MVCCã€‚</p><h4 id="å¿«ç…§-åœ¨-mvcc-é‡Œæ˜¯æ€ä¹ˆå·¥ä½œçš„" tabindex="-1"><a class="header-anchor" href="#å¿«ç…§-åœ¨-mvcc-é‡Œæ˜¯æ€ä¹ˆå·¥ä½œçš„" aria-hidden="true">#</a> â€œå¿«ç…§â€åœ¨ MVCC é‡Œæ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼Ÿ</h4><p>åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹ï¼Œäº‹åŠ¡åœ¨å¯åŠ¨çš„æ—¶å€™å°±â€œæ‹äº†ä¸ªå¿«ç…§â€ã€‚æ³¨æ„ï¼Œè¿™ä¸ªå¿«ç…§æ˜¯åŸºäºæ•´åº“çš„ã€‚</p><p>è¿™æ—¶ï¼Œä½ ä¼šè¯´è¿™çœ‹ä¸Šå»ä¸å¤ªç°å®å•Šã€‚å¦‚æœä¸€ä¸ªåº“æœ‰ 100Gï¼Œé‚£ä¹ˆæˆ‘å¯åŠ¨ä¸€ä¸ªäº‹åŠ¡ï¼ŒMySQL å°±è¦æ‹·è´ 100G çš„æ•°æ®å‡ºæ¥ï¼Œè¿™ä¸ªè¿‡ç¨‹å¾—å¤šæ…¢å•Šã€‚å¯æ˜¯ï¼Œæˆ‘å¹³æ—¶çš„äº‹åŠ¡æ‰§è¡Œèµ·æ¥å¾ˆå¿«å•Šã€‚</p><p>å®é™…ä¸Šï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦æ‹·è´å‡ºè¿™ 100G çš„æ•°æ®ã€‚æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹è¿™ä¸ªå¿«ç…§æ˜¯æ€ä¹ˆå®ç°çš„ã€‚</p><p>InnoDB é‡Œé¢æ¯ä¸ªäº‹åŠ¡æœ‰ä¸€ä¸ªå”¯ä¸€çš„äº‹åŠ¡ IDï¼Œå«ä½œ transaction idã€‚å®ƒæ˜¯åœ¨äº‹åŠ¡å¼€å§‹çš„æ—¶å€™å‘ InnoDB çš„äº‹åŠ¡ç³»ç»Ÿç”³è¯·çš„ï¼Œæ˜¯æŒ‰ç”³è¯·é¡ºåºä¸¥æ ¼é€’å¢çš„ã€‚</p><p>è€Œæ¯è¡Œæ•°æ®ä¹Ÿéƒ½æ˜¯æœ‰å¤šä¸ªç‰ˆæœ¬çš„ã€‚æ¯æ¬¡äº‹åŠ¡æ›´æ–°æ•°æ®çš„æ—¶å€™ï¼Œéƒ½ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„æ•°æ®ç‰ˆæœ¬ï¼Œå¹¶ä¸”æŠŠ transaction id èµ‹å€¼ç»™è¿™ä¸ªæ•°æ®ç‰ˆæœ¬çš„äº‹åŠ¡ IDï¼Œè®°ä¸º row trx_idã€‚åŒæ—¶ï¼Œæ—§çš„æ•°æ®ç‰ˆæœ¬è¦ä¿ç•™ï¼Œå¹¶ä¸”åœ¨æ–°çš„æ•°æ®ç‰ˆæœ¬ä¸­ï¼Œèƒ½å¤Ÿæœ‰ä¿¡æ¯å¯ä»¥ç›´æ¥æ‹¿åˆ°å®ƒã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæ•°æ®è¡¨ä¸­çš„ä¸€è¡Œè®°å½•ï¼Œå…¶å®å¯èƒ½æœ‰å¤šä¸ªç‰ˆæœ¬ (row)ï¼Œæ¯ä¸ªç‰ˆæœ¬æœ‰è‡ªå·±çš„ row trx_idã€‚</p><p>å¦‚å›¾ 2 æ‰€ç¤ºï¼Œå°±æ˜¯ä¸€ä¸ªè®°å½•è¢«å¤šä¸ªäº‹åŠ¡è¿ç»­æ›´æ–°åçš„çŠ¶æ€ã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/68d08d277a6f7926a41cc5541d3dfced-1584367388595.png" alt="img"></p><p>å›¾ 2 è¡ŒçŠ¶æ€å˜æ›´å›¾</p><p>å›¾ä¸­è™šçº¿æ¡†é‡Œæ˜¯åŒä¸€è¡Œæ•°æ®çš„ 4 ä¸ªç‰ˆæœ¬ï¼Œå½“å‰æœ€æ–°ç‰ˆæœ¬æ˜¯ V4ï¼Œk çš„å€¼æ˜¯ 22ï¼Œå®ƒæ˜¯è¢« transaction id ä¸º 25 çš„äº‹åŠ¡æ›´æ–°çš„ï¼Œå› æ­¤å®ƒçš„ row trx_id ä¹Ÿæ˜¯ 25ã€‚</p><p>ä½ å¯èƒ½ä¼šé—®ï¼Œå‰é¢çš„æ–‡ç« ä¸æ˜¯è¯´ï¼Œè¯­å¥æ›´æ–°ä¼šç”Ÿæˆ undo logï¼ˆå›æ»šæ—¥å¿—ï¼‰å—ï¼Ÿé‚£ä¹ˆï¼Œ<strong>undo log åœ¨å“ªå‘¢ï¼Ÿ</strong></p><p>å®é™…ä¸Šï¼Œå›¾ 2 ä¸­çš„ä¸‰ä¸ªè™šçº¿ç®­å¤´ï¼Œå°±æ˜¯ undo logï¼›è€Œ V1ã€V2ã€V3 å¹¶ä¸æ˜¯ç‰©ç†ä¸ŠçœŸå®å­˜åœ¨çš„ï¼Œè€Œæ˜¯æ¯æ¬¡éœ€è¦çš„æ—¶å€™æ ¹æ®å½“å‰ç‰ˆæœ¬å’Œ undo log è®¡ç®—å‡ºæ¥çš„ã€‚æ¯”å¦‚ï¼Œéœ€è¦ V2 çš„æ—¶å€™ï¼Œå°±æ˜¯é€šè¿‡ V4 ä¾æ¬¡æ‰§è¡Œ U3ã€U2 ç®—å‡ºæ¥ã€‚</p><p>æ˜ç™½äº†å¤šç‰ˆæœ¬å’Œ row trx_id çš„æ¦‚å¿µåï¼Œæˆ‘ä»¬å†æ¥æƒ³ä¸€ä¸‹ï¼ŒInnoDB æ˜¯æ€ä¹ˆå®šä¹‰é‚£ä¸ªâ€œ100Gâ€çš„å¿«ç…§çš„ã€‚</p><p>æŒ‰ç…§å¯é‡å¤è¯»çš„å®šä¹‰ï¼Œä¸€ä¸ªäº‹åŠ¡å¯åŠ¨çš„æ—¶å€™ï¼Œèƒ½å¤Ÿçœ‹åˆ°æ‰€æœ‰å·²ç»æäº¤çš„äº‹åŠ¡ç»“æœã€‚ä½†æ˜¯ä¹‹åï¼Œè¿™ä¸ªäº‹åŠ¡æ‰§è¡ŒæœŸé—´ï¼Œå…¶ä»–äº‹åŠ¡çš„æ›´æ–°å¯¹å®ƒä¸å¯è§ã€‚</p><p>å› æ­¤ï¼Œä¸€ä¸ªäº‹åŠ¡åªéœ€è¦åœ¨å¯åŠ¨çš„æ—¶å€™å£°æ˜è¯´ï¼Œâ€œä»¥æˆ‘å¯åŠ¨çš„æ—¶åˆ»ä¸ºå‡†ï¼Œå¦‚æœä¸€ä¸ªæ•°æ®ç‰ˆæœ¬æ˜¯åœ¨æˆ‘å¯åŠ¨ä¹‹å‰ç”Ÿæˆçš„ï¼Œå°±è®¤ï¼›å¦‚æœæ˜¯æˆ‘å¯åŠ¨ä»¥åæ‰ç”Ÿæˆçš„ï¼Œæˆ‘å°±ä¸è®¤ï¼Œæˆ‘å¿…é¡»è¦æ‰¾åˆ°å®ƒçš„ä¸Šä¸€ä¸ªç‰ˆæœ¬â€ã€‚</p><p>å½“ç„¶ï¼Œå¦‚æœâ€œä¸Šä¸€ä¸ªç‰ˆæœ¬â€ä¹Ÿä¸å¯è§ï¼Œé‚£å°±å¾—ç»§ç»­å¾€å‰æ‰¾ã€‚è¿˜æœ‰ï¼Œå¦‚æœæ˜¯è¿™ä¸ªäº‹åŠ¡è‡ªå·±æ›´æ–°çš„æ•°æ®ï¼Œå®ƒè‡ªå·±è¿˜æ˜¯è¦è®¤çš„ã€‚</p><p>åœ¨å®ç°ä¸Šï¼Œ InnoDB ä¸ºæ¯ä¸ªäº‹åŠ¡æ„é€ äº†ä¸€ä¸ªæ•°ç»„ï¼Œç”¨æ¥ä¿å­˜è¿™ä¸ªäº‹åŠ¡å¯åŠ¨ç¬é—´ï¼Œå½“å‰æ­£åœ¨â€œæ´»è·ƒâ€çš„æ‰€æœ‰äº‹åŠ¡ IDã€‚â€œæ´»è·ƒâ€æŒ‡çš„å°±æ˜¯ï¼Œå¯åŠ¨äº†ä½†è¿˜æ²¡æäº¤ã€‚</p><p>æ•°ç»„é‡Œé¢äº‹åŠ¡ ID çš„æœ€å°å€¼è®°ä¸ºä½æ°´ä½ï¼Œå½“å‰ç³»ç»Ÿé‡Œé¢å·²ç»åˆ›å»ºè¿‡çš„äº‹åŠ¡ ID çš„æœ€å¤§å€¼åŠ  1 è®°ä¸ºé«˜æ°´ä½ã€‚</p><p>è¿™ä¸ªè§†å›¾æ•°ç»„å’Œé«˜æ°´ä½ï¼Œå°±ç»„æˆäº†å½“å‰äº‹åŠ¡çš„ä¸€è‡´æ€§è§†å›¾ï¼ˆread-viewï¼‰ã€‚</p><p>è€Œæ•°æ®ç‰ˆæœ¬çš„å¯è§æ€§è§„åˆ™ï¼Œå°±æ˜¯åŸºäºæ•°æ®çš„ row trx_id å’Œè¿™ä¸ªä¸€è‡´æ€§è§†å›¾çš„å¯¹æ¯”ç»“æœå¾—åˆ°çš„ã€‚</p><p>è¿™ä¸ªè§†å›¾æ•°ç»„æŠŠæ‰€æœ‰çš„ row trx_id åˆ†æˆäº†å‡ ç§ä¸åŒçš„æƒ…å†µã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/882114aaf55861832b4270d44507695e-1584367388624.png" alt="img"></p><p>å›¾ 3 æ•°æ®ç‰ˆæœ¬å¯è§æ€§è§„åˆ™</p><p>è¿™æ ·ï¼Œå¯¹äºå½“å‰äº‹åŠ¡çš„å¯åŠ¨ç¬é—´æ¥è¯´ï¼Œä¸€ä¸ªæ•°æ®ç‰ˆæœ¬çš„ row trx_idï¼Œæœ‰ä»¥ä¸‹å‡ ç§å¯èƒ½ï¼š</p><ol><li>å¦‚æœè½åœ¨ç»¿è‰²éƒ¨åˆ†ï¼Œè¡¨ç¤ºè¿™ä¸ªç‰ˆæœ¬æ˜¯å·²æäº¤çš„äº‹åŠ¡æˆ–è€…æ˜¯å½“å‰äº‹åŠ¡è‡ªå·±ç”Ÿæˆçš„ï¼Œè¿™ä¸ªæ•°æ®æ˜¯å¯è§çš„ï¼›</li><li>å¦‚æœè½åœ¨çº¢è‰²éƒ¨åˆ†ï¼Œè¡¨ç¤ºè¿™ä¸ªç‰ˆæœ¬æ˜¯ç”±å°†æ¥å¯åŠ¨çš„äº‹åŠ¡ç”Ÿæˆçš„ï¼Œæ˜¯è‚¯å®šä¸å¯è§çš„ï¼›</li><li>å¦‚æœè½åœ¨é»„è‰²éƒ¨åˆ†ï¼Œé‚£å°±åŒ…æ‹¬ä¸¤ç§æƒ…å†µ a. è‹¥ row trx_id åœ¨æ•°ç»„ä¸­ï¼Œè¡¨ç¤ºè¿™ä¸ªç‰ˆæœ¬æ˜¯ç”±è¿˜æ²¡æäº¤çš„äº‹åŠ¡ç”Ÿæˆçš„ï¼Œä¸å¯è§ï¼› b. è‹¥ row trx_id ä¸åœ¨æ•°ç»„ä¸­ï¼Œè¡¨ç¤ºè¿™ä¸ªç‰ˆæœ¬æ˜¯å·²ç»æäº¤äº†çš„äº‹åŠ¡ç”Ÿæˆçš„ï¼Œå¯è§ã€‚</li></ol><p>æ¯”å¦‚ï¼Œå¯¹äºå›¾ 2 ä¸­çš„æ•°æ®æ¥è¯´ï¼Œå¦‚æœæœ‰ä¸€ä¸ªäº‹åŠ¡ï¼Œå®ƒçš„ä½æ°´ä½æ˜¯ 18ï¼Œé‚£ä¹ˆå½“å®ƒè®¿é—®è¿™ä¸€è¡Œæ•°æ®æ—¶ï¼Œå°±ä¼šä» V4 é€šè¿‡ U3 è®¡ç®—å‡º V3ï¼Œæ‰€ä»¥åœ¨å®ƒçœ‹æ¥ï¼Œè¿™ä¸€è¡Œçš„å€¼æ˜¯ 11ã€‚</p><p>ä½ çœ‹ï¼Œæœ‰äº†è¿™ä¸ªå£°æ˜åï¼Œç³»ç»Ÿé‡Œé¢éšåå‘ç”Ÿçš„æ›´æ–°ï¼Œæ˜¯ä¸æ˜¯å°±è·Ÿè¿™ä¸ªäº‹åŠ¡çœ‹åˆ°çš„å†…å®¹æ— å…³äº†å‘¢ï¼Ÿå› ä¸ºä¹‹åçš„æ›´æ–°ï¼Œç”Ÿæˆçš„ç‰ˆæœ¬ä¸€å®šå±äºä¸Šé¢çš„ 2 æˆ–è€… 3(a) çš„æƒ…å†µï¼Œè€Œå¯¹å®ƒæ¥è¯´ï¼Œè¿™äº›æ–°çš„æ•°æ®ç‰ˆæœ¬æ˜¯ä¸å­˜åœ¨çš„ï¼Œæ‰€ä»¥è¿™ä¸ªäº‹åŠ¡çš„å¿«ç…§ï¼Œå°±æ˜¯â€œé™æ€â€çš„äº†ã€‚</p><p>æ‰€ä»¥ä½ ç°åœ¨çŸ¥é“äº†ï¼Œ<strong>InnoDB åˆ©ç”¨äº†â€œæ‰€æœ‰æ•°æ®éƒ½æœ‰å¤šä¸ªç‰ˆæœ¬â€çš„è¿™ä¸ªç‰¹æ€§ï¼Œå®ç°äº†â€œç§’çº§åˆ›å»ºå¿«ç…§â€çš„èƒ½åŠ›ã€‚</strong></p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç»§ç»­çœ‹ä¸€ä¸‹å›¾ 1 ä¸­çš„ä¸‰ä¸ªäº‹åŠ¡ï¼Œåˆ†æä¸‹äº‹åŠ¡ A çš„è¯­å¥è¿”å›çš„ç»“æœï¼Œä¸ºä»€ä¹ˆæ˜¯ k=1ã€‚</p><p>è¿™é‡Œï¼Œæˆ‘ä»¬ä¸å¦¨åšå¦‚ä¸‹å‡è®¾ï¼š</p><ol><li>äº‹åŠ¡ A å¼€å§‹å‰ï¼Œç³»ç»Ÿé‡Œé¢åªæœ‰ä¸€ä¸ªæ´»è·ƒäº‹åŠ¡ ID æ˜¯ 99ï¼›</li><li>äº‹åŠ¡ Aã€Bã€C çš„ç‰ˆæœ¬å·åˆ†åˆ«æ˜¯ 100ã€101ã€102ï¼Œä¸”å½“å‰ç³»ç»Ÿé‡Œåªæœ‰è¿™å››ä¸ªäº‹åŠ¡ï¼›</li><li>ä¸‰ä¸ªäº‹åŠ¡å¼€å§‹å‰ï¼Œ(1,1ï¼‰è¿™ä¸€è¡Œæ•°æ®çš„ row trx_id æ˜¯ 90ã€‚</li></ol><p>è¿™æ ·ï¼Œäº‹åŠ¡ A çš„è§†å›¾æ•°ç»„å°±æ˜¯ [99,100], äº‹åŠ¡ B çš„è§†å›¾æ•°ç»„æ˜¯ [99,100,101], äº‹åŠ¡ C çš„è§†å›¾æ•°ç»„æ˜¯ [99,100,101,102]ã€‚</p><p>ä¸ºäº†ç®€åŒ–åˆ†æï¼Œæˆ‘å…ˆæŠŠå…¶ä»–å¹²æ‰°è¯­å¥å»æ‰ï¼Œåªç”»å‡ºè·Ÿäº‹åŠ¡ A æŸ¥è¯¢é€»è¾‘æœ‰å…³çš„æ“ä½œï¼š</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/9416c310e406519b7460437cb0c5c149-1584367388631.png" alt="img"></p><p>å›¾ 4 äº‹åŠ¡ A æŸ¥è¯¢æ•°æ®é€»è¾‘å›¾</p><p>ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œç¬¬ä¸€ä¸ªæœ‰æ•ˆæ›´æ–°æ˜¯äº‹åŠ¡ Cï¼ŒæŠŠæ•°æ®ä» (1,1) æ”¹æˆäº† (1,2)ã€‚è¿™æ—¶å€™ï¼Œè¿™ä¸ªæ•°æ®çš„æœ€æ–°ç‰ˆæœ¬çš„ row trx_id æ˜¯ 102ï¼Œè€Œ 90 è¿™ä¸ªç‰ˆæœ¬å·²ç»æˆä¸ºäº†å†å²ç‰ˆæœ¬ã€‚</p><p>ç¬¬äºŒä¸ªæœ‰æ•ˆæ›´æ–°æ˜¯äº‹åŠ¡ Bï¼ŒæŠŠæ•°æ®ä» (1,2) æ”¹æˆäº† (1,3)ã€‚è¿™æ—¶å€™ï¼Œè¿™ä¸ªæ•°æ®çš„æœ€æ–°ç‰ˆæœ¬ï¼ˆå³ row trx_idï¼‰æ˜¯ 101ï¼Œè€Œ 102 åˆæˆä¸ºäº†å†å²ç‰ˆæœ¬ã€‚</p><p>ä½ å¯èƒ½æ³¨æ„åˆ°äº†ï¼Œåœ¨äº‹åŠ¡ A æŸ¥è¯¢çš„æ—¶å€™ï¼Œå…¶å®äº‹åŠ¡ B è¿˜æ²¡æœ‰æäº¤ï¼Œä½†æ˜¯å®ƒç”Ÿæˆçš„ (1,3) è¿™ä¸ªç‰ˆæœ¬å·²ç»å˜æˆå½“å‰ç‰ˆæœ¬äº†ã€‚ä½†è¿™ä¸ªç‰ˆæœ¬å¯¹äº‹åŠ¡ A å¿…é¡»æ˜¯ä¸å¯è§çš„ï¼Œå¦åˆ™å°±å˜æˆè„è¯»äº†ã€‚</p><p>å¥½ï¼Œç°åœ¨äº‹åŠ¡ A è¦æ¥è¯»æ•°æ®äº†ï¼Œå®ƒçš„è§†å›¾æ•°ç»„æ˜¯ [99,100]ã€‚å½“ç„¶äº†ï¼Œè¯»æ•°æ®éƒ½æ˜¯ä»å½“å‰ç‰ˆæœ¬è¯»èµ·çš„ã€‚æ‰€ä»¥ï¼Œäº‹åŠ¡ A æŸ¥è¯¢è¯­å¥çš„è¯»æ•°æ®æµç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><ul><li>æ‰¾åˆ° (1,3) çš„æ—¶å€™ï¼Œåˆ¤æ–­å‡º row trx_id=101ï¼Œæ¯”é«˜æ°´ä½å¤§ï¼Œå¤„äºçº¢è‰²åŒºåŸŸï¼Œä¸å¯è§ï¼›</li><li>æ¥ç€ï¼Œæ‰¾åˆ°ä¸Šä¸€ä¸ªå†å²ç‰ˆæœ¬ï¼Œä¸€çœ‹ row trx_id=102ï¼Œæ¯”é«˜æ°´ä½å¤§ï¼Œå¤„äºçº¢è‰²åŒºåŸŸï¼Œä¸å¯è§ï¼›</li><li>å†å¾€å‰æ‰¾ï¼Œç»ˆäºæ‰¾åˆ°äº†ï¼ˆ1,1)ï¼Œå®ƒçš„ row trx_id=90ï¼Œæ¯”ä½æ°´ä½å°ï¼Œå¤„äºç»¿è‰²åŒºåŸŸï¼Œå¯è§ã€‚</li></ul><p>è¿™æ ·æ‰§è¡Œä¸‹æ¥ï¼Œè™½ç„¶æœŸé—´è¿™ä¸€è¡Œæ•°æ®è¢«ä¿®æ”¹è¿‡ï¼Œä½†æ˜¯äº‹åŠ¡ A ä¸è®ºåœ¨ä»€ä¹ˆæ—¶å€™æŸ¥è¯¢ï¼Œçœ‹åˆ°è¿™è¡Œæ•°æ®çš„ç»“æœéƒ½æ˜¯ä¸€è‡´çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ç§°ä¹‹ä¸ºä¸€è‡´æ€§è¯»ã€‚</p><p>è¿™ä¸ªåˆ¤æ–­è§„åˆ™æ˜¯ä»ä»£ç é€»è¾‘ç›´æ¥è½¬è¯‘è¿‡æ¥çš„ï¼Œä½†æ˜¯æ­£å¦‚ä½ æ‰€è§ï¼Œç”¨äºäººè‚‰åˆ†æå¯è§æ€§å¾ˆéº»çƒ¦ã€‚</p><p>æ‰€ä»¥ï¼Œæˆ‘æ¥ç»™ä½ ç¿»è¯‘ä¸€ä¸‹ã€‚ä¸€ä¸ªæ•°æ®ç‰ˆæœ¬ï¼Œå¯¹äºä¸€ä¸ªäº‹åŠ¡è§†å›¾æ¥è¯´ï¼Œé™¤äº†è‡ªå·±çš„æ›´æ–°æ€»æ˜¯å¯è§ä»¥å¤–ï¼Œæœ‰ä¸‰ç§æƒ…å†µï¼š</p><ol><li>ç‰ˆæœ¬æœªæäº¤ï¼Œä¸å¯è§ï¼›</li><li>ç‰ˆæœ¬å·²æäº¤ï¼Œä½†æ˜¯æ˜¯åœ¨è§†å›¾åˆ›å»ºåæäº¤çš„ï¼Œä¸å¯è§ï¼›</li><li>ç‰ˆæœ¬å·²æäº¤ï¼Œè€Œä¸”æ˜¯åœ¨è§†å›¾åˆ›å»ºå‰æäº¤çš„ï¼Œå¯è§ã€‚</li></ol><p>ç°åœ¨ï¼Œæˆ‘ä»¬ç”¨è¿™ä¸ªè§„åˆ™æ¥åˆ¤æ–­å›¾ 4 ä¸­çš„æŸ¥è¯¢ç»“æœï¼Œäº‹åŠ¡ A çš„æŸ¥è¯¢è¯­å¥çš„è§†å›¾æ•°ç»„æ˜¯åœ¨äº‹åŠ¡ A å¯åŠ¨çš„æ—¶å€™ç”Ÿæˆçš„ï¼Œè¿™æ—¶å€™ï¼š</p><ul><li>(1,3) è¿˜æ²¡æäº¤ï¼Œå±äºæƒ…å†µ 1ï¼Œä¸å¯è§ï¼›</li><li>(1,2) è™½ç„¶æäº¤äº†ï¼Œä½†æ˜¯æ˜¯åœ¨è§†å›¾æ•°ç»„åˆ›å»ºä¹‹åæäº¤çš„ï¼Œå±äºæƒ…å†µ 2ï¼Œä¸å¯è§ï¼›</li><li>(1,1) æ˜¯åœ¨è§†å›¾æ•°ç»„åˆ›å»ºä¹‹å‰æäº¤çš„ï¼Œå¯è§ã€‚</li></ul><p>ä½ çœ‹ï¼Œå»æ‰æ•°å­—å¯¹æ¯”åï¼Œåªç”¨æ—¶é—´å…ˆåé¡ºåºæ¥åˆ¤æ–­ï¼Œåˆ†æèµ·æ¥æ˜¯ä¸æ˜¯è½»æ¾å¤šäº†ã€‚æ‰€ä»¥ï¼Œåé¢æˆ‘ä»¬å°±éƒ½ç”¨è¿™ä¸ªè§„åˆ™æ¥åˆ†æã€‚</p><h4 id="æ›´æ–°é€»è¾‘" tabindex="-1"><a class="header-anchor" href="#æ›´æ–°é€»è¾‘" aria-hidden="true">#</a> æ›´æ–°é€»è¾‘</h4><p>ç»†å¿ƒçš„åŒå­¦å¯èƒ½æœ‰ç–‘é—®äº†ï¼š<strong>äº‹åŠ¡ B çš„ update è¯­å¥ï¼Œå¦‚æœæŒ‰ç…§ä¸€è‡´æ€§è¯»ï¼Œå¥½åƒç»“æœä¸å¯¹å“¦ï¼Ÿ</strong></p><p>ä½ çœ‹å›¾ 5 ä¸­ï¼Œäº‹åŠ¡ B çš„è§†å›¾æ•°ç»„æ˜¯å…ˆç”Ÿæˆçš„ï¼Œä¹‹åäº‹åŠ¡ C æ‰æäº¤ï¼Œä¸æ˜¯åº”è¯¥çœ‹ä¸è§ (1,2) å—ï¼Œæ€ä¹ˆèƒ½ç®—å‡º (1,3) æ¥ï¼Ÿ</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/86ad7e8abe7bf16505b97718d8ac149f-1584367388692.png" alt="img"></p><p>å›¾ 5 äº‹åŠ¡ B æ›´æ–°é€»è¾‘å›¾</p><p>æ˜¯çš„ï¼Œå¦‚æœäº‹åŠ¡ B åœ¨æ›´æ–°ä¹‹å‰æŸ¥è¯¢ä¸€æ¬¡æ•°æ®ï¼Œè¿™ä¸ªæŸ¥è¯¢è¿”å›çš„ k çš„å€¼ç¡®å®æ˜¯ 1ã€‚</p><p>ä½†æ˜¯ï¼Œå½“å®ƒè¦å»æ›´æ–°æ•°æ®çš„æ—¶å€™ï¼Œå°±ä¸èƒ½å†åœ¨å†å²ç‰ˆæœ¬ä¸Šæ›´æ–°äº†ï¼Œå¦åˆ™äº‹åŠ¡ C çš„æ›´æ–°å°±ä¸¢å¤±äº†ã€‚å› æ­¤ï¼Œäº‹åŠ¡ B æ­¤æ—¶çš„ set k=k+1 æ˜¯åœ¨ï¼ˆ1,2ï¼‰çš„åŸºç¡€ä¸Šè¿›è¡Œçš„æ“ä½œã€‚</p><p>æ‰€ä»¥ï¼Œè¿™é‡Œå°±ç”¨åˆ°äº†è¿™æ ·ä¸€æ¡è§„åˆ™ï¼š<strong>æ›´æ–°æ•°æ®éƒ½æ˜¯å…ˆè¯»åå†™çš„ï¼Œè€Œè¿™ä¸ªè¯»ï¼Œåªèƒ½è¯»å½“å‰çš„å€¼ï¼Œç§°ä¸ºâ€œå½“å‰è¯»â€ï¼ˆcurrent readï¼‰ã€‚</strong></p><p>å› æ­¤ï¼Œåœ¨æ›´æ–°çš„æ—¶å€™ï¼Œå½“å‰è¯»æ‹¿åˆ°çš„æ•°æ®æ˜¯ (1,2)ï¼Œæ›´æ–°åç”Ÿæˆäº†æ–°ç‰ˆæœ¬çš„æ•°æ® (1,3)ï¼Œè¿™ä¸ªæ–°ç‰ˆæœ¬çš„ row trx_id æ˜¯ 101ã€‚</p><p>æ‰€ä»¥ï¼Œåœ¨æ‰§è¡Œäº‹åŠ¡ B æŸ¥è¯¢è¯­å¥çš„æ—¶å€™ï¼Œä¸€çœ‹è‡ªå·±çš„ç‰ˆæœ¬å·æ˜¯ 101ï¼Œæœ€æ–°æ•°æ®çš„ç‰ˆæœ¬å·ä¹Ÿæ˜¯ 101ï¼Œæ˜¯è‡ªå·±çš„æ›´æ–°ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œæ‰€ä»¥æŸ¥è¯¢å¾—åˆ°çš„ k çš„å€¼æ˜¯ 3ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬æåˆ°äº†ä¸€ä¸ªæ¦‚å¿µï¼Œå«ä½œå½“å‰è¯»ã€‚å…¶å®ï¼Œé™¤äº† update è¯­å¥å¤–ï¼Œselect è¯­å¥å¦‚æœåŠ é”ï¼Œä¹Ÿæ˜¯å½“å‰è¯»ã€‚</p><p>æ‰€ä»¥ï¼Œå¦‚æœæŠŠäº‹åŠ¡ A çš„æŸ¥è¯¢è¯­å¥ select * from t where id=1 ä¿®æ”¹ä¸€ä¸‹ï¼ŒåŠ ä¸Š lock in share mode æˆ– for updateï¼Œä¹Ÿéƒ½å¯ä»¥è¯»åˆ°ç‰ˆæœ¬å·æ˜¯ 101 çš„æ•°æ®ï¼Œè¿”å›çš„ k çš„å€¼æ˜¯ 3ã€‚ä¸‹é¢è¿™ä¸¤ä¸ª select è¯­å¥ï¼Œå°±æ˜¯åˆ†åˆ«åŠ äº†è¯»é”ï¼ˆS é”ï¼Œå…±äº«é”ï¼‰å’Œå†™é”ï¼ˆX é”ï¼Œæ’ä»–é”ï¼‰ã€‚</p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> k <span class="token keyword">from</span> t <span class="token keyword">where</span> <span class="token class-name">id</span><span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">lock</span> <span class="token keyword">in</span> <span class="token class-name">share</span> mode<span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> k <span class="token keyword">from</span> t <span class="token keyword">where</span> <span class="token class-name">id</span><span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">for</span> update<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>å†å¾€å‰ä¸€æ­¥ï¼Œå‡è®¾äº‹åŠ¡ C ä¸æ˜¯é©¬ä¸Šæäº¤çš„ï¼Œè€Œæ˜¯å˜æˆäº†ä¸‹é¢çš„äº‹åŠ¡ Câ€™ï¼Œä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿ</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/cda2a0d7decb61e59dddc83ac51efb6e-1584367388922.png" alt="img"></p><p>å›¾ 6 äº‹åŠ¡ Aã€Bã€C&#39;çš„æ‰§è¡Œæµç¨‹</p><p>äº‹åŠ¡ Câ€™çš„ä¸åŒæ˜¯ï¼Œæ›´æ–°åå¹¶æ²¡æœ‰é©¬ä¸Šæäº¤ï¼Œåœ¨å®ƒæäº¤å‰ï¼Œäº‹åŠ¡ B çš„æ›´æ–°è¯­å¥å…ˆå‘èµ·äº†ã€‚å‰é¢è¯´è¿‡äº†ï¼Œè™½ç„¶äº‹åŠ¡ Câ€™è¿˜æ²¡æäº¤ï¼Œä½†æ˜¯ (1,2) è¿™ä¸ªç‰ˆæœ¬ä¹Ÿå·²ç»ç”Ÿæˆäº†ï¼Œå¹¶ä¸”æ˜¯å½“å‰çš„æœ€æ–°ç‰ˆæœ¬ã€‚é‚£ä¹ˆï¼Œäº‹åŠ¡ B çš„æ›´æ–°è¯­å¥ä¼šæ€ä¹ˆå¤„ç†å‘¢ï¼Ÿ</p><p>è¿™æ—¶å€™ï¼Œæˆ‘ä»¬åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­æåˆ°çš„â€œä¸¤é˜¶æ®µé”åè®®â€å°±è¦ä¸Šåœºäº†ã€‚äº‹åŠ¡ Câ€™æ²¡æäº¤ï¼Œä¹Ÿå°±æ˜¯è¯´ (1,2) è¿™ä¸ªç‰ˆæœ¬ä¸Šçš„å†™é”è¿˜æ²¡é‡Šæ”¾ã€‚è€Œäº‹åŠ¡ B æ˜¯å½“å‰è¯»ï¼Œå¿…é¡»è¦è¯»æœ€æ–°ç‰ˆæœ¬ï¼Œè€Œä¸”å¿…é¡»åŠ é”ï¼Œå› æ­¤å°±è¢«é”ä½äº†ï¼Œå¿…é¡»ç­‰åˆ°äº‹åŠ¡ Câ€™é‡Šæ”¾è¿™ä¸ªé”ï¼Œæ‰èƒ½ç»§ç»­å®ƒçš„å½“å‰è¯»ã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/540967ea905e8b63630e496786d84c92-1584367388924.png" alt="img"></p><p>å›¾ 7 äº‹åŠ¡ B æ›´æ–°é€»è¾‘å›¾ï¼ˆé…åˆäº‹åŠ¡ C&#39;ï¼‰</p><p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬æŠŠä¸€è‡´æ€§è¯»ã€å½“å‰è¯»å’Œè¡Œé”å°±ä¸²èµ·æ¥äº†ã€‚</p><p>ç°åœ¨ï¼Œæˆ‘ä»¬å†å›åˆ°æ–‡ç« å¼€å¤´çš„é—®é¢˜ï¼š<strong>äº‹åŠ¡çš„å¯é‡å¤è¯»çš„èƒ½åŠ›æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ</strong></p><p>å¯é‡å¤è¯»çš„æ ¸å¿ƒå°±æ˜¯ä¸€è‡´æ€§è¯»ï¼ˆconsistent readï¼‰ï¼›è€Œäº‹åŠ¡æ›´æ–°æ•°æ®çš„æ—¶å€™ï¼Œåªèƒ½ç”¨å½“å‰è¯»ã€‚å¦‚æœå½“å‰çš„è®°å½•çš„è¡Œé”è¢«å…¶ä»–äº‹åŠ¡å ç”¨çš„è¯ï¼Œå°±éœ€è¦è¿›å…¥é”ç­‰å¾…ã€‚</p><p>è€Œè¯»æäº¤çš„é€»è¾‘å’Œå¯é‡å¤è¯»çš„é€»è¾‘ç±»ä¼¼ï¼Œå®ƒä»¬æœ€ä¸»è¦çš„åŒºåˆ«æ˜¯ï¼š</p><ul><li>åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹ï¼Œåªéœ€è¦åœ¨äº‹åŠ¡å¼€å§‹çš„æ—¶å€™åˆ›å»ºä¸€è‡´æ€§è§†å›¾ï¼Œä¹‹åäº‹åŠ¡é‡Œçš„å…¶ä»–æŸ¥è¯¢éƒ½å…±ç”¨è¿™ä¸ªä¸€è‡´æ€§è§†å›¾ï¼›</li><li>åœ¨è¯»æäº¤éš”ç¦»çº§åˆ«ä¸‹ï¼Œæ¯ä¸€ä¸ªè¯­å¥æ‰§è¡Œå‰éƒ½ä¼šé‡æ–°ç®—å‡ºä¸€ä¸ªæ–°çš„è§†å›¾ã€‚</li></ul><p>é‚£ä¹ˆï¼Œæˆ‘ä»¬å†çœ‹ä¸€ä¸‹ï¼Œåœ¨è¯»æäº¤éš”ç¦»çº§åˆ«ä¸‹ï¼Œäº‹åŠ¡ A å’Œäº‹åŠ¡ B çš„æŸ¥è¯¢è¯­å¥æŸ¥åˆ°çš„ kï¼Œåˆ†åˆ«åº”è¯¥æ˜¯å¤šå°‘å‘¢ï¼Ÿ</p><p>è¿™é‡Œéœ€è¦è¯´æ˜ä¸€ä¸‹ï¼Œâ€œstart transaction with consistent snapshot; â€çš„æ„æ€æ˜¯ä»è¿™ä¸ªè¯­å¥å¼€å§‹ï¼Œåˆ›å»ºä¸€ä¸ªæŒç»­æ•´ä¸ªäº‹åŠ¡çš„ä¸€è‡´æ€§å¿«ç…§ã€‚æ‰€ä»¥ï¼Œåœ¨è¯»æäº¤éš”ç¦»çº§åˆ«ä¸‹ï¼Œè¿™ä¸ªç”¨æ³•å°±æ²¡æ„ä¹‰äº†ï¼Œç­‰æ•ˆäºæ™®é€šçš„ start transactionã€‚</p><p>ä¸‹é¢æ˜¯è¯»æäº¤æ—¶çš„çŠ¶æ€å›¾ï¼Œå¯ä»¥çœ‹åˆ°è¿™ä¸¤ä¸ªæŸ¥è¯¢è¯­å¥çš„åˆ›å»ºè§†å›¾æ•°ç»„çš„æ—¶æœºå‘ç”Ÿäº†å˜åŒ–ï¼Œå°±æ˜¯å›¾ä¸­çš„ read view æ¡†ã€‚ï¼ˆæ³¨æ„ï¼šè¿™é‡Œï¼Œæˆ‘ä»¬ç”¨çš„è¿˜æ˜¯äº‹åŠ¡ C çš„é€»è¾‘ç›´æ¥æäº¤ï¼Œè€Œä¸æ˜¯äº‹åŠ¡ Câ€™ï¼‰</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/ed4b8d03287df67ecca53b5b4830ee6e-1584367389025.png" alt="img"></p><p>å›¾ 8 è¯»æäº¤éš”ç¦»çº§åˆ«ä¸‹çš„äº‹åŠ¡çŠ¶æ€å›¾</p><p>è¿™æ—¶ï¼Œäº‹åŠ¡ A çš„æŸ¥è¯¢è¯­å¥çš„è§†å›¾æ•°ç»„æ˜¯åœ¨æ‰§è¡Œè¿™ä¸ªè¯­å¥çš„æ—¶å€™åˆ›å»ºçš„ï¼Œæ—¶åºä¸Š (1,2)ã€(1,3) çš„ç”Ÿæˆæ—¶é—´éƒ½åœ¨åˆ›å»ºè¿™ä¸ªè§†å›¾æ•°ç»„çš„æ—¶åˆ»ä¹‹å‰ã€‚ä½†æ˜¯ï¼Œåœ¨è¿™ä¸ªæ—¶åˆ»ï¼š</p><ul><li>(1,3) è¿˜æ²¡æäº¤ï¼Œå±äºæƒ…å†µ 1ï¼Œä¸å¯è§ï¼›</li><li>(1,2) æäº¤äº†ï¼Œå±äºæƒ…å†µ 3ï¼Œå¯è§ã€‚</li></ul><p>æ‰€ä»¥ï¼Œè¿™æ—¶å€™äº‹åŠ¡ A æŸ¥è¯¢è¯­å¥è¿”å›çš„æ˜¯ k=2ã€‚</p><p>æ˜¾ç„¶åœ°ï¼Œäº‹åŠ¡ B æŸ¥è¯¢ç»“æœ k=3ã€‚</p><h4 id="å°ç»“-7" tabindex="-1"><a class="header-anchor" href="#å°ç»“-7" aria-hidden="true">#</a> å°ç»“</h4><p>InnoDB çš„è¡Œæ•°æ®æœ‰å¤šä¸ªç‰ˆæœ¬ï¼Œæ¯ä¸ªæ•°æ®ç‰ˆæœ¬æœ‰è‡ªå·±çš„ row trx_idï¼Œæ¯ä¸ªäº‹åŠ¡æˆ–è€…è¯­å¥æœ‰è‡ªå·±çš„ä¸€è‡´æ€§è§†å›¾ã€‚æ™®é€šæŸ¥è¯¢è¯­å¥æ˜¯ä¸€è‡´æ€§è¯»ï¼Œä¸€è‡´æ€§è¯»ä¼šæ ¹æ® row trx_id å’Œä¸€è‡´æ€§è§†å›¾ç¡®å®šæ•°æ®ç‰ˆæœ¬çš„å¯è§æ€§ã€‚</p><ul><li>å¯¹äºå¯é‡å¤è¯»ï¼ŒæŸ¥è¯¢åªæ‰¿è®¤åœ¨äº‹åŠ¡å¯åŠ¨å‰å°±å·²ç»æäº¤å®Œæˆçš„æ•°æ®ï¼›</li><li>å¯¹äºè¯»æäº¤ï¼ŒæŸ¥è¯¢åªæ‰¿è®¤åœ¨è¯­å¥å¯åŠ¨å‰å°±å·²ç»æäº¤å®Œæˆçš„æ•°æ®ï¼›</li></ul><p>è€Œå½“å‰è¯»ï¼Œæ€»æ˜¯è¯»å–å·²ç»æäº¤å®Œæˆçš„æœ€æ–°ç‰ˆæœ¬ã€‚</p><p>ä½ ä¹Ÿå¯ä»¥æƒ³ä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆè¡¨ç»“æ„ä¸æ”¯æŒâ€œå¯é‡å¤è¯»â€ï¼Ÿè¿™æ˜¯å› ä¸ºè¡¨ç»“æ„æ²¡æœ‰å¯¹åº”çš„è¡Œæ•°æ®ï¼Œä¹Ÿæ²¡æœ‰ row trx_idï¼Œå› æ­¤åªèƒ½éµå¾ªå½“å‰è¯»çš„é€»è¾‘ã€‚</p><p>å½“ç„¶ï¼ŒMySQL 8.0 å·²ç»å¯ä»¥æŠŠè¡¨ç»“æ„æ”¾åœ¨ InnoDB å­—å…¸é‡Œäº†ï¼Œä¹Ÿè®¸ä»¥åä¼šæ”¯æŒè¡¨ç»“æ„çš„å¯é‡å¤è¯»ã€‚</p><p>åˆåˆ°æ€è€ƒé¢˜æ—¶é—´äº†ã€‚æˆ‘ç”¨ä¸‹é¢çš„è¡¨ç»“æ„å’Œåˆå§‹åŒ–è¯­å¥ä½œä¸ºè¯•éªŒç¯å¢ƒï¼Œäº‹åŠ¡éš”ç¦»çº§åˆ«æ˜¯å¯é‡å¤è¯»ã€‚ç°åœ¨ï¼Œæˆ‘è¦æŠŠæ‰€æœ‰â€œå­—æ®µ c å’Œ id å€¼ç›¸ç­‰çš„è¡Œâ€çš„ c å€¼æ¸…é›¶ï¼Œä½†æ˜¯å´å‘ç°äº†ä¸€ä¸ªâ€œè¯¡å¼‚â€çš„ã€æ”¹ä¸æ‰çš„æƒ…å†µã€‚è¯·ä½ æ„é€ å‡ºè¿™ç§æƒ…å†µï¼Œå¹¶è¯´æ˜å…¶åŸç†ã€‚</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>t<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>c<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> t<span class="token punctuation">(</span>id<span class="token punctuation">,</span> c<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/9b8fe7cf88c9ba40dc12e93e36c3060b-1584367389183.png" alt="img">å¤ç°å‡ºæ¥ä»¥åï¼Œè¯·ä½ å†æ€è€ƒä¸€ä¸‹ï¼Œåœ¨å®é™…çš„ä¸šåŠ¡å¼€å‘ä¸­æœ‰æ²¡æœ‰å¯èƒ½ç¢°åˆ°è¿™ç§æƒ…å†µï¼Ÿä½ çš„åº”ç”¨ä»£ç ä¼šä¸ä¼šæ‰è¿›è¿™ä¸ªâ€œå‘â€é‡Œï¼Œä½ åˆæ˜¯æ€ä¹ˆè§£å†³çš„å‘¢ï¼Ÿ</p><p>ä½ å¯ä»¥æŠŠä½ çš„æ€è€ƒå’Œè§‚ç‚¹å†™åœ¨ç•™è¨€åŒºé‡Œï¼Œæˆ‘ä¼šåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« çš„æœ«å°¾å’Œä½ è®¨è®ºè¿™ä¸ªé—®é¢˜ã€‚æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚</p><h4 id="ä¸ŠæœŸé—®é¢˜æ—¶é—´-4" tabindex="-1"><a class="header-anchor" href="#ä¸ŠæœŸé—®é¢˜æ—¶é—´-4" aria-hidden="true">#</a> ä¸ŠæœŸé—®é¢˜æ—¶é—´</h4><p>æˆ‘åœ¨ä¸Šä¸€ç¯‡æ–‡ç« æœ€åï¼Œç•™ç»™ä½ çš„é—®é¢˜æ˜¯ï¼šæ€ä¹ˆåˆ é™¤è¡¨çš„å‰ 10000 è¡Œã€‚æ¯”è¾ƒå¤šçš„ç•™è¨€éƒ½é€‰æ‹©äº†ç¬¬äºŒç§æ–¹å¼ï¼Œå³ï¼šåœ¨ä¸€ä¸ªè¿æ¥ä¸­å¾ªç¯æ‰§è¡Œ 20 æ¬¡ delete from T limit 500ã€‚</p><p>ç¡®å®æ˜¯è¿™æ ·çš„ï¼Œç¬¬äºŒç§æ–¹å¼æ˜¯ç›¸å¯¹è¾ƒå¥½çš„ã€‚</p><p>ç¬¬ä¸€ç§æ–¹å¼ï¼ˆå³ï¼šç›´æ¥æ‰§è¡Œ delete from T limit 10000ï¼‰é‡Œé¢ï¼Œå•ä¸ªè¯­å¥å ç”¨æ—¶é—´é•¿ï¼Œé”çš„æ—¶é—´ä¹Ÿæ¯”è¾ƒé•¿ï¼›è€Œä¸”å¤§äº‹åŠ¡è¿˜ä¼šå¯¼è‡´ä¸»ä»å»¶è¿Ÿã€‚</p><p>ç¬¬ä¸‰ç§æ–¹å¼ï¼ˆå³ï¼šåœ¨ 20 ä¸ªè¿æ¥ä¸­åŒæ—¶æ‰§è¡Œ delete from T limit 500ï¼‰ï¼Œä¼šäººä¸ºé€ æˆé”å†²çªã€‚</p><p>è¯„è®ºåŒºç•™è¨€ç‚¹èµæ¿ï¼š</p><blockquote><p>@Tony Du çš„è¯„è®ºï¼Œè¯¦ç»†è€Œä¸”å‡†ç¡®ã€‚ @KnightÂ²ÂºÂ¹â¸ æåˆ°äº†å¦‚æœå¯ä»¥åŠ ä¸Šç‰¹å®šæ¡ä»¶ï¼Œå°†è¿™ 10000 è¡Œå¤©ç„¶åˆ†å¼€ï¼Œå¯ä»¥è€ƒè™‘ç¬¬ä¸‰ç§ã€‚æ˜¯çš„ï¼Œå®é™…ä¸Šåœ¨æ“ä½œçš„æ—¶å€™æˆ‘ä¹Ÿå»ºè®®ä½ å°½é‡æ‹¿åˆ° ID å†åˆ é™¤ã€‚ @è’æ¼ ç”˜æ³‰ æäº†ä¸€ä¸ªä¸é”™çš„é—®é¢˜ï¼Œå¤§å®¶éœ€è¦åŒºåˆ†è¡Œé”ã€MDL é”å’Œè¡¨é”çš„åŒºåˆ«ã€‚å¯¹ InnoDB è¡¨æ›´æ–°ä¸€è¡Œï¼Œå¯èƒ½è¿‡äº† MDL å…³ï¼Œå´è¢«æŒ¡åœ¨è¡Œé”é˜¶æ®µã€‚</p></blockquote><h3 id="_09-æ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•-åº”è¯¥æ€ä¹ˆé€‰æ‹©" tabindex="-1"><a class="header-anchor" href="#_09-æ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•-åº”è¯¥æ€ä¹ˆé€‰æ‹©" aria-hidden="true">#</a> 09 æ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•ï¼Œåº”è¯¥æ€ä¹ˆé€‰æ‹©ï¼Ÿ</h3><p>ä»Šå¤©çš„æ­£æ–‡å¼€å§‹å‰ï¼Œæˆ‘è¦ç‰¹æ„æ„Ÿè°¢ä¸€ä¸‹è¯„è®ºåŒºå‡ ä½ç•™ä¸‹é«˜è´¨é‡ç•™è¨€çš„åŒå­¦ã€‚</p><p>ç”¨æˆ·åæ˜¯ @æŸã€äºº çš„åŒå­¦ï¼Œå¯¹æ–‡ç« çš„çŸ¥è¯†ç‚¹åšäº†æ¢³ç†ï¼Œç„¶åæäº†å…³äºäº‹åŠ¡å¯è§æ€§çš„é—®é¢˜ï¼Œå°±æ˜¯å…ˆå¯åŠ¨ä½†æ˜¯åæäº¤çš„äº‹åŠ¡ï¼Œå¯¹æ•°æ®å¯è§æ€§çš„å½±å“ã€‚@å¤æ—¥é›¨åŒå­¦ä¹Ÿæåˆ°äº†è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘åœ¨ç½®é¡¶è¯„è®ºä¸­å›å¤äº†ï¼Œä»Šå¤©çš„æ–‡ç« æœ«å°¾ä¹Ÿä¼šå†å±•å¼€è¯´æ˜ã€‚@Justin å’Œ @å€ªå¤§äººä¸¤ä½åŒå­¦æäº†ä¸¤ä¸ªå¥½é—®é¢˜ã€‚</p><p>å¯¹äºèƒ½å¤Ÿå¼•å‘æ›´æ·±ä¸€æ­¥æ€è€ƒçš„é—®é¢˜ï¼Œæˆ‘ä¼šåœ¨å›å¤çš„å†…å®¹ä¸­å†™ä¸Šâ€œå¥½é—®é¢˜â€ä¸‰ä¸ªå­—ï¼Œæ–¹ä¾¿ä½ æœç´¢ï¼Œä½ ä¹Ÿå¯ä»¥å»çœ‹çœ‹ä»–ä»¬çš„ç•™è¨€ã€‚</p><p>éå¸¸æ„Ÿè°¢å¤§å®¶å¾ˆç»†è‡´åœ°çœ‹æ–‡ç« ï¼Œå¹¶ä¸”ç•™ä¸‹äº†é‚£ä¹ˆå¤šå’Œå¾ˆé«˜è´¨é‡çš„ç•™è¨€ã€‚çŸ¥é“æ–‡ç« æœ‰ç»™å¤§å®¶å¸¦æ¥ä¸€äº›æ–°ç†è§£ï¼Œå¯¹æˆ‘æ¥è¯´æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é¼“åŠ±ã€‚åŒæ—¶ï¼Œä¹Ÿè®©å…¶ä»–è®¤çœŸçœ‹è¯„è®ºåŒºçš„åŒå­¦ï¼Œæœ‰æœºä¼šå‘ç°ä¸€äº›è‡ªå·±è¿˜æ²¡æœ‰æ„è¯†åˆ°çš„ã€ä½†å¯èƒ½è¿˜ä¸æ¸…æ™°çš„çŸ¥è¯†ç‚¹ï¼Œè¿™ä¹Ÿåœ¨æ€»ä½“ä¸Šæé«˜äº†æ•´ä¸ªä¸“æ çš„è´¨é‡ã€‚å†æ¬¡è°¢è°¢ä½ ä»¬ã€‚</p><p>å¥½äº†ï¼Œç°åœ¨å°±å›åˆ°æˆ‘ä»¬ä»Šå¤©çš„æ­£æ–‡å†…å®¹ã€‚</p><p>åœ¨å‰é¢çš„åŸºç¡€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ç»™ä½ ä»‹ç»è¿‡ç´¢å¼•çš„åŸºæœ¬æ¦‚å¿µï¼Œç›¸ä¿¡ä½ å·²ç»äº†è§£äº†å”¯ä¸€ç´¢å¼•å’Œæ™®é€šç´¢å¼•çš„åŒºåˆ«ã€‚ä»Šå¤©æˆ‘ä»¬å°±ç»§ç»­æ¥è°ˆè°ˆï¼Œåœ¨ä¸åŒçš„ä¸šåŠ¡åœºæ™¯ä¸‹ï¼Œåº”è¯¥é€‰æ‹©æ™®é€šç´¢å¼•ï¼Œè¿˜æ˜¯å”¯ä¸€ç´¢å¼•ï¼Ÿ</p><p>å‡è®¾ä½ åœ¨ç»´æŠ¤ä¸€ä¸ªå¸‚æ°‘ç³»ç»Ÿï¼Œæ¯ä¸ªäººéƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„èº«ä»½è¯å·ï¼Œè€Œä¸”ä¸šåŠ¡ä»£ç å·²ç»ä¿è¯äº†ä¸ä¼šå†™å…¥ä¸¤ä¸ªé‡å¤çš„èº«ä»½è¯å·ã€‚å¦‚æœå¸‚æ°‘ç³»ç»Ÿéœ€è¦æŒ‰ç…§èº«ä»½è¯å·æŸ¥å§“åï¼Œå°±ä¼šæ‰§è¡Œç±»ä¼¼è¿™æ ·çš„ SQL è¯­å¥ï¼š</p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">select</span> name <span class="token keyword">from</span> CUser <span class="token keyword">where</span> <span class="token class-name">id_card</span> <span class="token operator">=</span> &#39;xxxxxxxyyyyyyzzzzz&#39;<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æ‰€ä»¥ï¼Œä½ ä¸€å®šä¼šè€ƒè™‘åœ¨ id_card å­—æ®µä¸Šå»ºç´¢å¼•ã€‚</p><p>ç”±äºèº«ä»½è¯å·å­—æ®µæ¯”è¾ƒå¤§ï¼Œæˆ‘ä¸å»ºè®®ä½ æŠŠèº«ä»½è¯å·å½“åšä¸»é”®ï¼Œé‚£ä¹ˆç°åœ¨ä½ æœ‰ä¸¤ä¸ªé€‰æ‹©ï¼Œè¦ä¹ˆç»™ id_card å­—æ®µåˆ›å»ºå”¯ä¸€ç´¢å¼•ï¼Œè¦ä¹ˆåˆ›å»ºä¸€ä¸ªæ™®é€šç´¢å¼•ã€‚å¦‚æœä¸šåŠ¡ä»£ç å·²ç»ä¿è¯äº†ä¸ä¼šå†™å…¥é‡å¤çš„èº«ä»½è¯å·ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªé€‰æ‹©é€»è¾‘ä¸Šéƒ½æ˜¯æ­£ç¡®çš„ã€‚</p><p>ç°åœ¨æˆ‘è¦é—®ä½ çš„æ˜¯ï¼Œä»æ€§èƒ½çš„è§’åº¦è€ƒè™‘ï¼Œä½ é€‰æ‹©å”¯ä¸€ç´¢å¼•è¿˜æ˜¯æ™®é€šç´¢å¼•å‘¢ï¼Ÿé€‰æ‹©çš„ä¾æ®æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><p>ç®€å•èµ·è§ï¼Œæˆ‘ä»¬è¿˜æ˜¯ç”¨ç¬¬ 4 ç¯‡æ–‡ç« [ã€Šæ·±å…¥æµ…å‡ºç´¢å¼•ï¼ˆä¸Šï¼‰ã€‹]ä¸­çš„ä¾‹å­æ¥è¯´æ˜ï¼Œå‡è®¾å­—æ®µ k ä¸Šçš„å€¼éƒ½ä¸é‡å¤ã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/1ed9536031d6698570ea175a7b7f9a46-1584367389192.png" alt="img"></p><p>å›¾ 1 InnoDB çš„ç´¢å¼•ç»„ç»‡ç»“æ„</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±ä»è¿™ä¸¤ç§ç´¢å¼•å¯¹æŸ¥è¯¢è¯­å¥å’Œæ›´æ–°è¯­å¥çš„æ€§èƒ½å½±å“æ¥è¿›è¡Œåˆ†æã€‚</p><h4 id="æŸ¥è¯¢è¿‡ç¨‹" tabindex="-1"><a class="header-anchor" href="#æŸ¥è¯¢è¿‡ç¨‹" aria-hidden="true">#</a> æŸ¥è¯¢è¿‡ç¨‹</h4><p>å‡è®¾ï¼Œæ‰§è¡ŒæŸ¥è¯¢çš„è¯­å¥æ˜¯ select id from T where k=5ã€‚è¿™ä¸ªæŸ¥è¯¢è¯­å¥åœ¨ç´¢å¼•æ ‘ä¸ŠæŸ¥æ‰¾çš„è¿‡ç¨‹ï¼Œå…ˆæ˜¯é€šè¿‡ B+ æ ‘ä»æ ‘æ ¹å¼€å§‹ï¼ŒæŒ‰å±‚æœç´¢åˆ°å¶å­èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯å›¾ä¸­å³ä¸‹è§’çš„è¿™ä¸ªæ•°æ®é¡µï¼Œç„¶åå¯ä»¥è®¤ä¸ºæ•°æ®é¡µå†…éƒ¨é€šè¿‡äºŒåˆ†æ³•æ¥å®šä½è®°å½•ã€‚</p><ul><li>å¯¹äºæ™®é€šç´¢å¼•æ¥è¯´ï¼ŒæŸ¥æ‰¾åˆ°æ»¡è¶³æ¡ä»¶çš„ç¬¬ä¸€ä¸ªè®°å½• (5,500) åï¼Œéœ€è¦æŸ¥æ‰¾ä¸‹ä¸€ä¸ªè®°å½•ï¼Œç›´åˆ°ç¢°åˆ°ç¬¬ä¸€ä¸ªä¸æ»¡è¶³ k=5 æ¡ä»¶çš„è®°å½•ã€‚</li><li>å¯¹äºå”¯ä¸€ç´¢å¼•æ¥è¯´ï¼Œç”±äºç´¢å¼•å®šä¹‰äº†å”¯ä¸€æ€§ï¼ŒæŸ¥æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„è®°å½•åï¼Œå°±ä¼šåœæ­¢ç»§ç»­æ£€ç´¢ã€‚</li></ul><p>é‚£ä¹ˆï¼Œè¿™ä¸ªä¸åŒå¸¦æ¥çš„æ€§èƒ½å·®è·ä¼šæœ‰å¤šå°‘å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ï¼Œå¾®ä¹å…¶å¾®ã€‚</p><p>ä½ çŸ¥é“çš„ï¼ŒInnoDB çš„æ•°æ®æ˜¯æŒ‰æ•°æ®é¡µä¸ºå•ä½æ¥è¯»å†™çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“éœ€è¦è¯»ä¸€æ¡è®°å½•çš„æ—¶å€™ï¼Œå¹¶ä¸æ˜¯å°†è¿™ä¸ªè®°å½•æœ¬èº«ä»ç£ç›˜è¯»å‡ºæ¥ï¼Œè€Œæ˜¯ä»¥é¡µä¸ºå•ä½ï¼Œå°†å…¶æ•´ä½“è¯»å…¥å†…å­˜ã€‚åœ¨ InnoDB ä¸­ï¼Œæ¯ä¸ªæ•°æ®é¡µçš„å¤§å°é»˜è®¤æ˜¯ 16KBã€‚</p><p>å› ä¸ºå¼•æ“æ˜¯æŒ‰é¡µè¯»å†™çš„ï¼Œæ‰€ä»¥è¯´ï¼Œå½“æ‰¾åˆ° k=5 çš„è®°å½•çš„æ—¶å€™ï¼Œå®ƒæ‰€åœ¨çš„æ•°æ®é¡µå°±éƒ½åœ¨å†…å­˜é‡Œäº†ã€‚é‚£ä¹ˆï¼Œå¯¹äºæ™®é€šç´¢å¼•æ¥è¯´ï¼Œè¦å¤šåšçš„é‚£ä¸€æ¬¡â€œæŸ¥æ‰¾å’Œåˆ¤æ–­ä¸‹ä¸€æ¡è®°å½•â€çš„æ“ä½œï¼Œå°±åªéœ€è¦ä¸€æ¬¡æŒ‡é’ˆå¯»æ‰¾å’Œä¸€æ¬¡è®¡ç®—ã€‚</p><p>å½“ç„¶ï¼Œå¦‚æœ k=5 è¿™ä¸ªè®°å½•åˆšå¥½æ˜¯è¿™ä¸ªæ•°æ®é¡µçš„æœ€åä¸€ä¸ªè®°å½•ï¼Œé‚£ä¹ˆè¦å–ä¸‹ä¸€ä¸ªè®°å½•ï¼Œå¿…é¡»è¯»å–ä¸‹ä¸€ä¸ªæ•°æ®é¡µï¼Œè¿™ä¸ªæ“ä½œä¼šç¨å¾®å¤æ‚ä¸€äº›ã€‚</p><p>ä½†æ˜¯ï¼Œæˆ‘ä»¬ä¹‹å‰è®¡ç®—è¿‡ï¼Œå¯¹äºæ•´å‹å­—æ®µï¼Œä¸€ä¸ªæ•°æ®é¡µå¯ä»¥æ”¾è¿‘åƒä¸ª keyï¼Œå› æ­¤å‡ºç°è¿™ç§æƒ…å†µçš„æ¦‚ç‡ä¼šå¾ˆä½ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬è®¡ç®—å¹³å‡æ€§èƒ½å·®å¼‚æ—¶ï¼Œä»å¯ä»¥è®¤ä¸ºè¿™ä¸ªæ“ä½œæˆæœ¬å¯¹äºç°åœ¨çš„ CPU æ¥è¯´å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚</p><h4 id="æ›´æ–°è¿‡ç¨‹" tabindex="-1"><a class="header-anchor" href="#æ›´æ–°è¿‡ç¨‹" aria-hidden="true">#</a> æ›´æ–°è¿‡ç¨‹</h4><p>ä¸ºäº†è¯´æ˜æ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•å¯¹æ›´æ–°è¯­å¥æ€§èƒ½çš„å½±å“è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘éœ€è¦å…ˆè·Ÿä½ ä»‹ç»ä¸€ä¸‹ change bufferã€‚</p><p>å½“éœ€è¦æ›´æ–°ä¸€ä¸ªæ•°æ®é¡µæ—¶ï¼Œå¦‚æœæ•°æ®é¡µåœ¨å†…å­˜ä¸­å°±ç›´æ¥æ›´æ–°ï¼Œè€Œå¦‚æœè¿™ä¸ªæ•°æ®é¡µè¿˜æ²¡æœ‰åœ¨å†…å­˜ä¸­çš„è¯ï¼Œåœ¨ä¸å½±å“æ•°æ®ä¸€è‡´æ€§çš„å‰æä¸‹ï¼ŒInooDB ä¼šå°†è¿™äº›æ›´æ–°æ“ä½œç¼“å­˜åœ¨ change buffer ä¸­ï¼Œè¿™æ ·å°±ä¸éœ€è¦ä»ç£ç›˜ä¸­è¯»å…¥è¿™ä¸ªæ•°æ®é¡µäº†ã€‚åœ¨ä¸‹æ¬¡æŸ¥è¯¢éœ€è¦è®¿é—®è¿™ä¸ªæ•°æ®é¡µçš„æ—¶å€™ï¼Œå°†æ•°æ®é¡µè¯»å…¥å†…å­˜ï¼Œç„¶åæ‰§è¡Œ change buffer ä¸­ä¸è¿™ä¸ªé¡µæœ‰å…³çš„æ“ä½œã€‚é€šè¿‡è¿™ç§æ–¹å¼å°±èƒ½ä¿è¯è¿™ä¸ªæ•°æ®é€»è¾‘çš„æ­£ç¡®æ€§ã€‚</p><p>éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œè™½ç„¶åå­—å«ä½œ change bufferï¼Œå®é™…ä¸Šå®ƒæ˜¯å¯ä»¥æŒä¹…åŒ–çš„æ•°æ®ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œchange buffer åœ¨å†…å­˜ä¸­æœ‰æ‹·è´ï¼Œä¹Ÿä¼šè¢«å†™å…¥åˆ°ç£ç›˜ä¸Šã€‚</p><p>å°† change buffer ä¸­çš„æ“ä½œåº”ç”¨åˆ°åŸæ•°æ®é¡µï¼Œå¾—åˆ°æœ€æ–°ç»“æœçš„è¿‡ç¨‹ç§°ä¸º mergeã€‚é™¤äº†è®¿é—®è¿™ä¸ªæ•°æ®é¡µä¼šè§¦å‘ merge å¤–ï¼Œç³»ç»Ÿæœ‰åå°çº¿ç¨‹ä¼šå®šæœŸ mergeã€‚åœ¨æ•°æ®åº“æ­£å¸¸å…³é—­ï¼ˆshutdownï¼‰çš„è¿‡ç¨‹ä¸­ï¼Œä¹Ÿä¼šæ‰§è¡Œ merge æ“ä½œã€‚</p><p>æ˜¾ç„¶ï¼Œå¦‚æœèƒ½å¤Ÿå°†æ›´æ–°æ“ä½œå…ˆè®°å½•åœ¨ change bufferï¼Œå‡å°‘è¯»ç£ç›˜ï¼Œè¯­å¥çš„æ‰§è¡Œé€Ÿåº¦ä¼šå¾—åˆ°æ˜æ˜¾çš„æå‡ã€‚è€Œä¸”ï¼Œæ•°æ®è¯»å…¥å†…å­˜æ˜¯éœ€è¦å ç”¨ buffer pool çš„ï¼Œæ‰€ä»¥è¿™ç§æ–¹å¼è¿˜èƒ½å¤Ÿé¿å…å ç”¨å†…å­˜ï¼Œæé«˜å†…å­˜åˆ©ç”¨ç‡ã€‚</p><p>é‚£ä¹ˆï¼Œ<strong>ä»€ä¹ˆæ¡ä»¶ä¸‹å¯ä»¥ä½¿ç”¨ change buffer å‘¢ï¼Ÿ</strong></p><p>å¯¹äºå”¯ä¸€ç´¢å¼•æ¥è¯´ï¼Œæ‰€æœ‰çš„æ›´æ–°æ“ä½œéƒ½è¦å…ˆåˆ¤æ–­è¿™ä¸ªæ“ä½œæ˜¯å¦è¿åå”¯ä¸€æ€§çº¦æŸã€‚æ¯”å¦‚ï¼Œè¦æ’å…¥ (4,400) è¿™ä¸ªè®°å½•ï¼Œå°±è¦å…ˆåˆ¤æ–­ç°åœ¨è¡¨ä¸­æ˜¯å¦å·²ç»å­˜åœ¨ k=4 çš„è®°å½•ï¼Œè€Œè¿™å¿…é¡»è¦å°†æ•°æ®é¡µè¯»å…¥å†…å­˜æ‰èƒ½åˆ¤æ–­ã€‚å¦‚æœéƒ½å·²ç»è¯»å…¥åˆ°å†…å­˜äº†ï¼Œé‚£ç›´æ¥æ›´æ–°å†…å­˜ä¼šæ›´å¿«ï¼Œå°±æ²¡å¿…è¦ä½¿ç”¨ change buffer äº†ã€‚</p><p>å› æ­¤ï¼Œå”¯ä¸€ç´¢å¼•çš„æ›´æ–°å°±ä¸èƒ½ä½¿ç”¨ change bufferï¼Œå®é™…ä¸Šä¹Ÿåªæœ‰æ™®é€šç´¢å¼•å¯ä»¥ä½¿ç”¨ã€‚</p><p>change buffer ç”¨çš„æ˜¯ buffer pool é‡Œçš„å†…å­˜ï¼Œå› æ­¤ä¸èƒ½æ— é™å¢å¤§ã€‚change buffer çš„å¤§å°ï¼Œå¯ä»¥é€šè¿‡å‚æ•° innodb_change_buffer_max_size æ¥åŠ¨æ€è®¾ç½®ã€‚è¿™ä¸ªå‚æ•°è®¾ç½®ä¸º 50 çš„æ—¶å€™ï¼Œè¡¨ç¤º change buffer çš„å¤§å°æœ€å¤šåªèƒ½å ç”¨ buffer pool çš„ 50%ã€‚</p><p>ç°åœ¨ï¼Œä½ å·²ç»ç†è§£äº† change buffer çš„æœºåˆ¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬å†ä¸€èµ·æ¥çœ‹çœ‹<strong>å¦‚æœè¦åœ¨è¿™å¼ è¡¨ä¸­æ’å…¥ä¸€ä¸ªæ–°è®°å½• (4,400) çš„è¯ï¼ŒInnoDB çš„å¤„ç†æµç¨‹æ˜¯æ€æ ·çš„ã€‚</strong></p><p>ç¬¬ä¸€ç§æƒ…å†µæ˜¯ï¼Œ<strong>è¿™ä¸ªè®°å½•è¦æ›´æ–°çš„ç›®æ ‡é¡µåœ¨å†…å­˜ä¸­</strong>ã€‚è¿™æ—¶ï¼ŒInnoDB çš„å¤„ç†æµç¨‹å¦‚ä¸‹ï¼š</p><ul><li>å¯¹äºå”¯ä¸€ç´¢å¼•æ¥è¯´ï¼Œæ‰¾åˆ° 3 å’Œ 5 ä¹‹é—´çš„ä½ç½®ï¼Œåˆ¤æ–­åˆ°æ²¡æœ‰å†²çªï¼Œæ’å…¥è¿™ä¸ªå€¼ï¼Œè¯­å¥æ‰§è¡Œç»“æŸï¼›</li><li>å¯¹äºæ™®é€šç´¢å¼•æ¥è¯´ï¼Œæ‰¾åˆ° 3 å’Œ 5 ä¹‹é—´çš„ä½ç½®ï¼Œæ’å…¥è¿™ä¸ªå€¼ï¼Œè¯­å¥æ‰§è¡Œç»“æŸã€‚</li></ul><p>è¿™æ ·çœ‹æ¥ï¼Œæ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•å¯¹æ›´æ–°è¯­å¥æ€§èƒ½å½±å“çš„å·®åˆ«ï¼Œåªæ˜¯ä¸€ä¸ªåˆ¤æ–­ï¼Œåªä¼šè€—è´¹å¾®å°çš„ CPU æ—¶é—´ã€‚</p><p>ä½†ï¼Œè¿™ä¸æ˜¯æˆ‘ä»¬å…³æ³¨çš„é‡ç‚¹ã€‚</p><p>ç¬¬äºŒç§æƒ…å†µæ˜¯ï¼Œ<strong>è¿™ä¸ªè®°å½•è¦æ›´æ–°çš„ç›®æ ‡é¡µä¸åœ¨å†…å­˜ä¸­</strong>ã€‚è¿™æ—¶ï¼ŒInnoDB çš„å¤„ç†æµç¨‹å¦‚ä¸‹ï¼š</p><ul><li>å¯¹äºå”¯ä¸€ç´¢å¼•æ¥è¯´ï¼Œéœ€è¦å°†æ•°æ®é¡µè¯»å…¥å†…å­˜ï¼Œåˆ¤æ–­åˆ°æ²¡æœ‰å†²çªï¼Œæ’å…¥è¿™ä¸ªå€¼ï¼Œè¯­å¥æ‰§è¡Œç»“æŸï¼›</li><li>å¯¹äºæ™®é€šç´¢å¼•æ¥è¯´ï¼Œåˆ™æ˜¯å°†æ›´æ–°è®°å½•åœ¨ change bufferï¼Œè¯­å¥æ‰§è¡Œå°±ç»“æŸäº†ã€‚</li></ul><p>å°†æ•°æ®ä»ç£ç›˜è¯»å…¥å†…å­˜æ¶‰åŠéšæœº IO çš„è®¿é—®ï¼Œæ˜¯æ•°æ®åº“é‡Œé¢æˆæœ¬æœ€é«˜çš„æ“ä½œä¹‹ä¸€ã€‚change buffer å› ä¸ºå‡å°‘äº†éšæœºç£ç›˜è®¿é—®ï¼Œæ‰€ä»¥å¯¹æ›´æ–°æ€§èƒ½çš„æå‡æ˜¯ä¼šå¾ˆæ˜æ˜¾çš„ã€‚</p><p>ä¹‹å‰æˆ‘å°±ç¢°åˆ°è¿‡ä¸€ä»¶äº‹å„¿ï¼Œæœ‰ä¸ª DBA çš„åŒå­¦è·Ÿæˆ‘åé¦ˆè¯´ï¼Œä»–è´Ÿè´£çš„æŸä¸ªä¸šåŠ¡çš„åº“å†…å­˜å‘½ä¸­ç‡çªç„¶ä» 99% é™ä½åˆ°äº† 75%ï¼Œæ•´ä¸ªç³»ç»Ÿå¤„äºé˜»å¡çŠ¶æ€ï¼Œæ›´æ–°è¯­å¥å…¨éƒ¨å µä½ã€‚è€Œæ¢ç©¶å…¶åŸå› åï¼Œæˆ‘å‘ç°è¿™ä¸ªä¸šåŠ¡æœ‰å¤§é‡æ’å…¥æ•°æ®çš„æ“ä½œï¼Œè€Œä»–åœ¨å‰ä¸€å¤©æŠŠå…¶ä¸­çš„æŸä¸ªæ™®é€šç´¢å¼•æ”¹æˆäº†å”¯ä¸€ç´¢å¼•ã€‚</p><h4 id="change-buffer-çš„ä½¿ç”¨åœºæ™¯" tabindex="-1"><a class="header-anchor" href="#change-buffer-çš„ä½¿ç”¨åœºæ™¯" aria-hidden="true">#</a> change buffer çš„ä½¿ç”¨åœºæ™¯</h4><p>é€šè¿‡ä¸Šé¢çš„åˆ†æï¼Œä½ å·²ç»æ¸…æ¥šäº†ä½¿ç”¨ change buffer å¯¹æ›´æ–°è¿‡ç¨‹çš„åŠ é€Ÿä½œç”¨ï¼Œä¹Ÿæ¸…æ¥šäº† change buffer åªé™äºç”¨åœ¨æ™®é€šç´¢å¼•çš„åœºæ™¯ä¸‹ï¼Œè€Œä¸é€‚ç”¨äºå”¯ä¸€ç´¢å¼•ã€‚é‚£ä¹ˆï¼Œç°åœ¨æœ‰ä¸€ä¸ªé—®é¢˜å°±æ˜¯ï¼šæ™®é€šç´¢å¼•çš„æ‰€æœ‰åœºæ™¯ï¼Œä½¿ç”¨ change buffer éƒ½å¯ä»¥èµ·åˆ°åŠ é€Ÿä½œç”¨å—ï¼Ÿ</p><p>å› ä¸º merge çš„æ—¶å€™æ˜¯çœŸæ­£è¿›è¡Œæ•°æ®æ›´æ–°çš„æ—¶åˆ»ï¼Œè€Œ change buffer çš„ä¸»è¦ç›®çš„å°±æ˜¯å°†è®°å½•çš„å˜æ›´åŠ¨ä½œç¼“å­˜ä¸‹æ¥ï¼Œæ‰€ä»¥åœ¨ä¸€ä¸ªæ•°æ®é¡µåš merge ä¹‹å‰ï¼Œchange buffer è®°å½•çš„å˜æ›´è¶Šå¤šï¼ˆä¹Ÿå°±æ˜¯è¿™ä¸ªé¡µé¢ä¸Šè¦æ›´æ–°çš„æ¬¡æ•°è¶Šå¤šï¼‰ï¼Œæ”¶ç›Šå°±è¶Šå¤§ã€‚</p><p>å› æ­¤ï¼Œå¯¹äºå†™å¤šè¯»å°‘çš„ä¸šåŠ¡æ¥è¯´ï¼Œé¡µé¢åœ¨å†™å®Œä»¥åé©¬ä¸Šè¢«è®¿é—®åˆ°çš„æ¦‚ç‡æ¯”è¾ƒå°ï¼Œæ­¤æ—¶ change buffer çš„ä½¿ç”¨æ•ˆæœæœ€å¥½ã€‚è¿™ç§ä¸šåŠ¡æ¨¡å‹å¸¸è§çš„å°±æ˜¯è´¦å•ç±»ã€æ—¥å¿—ç±»çš„ç³»ç»Ÿã€‚</p><p>åè¿‡æ¥ï¼Œå‡è®¾ä¸€ä¸ªä¸šåŠ¡çš„æ›´æ–°æ¨¡å¼æ˜¯å†™å…¥ä¹‹åé©¬ä¸Šä¼šåšæŸ¥è¯¢ï¼Œé‚£ä¹ˆå³ä½¿æ»¡è¶³äº†æ¡ä»¶ï¼Œå°†æ›´æ–°å…ˆè®°å½•åœ¨ change bufferï¼Œä½†ä¹‹åç”±äºé©¬ä¸Šè¦è®¿é—®è¿™ä¸ªæ•°æ®é¡µï¼Œä¼šç«‹å³è§¦å‘ merge è¿‡ç¨‹ã€‚è¿™æ ·éšæœºè®¿é—® IO çš„æ¬¡æ•°ä¸ä¼šå‡å°‘ï¼Œåè€Œå¢åŠ äº† change buffer çš„ç»´æŠ¤ä»£ä»·ã€‚æ‰€ä»¥ï¼Œå¯¹äºè¿™ç§ä¸šåŠ¡æ¨¡å¼æ¥è¯´ï¼Œchange buffer åè€Œèµ·åˆ°äº†å‰¯ä½œç”¨ã€‚</p><h4 id="ç´¢å¼•é€‰æ‹©å’Œå®è·µ" tabindex="-1"><a class="header-anchor" href="#ç´¢å¼•é€‰æ‹©å’Œå®è·µ" aria-hidden="true">#</a> ç´¢å¼•é€‰æ‹©å’Œå®è·µ</h4><p>å›åˆ°æˆ‘ä»¬æ–‡ç« å¼€å¤´çš„é—®é¢˜ï¼Œæ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•åº”è¯¥æ€ä¹ˆé€‰æ‹©ã€‚å…¶å®ï¼Œè¿™ä¸¤ç±»ç´¢å¼•åœ¨æŸ¥è¯¢èƒ½åŠ›ä¸Šæ˜¯æ²¡å·®åˆ«çš„ï¼Œä¸»è¦è€ƒè™‘çš„æ˜¯å¯¹æ›´æ–°æ€§èƒ½çš„å½±å“ã€‚æ‰€ä»¥ï¼Œæˆ‘å»ºè®®ä½ å°½é‡é€‰æ‹©æ™®é€šç´¢å¼•ã€‚</p><p>å¦‚æœæ‰€æœ‰çš„æ›´æ–°åé¢ï¼Œéƒ½é©¬ä¸Šä¼´éšç€å¯¹è¿™ä¸ªè®°å½•çš„æŸ¥è¯¢ï¼Œé‚£ä¹ˆä½ åº”è¯¥å…³é—­ change bufferã€‚è€Œåœ¨å…¶ä»–æƒ…å†µä¸‹ï¼Œchange buffer éƒ½èƒ½æå‡æ›´æ–°æ€§èƒ½ã€‚</p><p>åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œä½ ä¼šå‘ç°ï¼Œæ™®é€šç´¢å¼•å’Œ change buffer çš„é…åˆä½¿ç”¨ï¼Œå¯¹äºæ•°æ®é‡å¤§çš„è¡¨çš„æ›´æ–°ä¼˜åŒ–è¿˜æ˜¯å¾ˆæ˜æ˜¾çš„ã€‚</p><p>ç‰¹åˆ«åœ°ï¼Œåœ¨ä½¿ç”¨æœºæ¢°ç¡¬ç›˜æ—¶ï¼Œchange buffer è¿™ä¸ªæœºåˆ¶çš„æ”¶æ•ˆæ˜¯éå¸¸æ˜¾è‘—çš„ã€‚æ‰€ä»¥ï¼Œå½“ä½ æœ‰ä¸€ä¸ªç±»ä¼¼â€œå†å²æ•°æ®â€çš„åº“ï¼Œå¹¶ä¸”å‡ºäºæˆæœ¬è€ƒè™‘ç”¨çš„æ˜¯æœºæ¢°ç¡¬ç›˜æ—¶ï¼Œé‚£ä½ åº”è¯¥ç‰¹åˆ«å…³æ³¨è¿™äº›è¡¨é‡Œçš„ç´¢å¼•ï¼Œå°½é‡ä½¿ç”¨æ™®é€šç´¢å¼•ï¼Œç„¶åæŠŠ change buffer å°½é‡å¼€å¤§ï¼Œä»¥ç¡®ä¿è¿™ä¸ªâ€œå†å²æ•°æ®â€è¡¨çš„æ•°æ®å†™å…¥é€Ÿåº¦ã€‚</p><p>change buffer å’Œ redo log</p><p>ç†è§£äº† change buffer çš„åŸç†ï¼Œä½ å¯èƒ½ä¼šè”æƒ³åˆ°æˆ‘åœ¨å‰é¢æ–‡ç« ä¸­å’Œä½ ä»‹ç»è¿‡çš„ redo log å’Œ WALã€‚</p><p>åœ¨å‰é¢æ–‡ç« çš„è¯„è®ºä¸­ï¼Œæˆ‘å‘ç°æœ‰åŒå­¦æ··æ·†äº† redo log å’Œ change bufferã€‚WAL æå‡æ€§èƒ½çš„æ ¸å¿ƒæœºåˆ¶ï¼Œä¹Ÿçš„ç¡®æ˜¯å°½é‡å‡å°‘éšæœºè¯»å†™ï¼Œè¿™ä¸¤ä¸ªæ¦‚å¿µç¡®å®å®¹æ˜“æ··æ·†ã€‚æ‰€ä»¥ï¼Œè¿™é‡Œæˆ‘æŠŠå®ƒä»¬æ”¾åˆ°äº†åŒä¸€ä¸ªæµç¨‹é‡Œæ¥è¯´æ˜ï¼Œä¾¿äºä½ åŒºåˆ†è¿™ä¸¤ä¸ªæ¦‚å¿µã€‚</p><blockquote><p>å¤‡æ³¨ï¼šè¿™é‡Œï¼Œä½ å¯ä»¥å†å›é¡¾ä¸‹ç¬¬ 2 ç¯‡æ–‡ç« [ã€Šæ—¥å¿—ç³»ç»Ÿï¼šä¸€æ¡ SQL æ›´æ–°è¯­å¥æ˜¯å¦‚ä½•æ‰§è¡Œçš„ï¼Ÿã€‹]ä¸­çš„ç›¸å…³å†…å®¹ã€‚</p></blockquote><p>ç°åœ¨ï¼Œæˆ‘ä»¬è¦åœ¨è¡¨ä¸Šæ‰§è¡Œè¿™ä¸ªæ’å…¥è¯­å¥ï¼š</p><div class="language-scss line-numbers-mode" data-ext="scss"><pre class="language-scss"><code>mysql&gt; insert into <span class="token function">t</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span>k<span class="token punctuation">)</span> <span class="token function">values</span><span class="token punctuation">(</span>id1<span class="token punctuation">,</span>k1<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span>id2<span class="token punctuation">,</span>k2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>è¿™é‡Œï¼Œæˆ‘ä»¬å‡è®¾å½“å‰ k ç´¢å¼•æ ‘çš„çŠ¶æ€ï¼ŒæŸ¥æ‰¾åˆ°ä½ç½®åï¼Œk1 æ‰€åœ¨çš„æ•°æ®é¡µåœ¨å†…å­˜ (InnoDB buffer pool) ä¸­ï¼Œk2 æ‰€åœ¨çš„æ•°æ®é¡µä¸åœ¨å†…å­˜ä¸­ã€‚å¦‚å›¾ 2 æ‰€ç¤ºæ˜¯å¸¦ change buffer çš„æ›´æ–°çŠ¶æ€å›¾ã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/980a2b786f0ea7adabef2e64fb4c4ca3-1584367389287.png" alt="img"></p><p>å›¾ 2 å¸¦ change buffer çš„æ›´æ–°è¿‡ç¨‹</p><p>åˆ†æè¿™æ¡æ›´æ–°è¯­å¥ï¼Œä½ ä¼šå‘ç°å®ƒæ¶‰åŠäº†å››ä¸ªéƒ¨åˆ†ï¼šå†…å­˜ã€redo logï¼ˆib_log_fileXï¼‰ã€ æ•°æ®è¡¨ç©ºé—´ï¼ˆt.ibdï¼‰ã€ç³»ç»Ÿè¡¨ç©ºé—´ï¼ˆibdata1ï¼‰ã€‚</p><p>è¿™æ¡æ›´æ–°è¯­å¥åšäº†å¦‚ä¸‹çš„æ“ä½œï¼ˆæŒ‰ç…§å›¾ä¸­çš„æ•°å­—é¡ºåºï¼‰ï¼š</p><ol><li>Page 1 åœ¨å†…å­˜ä¸­ï¼Œç›´æ¥æ›´æ–°å†…å­˜ï¼›</li><li>Page 2 æ²¡æœ‰åœ¨å†…å­˜ä¸­ï¼Œå°±åœ¨å†…å­˜çš„ change buffer åŒºåŸŸï¼Œè®°å½•ä¸‹â€œæˆ‘è¦å¾€ Page 2 æ’å…¥ä¸€è¡Œâ€è¿™ä¸ªä¿¡æ¯</li><li>å°†ä¸Šè¿°ä¸¤ä¸ªåŠ¨ä½œè®°å…¥ redo log ä¸­ï¼ˆå›¾ä¸­ 3 å’Œ 4ï¼‰ã€‚</li></ol><p>åšå®Œä¸Šé¢è¿™äº›ï¼Œäº‹åŠ¡å°±å¯ä»¥å®Œæˆäº†ã€‚æ‰€ä»¥ï¼Œä½ ä¼šçœ‹åˆ°ï¼Œæ‰§è¡Œè¿™æ¡æ›´æ–°è¯­å¥çš„æˆæœ¬å¾ˆä½ï¼Œå°±æ˜¯å†™äº†ä¸¤å¤„å†…å­˜ï¼Œç„¶åå†™äº†ä¸€å¤„ç£ç›˜ï¼ˆä¸¤æ¬¡æ“ä½œåˆåœ¨ä¸€èµ·å†™äº†ä¸€æ¬¡ç£ç›˜ï¼‰ï¼Œè€Œä¸”è¿˜æ˜¯é¡ºåºå†™çš„ã€‚</p><p>åŒæ—¶ï¼Œå›¾ä¸­çš„ä¸¤ä¸ªè™šçº¿ç®­å¤´ï¼Œæ˜¯åå°æ“ä½œï¼Œä¸å½±å“æ›´æ–°çš„å“åº”æ—¶é—´ã€‚</p><p>é‚£åœ¨è¿™ä¹‹åçš„è¯»è¯·æ±‚ï¼Œè¦æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿ</p><p>æ¯”å¦‚ï¼Œæˆ‘ä»¬ç°åœ¨è¦æ‰§è¡Œ select * from t where k in (k1, k2)ã€‚è¿™é‡Œï¼Œæˆ‘ç”»äº†è¿™ä¸¤ä¸ªè¯»è¯·æ±‚çš„æµç¨‹å›¾ã€‚</p><p>å¦‚æœè¯»è¯­å¥å‘ç”Ÿåœ¨æ›´æ–°è¯­å¥åä¸ä¹…ï¼Œå†…å­˜ä¸­çš„æ•°æ®éƒ½è¿˜åœ¨ï¼Œé‚£ä¹ˆæ­¤æ—¶çš„è¿™ä¸¤ä¸ªè¯»æ“ä½œå°±ä¸ç³»ç»Ÿè¡¨ç©ºé—´ï¼ˆibdata1ï¼‰å’Œ redo logï¼ˆib_log_fileXï¼‰æ— å…³äº†ã€‚æ‰€ä»¥ï¼Œæˆ‘åœ¨å›¾ä¸­å°±æ²¡ç”»å‡ºè¿™ä¸¤éƒ¨åˆ†ã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/6dc743577af1dbcbb8550bddbfc5f98e-1584367389446.png" alt="img"></p><p>å›¾ 3 å¸¦ change buffer çš„è¯»è¿‡ç¨‹</p><p>ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼š</p><ol><li>è¯» Page 1 çš„æ—¶å€™ï¼Œç›´æ¥ä»å†…å­˜è¿”å›ã€‚æœ‰å‡ ä½åŒå­¦åœ¨å‰é¢æ–‡ç« çš„è¯„è®ºä¸­é—®åˆ°ï¼ŒWAL ä¹‹åå¦‚æœè¯»æ•°æ®ï¼Œæ˜¯ä¸æ˜¯ä¸€å®šè¦è¯»ç›˜ï¼Œæ˜¯ä¸æ˜¯ä¸€å®šè¦ä» redo log é‡Œé¢æŠŠæ•°æ®æ›´æ–°ä»¥åæ‰å¯ä»¥è¿”å›ï¼Ÿå…¶å®æ˜¯ä¸ç”¨çš„ã€‚ä½ å¯ä»¥çœ‹ä¸€ä¸‹å›¾ 3 çš„è¿™ä¸ªçŠ¶æ€ï¼Œè™½ç„¶ç£ç›˜ä¸Šè¿˜æ˜¯ä¹‹å‰çš„æ•°æ®ï¼Œä½†æ˜¯è¿™é‡Œç›´æ¥ä»å†…å­˜è¿”å›ç»“æœï¼Œç»“æœæ˜¯æ­£ç¡®çš„ã€‚</li><li>è¦è¯» Page 2 çš„æ—¶å€™ï¼Œéœ€è¦æŠŠ Page 2 ä»ç£ç›˜è¯»å…¥å†…å­˜ä¸­ï¼Œç„¶ååº”ç”¨ change buffer é‡Œé¢çš„æ“ä½œæ—¥å¿—ï¼Œç”Ÿæˆä¸€ä¸ªæ­£ç¡®çš„ç‰ˆæœ¬å¹¶è¿”å›ç»“æœã€‚</li></ol><p>å¯ä»¥çœ‹åˆ°ï¼Œç›´åˆ°éœ€è¦è¯» Page 2 çš„æ—¶å€™ï¼Œè¿™ä¸ªæ•°æ®é¡µæ‰ä¼šè¢«è¯»å…¥å†…å­˜ã€‚</p><p>æ‰€ä»¥ï¼Œå¦‚æœè¦ç®€å•åœ°å¯¹æ¯”è¿™ä¸¤ä¸ªæœºåˆ¶åœ¨æå‡æ›´æ–°æ€§èƒ½ä¸Šçš„æ”¶ç›Šçš„è¯ï¼Œ<strong>redo log ä¸»è¦èŠ‚çœçš„æ˜¯éšæœºå†™ç£ç›˜çš„ IO æ¶ˆè€—ï¼ˆè½¬æˆé¡ºåºå†™ï¼‰ï¼Œè€Œ change buffer ä¸»è¦èŠ‚çœçš„åˆ™æ˜¯éšæœºè¯»ç£ç›˜çš„ IO æ¶ˆè€—ã€‚</strong></p><h4 id="å°ç»“-8" tabindex="-1"><a class="header-anchor" href="#å°ç»“-8" aria-hidden="true">#</a> å°ç»“</h4><p>ä»Šå¤©ï¼Œæˆ‘ä»æ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•çš„é€‰æ‹©å¼€å§‹ï¼Œå’Œä½ åˆ†äº«äº†æ•°æ®çš„æŸ¥è¯¢å’Œæ›´æ–°è¿‡ç¨‹ï¼Œç„¶åè¯´æ˜äº† change buffer çš„æœºåˆ¶ä»¥åŠåº”ç”¨åœºæ™¯ï¼Œæœ€åè®²åˆ°äº†ç´¢å¼•é€‰æ‹©çš„å®è·µã€‚</p><p>ç”±äºå”¯ä¸€ç´¢å¼•ç”¨ä¸ä¸Š change buffer çš„ä¼˜åŒ–æœºåˆ¶ï¼Œå› æ­¤å¦‚æœä¸šåŠ¡å¯ä»¥æ¥å—ï¼Œä»æ€§èƒ½è§’åº¦å‡ºå‘æˆ‘å»ºè®®ä½ ä¼˜å…ˆè€ƒè™‘éå”¯ä¸€ç´¢å¼•ã€‚</p><p>æœ€åï¼Œåˆåˆ°äº†æ€è€ƒé¢˜æ—¶é—´ã€‚</p><p>é€šè¿‡å›¾ 2 ä½ å¯ä»¥çœ‹åˆ°ï¼Œchange buffer ä¸€å¼€å§‹æ˜¯å†™å†…å­˜çš„ï¼Œé‚£ä¹ˆå¦‚æœè¿™ä¸ªæ—¶å€™æœºå™¨æ‰ç”µé‡å¯ï¼Œä¼šä¸ä¼šå¯¼è‡´ change buffer ä¸¢å¤±å‘¢ï¼Ÿchange buffer ä¸¢å¤±å¯ä¸æ˜¯å°äº‹å„¿ï¼Œå†ä»ç£ç›˜è¯»å…¥æ•°æ®å¯å°±æ²¡æœ‰äº† merge è¿‡ç¨‹ï¼Œå°±ç­‰äºæ˜¯æ•°æ®ä¸¢å¤±äº†ã€‚ä¼šä¸ä¼šå‡ºç°è¿™ç§æƒ…å†µå‘¢ï¼Ÿ</p><p>ä½ å¯ä»¥æŠŠä½ çš„æ€è€ƒå’Œè§‚ç‚¹å†™åœ¨ç•™è¨€åŒºé‡Œï¼Œæˆ‘ä¼šåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« çš„æœ«å°¾å’Œä½ è®¨è®ºè¿™ä¸ªé—®é¢˜ã€‚æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚</p><p><strong>è¡¥å……ï¼š</strong> è¯„è®ºåŒºå¤§å®¶å¯¹â€œæ˜¯å¦ä½¿ç”¨å”¯ä¸€ç´¢å¼•â€æœ‰æ¯”è¾ƒå¤šçš„è®¨è®ºï¼Œä¸»è¦æ˜¯çº ç»“åœ¨â€œä¸šåŠ¡å¯èƒ½æ— æ³•ç¡®ä¿â€çš„æƒ…å†µã€‚è¿™é‡Œï¼Œæˆ‘å†è¯´æ˜ä¸€ä¸‹ï¼š</p><ul><li>é¦–å…ˆï¼Œä¸šåŠ¡æ­£ç¡®æ€§ä¼˜å…ˆã€‚å’±ä»¬è¿™ç¯‡æ–‡ç« çš„å‰ææ˜¯â€œä¸šåŠ¡ä»£ç å·²ç»ä¿è¯ä¸ä¼šå†™å…¥é‡å¤æ•°æ®â€çš„æƒ…å†µä¸‹ï¼Œè®¨è®ºæ€§èƒ½é—®é¢˜ã€‚å¦‚æœä¸šåŠ¡ä¸èƒ½ä¿è¯ï¼Œæˆ–è€…ä¸šåŠ¡å°±æ˜¯è¦æ±‚æ•°æ®åº“æ¥åšçº¦æŸï¼Œé‚£ä¹ˆæ²¡å¾—é€‰ï¼Œå¿…é¡»åˆ›å»ºå”¯ä¸€ç´¢å¼•ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œæœ¬ç¯‡æ–‡ç« çš„æ„ä¹‰åœ¨äºï¼Œå¦‚æœç¢°ä¸Šäº†å¤§é‡æ’å…¥æ•°æ®æ…¢ã€å†…å­˜å‘½ä¸­ç‡ä½çš„æ—¶å€™ï¼Œå¯ä»¥ç»™ä½ å¤šæä¾›ä¸€ä¸ªæ’æŸ¥æ€è·¯ã€‚</li><li>ç„¶åï¼Œåœ¨ä¸€äº›â€œå½’æ¡£åº“â€çš„åœºæ™¯ï¼Œä½ æ˜¯å¯ä»¥è€ƒè™‘ä½¿ç”¨å”¯ä¸€ç´¢å¼•çš„ã€‚æ¯”å¦‚ï¼Œçº¿ä¸Šæ•°æ®åªéœ€è¦ä¿ç•™åŠå¹´ï¼Œç„¶åå†å²æ•°æ®ä¿å­˜åœ¨å½’æ¡£åº“ã€‚è¿™æ—¶å€™ï¼Œå½’æ¡£æ•°æ®å·²ç»æ˜¯ç¡®ä¿æ²¡æœ‰å”¯ä¸€é”®å†²çªäº†ã€‚è¦æé«˜å½’æ¡£æ•ˆç‡ï¼Œå¯ä»¥è€ƒè™‘æŠŠè¡¨é‡Œé¢çš„å”¯ä¸€ç´¢å¼•æ”¹æˆæ™®é€šç´¢å¼•ã€‚</li></ul><h4 id="ä¸ŠæœŸé—®é¢˜æ—¶é—´-5" tabindex="-1"><a class="header-anchor" href="#ä¸ŠæœŸé—®é¢˜æ—¶é—´-5" aria-hidden="true">#</a> ä¸ŠæœŸé—®é¢˜æ—¶é—´</h4><p>ä¸ŠæœŸçš„é—®é¢˜æ˜¯ï¼šå¦‚ä½•æ„é€ ä¸€ä¸ªâ€œæ•°æ®æ— æ³•ä¿®æ”¹â€çš„åœºæ™¯ã€‚è¯„è®ºåŒºé‡Œå·²ç»æœ‰ä¸å°‘åŒå­¦ç»™å‡ºäº†æ­£ç¡®ç­”æ¡ˆï¼Œè¿™é‡Œæˆ‘å†æè¿°ä¸€ä¸‹ã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/be7a4d8af04cdf93aaa11108933559ae-1584367389604.png" alt="img">è¿™æ ·ï¼Œsession A çœ‹åˆ°çš„å°±æ˜¯æˆ‘æˆªå›¾çš„æ•ˆæœäº†ã€‚</p><p>å…¶å®ï¼Œè¿˜æœ‰å¦å¤–ä¸€ç§åœºæ™¯ï¼ŒåŒå­¦ä»¬åœ¨ç•™è¨€åŒºéƒ½è¿˜æ²¡æœ‰æåˆ°ã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/e24a0689571337959138d787c408defa-1584367389607.png" alt="img"></p><p>è¿™ä¸ªæ“ä½œåºåˆ—è·‘å‡ºæ¥ï¼Œsession A çœ‹çš„å†…å®¹ä¹Ÿæ˜¯èƒ½å¤Ÿå¤ç°æˆ‘æˆªå›¾çš„æ•ˆæœçš„ã€‚è¿™ä¸ª session Bâ€™å¯åŠ¨çš„äº‹åŠ¡æ¯” A è¦æ—©ï¼Œå…¶å®æ˜¯ä¸ŠæœŸæˆ‘ä»¬æè¿°äº‹åŠ¡ç‰ˆæœ¬çš„å¯è§æ€§è§„åˆ™æ—¶ç•™çš„å½©è›‹ï¼Œå› ä¸ºè§„åˆ™é‡Œè¿˜æœ‰ä¸€ä¸ªâ€œæ´»è·ƒäº‹åŠ¡çš„åˆ¤æ–­â€ï¼Œæˆ‘æ˜¯å‡†å¤‡ç•™åˆ°è¿™é‡Œå†è¡¥å……çš„ã€‚</p><p>å½“æˆ‘è¯•å›¾åœ¨è¿™é‡Œè®²è¿°å®Œæ•´è§„åˆ™çš„æ—¶å€™ï¼Œå‘ç°ç¬¬ 8 ç¯‡æ–‡ç« [ã€Šäº‹åŠ¡åˆ°åº•æ˜¯éš”ç¦»çš„è¿˜æ˜¯ä¸éš”ç¦»çš„ï¼Ÿã€‹]ä¸­çš„è§£é‡Šå¼•å…¥äº†å¤ªå¤šçš„æ¦‚å¿µï¼Œä»¥è‡´äºåˆ†æèµ·æ¥éå¸¸å¤æ‚ã€‚</p><p>å› æ­¤ï¼Œæˆ‘é‡å†™äº†ç¬¬ 8 ç¯‡ï¼Œè¿™æ ·æˆ‘ä»¬äººå·¥å»åˆ¤æ–­å¯è§æ€§çš„æ—¶å€™ï¼Œæ‰ä¼šæ›´æ–¹ä¾¿ã€‚ã€çœ‹åˆ°è¿™é‡Œï¼Œæˆ‘å»ºè®®ä½ èƒ½å¤Ÿå†é‡æ–°æ‰“å¼€ç¬¬ 8 ç¯‡æ–‡ç« å¹¶è®¤çœŸå­¦ä¹ ä¸€æ¬¡ã€‚å¦‚æœå­¦ä¹ çš„è¿‡ç¨‹ä¸­ï¼Œæœ‰ä»»ä½•é—®é¢˜ï¼Œä¹Ÿæ¬¢è¿ä½ ç»™æˆ‘ç•™è¨€ã€‘</p><p>ç”¨æ–°çš„æ–¹å¼æ¥åˆ†æ session Bâ€™çš„æ›´æ–°ä¸ºä»€ä¹ˆå¯¹ session A ä¸å¯è§å°±æ˜¯ï¼šåœ¨ session A è§†å›¾æ•°ç»„åˆ›å»ºçš„ç¬é—´ï¼Œsession Bâ€™æ˜¯æ´»è·ƒçš„ï¼Œå±äºâ€œç‰ˆæœ¬æœªæäº¤ï¼Œä¸å¯è§â€è¿™ç§æƒ…å†µã€‚</p><p>ä¸šåŠ¡ä¸­å¦‚æœè¦ç»•è¿‡è¿™ç±»é—®é¢˜ï¼Œ@çº¦ä¹¦äºšæä¾›äº†ä¸€ä¸ªâ€œä¹è§‚é”â€çš„è§£æ³•ï¼Œå¤§å®¶å¯ä»¥å»ä¸Šä¸€ç¯‡çš„ç•™è¨€åŒºçœ‹ä¸€ä¸‹ã€‚</p><p>è¯„è®ºåŒºç•™è¨€ç‚¹èµæ¿ï¼š</p><blockquote><p>@æŸã€äººã€@å¤æ—¥é›¨ã€@å‘¨å·˜ã€@æé‡‘åˆš ç­‰åŒå­¦æäº†ä¸€ä¸ªå¾ˆå¥½çš„é—®é¢˜ï¼Œå°±æ˜¯æˆ‘ä»¬ä»Šå¤©ç­”æ¡ˆçš„ session Bâ€™ çš„æƒ…å†µï¼› @justin æåˆ°äº†æäº¤å’Œæœªæäº¤ç‰ˆæœ¬çš„åŒºåˆ«å¯¹å¾…ï¼Œ@å€ªå¤§äºº æåˆ°äº†è¯»æäº¤å’Œå½“å‰è¯»çš„åŒºåˆ«ï¼Œéƒ½æ˜¯ç»è¿‡äº†æ€è€ƒåæå‡ºçš„å¥½é—®é¢˜ï¼Œå¤§å®¶å¯ä»¥å»ç•™è¨€åŒºçœ‹çœ‹ã€‚</p></blockquote><h3 id="_10-mysqlä¸ºä»€ä¹ˆæœ‰æ—¶å€™ä¼šé€‰é”™ç´¢å¼•" tabindex="-1"><a class="header-anchor" href="#_10-mysqlä¸ºä»€ä¹ˆæœ‰æ—¶å€™ä¼šé€‰é”™ç´¢å¼•" aria-hidden="true">#</a> 10 MySQLä¸ºä»€ä¹ˆæœ‰æ—¶å€™ä¼šé€‰é”™ç´¢å¼•ï¼Ÿ</h3><p>å‰é¢æˆ‘ä»¬ä»‹ç»è¿‡ç´¢å¼•ï¼Œä½ å·²ç»çŸ¥é“äº†åœ¨ MySQL ä¸­ä¸€å¼ è¡¨å…¶å®æ˜¯å¯ä»¥æ”¯æŒå¤šä¸ªç´¢å¼•çš„ã€‚ä½†æ˜¯ï¼Œä½ å†™ SQL è¯­å¥çš„æ—¶å€™ï¼Œå¹¶æ²¡æœ‰ä¸»åŠ¨æŒ‡å®šä½¿ç”¨å“ªä¸ªç´¢å¼•ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä½¿ç”¨å“ªä¸ªç´¢å¼•æ˜¯ç”± MySQL æ¥ç¡®å®šçš„ã€‚</p><p>ä¸çŸ¥é“ä½ æœ‰æ²¡æœ‰ç¢°åˆ°è¿‡è¿™ç§æƒ…å†µï¼Œä¸€æ¡æœ¬æ¥å¯ä»¥æ‰§è¡Œå¾—å¾ˆå¿«çš„è¯­å¥ï¼Œå´ç”±äº MySQL é€‰é”™äº†ç´¢å¼•ï¼Œè€Œå¯¼è‡´æ‰§è¡Œé€Ÿåº¦å˜å¾—å¾ˆæ…¢ï¼Ÿ</p><p>æˆ‘ä»¬ä¸€èµ·æ¥çœ‹ä¸€ä¸ªä¾‹å­å§ã€‚</p><p>æˆ‘ä»¬å…ˆå»ºä¸€ä¸ªç®€å•çš„è¡¨ï¼Œè¡¨é‡Œæœ‰ aã€b ä¸¤ä¸ªå­—æ®µï¼Œå¹¶åˆ†åˆ«å»ºä¸Šç´¢å¼•ï¼š</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code>CREATE TABLE <span class="token string">`t`</span> <span class="token punctuation">(</span>
  <span class="token string">`id`</span> <span class="token function">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> NOT NULL<span class="token punctuation">,</span>
  <span class="token string">`a`</span> <span class="token function">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> DEFAULT NULL<span class="token punctuation">,</span>
  <span class="token string">`b`</span> <span class="token function">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> DEFAULT NULL<span class="token punctuation">,</span>
  PRIMARY KEY <span class="token punctuation">(</span><span class="token string">`id`</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  KEY <span class="token string">`a`</span> <span class="token punctuation">(</span><span class="token string">`a`</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  KEY <span class="token string">`b`</span> <span class="token punctuation">(</span><span class="token string">`b`</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> ENGINE<span class="token operator">=</span>InnoDBï¼›
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åï¼Œæˆ‘ä»¬å¾€è¡¨ t ä¸­æ’å…¥ 10 ä¸‡è¡Œè®°å½•ï¼Œå–å€¼æŒ‰æ•´æ•°é€’å¢ï¼Œå³ï¼š(1,1,1)ï¼Œ(2,2,2)ï¼Œ(3,3,3) ç›´åˆ° (100000,100000,100000)ã€‚</p><p>æˆ‘æ˜¯ç”¨å­˜å‚¨è¿‡ç¨‹æ¥æ’å…¥æ•°æ®çš„ï¼Œè¿™é‡Œæˆ‘è´´å‡ºæ¥æ–¹ä¾¿ä½ å¤ç°ï¼š</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">delimiter</span> <span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">create</span> <span class="token keyword">procedure</span> idata<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">begin</span>
  <span class="token keyword">declare</span> i <span class="token keyword">int</span><span class="token punctuation">;</span>
  <span class="token keyword">set</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span><span class="token punctuation">(</span>i<span class="token operator">&lt;=</span><span class="token number">100000</span><span class="token punctuation">)</span><span class="token keyword">do</span>
    <span class="token keyword">insert</span> <span class="token keyword">into</span> t <span class="token keyword">values</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> i<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">set</span> i<span class="token operator">=</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">end</span> <span class="token keyword">while</span><span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">delimiter</span> <span class="token punctuation">;</span>
<span class="token keyword">call</span> idata<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åˆ†æä¸€æ¡ SQL è¯­å¥ï¼š</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t <span class="token keyword">where</span> a <span class="token operator">between</span> <span class="token number">10000</span> <span class="token operator">and</span> <span class="token number">20000</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ä½ ä¸€å®šä¼šè¯´ï¼Œè¿™ä¸ªè¯­å¥è¿˜ç”¨åˆ†æå—ï¼Œå¾ˆç®€å•å‘€ï¼Œa ä¸Šæœ‰ç´¢å¼•ï¼Œè‚¯å®šæ˜¯è¦ä½¿ç”¨ç´¢å¼• a çš„ã€‚</p><p>ä½ è¯´å¾—æ²¡é”™ï¼Œå›¾ 1 æ˜¾ç¤ºçš„å°±æ˜¯ä½¿ç”¨ explain å‘½ä»¤çœ‹åˆ°çš„è¿™æ¡è¯­å¥çš„æ‰§è¡Œæƒ…å†µã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/2cfce769551c6eac9bfbee0563d48fe3-1584367389610.png" alt="img"></p><p>å›¾ 1 ä½¿ç”¨ explain å‘½ä»¤æŸ¥çœ‹è¯­å¥æ‰§è¡Œæƒ…å†µ</p><p>ä»å›¾ 1 çœ‹ä¸Šå»ï¼Œè¿™æ¡æŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œä¹Ÿç¡®å®ç¬¦åˆé¢„æœŸï¼Œkey è¿™ä¸ªå­—æ®µå€¼æ˜¯â€™aâ€™ï¼Œè¡¨ç¤ºä¼˜åŒ–å™¨é€‰æ‹©äº†ç´¢å¼• aã€‚</p><p>ä¸è¿‡åˆ«æ€¥ï¼Œè¿™ä¸ªæ¡ˆä¾‹ä¸ä¼šè¿™ä¹ˆç®€å•ã€‚åœ¨æˆ‘ä»¬å·²ç»å‡†å¤‡å¥½çš„åŒ…å«äº† 10 ä¸‡è¡Œæ•°æ®çš„è¡¨ä¸Šï¼Œæˆ‘ä»¬å†åšå¦‚ä¸‹æ“ä½œã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/1e5ba1c2934d3b2c0d96b210a27e1a1e-1584367389613.png" alt="img"></p><p>å›¾ 2 session A å’Œ session B çš„æ‰§è¡Œæµç¨‹</p><p>è¿™é‡Œï¼Œsession A çš„æ“ä½œä½ å·²ç»å¾ˆç†Ÿæ‚‰äº†ï¼Œå®ƒå°±æ˜¯å¼€å¯äº†ä¸€ä¸ªäº‹åŠ¡ã€‚éšåï¼Œsession B æŠŠæ•°æ®éƒ½åˆ é™¤åï¼Œåˆè°ƒç”¨äº† idata è¿™ä¸ªå­˜å‚¨è¿‡ç¨‹ï¼Œæ’å…¥äº† 10 ä¸‡è¡Œæ•°æ®ã€‚</p><p>è¿™æ—¶å€™ï¼Œsession B çš„æŸ¥è¯¢è¯­å¥ select * from t where a between 10000 and 20000 å°±ä¸ä¼šå†é€‰æ‹©ç´¢å¼• a äº†ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡æ…¢æŸ¥è¯¢æ—¥å¿—ï¼ˆslow logï¼‰æ¥æŸ¥çœ‹ä¸€ä¸‹å…·ä½“çš„æ‰§è¡Œæƒ…å†µã€‚</p><p>ä¸ºäº†è¯´æ˜ä¼˜åŒ–å™¨é€‰æ‹©çš„ç»“æœæ˜¯å¦æ­£ç¡®ï¼Œæˆ‘å¢åŠ äº†ä¸€ä¸ªå¯¹ç…§ï¼Œå³ï¼šä½¿ç”¨ force index(a) æ¥è®©ä¼˜åŒ–å™¨å¼ºåˆ¶ä½¿ç”¨ç´¢å¼• aï¼ˆè¿™éƒ¨åˆ†å†…å®¹ï¼Œæˆ‘è¿˜ä¼šåœ¨è¿™ç¯‡æ–‡ç« çš„ååŠéƒ¨åˆ†ä¸­æåˆ°ï¼‰ã€‚</p><p>ä¸‹é¢çš„ä¸‰æ¡ SQL è¯­å¥ï¼Œå°±æ˜¯è¿™ä¸ªå®éªŒè¿‡ç¨‹ã€‚</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">set</span> long_query_time<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t <span class="token keyword">where</span> a <span class="token operator">between</span> <span class="token number">10000</span> <span class="token operator">and</span> <span class="token number">20000</span><span class="token punctuation">;</span> <span class="token comment">/*Q1*/</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t <span class="token keyword">force</span> <span class="token keyword">index</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token keyword">where</span> a <span class="token operator">between</span> <span class="token number">10000</span> <span class="token operator">and</span> <span class="token number">20000</span><span class="token punctuation">;</span><span class="token comment">/*Q2*/</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>ç¬¬ä¸€å¥ï¼Œæ˜¯å°†æ…¢æŸ¥è¯¢æ—¥å¿—çš„é˜ˆå€¼è®¾ç½®ä¸º 0ï¼Œè¡¨ç¤ºè¿™ä¸ªçº¿ç¨‹æ¥ä¸‹æ¥çš„è¯­å¥éƒ½ä¼šè¢«è®°å½•å…¥æ…¢æŸ¥è¯¢æ—¥å¿—ä¸­ï¼›</li><li>ç¬¬äºŒå¥ï¼ŒQ1 æ˜¯ session B åŸæ¥çš„æŸ¥è¯¢ï¼›</li><li>ç¬¬ä¸‰å¥ï¼ŒQ2 æ˜¯åŠ äº† force index(a) æ¥å’Œ session B åŸæ¥çš„æŸ¥è¯¢è¯­å¥æ‰§è¡Œæƒ…å†µå¯¹æ¯”ã€‚</li></ul><p>å¦‚å›¾ 3 æ‰€ç¤ºæ˜¯è¿™ä¸‰æ¡ SQL è¯­å¥æ‰§è¡Œå®Œæˆåçš„æ…¢æŸ¥è¯¢æ—¥å¿—ã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/7c58b9c71853b8bba1a8ad5e926de1f6-1584367389615.png" alt="img"></p><p>å›¾ 3 slow log ç»“æœ</p><p>å¯ä»¥çœ‹åˆ°ï¼ŒQ1 æ‰«æäº† 10 ä¸‡è¡Œï¼Œæ˜¾ç„¶æ˜¯èµ°äº†å…¨è¡¨æ‰«æï¼Œæ‰§è¡Œæ—¶é—´æ˜¯ 40 æ¯«ç§’ã€‚Q2 æ‰«æäº† 10001 è¡Œï¼Œæ‰§è¡Œäº† 21 æ¯«ç§’ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬åœ¨æ²¡æœ‰ä½¿ç”¨ force index çš„æ—¶å€™ï¼ŒMySQL ç”¨é”™äº†ç´¢å¼•ï¼Œå¯¼è‡´äº†æ›´é•¿çš„æ‰§è¡Œæ—¶é—´ã€‚</p><p>è¿™ä¸ªä¾‹å­å¯¹åº”çš„æ˜¯æˆ‘ä»¬å¹³å¸¸ä¸æ–­åœ°åˆ é™¤å†å²æ•°æ®å’Œæ–°å¢æ•°æ®çš„åœºæ™¯ã€‚è¿™æ—¶ï¼ŒMySQL ç«Ÿç„¶ä¼šé€‰é”™ç´¢å¼•ï¼Œæ˜¯ä¸æ˜¯æœ‰ç‚¹å¥‡æ€ªå‘¢ï¼Ÿä»Šå¤©ï¼Œæˆ‘ä»¬å°±ä»è¿™ä¸ªå¥‡æ€ªçš„ç»“æœè¯´èµ·å§ã€‚</p><h4 id="ä¼˜åŒ–å™¨çš„é€»è¾‘" tabindex="-1"><a class="header-anchor" href="#ä¼˜åŒ–å™¨çš„é€»è¾‘" aria-hidden="true">#</a> ä¼˜åŒ–å™¨çš„é€»è¾‘</h4><p>åœ¨ç¬¬ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°±æåˆ°è¿‡ï¼Œé€‰æ‹©ç´¢å¼•æ˜¯ä¼˜åŒ–å™¨çš„å·¥ä½œã€‚</p><p>è€Œä¼˜åŒ–å™¨é€‰æ‹©ç´¢å¼•çš„ç›®çš„ï¼Œæ˜¯æ‰¾åˆ°ä¸€ä¸ªæœ€ä¼˜çš„æ‰§è¡Œæ–¹æ¡ˆï¼Œå¹¶ç”¨æœ€å°çš„ä»£ä»·å»æ‰§è¡Œè¯­å¥ã€‚åœ¨æ•°æ®åº“é‡Œé¢ï¼Œæ‰«æè¡Œæ•°æ˜¯å½±å“æ‰§è¡Œä»£ä»·çš„å› ç´ ä¹‹ä¸€ã€‚æ‰«æçš„è¡Œæ•°è¶Šå°‘ï¼Œæ„å‘³ç€è®¿é—®ç£ç›˜æ•°æ®çš„æ¬¡æ•°è¶Šå°‘ï¼Œæ¶ˆè€—çš„ CPU èµ„æºè¶Šå°‘ã€‚</p><p>å½“ç„¶ï¼Œæ‰«æè¡Œæ•°å¹¶ä¸æ˜¯å”¯ä¸€çš„åˆ¤æ–­æ ‡å‡†ï¼Œä¼˜åŒ–å™¨è¿˜ä¼šç»“åˆæ˜¯å¦ä½¿ç”¨ä¸´æ—¶è¡¨ã€æ˜¯å¦æ’åºç­‰å› ç´ è¿›è¡Œç»¼åˆåˆ¤æ–­ã€‚</p><p>æˆ‘ä»¬è¿™ä¸ªç®€å•çš„æŸ¥è¯¢è¯­å¥å¹¶æ²¡æœ‰æ¶‰åŠåˆ°ä¸´æ—¶è¡¨å’Œæ’åºï¼Œæ‰€ä»¥ MySQL é€‰é”™ç´¢å¼•è‚¯å®šæ˜¯åœ¨åˆ¤æ–­æ‰«æè¡Œæ•°çš„æ—¶å€™å‡ºé—®é¢˜äº†ã€‚</p><p>é‚£ä¹ˆï¼Œé—®é¢˜å°±æ˜¯ï¼š<strong>æ‰«æè¡Œæ•°æ˜¯æ€ä¹ˆåˆ¤æ–­çš„ï¼Ÿ</strong></p><p>MySQL åœ¨çœŸæ­£å¼€å§‹æ‰§è¡Œè¯­å¥ä¹‹å‰ï¼Œå¹¶ä¸èƒ½ç²¾ç¡®åœ°çŸ¥é“æ»¡è¶³è¿™ä¸ªæ¡ä»¶çš„è®°å½•æœ‰å¤šå°‘æ¡ï¼Œè€Œåªèƒ½æ ¹æ®ç»Ÿè®¡ä¿¡æ¯æ¥ä¼°ç®—è®°å½•æ•°ã€‚</p><p>è¿™ä¸ªç»Ÿè®¡ä¿¡æ¯å°±æ˜¯ç´¢å¼•çš„â€œåŒºåˆ†åº¦â€ã€‚æ˜¾ç„¶ï¼Œä¸€ä¸ªç´¢å¼•ä¸Šä¸åŒçš„å€¼è¶Šå¤šï¼Œè¿™ä¸ªç´¢å¼•çš„åŒºåˆ†åº¦å°±è¶Šå¥½ã€‚è€Œä¸€ä¸ªç´¢å¼•ä¸Šä¸åŒçš„å€¼çš„ä¸ªæ•°ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºâ€œåŸºæ•°â€ï¼ˆcardinalityï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªåŸºæ•°è¶Šå¤§ï¼Œç´¢å¼•çš„åŒºåˆ†åº¦è¶Šå¥½ã€‚</p><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ show index æ–¹æ³•ï¼Œçœ‹åˆ°ä¸€ä¸ªç´¢å¼•çš„åŸºæ•°ã€‚å¦‚å›¾ 4 æ‰€ç¤ºï¼Œå°±æ˜¯è¡¨ t çš„ show index çš„ç»“æœ ã€‚è™½ç„¶è¿™ä¸ªè¡¨çš„æ¯ä¸€è¡Œçš„ä¸‰ä¸ªå­—æ®µå€¼éƒ½æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯åœ¨ç»Ÿè®¡ä¿¡æ¯ä¸­ï¼Œè¿™ä¸‰ä¸ªç´¢å¼•çš„åŸºæ•°å€¼å¹¶ä¸åŒï¼Œè€Œä¸”å…¶å®éƒ½ä¸å‡†ç¡®ã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/16dbf8124ad529fec0066950446079d4-1584367389624.png" alt="img"></p><p>å›¾ 4 è¡¨ t çš„ show index ç»“æœ</p><p>é‚£ä¹ˆï¼Œ**MySQL æ˜¯æ€æ ·å¾—åˆ°ç´¢å¼•çš„åŸºæ•°çš„å‘¢ï¼Ÿ**è¿™é‡Œï¼Œæˆ‘ç»™ä½ ç®€å•ä»‹ç»ä¸€ä¸‹ MySQL é‡‡æ ·ç»Ÿè®¡çš„æ–¹æ³•ã€‚</p><p>ä¸ºä»€ä¹ˆè¦é‡‡æ ·ç»Ÿè®¡å‘¢ï¼Ÿå› ä¸ºæŠŠæ•´å¼ è¡¨å–å‡ºæ¥ä¸€è¡Œè¡Œç»Ÿè®¡ï¼Œè™½ç„¶å¯ä»¥å¾—åˆ°ç²¾ç¡®çš„ç»“æœï¼Œä½†æ˜¯ä»£ä»·å¤ªé«˜äº†ï¼Œæ‰€ä»¥åªèƒ½é€‰æ‹©â€œé‡‡æ ·ç»Ÿè®¡â€ã€‚</p><p>é‡‡æ ·ç»Ÿè®¡çš„æ—¶å€™ï¼ŒInnoDB é»˜è®¤ä¼šé€‰æ‹© N ä¸ªæ•°æ®é¡µï¼Œç»Ÿè®¡è¿™äº›é¡µé¢ä¸Šçš„ä¸åŒå€¼ï¼Œå¾—åˆ°ä¸€ä¸ªå¹³å‡å€¼ï¼Œç„¶åä¹˜ä»¥è¿™ä¸ªç´¢å¼•çš„é¡µé¢æ•°ï¼Œå°±å¾—åˆ°äº†è¿™ä¸ªç´¢å¼•çš„åŸºæ•°ã€‚</p><p>è€Œæ•°æ®è¡¨æ˜¯ä¼šæŒç»­æ›´æ–°çš„ï¼Œç´¢å¼•ç»Ÿè®¡ä¿¡æ¯ä¹Ÿä¸ä¼šå›ºå®šä¸å˜ã€‚æ‰€ä»¥ï¼Œå½“å˜æ›´çš„æ•°æ®è¡Œæ•°è¶…è¿‡ 1/M çš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨è§¦å‘é‡æ–°åšä¸€æ¬¡ç´¢å¼•ç»Ÿè®¡ã€‚</p><p>åœ¨ MySQL ä¸­ï¼Œæœ‰ä¸¤ç§å­˜å‚¨ç´¢å¼•ç»Ÿè®¡çš„æ–¹å¼ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®å‚æ•° innodb_stats_persistent çš„å€¼æ¥é€‰æ‹©ï¼š</p><ul><li>è®¾ç½®ä¸º on çš„æ—¶å€™ï¼Œè¡¨ç¤ºç»Ÿè®¡ä¿¡æ¯ä¼šæŒä¹…åŒ–å­˜å‚¨ã€‚è¿™æ—¶ï¼Œé»˜è®¤çš„ N æ˜¯ 20ï¼ŒM æ˜¯ 10ã€‚</li><li>è®¾ç½®ä¸º off çš„æ—¶å€™ï¼Œè¡¨ç¤ºç»Ÿè®¡ä¿¡æ¯åªå­˜å‚¨åœ¨å†…å­˜ä¸­ã€‚è¿™æ—¶ï¼Œé»˜è®¤çš„ N æ˜¯ 8ï¼ŒM æ˜¯ 16ã€‚</li></ul><p>ç”±äºæ˜¯é‡‡æ ·ç»Ÿè®¡ï¼Œæ‰€ä»¥ä¸ç®¡ N æ˜¯ 20 è¿˜æ˜¯ 8ï¼Œè¿™ä¸ªåŸºæ•°éƒ½æ˜¯å¾ˆå®¹æ˜“ä¸å‡†çš„ã€‚</p><p>ä½†ï¼Œè¿™è¿˜ä¸æ˜¯å…¨éƒ¨ã€‚</p><p>ä½ å¯ä»¥ä»å›¾ 4 ä¸­çœ‹åˆ°ï¼Œè¿™æ¬¡çš„ç´¢å¼•ç»Ÿè®¡å€¼ï¼ˆcardinality åˆ—ï¼‰è™½ç„¶ä¸å¤Ÿç²¾ç¡®ï¼Œä½†å¤§ä½“ä¸Šè¿˜æ˜¯å·®ä¸å¤šçš„ï¼Œé€‰é”™ç´¢å¼•ä¸€å®šè¿˜æœ‰åˆ«çš„åŸå› ã€‚</p><p>å…¶å®ç´¢å¼•ç»Ÿè®¡åªæ˜¯ä¸€ä¸ªè¾“å…¥ï¼Œå¯¹äºä¸€ä¸ªå…·ä½“çš„è¯­å¥æ¥è¯´ï¼Œä¼˜åŒ–å™¨è¿˜è¦åˆ¤æ–­ï¼Œæ‰§è¡Œè¿™ä¸ªè¯­å¥æœ¬èº«è¦æ‰«æå¤šå°‘è¡Œã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†ä¸€èµ·çœ‹çœ‹ä¼˜åŒ–å™¨é¢„ä¼°çš„ï¼Œè¿™ä¸¤ä¸ªè¯­å¥çš„æ‰«æè¡Œæ•°æ˜¯å¤šå°‘ã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/e2bc5f120858391d4accff05573e1289-1584367389624.png" alt="img"></p><p>å›¾ 5 æ„å¤–çš„ explain ç»“æœ</p><p>rows è¿™ä¸ªå­—æ®µè¡¨ç¤ºçš„æ˜¯é¢„è®¡æ‰«æè¡Œæ•°ã€‚</p><p>å…¶ä¸­ï¼ŒQ1 çš„ç»“æœè¿˜æ˜¯ç¬¦åˆé¢„æœŸçš„ï¼Œrows çš„å€¼æ˜¯ 104620ï¼›ä½†æ˜¯ Q2 çš„ rows å€¼æ˜¯ 37116ï¼Œåå·®å°±å¤§äº†ã€‚è€Œå›¾ 1 ä¸­æˆ‘ä»¬ç”¨ explain å‘½ä»¤çœ‹åˆ°çš„ rows æ˜¯åªæœ‰ 10001 è¡Œï¼Œæ˜¯è¿™ä¸ªåå·®è¯¯å¯¼äº†ä¼˜åŒ–å™¨çš„åˆ¤æ–­ã€‚</p><p>åˆ°è¿™é‡Œï¼Œå¯èƒ½ä½ çš„ç¬¬ä¸€ä¸ªç–‘é—®ä¸æ˜¯ä¸ºä»€ä¹ˆä¸å‡†ï¼Œè€Œæ˜¯ä¼˜åŒ–å™¨ä¸ºä»€ä¹ˆæ”¾ç€æ‰«æ 37000 è¡Œçš„æ‰§è¡Œè®¡åˆ’ä¸ç”¨ï¼Œå´é€‰æ‹©äº†æ‰«æè¡Œæ•°æ˜¯ 100000 çš„æ‰§è¡Œè®¡åˆ’å‘¢ï¼Ÿ</p><p>è¿™æ˜¯å› ä¸ºï¼Œå¦‚æœä½¿ç”¨ç´¢å¼• aï¼Œæ¯æ¬¡ä»ç´¢å¼• a ä¸Šæ‹¿åˆ°ä¸€ä¸ªå€¼ï¼Œéƒ½è¦å›åˆ°ä¸»é”®ç´¢å¼•ä¸ŠæŸ¥å‡ºæ•´è¡Œæ•°æ®ï¼Œè¿™ä¸ªä»£ä»·ä¼˜åŒ–å™¨ä¹Ÿè¦ç®—è¿›å»çš„ã€‚</p><p>è€Œå¦‚æœé€‰æ‹©æ‰«æ 10 ä¸‡è¡Œï¼Œæ˜¯ç›´æ¥åœ¨ä¸»é”®ç´¢å¼•ä¸Šæ‰«æçš„ï¼Œæ²¡æœ‰é¢å¤–çš„ä»£ä»·ã€‚</p><p>ä¼˜åŒ–å™¨ä¼šä¼°ç®—è¿™ä¸¤ä¸ªé€‰æ‹©çš„ä»£ä»·ï¼Œä»ç»“æœçœ‹æ¥ï¼Œä¼˜åŒ–å™¨è®¤ä¸ºç›´æ¥æ‰«æä¸»é”®ç´¢å¼•æ›´å¿«ã€‚å½“ç„¶ï¼Œä»æ‰§è¡Œæ—¶é—´çœ‹æ¥ï¼Œè¿™ä¸ªé€‰æ‹©å¹¶ä¸æ˜¯æœ€ä¼˜çš„ã€‚</p><p>ä½¿ç”¨æ™®é€šç´¢å¼•éœ€è¦æŠŠå›è¡¨çš„ä»£ä»·ç®—è¿›å»ï¼Œåœ¨å›¾ 1 æ‰§è¡Œ explain çš„æ—¶å€™ï¼Œä¹Ÿè€ƒè™‘äº†è¿™ä¸ªç­–ç•¥çš„ä»£ä»· ï¼Œä½†å›¾ 1 çš„é€‰æ‹©æ˜¯å¯¹çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªç­–ç•¥å¹¶æ²¡æœ‰é—®é¢˜ã€‚</p><p>æ‰€ä»¥å†¤æœ‰å¤´å€ºæœ‰ä¸»ï¼ŒMySQL é€‰é”™ç´¢å¼•ï¼Œè¿™ä»¶äº‹å„¿è¿˜å¾—å½’å’åˆ°æ²¡èƒ½å‡†ç¡®åœ°åˆ¤æ–­å‡ºæ‰«æè¡Œæ•°ã€‚è‡³äºä¸ºä»€ä¹ˆä¼šå¾—åˆ°é”™è¯¯çš„æ‰«æè¡Œæ•°ï¼Œè¿™ä¸ªåŸå› å°±ä½œä¸ºè¯¾åé—®é¢˜ï¼Œç•™ç»™ä½ å»åˆ†æäº†ã€‚</p><p>æ—¢ç„¶æ˜¯ç»Ÿè®¡ä¿¡æ¯ä¸å¯¹ï¼Œé‚£å°±ä¿®æ­£ã€‚analyze table t å‘½ä»¤ï¼Œå¯ä»¥ç”¨æ¥é‡æ–°ç»Ÿè®¡ç´¢å¼•ä¿¡æ¯ã€‚æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹æ‰§è¡Œæ•ˆæœã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/209e9d3514688a3bcabbb75e54e1e49c-1584367389626.png" alt="img"></p><p>å›¾ 6 æ‰§è¡Œ analyze table t å‘½ä»¤æ¢å¤çš„ explain ç»“æœ</p><p>è¿™å›å¯¹äº†ã€‚</p><p>æ‰€ä»¥åœ¨å®è·µä¸­ï¼Œå¦‚æœä½ å‘ç° explain çš„ç»“æœé¢„ä¼°çš„ rows å€¼è·Ÿå®é™…æƒ…å†µå·®è·æ¯”è¾ƒå¤§ï¼Œå¯ä»¥é‡‡ç”¨è¿™ä¸ªæ–¹æ³•æ¥å¤„ç†ã€‚</p><p>å…¶å®ï¼Œå¦‚æœåªæ˜¯ç´¢å¼•ç»Ÿè®¡ä¸å‡†ç¡®ï¼Œé€šè¿‡ analyze å‘½ä»¤å¯ä»¥è§£å†³å¾ˆå¤šé—®é¢˜ï¼Œä½†æ˜¯å‰é¢æˆ‘ä»¬è¯´äº†ï¼Œä¼˜åŒ–å™¨å¯ä¸æ­¢æ˜¯çœ‹æ‰«æè¡Œæ•°ã€‚</p><p>ä¾ç„¶æ˜¯åŸºäºè¿™ä¸ªè¡¨ tï¼Œæˆ‘ä»¬çœ‹çœ‹å¦å¤–ä¸€ä¸ªè¯­å¥ï¼š</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t <span class="token keyword">where</span> <span class="token punctuation">(</span>a <span class="token operator">between</span> <span class="token number">1</span> <span class="token operator">and</span> <span class="token number">1000</span><span class="token punctuation">)</span>  <span class="token operator">and</span> <span class="token punctuation">(</span>b <span class="token operator">between</span> <span class="token number">50000</span> <span class="token operator">and</span> <span class="token number">100000</span><span class="token punctuation">)</span> <span class="token keyword">order</span> <span class="token keyword">by</span> b <span class="token keyword">limit</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ä»æ¡ä»¶ä¸Šçœ‹ï¼Œè¿™ä¸ªæŸ¥è¯¢æ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„è®°å½•ï¼Œå› æ­¤ä¼šè¿”å›ç©ºé›†åˆã€‚</p><p>åœ¨å¼€å§‹æ‰§è¡Œè¿™æ¡è¯­å¥ä¹‹å‰ï¼Œä½ å¯ä»¥å…ˆè®¾æƒ³ä¸€ä¸‹ï¼Œå¦‚æœä½ æ¥é€‰æ‹©ç´¢å¼•ï¼Œä¼šé€‰æ‹©å“ªä¸€ä¸ªå‘¢ï¼Ÿ</p><p>ä¸ºäº†ä¾¿äºåˆ†æï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹ aã€b è¿™ä¸¤ä¸ªç´¢å¼•çš„ç»“æ„å›¾ã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/1d037f92063e800c3bfff3f4dbf1a2b9-1584367389629.png" alt="img"></p><p>å›¾ 7 aã€b ç´¢å¼•çš„ç»“æ„å›¾</p><p>å¦‚æœä½¿ç”¨ç´¢å¼• a è¿›è¡ŒæŸ¥è¯¢ï¼Œé‚£ä¹ˆå°±æ˜¯æ‰«æç´¢å¼• a çš„å‰ 1000 ä¸ªå€¼ï¼Œç„¶åå–åˆ°å¯¹åº”çš„ idï¼Œå†åˆ°ä¸»é”®ç´¢å¼•ä¸Šå»æŸ¥å‡ºæ¯ä¸€è¡Œï¼Œç„¶åæ ¹æ®å­—æ®µ b æ¥è¿‡æ»¤ã€‚æ˜¾ç„¶è¿™æ ·éœ€è¦æ‰«æ 1000 è¡Œã€‚</p><p>å¦‚æœä½¿ç”¨ç´¢å¼• b è¿›è¡ŒæŸ¥è¯¢ï¼Œé‚£ä¹ˆå°±æ˜¯æ‰«æç´¢å¼• b çš„æœ€å 50001 ä¸ªå€¼ï¼Œä¸ä¸Šé¢çš„æ‰§è¡Œè¿‡ç¨‹ç›¸åŒï¼Œä¹Ÿæ˜¯éœ€è¦å›åˆ°ä¸»é”®ç´¢å¼•ä¸Šå–å€¼å†åˆ¤æ–­ï¼Œæ‰€ä»¥éœ€è¦æ‰«æ 50001 è¡Œã€‚</p><p>æ‰€ä»¥ä½ ä¸€å®šä¼šæƒ³ï¼Œå¦‚æœä½¿ç”¨ç´¢å¼• a çš„è¯ï¼Œæ‰§è¡Œé€Ÿåº¦æ˜æ˜¾ä¼šå¿«å¾ˆå¤šã€‚é‚£ä¹ˆï¼Œä¸‹é¢æˆ‘ä»¬å°±æ¥çœ‹çœ‹åˆ°åº•æ˜¯ä¸æ˜¯è¿™ä¹ˆä¸€å›äº‹å„¿ã€‚</p><p>å›¾ 8 æ˜¯æ‰§è¡Œ explain çš„ç»“æœã€‚</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t <span class="token keyword">where</span> <span class="token punctuation">(</span>a <span class="token operator">between</span> <span class="token number">1</span> <span class="token operator">and</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token operator">and</span> <span class="token punctuation">(</span>b <span class="token operator">between</span> <span class="token number">50000</span> <span class="token operator">and</span> <span class="token number">100000</span><span class="token punctuation">)</span> <span class="token keyword">order</span> <span class="token keyword">by</span> b <span class="token keyword">limit</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/483bcb1ef3bb902844e80d9cbdd73ab8-1584367389789.png" alt="img"></p><p>å›¾ 8 ä½¿ç”¨ explain æ–¹æ³•æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’ 2</p><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿”å›ç»“æœä¸­ key å­—æ®µæ˜¾ç¤ºï¼Œè¿™æ¬¡ä¼˜åŒ–å™¨é€‰æ‹©äº†ç´¢å¼• bï¼Œè€Œ rows å­—æ®µæ˜¾ç¤ºéœ€è¦æ‰«æçš„è¡Œæ•°æ˜¯ 50198ã€‚</p><p>ä»è¿™ä¸ªç»“æœä¸­ï¼Œä½ å¯ä»¥å¾—åˆ°ä¸¤ä¸ªç»“è®ºï¼š</p><ol><li>æ‰«æè¡Œæ•°çš„ä¼°è®¡å€¼ä¾ç„¶ä¸å‡†ç¡®ï¼›</li><li>è¿™ä¸ªä¾‹å­é‡Œ MySQL åˆé€‰é”™äº†ç´¢å¼•ã€‚</li></ol><h4 id="ç´¢å¼•é€‰æ‹©å¼‚å¸¸å’Œå¤„ç†" tabindex="-1"><a class="header-anchor" href="#ç´¢å¼•é€‰æ‹©å¼‚å¸¸å’Œå¤„ç†" aria-hidden="true">#</a> ç´¢å¼•é€‰æ‹©å¼‚å¸¸å’Œå¤„ç†</h4><p>å…¶å®å¤§å¤šæ•°æ—¶å€™ä¼˜åŒ–å™¨éƒ½èƒ½æ‰¾åˆ°æ­£ç¡®çš„ç´¢å¼•ï¼Œä½†å¶å°”ä½ è¿˜æ˜¯ä¼šç¢°åˆ°æˆ‘ä»¬ä¸Šé¢ä¸¾ä¾‹çš„è¿™ä¸¤ç§æƒ…å†µï¼šåŸæœ¬å¯ä»¥æ‰§è¡Œå¾—å¾ˆå¿«çš„ SQL è¯­å¥ï¼Œæ‰§è¡Œé€Ÿåº¦å´æ¯”ä½ é¢„æœŸçš„æ…¢å¾ˆå¤šï¼Œä½ åº”è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p><p>**ä¸€ç§æ–¹æ³•æ˜¯ï¼Œåƒæˆ‘ä»¬ç¬¬ä¸€ä¸ªä¾‹å­ä¸€æ ·ï¼Œé‡‡ç”¨ force index å¼ºè¡Œé€‰æ‹©ä¸€ä¸ªç´¢å¼•ã€‚**MySQL ä¼šæ ¹æ®è¯æ³•è§£æçš„ç»“æœåˆ†æå‡ºå¯èƒ½å¯ä»¥ä½¿ç”¨çš„ç´¢å¼•ä½œä¸ºå€™é€‰é¡¹ï¼Œç„¶ååœ¨å€™é€‰åˆ—è¡¨ä¸­ä¾æ¬¡åˆ¤æ–­æ¯ä¸ªç´¢å¼•éœ€è¦æ‰«æå¤šå°‘è¡Œã€‚å¦‚æœ force index æŒ‡å®šçš„ç´¢å¼•åœ¨å€™é€‰ç´¢å¼•åˆ—è¡¨ä¸­ï¼Œå°±ç›´æ¥é€‰æ‹©è¿™ä¸ªç´¢å¼•ï¼Œä¸å†è¯„ä¼°å…¶ä»–ç´¢å¼•çš„æ‰§è¡Œä»£ä»·ã€‚</p><p>æˆ‘ä»¬æ¥çœ‹çœ‹ç¬¬äºŒä¸ªä¾‹å­ã€‚åˆšå¼€å§‹åˆ†ææ—¶ï¼Œæˆ‘ä»¬è®¤ä¸ºé€‰æ‹©ç´¢å¼• a ä¼šæ›´å¥½ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å°±æ¥çœ‹çœ‹æ‰§è¡Œæ•ˆæœï¼š</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/9582401a6bed6cb8fd803c9555750b54-1584367389790.png" alt="img"></p><p>å›¾ 9 ä½¿ç”¨ä¸åŒç´¢å¼•çš„è¯­å¥æ‰§è¡Œè€—æ—¶</p><p>å¯ä»¥çœ‹åˆ°ï¼ŒåŸæœ¬è¯­å¥éœ€è¦æ‰§è¡Œ 2.23 ç§’ï¼Œè€Œå½“ä½ ä½¿ç”¨ force index(a) çš„æ—¶å€™ï¼Œåªç”¨äº† 0.05 ç§’ï¼Œæ¯”ä¼˜åŒ–å™¨çš„é€‰æ‹©å¿«äº† 40 å¤šå€ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œä¼˜åŒ–å™¨æ²¡æœ‰é€‰æ‹©æ­£ç¡®çš„ç´¢å¼•ï¼Œforce index èµ·åˆ°äº†â€œçŸ«æ­£â€çš„ä½œç”¨ã€‚</p><p>ä¸è¿‡å¾ˆå¤šç¨‹åºå‘˜ä¸å–œæ¬¢ä½¿ç”¨ force indexï¼Œä¸€æ¥è¿™ä¹ˆå†™ä¸ä¼˜ç¾ï¼ŒäºŒæ¥å¦‚æœç´¢å¼•æ”¹äº†åå­—ï¼Œè¿™ä¸ªè¯­å¥ä¹Ÿå¾—æ”¹ï¼Œæ˜¾å¾—å¾ˆéº»çƒ¦ã€‚è€Œä¸”å¦‚æœä»¥åè¿ç§»åˆ°åˆ«çš„æ•°æ®åº“çš„è¯ï¼Œè¿™ä¸ªè¯­æ³•è¿˜å¯èƒ½ä¼šä¸å…¼å®¹ã€‚</p><p>ä½†å…¶å®ä½¿ç”¨ force index æœ€ä¸»è¦çš„é—®é¢˜è¿˜æ˜¯å˜æ›´çš„åŠæ—¶æ€§ã€‚å› ä¸ºé€‰é”™ç´¢å¼•çš„æƒ…å†µè¿˜æ˜¯æ¯”è¾ƒå°‘å‡ºç°çš„ï¼Œæ‰€ä»¥å¼€å‘çš„æ—¶å€™é€šå¸¸ä¸ä¼šå…ˆå†™ä¸Š force indexã€‚è€Œæ˜¯ç­‰åˆ°çº¿ä¸Šå‡ºç°é—®é¢˜çš„æ—¶å€™ï¼Œä½ æ‰ä¼šå†å»ä¿®æ”¹ SQL è¯­å¥ã€åŠ ä¸Š force indexã€‚ä½†æ˜¯ä¿®æ”¹ä¹‹åè¿˜è¦æµ‹è¯•å’Œå‘å¸ƒï¼Œå¯¹äºç”Ÿäº§ç³»ç»Ÿæ¥è¯´ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸å¤Ÿæ•æ·ã€‚</p><p>æ‰€ä»¥ï¼Œæ•°æ®åº“çš„é—®é¢˜æœ€å¥½è¿˜æ˜¯åœ¨æ•°æ®åº“å†…éƒ¨æ¥è§£å†³ã€‚é‚£ä¹ˆï¼Œåœ¨æ•°æ®åº“é‡Œé¢è¯¥æ€æ ·è§£å†³å‘¢ï¼Ÿ</p><p>æ—¢ç„¶ä¼˜åŒ–å™¨æ”¾å¼ƒäº†ä½¿ç”¨ç´¢å¼• aï¼Œè¯´æ˜ a è¿˜ä¸å¤Ÿåˆé€‚ï¼Œæ‰€ä»¥**ç¬¬äºŒç§æ–¹æ³•å°±æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘ä¿®æ”¹è¯­å¥ï¼Œå¼•å¯¼ MySQL ä½¿ç”¨æˆ‘ä»¬æœŸæœ›çš„ç´¢å¼•ã€‚**æ¯”å¦‚ï¼Œåœ¨è¿™ä¸ªä¾‹å­é‡Œï¼Œæ˜¾ç„¶æŠŠâ€œorder by b limit 1â€ æ”¹æˆ â€œorder by b,a limit 1â€ ï¼Œè¯­ä¹‰çš„é€»è¾‘æ˜¯ç›¸åŒçš„ã€‚</p><p>æˆ‘ä»¬æ¥çœ‹çœ‹æ”¹ä¹‹åçš„æ•ˆæœï¼š</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/14cd598e52a2b72dd334a42603e5b894-1584367389796.png" alt="img"></p><p>å›¾ 10 order by b,a limit 1 æ‰§è¡Œç»“æœ</p><p>ä¹‹å‰ä¼˜åŒ–å™¨é€‰æ‹©ä½¿ç”¨ç´¢å¼• bï¼Œæ˜¯å› ä¸ºå®ƒè®¤ä¸ºä½¿ç”¨ç´¢å¼• b å¯ä»¥é¿å…æ’åºï¼ˆb æœ¬èº«æ˜¯ç´¢å¼•ï¼Œå·²ç»æ˜¯æœ‰åºçš„äº†ï¼Œå¦‚æœé€‰æ‹©ç´¢å¼• b çš„è¯ï¼Œä¸éœ€è¦å†åšæ’åºï¼Œåªéœ€è¦éå†ï¼‰ï¼Œæ‰€ä»¥å³ä½¿æ‰«æè¡Œæ•°å¤šï¼Œä¹Ÿåˆ¤å®šä¸ºä»£ä»·æ›´å°ã€‚</p><p>ç°åœ¨ order by b,a è¿™ç§å†™æ³•ï¼Œè¦æ±‚æŒ‰ç…§ b,a æ’åºï¼Œå°±æ„å‘³ç€ä½¿ç”¨è¿™ä¸¤ä¸ªç´¢å¼•éƒ½éœ€è¦æ’åºã€‚å› æ­¤ï¼Œæ‰«æè¡Œæ•°æˆäº†å½±å“å†³ç­–çš„ä¸»è¦æ¡ä»¶ï¼Œäºæ˜¯æ­¤æ—¶ä¼˜åŒ–å™¨é€‰äº†åªéœ€è¦æ‰«æ 1000 è¡Œçš„ç´¢å¼• aã€‚</p><p>å½“ç„¶ï¼Œè¿™ç§ä¿®æ”¹å¹¶ä¸æ˜¯é€šç”¨çš„ä¼˜åŒ–æ‰‹æ®µï¼Œåªæ˜¯åˆšå¥½åœ¨è¿™ä¸ªè¯­å¥é‡Œé¢æœ‰ limit 1ï¼Œå› æ­¤å¦‚æœæœ‰æ»¡è¶³æ¡ä»¶çš„è®°å½•ï¼Œ order by b limit 1 å’Œ order by b,a limit 1 éƒ½ä¼šè¿”å› b æ˜¯æœ€å°çš„é‚£ä¸€è¡Œï¼Œé€»è¾‘ä¸Šä¸€è‡´ï¼Œæ‰å¯ä»¥è¿™ä¹ˆåšã€‚</p><p>å¦‚æœä½ è§‰å¾—ä¿®æ”¹è¯­ä¹‰è¿™ä»¶äº‹å„¿ä¸å¤ªå¥½ï¼Œè¿™é‡Œè¿˜æœ‰ä¸€ç§æ”¹æ³•ï¼Œå›¾ 11 æ˜¯æ‰§è¡Œæ•ˆæœã€‚</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span>  <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t <span class="token keyword">where</span> <span class="token punctuation">(</span>a <span class="token operator">between</span> <span class="token number">1</span> <span class="token operator">and</span> <span class="token number">1000</span><span class="token punctuation">)</span>  <span class="token operator">and</span> <span class="token punctuation">(</span>b <span class="token operator">between</span> <span class="token number">50000</span> <span class="token operator">and</span> <span class="token number">100000</span><span class="token punctuation">)</span> <span class="token keyword">order</span> <span class="token keyword">by</span> b <span class="token keyword">limit</span> <span class="token number">100</span><span class="token punctuation">)</span>alias <span class="token keyword">limit</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/b1a2ad43c78477d7f93dbc692cbaa0d7-1584367389799.png" alt="img"></p><p>å›¾ 11 æ”¹å†™ SQL çš„ explain</p><p>åœ¨è¿™ä¸ªä¾‹å­é‡Œï¼Œæˆ‘ä»¬ç”¨ limit 100 è®©ä¼˜åŒ–å™¨æ„è¯†åˆ°ï¼Œä½¿ç”¨ b ç´¢å¼•ä»£ä»·æ˜¯å¾ˆé«˜çš„ã€‚å…¶å®æ˜¯æˆ‘ä»¬æ ¹æ®æ•°æ®ç‰¹å¾è¯±å¯¼äº†ä¸€ä¸‹ä¼˜åŒ–å™¨ï¼Œä¹Ÿä¸å…·å¤‡é€šç”¨æ€§ã€‚</p><p><strong>ç¬¬ä¸‰ç§æ–¹æ³•æ˜¯ï¼Œåœ¨æœ‰äº›åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥æ–°å»ºä¸€ä¸ªæ›´åˆé€‚çš„ç´¢å¼•ï¼Œæ¥æä¾›ç»™ä¼˜åŒ–å™¨åšé€‰æ‹©ï¼Œæˆ–åˆ æ‰è¯¯ç”¨çš„ç´¢å¼•ã€‚</strong></p><p>ä¸è¿‡ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘æ²¡æœ‰æ‰¾åˆ°é€šè¿‡æ–°å¢ç´¢å¼•æ¥æ”¹å˜ä¼˜åŒ–å™¨è¡Œä¸ºçš„æ–¹æ³•ã€‚è¿™ç§æƒ…å†µå…¶å®æ¯”è¾ƒå°‘ï¼Œå°¤å…¶æ˜¯ç»è¿‡ DBA ç´¢å¼•ä¼˜åŒ–è¿‡çš„åº“ï¼Œå†ç¢°åˆ°è¿™ä¸ª bugï¼Œæ‰¾åˆ°ä¸€ä¸ªæ›´åˆé€‚çš„ç´¢å¼•ä¸€èˆ¬æ¯”è¾ƒéš¾ã€‚</p><p>å¦‚æœæˆ‘è¯´è¿˜æœ‰ä¸€ä¸ªæ–¹æ³•æ˜¯åˆ æ‰ç´¢å¼• bï¼Œä½ å¯èƒ½ä¼šè§‰å¾—å¥½ç¬‘ã€‚ä½†å®é™…ä¸Šæˆ‘ç¢°åˆ°è¿‡ä¸¤æ¬¡è¿™æ ·çš„ä¾‹å­ï¼Œæœ€ç»ˆæ˜¯ DBA è·Ÿä¸šåŠ¡å¼€å‘æ²Ÿé€šåï¼Œå‘ç°è¿™ä¸ªä¼˜åŒ–å™¨é”™è¯¯é€‰æ‹©çš„ç´¢å¼•å…¶å®æ ¹æœ¬æ²¡æœ‰å¿…è¦å­˜åœ¨ï¼Œäºæ˜¯å°±åˆ æ‰äº†è¿™ä¸ªç´¢å¼•ï¼Œä¼˜åŒ–å™¨ä¹Ÿå°±é‡æ–°é€‰æ‹©åˆ°äº†æ­£ç¡®çš„ç´¢å¼•ã€‚</p><h4 id="å°ç»“-9" tabindex="-1"><a class="header-anchor" href="#å°ç»“-9" aria-hidden="true">#</a> å°ç»“</h4><p>ä»Šå¤©æˆ‘ä»¬ä¸€èµ·èŠäº†èŠç´¢å¼•ç»Ÿè®¡çš„æ›´æ–°æœºåˆ¶ï¼Œå¹¶æåˆ°äº†ä¼˜åŒ–å™¨å­˜åœ¨é€‰é”™ç´¢å¼•çš„å¯èƒ½æ€§ã€‚</p><p>å¯¹äºç”±äºç´¢å¼•ç»Ÿè®¡ä¿¡æ¯ä¸å‡†ç¡®å¯¼è‡´çš„é—®é¢˜ï¼Œä½ å¯ä»¥ç”¨ analyze table æ¥è§£å†³ã€‚</p><p>è€Œå¯¹äºå…¶ä»–ä¼˜åŒ–å™¨è¯¯åˆ¤çš„æƒ…å†µï¼Œä½ å¯ä»¥åœ¨åº”ç”¨ç«¯ç”¨ force index æ¥å¼ºè¡ŒæŒ‡å®šç´¢å¼•ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ä¿®æ”¹è¯­å¥æ¥å¼•å¯¼ä¼˜åŒ–å™¨ï¼Œè¿˜å¯ä»¥é€šè¿‡å¢åŠ æˆ–è€…åˆ é™¤ç´¢å¼•æ¥ç»•è¿‡è¿™ä¸ªé—®é¢˜ã€‚</p><p>ä½ å¯èƒ½ä¼šè¯´ï¼Œä»Šå¤©è¿™ç¯‡æ–‡ç« åé¢çš„å‡ ä¸ªä¾‹å­ï¼Œæ€ä¹ˆéƒ½æ²¡æœ‰å±•å¼€è¯´æ˜å…¶åŸç†ã€‚æˆ‘è¦å‘Šè¯‰ä½ çš„æ˜¯ï¼Œä»Šå¤©çš„è¯é¢˜ï¼Œæˆ‘ä»¬é¢å¯¹çš„æ˜¯ MySQL çš„ bugï¼Œæ¯ä¸€ä¸ªå±•å¼€éƒ½å¿…é¡»æ·±å…¥åˆ°ä¸€è¡Œè¡Œä»£ç å»é‡åŒ–ï¼Œå®åœ¨ä¸æ˜¯æˆ‘ä»¬åœ¨è¿™é‡Œåº”è¯¥åšçš„äº‹æƒ…ã€‚</p><p>æ‰€ä»¥ï¼Œæˆ‘æŠŠæˆ‘ç”¨è¿‡çš„è§£å†³æ–¹æ³•è·Ÿä½ åˆ†äº«ï¼Œå¸Œæœ›ä½ åœ¨ç¢°åˆ°ç±»ä¼¼æƒ…å†µçš„æ—¶å€™ï¼Œèƒ½å¤Ÿæœ‰ä¸€äº›æ€è·¯ã€‚</p><p>ä½ å¹³æ—¶åœ¨å¤„ç† MySQL ä¼˜åŒ–å™¨ bug çš„æ—¶å€™æœ‰ä»€ä¹ˆåˆ«çš„æ–¹æ³•ï¼Œä¹Ÿå‘åˆ°è¯„è®ºåŒºåˆ†äº«ä¸€ä¸‹å§ã€‚</p><p>æœ€åï¼Œæˆ‘ç»™ä½ ç•™ä¸‹ä¸€ä¸ªæ€è€ƒé¢˜ã€‚å‰é¢æˆ‘ä»¬åœ¨æ„é€ ç¬¬ä¸€ä¸ªä¾‹å­çš„è¿‡ç¨‹ä¸­ï¼Œé€šè¿‡ session A çš„é…åˆï¼Œè®© session B åˆ é™¤æ•°æ®ååˆé‡æ–°æ’å…¥äº†ä¸€éæ•°æ®ï¼Œç„¶åå°±å‘ç° explain ç»“æœä¸­ï¼Œrows å­—æ®µä» 10001 å˜æˆ 37000 å¤šã€‚</p><p>è€Œå¦‚æœæ²¡æœ‰ session A çš„é…åˆï¼Œåªæ˜¯å•ç‹¬æ‰§è¡Œ delete from t ã€call idata()ã€explain è¿™ä¸‰å¥è¯ï¼Œä¼šçœ‹åˆ° rows å­—æ®µå…¶å®è¿˜æ˜¯ 10000 å·¦å³ã€‚ä½ å¯ä»¥è‡ªå·±éªŒè¯ä¸€ä¸‹è¿™ä¸ªç»“æœã€‚</p><p>è¿™æ˜¯ä»€ä¹ˆåŸå› å‘¢ï¼Ÿä¹Ÿè¯·ä½ åˆ†æä¸€ä¸‹å§ã€‚</p><p>ä½ å¯ä»¥æŠŠä½ çš„åˆ†æç»“è®ºå†™åœ¨ç•™è¨€åŒºé‡Œï¼Œæˆ‘ä¼šåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« çš„æœ«å°¾å’Œä½ è®¨è®ºè¿™ä¸ªé—®é¢˜ã€‚æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚</p><h4 id="ä¸ŠæœŸé—®é¢˜æ—¶é—´-6" tabindex="-1"><a class="header-anchor" href="#ä¸ŠæœŸé—®é¢˜æ—¶é—´-6" aria-hidden="true">#</a> ä¸ŠæœŸé—®é¢˜æ—¶é—´</h4><p>æˆ‘åœ¨ä¸Šä¸€ç¯‡æ–‡ç« æœ€åç•™ç»™ä½ çš„é—®é¢˜æ˜¯ï¼Œå¦‚æœæŸæ¬¡å†™å…¥ä½¿ç”¨äº† change buffer æœºåˆ¶ï¼Œä¹‹åä¸»æœºå¼‚å¸¸é‡å¯ï¼Œæ˜¯å¦ä¼šä¸¢å¤± change buffer å’Œæ•°æ®ã€‚</p><p>è¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆæ˜¯ä¸ä¼šä¸¢å¤±ï¼Œç•™è¨€åŒºçš„å¾ˆå¤šåŒå­¦éƒ½å›ç­”å¯¹äº†ã€‚è™½ç„¶æ˜¯åªæ›´æ–°å†…å­˜ï¼Œä½†æ˜¯åœ¨äº‹åŠ¡æäº¤çš„æ—¶å€™ï¼Œæˆ‘ä»¬æŠŠ change buffer çš„æ“ä½œä¹Ÿè®°å½•åˆ° redo log é‡Œäº†ï¼Œæ‰€ä»¥å´©æºƒæ¢å¤çš„æ—¶å€™ï¼Œchange buffer ä¹Ÿèƒ½æ‰¾å›æ¥ã€‚</p><p>åœ¨è¯„è®ºåŒºæœ‰åŒå­¦é—®åˆ°ï¼Œmerge çš„è¿‡ç¨‹æ˜¯å¦ä¼šæŠŠæ•°æ®ç›´æ¥å†™å›ç£ç›˜ï¼Œè¿™æ˜¯ä¸ªå¥½é—®é¢˜ã€‚è¿™é‡Œï¼Œæˆ‘å†ä¸ºä½ åˆ†æä¸€ä¸‹ã€‚</p><p>merge çš„æ‰§è¡Œæµç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><ol><li>ä»ç£ç›˜è¯»å…¥æ•°æ®é¡µåˆ°å†…å­˜ï¼ˆè€ç‰ˆæœ¬çš„æ•°æ®é¡µï¼‰ï¼›</li><li>ä» change buffer é‡Œæ‰¾å‡ºè¿™ä¸ªæ•°æ®é¡µçš„ change buffer è®°å½• (å¯èƒ½æœ‰å¤šä¸ªï¼‰ï¼Œä¾æ¬¡åº”ç”¨ï¼Œå¾—åˆ°æ–°ç‰ˆæ•°æ®é¡µï¼›</li><li>å†™ redo logã€‚è¿™ä¸ª redo log åŒ…å«äº†æ•°æ®çš„å˜æ›´å’Œ change buffer çš„å˜æ›´ã€‚</li></ol><p>åˆ°è¿™é‡Œ merge è¿‡ç¨‹å°±ç»“æŸäº†ã€‚è¿™æ—¶å€™ï¼Œæ•°æ®é¡µå’Œå†…å­˜ä¸­ change buffer å¯¹åº”çš„ç£ç›˜ä½ç½®éƒ½è¿˜æ²¡æœ‰ä¿®æ”¹ï¼Œå±äºè„é¡µï¼Œä¹‹åå„è‡ªåˆ·å›è‡ªå·±çš„ç‰©ç†æ•°æ®ï¼Œå°±æ˜¯å¦å¤–ä¸€ä¸ªè¿‡ç¨‹äº†ã€‚</p><p>è¯„è®ºåŒºç•™è¨€ç‚¹èµæ¿ï¼š</p><blockquote><p>@æŸã€äºº æŠŠ 02 ç¯‡çš„ redo log æ›´æ–°ç»†èŠ‚å’Œ change buffer çš„æ›´æ–°ä¸²äº†èµ·æ¥ï¼› @Ivan å›å¤äº†å…¶ä»–åŒå­¦çš„é—®é¢˜ï¼Œå¹¶è”ç³»åˆ° Checkpoint æœºåˆ¶ï¼› @çº¦ä¹¦äºš é—®åˆ°äº† merge å’Œ redolog çš„å…³ç³»ã€‚</p></blockquote><h3 id="_11-æ€ä¹ˆç»™å­—ç¬¦ä¸²å­—æ®µåŠ ç´¢å¼•" tabindex="-1"><a class="header-anchor" href="#_11-æ€ä¹ˆç»™å­—ç¬¦ä¸²å­—æ®µåŠ ç´¢å¼•" aria-hidden="true">#</a> 11 æ€ä¹ˆç»™å­—ç¬¦ä¸²å­—æ®µåŠ ç´¢å¼•ï¼Ÿ</h3><p>ç°åœ¨ï¼Œå‡ ä¹æ‰€æœ‰çš„ç³»ç»Ÿéƒ½æ”¯æŒé‚®ç®±ç™»å½•ï¼Œå¦‚ä½•åœ¨é‚®ç®±è¿™æ ·çš„å­—æ®µä¸Šå»ºç«‹åˆç†çš„ç´¢å¼•ï¼Œæ˜¯æˆ‘ä»¬ä»Šå¤©è¦è®¨è®ºçš„é—®é¢˜ã€‚</p><p>å‡è®¾ï¼Œä½ ç°åœ¨ç»´æŠ¤ä¸€ä¸ªæ”¯æŒé‚®ç®±ç™»å½•çš„ç³»ç»Ÿï¼Œç”¨æˆ·è¡¨æ˜¯è¿™ä¹ˆå®šä¹‰çš„ï¼š</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token keyword">table</span> SUser<span class="token punctuation">(</span>
ID <span class="token keyword">bigint</span> <span class="token keyword">unsigned</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span>
email <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> 
<span class="token punctuation">)</span><span class="token keyword">engine</span><span class="token operator">=</span><span class="token keyword">innodb</span><span class="token punctuation">;</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç”±äºè¦ä½¿ç”¨é‚®ç®±ç™»å½•ï¼Œæ‰€ä»¥ä¸šåŠ¡ä»£ç ä¸­ä¸€å®šä¼šå‡ºç°ç±»ä¼¼äºè¿™æ ·çš„è¯­å¥ï¼š</p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> f1<span class="token punctuation">,</span> f2 <span class="token keyword">from</span> SUser <span class="token keyword">where</span> <span class="token class-name">email</span><span class="token operator">=</span>&#39;xxx&#39;<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ä»ç¬¬ 4 å’Œç¬¬ 5 ç¯‡è®²è§£ç´¢å¼•çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œå¦‚æœ email è¿™ä¸ªå­—æ®µä¸Šæ²¡æœ‰ç´¢å¼•ï¼Œé‚£ä¹ˆè¿™ä¸ªè¯­å¥å°±åªèƒ½åšå…¨è¡¨æ‰«æã€‚</p><p>åŒæ—¶ï¼ŒMySQL æ˜¯æ”¯æŒå‰ç¼€ç´¢å¼•çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä½ å¯ä»¥å®šä¹‰å­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†ä½œä¸ºç´¢å¼•ã€‚é»˜è®¤åœ°ï¼Œå¦‚æœä½ åˆ›å»ºç´¢å¼•çš„è¯­å¥ä¸æŒ‡å®šå‰ç¼€é•¿åº¦ï¼Œé‚£ä¹ˆç´¢å¼•å°±ä¼šåŒ…å«æ•´ä¸ªå­—ç¬¦ä¸²ã€‚</p><p>æ¯”å¦‚ï¼Œè¿™ä¸¤ä¸ªåœ¨ email å­—æ®µä¸Šåˆ›å»ºç´¢å¼•çš„è¯­å¥ï¼š</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">alter</span> <span class="token keyword">table</span> SUser <span class="token keyword">add</span> <span class="token keyword">index</span> index1<span class="token punctuation">(</span>email<span class="token punctuation">)</span><span class="token punctuation">;</span>
æˆ–
mysql<span class="token operator">&gt;</span> <span class="token keyword">alter</span> <span class="token keyword">table</span> SUser <span class="token keyword">add</span> <span class="token keyword">index</span> index2<span class="token punctuation">(</span>email<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç¬¬ä¸€ä¸ªè¯­å¥åˆ›å»ºçš„ index1 ç´¢å¼•é‡Œé¢ï¼ŒåŒ…å«äº†æ¯ä¸ªè®°å½•çš„æ•´ä¸ªå­—ç¬¦ä¸²ï¼›è€Œç¬¬äºŒä¸ªè¯­å¥åˆ›å»ºçš„ index2 ç´¢å¼•é‡Œé¢ï¼Œå¯¹äºæ¯ä¸ªè®°å½•éƒ½æ˜¯åªå–å‰ 6 ä¸ªå­—èŠ‚ã€‚</p><p>é‚£ä¹ˆï¼Œè¿™ä¸¤ç§ä¸åŒçš„å®šä¹‰åœ¨æ•°æ®ç»“æ„å’Œå­˜å‚¨ä¸Šæœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿå¦‚å›¾ 2 å’Œ 3 æ‰€ç¤ºï¼Œå°±æ˜¯è¿™ä¸¤ä¸ªç´¢å¼•çš„ç¤ºæ„å›¾ã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/d31da662bee595991862c439a5567eb7-1584367389800.jpg" alt="img"></p><p>å›¾ 1 email ç´¢å¼•ç»“æ„</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/134583875561de914991fc2e192cf842-1584367389802.jpg" alt="img"></p><p>å›¾ 2 email(6) ç´¢å¼•ç»“æ„</p><p>ä»å›¾ä¸­ä½ å¯ä»¥çœ‹åˆ°ï¼Œç”±äº email(6) è¿™ä¸ªç´¢å¼•ç»“æ„ä¸­æ¯ä¸ªé‚®ç®±å­—æ®µéƒ½åªå–å‰ 6 ä¸ªå­—èŠ‚ï¼ˆå³ï¼šzhangsï¼‰ï¼Œæ‰€ä»¥å ç”¨çš„ç©ºé—´ä¼šæ›´å°ï¼Œè¿™å°±æ˜¯ä½¿ç”¨å‰ç¼€ç´¢å¼•çš„ä¼˜åŠ¿ã€‚</p><p>ä½†ï¼Œè¿™åŒæ—¶å¸¦æ¥çš„æŸå¤±æ˜¯ï¼Œå¯èƒ½ä¼šå¢åŠ é¢å¤–çš„è®°å½•æ‰«ææ¬¡æ•°ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†çœ‹çœ‹ä¸‹é¢è¿™ä¸ªè¯­å¥ï¼Œåœ¨è¿™ä¸¤ä¸ªç´¢å¼•å®šä¹‰ä¸‹åˆ†åˆ«æ˜¯æ€ä¹ˆæ‰§è¡Œçš„ã€‚</p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">select</span> id<span class="token punctuation">,</span>name<span class="token punctuation">,</span>email <span class="token keyword">from</span> SUser <span class="token keyword">where</span> <span class="token class-name">email</span><span class="token operator">=</span>&#39;zhangssxyz@xxx<span class="token punctuation">.</span>com&#39;<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>å¦‚æœä½¿ç”¨çš„æ˜¯ index1</strong>ï¼ˆå³ email æ•´ä¸ªå­—ç¬¦ä¸²çš„ç´¢å¼•ç»“æ„ï¼‰ï¼Œæ‰§è¡Œé¡ºåºæ˜¯è¿™æ ·çš„ï¼š</p><ol><li>ä» index1 ç´¢å¼•æ ‘æ‰¾åˆ°æ»¡è¶³ç´¢å¼•å€¼æ˜¯â€™zhangssxyz@xxx.comâ€™çš„è¿™æ¡è®°å½•ï¼Œå–å¾— ID2 çš„å€¼ï¼›</li><li>åˆ°ä¸»é”®ä¸ŠæŸ¥åˆ°ä¸»é”®å€¼æ˜¯ ID2 çš„è¡Œï¼Œåˆ¤æ–­ email çš„å€¼æ˜¯æ­£ç¡®çš„ï¼Œå°†è¿™è¡Œè®°å½•åŠ å…¥ç»“æœé›†ï¼›</li><li>å– index1 ç´¢å¼•æ ‘ä¸ŠåˆšåˆšæŸ¥åˆ°çš„ä½ç½®çš„ä¸‹ä¸€æ¡è®°å½•ï¼Œå‘ç°å·²ç»ä¸æ»¡è¶³ email=&#39;zhangssxyz@xxx.comâ€™çš„æ¡ä»¶äº†ï¼Œå¾ªç¯ç»“æŸã€‚</li></ol><p>è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œåªéœ€è¦å›ä¸»é”®ç´¢å¼•å–ä¸€æ¬¡æ•°æ®ï¼Œæ‰€ä»¥ç³»ç»Ÿè®¤ä¸ºåªæ‰«æäº†ä¸€è¡Œã€‚</p><p><strong>å¦‚æœä½¿ç”¨çš„æ˜¯ index2</strong>ï¼ˆå³ email(6) ç´¢å¼•ç»“æ„ï¼‰ï¼Œæ‰§è¡Œé¡ºåºæ˜¯è¿™æ ·çš„ï¼š</p><ol><li>ä» index2 ç´¢å¼•æ ‘æ‰¾åˆ°æ»¡è¶³ç´¢å¼•å€¼æ˜¯â€™zhangsâ€™çš„è®°å½•ï¼Œæ‰¾åˆ°çš„ç¬¬ä¸€ä¸ªæ˜¯ ID1ï¼›</li><li>åˆ°ä¸»é”®ä¸ŠæŸ¥åˆ°ä¸»é”®å€¼æ˜¯ ID1 çš„è¡Œï¼Œåˆ¤æ–­å‡º email çš„å€¼ä¸æ˜¯â€™zhangssxyz@xxx.comâ€™ï¼Œè¿™è¡Œè®°å½•ä¸¢å¼ƒï¼›</li><li>å– index2 ä¸ŠåˆšåˆšæŸ¥åˆ°çš„ä½ç½®çš„ä¸‹ä¸€æ¡è®°å½•ï¼Œå‘ç°ä»ç„¶æ˜¯â€™zhangsâ€™ï¼Œå–å‡º ID2ï¼Œå†åˆ° ID ç´¢å¼•ä¸Šå–æ•´è¡Œç„¶ååˆ¤æ–­ï¼Œè¿™æ¬¡å€¼å¯¹äº†ï¼Œå°†è¿™è¡Œè®°å½•åŠ å…¥ç»“æœé›†ï¼›</li><li>é‡å¤ä¸Šä¸€æ­¥ï¼Œç›´åˆ°åœ¨ idxe2 ä¸Šå–åˆ°çš„å€¼ä¸æ˜¯â€™zhangsâ€™æ—¶ï¼Œå¾ªç¯ç»“æŸã€‚</li></ol><p>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œè¦å›ä¸»é”®ç´¢å¼•å– 4 æ¬¡æ•°æ®ï¼Œä¹Ÿå°±æ˜¯æ‰«æäº† 4 è¡Œã€‚</p><p>é€šè¿‡è¿™ä¸ªå¯¹æ¯”ï¼Œä½ å¾ˆå®¹æ˜“å°±å¯ä»¥å‘ç°ï¼Œä½¿ç”¨å‰ç¼€ç´¢å¼•åï¼Œå¯èƒ½ä¼šå¯¼è‡´æŸ¥è¯¢è¯­å¥è¯»æ•°æ®çš„æ¬¡æ•°å˜å¤šã€‚</p><p>ä½†æ˜¯ï¼Œå¯¹äºè¿™ä¸ªæŸ¥è¯¢è¯­å¥æ¥è¯´ï¼Œå¦‚æœä½ å®šä¹‰çš„ index2 ä¸æ˜¯ email(6) è€Œæ˜¯ email(7ï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´å– email å­—æ®µçš„å‰ 7 ä¸ªå­—èŠ‚æ¥æ„å»ºç´¢å¼•çš„è¯ï¼Œå³æ»¡è¶³å‰ç¼€â€™zhangssâ€™çš„è®°å½•åªæœ‰ä¸€ä¸ªï¼Œä¹Ÿèƒ½å¤Ÿç›´æ¥æŸ¥åˆ° ID2ï¼Œåªæ‰«æä¸€è¡Œå°±ç»“æŸäº†ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´<strong>ä½¿ç”¨å‰ç¼€ç´¢å¼•ï¼Œå®šä¹‰å¥½é•¿åº¦ï¼Œå°±å¯ä»¥åšåˆ°æ—¢èŠ‚çœç©ºé—´ï¼Œåˆä¸ç”¨é¢å¤–å¢åŠ å¤ªå¤šçš„æŸ¥è¯¢æˆæœ¬ã€‚</strong></p><p>äºæ˜¯ï¼Œä½ å°±æœ‰ä¸ªé—®é¢˜ï¼šå½“è¦ç»™å­—ç¬¦ä¸²åˆ›å»ºå‰ç¼€ç´¢å¼•æ—¶ï¼Œæœ‰ä»€ä¹ˆæ–¹æ³•èƒ½å¤Ÿç¡®å®šæˆ‘åº”è¯¥ä½¿ç”¨å¤šé•¿çš„å‰ç¼€å‘¢ï¼Ÿ</p><p>å®é™…ä¸Šï¼Œæˆ‘ä»¬åœ¨å»ºç«‹ç´¢å¼•æ—¶å…³æ³¨çš„æ˜¯åŒºåˆ†åº¦ï¼ŒåŒºåˆ†åº¦è¶Šé«˜è¶Šå¥½ã€‚å› ä¸ºåŒºåˆ†åº¦è¶Šé«˜ï¼Œæ„å‘³ç€é‡å¤çš„é”®å€¼è¶Šå°‘ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç»Ÿè®¡ç´¢å¼•ä¸Šæœ‰å¤šå°‘ä¸ªä¸åŒçš„å€¼æ¥åˆ¤æ–­è¦ä½¿ç”¨å¤šé•¿çš„å‰ç¼€ã€‚</p><p>é¦–å…ˆï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸‹é¢è¿™ä¸ªè¯­å¥ï¼Œç®—å‡ºè¿™ä¸ªåˆ—ä¸Šæœ‰å¤šå°‘ä¸ªä¸åŒçš„å€¼ï¼š</p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token class-name">distinct</span> email<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token class-name">L</span> <span class="token keyword">from</span> SUser<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ç„¶åï¼Œä¾æ¬¡é€‰å–ä¸åŒé•¿åº¦çš„å‰ç¼€æ¥çœ‹è¿™ä¸ªå€¼ï¼Œæ¯”å¦‚æˆ‘ä»¬è¦çœ‹ä¸€ä¸‹ 4~7 ä¸ªå­—èŠ‚çš„å‰ç¼€ç´¢å¼•ï¼Œå¯ä»¥ç”¨è¿™ä¸ªè¯­å¥ï¼š</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> 
  <span class="token function">count</span><span class="token punctuation">(</span><span class="token keyword">distinct</span> <span class="token keyword">left</span><span class="token punctuation">(</span>email<span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span>ï¼‰<span class="token keyword">as</span> L4<span class="token punctuation">,</span>
  <span class="token function">count</span><span class="token punctuation">(</span><span class="token keyword">distinct</span> <span class="token keyword">left</span><span class="token punctuation">(</span>email<span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span>ï¼‰<span class="token keyword">as</span> L5<span class="token punctuation">,</span>
  <span class="token function">count</span><span class="token punctuation">(</span><span class="token keyword">distinct</span> <span class="token keyword">left</span><span class="token punctuation">(</span>email<span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span>ï¼‰<span class="token keyword">as</span> L6<span class="token punctuation">,</span>
  <span class="token function">count</span><span class="token punctuation">(</span><span class="token keyword">distinct</span> <span class="token keyword">left</span><span class="token punctuation">(</span>email<span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">)</span>ï¼‰<span class="token keyword">as</span> L7<span class="token punctuation">,</span>
<span class="token keyword">from</span> SUser<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“ç„¶ï¼Œä½¿ç”¨å‰ç¼€ç´¢å¼•å¾ˆå¯èƒ½ä¼šæŸå¤±åŒºåˆ†åº¦ï¼Œæ‰€ä»¥ä½ éœ€è¦é¢„å…ˆè®¾å®šä¸€ä¸ªå¯ä»¥æ¥å—çš„æŸå¤±æ¯”ä¾‹ï¼Œæ¯”å¦‚ 5%ã€‚ç„¶åï¼Œåœ¨è¿”å›çš„ L4~L7 ä¸­ï¼Œæ‰¾å‡ºä¸å°äº L * 95% çš„å€¼ï¼Œå‡è®¾è¿™é‡Œ L6ã€L7 éƒ½æ»¡è¶³ï¼Œä½ å°±å¯ä»¥é€‰æ‹©å‰ç¼€é•¿åº¦ä¸º 6ã€‚</p><h4 id="å‰ç¼€ç´¢å¼•å¯¹è¦†ç›–ç´¢å¼•çš„å½±å“" tabindex="-1"><a class="header-anchor" href="#å‰ç¼€ç´¢å¼•å¯¹è¦†ç›–ç´¢å¼•çš„å½±å“" aria-hidden="true">#</a> å‰ç¼€ç´¢å¼•å¯¹è¦†ç›–ç´¢å¼•çš„å½±å“</h4><p>å‰é¢æˆ‘ä»¬è¯´äº†ä½¿ç”¨å‰ç¼€ç´¢å¼•å¯èƒ½ä¼šå¢åŠ æ‰«æè¡Œæ•°ï¼Œè¿™ä¼šå½±å“åˆ°æ€§èƒ½ã€‚å…¶å®ï¼Œå‰ç¼€ç´¢å¼•çš„å½±å“ä¸æ­¢å¦‚æ­¤ï¼Œæˆ‘ä»¬å†çœ‹ä¸€ä¸‹å¦å¤–ä¸€ä¸ªåœºæ™¯ã€‚</p><p>ä½ å…ˆæ¥çœ‹çœ‹è¿™ä¸ª SQL è¯­å¥ï¼š</p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">select</span> id<span class="token punctuation">,</span>email <span class="token keyword">from</span> SUser <span class="token keyword">where</span> <span class="token class-name">email</span><span class="token operator">=</span>&#39;zhangssxyz@xxx<span class="token punctuation">.</span>com&#39;<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ä¸å‰é¢ä¾‹å­ä¸­çš„ SQL è¯­å¥</p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">select</span> id<span class="token punctuation">,</span>name<span class="token punctuation">,</span>email <span class="token keyword">from</span> SUser <span class="token keyword">where</span> <span class="token class-name">email</span><span class="token operator">=</span>&#39;zhangssxyz@xxx<span class="token punctuation">.</span>com&#39;<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ç›¸æ¯”ï¼Œè¿™ä¸ªè¯­å¥åªè¦æ±‚è¿”å› id å’Œ email å­—æ®µã€‚</p><p>æ‰€ä»¥ï¼Œå¦‚æœä½¿ç”¨ index1ï¼ˆå³ email æ•´ä¸ªå­—ç¬¦ä¸²çš„ç´¢å¼•ç»“æ„ï¼‰çš„è¯ï¼Œå¯ä»¥åˆ©ç”¨è¦†ç›–ç´¢å¼•ï¼Œä» index1 æŸ¥åˆ°ç»“æœåç›´æ¥å°±è¿”å›äº†ï¼Œä¸éœ€è¦å›åˆ° ID ç´¢å¼•å†å»æŸ¥ä¸€æ¬¡ã€‚è€Œå¦‚æœä½¿ç”¨ index2ï¼ˆå³ email(6) ç´¢å¼•ç»“æ„ï¼‰çš„è¯ï¼Œå°±ä¸å¾—ä¸å›åˆ° ID ç´¢å¼•å†å»åˆ¤æ–­ email å­—æ®µçš„å€¼ã€‚</p><p>å³ä½¿ä½ å°† index2 çš„å®šä¹‰ä¿®æ”¹ä¸º email(18) çš„å‰ç¼€ç´¢å¼•ï¼Œè¿™æ—¶å€™è™½ç„¶ index2 å·²ç»åŒ…å«äº†æ‰€æœ‰çš„ä¿¡æ¯ï¼Œä½† InnoDB è¿˜æ˜¯è¦å›åˆ° id ç´¢å¼•å†æŸ¥ä¸€ä¸‹ï¼Œå› ä¸ºç³»ç»Ÿå¹¶ä¸ç¡®å®šå‰ç¼€ç´¢å¼•çš„å®šä¹‰æ˜¯å¦æˆªæ–­äº†å®Œæ•´ä¿¡æ¯ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œä½¿ç”¨å‰ç¼€ç´¢å¼•å°±ç”¨ä¸ä¸Šè¦†ç›–ç´¢å¼•å¯¹æŸ¥è¯¢æ€§èƒ½çš„ä¼˜åŒ–äº†ï¼Œè¿™ä¹Ÿæ˜¯ä½ åœ¨é€‰æ‹©æ˜¯å¦ä½¿ç”¨å‰ç¼€ç´¢å¼•æ—¶éœ€è¦è€ƒè™‘çš„ä¸€ä¸ªå› ç´ ã€‚</p><h4 id="å…¶ä»–æ–¹å¼" tabindex="-1"><a class="header-anchor" href="#å…¶ä»–æ–¹å¼" aria-hidden="true">#</a> å…¶ä»–æ–¹å¼</h4><p>å¯¹äºç±»ä¼¼äºé‚®ç®±è¿™æ ·çš„å­—æ®µæ¥è¯´ï¼Œä½¿ç”¨å‰ç¼€ç´¢å¼•çš„æ•ˆæœå¯èƒ½è¿˜ä¸é”™ã€‚ä½†æ˜¯ï¼Œé‡åˆ°å‰ç¼€çš„åŒºåˆ†åº¦ä¸å¤Ÿå¥½çš„æƒ…å†µæ—¶ï¼Œæˆ‘ä»¬è¦æ€ä¹ˆåŠå‘¢ï¼Ÿ</p><p>æ¯”å¦‚ï¼Œæˆ‘ä»¬å›½å®¶çš„èº«ä»½è¯å·ï¼Œä¸€å…± 18 ä½ï¼Œå…¶ä¸­å‰ 6 ä½æ˜¯åœ°å€ç ï¼Œæ‰€ä»¥åŒä¸€ä¸ªå¿çš„äººçš„èº«ä»½è¯å·å‰ 6 ä½ä¸€èˆ¬ä¼šæ˜¯ç›¸åŒçš„ã€‚</p><p>å‡è®¾ä½ ç»´æŠ¤çš„æ•°æ®åº“æ˜¯ä¸€ä¸ªå¸‚çš„å…¬æ°‘ä¿¡æ¯ç³»ç»Ÿï¼Œè¿™æ—¶å€™å¦‚æœå¯¹èº«ä»½è¯å·åšé•¿åº¦ä¸º 6 çš„å‰ç¼€ç´¢å¼•çš„è¯ï¼Œè¿™ä¸ªç´¢å¼•çš„åŒºåˆ†åº¦å°±éå¸¸ä½äº†ã€‚</p><p>æŒ‰ç…§æˆ‘ä»¬å‰é¢è¯´çš„æ–¹æ³•ï¼Œå¯èƒ½ä½ éœ€è¦åˆ›å»ºé•¿åº¦ä¸º 12 ä»¥ä¸Šçš„å‰ç¼€ç´¢å¼•ï¼Œæ‰èƒ½å¤Ÿæ»¡è¶³åŒºåˆ†åº¦è¦æ±‚ã€‚</p><p>ä½†æ˜¯ï¼Œç´¢å¼•é€‰å–çš„è¶Šé•¿ï¼Œå ç”¨çš„ç£ç›˜ç©ºé—´å°±è¶Šå¤§ï¼Œç›¸åŒçš„æ•°æ®é¡µèƒ½æ”¾ä¸‹çš„ç´¢å¼•å€¼å°±è¶Šå°‘ï¼Œæœç´¢çš„æ•ˆç‡ä¹Ÿå°±ä¼šè¶Šä½ã€‚</p><p>é‚£ä¹ˆï¼Œå¦‚æœæˆ‘ä»¬èƒ½å¤Ÿç¡®å®šä¸šåŠ¡éœ€æ±‚é‡Œé¢åªæœ‰æŒ‰ç…§èº«ä»½è¯è¿›è¡Œç­‰å€¼æŸ¥è¯¢çš„éœ€æ±‚ï¼Œè¿˜æœ‰æ²¡æœ‰åˆ«çš„å¤„ç†æ–¹æ³•å‘¢ï¼Ÿè¿™ç§æ–¹æ³•ï¼Œæ—¢å¯ä»¥å ç”¨æ›´å°çš„ç©ºé—´ï¼Œä¹Ÿèƒ½è¾¾åˆ°ç›¸åŒçš„æŸ¥è¯¢æ•ˆç‡ã€‚</p><p>ç­”æ¡ˆæ˜¯ï¼Œæœ‰çš„ã€‚</p><p>**ç¬¬ä¸€ç§æ–¹å¼æ˜¯ä½¿ç”¨å€’åºå­˜å‚¨ã€‚**å¦‚æœä½ å­˜å‚¨èº«ä»½è¯å·çš„æ—¶å€™æŠŠå®ƒå€’è¿‡æ¥å­˜ï¼Œæ¯æ¬¡æŸ¥è¯¢çš„æ—¶å€™ï¼Œä½ å¯ä»¥è¿™ä¹ˆå†™ï¼š</p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> field_list <span class="token keyword">from</span> t <span class="token keyword">where</span> <span class="token class-name">id_card</span> <span class="token operator">=</span> <span class="token function">reverse</span><span class="token punctuation">(</span>&#39;input_id_card_string&#39;<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ç”±äºèº«ä»½è¯å·çš„æœ€å 6 ä½æ²¡æœ‰åœ°å€ç è¿™æ ·çš„é‡å¤é€»è¾‘ï¼Œæ‰€ä»¥æœ€åè¿™ 6 ä½å¾ˆå¯èƒ½å°±æä¾›äº†è¶³å¤Ÿçš„åŒºåˆ†åº¦ã€‚å½“ç„¶äº†ï¼Œå®è·µä¸­ä½ ä¸è¦å¿˜è®°ä½¿ç”¨ count(distinct) æ–¹æ³•å»åšä¸ªéªŒè¯ã€‚</p><p>**ç¬¬äºŒç§æ–¹å¼æ˜¯ä½¿ç”¨ hash å­—æ®µã€‚**ä½ å¯ä»¥åœ¨è¡¨ä¸Šå†åˆ›å»ºä¸€ä¸ªæ•´æ•°å­—æ®µï¼Œæ¥ä¿å­˜èº«ä»½è¯çš„æ ¡éªŒç ï¼ŒåŒæ—¶åœ¨è¿™ä¸ªå­—æ®µä¸Šåˆ›å»ºç´¢å¼•ã€‚</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">alter</span> <span class="token keyword">table</span> t <span class="token keyword">add</span> id_card_crc <span class="token keyword">int</span> <span class="token keyword">unsigned</span><span class="token punctuation">,</span> <span class="token keyword">add</span> <span class="token keyword">index</span><span class="token punctuation">(</span>id_card_crc<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ç„¶åæ¯æ¬¡æ’å…¥æ–°è®°å½•çš„æ—¶å€™ï¼Œéƒ½åŒæ—¶ç”¨ crc32() è¿™ä¸ªå‡½æ•°å¾—åˆ°æ ¡éªŒç å¡«åˆ°è¿™ä¸ªæ–°å­—æ®µã€‚ç”±äºæ ¡éªŒç å¯èƒ½å­˜åœ¨å†²çªï¼Œä¹Ÿå°±æ˜¯è¯´ä¸¤ä¸ªä¸åŒçš„èº«ä»½è¯å·é€šè¿‡ crc32() å‡½æ•°å¾—åˆ°çš„ç»“æœå¯èƒ½æ˜¯ç›¸åŒçš„ï¼Œæ‰€ä»¥ä½ çš„æŸ¥è¯¢è¯­å¥ where éƒ¨åˆ†è¦åˆ¤æ–­ id_card çš„å€¼æ˜¯å¦ç²¾ç¡®ç›¸åŒã€‚</p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> field_list <span class="token keyword">from</span> t <span class="token keyword">where</span> <span class="token class-name">id_card_crc</span><span class="token operator">=</span><span class="token function">crc32</span><span class="token punctuation">(</span>&#39;input_id_card_string&#39;<span class="token punctuation">)</span> <span class="token keyword">and</span> id_card<span class="token operator">=</span>&#39;input_id_card_string&#39;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>è¿™æ ·ï¼Œç´¢å¼•çš„é•¿åº¦å˜æˆäº† 4 ä¸ªå­—èŠ‚ï¼Œæ¯”åŸæ¥å°äº†å¾ˆå¤šã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†ä¸€èµ·çœ‹çœ‹<strong>ä½¿ç”¨å€’åºå­˜å‚¨å’Œä½¿ç”¨ hash å­—æ®µè¿™ä¸¤ç§æ–¹æ³•çš„å¼‚åŒç‚¹ã€‚</strong></p><p>é¦–å…ˆï¼Œå®ƒä»¬çš„ç›¸åŒç‚¹æ˜¯ï¼Œéƒ½ä¸æ”¯æŒèŒƒå›´æŸ¥è¯¢ã€‚å€’åºå­˜å‚¨çš„å­—æ®µä¸Šåˆ›å»ºçš„ç´¢å¼•æ˜¯æŒ‰ç…§å€’åºå­—ç¬¦ä¸²çš„æ–¹å¼æ’åºçš„ï¼Œå·²ç»æ²¡æœ‰åŠæ³•åˆ©ç”¨ç´¢å¼•æ–¹å¼æŸ¥å‡ºèº«ä»½è¯å·ç åœ¨ [ID_X, ID_Y] çš„æ‰€æœ‰å¸‚æ°‘äº†ã€‚åŒæ ·åœ°ï¼Œhash å­—æ®µçš„æ–¹å¼ä¹Ÿåªèƒ½æ”¯æŒç­‰å€¼æŸ¥è¯¢ã€‚</p><p>å®ƒä»¬çš„åŒºåˆ«ï¼Œä¸»è¦ä½“ç°åœ¨ä»¥ä¸‹ä¸‰ä¸ªæ–¹é¢ï¼š</p><ol><li>ä»å ç”¨çš„é¢å¤–ç©ºé—´æ¥çœ‹ï¼Œå€’åºå­˜å‚¨æ–¹å¼åœ¨ä¸»é”®ç´¢å¼•ä¸Šï¼Œä¸ä¼šæ¶ˆè€—é¢å¤–çš„å­˜å‚¨ç©ºé—´ï¼Œè€Œ hash å­—æ®µæ–¹æ³•éœ€è¦å¢åŠ ä¸€ä¸ªå­—æ®µã€‚å½“ç„¶ï¼Œå€’åºå­˜å‚¨æ–¹å¼ä½¿ç”¨ 4 ä¸ªå­—èŠ‚çš„å‰ç¼€é•¿åº¦åº”è¯¥æ˜¯ä¸å¤Ÿçš„ï¼Œå¦‚æœå†é•¿ä¸€ç‚¹ï¼Œè¿™ä¸ªæ¶ˆè€—è·Ÿé¢å¤–è¿™ä¸ª hash å­—æ®µä¹Ÿå·®ä¸å¤šæŠµæ¶ˆäº†ã€‚</li><li>åœ¨ CPU æ¶ˆè€—æ–¹é¢ï¼Œå€’åºæ–¹å¼æ¯æ¬¡å†™å’Œè¯»çš„æ—¶å€™ï¼Œéƒ½éœ€è¦é¢å¤–è°ƒç”¨ä¸€æ¬¡ reverse å‡½æ•°ï¼Œè€Œ hash å­—æ®µçš„æ–¹å¼éœ€è¦é¢å¤–è°ƒç”¨ä¸€æ¬¡ crc32() å‡½æ•°ã€‚å¦‚æœåªä»è¿™ä¸¤ä¸ªå‡½æ•°çš„è®¡ç®—å¤æ‚åº¦æ¥çœ‹çš„è¯ï¼Œreverse å‡½æ•°é¢å¤–æ¶ˆè€—çš„ CPU èµ„æºä¼šæ›´å°äº›ã€‚</li><li>ä»æŸ¥è¯¢æ•ˆç‡ä¸Šçœ‹ï¼Œä½¿ç”¨ hash å­—æ®µæ–¹å¼çš„æŸ¥è¯¢æ€§èƒ½ç›¸å¯¹æ›´ç¨³å®šä¸€äº›ã€‚å› ä¸º crc32 ç®—å‡ºæ¥çš„å€¼è™½ç„¶æœ‰å†²çªçš„æ¦‚ç‡ï¼Œä½†æ˜¯æ¦‚ç‡éå¸¸å°ï¼Œå¯ä»¥è®¤ä¸ºæ¯æ¬¡æŸ¥è¯¢çš„å¹³å‡æ‰«æè¡Œæ•°æ¥è¿‘ 1ã€‚è€Œå€’åºå­˜å‚¨æ–¹å¼æ¯•ç«Ÿè¿˜æ˜¯ç”¨çš„å‰ç¼€ç´¢å¼•çš„æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯è¯´è¿˜æ˜¯ä¼šå¢åŠ æ‰«æè¡Œæ•°ã€‚</li></ol><h4 id="å°ç»“-10" tabindex="-1"><a class="header-anchor" href="#å°ç»“-10" aria-hidden="true">#</a> å°ç»“</h4><p>åœ¨ä»Šå¤©è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘è·Ÿä½ èŠäº†èŠå­—ç¬¦ä¸²å­—æ®µåˆ›å»ºç´¢å¼•çš„åœºæ™¯ã€‚æˆ‘ä»¬æ¥å›é¡¾ä¸€ä¸‹ï¼Œä½ å¯ä»¥ä½¿ç”¨çš„æ–¹å¼æœ‰ï¼š</p><ol><li>ç›´æ¥åˆ›å»ºå®Œæ•´ç´¢å¼•ï¼Œè¿™æ ·å¯èƒ½æ¯”è¾ƒå ç”¨ç©ºé—´ï¼›</li><li>åˆ›å»ºå‰ç¼€ç´¢å¼•ï¼ŒèŠ‚çœç©ºé—´ï¼Œä½†ä¼šå¢åŠ æŸ¥è¯¢æ‰«ææ¬¡æ•°ï¼Œå¹¶ä¸”ä¸èƒ½ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼›</li><li>å€’åºå­˜å‚¨ï¼Œå†åˆ›å»ºå‰ç¼€ç´¢å¼•ï¼Œç”¨äºç»•è¿‡å­—ç¬¦ä¸²æœ¬èº«å‰ç¼€çš„åŒºåˆ†åº¦ä¸å¤Ÿçš„é—®é¢˜ï¼›</li><li>åˆ›å»º hash å­—æ®µç´¢å¼•ï¼ŒæŸ¥è¯¢æ€§èƒ½ç¨³å®šï¼Œæœ‰é¢å¤–çš„å­˜å‚¨å’Œè®¡ç®—æ¶ˆè€—ï¼Œè·Ÿç¬¬ä¸‰ç§æ–¹å¼ä¸€æ ·ï¼Œéƒ½ä¸æ”¯æŒèŒƒå›´æ‰«æã€‚</li></ol><p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œä½ è¦æ ¹æ®ä¸šåŠ¡å­—æ®µçš„ç‰¹ç‚¹é€‰æ‹©ä½¿ç”¨å“ªç§æ–¹å¼ã€‚</p><p>å¥½äº†ï¼Œåˆåˆ°äº†æœ€åçš„é—®é¢˜æ—¶é—´ã€‚</p><p>å¦‚æœä½ åœ¨ç»´æŠ¤ä¸€ä¸ªå­¦æ ¡çš„å­¦ç”Ÿä¿¡æ¯æ•°æ®åº“ï¼Œå­¦ç”Ÿç™»å½•åçš„ç»Ÿä¸€æ ¼å¼æ˜¯â€å­¦å· @gmail.com&quot;, è€Œå­¦å·çš„è§„åˆ™æ˜¯ï¼šåäº”ä½çš„æ•°å­—ï¼Œå…¶ä¸­å‰ä¸‰ä½æ˜¯æ‰€åœ¨åŸå¸‚ç¼–å·ã€ç¬¬å››åˆ°ç¬¬å…­ä½æ˜¯å­¦æ ¡ç¼–å·ã€ç¬¬ä¸ƒä½åˆ°ç¬¬åä½æ˜¯å…¥å­¦å¹´ä»½ã€æœ€åäº”ä½æ˜¯é¡ºåºç¼–å·ã€‚</p><p>ç³»ç»Ÿç™»å½•çš„æ—¶å€™éƒ½éœ€è¦å­¦ç”Ÿè¾“å…¥ç™»å½•åå’Œå¯†ç ï¼ŒéªŒè¯æ­£ç¡®åæ‰èƒ½ç»§ç»­ä½¿ç”¨ç³»ç»Ÿã€‚å°±åªè€ƒè™‘ç™»å½•éªŒè¯è¿™ä¸ªè¡Œä¸ºçš„è¯ï¼Œä½ ä¼šæ€ä¹ˆè®¾è®¡è¿™ä¸ªç™»å½•åçš„ç´¢å¼•å‘¢ï¼Ÿ</p><p>ä½ å¯ä»¥æŠŠä½ çš„åˆ†ææ€è·¯å’Œè®¾è®¡ç»“æœå†™åœ¨ç•™è¨€åŒºé‡Œï¼Œæˆ‘ä¼šåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« çš„æœ«å°¾å’Œä½ è®¨è®ºè¿™ä¸ªé—®é¢˜ã€‚æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚</p><h4 id="ä¸ŠæœŸé—®é¢˜æ—¶é—´-7" tabindex="-1"><a class="header-anchor" href="#ä¸ŠæœŸé—®é¢˜æ—¶é—´-7" aria-hidden="true">#</a> ä¸ŠæœŸé—®é¢˜æ—¶é—´</h4><p>ä¸Šç¯‡æ–‡ç« ä¸­çš„ç¬¬ä¸€ä¸ªä¾‹å­ï¼Œè¯„è®ºåŒºæœ‰å‡ ä½åŒå­¦è¯´æ²¡æœ‰å¤ç°ï¼Œå¤§å®¶è¦æ£€æŸ¥ä¸€ä¸‹éš”ç¦»çº§åˆ«æ˜¯ä¸æ˜¯ RRï¼ˆRepeatable Readï¼Œå¯é‡å¤è¯»ï¼‰ï¼Œåˆ›å»ºçš„è¡¨ t æ˜¯ä¸æ˜¯ InnoDB å¼•æ“ã€‚æˆ‘æŠŠå¤ç°è¿‡ç¨‹åšæˆäº†ä¸€ä¸ªè§†é¢‘ï¼Œä¾›ä½ å‚è€ƒã€‚</p><p>åœ¨ä¸Šä¸€ç¯‡æ–‡ç« æœ€åï¼Œæˆ‘ç»™ä½ ç•™çš„é—®é¢˜æ˜¯ï¼Œä¸ºä»€ä¹ˆç»è¿‡è¿™ä¸ªæ“ä½œåºåˆ—ï¼Œexplain çš„ç»“æœå°±ä¸å¯¹äº†ï¼Ÿè¿™é‡Œï¼Œæˆ‘æ¥ä¸ºä½ åˆ†æä¸€ä¸‹åŸå› ã€‚</p><p>delete è¯­å¥åˆ æ‰äº†æ‰€æœ‰çš„æ•°æ®ï¼Œç„¶åå†é€šè¿‡ call idata() æ’å…¥äº† 10 ä¸‡è¡Œæ•°æ®ï¼Œçœ‹ä¸Šå»æ˜¯è¦†ç›–äº†åŸæ¥çš„ 10 ä¸‡è¡Œã€‚</p><p>ä½†æ˜¯ï¼Œsession A å¼€å¯äº†äº‹åŠ¡å¹¶æ²¡æœ‰æäº¤ï¼Œæ‰€ä»¥ä¹‹å‰æ’å…¥çš„ 10 ä¸‡è¡Œæ•°æ®æ˜¯ä¸èƒ½åˆ é™¤çš„ã€‚è¿™æ ·ï¼Œä¹‹å‰çš„æ•°æ®æ¯ä¸€è¡Œæ•°æ®éƒ½æœ‰ä¸¤ä¸ªç‰ˆæœ¬ï¼Œæ—§ç‰ˆæœ¬æ˜¯ delete ä¹‹å‰çš„æ•°æ®ï¼Œæ–°ç‰ˆæœ¬æ˜¯æ ‡è®°ä¸º deleted çš„æ•°æ®ã€‚</p><p>è¿™æ ·ï¼Œç´¢å¼• a ä¸Šçš„æ•°æ®å…¶å®å°±æœ‰ä¸¤ä»½ã€‚</p><p>ç„¶åä½ ä¼šè¯´ï¼Œä¸å¯¹å•Šï¼Œä¸»é”®ä¸Šçš„æ•°æ®ä¹Ÿä¸èƒ½åˆ ï¼Œé‚£æ²¡æœ‰ä½¿ç”¨ force index çš„è¯­å¥ï¼Œä½¿ç”¨ explain å‘½ä»¤çœ‹åˆ°çš„æ‰«æè¡Œæ•°ä¸ºä»€ä¹ˆè¿˜æ˜¯ 100000 å·¦å³ï¼Ÿï¼ˆæ½œå°è¯ï¼Œå¦‚æœè¿™ä¸ªä¹Ÿç¿»å€ï¼Œä¹Ÿè®¸ä¼˜åŒ–å™¨è¿˜ä¼šè®¤ä¸ºé€‰å­—æ®µ a ä½œä¸ºç´¢å¼•æ›´åˆé€‚ï¼‰</p><p>æ˜¯çš„ï¼Œä¸è¿‡è¿™ä¸ªæ˜¯ä¸»é”®ï¼Œä¸»é”®æ˜¯ç›´æ¥æŒ‰ç…§è¡¨çš„è¡Œæ•°æ¥ä¼°è®¡çš„ã€‚è€Œè¡¨çš„è¡Œæ•°ï¼Œä¼˜åŒ–å™¨ç›´æ¥ç”¨çš„æ˜¯ show table status çš„å€¼ã€‚</p><p>è¿™ä¸ªå€¼çš„è®¡ç®—æ–¹æ³•ï¼Œæˆ‘ä¼šåœ¨åé¢æœ‰æ–‡ç« ä¸ºä½ è¯¦ç»†è®²è§£ã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/e0e4c8381f3feae4d87958470760d367-1584367389807.png" alt="img">è¯„è®ºåŒºç•™è¨€ç‚¹èµæ¿ï¼š</p><blockquote><p>@æ–œé¢é•œå­ Bill çš„è¯„è®ºæœ€æ¥è¿‘ç­”æ¡ˆï¼› @æŸã€äºº åšäº†ä¸¤ä¸ªå¾ˆä¸é”™çš„å¯¹ç…§è¯•éªŒï¼› @ye7zi ç­‰å‡ ä½åŒå­¦å¾ˆè®¤çœŸçš„éªŒè¯ï¼Œèµæ€åº¦ã€‚å¤§å®¶çš„æœºå™¨å¦‚æœ IO èƒ½åŠ›æ¯”è¾ƒå·®çš„è¯ï¼Œåšè¿™ä¸ªéªŒè¯çš„æ—¶å€™ï¼Œå¯ä»¥æŠŠ innodb_flush_log_at_trx_commit å’Œ sync_binlog éƒ½è®¾ç½®æˆ 0ã€‚</p></blockquote><h3 id="_16-order-by-æ˜¯æ€ä¹ˆå·¥ä½œçš„" tabindex="-1"><a class="header-anchor" href="#_16-order-by-æ˜¯æ€ä¹ˆå·¥ä½œçš„" aria-hidden="true">#</a> 16 â€œorder byâ€æ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼Ÿ</h3><p>åœ¨ä½ å¼€å‘åº”ç”¨çš„æ—¶å€™ï¼Œä¸€å®šä¼šç»å¸¸ç¢°åˆ°éœ€è¦æ ¹æ®æŒ‡å®šçš„å­—æ®µæ’åºæ¥æ˜¾ç¤ºç»“æœçš„éœ€æ±‚ã€‚è¿˜æ˜¯ä»¥æˆ‘ä»¬å‰é¢ä¸¾ä¾‹ç”¨è¿‡çš„å¸‚æ°‘è¡¨ä¸ºä¾‹ï¼Œå‡è®¾ä½ è¦æŸ¥è¯¢åŸå¸‚æ˜¯â€œæ­å·â€çš„æ‰€æœ‰äººåå­—ï¼Œå¹¶ä¸”æŒ‰ç…§å§“åæ’åºè¿”å›å‰ 1000 ä¸ªäººçš„å§“åã€å¹´é¾„ã€‚</p><p>å‡è®¾è¿™ä¸ªè¡¨çš„éƒ¨åˆ†å®šä¹‰æ˜¯è¿™æ ·çš„ï¼š</p><div class="language-r line-numbers-mode" data-ext="r"><pre class="language-r"><code>CREATE TABLE `t` <span class="token punctuation">(</span>
  `id` int<span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> NOT <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  `city` varchar<span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span> NOT <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  `name` varchar<span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span> NOT <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  `age` int<span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> NOT <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  `addr` varchar<span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> DEFAULT <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  PRIMARY KEY <span class="token punctuation">(</span>`id`<span class="token punctuation">)</span><span class="token punctuation">,</span>
  KEY `city` <span class="token punctuation">(</span>`city`<span class="token punctuation">)</span>
<span class="token punctuation">)</span> ENGINE<span class="token operator">=</span>InnoDB<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ—¶ï¼Œä½ çš„ SQL è¯­å¥å¯ä»¥è¿™ä¹ˆå†™ï¼š</p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">select</span> city<span class="token punctuation">,</span>name<span class="token punctuation">,</span>age <span class="token keyword">from</span> t <span class="token keyword">where</span> <span class="token class-name">city</span><span class="token operator">=</span>&#39;æ­å·&#39; order <span class="token keyword">by</span> name limit <span class="token number">1000</span>  <span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>è¿™ä¸ªè¯­å¥çœ‹ä¸Šå»é€»è¾‘å¾ˆæ¸…æ™°ï¼Œä½†æ˜¯ä½ äº†è§£å®ƒçš„æ‰§è¡Œæµç¨‹å—ï¼Ÿä»Šå¤©ï¼Œæˆ‘å°±å’Œä½ èŠèŠè¿™ä¸ªè¯­å¥æ˜¯æ€ä¹ˆæ‰§è¡Œçš„ï¼Œä»¥åŠæœ‰ä»€ä¹ˆå‚æ•°ä¼šå½±å“æ‰§è¡Œçš„è¡Œä¸ºã€‚</p><h4 id="å…¨å­—æ®µæ’åº" tabindex="-1"><a class="header-anchor" href="#å…¨å­—æ®µæ’åº" aria-hidden="true">#</a> å…¨å­—æ®µæ’åº</h4><p>å‰é¢æˆ‘ä»¬ä»‹ç»è¿‡ç´¢å¼•ï¼Œæ‰€ä»¥ä½ ç°åœ¨å°±å¾ˆæ¸…æ¥šäº†ï¼Œä¸ºé¿å…å…¨è¡¨æ‰«æï¼Œæˆ‘ä»¬éœ€è¦åœ¨ city å­—æ®µåŠ ä¸Šç´¢å¼•ã€‚</p><p>åœ¨ city å­—æ®µä¸Šåˆ›å»ºç´¢å¼•ä¹‹åï¼Œæˆ‘ä»¬ç”¨ explain å‘½ä»¤æ¥çœ‹çœ‹è¿™ä¸ªè¯­å¥çš„æ‰§è¡Œæƒ…å†µã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/826579b63225def812330ef6c344a303-1584367390630.png" alt="img"></p><p>å›¾ 1 ä½¿ç”¨ explain å‘½ä»¤æŸ¥çœ‹è¯­å¥çš„æ‰§è¡Œæƒ…å†µ</p><p>Extra è¿™ä¸ªå­—æ®µä¸­çš„â€œUsing filesortâ€è¡¨ç¤ºçš„å°±æ˜¯éœ€è¦æ’åºï¼ŒMySQL ä¼šç»™æ¯ä¸ªçº¿ç¨‹åˆ†é…ä¸€å—å†…å­˜ç”¨äºæ’åºï¼Œç§°ä¸º sort_bufferã€‚</p><p>ä¸ºäº†è¯´æ˜è¿™ä¸ª SQL æŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹ city è¿™ä¸ªç´¢å¼•çš„ç¤ºæ„å›¾ã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/5334cca9118be14bde95ec94b02f0a3e-1584367390633.png" alt="img"></p><p>å›¾ 2 city å­—æ®µçš„ç´¢å¼•ç¤ºæ„å›¾</p><p>ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæ»¡è¶³ city=&#39;æ­å·â€™æ¡ä»¶çš„è¡Œï¼Œæ˜¯ä» ID_X åˆ° ID_(X+N) çš„è¿™äº›è®°å½•ã€‚</p><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œè¿™ä¸ªè¯­å¥æ‰§è¡Œæµç¨‹å¦‚ä¸‹æ‰€ç¤º ï¼š</p><ol><li>åˆå§‹åŒ– sort_bufferï¼Œç¡®å®šæ”¾å…¥ nameã€cityã€age è¿™ä¸‰ä¸ªå­—æ®µï¼›</li><li>ä»ç´¢å¼• city æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³ city=&#39;æ­å·â€™æ¡ä»¶çš„ä¸»é”® idï¼Œä¹Ÿå°±æ˜¯å›¾ä¸­çš„ ID_Xï¼›</li><li>åˆ°ä¸»é”® id ç´¢å¼•å–å‡ºæ•´è¡Œï¼Œå– nameã€cityã€age ä¸‰ä¸ªå­—æ®µçš„å€¼ï¼Œå­˜å…¥ sort_buffer ä¸­ï¼›</li><li>ä»ç´¢å¼• city å–ä¸‹ä¸€ä¸ªè®°å½•çš„ä¸»é”® idï¼›</li><li>é‡å¤æ­¥éª¤ 3ã€4 ç›´åˆ° city çš„å€¼ä¸æ»¡è¶³æŸ¥è¯¢æ¡ä»¶ä¸ºæ­¢ï¼Œå¯¹åº”çš„ä¸»é”® id ä¹Ÿå°±æ˜¯å›¾ä¸­çš„ ID_Yï¼›</li><li>å¯¹ sort_buffer ä¸­çš„æ•°æ®æŒ‰ç…§å­—æ®µ name åšå¿«é€Ÿæ’åºï¼›</li><li>æŒ‰ç…§æ’åºç»“æœå–å‰ 1000 è¡Œè¿”å›ç»™å®¢æˆ·ç«¯ã€‚</li></ol><p>æˆ‘ä»¬æš‚ä¸”æŠŠè¿™ä¸ªæ’åºè¿‡ç¨‹ï¼Œç§°ä¸ºå…¨å­—æ®µæ’åºï¼Œæ‰§è¡Œæµç¨‹çš„ç¤ºæ„å›¾å¦‚ä¸‹æ‰€ç¤ºï¼Œä¸‹ä¸€ç¯‡æ–‡ç« ä¸­æˆ‘ä»¬è¿˜ä¼šç”¨åˆ°è¿™ä¸ªæ’åºã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/6c821828cddf46670f9d56e126e3e772-1584367392861.jpg" alt="img"></p><p>å›¾ 3 å…¨å­—æ®µæ’åº</p><p>å›¾ä¸­â€œæŒ‰ name æ’åºâ€è¿™ä¸ªåŠ¨ä½œï¼Œå¯èƒ½åœ¨å†…å­˜ä¸­å®Œæˆï¼Œä¹Ÿå¯èƒ½éœ€è¦ä½¿ç”¨å¤–éƒ¨æ’åºï¼Œè¿™å–å†³äºæ’åºæ‰€éœ€çš„å†…å­˜å’Œå‚æ•° sort_buffer_sizeã€‚</p><p>sort_buffer_sizeï¼Œå°±æ˜¯ MySQL ä¸ºæ’åºå¼€è¾Ÿçš„å†…å­˜ï¼ˆsort_bufferï¼‰çš„å¤§å°ã€‚å¦‚æœè¦æ’åºçš„æ•°æ®é‡å°äº sort_buffer_sizeï¼Œæ’åºå°±åœ¨å†…å­˜ä¸­å®Œæˆã€‚ä½†å¦‚æœæ’åºæ•°æ®é‡å¤ªå¤§ï¼Œå†…å­˜æ”¾ä¸ä¸‹ï¼Œåˆ™ä¸å¾—ä¸åˆ©ç”¨ç£ç›˜ä¸´æ—¶æ–‡ä»¶è¾…åŠ©æ’åºã€‚</p><p>ä½ å¯ä»¥ç”¨ä¸‹é¢ä»‹ç»çš„æ–¹æ³•ï¼Œæ¥ç¡®å®šä¸€ä¸ªæ’åºè¯­å¥æ˜¯å¦ä½¿ç”¨äº†ä¸´æ—¶æ–‡ä»¶ã€‚</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">/* æ‰“å¼€ optimizer_traceï¼Œåªå¯¹æœ¬çº¿ç¨‹æœ‰æ•ˆ */</span>
<span class="token keyword">SET</span> optimizer_trace<span class="token operator">=</span><span class="token string">&#39;enabled=on&#39;</span><span class="token punctuation">;</span>  
<span class="token comment">/* @a ä¿å­˜ Innodb_rows_read çš„åˆå§‹å€¼ */</span>
<span class="token keyword">select</span> VARIABLE_VALUE <span class="token keyword">into</span> <span class="token variable">@a</span> <span class="token keyword">from</span>  performance_schema<span class="token punctuation">.</span>session_status <span class="token keyword">where</span> variable_name <span class="token operator">=</span> <span class="token string">&#39;Innodb_rows_read&#39;</span><span class="token punctuation">;</span> 
<span class="token comment">/* æ‰§è¡Œè¯­å¥ */</span>
<span class="token keyword">select</span> city<span class="token punctuation">,</span> name<span class="token punctuation">,</span>age <span class="token keyword">from</span> t <span class="token keyword">where</span> city<span class="token operator">=</span><span class="token string">&#39;æ­å·&#39;</span> <span class="token keyword">order</span> <span class="token keyword">by</span> name <span class="token keyword">limit</span> <span class="token number">1000</span><span class="token punctuation">;</span>  
<span class="token comment">/* æŸ¥çœ‹ OPTIMIZER_TRACE è¾“å‡º */</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>information_schema<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>OPTIMIZER_TRACE<span class="token punctuation">`</span></span>\G 
<span class="token comment">/* @b ä¿å­˜ Innodb_rows_read çš„å½“å‰å€¼ */</span>
<span class="token keyword">select</span> VARIABLE_VALUE <span class="token keyword">into</span> <span class="token variable">@b</span> <span class="token keyword">from</span> performance_schema<span class="token punctuation">.</span>session_status <span class="token keyword">where</span> variable_name <span class="token operator">=</span> <span class="token string">&#39;Innodb_rows_read&#39;</span><span class="token punctuation">;</span> 
<span class="token comment">/* è®¡ç®— Innodb_rows_read å·®å€¼ */</span>
<span class="token keyword">select</span> <span class="token variable">@b</span><span class="token operator">-</span><span class="token variable">@a</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªæ–¹æ³•æ˜¯é€šè¿‡æŸ¥çœ‹ OPTIMIZER_TRACE çš„ç»“æœæ¥ç¡®è®¤çš„ï¼Œä½ å¯ä»¥ä» number_of_tmp_files ä¸­çœ‹åˆ°æ˜¯å¦ä½¿ç”¨äº†ä¸´æ—¶æ–‡ä»¶ã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/89baf99cdeefe90a22370e1d6f5e6495-1584367392864.png" alt="img"></p><p>å›¾ 4 å…¨æ’åºçš„ OPTIMIZER_TRACE éƒ¨åˆ†ç»“æœ</p><p>number_of_tmp_files è¡¨ç¤ºçš„æ˜¯ï¼Œæ’åºè¿‡ç¨‹ä¸­ä½¿ç”¨çš„ä¸´æ—¶æ–‡ä»¶æ•°ã€‚ä½ ä¸€å®šå¥‡æ€ªï¼Œä¸ºä»€ä¹ˆéœ€è¦ 12 ä¸ªæ–‡ä»¶ï¼Ÿå†…å­˜æ”¾ä¸ä¸‹æ—¶ï¼Œå°±éœ€è¦ä½¿ç”¨å¤–éƒ¨æ’åºï¼Œå¤–éƒ¨æ’åºä¸€èˆ¬ä½¿ç”¨å½’å¹¶æ’åºç®—æ³•ã€‚å¯ä»¥è¿™ä¹ˆç®€å•ç†è§£ï¼Œ<strong>MySQL å°†éœ€è¦æ’åºçš„æ•°æ®åˆ†æˆ 12 ä»½ï¼Œæ¯ä¸€ä»½å•ç‹¬æ’åºåå­˜åœ¨è¿™äº›ä¸´æ—¶æ–‡ä»¶ä¸­ã€‚ç„¶åæŠŠè¿™ 12 ä¸ªæœ‰åºæ–‡ä»¶å†åˆå¹¶æˆä¸€ä¸ªæœ‰åºçš„å¤§æ–‡ä»¶ã€‚</strong></p><p>å¦‚æœ sort_buffer_size è¶…è¿‡äº†éœ€è¦æ’åºçš„æ•°æ®é‡çš„å¤§å°ï¼Œnumber_of_tmp_files å°±æ˜¯ 0ï¼Œè¡¨ç¤ºæ’åºå¯ä»¥ç›´æ¥åœ¨å†…å­˜ä¸­å®Œæˆã€‚</p><p>å¦åˆ™å°±éœ€è¦æ”¾åœ¨ä¸´æ—¶æ–‡ä»¶ä¸­æ’åºã€‚sort_buffer_size è¶Šå°ï¼Œéœ€è¦åˆ†æˆçš„ä»½æ•°è¶Šå¤šï¼Œnumber_of_tmp_files çš„å€¼å°±è¶Šå¤§ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘å†å’Œä½ è§£é‡Šä¸€ä¸‹å›¾ 4 ä¸­å…¶ä»–ä¸¤ä¸ªå€¼çš„æ„æ€ã€‚</p><p>æˆ‘ä»¬çš„ç¤ºä¾‹è¡¨ä¸­æœ‰ 4000 æ¡æ»¡è¶³ city=&#39;æ­å·â€™çš„è®°å½•ï¼Œæ‰€ä»¥ä½ å¯ä»¥çœ‹åˆ° examined_rows=4000ï¼Œè¡¨ç¤ºå‚ä¸æ’åºçš„è¡Œæ•°æ˜¯ 4000 è¡Œã€‚</p><p>sort_mode é‡Œé¢çš„ packed_additional_fields çš„æ„æ€æ˜¯ï¼Œæ’åºè¿‡ç¨‹å¯¹å­—ç¬¦ä¸²åšäº†â€œç´§å‡‘â€å¤„ç†ã€‚å³ä½¿ name å­—æ®µçš„å®šä¹‰æ˜¯ varchar(16)ï¼Œåœ¨æ’åºè¿‡ç¨‹ä¸­è¿˜æ˜¯è¦æŒ‰ç…§å®é™…é•¿åº¦æ¥åˆ†é…ç©ºé—´çš„ã€‚</p><p>åŒæ—¶ï¼Œæœ€åä¸€ä¸ªæŸ¥è¯¢è¯­å¥ select @b-@a çš„è¿”å›ç»“æœæ˜¯ 4000ï¼Œè¡¨ç¤ºæ•´ä¸ªæ‰§è¡Œè¿‡ç¨‹åªæ‰«æäº† 4000 è¡Œã€‚</p><p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸ºäº†é¿å…å¯¹ç»“è®ºé€ æˆå¹²æ‰°ï¼Œæˆ‘æŠŠ internal_tmp_disk_storage_engine è®¾ç½®æˆ MyISAMã€‚å¦åˆ™ï¼Œselect @b-@a çš„ç»“æœä¼šæ˜¾ç¤ºä¸º 4001ã€‚</p><p>è¿™æ˜¯å› ä¸ºæŸ¥è¯¢ OPTIMIZER_TRACE è¿™ä¸ªè¡¨æ—¶ï¼Œéœ€è¦ç”¨åˆ°ä¸´æ—¶è¡¨ï¼Œè€Œ internal_tmp_disk_storage_engine çš„é»˜è®¤å€¼æ˜¯ InnoDBã€‚å¦‚æœä½¿ç”¨çš„æ˜¯ InnoDB å¼•æ“çš„è¯ï¼ŒæŠŠæ•°æ®ä»ä¸´æ—¶è¡¨å–å‡ºæ¥çš„æ—¶å€™ï¼Œä¼šè®© Innodb_rows_read çš„å€¼åŠ  1ã€‚</p><h4 id="rowid-æ’åº" tabindex="-1"><a class="header-anchor" href="#rowid-æ’åº" aria-hidden="true">#</a> rowid æ’åº</h4><p>åœ¨ä¸Šé¢è¿™ä¸ªç®—æ³•è¿‡ç¨‹é‡Œé¢ï¼Œåªå¯¹åŸè¡¨çš„æ•°æ®è¯»äº†ä¸€éï¼Œå‰©ä¸‹çš„æ“ä½œéƒ½æ˜¯åœ¨ sort_buffer å’Œä¸´æ—¶æ–‡ä»¶ä¸­æ‰§è¡Œçš„ã€‚ä½†è¿™ä¸ªç®—æ³•æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å¦‚æœæŸ¥è¯¢è¦è¿”å›çš„å­—æ®µå¾ˆå¤šçš„è¯ï¼Œé‚£ä¹ˆ sort_buffer é‡Œé¢è¦æ”¾çš„å­—æ®µæ•°å¤ªå¤šï¼Œè¿™æ ·å†…å­˜é‡Œèƒ½å¤ŸåŒæ—¶æ”¾ä¸‹çš„è¡Œæ•°å¾ˆå°‘ï¼Œè¦åˆ†æˆå¾ˆå¤šä¸ªä¸´æ—¶æ–‡ä»¶ï¼Œæ’åºçš„æ€§èƒ½ä¼šå¾ˆå·®ã€‚</p><p>æ‰€ä»¥å¦‚æœå•è¡Œå¾ˆå¤§ï¼Œè¿™ä¸ªæ–¹æ³•æ•ˆç‡ä¸å¤Ÿå¥½ã€‚</p><p>é‚£ä¹ˆï¼Œ<strong>å¦‚æœ MySQL è®¤ä¸ºæ’åºçš„å•è¡Œé•¿åº¦å¤ªå¤§ä¼šæ€ä¹ˆåšå‘¢ï¼Ÿ</strong></p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘æ¥ä¿®æ”¹ä¸€ä¸ªå‚æ•°ï¼Œè®© MySQL é‡‡ç”¨å¦å¤–ä¸€ç§ç®—æ³•ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">SET</span> max_length_for_sort_data <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>max_length_for_sort_dataï¼Œæ˜¯ MySQL ä¸­ä¸“é—¨æ§åˆ¶ç”¨äºæ’åºçš„è¡Œæ•°æ®çš„é•¿åº¦çš„ä¸€ä¸ªå‚æ•°ã€‚å®ƒçš„æ„æ€æ˜¯ï¼Œå¦‚æœå•è¡Œçš„é•¿åº¦è¶…è¿‡è¿™ä¸ªå€¼ï¼ŒMySQL å°±è®¤ä¸ºå•è¡Œå¤ªå¤§ï¼Œè¦æ¢ä¸€ä¸ªç®—æ³•ã€‚</p><p>cityã€nameã€age è¿™ä¸‰ä¸ªå­—æ®µçš„å®šä¹‰æ€»é•¿åº¦æ˜¯ 36ï¼Œæˆ‘æŠŠ max_length_for_sort_data è®¾ç½®ä¸º 16ï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹è®¡ç®—è¿‡ç¨‹æœ‰ä»€ä¹ˆæ”¹å˜ã€‚</p><p>æ–°çš„ç®—æ³•æ”¾å…¥ sort_buffer çš„å­—æ®µï¼Œåªæœ‰è¦æ’åºçš„åˆ—ï¼ˆå³ name å­—æ®µï¼‰å’Œä¸»é”® idã€‚</p><p>ä½†è¿™æ—¶ï¼Œæ’åºçš„ç»“æœå°±å› ä¸ºå°‘äº† city å’Œ age å­—æ®µçš„å€¼ï¼Œä¸èƒ½ç›´æ¥è¿”å›äº†ï¼Œæ•´ä¸ªæ‰§è¡Œæµç¨‹å°±å˜æˆå¦‚ä¸‹æ‰€ç¤ºçš„æ ·å­ï¼š</p><ol><li>åˆå§‹åŒ– sort_bufferï¼Œç¡®å®šæ”¾å…¥ä¸¤ä¸ªå­—æ®µï¼Œå³ name å’Œ idï¼›</li><li>ä»ç´¢å¼• city æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³ city=&#39;æ­å·â€™æ¡ä»¶çš„ä¸»é”® idï¼Œä¹Ÿå°±æ˜¯å›¾ä¸­çš„ ID_Xï¼›</li><li>åˆ°ä¸»é”® id ç´¢å¼•å–å‡ºæ•´è¡Œï¼Œå– nameã€id è¿™ä¸¤ä¸ªå­—æ®µï¼Œå­˜å…¥ sort_buffer ä¸­ï¼›</li><li>ä»ç´¢å¼• city å–ä¸‹ä¸€ä¸ªè®°å½•çš„ä¸»é”® idï¼›</li><li>é‡å¤æ­¥éª¤ 3ã€4 ç›´åˆ°ä¸æ»¡è¶³ city=&#39;æ­å·â€™æ¡ä»¶ä¸ºæ­¢ï¼Œä¹Ÿå°±æ˜¯å›¾ä¸­çš„ ID_Yï¼›</li><li>å¯¹ sort_buffer ä¸­çš„æ•°æ®æŒ‰ç…§å­—æ®µ name è¿›è¡Œæ’åºï¼›</li><li>éå†æ’åºç»“æœï¼Œå–å‰ 1000 è¡Œï¼Œå¹¶æŒ‰ç…§ id çš„å€¼å›åˆ°åŸè¡¨ä¸­å–å‡º cityã€name å’Œ age ä¸‰ä¸ªå­—æ®µè¿”å›ç»™å®¢æˆ·ç«¯ã€‚</li></ol><p>è¿™ä¸ªæ‰§è¡Œæµç¨‹çš„ç¤ºæ„å›¾å¦‚ä¸‹ï¼Œæˆ‘æŠŠå®ƒç§°ä¸º rowid æ’åºã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/dc92b67721171206a302eb679c83e86d-1584367392864.jpg" alt="img"></p><p>å›¾ 5 rowid æ’åº</p><p>å¯¹æ¯”å›¾ 3 çš„å…¨å­—æ®µæ’åºæµç¨‹å›¾ä½ ä¼šå‘ç°ï¼Œrowid æ’åºå¤šè®¿é—®äº†ä¸€æ¬¡è¡¨ t çš„ä¸»é”®ç´¢å¼•ï¼Œå°±æ˜¯æ­¥éª¤ 7ã€‚</p><p>éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œæœ€åçš„â€œç»“æœé›†â€æ˜¯ä¸€ä¸ªé€»è¾‘æ¦‚å¿µï¼Œå®é™…ä¸Š MySQL æœåŠ¡ç«¯ä»æ’åºåçš„ sort_buffer ä¸­ä¾æ¬¡å–å‡º idï¼Œç„¶ååˆ°åŸè¡¨æŸ¥åˆ° cityã€name å’Œ age è¿™ä¸‰ä¸ªå­—æ®µçš„ç»“æœï¼Œä¸éœ€è¦åœ¨æœåŠ¡ç«¯å†è€—è´¹å†…å­˜å­˜å‚¨ç»“æœï¼Œæ˜¯ç›´æ¥è¿”å›ç»™å®¢æˆ·ç«¯çš„ã€‚</p><p>æ ¹æ®è¿™ä¸ªè¯´æ˜è¿‡ç¨‹å’Œå›¾ç¤ºï¼Œä½ å¯ä»¥æƒ³ä¸€ä¸‹ï¼Œè¿™ä¸ªæ—¶å€™æ‰§è¡Œ select @b-@aï¼Œç»“æœä¼šæ˜¯å¤šå°‘å‘¢ï¼Ÿ</p><p>ç°åœ¨ï¼Œæˆ‘ä»¬å°±æ¥çœ‹çœ‹ç»“æœæœ‰ä»€ä¹ˆä¸åŒã€‚</p><p>é¦–å…ˆï¼Œå›¾ä¸­çš„ examined_rows çš„å€¼è¿˜æ˜¯ 4000ï¼Œè¡¨ç¤ºç”¨äºæ’åºçš„æ•°æ®æ˜¯ 4000 è¡Œã€‚ä½†æ˜¯ select @b-@a è¿™ä¸ªè¯­å¥çš„å€¼å˜æˆ 5000 äº†ã€‚</p><p>å› ä¸ºè¿™æ—¶å€™é™¤äº†æ’åºè¿‡ç¨‹å¤–ï¼Œåœ¨æ’åºå®Œæˆåï¼Œè¿˜è¦æ ¹æ® id å»åŸè¡¨å–å€¼ã€‚ç”±äºè¯­å¥æ˜¯ limit 1000ï¼Œå› æ­¤ä¼šå¤šè¯» 1000 è¡Œã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/27f164804d1a4689718291be5d10f89b-1584367392865.png" alt="img"></p><p>å›¾ 6 rowid æ’åºçš„ OPTIMIZER_TRACE éƒ¨åˆ†è¾“å‡º</p><p>ä» OPTIMIZER_TRACE çš„ç»“æœä¸­ï¼Œä½ è¿˜èƒ½çœ‹åˆ°å¦å¤–ä¸¤ä¸ªä¿¡æ¯ä¹Ÿå˜äº†ã€‚</p><ul><li>sort_mode å˜æˆäº† &lt;sort_key, rowid&gt;ï¼Œè¡¨ç¤ºå‚ä¸æ’åºçš„åªæœ‰ name å’Œ id è¿™ä¸¤ä¸ªå­—æ®µã€‚</li><li>number_of_tmp_files å˜æˆ 10 äº†ï¼Œæ˜¯å› ä¸ºè¿™æ—¶å€™å‚ä¸æ’åºçš„è¡Œæ•°è™½ç„¶ä»ç„¶æ˜¯ 4000 è¡Œï¼Œä½†æ˜¯æ¯ä¸€è¡Œéƒ½å˜å°äº†ï¼Œå› æ­¤éœ€è¦æ’åºçš„æ€»æ•°æ®é‡å°±å˜å°äº†ï¼Œéœ€è¦çš„ä¸´æ—¶æ–‡ä»¶ä¹Ÿç›¸åº”åœ°å˜å°‘äº†ã€‚</li></ul><h4 id="å…¨å­—æ®µæ’åº-vs-rowid-æ’åº" tabindex="-1"><a class="header-anchor" href="#å…¨å­—æ®µæ’åº-vs-rowid-æ’åº" aria-hidden="true">#</a> å…¨å­—æ®µæ’åº VS rowid æ’åº</h4><p>æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹ï¼Œä»è¿™ä¸¤ä¸ªæ‰§è¡Œæµç¨‹é‡Œï¼Œè¿˜èƒ½å¾—å‡ºä»€ä¹ˆç»“è®ºã€‚</p><p>å¦‚æœ MySQL å®åœ¨æ˜¯æ‹…å¿ƒæ’åºå†…å­˜å¤ªå°ï¼Œä¼šå½±å“æ’åºæ•ˆç‡ï¼Œæ‰ä¼šé‡‡ç”¨ rowid æ’åºç®—æ³•ï¼Œè¿™æ ·æ’åºè¿‡ç¨‹ä¸­ä¸€æ¬¡å¯ä»¥æ’åºæ›´å¤šè¡Œï¼Œä½†æ˜¯éœ€è¦å†å›åˆ°åŸè¡¨å»å–æ•°æ®ã€‚</p><p>å¦‚æœ MySQL è®¤ä¸ºå†…å­˜è¶³å¤Ÿå¤§ï¼Œä¼šä¼˜å…ˆé€‰æ‹©å…¨å­—æ®µæ’åºï¼ŒæŠŠéœ€è¦çš„å­—æ®µéƒ½æ”¾åˆ° sort_buffer ä¸­ï¼Œè¿™æ ·æ’åºåå°±ä¼šç›´æ¥ä»å†…å­˜é‡Œé¢è¿”å›æŸ¥è¯¢ç»“æœäº†ï¼Œä¸ç”¨å†å›åˆ°åŸè¡¨å»å–æ•°æ®ã€‚</p><p>è¿™ä¹Ÿå°±ä½“ç°äº† MySQL çš„ä¸€ä¸ªè®¾è®¡æ€æƒ³ï¼š<strong>å¦‚æœå†…å­˜å¤Ÿï¼Œå°±è¦å¤šåˆ©ç”¨å†…å­˜ï¼Œå°½é‡å‡å°‘ç£ç›˜è®¿é—®ã€‚</strong></p><p>å¯¹äº InnoDB è¡¨æ¥è¯´ï¼Œrowid æ’åºä¼šè¦æ±‚å›è¡¨å¤šé€ æˆç£ç›˜è¯»ï¼Œå› æ­¤ä¸ä¼šè¢«ä¼˜å…ˆé€‰æ‹©ã€‚</p><p>è¿™ä¸ªç»“è®ºçœ‹ä¸Šå»æœ‰ç‚¹åºŸè¯çš„æ„Ÿè§‰ï¼Œä½†æ˜¯ä½ è¦è®°ä½å®ƒï¼Œä¸‹ä¸€ç¯‡æ–‡ç« æˆ‘ä»¬å°±ä¼šç”¨åˆ°ã€‚</p><p>çœ‹åˆ°è¿™é‡Œï¼Œä½ å°±äº†è§£äº†ï¼ŒMySQL åšæ’åºæ˜¯ä¸€ä¸ªæˆæœ¬æ¯”è¾ƒé«˜çš„æ“ä½œã€‚é‚£ä¹ˆä½ ä¼šé—®ï¼Œæ˜¯ä¸æ˜¯æ‰€æœ‰çš„ order by éƒ½éœ€è¦æ’åºæ“ä½œå‘¢ï¼Ÿå¦‚æœä¸æ’åºå°±èƒ½å¾—åˆ°æ­£ç¡®çš„ç»“æœï¼Œé‚£å¯¹ç³»ç»Ÿçš„æ¶ˆè€—ä¼šå°å¾ˆå¤šï¼Œè¯­å¥çš„æ‰§è¡Œæ—¶é—´ä¹Ÿä¼šå˜å¾—æ›´çŸ­ã€‚</p><p>å…¶å®ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„ order by è¯­å¥ï¼Œéƒ½éœ€è¦æ’åºæ“ä½œçš„ã€‚ä»ä¸Šé¢åˆ†æçš„æ‰§è¡Œè¿‡ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒMySQL ä¹‹æ‰€ä»¥éœ€è¦ç”Ÿæˆä¸´æ—¶è¡¨ï¼Œå¹¶ä¸”åœ¨ä¸´æ—¶è¡¨ä¸Šåšæ’åºæ“ä½œï¼Œ<strong>å…¶åŸå› æ˜¯åŸæ¥çš„æ•°æ®éƒ½æ˜¯æ— åºçš„ã€‚</strong></p><p>ä½ å¯ä»¥è®¾æƒ³ä¸‹ï¼Œå¦‚æœèƒ½å¤Ÿä¿è¯ä» city è¿™ä¸ªç´¢å¼•ä¸Šå–å‡ºæ¥çš„è¡Œï¼Œå¤©ç„¶å°±æ˜¯æŒ‰ç…§ name é€’å¢æ’åºçš„è¯ï¼Œæ˜¯ä¸æ˜¯å°±å¯ä»¥ä¸ç”¨å†æ’åºäº†å‘¢ï¼Ÿ</p><p>ç¡®å®æ˜¯è¿™æ ·çš„ã€‚</p><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿™ä¸ªå¸‚æ°‘è¡¨ä¸Šåˆ›å»ºä¸€ä¸ª city å’Œ name çš„è”åˆç´¢å¼•ï¼Œå¯¹åº”çš„ SQL è¯­å¥æ˜¯ï¼š</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">alter</span> <span class="token keyword">table</span> t <span class="token keyword">add</span> <span class="token keyword">index</span> city_user<span class="token punctuation">(</span>city<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ä½œä¸ºä¸ city ç´¢å¼•çš„å¯¹æ¯”ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªç´¢å¼•çš„ç¤ºæ„å›¾ã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/f980201372b676893647fb17fac4e2bf-1584367392865.png" alt="img"></p><p>å›¾ 7 city å’Œ name è”åˆç´¢å¼•ç¤ºæ„å›¾</p><p>åœ¨è¿™ä¸ªç´¢å¼•é‡Œé¢ï¼Œæˆ‘ä»¬ä¾ç„¶å¯ä»¥ç”¨æ ‘æœç´¢çš„æ–¹å¼å®šä½åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³ city=&#39;æ­å·â€™çš„è®°å½•ï¼Œå¹¶ä¸”é¢å¤–ç¡®ä¿äº†ï¼Œæ¥ä¸‹æ¥æŒ‰é¡ºåºå–â€œä¸‹ä¸€æ¡è®°å½•â€çš„éå†è¿‡ç¨‹ä¸­ï¼Œåªè¦ city çš„å€¼æ˜¯æ­å·ï¼Œname çš„å€¼å°±ä¸€å®šæ˜¯æœ‰åºçš„ã€‚</p><p>è¿™æ ·æ•´ä¸ªæŸ¥è¯¢è¿‡ç¨‹çš„æµç¨‹å°±å˜æˆäº†ï¼š</p><ol><li>ä»ç´¢å¼• (city,name) æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³ city=&#39;æ­å·â€™æ¡ä»¶çš„ä¸»é”® idï¼›</li><li>åˆ°ä¸»é”® id ç´¢å¼•å–å‡ºæ•´è¡Œï¼Œå– nameã€cityã€age ä¸‰ä¸ªå­—æ®µçš„å€¼ï¼Œä½œä¸ºç»“æœé›†çš„ä¸€éƒ¨åˆ†ç›´æ¥è¿”å›ï¼›</li><li>ä»ç´¢å¼• (city,name) å–ä¸‹ä¸€ä¸ªè®°å½•ä¸»é”® idï¼›</li><li>é‡å¤æ­¥éª¤ 2ã€3ï¼Œç›´åˆ°æŸ¥åˆ°ç¬¬ 1000 æ¡è®°å½•ï¼Œæˆ–è€…æ˜¯ä¸æ»¡è¶³ city=&#39;æ­å·â€™æ¡ä»¶æ—¶å¾ªç¯ç»“æŸã€‚</li></ol><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/3f590c3a14f9236f2d8e1e2cb9686692-1584367392865.jpg" alt="img"></p><p>å›¾ 8 å¼•å…¥ (city,name) è”åˆç´¢å¼•åï¼ŒæŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œè®¡åˆ’</p><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªæŸ¥è¯¢è¿‡ç¨‹ä¸éœ€è¦ä¸´æ—¶è¡¨ï¼Œä¹Ÿä¸éœ€è¦æ’åºã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç”¨ explain çš„ç»“æœæ¥å°è¯ä¸€ä¸‹ã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/fc53de303811ba3c46d344595743358a-1584367392865.png" alt="img"></p><p>å›¾ 9 å¼•å…¥ (city,name) è”åˆç´¢å¼•åï¼ŒæŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œè®¡åˆ’</p><p>ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼ŒExtra å­—æ®µä¸­æ²¡æœ‰ Using filesort äº†ï¼Œä¹Ÿå°±æ˜¯ä¸éœ€è¦æ’åºäº†ã€‚è€Œä¸”ç”±äº (city,name) è¿™ä¸ªè”åˆç´¢å¼•æœ¬èº«æœ‰åºï¼Œæ‰€ä»¥è¿™ä¸ªæŸ¥è¯¢ä¹Ÿä¸ç”¨æŠŠ 4000 è¡Œå…¨éƒ½è¯»ä¸€éï¼Œåªè¦æ‰¾åˆ°æ»¡è¶³æ¡ä»¶çš„å‰ 1000 æ¡è®°å½•å°±å¯ä»¥é€€å‡ºäº†ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æˆ‘ä»¬è¿™ä¸ªä¾‹å­é‡Œï¼Œåªéœ€è¦æ‰«æ 1000 æ¬¡ã€‚</p><p>æ—¢ç„¶è¯´åˆ°è¿™é‡Œäº†ï¼Œæˆ‘ä»¬å†å¾€å‰è®¨è®ºï¼Œ**è¿™ä¸ªè¯­å¥çš„æ‰§è¡Œæµç¨‹æœ‰æ²¡æœ‰å¯èƒ½è¿›ä¸€æ­¥ç®€åŒ–å‘¢ï¼Ÿ**ä¸çŸ¥é“ä½ è¿˜è®°ä¸è®°å¾—ï¼Œæˆ‘åœ¨ç¬¬ 5 ç¯‡æ–‡ç« [ã€Š æ·±å…¥æµ…å‡ºç´¢å¼•ï¼ˆä¸‹ï¼‰ã€‹]ä¸­ï¼Œå’Œä½ ä»‹ç»çš„è¦†ç›–ç´¢å¼•ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥å†ç¨å¾®å¤ä¹ ä¸€ä¸‹ã€‚<strong>è¦†ç›–ç´¢å¼•æ˜¯æŒ‡ï¼Œç´¢å¼•ä¸Šçš„ä¿¡æ¯è¶³å¤Ÿæ»¡è¶³æŸ¥è¯¢è¯·æ±‚ï¼Œä¸éœ€è¦å†å›åˆ°ä¸»é”®ç´¢å¼•ä¸Šå»å–æ•°æ®ã€‚</strong></p><p>æŒ‰ç…§è¦†ç›–ç´¢å¼•çš„æ¦‚å¿µï¼Œæˆ‘ä»¬å¯ä»¥å†ä¼˜åŒ–ä¸€ä¸‹è¿™ä¸ªæŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œæµç¨‹ã€‚</p><p>é’ˆå¯¹è¿™ä¸ªæŸ¥è¯¢ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ª cityã€name å’Œ age çš„è”åˆç´¢å¼•ï¼Œå¯¹åº”çš„ SQL è¯­å¥å°±æ˜¯ï¼š</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">alter</span> <span class="token keyword">table</span> t <span class="token keyword">add</span> <span class="token keyword">index</span> city_user_age<span class="token punctuation">(</span>city<span class="token punctuation">,</span> name<span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>è¿™æ—¶ï¼Œå¯¹äº city å­—æ®µçš„å€¼ç›¸åŒçš„è¡Œæ¥è¯´ï¼Œè¿˜æ˜¯æŒ‰ç…§ name å­—æ®µçš„å€¼é€’å¢æ’åºçš„ï¼Œæ­¤æ—¶çš„æŸ¥è¯¢è¯­å¥ä¹Ÿå°±ä¸å†éœ€è¦æ’åºäº†ã€‚è¿™æ ·æ•´ä¸ªæŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œæµç¨‹å°±å˜æˆäº†ï¼š</p><ol><li>ä»ç´¢å¼• (city,name,age) æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³ city=&#39;æ­å·â€™æ¡ä»¶çš„è®°å½•ï¼Œå–å‡ºå…¶ä¸­çš„ cityã€name å’Œ age è¿™ä¸‰ä¸ªå­—æ®µçš„å€¼ï¼Œä½œä¸ºç»“æœé›†çš„ä¸€éƒ¨åˆ†ç›´æ¥è¿”å›ï¼›</li><li>ä»ç´¢å¼• (city,name,age) å–ä¸‹ä¸€ä¸ªè®°å½•ï¼ŒåŒæ ·å–å‡ºè¿™ä¸‰ä¸ªå­—æ®µçš„å€¼ï¼Œä½œä¸ºç»“æœé›†çš„ä¸€éƒ¨åˆ†ç›´æ¥è¿”å›ï¼›</li><li>é‡å¤æ‰§è¡Œæ­¥éª¤ 2ï¼Œç›´åˆ°æŸ¥åˆ°ç¬¬ 1000 æ¡è®°å½•ï¼Œæˆ–è€…æ˜¯ä¸æ»¡è¶³ city=&#39;æ­å·â€™æ¡ä»¶æ—¶å¾ªç¯ç»“æŸã€‚</li></ol><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/df4b8e445a59c53df1f2e0f115f02cd6-1584367392865.jpg" alt="img"></p><p>å›¾ 10 å¼•å…¥ (city,name,age) è”åˆç´¢å¼•åï¼ŒæŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œæµç¨‹</p><p>ç„¶åï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹ explain çš„ç»“æœã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/9e40b7b8f0e3f81126a9171cc22e3423-1584367392866.png" alt="img"></p><p>å›¾ 11 å¼•å…¥ (city,name,age) è”åˆç´¢å¼•åï¼ŒæŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œè®¡åˆ’</p><p>å¯ä»¥çœ‹åˆ°ï¼ŒExtra å­—æ®µé‡Œé¢å¤šäº†â€œUsing indexâ€ï¼Œè¡¨ç¤ºçš„å°±æ˜¯ä½¿ç”¨äº†è¦†ç›–ç´¢å¼•ï¼Œæ€§èƒ½ä¸Šä¼šå¿«å¾ˆå¤šã€‚</p><p>å½“ç„¶ï¼Œè¿™é‡Œå¹¶ä¸æ˜¯è¯´è¦ä¸ºäº†æ¯ä¸ªæŸ¥è¯¢èƒ½ç”¨ä¸Šè¦†ç›–ç´¢å¼•ï¼Œå°±è¦æŠŠè¯­å¥ä¸­æ¶‰åŠçš„å­—æ®µéƒ½å»ºä¸Šè”åˆç´¢å¼•ï¼Œæ¯•ç«Ÿç´¢å¼•è¿˜æ˜¯æœ‰ç»´æŠ¤ä»£ä»·çš„ã€‚è¿™æ˜¯ä¸€ä¸ªéœ€è¦æƒè¡¡çš„å†³å®šã€‚</p><h4 id="å°ç»“-11" tabindex="-1"><a class="header-anchor" href="#å°ç»“-11" aria-hidden="true">#</a> å°ç»“</h4><p>ä»Šå¤©è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘å’Œä½ ä»‹ç»äº† MySQL é‡Œé¢ order by è¯­å¥çš„å‡ ç§ç®—æ³•æµç¨‹ã€‚</p><p>åœ¨å¼€å‘ç³»ç»Ÿçš„æ—¶å€™ï¼Œä½ æ€»æ˜¯ä¸å¯é¿å…åœ°ä¼šä½¿ç”¨åˆ° order by è¯­å¥ã€‚ä½ å¿ƒé‡Œè¦æ¸…æ¥šæ¯ä¸ªè¯­å¥çš„æ’åºé€»è¾‘æ˜¯æ€ä¹ˆå®ç°çš„ï¼Œè¿˜è¦èƒ½å¤Ÿåˆ†æå‡ºåœ¨æœ€åæƒ…å†µä¸‹ï¼Œæ¯ä¸ªè¯­å¥çš„æ‰§è¡Œå¯¹ç³»ç»Ÿèµ„æºçš„æ¶ˆè€—ï¼Œè¿™æ ·æ‰èƒ½åšåˆ°ä¸‹ç¬”å¦‚æœ‰ç¥ï¼Œä¸çŠ¯ä½çº§é”™è¯¯ã€‚</p><p>æœ€åï¼Œæˆ‘ç»™ä½ ç•™ä¸‹ä¸€ä¸ªæ€è€ƒé¢˜å§ã€‚</p><p>å‡è®¾ä½ çš„è¡¨é‡Œé¢å·²ç»æœ‰äº† city_name(city, name) è¿™ä¸ªè”åˆç´¢å¼•ï¼Œç„¶åä½ è¦æŸ¥æ­å·å’Œè‹å·ä¸¤ä¸ªåŸå¸‚ä¸­æ‰€æœ‰çš„å¸‚æ°‘çš„å§“åï¼Œå¹¶ä¸”æŒ‰åå­—æ’åºï¼Œæ˜¾ç¤ºå‰ 100 æ¡è®°å½•ã€‚å¦‚æœ SQL æŸ¥è¯¢è¯­å¥æ˜¯è¿™ä¹ˆå†™çš„ ï¼š</p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t <span class="token keyword">where</span> <span class="token class-name">city</span> <span class="token keyword">in</span> <span class="token punctuation">(</span>&#39;æ­å·&#39;<span class="token punctuation">,</span><span class="token string">&quot; è‹å· &quot;</span><span class="token punctuation">)</span> order <span class="token keyword">by</span> name limit <span class="token number">100</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>é‚£ä¹ˆï¼Œè¿™ä¸ªè¯­å¥æ‰§è¡Œçš„æ—¶å€™ä¼šæœ‰æ’åºè¿‡ç¨‹å—ï¼Œä¸ºä»€ä¹ˆï¼Ÿ</p><p>å¦‚æœä¸šåŠ¡ç«¯ä»£ç ç”±ä½ æ¥å¼€å‘ï¼Œéœ€è¦å®ç°ä¸€ä¸ªåœ¨æ•°æ®åº“ç«¯ä¸éœ€è¦æ’åºçš„æ–¹æ¡ˆï¼Œä½ ä¼šæ€ä¹ˆå®ç°å‘¢ï¼Ÿ</p><p>è¿›ä¸€æ­¥åœ°ï¼Œå¦‚æœæœ‰åˆ†é¡µéœ€æ±‚ï¼Œè¦æ˜¾ç¤ºç¬¬ 101 é¡µï¼Œä¹Ÿå°±æ˜¯è¯´è¯­å¥æœ€åè¦æ”¹æˆ â€œlimit 10000,100â€ï¼Œ ä½ çš„å®ç°æ–¹æ³•åˆä¼šæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><p>ä½ å¯ä»¥æŠŠä½ çš„æ€è€ƒå’Œè§‚ç‚¹å†™åœ¨ç•™è¨€åŒºé‡Œï¼Œæˆ‘ä¼šåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« çš„æœ«å°¾å’Œä½ è®¨è®ºè¿™ä¸ªé—®é¢˜ã€‚æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚</p><h4 id="ä¸ŠæœŸé—®é¢˜æ—¶é—´-8" tabindex="-1"><a class="header-anchor" href="#ä¸ŠæœŸé—®é¢˜æ—¶é—´-8" aria-hidden="true">#</a> ä¸ŠæœŸé—®é¢˜æ—¶é—´</h4><p>ä¸ŠæœŸçš„é—®é¢˜æ˜¯ï¼Œå½“ MySQL å»æ›´æ–°ä¸€è¡Œï¼Œä½†æ˜¯è¦ä¿®æ”¹çš„å€¼è·ŸåŸæ¥çš„å€¼æ˜¯ç›¸åŒçš„ï¼Œè¿™æ—¶å€™ MySQL ä¼šçœŸçš„å»æ‰§è¡Œä¸€æ¬¡ä¿®æ”¹å—ï¼Ÿè¿˜æ˜¯çœ‹åˆ°å€¼ç›¸åŒå°±ç›´æ¥è¿”å›å‘¢ï¼Ÿ</p><p>è¿™æ˜¯ç¬¬ä¸€æ¬¡æˆ‘ä»¬è¯¾åé—®é¢˜çš„ä¸‰ä¸ªé€‰é¡¹éƒ½æœ‰åŒå­¦é€‰çš„ï¼Œæ‰€ä»¥æˆ‘è¦å’Œä½ éœ€è¦è¯¦ç»†è¯´æ˜ä¸€ä¸‹ã€‚</p><p>ç¬¬ä¸€ä¸ªé€‰é¡¹æ˜¯ï¼ŒMySQL è¯»å‡ºæ•°æ®ï¼Œå‘ç°å€¼ä¸åŸæ¥ç›¸åŒï¼Œä¸æ›´æ–°ï¼Œç›´æ¥è¿”å›ï¼Œæ‰§è¡Œç»“æŸã€‚è¿™é‡Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªé”å®éªŒæ¥ç¡®è®¤ã€‚</p><p>å‡è®¾ï¼Œå½“å‰è¡¨ t é‡Œçš„å€¼æ˜¯ (1,2)ã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/6d9d8837560d01b57d252c470157ea90-1584367392866.png" alt="img"></p><p>å›¾ 12 é”éªŒè¯æ–¹å¼</p><p>session B çš„ update è¯­å¥è¢« blocked äº†ï¼ŒåŠ é”è¿™ä¸ªåŠ¨ä½œæ˜¯ InnoDB æ‰èƒ½åšçš„ï¼Œæ‰€ä»¥æ’é™¤é€‰é¡¹ 1ã€‚</p><p>ç¬¬äºŒä¸ªé€‰é¡¹æ˜¯ï¼ŒMySQL è°ƒç”¨äº† InnoDB å¼•æ“æä¾›çš„æ¥å£ï¼Œä½†æ˜¯å¼•æ“å‘ç°å€¼ä¸åŸæ¥ç›¸åŒï¼Œä¸æ›´æ–°ï¼Œç›´æ¥è¿”å›ã€‚æœ‰æ²¡æœ‰è¿™ç§å¯èƒ½å‘¢ï¼Ÿè¿™é‡Œæˆ‘ç”¨ä¸€ä¸ªå¯è§æ€§å®éªŒæ¥ç¡®è®¤ã€‚</p><p>å‡è®¾å½“å‰è¡¨é‡Œçš„å€¼æ˜¯ (1,2)ã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/441682b64a3f5dd50f35b12ca4b87c96-1584367392866.png" alt="img"></p><p>å›¾ 13 å¯è§æ€§éªŒè¯æ–¹å¼</p><p>session A çš„ç¬¬äºŒä¸ª select è¯­å¥æ˜¯ä¸€è‡´æ€§è¯»ï¼ˆå¿«ç…§è¯»)ï¼Œå®ƒæ˜¯ä¸èƒ½çœ‹è§ session B çš„æ›´æ–°çš„ã€‚</p><p>ç°åœ¨å®ƒè¿”å›çš„æ˜¯ (1,3)ï¼Œè¡¨ç¤ºå®ƒçœ‹è§äº†æŸä¸ªæ–°çš„ç‰ˆæœ¬ï¼Œè¿™ä¸ªç‰ˆæœ¬åªèƒ½æ˜¯ session A è‡ªå·±çš„ update è¯­å¥åšæ›´æ–°çš„æ—¶å€™ç”Ÿæˆã€‚ï¼ˆå¦‚æœä½ å¯¹è¿™ä¸ªé€»è¾‘æœ‰ç–‘æƒ‘çš„è¯ï¼Œå¯ä»¥å›é¡¾ä¸‹ç¬¬ 8 ç¯‡æ–‡ç« [ã€Šäº‹åŠ¡åˆ°åº•æ˜¯éš”ç¦»çš„è¿˜æ˜¯ä¸éš”ç¦»çš„ï¼Ÿã€‹]ä¸­çš„ç›¸å…³å†…å®¹ï¼‰</p><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬ä¸ŠæœŸæ€è€ƒé¢˜çš„ç­”æ¡ˆåº”è¯¥æ˜¯é€‰é¡¹ 3ï¼Œå³ï¼šInnoDB è®¤çœŸæ‰§è¡Œäº†â€œæŠŠè¿™ä¸ªå€¼ä¿®æ”¹æˆ (1,2)&quot;è¿™ä¸ªæ“ä½œï¼Œè¯¥åŠ é”çš„åŠ é”ï¼Œè¯¥æ›´æ–°çš„æ›´æ–°ã€‚</p><p>ç„¶åä½ ä¼šè¯´ï¼ŒMySQL æ€ä¹ˆè¿™ä¹ˆç¬¨ï¼Œå°±ä¸ä¼šæ›´æ–°å‰åˆ¤æ–­ä¸€ä¸‹å€¼æ˜¯ä¸æ˜¯ç›¸åŒå—ï¼Ÿå¦‚æœåˆ¤æ–­ä¸€ä¸‹ï¼Œä¸å°±ä¸ç”¨æµªè´¹ InnoDB æ“ä½œï¼Œå¤šå»æ›´æ–°ä¸€æ¬¡äº†ï¼Ÿ</p><p>å…¶å® MySQL æ˜¯ç¡®è®¤äº†çš„ã€‚åªæ˜¯åœ¨è¿™ä¸ªè¯­å¥é‡Œé¢ï¼ŒMySQL è®¤ä¸ºè¯»å‡ºæ¥çš„å€¼ï¼Œåªæœ‰ä¸€ä¸ªç¡®å®šçš„ (id=1), è€Œè¦å†™çš„æ˜¯ (a=3)ï¼Œåªä»è¿™ä¸¤ä¸ªä¿¡æ¯æ˜¯çœ‹ä¸å‡ºæ¥â€œä¸éœ€è¦ä¿®æ”¹â€çš„ã€‚</p><p>ä½œä¸ºéªŒè¯ï¼Œä½ å¯ä»¥çœ‹ä¸€ä¸‹ä¸‹é¢è¿™ä¸ªä¾‹å­ã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/63dd6df32dacdb827d256e5acb9837c1-1584367392866.png" alt="img"></p><p>å›¾ 14 å¯è§æ€§éªŒè¯æ–¹å¼ -- å¯¹ç…§</p><p><strong>è¡¥å……è¯´æ˜ï¼š</strong></p><p>ä¸Šé¢æˆ‘ä»¬çš„éªŒè¯ç»“æœéƒ½æ˜¯åœ¨ binlog_format=statement æ ¼å¼ä¸‹è¿›è¡Œçš„ã€‚</p><p>@didiren è¡¥å……äº†ä¸€ä¸ª caseï¼Œ å¦‚æœæ˜¯ binlog_format=row å¹¶ä¸” binlog_row_image=FULL çš„æ—¶å€™ï¼Œç”±äº MySQL éœ€è¦åœ¨ binlog é‡Œé¢è®°å½•æ‰€æœ‰çš„å­—æ®µï¼Œæ‰€ä»¥åœ¨è¯»æ•°æ®çš„æ—¶å€™å°±ä¼šæŠŠæ‰€æœ‰æ•°æ®éƒ½è¯»å‡ºæ¥äº†ã€‚</p><p>æ ¹æ®ä¸Šé¢è¯´çš„è§„åˆ™ï¼Œâ€œæ—¢ç„¶è¯»äº†æ•°æ®ï¼Œå°±ä¼šåˆ¤æ–­â€ï¼Œ å› æ­¤åœ¨è¿™æ—¶å€™ï¼Œselect * from t where id=1ï¼Œç»“æœå°±æ˜¯â€œè¿”å› (1,2)â€ã€‚</p><p>åŒç†ï¼Œå¦‚æœæ˜¯ binlog_row_image=NOBLOB, ä¼šè¯»å‡ºé™¤ blob å¤–çš„æ‰€æœ‰å­—æ®µï¼Œåœ¨æˆ‘ä»¬è¿™ä¸ªä¾‹å­é‡Œï¼Œç»“æœè¿˜æ˜¯â€œè¿”å› (1,2)â€ã€‚</p><p>å¯¹åº”çš„ä»£ç å¦‚å›¾ 15 æ‰€ç¤ºã€‚è¿™æ˜¯ MySQL 5.6 ç‰ˆæœ¬å¼•å…¥çš„ï¼Œåœ¨æ­¤ä¹‹å‰æˆ‘æ²¡æœ‰çœ‹è¿‡ã€‚æ‰€ä»¥ï¼Œç‰¹æ­¤è¯´æ˜ã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/d413b9235d56c62f9829750a68b06b89-1584367392866.png" alt="img"></p><p>å›¾ 15 binlog_row_image=FULL è¯»å­—æ®µé€»è¾‘</p><p>ç±»ä¼¼çš„ï¼Œ@mahonebags åŒå­¦æåˆ°äº† timestamp å­—æ®µçš„é—®é¢˜ã€‚ç»“è®ºæ˜¯ï¼šå¦‚æœè¡¨ä¸­æœ‰ timestamp å­—æ®µè€Œä¸”è®¾ç½®äº†è‡ªåŠ¨æ›´æ–°çš„è¯ï¼Œé‚£ä¹ˆæ›´æ–°â€œåˆ«çš„å­—æ®µâ€çš„æ—¶å€™ï¼ŒMySQL ä¼šè¯»å…¥æ‰€æœ‰æ¶‰åŠçš„å­—æ®µï¼Œè¿™æ ·é€šè¿‡åˆ¤æ–­ï¼Œå°±ä¼šå‘ç°ä¸éœ€è¦ä¿®æ”¹ã€‚</p><p>è¿™ä¸¤ä¸ªç‚¹æˆ‘ä¼šåœ¨åé¢è®²æ›´æ–°æ€§èƒ½çš„æ–‡ç« ä¸­å†å±•å¼€ã€‚</p><p>è¯„è®ºåŒºç•™è¨€ç‚¹èµæ¿ï¼š</p><blockquote><p>@Gavin ã€@melonã€@é˜¿å»º ç­‰åŒå­¦æåˆ°äº†é”éªŒè¯æ³•ï¼› @éƒ­æ±Ÿä¼Ÿ åŒå­¦æåˆ°äº†ä¸¤ä¸ªç‚¹ï¼Œéƒ½éå¸¸å¥½ï¼Œæœ‰å»å®é™…éªŒè¯ã€‚ç»“è®ºæ˜¯è¿™æ ·çš„ï¼š ç¬¬ä¸€ï¼Œhexdump çœ‹å‡ºæ¥æ²¡æ”¹åº”è¯¥æ˜¯ WAL æœºåˆ¶ç”Ÿæ•ˆäº†ï¼Œè¦è¿‡ä¸€ä¼šå„¿ï¼Œæˆ–è€…æŠŠåº“ shutdown çœ‹çœ‹ã€‚ ç¬¬äºŒï¼Œbinlog æ²¡å†™æ˜¯ MySQL Server å±‚çŸ¥é“è¡Œçš„å€¼æ²¡å˜ï¼Œæ‰€ä»¥æ•…æ„ä¸å†™çš„ï¼Œè¿™ä¸ªæ˜¯åœ¨ row æ ¼å¼ä¸‹çš„ç­–ç•¥ã€‚ä½ å¯ä»¥æŠŠ binlog_format æ”¹æˆ statement å†éªŒè¯ä¸‹ã€‚</p></blockquote><h3 id="_20-å¹»è¯»æ˜¯ä»€ä¹ˆ-å¹»è¯»æœ‰ä»€ä¹ˆé—®é¢˜" tabindex="-1"><a class="header-anchor" href="#_20-å¹»è¯»æ˜¯ä»€ä¹ˆ-å¹»è¯»æœ‰ä»€ä¹ˆé—®é¢˜" aria-hidden="true">#</a> 20 å¹»è¯»æ˜¯ä»€ä¹ˆï¼Œå¹»è¯»æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ</h3><p>åœ¨ä¸Šä¸€ç¯‡æ–‡ç« æœ€åï¼Œæˆ‘ç»™ä½ ç•™äº†ä¸€ä¸ªå…³äºåŠ é”è§„åˆ™çš„é—®é¢˜ã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬å°±ä»è¿™ä¸ªé—®é¢˜è¯´èµ·å§ã€‚</p><p>ä¸ºäº†ä¾¿äºè¯´æ˜é—®é¢˜ï¼Œè¿™ä¸€ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬å°±å…ˆä½¿ç”¨ä¸€ä¸ªå°ä¸€ç‚¹å„¿çš„è¡¨ã€‚å»ºè¡¨å’Œåˆå§‹åŒ–è¯­å¥å¦‚ä¸‹ï¼ˆä¸ºäº†ä¾¿äºæœ¬æœŸçš„ä¾‹å­è¯´æ˜ï¼Œæˆ‘æŠŠä¸Šç¯‡æ–‡ç« ä¸­ç”¨åˆ°çš„è¡¨ç»“æ„åšäº†ç‚¹å„¿ä¿®æ”¹ï¼‰ï¼š</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>t<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>c<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>d<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>c<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>c<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span><span class="token punctuation">;</span> 
<span class="token keyword">insert</span> <span class="token keyword">into</span> t <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">,</span><span class="token number">25</span><span class="token punctuation">,</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªè¡¨é™¤äº†ä¸»é”® id å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªç´¢å¼• cï¼Œåˆå§‹åŒ–è¯­å¥åœ¨è¡¨ä¸­æ’å…¥äº† 6 è¡Œæ•°æ®ã€‚</p><p>ä¸ŠæœŸæˆ‘ç•™ç»™ä½ çš„é—®é¢˜æ˜¯ï¼Œä¸‹é¢çš„è¯­å¥åºåˆ—ï¼Œæ˜¯æ€ä¹ˆåŠ é”çš„ï¼ŒåŠ çš„é”åˆæ˜¯ä»€ä¹ˆæ—¶å€™é‡Šæ”¾çš„å‘¢ï¼Ÿ</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">begin</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t <span class="token keyword">where</span> d<span class="token operator">=</span><span class="token number">5</span> <span class="token keyword">for</span> <span class="token keyword">update</span><span class="token punctuation">;</span>
<span class="token keyword">commit</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¯”è¾ƒå¥½ç†è§£çš„æ˜¯ï¼Œè¿™ä¸ªè¯­å¥ä¼šå‘½ä¸­ d=5 çš„è¿™ä¸€è¡Œï¼Œå¯¹åº”çš„ä¸»é”® id=5ï¼Œå› æ­¤åœ¨ select è¯­å¥æ‰§è¡Œå®Œæˆåï¼Œid=5 è¿™ä¸€è¡Œä¼šåŠ ä¸€ä¸ªå†™é”ï¼Œè€Œä¸”ç”±äºä¸¤é˜¶æ®µé”åè®®ï¼Œè¿™ä¸ªå†™é”ä¼šåœ¨æ‰§è¡Œ commit è¯­å¥çš„æ—¶å€™é‡Šæ”¾ã€‚</p><p>ç”±äºå­—æ®µ d ä¸Šæ²¡æœ‰ç´¢å¼•ï¼Œå› æ­¤è¿™æ¡æŸ¥è¯¢è¯­å¥ä¼šåšå…¨è¡¨æ‰«æã€‚é‚£ä¹ˆï¼Œå…¶ä»–è¢«æ‰«æåˆ°çš„ï¼Œä½†æ˜¯ä¸æ»¡è¶³æ¡ä»¶çš„ 5 è¡Œè®°å½•ä¸Šï¼Œä¼šä¸ä¼šè¢«åŠ é”å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬çŸ¥é“ï¼ŒInnoDB çš„é»˜è®¤äº‹åŠ¡éš”ç¦»çº§åˆ«æ˜¯å¯é‡å¤è¯»ï¼Œæ‰€ä»¥æœ¬æ–‡æ¥ä¸‹æ¥æ²¡æœ‰ç‰¹æ®Šè¯´æ˜çš„éƒ¨åˆ†ï¼Œéƒ½æ˜¯è®¾å®šåœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹ã€‚</p><h4 id="å¹»è¯»æ˜¯ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#å¹»è¯»æ˜¯ä»€ä¹ˆ" aria-hidden="true">#</a> å¹»è¯»æ˜¯ä»€ä¹ˆï¼Ÿ</h4><p>ç°åœ¨ï¼Œæˆ‘ä»¬å°±æ¥åˆ†æä¸€ä¸‹ï¼Œå¦‚æœåªåœ¨ id=5 è¿™ä¸€è¡ŒåŠ é”ï¼Œè€Œå…¶ä»–è¡Œçš„ä¸åŠ é”çš„è¯ï¼Œä¼šæ€ä¹ˆæ ·ã€‚</p><p>ä¸‹é¢å…ˆæ¥çœ‹ä¸€ä¸‹è¿™ä¸ªåœºæ™¯ï¼ˆæ³¨æ„ï¼šè¿™æ˜¯æˆ‘å‡è®¾çš„ä¸€ä¸ªåœºæ™¯ï¼‰ï¼š</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/5bc506e5884d21844126d26bbe6fa68b-1584367394523.png" alt="img"></p><p>å›¾ 1 å‡è®¾åªåœ¨ id=5 è¿™ä¸€è¡ŒåŠ è¡Œé”</p><p>å¯ä»¥çœ‹åˆ°ï¼Œsession A é‡Œæ‰§è¡Œäº†ä¸‰æ¬¡æŸ¥è¯¢ï¼Œåˆ†åˆ«æ˜¯ Q1ã€Q2 å’Œ Q3ã€‚å®ƒä»¬çš„ SQL è¯­å¥ç›¸åŒï¼Œéƒ½æ˜¯ select * from t where d=5 for updateã€‚è¿™ä¸ªè¯­å¥çš„æ„æ€ä½ åº”è¯¥å¾ˆæ¸…æ¥šäº†ï¼ŒæŸ¥æ‰€æœ‰ d=5 çš„è¡Œï¼Œè€Œä¸”ä½¿ç”¨çš„æ˜¯å½“å‰è¯»ï¼Œå¹¶ä¸”åŠ ä¸Šå†™é”ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¿™ä¸‰æ¡ SQL è¯­å¥ï¼Œåˆ†åˆ«ä¼šè¿”å›ä»€ä¹ˆç»“æœã€‚</p><ol><li>Q1 åªè¿”å› id=5 è¿™ä¸€è¡Œï¼›</li><li>åœ¨ T2 æ—¶åˆ»ï¼Œsession B æŠŠ id=0 è¿™ä¸€è¡Œçš„ d å€¼æ”¹æˆäº† 5ï¼Œå› æ­¤ T3 æ—¶åˆ» Q2 æŸ¥å‡ºæ¥çš„æ˜¯ id=0 å’Œ id=5 è¿™ä¸¤è¡Œï¼›</li><li>åœ¨ T4 æ—¶åˆ»ï¼Œsession C åˆæ’å…¥ä¸€è¡Œï¼ˆ1,1,5ï¼‰ï¼Œå› æ­¤ T5 æ—¶åˆ» Q3 æŸ¥å‡ºæ¥çš„æ˜¯ id=0ã€id=1 å’Œ id=5 çš„è¿™ä¸‰è¡Œã€‚</li></ol><p>å…¶ä¸­ï¼ŒQ3 è¯»åˆ° id=1 è¿™ä¸€è¡Œçš„ç°è±¡ï¼Œè¢«ç§°ä¸ºâ€œå¹»è¯»â€ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¹»è¯»æŒ‡çš„æ˜¯ä¸€ä¸ªäº‹åŠ¡åœ¨å‰åä¸¤æ¬¡æŸ¥è¯¢åŒä¸€ä¸ªèŒƒå›´çš„æ—¶å€™ï¼Œåä¸€æ¬¡æŸ¥è¯¢çœ‹åˆ°äº†å‰ä¸€æ¬¡æŸ¥è¯¢æ²¡æœ‰çœ‹åˆ°çš„è¡Œã€‚</p><p>è¿™é‡Œï¼Œæˆ‘éœ€è¦å¯¹â€œå¹»è¯»â€åšä¸€ä¸ªè¯´æ˜ï¼š</p><ol><li>åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹ï¼Œæ™®é€šçš„æŸ¥è¯¢æ˜¯å¿«ç…§è¯»ï¼Œæ˜¯ä¸ä¼šçœ‹åˆ°åˆ«çš„äº‹åŠ¡æ’å…¥çš„æ•°æ®çš„ã€‚å› æ­¤ï¼Œå¹»è¯»åœ¨â€œå½“å‰è¯»â€ä¸‹æ‰ä¼šå‡ºç°ã€‚</li><li>ä¸Šé¢ session B çš„ä¿®æ”¹ç»“æœï¼Œè¢« session A ä¹‹åçš„ select è¯­å¥ç”¨â€œå½“å‰è¯»â€çœ‹åˆ°ï¼Œä¸èƒ½ç§°ä¸ºå¹»è¯»ã€‚å¹»è¯»ä»…ä¸“æŒ‡â€œæ–°æ’å…¥çš„è¡Œâ€ã€‚</li></ol><p>å¦‚æœåªä»ç¬¬ 8 ç¯‡æ–‡ç« [ã€Šäº‹åŠ¡åˆ°åº•æ˜¯éš”ç¦»çš„è¿˜æ˜¯ä¸éš”ç¦»çš„ï¼Ÿã€‹]æˆ‘ä»¬å­¦åˆ°çš„äº‹åŠ¡å¯è§æ€§è§„åˆ™æ¥åˆ†æçš„è¯ï¼Œä¸Šé¢è¿™ä¸‰æ¡ SQL è¯­å¥çš„è¿”å›ç»“æœéƒ½æ²¡æœ‰é—®é¢˜ã€‚</p><p>å› ä¸ºè¿™ä¸‰ä¸ªæŸ¥è¯¢éƒ½æ˜¯åŠ äº† for updateï¼Œéƒ½æ˜¯å½“å‰è¯»ã€‚è€Œå½“å‰è¯»çš„è§„åˆ™ï¼Œå°±æ˜¯è¦èƒ½è¯»åˆ°æ‰€æœ‰å·²ç»æäº¤çš„è®°å½•çš„æœ€æ–°å€¼ã€‚å¹¶ä¸”ï¼Œsession B å’Œ sessionC çš„ä¸¤æ¡è¯­å¥ï¼Œæ‰§è¡Œåå°±ä¼šæäº¤ï¼Œæ‰€ä»¥ Q2 å’Œ Q3 å°±æ˜¯åº”è¯¥çœ‹åˆ°è¿™ä¸¤ä¸ªäº‹åŠ¡çš„æ“ä½œæ•ˆæœï¼Œè€Œä¸”ä¹Ÿçœ‹åˆ°äº†ï¼Œè¿™è·Ÿäº‹åŠ¡çš„å¯è§æ€§è§„åˆ™å¹¶ä¸çŸ›ç›¾ã€‚</p><p>ä½†æ˜¯ï¼Œè¿™æ˜¯ä¸æ˜¯çœŸçš„æ²¡é—®é¢˜å‘¢ï¼Ÿ</p><p>ä¸ï¼Œè¿™é‡Œè¿˜çœŸå°±æœ‰é—®é¢˜ã€‚</p><h4 id="å¹»è¯»æœ‰ä»€ä¹ˆé—®é¢˜" tabindex="-1"><a class="header-anchor" href="#å¹»è¯»æœ‰ä»€ä¹ˆé—®é¢˜" aria-hidden="true">#</a> å¹»è¯»æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ</h4><p>**é¦–å…ˆæ˜¯è¯­ä¹‰ä¸Šçš„ã€‚**session A åœ¨ T1 æ—¶åˆ»å°±å£°æ˜äº†ï¼Œâ€œæˆ‘è¦æŠŠæ‰€æœ‰ d=5 çš„è¡Œé”ä½ï¼Œä¸å‡†åˆ«çš„äº‹åŠ¡è¿›è¡Œè¯»å†™æ“ä½œâ€ã€‚è€Œå®é™…ä¸Šï¼Œè¿™ä¸ªè¯­ä¹‰è¢«ç ´åäº†ã€‚</p><p>å¦‚æœç°åœ¨è¿™æ ·çœ‹æ„Ÿè§‰è¿˜ä¸æ˜æ˜¾çš„è¯ï¼Œæˆ‘å†å¾€ session B å’Œ session C é‡Œé¢åˆ†åˆ«åŠ ä¸€æ¡ SQL è¯­å¥ï¼Œä½ å†çœ‹çœ‹ä¼šå‡ºç°ä»€ä¹ˆç°è±¡ã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/7a9ffa90ac3cc78db6a51ff9b9075607-1584367394532.png" alt="img"></p><p>å›¾ 2 å‡è®¾åªåœ¨ id=5 è¿™ä¸€è¡ŒåŠ è¡Œé” -- è¯­ä¹‰è¢«ç ´å</p><p>session B çš„ç¬¬äºŒæ¡è¯­å¥ update t set c=5 where id=0ï¼Œè¯­ä¹‰æ˜¯â€œæˆ‘æŠŠ id=0ã€d=5 è¿™ä¸€è¡Œçš„ c å€¼ï¼Œæ”¹æˆäº† 5â€ã€‚</p><p>ç”±äºåœ¨ T1 æ—¶åˆ»ï¼Œsession A è¿˜åªæ˜¯ç»™ id=5 è¿™ä¸€è¡ŒåŠ äº†è¡Œé”ï¼Œ å¹¶æ²¡æœ‰ç»™ id=0 è¿™è¡ŒåŠ ä¸Šé”ã€‚å› æ­¤ï¼Œsession B åœ¨ T2 æ—¶åˆ»ï¼Œæ˜¯å¯ä»¥æ‰§è¡Œè¿™ä¸¤æ¡ update è¯­å¥çš„ã€‚è¿™æ ·ï¼Œå°±ç ´åäº† session A é‡Œ Q1 è¯­å¥è¦é”ä½æ‰€æœ‰ d=5 çš„è¡Œçš„åŠ é”å£°æ˜ã€‚</p><p>session C ä¹Ÿæ˜¯ä¸€æ ·çš„é“ç†ï¼Œå¯¹ id=1 è¿™ä¸€è¡Œçš„ä¿®æ”¹ï¼Œä¹Ÿæ˜¯ç ´åäº† Q1 çš„åŠ é”å£°æ˜ã€‚</p><p><strong>å…¶æ¬¡ï¼Œæ˜¯æ•°æ®ä¸€è‡´æ€§çš„é—®é¢˜ã€‚</strong></p><p>æˆ‘ä»¬çŸ¥é“ï¼Œé”çš„è®¾è®¡æ˜¯ä¸ºäº†ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚è€Œè¿™ä¸ªä¸€è‡´æ€§ï¼Œä¸æ­¢æ˜¯æ•°æ®åº“å†…éƒ¨æ•°æ®çŠ¶æ€åœ¨æ­¤åˆ»çš„ä¸€è‡´æ€§ï¼Œè¿˜åŒ…å«äº†æ•°æ®å’Œæ—¥å¿—åœ¨é€»è¾‘ä¸Šçš„ä¸€è‡´æ€§ã€‚</p><p>ä¸ºäº†è¯´æ˜è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ç»™ session A åœ¨ T1 æ—¶åˆ»å†åŠ ä¸€ä¸ªæ›´æ–°è¯­å¥ï¼Œå³ï¼šupdate t set d=100 where d=5ã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/dcea7845ff0bdbee2622bf3c67d31d92-1584367394539.png" alt="img"></p><p>å›¾ 3 å‡è®¾åªåœ¨ id=5 è¿™ä¸€è¡ŒåŠ è¡Œé” -- æ•°æ®ä¸€è‡´æ€§é—®é¢˜</p><p>update çš„åŠ é”è¯­ä¹‰å’Œ select â€¦for update æ˜¯ä¸€è‡´çš„ï¼Œæ‰€ä»¥è¿™æ—¶å€™åŠ ä¸Šè¿™æ¡ update è¯­å¥ä¹Ÿå¾ˆåˆç†ã€‚session A å£°æ˜è¯´â€œè¦ç»™ d=5 çš„è¯­å¥åŠ ä¸Šé”â€ï¼Œå°±æ˜¯ä¸ºäº†è¦æ›´æ–°æ•°æ®ï¼Œæ–°åŠ çš„è¿™æ¡ update è¯­å¥å°±æ˜¯æŠŠå®ƒè®¤ä¸ºåŠ ä¸Šäº†é”çš„è¿™ä¸€è¡Œçš„ d å€¼ä¿®æ”¹æˆäº† 100ã€‚</p><p>ç°åœ¨ï¼Œæˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹å›¾ 3 æ‰§è¡Œå®Œæˆåï¼Œæ•°æ®åº“é‡Œä¼šæ˜¯ä»€ä¹ˆç»“æœã€‚</p><ol><li>ç»è¿‡ T1 æ—¶åˆ»ï¼Œid=5 è¿™ä¸€è¡Œå˜æˆ (5,5,100)ï¼Œå½“ç„¶è¿™ä¸ªç»“æœæœ€ç»ˆæ˜¯åœ¨ T6 æ—¶åˆ»æ­£å¼æäº¤çš„ ;</li><li>ç»è¿‡ T2 æ—¶åˆ»ï¼Œid=0 è¿™ä¸€è¡Œå˜æˆ (0,5,5);</li><li>ç»è¿‡ T4 æ—¶åˆ»ï¼Œè¡¨é‡Œé¢å¤šäº†ä¸€è¡Œ (1,5,5);</li><li>å…¶ä»–è¡Œè·Ÿè¿™ä¸ªæ‰§è¡Œåºåˆ—æ— å…³ï¼Œä¿æŒä¸å˜ã€‚</li></ol><p>è¿™æ ·çœ‹ï¼Œè¿™äº›æ•°æ®ä¹Ÿæ²¡å•¥é—®é¢˜ï¼Œä½†æ˜¯æˆ‘ä»¬å†æ¥çœ‹çœ‹è¿™æ—¶å€™ binlog é‡Œé¢çš„å†…å®¹ã€‚</p><ol><li>T2 æ—¶åˆ»ï¼Œsession B äº‹åŠ¡æäº¤ï¼Œå†™å…¥äº†ä¸¤æ¡è¯­å¥ï¼›</li><li>T4 æ—¶åˆ»ï¼Œsession C äº‹åŠ¡æäº¤ï¼Œå†™å…¥äº†ä¸¤æ¡è¯­å¥ï¼›</li><li>T6 æ—¶åˆ»ï¼Œsession A äº‹åŠ¡æäº¤ï¼Œå†™å…¥äº† update t set d=100 where d=5 è¿™æ¡è¯­å¥ã€‚</li></ol><p>æˆ‘ç»Ÿä¸€æ”¾åˆ°ä¸€èµ·çš„è¯ï¼Œå°±æ˜¯è¿™æ ·çš„ï¼š</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">update</span> t <span class="token keyword">set</span> d<span class="token operator">=</span><span class="token number">5</span> <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">/*(0,0,5)*/</span>
<span class="token keyword">update</span> t <span class="token keyword">set</span> c<span class="token operator">=</span><span class="token number">5</span> <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">/*(0,5,5)*/</span> 
<span class="token keyword">insert</span> <span class="token keyword">into</span> t <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/*(1,1,5)*/</span>
<span class="token keyword">update</span> t <span class="token keyword">set</span> c<span class="token operator">=</span><span class="token number">5</span> <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">/*(1,5,5)*/</span> 
<span class="token keyword">update</span> t <span class="token keyword">set</span> d<span class="token operator">=</span><span class="token number">100</span> <span class="token keyword">where</span> d<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">;</span><span class="token comment">/* æ‰€æœ‰ d=5 çš„è¡Œï¼Œd æ”¹æˆ 100*/</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¥½ï¼Œä½ åº”è¯¥çœ‹å‡ºé—®é¢˜äº†ã€‚è¿™ä¸ªè¯­å¥åºåˆ—ï¼Œä¸è®ºæ˜¯æ‹¿åˆ°å¤‡åº“å»æ‰§è¡Œï¼Œè¿˜æ˜¯ä»¥åç”¨ binlog æ¥å…‹éš†ä¸€ä¸ªåº“ï¼Œè¿™ä¸‰è¡Œçš„ç»“æœï¼Œéƒ½å˜æˆäº† (0,5,100)ã€(1,5,100) å’Œ (5,5,100)ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œid=0 å’Œ id=1 è¿™ä¸¤è¡Œï¼Œå‘ç”Ÿäº†æ•°æ®ä¸ä¸€è‡´ã€‚è¿™ä¸ªé—®é¢˜å¾ˆä¸¥é‡ï¼Œæ˜¯ä¸è¡Œçš„ã€‚</p><p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å†å›é¡¾ä¸€ä¸‹ï¼Œ<strong>è¿™ä¸ªæ•°æ®ä¸ä¸€è‡´åˆ°åº•æ˜¯æ€ä¹ˆå¼•å…¥çš„ï¼Ÿ</strong></p><p>æˆ‘ä»¬åˆ†æä¸€ä¸‹å¯ä»¥çŸ¥é“ï¼Œè¿™æ˜¯æˆ‘ä»¬å‡è®¾â€œselect * from t where d=5 for update è¿™æ¡è¯­å¥åªç»™ d=5 è¿™ä¸€è¡Œï¼Œä¹Ÿå°±æ˜¯ id=5 çš„è¿™ä¸€è¡ŒåŠ é”â€å¯¼è‡´çš„ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬è®¤ä¸ºï¼Œä¸Šé¢çš„è®¾å®šä¸åˆç†ï¼Œè¦æ”¹ã€‚</p><p>é‚£æ€ä¹ˆæ”¹å‘¢ï¼Ÿæˆ‘ä»¬æŠŠæ‰«æè¿‡ç¨‹ä¸­ç¢°åˆ°çš„è¡Œï¼Œä¹Ÿéƒ½åŠ ä¸Šå†™é”ï¼Œå†æ¥çœ‹çœ‹æ‰§è¡Œæ•ˆæœã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/34ad6478281709da833856084a1e3447-1584367394550.png" alt="img"></p><p>å›¾ 4 å‡è®¾æ‰«æåˆ°çš„è¡Œéƒ½è¢«åŠ ä¸Šäº†è¡Œé”</p><p>ç”±äº session A æŠŠæ‰€æœ‰çš„è¡Œéƒ½åŠ äº†å†™é”ï¼Œæ‰€ä»¥ session B åœ¨æ‰§è¡Œç¬¬ä¸€ä¸ª update è¯­å¥çš„æ—¶å€™å°±è¢«é”ä½äº†ã€‚éœ€è¦ç­‰åˆ° T6 æ—¶åˆ» session A æäº¤ä»¥åï¼Œsession B æ‰èƒ½ç»§ç»­æ‰§è¡Œã€‚</p><p>è¿™æ ·å¯¹äº id=0 è¿™ä¸€è¡Œï¼Œåœ¨æ•°æ®åº“é‡Œçš„æœ€ç»ˆç»“æœè¿˜æ˜¯ (0,5,5)ã€‚åœ¨ binlog é‡Œé¢ï¼Œæ‰§è¡Œåºåˆ—æ˜¯è¿™æ ·çš„ï¼š</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">insert</span> <span class="token keyword">into</span> t <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/*(1,1,5)*/</span>
<span class="token keyword">update</span> t <span class="token keyword">set</span> c<span class="token operator">=</span><span class="token number">5</span> <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">/*(1,5,5)*/</span> 
<span class="token keyword">update</span> t <span class="token keyword">set</span> d<span class="token operator">=</span><span class="token number">100</span> <span class="token keyword">where</span> d<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">;</span><span class="token comment">/* æ‰€æœ‰ d=5 çš„è¡Œï¼Œd æ”¹æˆ 100*/</span> 
<span class="token keyword">update</span> t <span class="token keyword">set</span> d<span class="token operator">=</span><span class="token number">5</span> <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">/*(0,0,5)*/</span>
<span class="token keyword">update</span> t <span class="token keyword">set</span> c<span class="token operator">=</span><span class="token number">5</span> <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">/*(0,5,5)*/</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°ï¼ŒæŒ‰ç…§æ—¥å¿—é¡ºåºæ‰§è¡Œï¼Œid=0 è¿™ä¸€è¡Œçš„æœ€ç»ˆç»“æœä¹Ÿæ˜¯ (0,5,5)ã€‚æ‰€ä»¥ï¼Œid=0 è¿™ä¸€è¡Œçš„é—®é¢˜è§£å†³äº†ã€‚</p><p>ä½†åŒæ—¶ä½ ä¹Ÿå¯ä»¥çœ‹åˆ°ï¼Œid=1 è¿™ä¸€è¡Œï¼Œåœ¨æ•°æ®åº“é‡Œé¢çš„ç»“æœæ˜¯ (1,5,5)ï¼Œè€Œæ ¹æ® binlog çš„æ‰§è¡Œç»“æœæ˜¯ (1,5,100)ï¼Œä¹Ÿå°±æ˜¯è¯´å¹»è¯»çš„é—®é¢˜è¿˜æ˜¯æ²¡æœ‰è§£å†³ã€‚ä¸ºä»€ä¹ˆæˆ‘ä»¬å·²ç»è¿™ä¹ˆâ€œå‡¶æ®‹â€åœ°ï¼ŒæŠŠæ‰€æœ‰çš„è®°å½•éƒ½ä¸Šäº†é”ï¼Œè¿˜æ˜¯é˜»æ­¢ä¸äº† id=1 è¿™ä¸€è¡Œçš„æ’å…¥å’Œæ›´æ–°å‘¢ï¼Ÿ</p><p>åŸå› å¾ˆç®€å•ã€‚åœ¨ T3 æ—¶åˆ»ï¼Œæˆ‘ä»¬ç»™æ‰€æœ‰è¡ŒåŠ é”çš„æ—¶å€™ï¼Œid=1 è¿™ä¸€è¡Œè¿˜ä¸å­˜åœ¨ï¼Œä¸å­˜åœ¨ä¹Ÿå°±åŠ ä¸ä¸Šé”ã€‚</p><p>**ä¹Ÿå°±æ˜¯è¯´ï¼Œå³ä½¿æŠŠæ‰€æœ‰çš„è®°å½•éƒ½åŠ ä¸Šé”ï¼Œè¿˜æ˜¯é˜»æ­¢ä¸äº†æ–°æ’å…¥çš„è®°å½•ï¼Œ**è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆâ€œå¹»è¯»â€ä¼šè¢«å•ç‹¬æ‹¿å‡ºæ¥è§£å†³çš„åŸå› ã€‚</p><p>åˆ°è¿™é‡Œï¼Œå…¶å®æˆ‘ä»¬åˆšè¯´æ˜å®Œæ–‡ç« çš„æ ‡é¢˜ ï¼šå¹»è¯»çš„å®šä¹‰å’Œå¹»è¯»æœ‰ä»€ä¹ˆé—®é¢˜ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†çœ‹çœ‹ InnoDB æ€ä¹ˆè§£å†³å¹»è¯»çš„é—®é¢˜ã€‚</p><h4 id="å¦‚ä½•è§£å†³å¹»è¯»" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•è§£å†³å¹»è¯»" aria-hidden="true">#</a> å¦‚ä½•è§£å†³å¹»è¯»ï¼Ÿ</h4><p>ç°åœ¨ä½ çŸ¥é“äº†ï¼Œäº§ç”Ÿå¹»è¯»çš„åŸå› æ˜¯ï¼Œè¡Œé”åªèƒ½é”ä½è¡Œï¼Œä½†æ˜¯æ–°æ’å…¥è®°å½•è¿™ä¸ªåŠ¨ä½œï¼Œè¦æ›´æ–°çš„æ˜¯è®°å½•ä¹‹é—´çš„â€œé—´éš™â€ã€‚å› æ­¤ï¼Œä¸ºäº†è§£å†³å¹»è¯»é—®é¢˜ï¼ŒInnoDB åªå¥½å¼•å…¥æ–°çš„é”ï¼Œä¹Ÿå°±æ˜¯é—´éš™é” (Gap Lock)ã€‚</p><p>é¡¾åæ€ä¹‰ï¼Œé—´éš™é”ï¼Œé”çš„å°±æ˜¯ä¸¤ä¸ªå€¼ä¹‹é—´çš„ç©ºéš™ã€‚æ¯”å¦‚æ–‡ç« å¼€å¤´çš„è¡¨ tï¼Œåˆå§‹åŒ–æ’å…¥äº† 6 ä¸ªè®°å½•ï¼Œè¿™å°±äº§ç”Ÿäº† 7 ä¸ªé—´éš™ã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/e7f7ca0d3dab2f48c588d714ee3ac861-1584367394558.png" alt="img"></p><p>å›¾ 5 è¡¨ t ä¸»é”®ç´¢å¼•ä¸Šçš„è¡Œé”å’Œé—´éš™é”</p><p>è¿™æ ·ï¼Œå½“ä½ æ‰§è¡Œ select * from t where d=5 for update çš„æ—¶å€™ï¼Œå°±ä¸æ­¢æ˜¯ç»™æ•°æ®åº“ä¸­å·²æœ‰çš„ 6 ä¸ªè®°å½•åŠ ä¸Šäº†è¡Œé”ï¼Œè¿˜åŒæ—¶åŠ äº† 7 ä¸ªé—´éš™é”ã€‚è¿™æ ·å°±ç¡®ä¿äº†æ— æ³•å†æ’å…¥æ–°çš„è®°å½•ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´è¿™æ—¶å€™ï¼Œåœ¨ä¸€è¡Œè¡Œæ‰«æçš„è¿‡ç¨‹ä¸­ï¼Œä¸ä»…å°†ç»™è¡ŒåŠ ä¸Šäº†è¡Œé”ï¼Œè¿˜ç»™è¡Œä¸¤è¾¹çš„ç©ºéš™ï¼Œä¹ŸåŠ ä¸Šäº†é—´éš™é”ã€‚</p><p>ç°åœ¨ä½ çŸ¥é“äº†ï¼Œæ•°æ®è¡Œæ˜¯å¯ä»¥åŠ ä¸Šé”çš„å®ä½“ï¼Œæ•°æ®è¡Œä¹‹é—´çš„é—´éš™ï¼Œä¹Ÿæ˜¯å¯ä»¥åŠ ä¸Šé”çš„å®ä½“ã€‚ä½†æ˜¯é—´éš™é”è·Ÿæˆ‘ä»¬ä¹‹å‰ç¢°åˆ°è¿‡çš„é”éƒ½ä¸å¤ªä¸€æ ·ã€‚</p><p>æ¯”å¦‚è¡Œé”ï¼Œåˆ†æˆè¯»é”å’Œå†™é”ã€‚ä¸‹å›¾å°±æ˜¯è¿™ä¸¤ç§ç±»å‹è¡Œé”çš„å†²çªå…³ç³»ã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/c435c765556c0f3735a6eda0779ff151-1584367394562.png" alt="img"></p><p>å›¾ 6 ä¸¤ç§è¡Œé”é—´çš„å†²çªå…³ç³»</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œè·Ÿè¡Œé”æœ‰å†²çªå…³ç³»çš„æ˜¯â€œå¦å¤–ä¸€ä¸ªè¡Œé”â€ã€‚</p><p>ä½†æ˜¯é—´éš™é”ä¸ä¸€æ ·ï¼Œ**è·Ÿé—´éš™é”å­˜åœ¨å†²çªå…³ç³»çš„ï¼Œæ˜¯â€œå¾€è¿™ä¸ªé—´éš™ä¸­æ’å…¥ä¸€ä¸ªè®°å½•â€è¿™ä¸ªæ“ä½œã€‚**é—´éš™é”ä¹‹é—´éƒ½ä¸å­˜åœ¨å†²çªå…³ç³»ã€‚</p><p>è¿™å¥è¯ä¸å¤ªå¥½ç†è§£ï¼Œæˆ‘ç»™ä½ ä¸¾ä¸ªä¾‹å­ï¼š</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/7c37732d936650f1cda7dbf27daf7498-1584367394590.png" alt="img"></p><p>å›¾ 7 é—´éš™é”ä¹‹é—´ä¸äº’é”</p><p>è¿™é‡Œ session B å¹¶ä¸ä¼šè¢«å µä½ã€‚å› ä¸ºè¡¨ t é‡Œå¹¶æ²¡æœ‰ c=7 è¿™ä¸ªè®°å½•ï¼Œå› æ­¤ session A åŠ çš„æ˜¯é—´éš™é” (5,10)ã€‚è€Œ session B ä¹Ÿæ˜¯åœ¨è¿™ä¸ªé—´éš™åŠ çš„é—´éš™é”ã€‚å®ƒä»¬æœ‰å…±åŒçš„ç›®æ ‡ï¼Œå³ï¼šä¿æŠ¤è¿™ä¸ªé—´éš™ï¼Œä¸å…è®¸æ’å…¥å€¼ã€‚ä½†ï¼Œå®ƒä»¬ä¹‹é—´æ˜¯ä¸å†²çªçš„ã€‚</p><p>é—´éš™é”å’Œè¡Œé”åˆç§° next-key lockï¼Œæ¯ä¸ª next-key lock æ˜¯å‰å¼€åé—­åŒºé—´ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬çš„è¡¨ t åˆå§‹åŒ–ä»¥åï¼Œå¦‚æœç”¨ select * from t for update è¦æŠŠæ•´ä¸ªè¡¨æ‰€æœ‰è®°å½•é”èµ·æ¥ï¼Œå°±å½¢æˆäº† 7 ä¸ª next-key lockï¼Œåˆ†åˆ«æ˜¯ (-âˆ,0]ã€(0,5]ã€(5,10]ã€(10,15]ã€(15,20]ã€(20, 25]ã€(25, +supremum]ã€‚</p><blockquote><p>å¤‡æ³¨ï¼šè¿™ç¯‡æ–‡ç« ä¸­ï¼Œå¦‚æœæ²¡æœ‰ç‰¹åˆ«è¯´æ˜ï¼Œæˆ‘ä»¬æŠŠé—´éš™é”è®°ä¸ºå¼€åŒºé—´ï¼ŒæŠŠ next-key lock è®°ä¸ºå‰å¼€åé—­åŒºé—´ã€‚</p></blockquote><p>ä½ å¯èƒ½ä¼šé—®è¯´ï¼Œè¿™ä¸ª supremum ä»å“ªå„¿æ¥çš„å‘¢ï¼Ÿ</p><p>è¿™æ˜¯å› ä¸º +âˆæ˜¯å¼€åŒºé—´ã€‚å®ç°ä¸Šï¼ŒInnoDB ç»™æ¯ä¸ªç´¢å¼•åŠ äº†ä¸€ä¸ªä¸å­˜åœ¨çš„æœ€å¤§å€¼ supremumï¼Œè¿™æ ·æ‰ç¬¦åˆæˆ‘ä»¬å‰é¢è¯´çš„â€œéƒ½æ˜¯å‰å¼€åé—­åŒºé—´â€ã€‚</p><p><strong>é—´éš™é”å’Œ next-key lock çš„å¼•å…¥ï¼Œå¸®æˆ‘ä»¬è§£å†³äº†å¹»è¯»çš„é—®é¢˜ï¼Œä½†åŒæ—¶ä¹Ÿå¸¦æ¥äº†ä¸€äº›â€œå›°æ‰°â€ã€‚</strong></p><p>åœ¨å‰é¢çš„æ–‡ç« ä¸­ï¼Œå°±æœ‰åŒå­¦æåˆ°äº†è¿™ä¸ªé—®é¢˜ã€‚æˆ‘æŠŠä»–çš„é—®é¢˜è½¬è¿°ä¸€ä¸‹ï¼Œå¯¹åº”åˆ°æˆ‘ä»¬è¿™ä¸ªä¾‹å­çš„è¡¨æ¥è¯´ï¼Œä¸šåŠ¡é€»è¾‘è¿™æ ·çš„ï¼šä»»æ„é”ä½ä¸€è¡Œï¼Œå¦‚æœè¿™ä¸€è¡Œä¸å­˜åœ¨çš„è¯å°±æ’å…¥ï¼Œå¦‚æœå­˜åœ¨è¿™ä¸€è¡Œå°±æ›´æ–°å®ƒçš„æ•°æ®ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">begin</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t <span class="token keyword">where</span> id<span class="token operator">=</span>N <span class="token keyword">for</span> <span class="token keyword">update</span><span class="token punctuation">;</span> 
<span class="token comment">/* å¦‚æœè¡Œä¸å­˜åœ¨ */</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> t <span class="token keyword">values</span><span class="token punctuation">(</span>N<span class="token punctuation">,</span>N<span class="token punctuation">,</span>N<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* å¦‚æœè¡Œå­˜åœ¨ */</span>
<span class="token keyword">update</span> t <span class="token keyword">set</span> d<span class="token operator">=</span>N <span class="token keyword">set</span> id<span class="token operator">=</span>N<span class="token punctuation">;</span> 
<span class="token keyword">commit</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯èƒ½ä½ ä¼šè¯´ï¼Œè¿™ä¸ªä¸æ˜¯ insert â€¦ on duplicate key update å°±èƒ½è§£å†³å—ï¼Ÿä½†å…¶å®åœ¨æœ‰å¤šä¸ªå”¯ä¸€é”®çš„æ—¶å€™ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯ä¸èƒ½æ»¡è¶³è¿™ä½æé—®åŒå­¦çš„éœ€æ±‚çš„ã€‚è‡³äºä¸ºä»€ä¹ˆï¼Œæˆ‘ä¼šåœ¨åé¢çš„æ–‡ç« ä¸­å†å±•å¼€è¯´æ˜ã€‚</p><p>ç°åœ¨ï¼Œæˆ‘ä»¬å°±åªè®¨è®ºè¿™ä¸ªé€»è¾‘ã€‚</p><p>è¿™ä¸ªåŒå­¦ç¢°åˆ°çš„ç°è±¡æ˜¯ï¼Œè¿™ä¸ªé€»è¾‘ä¸€æ—¦æœ‰å¹¶å‘ï¼Œå°±ä¼šç¢°åˆ°æ­»é”ã€‚ä½ ä¸€å®šä¹Ÿè§‰å¾—å¥‡æ€ªï¼Œè¿™ä¸ªé€»è¾‘æ¯æ¬¡æ“ä½œå‰ç”¨ for update é”èµ·æ¥ï¼Œå·²ç»æ˜¯æœ€ä¸¥æ ¼çš„æ¨¡å¼äº†ï¼Œæ€ä¹ˆè¿˜ä¼šæœ‰æ­»é”å‘¢ï¼Ÿ</p><p>è¿™é‡Œï¼Œæˆ‘ç”¨ä¸¤ä¸ª session æ¥æ¨¡æ‹Ÿå¹¶å‘ï¼Œå¹¶å‡è®¾ N=9ã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/df37bf0bb9f85ea59f0540e24eb6bcbe-1584367394594.png" alt="img"></p><p>å›¾ 8 é—´éš™é”å¯¼è‡´çš„æ­»é”</p><p>ä½ çœ‹åˆ°äº†ï¼Œå…¶å®éƒ½ä¸éœ€è¦ç”¨åˆ°åé¢çš„ update è¯­å¥ï¼Œå°±å·²ç»å½¢æˆæ­»é”äº†ã€‚æˆ‘ä»¬æŒ‰è¯­å¥æ‰§è¡Œé¡ºåºæ¥åˆ†æä¸€ä¸‹ï¼š</p><ol><li>session A æ‰§è¡Œ select â€¦ for update è¯­å¥ï¼Œç”±äº id=9 è¿™ä¸€è¡Œå¹¶ä¸å­˜åœ¨ï¼Œå› æ­¤ä¼šåŠ ä¸Šé—´éš™é” (5,10);</li><li>session B æ‰§è¡Œ select â€¦ for update è¯­å¥ï¼ŒåŒæ ·ä¼šåŠ ä¸Šé—´éš™é” (5,10)ï¼Œé—´éš™é”ä¹‹é—´ä¸ä¼šå†²çªï¼Œå› æ­¤è¿™ä¸ªè¯­å¥å¯ä»¥æ‰§è¡ŒæˆåŠŸï¼›</li><li>session B è¯•å›¾æ’å…¥ä¸€è¡Œ (9,9,9)ï¼Œè¢« session A çš„é—´éš™é”æŒ¡ä½äº†ï¼Œåªå¥½è¿›å…¥ç­‰å¾…ï¼›</li><li>session A è¯•å›¾æ’å…¥ä¸€è¡Œ (9,9,9)ï¼Œè¢« session B çš„é—´éš™é”æŒ¡ä½äº†ã€‚</li></ol><p>è‡³æ­¤ï¼Œä¸¤ä¸ª session è¿›å…¥äº’ç›¸ç­‰å¾…çŠ¶æ€ï¼Œå½¢æˆæ­»é”ã€‚å½“ç„¶ï¼ŒInnoDB çš„æ­»é”æ£€æµ‹é©¬ä¸Šå°±å‘ç°äº†è¿™å¯¹æ­»é”å…³ç³»ï¼Œè®© session A çš„ insert è¯­å¥æŠ¥é”™è¿”å›äº†ã€‚</p><p>ä½ ç°åœ¨çŸ¥é“äº†ï¼Œ<strong>é—´éš™é”çš„å¼•å…¥ï¼Œå¯èƒ½ä¼šå¯¼è‡´åŒæ ·çš„è¯­å¥é”ä½æ›´å¤§çš„èŒƒå›´ï¼Œè¿™å…¶å®æ˜¯å½±å“äº†å¹¶å‘åº¦çš„</strong>ã€‚å…¶å®ï¼Œè¿™è¿˜åªæ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­æˆ‘ä»¬è¿˜ä¼šç¢°åˆ°æ›´å¤šã€æ›´å¤æ‚çš„ä¾‹å­ã€‚</p><p>ä½ å¯èƒ½ä¼šè¯´ï¼Œä¸ºäº†è§£å†³å¹»è¯»çš„é—®é¢˜ï¼Œæˆ‘ä»¬å¼•å…¥äº†è¿™ä¹ˆä¸€å¤§ä¸²å†…å®¹ï¼Œæœ‰æ²¡æœ‰æ›´ç®€å•ä¸€ç‚¹çš„å¤„ç†æ–¹æ³•å‘¢ã€‚</p><p>æˆ‘åœ¨æ–‡ç« ä¸€å¼€å§‹å°±è¯´è¿‡ï¼Œå¦‚æœæ²¡æœ‰ç‰¹åˆ«è¯´æ˜ï¼Œä»Šå¤©å’Œä½ åˆ†æçš„é—®é¢˜éƒ½æ˜¯åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹çš„ï¼Œé—´éš™é”æ˜¯åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹æ‰ä¼šç”Ÿæ•ˆçš„ã€‚æ‰€ä»¥ï¼Œä½ å¦‚æœæŠŠéš”ç¦»çº§åˆ«è®¾ç½®ä¸ºè¯»æäº¤çš„è¯ï¼Œå°±æ²¡æœ‰é—´éš™é”äº†ã€‚ä½†åŒæ—¶ï¼Œä½ è¦è§£å†³å¯èƒ½å‡ºç°çš„æ•°æ®å’Œæ—¥å¿—ä¸ä¸€è‡´é—®é¢˜ï¼Œéœ€è¦æŠŠ binlog æ ¼å¼è®¾ç½®ä¸º rowã€‚è¿™ï¼Œä¹Ÿæ˜¯ç°åœ¨ä¸å°‘å…¬å¸ä½¿ç”¨çš„é…ç½®ç»„åˆã€‚</p><p>å‰é¢æ–‡ç« çš„è¯„è®ºåŒºæœ‰åŒå­¦ç•™è¨€è¯´ï¼Œä»–ä»¬å…¬å¸å°±ä½¿ç”¨çš„æ˜¯è¯»æäº¤éš”ç¦»çº§åˆ«åŠ  binlog_format=row çš„ç»„åˆã€‚ä»–æ›¾é—®ä»–ä»¬å…¬å¸çš„ DBA è¯´ï¼Œä½ ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆé…ç½®ã€‚DBA ç›´æ¥ç­”å¤è¯´ï¼Œå› ä¸ºå¤§å®¶éƒ½è¿™ä¹ˆç”¨å‘€ã€‚</p><p>æ‰€ä»¥ï¼Œè¿™ä¸ªåŒå­¦åœ¨è¯„è®ºåŒºå°±é—®è¯´ï¼Œè¿™ä¸ªé…ç½®åˆ°åº•åˆä¸åˆç†ã€‚</p><p>å…³äºè¿™ä¸ªé—®é¢˜æœ¬èº«çš„ç­”æ¡ˆæ˜¯ï¼Œå¦‚æœè¯»æäº¤éš”ç¦»çº§åˆ«å¤Ÿç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸šåŠ¡ä¸éœ€è¦å¯é‡å¤è¯»çš„ä¿è¯ï¼Œè¿™æ ·è€ƒè™‘åˆ°è¯»æäº¤ä¸‹æ“ä½œæ•°æ®çš„é”èŒƒå›´æ›´å°ï¼ˆæ²¡æœ‰é—´éš™é”ï¼‰ï¼Œè¿™ä¸ªé€‰æ‹©æ˜¯åˆç†çš„ã€‚</p><p>ä½†å…¶å®æˆ‘æƒ³è¯´çš„æ˜¯ï¼Œé…ç½®æ˜¯å¦åˆç†ï¼Œè·Ÿä¸šåŠ¡åœºæ™¯æœ‰å…³ï¼Œéœ€è¦å…·ä½“é—®é¢˜å…·ä½“åˆ†æã€‚</p><p>ä½†æ˜¯ï¼Œå¦‚æœ DBA è®¤ä¸ºä¹‹æ‰€ä»¥è¿™ä¹ˆç”¨çš„åŸå› æ˜¯â€œå¤§å®¶éƒ½è¿™ä¹ˆç”¨â€ï¼Œé‚£å°±æœ‰é—®é¢˜äº†ï¼Œæˆ–è€…è¯´ï¼Œè¿Ÿæ—©ä¼šå‡ºé—®é¢˜ã€‚</p><p>æ¯”å¦‚è¯´ï¼Œå¤§å®¶éƒ½ç”¨è¯»æäº¤ï¼Œå¯æ˜¯é€»è¾‘å¤‡ä»½çš„æ—¶å€™ï¼Œmysqldump ä¸ºä»€ä¹ˆè¦æŠŠå¤‡ä»½çº¿ç¨‹è®¾ç½®æˆå¯é‡å¤è¯»å‘¢ï¼Ÿï¼ˆè¿™ä¸ªæˆ‘åœ¨å‰é¢çš„æ–‡ç« ä¸­å·²ç»è§£é‡Šè¿‡äº†ï¼Œä½ å¯ä»¥å†å›é¡¾ä¸‹ç¬¬ 6 ç¯‡æ–‡ç« [ã€Šå…¨å±€é”å’Œè¡¨é” ï¼šç»™è¡¨åŠ ä¸ªå­—æ®µæ€ä¹ˆæœ‰è¿™ä¹ˆå¤šé˜»ç¢ï¼Ÿã€‹]çš„å†…å®¹ï¼‰</p><p>ç„¶åï¼Œåœ¨å¤‡ä»½æœŸé—´ï¼Œå¤‡ä»½çº¿ç¨‹ç”¨çš„æ˜¯å¯é‡å¤è¯»ï¼Œè€Œä¸šåŠ¡çº¿ç¨‹ç”¨çš„æ˜¯è¯»æäº¤ã€‚åŒæ—¶å­˜åœ¨ä¸¤ç§äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Œä¼šä¸ä¼šæœ‰é—®é¢˜ï¼Ÿ</p><p>è¿›ä¸€æ­¥åœ°ï¼Œè¿™ä¸¤ä¸ªä¸åŒçš„éš”ç¦»çº§åˆ«ç°è±¡æœ‰ä»€ä¹ˆä¸ä¸€æ ·çš„ï¼Œå…³äºæˆ‘ä»¬çš„ä¸šåŠ¡ï¼Œâ€œç”¨è¯»æäº¤å°±å¤Ÿäº†â€è¿™ä¸ªç»“è®ºæ˜¯æ€ä¹ˆå¾—åˆ°çš„ï¼Ÿ</p><p>å¦‚æœä¸šåŠ¡å¼€å‘å’Œè¿ç»´å›¢é˜Ÿè¿™äº›é—®é¢˜éƒ½æ²¡æœ‰å¼„æ¸…æ¥šï¼Œé‚£ä¹ˆâ€œæ²¡é—®é¢˜â€è¿™ä¸ªç»“è®ºï¼Œæœ¬èº«å°±æ˜¯æœ‰é—®é¢˜çš„ã€‚</p><h4 id="å°ç»“-12" tabindex="-1"><a class="header-anchor" href="#å°ç»“-12" aria-hidden="true">#</a> å°ç»“</h4><p>ä»Šå¤©æˆ‘ä»¬ä»ä¸Šä¸€ç¯‡æ–‡ç« çš„è¯¾åé—®é¢˜è¯´èµ·ï¼Œæåˆ°äº†å…¨è¡¨æ‰«æçš„åŠ é”æ–¹å¼ã€‚æˆ‘ä»¬å‘ç°å³ä½¿ç»™æ‰€æœ‰çš„è¡Œéƒ½åŠ ä¸Šè¡Œé”ï¼Œä»ç„¶æ— æ³•è§£å†³å¹»è¯»é—®é¢˜ï¼Œå› æ­¤å¼•å…¥äº†é—´éš™é”çš„æ¦‚å¿µã€‚</p><p>æˆ‘ç¢°åˆ°è¿‡å¾ˆå¤šå¯¹æ•°æ®åº“æœ‰ä¸€å®šäº†è§£çš„ä¸šåŠ¡å¼€å‘äººå‘˜ï¼Œä»–ä»¬åœ¨è®¾è®¡æ•°æ®è¡¨ç»“æ„å’Œä¸šåŠ¡ SQL è¯­å¥çš„æ—¶å€™ï¼Œå¯¹è¡Œé”æœ‰å¾ˆå‡†ç¡®çš„è®¤è¯†ï¼Œä½†å´å¾ˆå°‘è€ƒè™‘åˆ°é—´éš™é”ã€‚æœ€åçš„ç»“æœï¼Œå°±æ˜¯ç”Ÿäº§åº“ä¸Šä¼šç»å¸¸å‡ºç°ç”±äºé—´éš™é”å¯¼è‡´çš„æ­»é”ç°è±¡ã€‚</p><p>è¡Œé”ç¡®å®æ¯”è¾ƒç›´è§‚ï¼Œåˆ¤æ–­è§„åˆ™ä¹Ÿç›¸å¯¹ç®€å•ï¼Œé—´éš™é”çš„å¼•å…¥ä¼šå½±å“ç³»ç»Ÿçš„å¹¶å‘åº¦ï¼Œä¹Ÿå¢åŠ äº†é”åˆ†æçš„å¤æ‚åº¦ï¼Œä½†ä¹Ÿæœ‰ç« å¯å¾ªã€‚ä¸‹ä¸€ç¯‡æ–‡ç« ï¼Œæˆ‘å°±ä¼šä¸ºä½ è®²è§£ InnoDB çš„åŠ é”è§„åˆ™ï¼Œå¸®ä½ ç†é¡ºè¿™å…¶ä¸­çš„â€œç« æ³•â€ã€‚</p><p>ä½œä¸ºå¯¹ä¸‹ä¸€ç¯‡æ–‡ç« çš„é¢„ä¹ ï¼Œæˆ‘ç»™ä½ ç•™ä¸‹ä¸€ä¸ªæ€è€ƒé¢˜ã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/0d796060073668ca169166a8903fbf3d-1584367394597.png" alt="img"></p><p>å›¾ 9 äº‹åŠ¡è¿›å…¥é”ç­‰å¾…çŠ¶æ€</p><p>å¦‚æœä½ ä¹‹å‰æ²¡æœ‰äº†è§£è¿‡æœ¬ç¯‡æ–‡ç« çš„ç›¸å…³å†…å®¹ï¼Œä¸€å®šè§‰å¾—è¿™ä¸‰ä¸ªè¯­å¥ç®€ç›´æ˜¯é£é©¬ç‰›ä¸ç›¸åŠã€‚ä½†å®é™…ä¸Šï¼Œè¿™é‡Œ session B å’Œ session C çš„ insert è¯­å¥éƒ½ä¼šè¿›å…¥é”ç­‰å¾…çŠ¶æ€ã€‚</p><p>ä½ å¯ä»¥è¯•ç€åˆ†æä¸€ä¸‹ï¼Œå‡ºç°è¿™ç§æƒ…å†µçš„åŸå› æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>è¿™é‡Œéœ€è¦è¯´æ˜çš„æ˜¯ï¼Œè¿™å…¶å®æ˜¯æˆ‘åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä»‹ç»åŠ é”è§„åˆ™åæ‰èƒ½å›ç­”çš„é—®é¢˜ï¼Œæ˜¯ç•™ç»™ä½ ä½œä¸ºé¢„ä¹ çš„ï¼Œå…¶ä¸­ session C è¢«é”ä½è¿™ä¸ªåˆ†ææ˜¯æœ‰ç‚¹éš¾åº¦çš„ã€‚å¦‚æœä½ æ²¡æœ‰åˆ†æå‡ºæ¥ï¼Œä¹Ÿä¸è¦æ°”é¦ï¼Œæˆ‘ä¼šåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« å’Œä½ è¯¦ç»†è¯´æ˜ã€‚</p><p>ä½ ä¹Ÿå¯ä»¥è¯´è¯´ï¼Œä½ çš„çº¿ä¸Š MySQL é…ç½®çš„æ˜¯ä»€ä¹ˆéš”ç¦»çº§åˆ«ï¼Œä¸ºä»€ä¹ˆä¼šè¿™ä¹ˆé…ç½®ï¼Ÿä½ æœ‰æ²¡æœ‰ç¢°åˆ°ä»€ä¹ˆåœºæ™¯ï¼Œæ˜¯å¿…é¡»ä½¿ç”¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«çš„å‘¢ï¼Ÿ</p><p>ä½ å¯ä»¥æŠŠä½ çš„ç¢°åˆ°çš„åœºæ™¯å’Œåˆ†æå†™åœ¨ç•™è¨€åŒºé‡Œï¼Œæˆ‘ä¼šåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« é€‰å–æœ‰è¶£çš„è¯„è®ºè·Ÿå¤§å®¶ä¸€èµ·åˆ†äº«å’Œåˆ†æã€‚æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚</p><h4 id="ä¸ŠæœŸé—®é¢˜æ—¶é—´-9" tabindex="-1"><a class="header-anchor" href="#ä¸ŠæœŸé—®é¢˜æ—¶é—´-9" aria-hidden="true">#</a> ä¸ŠæœŸé—®é¢˜æ—¶é—´</h4><p>æˆ‘ä»¬åœ¨æœ¬æ–‡çš„å¼€å¤´å›ç­”äº†ä¸ŠæœŸé—®é¢˜ã€‚æœ‰åŒå­¦çš„å›ç­”ä¸­è¿˜è¯´æ˜äº†è¯»æäº¤éš”ç¦»çº§åˆ«ä¸‹ï¼Œåœ¨è¯­å¥æ‰§è¡Œå®Œæˆåï¼Œæ˜¯åªæœ‰è¡Œé”çš„ã€‚è€Œä¸”è¯­å¥æ‰§è¡Œå®Œæˆåï¼ŒInnoDB å°±ä¼šæŠŠä¸æ»¡è¶³æ¡ä»¶çš„è¡Œè¡Œé”å»æ‰ã€‚</p><p>å½“ç„¶äº†ï¼Œc=5 è¿™ä¸€è¡Œçš„è¡Œé”ï¼Œè¿˜æ˜¯ä¼šç­‰åˆ° commit çš„æ—¶å€™æ‰é‡Šæ”¾çš„ã€‚</p><p>è¯„è®ºåŒºç•™è¨€ç‚¹èµæ¿ï¼š</p><blockquote><p>@è–›ç•… ã€@å¼ æ°¸å¿—åŒå­¦ç»™å‡ºäº†æ­£ç¡®ç­”æ¡ˆã€‚è€Œä¸”æåˆ°äº†åœ¨è¯»æäº¤éš”ç¦»çº§åˆ«ä¸‹ï¼Œæ˜¯åªæœ‰è¡Œé”çš„ã€‚ @å¸†å¸†å¸†å¸†å¸†å¸†å¸†å¸†ã€@æ¬§é˜³æˆ å¯¹ä¸ŠæœŸçš„ä¾‹å­åšäº†éªŒè¯ï¼Œéœ€è¦è¯´æ˜ä¸€ä¸‹ï¼Œéœ€è¦åœ¨å¯åŠ¨é…ç½®é‡Œé¢å¢åŠ  performance_schema=onï¼Œæ‰èƒ½ç”¨ä¸Šè¿™ä¸ªåŠŸèƒ½ï¼Œperformance_schema åº“é‡Œçš„è¡¨æ‰æœ‰æ•°æ®ã€‚</p></blockquote><h3 id="_22-mysqlæœ‰å“ªäº›-é¥®é¸©æ­¢æ¸´-æé«˜æ€§èƒ½çš„æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#_22-mysqlæœ‰å“ªäº›-é¥®é¸©æ­¢æ¸´-æé«˜æ€§èƒ½çš„æ–¹æ³•" aria-hidden="true">#</a> 22 MySQLæœ‰å“ªäº›â€œé¥®é¸©æ­¢æ¸´â€æé«˜æ€§èƒ½çš„æ–¹æ³•ï¼Ÿ</h3><p>ä¸çŸ¥é“ä½ åœ¨å®é™…è¿ç»´è¿‡ç¨‹ä¸­æœ‰æ²¡æœ‰ç¢°åˆ°è¿™æ ·çš„æƒ…æ™¯ï¼šä¸šåŠ¡é«˜å³°æœŸï¼Œç”Ÿäº§ç¯å¢ƒçš„ MySQL å‹åŠ›å¤ªå¤§ï¼Œæ²¡æ³•æ­£å¸¸å“åº”ï¼Œéœ€è¦çŸ­æœŸå†…ã€ä¸´æ—¶æ€§åœ°æå‡ä¸€äº›æ€§èƒ½ã€‚</p><p>æˆ‘ä»¥å‰åšä¸šåŠ¡æŠ¤èˆªçš„æ—¶å€™ï¼Œå°±å¶å°”ä¼šç¢°ä¸Šè¿™ç§åœºæ™¯ã€‚ç”¨æˆ·çš„å¼€å‘è´Ÿè´£äººè¯´ï¼Œä¸ç®¡ä½ ç”¨ä»€ä¹ˆæ–¹æ¡ˆï¼Œè®©ä¸šåŠ¡å…ˆè·‘èµ·æ¥å†è¯´ã€‚</p><p>ä½†ï¼Œå¦‚æœæ˜¯æ— æŸæ–¹æ¡ˆçš„è¯ï¼Œè‚¯å®šä¸éœ€è¦ç­‰åˆ°è¿™ä¸ªæ—¶å€™æ‰ä¸Šåœºã€‚ä»Šå¤©æˆ‘ä»¬å°±æ¥èŠèŠè¿™äº›ä¸´æ—¶æ–¹æ¡ˆï¼Œå¹¶ç€é‡è¯´ä¸€è¯´å®ƒä»¬å¯èƒ½å­˜åœ¨çš„é£é™©ã€‚</p><h4 id="çŸ­è¿æ¥é£æš´" tabindex="-1"><a class="header-anchor" href="#çŸ­è¿æ¥é£æš´" aria-hidden="true">#</a> çŸ­è¿æ¥é£æš´</h4><p>æ­£å¸¸çš„çŸ­è¿æ¥æ¨¡å¼å°±æ˜¯è¿æ¥åˆ°æ•°æ®åº“åï¼Œæ‰§è¡Œå¾ˆå°‘çš„ SQL è¯­å¥å°±æ–­å¼€ï¼Œä¸‹æ¬¡éœ€è¦çš„æ—¶å€™å†é‡è¿ã€‚å¦‚æœä½¿ç”¨çš„æ˜¯çŸ­è¿æ¥ï¼Œåœ¨ä¸šåŠ¡é«˜å³°æœŸçš„æ—¶å€™ï¼Œå°±å¯èƒ½å‡ºç°è¿æ¥æ•°çªç„¶æš´æ¶¨çš„æƒ…å†µã€‚</p><p>æˆ‘åœ¨ç¬¬ 1 ç¯‡æ–‡ç« [ã€ŠåŸºç¡€æ¶æ„ï¼šä¸€æ¡ SQL æŸ¥è¯¢è¯­å¥æ˜¯å¦‚ä½•æ‰§è¡Œçš„ï¼Ÿã€‹]ä¸­è¯´è¿‡ï¼ŒMySQL å»ºç«‹è¿æ¥çš„è¿‡ç¨‹ï¼Œæˆæœ¬æ˜¯å¾ˆé«˜çš„ã€‚é™¤äº†æ­£å¸¸çš„ç½‘ç»œè¿æ¥ä¸‰æ¬¡æ¡æ‰‹å¤–ï¼Œè¿˜éœ€è¦åšç™»å½•æƒé™åˆ¤æ–­å’Œè·å¾—è¿™ä¸ªè¿æ¥çš„æ•°æ®è¯»å†™æƒé™ã€‚</p><p>åœ¨æ•°æ®åº“å‹åŠ›æ¯”è¾ƒå°çš„æ—¶å€™ï¼Œè¿™äº›é¢å¤–çš„æˆæœ¬å¹¶ä¸æ˜æ˜¾ã€‚</p><p>ä½†æ˜¯ï¼ŒçŸ­è¿æ¥æ¨¡å‹å­˜åœ¨ä¸€ä¸ªé£é™©ï¼Œå°±æ˜¯ä¸€æ—¦æ•°æ®åº“å¤„ç†å¾—æ…¢ä¸€äº›ï¼Œè¿æ¥æ•°å°±ä¼šæš´æ¶¨ã€‚max_connections å‚æ•°ï¼Œç”¨æ¥æ§åˆ¶ä¸€ä¸ª MySQL å®ä¾‹åŒæ—¶å­˜åœ¨çš„è¿æ¥æ•°çš„ä¸Šé™ï¼Œè¶…è¿‡è¿™ä¸ªå€¼ï¼Œç³»ç»Ÿå°±ä¼šæ‹’ç»æ¥ä¸‹æ¥çš„è¿æ¥è¯·æ±‚ï¼Œå¹¶æŠ¥é”™æç¤ºâ€œToo many connectionsâ€ã€‚å¯¹äºè¢«æ‹’ç»è¿æ¥çš„è¯·æ±‚æ¥è¯´ï¼Œä»ä¸šåŠ¡è§’åº¦çœ‹å°±æ˜¯æ•°æ®åº“ä¸å¯ç”¨ã€‚</p><p>åœ¨æœºå™¨è´Ÿè½½æ¯”è¾ƒé«˜çš„æ—¶å€™ï¼Œå¤„ç†ç°æœ‰è¯·æ±‚çš„æ—¶é—´å˜é•¿ï¼Œæ¯ä¸ªè¿æ¥ä¿æŒçš„æ—¶é—´ä¹Ÿæ›´é•¿ã€‚è¿™æ—¶ï¼Œå†æœ‰æ–°å»ºè¿æ¥çš„è¯ï¼Œå°±å¯èƒ½ä¼šè¶…è¿‡ max_connections çš„é™åˆ¶ã€‚</p><p>ç¢°åˆ°è¿™ç§æƒ…å†µæ—¶ï¼Œä¸€ä¸ªæ¯”è¾ƒè‡ªç„¶çš„æƒ³æ³•ï¼Œå°±æ˜¯è°ƒé«˜ max_connections çš„å€¼ã€‚ä½†è¿™æ ·åšæ˜¯æœ‰é£é™©çš„ã€‚å› ä¸ºè®¾è®¡ max_connections è¿™ä¸ªå‚æ•°çš„ç›®çš„æ˜¯æƒ³ä¿æŠ¤ MySQLï¼Œå¦‚æœæˆ‘ä»¬æŠŠå®ƒæ”¹å¾—å¤ªå¤§ï¼Œè®©æ›´å¤šçš„è¿æ¥éƒ½å¯ä»¥è¿›æ¥ï¼Œé‚£ä¹ˆç³»ç»Ÿçš„è´Ÿè½½å¯èƒ½ä¼šè¿›ä¸€æ­¥åŠ å¤§ï¼Œå¤§é‡çš„èµ„æºè€—è´¹åœ¨æƒé™éªŒè¯ç­‰é€»è¾‘ä¸Šï¼Œç»“æœå¯èƒ½æ˜¯é€‚å¾—å…¶åï¼Œå·²ç»è¿æ¥çš„çº¿ç¨‹æ‹¿ä¸åˆ° CPU èµ„æºå»æ‰§è¡Œä¸šåŠ¡çš„ SQL è¯·æ±‚ã€‚</p><p>é‚£ä¹ˆè¿™ç§æƒ…å†µä¸‹ï¼Œä½ è¿˜æœ‰æ²¡æœ‰åˆ«çš„å»ºè®®å‘¢ï¼Ÿæˆ‘è¿™é‡Œè¿˜æœ‰ä¸¤ç§æ–¹æ³•ï¼Œä½†è¦æ³¨æ„ï¼Œè¿™äº›æ–¹æ³•éƒ½æ˜¯æœ‰æŸçš„ã€‚</p><p><strong>ç¬¬ä¸€ç§æ–¹æ³•ï¼šå…ˆå¤„ç†æ‰é‚£äº›å ç€è¿æ¥ä½†æ˜¯ä¸å·¥ä½œçš„çº¿ç¨‹ã€‚</strong></p><p>max_connections çš„è®¡ç®—ï¼Œä¸æ˜¯çœ‹è°åœ¨ runningï¼Œæ˜¯åªè¦è¿ç€å°±å ç”¨ä¸€ä¸ªè®¡æ•°ä½ç½®ã€‚å¯¹äºé‚£äº›ä¸éœ€è¦ä¿æŒçš„è¿æ¥ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ kill connection ä¸»åŠ¨è¸¢æ‰ã€‚è¿™ä¸ªè¡Œä¸ºè·Ÿäº‹å…ˆè®¾ç½® wait_timeout çš„æ•ˆæœæ˜¯ä¸€æ ·çš„ã€‚è®¾ç½® wait_timeout å‚æ•°è¡¨ç¤ºçš„æ˜¯ï¼Œä¸€ä¸ªçº¿ç¨‹ç©ºé—² wait_timeout è¿™ä¹ˆå¤šç§’ä¹‹åï¼Œå°±ä¼šè¢« MySQL ç›´æ¥æ–­å¼€è¿æ¥ã€‚</p><p>ä½†æ˜¯éœ€è¦æ³¨æ„ï¼Œåœ¨ show processlist çš„ç»“æœé‡Œï¼Œè¸¢æ‰æ˜¾ç¤ºä¸º sleep çš„çº¿ç¨‹ï¼Œå¯èƒ½æ˜¯æœ‰æŸçš„ã€‚æˆ‘ä»¬æ¥çœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­ã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/9091ff280592c8c68665771b1516c62a-1584367394653.png" alt="img"></p><p>å›¾ 1 sleep çº¿ç¨‹çš„ä¸¤ç§çŠ¶æ€</p><p>åœ¨ä¸Šé¢è¿™ä¸ªä¾‹å­é‡Œï¼Œå¦‚æœæ–­å¼€ session A çš„è¿æ¥ï¼Œå› ä¸ºè¿™æ—¶å€™ session A è¿˜æ²¡æœ‰æäº¤ï¼Œæ‰€ä»¥ MySQL åªèƒ½æŒ‰ç…§å›æ»šäº‹åŠ¡æ¥å¤„ç†ï¼›è€Œæ–­å¼€ session B çš„è¿æ¥ï¼Œå°±æ²¡ä»€ä¹ˆå¤§å½±å“ã€‚æ‰€ä»¥ï¼Œå¦‚æœæŒ‰ç…§ä¼˜å…ˆçº§æ¥è¯´ï¼Œä½ åº”è¯¥ä¼˜å…ˆæ–­å¼€åƒ session B è¿™æ ·çš„äº‹åŠ¡å¤–ç©ºé—²çš„è¿æ¥ã€‚</p><p>ä½†æ˜¯ï¼Œæ€ä¹ˆåˆ¤æ–­å“ªäº›æ˜¯äº‹åŠ¡å¤–ç©ºé—²çš„å‘¢ï¼Ÿsession C åœ¨ T æ—¶åˆ»ä¹‹åçš„ 30 ç§’æ‰§è¡Œ show processlistï¼Œçœ‹åˆ°çš„ç»“æœæ˜¯è¿™æ ·çš„ã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/ae6a9ceecf8517e47f9ebfc565f0f925-1584367394656.png" alt="img"></p><p>å›¾ 2 sleep çº¿ç¨‹çš„ä¸¤ç§çŠ¶æ€ï¼Œshow processlist ç»“æœ</p><p>å›¾ä¸­ id=4 å’Œ id=5 çš„ä¸¤ä¸ªä¼šè¯éƒ½æ˜¯ Sleep çŠ¶æ€ã€‚è€Œè¦çœ‹äº‹åŠ¡å…·ä½“çŠ¶æ€çš„è¯ï¼Œä½ å¯ä»¥æŸ¥ information_schema åº“çš„ innodb_trx è¡¨ã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/ca4b455c8eacbf32b98d1fe9ed9876e8-1584367394660.png" alt="img"></p><p>å›¾ 3 ä» information_schema.innodb_trx æŸ¥è¯¢äº‹åŠ¡çŠ¶æ€</p><p>è¿™ä¸ªç»“æœé‡Œï¼Œtrx_mysql_thread_id=4ï¼Œè¡¨ç¤º id=4 çš„çº¿ç¨‹è¿˜å¤„åœ¨äº‹åŠ¡ä¸­ã€‚</p><p>å› æ­¤ï¼Œå¦‚æœæ˜¯è¿æ¥æ•°è¿‡å¤šï¼Œä½ å¯ä»¥ä¼˜å…ˆæ–­å¼€äº‹åŠ¡å¤–ç©ºé—²å¤ªä¹…çš„è¿æ¥ï¼›å¦‚æœè¿™æ ·è¿˜ä¸å¤Ÿï¼Œå†è€ƒè™‘æ–­å¼€äº‹åŠ¡å†…ç©ºé—²å¤ªä¹…çš„è¿æ¥ã€‚</p><p>ä»æœåŠ¡ç«¯æ–­å¼€è¿æ¥ä½¿ç”¨çš„æ˜¯ kill connection + id çš„å‘½ä»¤ï¼Œ ä¸€ä¸ªå®¢æˆ·ç«¯å¤„äº sleep çŠ¶æ€æ—¶ï¼Œå®ƒçš„è¿æ¥è¢«æœåŠ¡ç«¯ä¸»åŠ¨æ–­å¼€åï¼Œè¿™ä¸ªå®¢æˆ·ç«¯å¹¶ä¸ä¼šé©¬ä¸ŠçŸ¥é“ã€‚ç›´åˆ°å®¢æˆ·ç«¯åœ¨å‘èµ·ä¸‹ä¸€ä¸ªè¯·æ±‚çš„æ—¶å€™ï¼Œæ‰ä¼šæ”¶åˆ°è¿™æ ·çš„æŠ¥é”™â€œERROR 2013 (HY000): Lost connection to MySQL server during queryâ€ã€‚</p><p>ä»æ•°æ®åº“ç«¯ä¸»åŠ¨æ–­å¼€è¿æ¥å¯èƒ½æ˜¯æœ‰æŸçš„ï¼Œå°¤å…¶æ˜¯æœ‰çš„åº”ç”¨ç«¯æ”¶åˆ°è¿™ä¸ªé”™è¯¯åï¼Œä¸é‡æ–°è¿æ¥ï¼Œè€Œæ˜¯ç›´æ¥ç”¨è¿™ä¸ªå·²ç»ä¸èƒ½ç”¨çš„å¥æŸ„é‡è¯•æŸ¥è¯¢ã€‚è¿™ä¼šå¯¼è‡´ä»åº”ç”¨ç«¯çœ‹ä¸Šå»ï¼Œâ€œMySQL ä¸€ç›´æ²¡æ¢å¤â€ã€‚</p><p>ä½ å¯èƒ½è§‰å¾—è¿™æ˜¯ä¸€ä¸ªå†·ç¬‘è¯ï¼Œä½†å®é™…ä¸Šæˆ‘ç¢°åˆ°è¿‡ä¸ä¸‹ 10 æ¬¡ã€‚</p><p>æ‰€ä»¥ï¼Œå¦‚æœä½ æ˜¯ä¸€ä¸ªæ”¯æŒä¸šåŠ¡çš„ DBAï¼Œä¸è¦å‡è®¾æ‰€æœ‰çš„åº”ç”¨ä»£ç éƒ½ä¼šè¢«æ­£ç¡®åœ°å¤„ç†ã€‚å³ä½¿åªæ˜¯ä¸€ä¸ªæ–­å¼€è¿æ¥çš„æ“ä½œï¼Œä¹Ÿè¦ç¡®ä¿é€šçŸ¥åˆ°ä¸šåŠ¡å¼€å‘å›¢é˜Ÿã€‚</p><p><strong>ç¬¬äºŒç§æ–¹æ³•ï¼šå‡å°‘è¿æ¥è¿‡ç¨‹çš„æ¶ˆè€—ã€‚</strong></p><p>æœ‰çš„ä¸šåŠ¡ä»£ç ä¼šåœ¨çŸ­æ—¶é—´å†…å…ˆå¤§é‡ç”³è¯·æ•°æ®åº“è¿æ¥åšå¤‡ç”¨ï¼Œå¦‚æœç°åœ¨æ•°æ®åº“ç¡®è®¤æ˜¯è¢«è¿æ¥è¡Œä¸ºæ‰“æŒ‚äº†ï¼Œé‚£ä¹ˆä¸€ç§å¯èƒ½çš„åšæ³•ï¼Œæ˜¯è®©æ•°æ®åº“è·³è¿‡æƒé™éªŒè¯é˜¶æ®µã€‚</p><p>è·³è¿‡æƒé™éªŒè¯çš„æ–¹æ³•æ˜¯ï¼šé‡å¯æ•°æ®åº“ï¼Œå¹¶ä½¿ç”¨â€“skip-grant-tables å‚æ•°å¯åŠ¨ã€‚è¿™æ ·ï¼Œæ•´ä¸ª MySQL ä¼šè·³è¿‡æ‰€æœ‰çš„æƒé™éªŒè¯é˜¶æ®µï¼ŒåŒ…æ‹¬è¿æ¥è¿‡ç¨‹å’Œè¯­å¥æ‰§è¡Œè¿‡ç¨‹åœ¨å†…ã€‚</p><p>ä½†æ˜¯ï¼Œè¿™ç§æ–¹æ³•ç‰¹åˆ«ç¬¦åˆæˆ‘ä»¬æ ‡é¢˜é‡Œè¯´çš„â€œé¥®é¸©æ­¢æ¸´â€ï¼Œé£é™©æé«˜ï¼Œæ˜¯æˆ‘ç‰¹åˆ«ä¸å»ºè®®ä½¿ç”¨çš„æ–¹æ¡ˆã€‚å°¤å…¶ä½ çš„åº“å¤–ç½‘å¯è®¿é—®çš„è¯ï¼Œå°±æ›´ä¸èƒ½è¿™ä¹ˆåšäº†ã€‚</p><p>åœ¨ MySQL 8.0 ç‰ˆæœ¬é‡Œï¼Œå¦‚æœä½ å¯ç”¨â€“skip-grant-tables å‚æ•°ï¼ŒMySQL ä¼šé»˜è®¤æŠŠ --skip-networking å‚æ•°æ‰“å¼€ï¼Œè¡¨ç¤ºè¿™æ—¶å€™æ•°æ®åº“åªèƒ½è¢«æœ¬åœ°çš„å®¢æˆ·ç«¯è¿æ¥ã€‚å¯è§ï¼ŒMySQL å®˜æ–¹å¯¹ skip-grant-tables è¿™ä¸ªå‚æ•°çš„å®‰å…¨é—®é¢˜ä¹Ÿå¾ˆé‡è§†ã€‚</p><p>é™¤äº†çŸ­è¿æ¥æ•°æš´å¢å¯èƒ½ä¼šå¸¦æ¥æ€§èƒ½é—®é¢˜å¤–ï¼Œå®é™…ä¸Šï¼Œæˆ‘ä»¬åœ¨çº¿ä¸Šç¢°åˆ°æ›´å¤šçš„æ˜¯æŸ¥è¯¢æˆ–è€…æ›´æ–°è¯­å¥å¯¼è‡´çš„æ€§èƒ½é—®é¢˜ã€‚å…¶ä¸­ï¼ŒæŸ¥è¯¢é—®é¢˜æ¯”è¾ƒå…¸å‹çš„æœ‰ä¸¤ç±»ï¼Œä¸€ç±»æ˜¯ç”±æ–°å‡ºç°çš„æ…¢æŸ¥è¯¢å¯¼è‡´çš„ï¼Œä¸€ç±»æ˜¯ç”± QPSï¼ˆæ¯ç§’æŸ¥è¯¢æ•°ï¼‰çªå¢å¯¼è‡´çš„ã€‚è€Œå…³äºæ›´æ–°è¯­å¥å¯¼è‡´çš„æ€§èƒ½é—®é¢˜ï¼Œæˆ‘ä¼šåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« å’Œä½ å±•å¼€è¯´æ˜ã€‚</p><h4 id="æ…¢æŸ¥è¯¢æ€§èƒ½é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#æ…¢æŸ¥è¯¢æ€§èƒ½é—®é¢˜" aria-hidden="true">#</a> æ…¢æŸ¥è¯¢æ€§èƒ½é—®é¢˜</h4><p>åœ¨ MySQL ä¸­ï¼Œä¼šå¼•å‘æ€§èƒ½é—®é¢˜çš„æ…¢æŸ¥è¯¢ï¼Œå¤§ä½“æœ‰ä»¥ä¸‹ä¸‰ç§å¯èƒ½ï¼š</p><ol><li>ç´¢å¼•æ²¡æœ‰è®¾è®¡å¥½ï¼›</li><li>SQL è¯­å¥æ²¡å†™å¥½ï¼›</li><li>MySQL é€‰é”™äº†ç´¢å¼•ã€‚</li></ol><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±å…·ä½“åˆ†æä¸€ä¸‹è¿™ä¸‰ç§å¯èƒ½ï¼Œä»¥åŠå¯¹åº”çš„è§£å†³æ–¹æ¡ˆã€‚</p><p><strong>å¯¼è‡´æ…¢æŸ¥è¯¢çš„ç¬¬ä¸€ç§å¯èƒ½æ˜¯ï¼Œç´¢å¼•æ²¡æœ‰è®¾è®¡å¥½ã€‚</strong></p><p>è¿™ç§åœºæ™¯ä¸€èˆ¬å°±æ˜¯é€šè¿‡ç´§æ€¥åˆ›å»ºç´¢å¼•æ¥è§£å†³ã€‚MySQL 5.6 ç‰ˆæœ¬ä»¥åï¼Œåˆ›å»ºç´¢å¼•éƒ½æ”¯æŒ Online DDL äº†ï¼Œå¯¹äºé‚£ç§é«˜å³°æœŸæ•°æ®åº“å·²ç»è¢«è¿™ä¸ªè¯­å¥æ‰“æŒ‚äº†çš„æƒ…å†µï¼Œæœ€é«˜æ•ˆçš„åšæ³•å°±æ˜¯ç›´æ¥æ‰§è¡Œ alter table è¯­å¥ã€‚</p><p>æ¯”è¾ƒç†æƒ³çš„æ˜¯èƒ½å¤Ÿåœ¨å¤‡åº“å…ˆæ‰§è¡Œã€‚å‡è®¾ä½ ç°åœ¨çš„æœåŠ¡æ˜¯ä¸€ä¸»ä¸€å¤‡ï¼Œä¸»åº“ Aã€å¤‡åº“ Bï¼Œè¿™ä¸ªæ–¹æ¡ˆçš„å¤§è‡´æµç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><ol><li>åœ¨å¤‡åº“ B ä¸Šæ‰§è¡Œ set sql_log_bin=offï¼Œä¹Ÿå°±æ˜¯ä¸å†™ binlogï¼Œç„¶åæ‰§è¡Œ alter table è¯­å¥åŠ ä¸Šç´¢å¼•ï¼›</li><li>æ‰§è¡Œä¸»å¤‡åˆ‡æ¢ï¼›</li><li>è¿™æ—¶å€™ä¸»åº“æ˜¯ Bï¼Œå¤‡åº“æ˜¯ Aã€‚åœ¨ A ä¸Šæ‰§è¡Œ set sql_log_bin=offï¼Œç„¶åæ‰§è¡Œ alter table è¯­å¥åŠ ä¸Šç´¢å¼•ã€‚</li></ol><p>è¿™æ˜¯ä¸€ä¸ªâ€œå¤è€â€çš„ DDL æ–¹æ¡ˆã€‚å¹³æ—¶åœ¨åšå˜æ›´çš„æ—¶å€™ï¼Œä½ åº”è¯¥è€ƒè™‘ç±»ä¼¼ gh-ost è¿™æ ·çš„æ–¹æ¡ˆï¼Œæ›´åŠ ç¨³å¦¥ã€‚ä½†æ˜¯åœ¨éœ€è¦ç´§æ€¥å¤„ç†æ—¶ï¼Œä¸Šé¢è¿™ä¸ªæ–¹æ¡ˆçš„æ•ˆç‡æ˜¯æœ€é«˜çš„ã€‚</p><p><strong>å¯¼è‡´æ…¢æŸ¥è¯¢çš„ç¬¬äºŒç§å¯èƒ½æ˜¯ï¼Œè¯­å¥æ²¡å†™å¥½ã€‚</strong></p><p>æ¯”å¦‚ï¼Œæˆ‘ä»¬çŠ¯äº†åœ¨ç¬¬ 18 ç¯‡æ–‡ç« [ã€Šä¸ºä»€ä¹ˆè¿™äº› SQL è¯­å¥é€»è¾‘ç›¸åŒï¼Œæ€§èƒ½å´å·®å¼‚å·¨å¤§ï¼Ÿã€‹]ä¸­æåˆ°çš„é‚£äº›é”™è¯¯ï¼Œå¯¼è‡´è¯­å¥æ²¡æœ‰ä½¿ç”¨ä¸Šç´¢å¼•ã€‚</p><p>è¿™æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ”¹å†™ SQL è¯­å¥æ¥å¤„ç†ã€‚MySQL 5.7 æä¾›äº† query_rewrite åŠŸèƒ½ï¼Œå¯ä»¥æŠŠè¾“å…¥çš„ä¸€ç§è¯­å¥æ”¹å†™æˆå¦å¤–ä¸€ç§æ¨¡å¼ã€‚</p><p>æ¯”å¦‚ï¼Œè¯­å¥è¢«é”™è¯¯åœ°å†™æˆäº† select * from t where id + 1 = 10000ï¼Œä½ å¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹å¼ï¼Œå¢åŠ ä¸€ä¸ªè¯­å¥æ”¹å†™è§„åˆ™ã€‚</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">insert</span> <span class="token keyword">into</span> query_rewrite<span class="token punctuation">.</span>rewrite_rules<span class="token punctuation">(</span>pattern<span class="token punctuation">,</span> replacement<span class="token punctuation">,</span> pattern_database<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token string">&quot;select * from t where id + 1 = ?&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;select * from t where id = ? - 1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;db1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">call</span> query_rewrite<span class="token punctuation">.</span>flush_rewrite_rules<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œï¼Œcall query_rewrite.flush_rewrite_rules() è¿™ä¸ªå­˜å‚¨è¿‡ç¨‹ï¼Œæ˜¯è®©æ’å…¥çš„æ–°è§„åˆ™ç”Ÿæ•ˆï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬è¯´çš„â€œæŸ¥è¯¢é‡å†™â€ã€‚ä½ å¯ä»¥ç”¨å›¾ 4 ä¸­çš„æ–¹æ³•æ¥ç¡®è®¤æ”¹å†™è§„åˆ™æ˜¯å¦ç”Ÿæ•ˆã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/47a1002cbc4c05c74841591d20f7388a-1584367394663.png" alt="img"></p><p>å›¾ 4 æŸ¥è¯¢é‡å†™æ•ˆæœ</p><p><strong>å¯¼è‡´æ…¢æŸ¥è¯¢çš„ç¬¬ä¸‰ç§å¯èƒ½ï¼Œå°±æ˜¯ç¢°ä¸Šäº†æˆ‘ä»¬åœ¨ç¬¬ 10 ç¯‡æ–‡ç« </strong>[ã€ŠMySQL ä¸ºä»€ä¹ˆæœ‰æ—¶å€™ä¼šé€‰é”™ç´¢å¼•ï¼Ÿã€‹]<strong>ä¸­æåˆ°çš„æƒ…å†µï¼ŒMySQL é€‰é”™äº†ç´¢å¼•ã€‚</strong></p><p>è¿™æ—¶å€™ï¼Œåº”æ€¥æ–¹æ¡ˆå°±æ˜¯ç»™è¿™ä¸ªè¯­å¥åŠ ä¸Š force indexã€‚</p><p>åŒæ ·åœ°ï¼Œä½¿ç”¨æŸ¥è¯¢é‡å†™åŠŸèƒ½ï¼Œç»™åŸæ¥çš„è¯­å¥åŠ ä¸Š force indexï¼Œä¹Ÿå¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><p>ä¸Šé¢æˆ‘å’Œä½ è®¨è®ºçš„ç”±æ…¢æŸ¥è¯¢å¯¼è‡´æ€§èƒ½é—®é¢˜çš„ä¸‰ç§å¯èƒ½æƒ…å†µï¼Œå®é™…ä¸Šå‡ºç°æœ€å¤šçš„æ˜¯å‰ä¸¤ç§ï¼Œå³ï¼šç´¢å¼•æ²¡è®¾è®¡å¥½å’Œè¯­å¥æ²¡å†™å¥½ã€‚è€Œè¿™ä¸¤ç§æƒ…å†µï¼Œæ°æ°æ˜¯å®Œå…¨å¯ä»¥é¿å…çš„ã€‚æ¯”å¦‚ï¼Œé€šè¿‡ä¸‹é¢è¿™ä¸ªè¿‡ç¨‹ï¼Œæˆ‘ä»¬å°±å¯ä»¥é¢„å…ˆå‘ç°é—®é¢˜ã€‚</p><ol><li>ä¸Šçº¿å‰ï¼Œåœ¨æµ‹è¯•ç¯å¢ƒï¼ŒæŠŠæ…¢æŸ¥è¯¢æ—¥å¿—ï¼ˆslow logï¼‰æ‰“å¼€ï¼Œå¹¶ä¸”æŠŠ long_query_time è®¾ç½®æˆ 0ï¼Œç¡®ä¿æ¯ä¸ªè¯­å¥éƒ½ä¼šè¢«è®°å½•å…¥æ…¢æŸ¥è¯¢æ—¥å¿—ï¼›</li><li>åœ¨æµ‹è¯•è¡¨é‡Œæ’å…¥æ¨¡æ‹Ÿçº¿ä¸Šçš„æ•°æ®ï¼Œåšä¸€éå›å½’æµ‹è¯•ï¼›</li><li>è§‚å¯Ÿæ…¢æŸ¥è¯¢æ—¥å¿—é‡Œæ¯ç±»è¯­å¥çš„è¾“å‡ºï¼Œç‰¹åˆ«ç•™æ„ Rows_examined å­—æ®µæ˜¯å¦ä¸é¢„æœŸä¸€è‡´ã€‚ï¼ˆæˆ‘ä»¬åœ¨å‰é¢æ–‡ç« ä¸­å·²ç»å¤šæ¬¡ç”¨åˆ°è¿‡ Rows_examined æ–¹æ³•äº†ï¼Œç›¸ä¿¡ä½ å·²ç»åŠ¨æ‰‹å°è¯•è¿‡äº†ã€‚å¦‚æœè¿˜æœ‰ä¸æ˜ç™½çš„ï¼Œæ¬¢è¿ç»™æˆ‘ç•™è¨€ï¼Œæˆ‘ä»¬ä¸€èµ·è®¨è®ºï¼‰ã€‚</li></ol><p>ä¸è¦åå•¬è¿™æ®µèŠ±åœ¨ä¸Šçº¿å‰çš„â€œé¢å¤–â€æ—¶é—´ï¼Œå› ä¸ºè¿™ä¼šå¸®ä½ çœä¸‹å¾ˆå¤šæ•…éšœå¤ç›˜çš„æ—¶é—´ã€‚</p><p>å¦‚æœæ–°å¢çš„ SQL è¯­å¥ä¸å¤šï¼Œæ‰‹åŠ¨è·‘ä¸€ä¸‹å°±å¯ä»¥ã€‚è€Œå¦‚æœæ˜¯æ–°é¡¹ç›®çš„è¯ï¼Œæˆ–è€…æ˜¯ä¿®æ”¹äº†åŸæœ‰é¡¹ç›®çš„ è¡¨ç»“æ„è®¾è®¡ï¼Œå…¨é‡å›å½’æµ‹è¯•éƒ½æ˜¯å¿…è¦çš„ã€‚è¿™æ—¶å€™ï¼Œä½ éœ€è¦å·¥å…·å¸®ä½ æ£€æŸ¥æ‰€æœ‰çš„ SQL è¯­å¥çš„è¿”å›ç»“æœã€‚æ¯”å¦‚ï¼Œä½ å¯ä»¥ä½¿ç”¨å¼€æºå·¥å…· pt-query-digest(https://www.percona.com/doc/percona-toolkit/3.0/pt-query-digest.html)ã€‚</p><h4 id="qps-çªå¢é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#qps-çªå¢é—®é¢˜" aria-hidden="true">#</a> QPS çªå¢é—®é¢˜</h4><p>æœ‰æ—¶å€™ç”±äºä¸šåŠ¡çªç„¶å‡ºç°é«˜å³°ï¼Œæˆ–è€…åº”ç”¨ç¨‹åº bugï¼Œå¯¼è‡´æŸä¸ªè¯­å¥çš„ QPS çªç„¶æš´æ¶¨ï¼Œä¹Ÿå¯èƒ½å¯¼è‡´ MySQL å‹åŠ›è¿‡å¤§ï¼Œå½±å“æœåŠ¡ã€‚</p><p>æˆ‘ä¹‹å‰ç¢°åˆ°è¿‡ä¸€ç±»æƒ…å†µï¼Œæ˜¯ç”±ä¸€ä¸ªæ–°åŠŸèƒ½çš„ bug å¯¼è‡´çš„ã€‚å½“ç„¶ï¼Œæœ€ç†æƒ³çš„æƒ…å†µæ˜¯è®©ä¸šåŠ¡æŠŠè¿™ä¸ªåŠŸèƒ½ä¸‹æ‰ï¼ŒæœåŠ¡è‡ªç„¶å°±ä¼šæ¢å¤ã€‚</p><p>è€Œä¸‹æ‰ä¸€ä¸ªåŠŸèƒ½ï¼Œå¦‚æœä»æ•°æ®åº“ç«¯å¤„ç†çš„è¯ï¼Œå¯¹åº”äºä¸åŒçš„èƒŒæ™¯ï¼Œæœ‰ä¸åŒçš„æ–¹æ³•å¯ç”¨ã€‚æˆ‘è¿™é‡Œå†å’Œä½ å±•å¼€è¯´æ˜ä¸€ä¸‹ã€‚</p><ol><li>ä¸€ç§æ˜¯ç”±å…¨æ–°ä¸šåŠ¡çš„ bug å¯¼è‡´çš„ã€‚å‡è®¾ä½ çš„ DB è¿ç»´æ˜¯æ¯”è¾ƒè§„èŒƒçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ç™½åå•æ˜¯ä¸€ä¸ªä¸ªåŠ çš„ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœä½ èƒ½å¤Ÿç¡®å®šä¸šåŠ¡æ–¹ä¼šä¸‹æ‰è¿™ä¸ªåŠŸèƒ½ï¼Œåªæ˜¯æ—¶é—´ä¸Šæ²¡é‚£ä¹ˆå¿«ï¼Œé‚£ä¹ˆå°±å¯ä»¥ä»æ•°æ®åº“ç«¯ç›´æ¥æŠŠç™½åå•å»æ‰ã€‚</li><li>å¦‚æœè¿™ä¸ªæ–°åŠŸèƒ½ä½¿ç”¨çš„æ˜¯å•ç‹¬çš„æ•°æ®åº“ç”¨æˆ·ï¼Œå¯ä»¥ç”¨ç®¡ç†å‘˜è´¦å·æŠŠè¿™ä¸ªç”¨æˆ·åˆ æ‰ï¼Œç„¶åæ–­å¼€ç°æœ‰è¿æ¥ã€‚è¿™æ ·ï¼Œè¿™ä¸ªæ–°åŠŸèƒ½çš„è¿æ¥ä¸æˆåŠŸï¼Œç”±å®ƒå¼•å‘çš„ QPS å°±ä¼šå˜æˆ 0ã€‚</li><li>å¦‚æœè¿™ä¸ªæ–°å¢çš„åŠŸèƒ½è·Ÿä¸»ä½“åŠŸèƒ½æ˜¯éƒ¨ç½²åœ¨ä¸€èµ·çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬åªèƒ½é€šè¿‡å¤„ç†è¯­å¥æ¥é™åˆ¶ã€‚è¿™æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸Šé¢æåˆ°çš„æŸ¥è¯¢é‡å†™åŠŸèƒ½ï¼ŒæŠŠå‹åŠ›æœ€å¤§çš„ SQL è¯­å¥ç›´æ¥é‡å†™æˆ&quot;select 1&quot;è¿”å›ã€‚</li></ol><p>å½“ç„¶ï¼Œè¿™ä¸ªæ“ä½œçš„é£é™©å¾ˆé«˜ï¼Œéœ€è¦ä½ ç‰¹åˆ«ç»†è‡´ã€‚å®ƒå¯èƒ½å­˜åœ¨ä¸¤ä¸ªå‰¯ä½œç”¨ï¼š</p><ol><li>å¦‚æœåˆ«çš„åŠŸèƒ½é‡Œé¢ä¹Ÿç”¨åˆ°äº†è¿™ä¸ª SQL è¯­å¥æ¨¡æ¿ï¼Œä¼šæœ‰è¯¯ä¼¤ï¼›</li><li>å¾ˆå¤šä¸šåŠ¡å¹¶ä¸æ˜¯é è¿™ä¸€ä¸ªè¯­å¥å°±èƒ½å®Œæˆé€»è¾‘çš„ï¼Œæ‰€ä»¥å¦‚æœå•ç‹¬æŠŠè¿™ä¸€ä¸ªè¯­å¥ä»¥ select 1 çš„ç»“æœè¿”å›çš„è¯ï¼Œå¯èƒ½ä¼šå¯¼è‡´åé¢çš„ä¸šåŠ¡é€»è¾‘ä¸€èµ·å¤±è´¥ã€‚</li></ol><p>æ‰€ä»¥ï¼Œæ–¹æ¡ˆ 3 æ˜¯ç”¨äºæ­¢è¡€çš„ï¼Œè·Ÿå‰é¢æåˆ°çš„å»æ‰æƒé™éªŒè¯ä¸€æ ·ï¼Œåº”è¯¥æ˜¯ä½ æ‰€æœ‰é€‰é¡¹é‡Œä¼˜å…ˆçº§æœ€ä½çš„ä¸€ä¸ªæ–¹æ¡ˆã€‚</p><p>åŒæ—¶ä½ ä¼šå‘ç°ï¼Œå…¶å®æ–¹æ¡ˆ 1 å’Œ 2 éƒ½è¦ä¾èµ–äºè§„èŒƒçš„è¿ç»´ä½“ç³»ï¼šè™šæ‹ŸåŒ–ã€ç™½åå•æœºåˆ¶ã€ä¸šåŠ¡è´¦å·åˆ†ç¦»ã€‚ç”±æ­¤å¯è§ï¼Œæ›´å¤šçš„å‡†å¤‡ï¼Œå¾€å¾€æ„å‘³ç€æ›´ç¨³å®šçš„ç³»ç»Ÿã€‚</p><h4 id="å°ç»“-13" tabindex="-1"><a class="header-anchor" href="#å°ç»“-13" aria-hidden="true">#</a> å°ç»“</h4><p>ä»Šå¤©è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¥ä¸šåŠ¡é«˜å³°æœŸçš„æ€§èƒ½é—®é¢˜ä¸ºèƒŒæ™¯ï¼Œå’Œä½ ä»‹ç»äº†ä¸€äº›ç´§æ€¥å¤„ç†çš„æ‰‹æ®µã€‚</p><p>è¿™äº›å¤„ç†æ‰‹æ®µä¸­ï¼Œæ—¢åŒ…æ‹¬äº†ç²—æš´åœ°æ‹’ç»è¿æ¥å’Œæ–­å¼€è¿æ¥ï¼Œä¹Ÿæœ‰é€šè¿‡é‡å†™è¯­å¥æ¥ç»•è¿‡ä¸€äº›å‘çš„æ–¹æ³•ï¼›æ—¢æœ‰ä¸´æ—¶çš„é«˜å±æ–¹æ¡ˆï¼Œä¹Ÿæœ‰æœªé›¨ç»¸ç¼ªçš„ã€ç›¸å¯¹å®‰å…¨çš„é¢„æ¡ˆã€‚</p><p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿè¦å°½é‡é¿å…ä¸€äº›ä½æ•ˆçš„æ–¹æ³•ï¼Œæ¯”å¦‚é¿å…å¤§é‡åœ°ä½¿ç”¨çŸ­è¿æ¥ã€‚åŒæ—¶ï¼Œå¦‚æœä½ åšä¸šåŠ¡å¼€å‘çš„è¯ï¼Œè¦çŸ¥é“ï¼Œè¿æ¥å¼‚å¸¸æ–­å¼€æ˜¯å¸¸æœ‰çš„äº‹ï¼Œä½ çš„ä»£ç é‡Œè¦æœ‰æ­£ç¡®åœ°é‡è¿å¹¶é‡è¯•çš„æœºåˆ¶ã€‚</p><p>DBA è™½ç„¶å¯ä»¥é€šè¿‡è¯­å¥é‡å†™æ¥æš‚æ—¶å¤„ç†é—®é¢˜ï¼Œä½†æ˜¯è¿™æœ¬èº«æ˜¯ä¸€ä¸ªé£é™©é«˜çš„æ“ä½œï¼Œåšå¥½ SQL å®¡è®¡å¯ä»¥å‡å°‘éœ€è¦è¿™ç±»æ“ä½œçš„æœºä¼šã€‚</p><p>å…¶å®ï¼Œä½ å¯ä»¥çœ‹å¾—å‡ºæ¥ï¼Œåœ¨è¿™ç¯‡æ–‡ç« ä¸­æˆ‘æåˆ°çš„è§£å†³æ–¹æ³•ä¸»è¦é›†ä¸­åœ¨ server å±‚ã€‚åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä¼šç»§ç»­å’Œä½ è®¨è®ºä¸€äº›è·Ÿ InnoDB æœ‰å…³çš„å¤„ç†æ–¹æ³•ã€‚</p><p>æœ€åï¼Œåˆåˆ°äº†æˆ‘ä»¬çš„æ€è€ƒé¢˜æ—¶é—´äº†ã€‚</p><p>ä»Šå¤©ï¼Œæˆ‘ç•™ç»™ä½ çš„è¯¾åé—®é¢˜æ˜¯ï¼Œä½ æ˜¯å¦ç¢°åˆ°è¿‡ï¼Œåœ¨ä¸šåŠ¡é«˜å³°æœŸéœ€è¦ä¸´æ—¶æ•‘ç«çš„åœºæ™¯ï¼Ÿä½ åˆæ˜¯æ€ä¹ˆå¤„ç†çš„å‘¢ï¼Ÿ</p><p>ä½ å¯ä»¥æŠŠä½ çš„ç»å†å’Œç»éªŒå†™åœ¨ç•™è¨€åŒºï¼Œæˆ‘ä¼šåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« çš„æœ«å°¾é€‰å–æœ‰è¶£çš„è¯„è®ºè·Ÿå¤§å®¶ä¸€èµ·åˆ†äº«å’Œåˆ†æã€‚æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚</p><h4 id="ä¸ŠæœŸé—®é¢˜æ—¶é—´-10" tabindex="-1"><a class="header-anchor" href="#ä¸ŠæœŸé—®é¢˜æ—¶é—´-10" aria-hidden="true">#</a> ä¸ŠæœŸé—®é¢˜æ—¶é—´</h4><p>å‰ä¸¤æœŸæˆ‘ç»™ä½ ç•™çš„é—®é¢˜æ˜¯ï¼Œä¸‹é¢è¿™ä¸ªå›¾çš„æ‰§è¡Œåºåˆ—ä¸­ï¼Œä¸ºä»€ä¹ˆ session B çš„ insert è¯­å¥ä¼šè¢«å µä½ã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/3a7578e104612a188a2d574eaa3bd81e-1550569913824-1584367394667.png" alt="img">æˆ‘ä»¬ç”¨ä¸Šä¸€ç¯‡çš„åŠ é”è§„åˆ™æ¥åˆ†æä¸€ä¸‹ï¼Œçœ‹çœ‹ session A çš„ select è¯­å¥åŠ äº†å“ªäº›é”ï¼š</p><ol><li>ç”±äºæ˜¯ order by c descï¼Œç¬¬ä¸€ä¸ªè¦å®šä½çš„æ˜¯ç´¢å¼• c ä¸Šâ€œæœ€å³è¾¹çš„â€c=20 çš„è¡Œï¼Œæ‰€ä»¥ä¼šåŠ ä¸Šé—´éš™é” (20,25) å’Œ next-key lock (15,20]ã€‚</li><li>åœ¨ç´¢å¼• c ä¸Šå‘å·¦éå†ï¼Œè¦æ‰«æåˆ° c=10 æ‰åœä¸‹æ¥ï¼Œæ‰€ä»¥ next-key lock ä¼šåŠ åˆ° (5,10]ï¼Œè¿™æ­£æ˜¯é˜»å¡ session B çš„ insert è¯­å¥çš„åŸå› ã€‚</li><li>åœ¨æ‰«æè¿‡ç¨‹ä¸­ï¼Œc=20ã€c=15ã€c=10 è¿™ä¸‰è¡Œéƒ½å­˜åœ¨å€¼ï¼Œç”±äºæ˜¯ select *ï¼Œæ‰€ä»¥ä¼šåœ¨ä¸»é”® id ä¸ŠåŠ ä¸‰ä¸ªè¡Œé”ã€‚</li></ol><p>å› æ­¤ï¼Œsession A çš„ select è¯­å¥é”çš„èŒƒå›´å°±æ˜¯ï¼š</p><ol><li>ç´¢å¼• c ä¸Š (5, 25)ï¼›</li><li>ä¸»é”®ç´¢å¼•ä¸Š id=15ã€20 ä¸¤ä¸ªè¡Œé”ã€‚</li></ol><p>è¿™é‡Œï¼Œæˆ‘å†å•°å—¦ä¸‹ï¼Œä½ ä¼šå‘ç°æˆ‘åœ¨æ–‡ç« ä¸­ï¼Œæ¯æ¬¡åŠ é”éƒ½ä¼šè¯´æ˜æ˜¯åŠ åœ¨â€œå“ªä¸ªç´¢å¼•ä¸Šâ€çš„ã€‚å› ä¸ºï¼Œé”å°±æ˜¯åŠ åœ¨ç´¢å¼•ä¸Šçš„ï¼Œè¿™æ˜¯ InnoDB çš„ä¸€ä¸ªåŸºç¡€è®¾å®šï¼Œéœ€è¦ä½ åœ¨åˆ†æé—®é¢˜çš„æ—¶å€™è¦ä¸€ç›´è®°å¾—ã€‚</p><p>è¯„è®ºåŒºç•™è¨€ç‚¹èµæ¿ï¼š</p><blockquote><p>@HuaMax ç»™å‡ºäº†æ­£ç¡®çš„è§£é‡Šã€‚</p></blockquote><blockquote><p>@Justin åŒå­¦æäº†ä¸ªå¥½é—®é¢˜ï¼Œ&lt;= åˆ°åº•æ˜¯é—´éš™é”è¿˜æ˜¯è¡Œé”ï¼Ÿå…¶å®ï¼Œè¿™ä¸ªé—®é¢˜ï¼Œä½ è¦è·Ÿâ€œæ‰§è¡Œè¿‡ç¨‹â€é…åˆèµ·æ¥åˆ†æã€‚åœ¨ InnoDB è¦å»æ‰¾â€œç¬¬ä¸€ä¸ªå€¼â€çš„æ—¶å€™ï¼Œæ˜¯æŒ‰ç…§ç­‰å€¼å»æ‰¾çš„ï¼Œç”¨çš„æ˜¯ç­‰å€¼åˆ¤æ–­çš„è§„åˆ™ï¼›æ‰¾åˆ°ç¬¬ä¸€ä¸ªå€¼ä»¥åï¼Œè¦åœ¨ç´¢å¼•å†…æ‰¾â€œä¸‹ä¸€ä¸ªå€¼â€ï¼Œå¯¹åº”äºæˆ‘ä»¬è§„åˆ™ä¸­è¯´çš„èŒƒå›´æŸ¥æ‰¾ã€‚</p></blockquote><blockquote><p>@ä¿¡ä¿¡ æäº†ä¸€ä¸ªä¸é”™çš„é—®é¢˜ï¼Œè¦çŸ¥é“æœ€ç»ˆçš„åŠ é”æ˜¯æ ¹æ®å®é™…æ‰§è¡Œæƒ…å†µæ¥çš„ã€‚æ‰€ä»¥ï¼Œå¦‚æœä¸€ä¸ª select * from â€¦ for update è¯­å¥ï¼Œä¼˜åŒ–å™¨å†³å®šä½¿ç”¨å…¨è¡¨æ‰«æï¼Œé‚£ä¹ˆå°±ä¼šæŠŠä¸»é”®ç´¢å¼•ä¸Š next-key lock å…¨åŠ ä¸Šã€‚</p></blockquote><blockquote><p>@nero åŒå­¦çš„é—®é¢˜ï¼Œæç¤ºæˆ‘éœ€è¦æé†’å¤§å®¶æ³¨æ„ï¼Œâ€œæœ‰è¡Œâ€æ‰ä¼šåŠ è¡Œé”ã€‚å¦‚æœæŸ¥è¯¢æ¡ä»¶æ²¡æœ‰å‘½ä¸­è¡Œï¼Œé‚£å°±åŠ  next-key lockã€‚å½“ç„¶ï¼Œç­‰å€¼åˆ¤æ–­çš„æ—¶å€™ï¼Œéœ€è¦åŠ ä¸Šä¼˜åŒ– 2ï¼ˆå³ï¼šç´¢å¼•ä¸Šçš„ç­‰å€¼æŸ¥è¯¢ï¼Œå‘å³éå†æ—¶ä¸”æœ€åä¸€ä¸ªå€¼ä¸æ»¡è¶³ç­‰å€¼æ¡ä»¶çš„æ—¶å€™ï¼Œnext-key lock é€€åŒ–ä¸ºé—´éš™é”ã€‚ï¼‰ã€‚</p></blockquote><blockquote><p>@å°æå­ã€@å‘æ¡æ©™å­åŒå­¦ï¼Œéƒ½æäº†å¾ˆå¥½çš„é—®é¢˜ï¼Œè¿™æœŸé«˜è´¨é‡è¯„è®ºå¾ˆå¤šï¼Œä½ ä¹Ÿéƒ½å¯ä»¥å»çœ‹çœ‹ã€‚</p></blockquote><p>æœ€åï¼Œæˆ‘è¦ä¸ºå…ƒæ—¦æœŸé—´è¿˜åšæŒå­¦ä¹ çš„åŒå­¦ä»¬ï¼Œç‚¹ä¸ªèµ ^_^</p><h3 id="_23-mysqlæ˜¯æ€ä¹ˆä¿è¯æ•°æ®ä¸ä¸¢çš„" tabindex="-1"><a class="header-anchor" href="#_23-mysqlæ˜¯æ€ä¹ˆä¿è¯æ•°æ®ä¸ä¸¢çš„" aria-hidden="true">#</a> 23 MySQLæ˜¯æ€ä¹ˆä¿è¯æ•°æ®ä¸ä¸¢çš„ï¼Ÿ</h3><p>ä»Šå¤©è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ä¼šç»§ç»­å’Œä½ ä»‹ç»åœ¨ä¸šåŠ¡é«˜å³°æœŸä¸´æ—¶æå‡æ€§èƒ½çš„æ–¹æ³•ã€‚ä»æ–‡ç« æ ‡é¢˜â€œMySQL æ˜¯æ€ä¹ˆä¿è¯æ•°æ®ä¸ä¸¢çš„ï¼Ÿâ€ï¼Œä½ å°±å¯ä»¥çœ‹å‡ºæ¥ï¼Œä»Šå¤©æˆ‘å’Œä½ ä»‹ç»çš„æ–¹æ³•ï¼Œè·Ÿæ•°æ®çš„å¯é æ€§æœ‰å…³ã€‚</p><p>åœ¨ä¸“æ å‰é¢æ–‡ç« å’Œç­”ç–‘ç¯‡ä¸­ï¼Œæˆ‘éƒ½ç€é‡ä»‹ç»äº† WAL æœºåˆ¶ï¼ˆä½ å¯ä»¥å†å›é¡¾ä¸‹[ç¬¬ 2 ç¯‡]ã€[ç¬¬ 9 ç¯‡]ã€[ç¬¬ 12 ç¯‡]å’Œ[ç¬¬ 15 ç¯‡]æ–‡ç« ä¸­çš„ç›¸å…³å†…å®¹ï¼‰ï¼Œå¾—åˆ°çš„ç»“è®ºæ˜¯ï¼šåªè¦ redo log å’Œ binlog ä¿è¯æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œå°±èƒ½ç¡®ä¿ MySQL å¼‚å¸¸é‡å¯åï¼Œæ•°æ®å¯ä»¥æ¢å¤ã€‚</p><p>è¯„è®ºåŒºæœ‰åŒå­¦åˆç»§ç»­è¿½é—®ï¼Œredo log çš„å†™å…¥æµç¨‹æ˜¯æ€ä¹ˆæ ·çš„ï¼Œå¦‚ä½•ä¿è¯ redo log çœŸå®åœ°å†™å…¥äº†ç£ç›˜ã€‚é‚£ä¹ˆä»Šå¤©ï¼Œæˆ‘ä»¬å°±å†ä¸€èµ·çœ‹çœ‹ MySQL å†™å…¥ binlog å’Œ redo log çš„æµç¨‹ã€‚</p><h4 id="binlog-çš„å†™å…¥æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#binlog-çš„å†™å…¥æœºåˆ¶" aria-hidden="true">#</a> binlog çš„å†™å…¥æœºåˆ¶</h4><p>å…¶å®ï¼Œbinlog çš„å†™å…¥é€»è¾‘æ¯”è¾ƒç®€å•ï¼šäº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå…ˆæŠŠæ—¥å¿—å†™åˆ° binlog cacheï¼Œäº‹åŠ¡æäº¤çš„æ—¶å€™ï¼Œå†æŠŠ binlog cache å†™åˆ° binlog æ–‡ä»¶ä¸­ã€‚</p><p>ä¸€ä¸ªäº‹åŠ¡çš„ binlog æ˜¯ä¸èƒ½è¢«æ‹†å¼€çš„ï¼Œå› æ­¤ä¸è®ºè¿™ä¸ªäº‹åŠ¡å¤šå¤§ï¼Œä¹Ÿè¦ç¡®ä¿ä¸€æ¬¡æ€§å†™å…¥ã€‚è¿™å°±æ¶‰åŠåˆ°äº† binlog cache çš„ä¿å­˜é—®é¢˜ã€‚</p><p>ç³»ç»Ÿç»™ binlog cache åˆ†é…äº†ä¸€ç‰‡å†…å­˜ï¼Œæ¯ä¸ªçº¿ç¨‹ä¸€ä¸ªï¼Œå‚æ•° binlog_cache_size ç”¨äºæ§åˆ¶å•ä¸ªçº¿ç¨‹å†… binlog cache æ‰€å å†…å­˜çš„å¤§å°ã€‚å¦‚æœè¶…è¿‡äº†è¿™ä¸ªå‚æ•°è§„å®šçš„å¤§å°ï¼Œå°±è¦æš‚å­˜åˆ°ç£ç›˜ã€‚</p><p>äº‹åŠ¡æäº¤çš„æ—¶å€™ï¼Œæ‰§è¡Œå™¨æŠŠ binlog cache é‡Œçš„å®Œæ•´äº‹åŠ¡å†™å…¥åˆ° binlog ä¸­ï¼Œå¹¶æ¸…ç©º binlog cacheã€‚çŠ¶æ€å¦‚å›¾ 1 æ‰€ç¤ºã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/9ed86644d5f39efb0efec595abb92e3e-1584367394669.png" alt="img"></p><p>å›¾ 1 binlog å†™ç›˜çŠ¶æ€</p><p>å¯ä»¥çœ‹åˆ°ï¼Œæ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·± binlog cacheï¼Œä½†æ˜¯å…±ç”¨åŒä¸€ä»½ binlog æ–‡ä»¶ã€‚</p><ul><li>å›¾ä¸­çš„ writeï¼ŒæŒ‡çš„å°±æ˜¯æŒ‡æŠŠæ—¥å¿—å†™å…¥åˆ°æ–‡ä»¶ç³»ç»Ÿçš„ page cacheï¼Œå¹¶æ²¡æœ‰æŠŠæ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œæ‰€ä»¥é€Ÿåº¦æ¯”è¾ƒå¿«ã€‚</li><li>å›¾ä¸­çš„ fsyncï¼Œæ‰æ˜¯å°†æ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜çš„æ“ä½œã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è®¤ä¸º fsync æ‰å ç£ç›˜çš„ IOPSã€‚</li></ul><p>write å’Œ fsync çš„æ—¶æœºï¼Œæ˜¯ç”±å‚æ•° sync_binlog æ§åˆ¶çš„ï¼š</p><ol><li>sync_binlog=0 çš„æ—¶å€™ï¼Œè¡¨ç¤ºæ¯æ¬¡æäº¤äº‹åŠ¡éƒ½åª writeï¼Œä¸ fsyncï¼›</li><li>sync_binlog=1 çš„æ—¶å€™ï¼Œè¡¨ç¤ºæ¯æ¬¡æäº¤äº‹åŠ¡éƒ½ä¼šæ‰§è¡Œ fsyncï¼›</li><li>sync_binlog=N(N&gt;1) çš„æ—¶å€™ï¼Œè¡¨ç¤ºæ¯æ¬¡æäº¤äº‹åŠ¡éƒ½ writeï¼Œä½†ç´¯ç§¯ N ä¸ªäº‹åŠ¡åæ‰ fsyncã€‚</li></ol><p>å› æ­¤ï¼Œåœ¨å‡ºç° IO ç“¶é¢ˆçš„åœºæ™¯é‡Œï¼Œå°† sync_binlog è®¾ç½®æˆä¸€ä¸ªæ¯”è¾ƒå¤§çš„å€¼ï¼Œå¯ä»¥æå‡æ€§èƒ½ã€‚åœ¨å®é™…çš„ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œè€ƒè™‘åˆ°ä¸¢å¤±æ—¥å¿—é‡çš„å¯æ§æ€§ï¼Œä¸€èˆ¬ä¸å»ºè®®å°†è¿™ä¸ªå‚æ•°è®¾æˆ 0ï¼Œæ¯”è¾ƒå¸¸è§çš„æ˜¯å°†å…¶è®¾ç½®ä¸º 100~1000 ä¸­çš„æŸä¸ªæ•°å€¼ã€‚</p><p>ä½†æ˜¯ï¼Œå°† sync_binlog è®¾ç½®ä¸º Nï¼Œå¯¹åº”çš„é£é™©æ˜¯ï¼šå¦‚æœä¸»æœºå‘ç”Ÿå¼‚å¸¸é‡å¯ï¼Œä¼šä¸¢å¤±æœ€è¿‘ N ä¸ªäº‹åŠ¡çš„ binlog æ—¥å¿—ã€‚</p><h4 id="redo-log-çš„å†™å…¥æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#redo-log-çš„å†™å…¥æœºåˆ¶" aria-hidden="true">#</a> redo log çš„å†™å…¥æœºåˆ¶</h4><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†è¯´è¯´ redo log çš„å†™å…¥æœºåˆ¶ã€‚</p><p>åœ¨ä¸“æ çš„[ç¬¬ 15 ç¯‡ç­”ç–‘æ–‡ç« ]ä¸­ï¼Œæˆ‘ç»™ä½ ä»‹ç»äº† redo log bufferã€‚äº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œç”Ÿæˆçš„ redo log æ˜¯è¦å…ˆå†™åˆ° redo log buffer çš„ã€‚</p><p>ç„¶åå°±æœ‰åŒå­¦é—®äº†ï¼Œredo log buffer é‡Œé¢çš„å†…å®¹ï¼Œæ˜¯ä¸æ˜¯æ¯æ¬¡ç”Ÿæˆåéƒ½è¦ç›´æ¥æŒä¹…åŒ–åˆ°ç£ç›˜å‘¢ï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯ï¼Œä¸éœ€è¦ã€‚</p><p>å¦‚æœäº‹åŠ¡æ‰§è¡ŒæœŸé—´ MySQL å‘ç”Ÿå¼‚å¸¸é‡å¯ï¼Œé‚£è¿™éƒ¨åˆ†æ—¥å¿—å°±ä¸¢äº†ã€‚ç”±äºäº‹åŠ¡å¹¶æ²¡æœ‰æäº¤ï¼Œæ‰€ä»¥è¿™æ—¶æ—¥å¿—ä¸¢äº†ä¹Ÿä¸ä¼šæœ‰æŸå¤±ã€‚</p><p>é‚£ä¹ˆï¼Œå¦å¤–ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œäº‹åŠ¡è¿˜æ²¡æäº¤çš„æ—¶å€™ï¼Œredo log buffer ä¸­çš„éƒ¨åˆ†æ—¥å¿—æœ‰æ²¡æœ‰å¯èƒ½è¢«æŒä¹…åŒ–åˆ°ç£ç›˜å‘¢ï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯ï¼Œç¡®å®ä¼šæœ‰ã€‚</p><p>è¿™ä¸ªé—®é¢˜ï¼Œè¦ä» redo log å¯èƒ½å­˜åœ¨çš„ä¸‰ç§çŠ¶æ€è¯´èµ·ã€‚è¿™ä¸‰ç§çŠ¶æ€ï¼Œå¯¹åº”çš„å°±æ˜¯å›¾ 2 ä¸­çš„ä¸‰ä¸ªé¢œè‰²å—ã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/9d057f61d3962407f413deebc80526d4-1584367394787.png" alt="img"></p><p>å›¾ 2 MySQL redo log å­˜å‚¨çŠ¶æ€</p><p>è¿™ä¸‰ç§çŠ¶æ€åˆ†åˆ«æ˜¯ï¼š</p><ol><li>å­˜åœ¨ redo log buffer ä¸­ï¼Œç‰©ç†ä¸Šæ˜¯åœ¨ MySQL è¿›ç¨‹å†…å­˜ä¸­ï¼Œå°±æ˜¯å›¾ä¸­çš„çº¢è‰²éƒ¨åˆ†ï¼›</li><li>å†™åˆ°ç£ç›˜ (write)ï¼Œä½†æ˜¯æ²¡æœ‰æŒä¹…åŒ–ï¼ˆfsync)ï¼Œç‰©ç†ä¸Šæ˜¯åœ¨æ–‡ä»¶ç³»ç»Ÿçš„ page cache é‡Œé¢ï¼Œä¹Ÿå°±æ˜¯å›¾ä¸­çš„é»„è‰²éƒ¨åˆ†ï¼›</li><li>æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œå¯¹åº”çš„æ˜¯ hard diskï¼Œä¹Ÿå°±æ˜¯å›¾ä¸­çš„ç»¿è‰²éƒ¨åˆ†ã€‚</li></ol><p>æ—¥å¿—å†™åˆ° redo log buffer æ˜¯å¾ˆå¿«çš„ï¼Œwirte åˆ° page cache ä¹Ÿå·®ä¸å¤šï¼Œä½†æ˜¯æŒä¹…åŒ–åˆ°ç£ç›˜çš„é€Ÿåº¦å°±æ…¢å¤šäº†ã€‚</p><p>ä¸ºäº†æ§åˆ¶ redo log çš„å†™å…¥ç­–ç•¥ï¼ŒInnoDB æä¾›äº† innodb_flush_log_at_trx_commit å‚æ•°ï¼Œå®ƒæœ‰ä¸‰ç§å¯èƒ½å–å€¼ï¼š</p><ol><li>è®¾ç½®ä¸º 0 çš„æ—¶å€™ï¼Œè¡¨ç¤ºæ¯æ¬¡äº‹åŠ¡æäº¤æ—¶éƒ½åªæ˜¯æŠŠ redo log ç•™åœ¨ redo log buffer ä¸­ ;</li><li>è®¾ç½®ä¸º 1 çš„æ—¶å€™ï¼Œè¡¨ç¤ºæ¯æ¬¡äº‹åŠ¡æäº¤æ—¶éƒ½å°† redo log ç›´æ¥æŒä¹…åŒ–åˆ°ç£ç›˜ï¼›</li><li>è®¾ç½®ä¸º 2 çš„æ—¶å€™ï¼Œè¡¨ç¤ºæ¯æ¬¡äº‹åŠ¡æäº¤æ—¶éƒ½åªæ˜¯æŠŠ redo log å†™åˆ° page cacheã€‚</li></ol><p>InnoDB æœ‰ä¸€ä¸ªåå°çº¿ç¨‹ï¼Œæ¯éš” 1 ç§’ï¼Œå°±ä¼šæŠŠ redo log buffer ä¸­çš„æ—¥å¿—ï¼Œè°ƒç”¨ write å†™åˆ°æ–‡ä»¶ç³»ç»Ÿçš„ page cacheï¼Œç„¶åè°ƒç”¨ fsync æŒä¹…åŒ–åˆ°ç£ç›˜ã€‚</p><p>æ³¨æ„ï¼Œäº‹åŠ¡æ‰§è¡Œä¸­é—´è¿‡ç¨‹çš„ redo log ä¹Ÿæ˜¯ç›´æ¥å†™åœ¨ redo log buffer ä¸­çš„ï¼Œè¿™äº› redo log ä¹Ÿä¼šè¢«åå°çº¿ç¨‹ä¸€èµ·æŒä¹…åŒ–åˆ°ç£ç›˜ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªæ²¡æœ‰æäº¤çš„äº‹åŠ¡çš„ redo logï¼Œä¹Ÿæ˜¯å¯èƒ½å·²ç»æŒä¹…åŒ–åˆ°ç£ç›˜çš„ã€‚</p><p>å®é™…ä¸Šï¼Œé™¤äº†åå°çº¿ç¨‹æ¯ç§’ä¸€æ¬¡çš„è½®è¯¢æ“ä½œå¤–ï¼Œè¿˜æœ‰ä¸¤ç§åœºæ™¯ä¼šè®©ä¸€ä¸ªæ²¡æœ‰æäº¤çš„äº‹åŠ¡çš„ redo log å†™å…¥åˆ°ç£ç›˜ä¸­ã€‚</p><ol><li>**ä¸€ç§æ˜¯ï¼Œredo log buffer å ç”¨çš„ç©ºé—´å³å°†è¾¾åˆ° innodb_log_buffer_size ä¸€åŠçš„æ—¶å€™ï¼Œåå°çº¿ç¨‹ä¼šä¸»åŠ¨å†™ç›˜ã€‚**æ³¨æ„ï¼Œç”±äºè¿™ä¸ªäº‹åŠ¡å¹¶æ²¡æœ‰æäº¤ï¼Œæ‰€ä»¥è¿™ä¸ªå†™ç›˜åŠ¨ä½œåªæ˜¯ writeï¼Œè€Œæ²¡æœ‰è°ƒç”¨ fsyncï¼Œä¹Ÿå°±æ˜¯åªç•™åœ¨äº†æ–‡ä»¶ç³»ç»Ÿçš„ page cacheã€‚</li><li>**å¦ä¸€ç§æ˜¯ï¼Œå¹¶è¡Œçš„äº‹åŠ¡æäº¤çš„æ—¶å€™ï¼Œé¡ºå¸¦å°†è¿™ä¸ªäº‹åŠ¡çš„ redo log buffer æŒä¹…åŒ–åˆ°ç£ç›˜ã€‚**å‡è®¾ä¸€ä¸ªäº‹åŠ¡ A æ‰§è¡Œåˆ°ä¸€åŠï¼Œå·²ç»å†™äº†ä¸€äº› redo log åˆ° buffer ä¸­ï¼Œè¿™æ—¶å€™æœ‰å¦å¤–ä¸€ä¸ªçº¿ç¨‹çš„äº‹åŠ¡ B æäº¤ï¼Œå¦‚æœ innodb_flush_log_at_trx_commit è®¾ç½®çš„æ˜¯ 1ï¼Œé‚£ä¹ˆæŒ‰ç…§è¿™ä¸ªå‚æ•°çš„é€»è¾‘ï¼Œäº‹åŠ¡ B è¦æŠŠ redo log buffer é‡Œçš„æ—¥å¿—å…¨éƒ¨æŒä¹…åŒ–åˆ°ç£ç›˜ã€‚è¿™æ—¶å€™ï¼Œå°±ä¼šå¸¦ä¸Šäº‹åŠ¡ A åœ¨ redo log buffer é‡Œçš„æ—¥å¿—ä¸€èµ·æŒä¹…åŒ–åˆ°ç£ç›˜ã€‚</li></ol><p>è¿™é‡Œéœ€è¦è¯´æ˜çš„æ˜¯ï¼Œæˆ‘ä»¬ä»‹ç»ä¸¤é˜¶æ®µæäº¤çš„æ—¶å€™è¯´è¿‡ï¼Œæ—¶åºä¸Š redo log å…ˆ prepareï¼Œ å†å†™ binlogï¼Œæœ€åå†æŠŠ redo log commitã€‚</p><p>å¦‚æœæŠŠ innodb_flush_log_at_trx_commit è®¾ç½®æˆ 1ï¼Œé‚£ä¹ˆ redo log åœ¨ prepare é˜¶æ®µå°±è¦æŒä¹…åŒ–ä¸€æ¬¡ï¼Œå› ä¸ºæœ‰ä¸€ä¸ªå´©æºƒæ¢å¤é€»è¾‘æ˜¯è¦ä¾èµ–äº prepare çš„ redo logï¼Œå†åŠ ä¸Š binlog æ¥æ¢å¤çš„ã€‚ï¼ˆå¦‚æœä½ å°è±¡æœ‰ç‚¹å„¿æ¨¡ç³Šäº†ï¼Œå¯ä»¥å†å›é¡¾ä¸‹[ç¬¬ 15 ç¯‡æ–‡ç« ]ä¸­çš„ç›¸å…³å†…å®¹ï¼‰ã€‚</p><p>æ¯ç§’ä¸€æ¬¡åå°è½®è¯¢åˆ·ç›˜ï¼Œå†åŠ ä¸Šå´©æºƒæ¢å¤è¿™ä¸ªé€»è¾‘ï¼ŒInnoDB å°±è®¤ä¸º redo log åœ¨ commit çš„æ—¶å€™å°±ä¸éœ€è¦ fsync äº†ï¼Œåªä¼š write åˆ°æ–‡ä»¶ç³»ç»Ÿçš„ page cache ä¸­å°±å¤Ÿäº†ã€‚</p><p>é€šå¸¸æˆ‘ä»¬è¯´ MySQL çš„â€œåŒ 1â€é…ç½®ï¼ŒæŒ‡çš„å°±æ˜¯ sync_binlog å’Œ innodb_flush_log_at_trx_commit éƒ½è®¾ç½®æˆ 1ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªäº‹åŠ¡å®Œæ•´æäº¤å‰ï¼Œéœ€è¦ç­‰å¾…ä¸¤æ¬¡åˆ·ç›˜ï¼Œä¸€æ¬¡æ˜¯ redo logï¼ˆprepare é˜¶æ®µï¼‰ï¼Œä¸€æ¬¡æ˜¯ binlogã€‚</p><p>è¿™æ—¶å€™ï¼Œä½ å¯èƒ½æœ‰ä¸€ä¸ªç–‘é—®ï¼Œè¿™æ„å‘³ç€æˆ‘ä» MySQL çœ‹åˆ°çš„ TPS æ˜¯æ¯ç§’ä¸¤ä¸‡çš„è¯ï¼Œæ¯ç§’å°±ä¼šå†™å››ä¸‡æ¬¡ç£ç›˜ã€‚ä½†æ˜¯ï¼Œæˆ‘ç”¨å·¥å…·æµ‹è¯•å‡ºæ¥ï¼Œç£ç›˜èƒ½åŠ›ä¹Ÿå°±ä¸¤ä¸‡å·¦å³ï¼Œæ€ä¹ˆèƒ½å®ç°ä¸¤ä¸‡çš„ TPSï¼Ÿ</p><p>è§£é‡Šè¿™ä¸ªé—®é¢˜ï¼Œå°±è¦ç”¨åˆ°ç»„æäº¤ï¼ˆgroup commitï¼‰æœºåˆ¶äº†ã€‚</p><p>è¿™é‡Œï¼Œæˆ‘éœ€è¦å…ˆå’Œä½ ä»‹ç»æ—¥å¿—é€»è¾‘åºåˆ—å·ï¼ˆlog sequence numberï¼ŒLSNï¼‰çš„æ¦‚å¿µã€‚LSN æ˜¯å•è°ƒé€’å¢çš„ï¼Œç”¨æ¥å¯¹åº” redo log çš„ä¸€ä¸ªä¸ªå†™å…¥ç‚¹ã€‚æ¯æ¬¡å†™å…¥é•¿åº¦ä¸º length çš„ redo logï¼Œ LSN çš„å€¼å°±ä¼šåŠ ä¸Š lengthã€‚</p><p>LSN ä¹Ÿä¼šå†™åˆ° InnoDB çš„æ•°æ®é¡µä¸­ï¼Œæ¥ç¡®ä¿æ•°æ®é¡µä¸ä¼šè¢«å¤šæ¬¡æ‰§è¡Œé‡å¤çš„ redo logã€‚å…³äº LSN å’Œ redo logã€checkpoint çš„å…³ç³»ï¼Œæˆ‘ä¼šåœ¨åé¢çš„æ–‡ç« ä¸­è¯¦ç»†å±•å¼€ã€‚</p><p>å¦‚å›¾ 3 æ‰€ç¤ºï¼Œæ˜¯ä¸‰ä¸ªå¹¶å‘äº‹åŠ¡ (trx1, trx2, trx3) åœ¨ prepare é˜¶æ®µï¼Œéƒ½å†™å®Œ redo log bufferï¼ŒæŒä¹…åŒ–åˆ°ç£ç›˜çš„è¿‡ç¨‹ï¼Œå¯¹åº”çš„ LSN åˆ†åˆ«æ˜¯ 50ã€120 å’Œ 160ã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/933fdc052c6339de2aa3bf3f65b188cc-1584367394795.png" alt="img"></p><p>å›¾ 3 redo log ç»„æäº¤</p><p>ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œ</p><ol><li>trx1 æ˜¯ç¬¬ä¸€ä¸ªåˆ°è¾¾çš„ï¼Œä¼šè¢«é€‰ä¸ºè¿™ç»„çš„ leaderï¼›</li><li>ç­‰ trx1 è¦å¼€å§‹å†™ç›˜çš„æ—¶å€™ï¼Œè¿™ä¸ªç»„é‡Œé¢å·²ç»æœ‰äº†ä¸‰ä¸ªäº‹åŠ¡ï¼Œè¿™æ—¶å€™ LSN ä¹Ÿå˜æˆäº† 160ï¼›</li><li>trx1 å»å†™ç›˜çš„æ—¶å€™ï¼Œå¸¦çš„å°±æ˜¯ LSN=160ï¼Œå› æ­¤ç­‰ trx1 è¿”å›æ—¶ï¼Œæ‰€æœ‰ LSN å°äºç­‰äº 160 çš„ redo logï¼Œéƒ½å·²ç»è¢«æŒä¹…åŒ–åˆ°ç£ç›˜ï¼›</li><li>è¿™æ—¶å€™ trx2 å’Œ trx3 å°±å¯ä»¥ç›´æ¥è¿”å›äº†ã€‚</li></ol><p>æ‰€ä»¥ï¼Œä¸€æ¬¡ç»„æäº¤é‡Œé¢ï¼Œç»„å‘˜è¶Šå¤šï¼ŒèŠ‚çº¦ç£ç›˜ IOPS çš„æ•ˆæœè¶Šå¥½ã€‚ä½†å¦‚æœåªæœ‰å•çº¿ç¨‹å‹æµ‹ï¼Œé‚£å°±åªèƒ½è€è€å®å®åœ°ä¸€ä¸ªäº‹åŠ¡å¯¹åº”ä¸€æ¬¡æŒä¹…åŒ–æ“ä½œäº†ã€‚</p><p>åœ¨å¹¶å‘æ›´æ–°åœºæ™¯ä¸‹ï¼Œç¬¬ä¸€ä¸ªäº‹åŠ¡å†™å®Œ redo log buffer ä»¥åï¼Œæ¥ä¸‹æ¥è¿™ä¸ª fsync è¶Šæ™šè°ƒç”¨ï¼Œç»„å‘˜å¯èƒ½è¶Šå¤šï¼ŒèŠ‚çº¦ IOPS çš„æ•ˆæœå°±è¶Šå¥½ã€‚</p><p>ä¸ºäº†è®©ä¸€æ¬¡ fsync å¸¦çš„ç»„å‘˜æ›´å¤šï¼ŒMySQL æœ‰ä¸€ä¸ªå¾ˆæœ‰è¶£çš„ä¼˜åŒ–ï¼šæ‹–æ—¶é—´ã€‚åœ¨ä»‹ç»ä¸¤é˜¶æ®µæäº¤çš„æ—¶å€™ï¼Œæˆ‘æ›¾ç»ç»™ä½ ç”»äº†ä¸€ä¸ªå›¾ï¼Œç°åœ¨æˆ‘æŠŠå®ƒæˆªè¿‡æ¥ã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/98b3b4ff7b36d6d72e38029b86870551-1584367394832.png" alt="img"></p><p>å›¾ 4 ä¸¤é˜¶æ®µæäº¤</p><p>å›¾ä¸­ï¼Œæˆ‘æŠŠâ€œå†™ binlogâ€å½“æˆä¸€ä¸ªåŠ¨ä½œã€‚ä½†å®é™…ä¸Šï¼Œå†™ binlog æ˜¯åˆ†æˆä¸¤æ­¥çš„ï¼š</p><ol><li>å…ˆæŠŠ binlog ä» binlog cache ä¸­å†™åˆ°ç£ç›˜ä¸Šçš„ binlog æ–‡ä»¶ï¼›</li><li>è°ƒç”¨ fsync æŒä¹…åŒ–ã€‚</li></ol><p>MySQL ä¸ºäº†è®©ç»„æäº¤çš„æ•ˆæœæ›´å¥½ï¼ŒæŠŠ redo log åš fsync çš„æ—¶é—´æ‹–åˆ°äº†æ­¥éª¤ 1 ä¹‹åã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸Šé¢çš„å›¾å˜æˆäº†è¿™æ ·ï¼š</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/5ae7d074c34bc5bd55c82781de670c28-1584367394852.png" alt="img"></p><p>å›¾ 5 ä¸¤é˜¶æ®µæäº¤ç»†åŒ–</p><p>è¿™ä¹ˆä¸€æ¥ï¼Œbinlog ä¹Ÿå¯ä»¥ç»„æäº¤äº†ã€‚åœ¨æ‰§è¡Œå›¾ 5 ä¸­ç¬¬ 4 æ­¥æŠŠ binlog fsync åˆ°ç£ç›˜æ—¶ï¼Œå¦‚æœæœ‰å¤šä¸ªäº‹åŠ¡çš„ binlog å·²ç»å†™å®Œäº†ï¼Œä¹Ÿæ˜¯ä¸€èµ·æŒä¹…åŒ–çš„ï¼Œè¿™æ ·ä¹Ÿå¯ä»¥å‡å°‘ IOPS çš„æ¶ˆè€—ã€‚</p><p>ä¸è¿‡é€šå¸¸æƒ…å†µä¸‹ç¬¬ 3 æ­¥æ‰§è¡Œå¾—ä¼šå¾ˆå¿«ï¼Œæ‰€ä»¥ binlog çš„ write å’Œ fsync é—´çš„é—´éš”æ—¶é—´çŸ­ï¼Œå¯¼è‡´èƒ½é›†åˆåˆ°ä¸€èµ·æŒä¹…åŒ–çš„ binlog æ¯”è¾ƒå°‘ï¼Œå› æ­¤ binlog çš„ç»„æäº¤çš„æ•ˆæœé€šå¸¸ä¸å¦‚ redo log çš„æ•ˆæœé‚£ä¹ˆå¥½ã€‚</p><p>å¦‚æœä½ æƒ³æå‡ binlog ç»„æäº¤çš„æ•ˆæœï¼Œå¯ä»¥é€šè¿‡è®¾ç½® binlog_group_commit_sync_delay å’Œ binlog_group_commit_sync_no_delay_count æ¥å®ç°ã€‚</p><ol><li>binlog_group_commit_sync_delay å‚æ•°ï¼Œè¡¨ç¤ºå»¶è¿Ÿå¤šå°‘å¾®ç§’åæ‰è°ƒç”¨ fsync;</li><li>binlog_group_commit_sync_no_delay_count å‚æ•°ï¼Œè¡¨ç¤ºç´¯ç§¯å¤šå°‘æ¬¡ä»¥åæ‰è°ƒç”¨ fsyncã€‚</li></ol><p>è¿™ä¸¤ä¸ªæ¡ä»¶æ˜¯æˆ–çš„å…³ç³»ï¼Œä¹Ÿå°±æ˜¯è¯´åªè¦æœ‰ä¸€ä¸ªæ»¡è¶³æ¡ä»¶å°±ä¼šè°ƒç”¨ fsyncã€‚</p><p>æ‰€ä»¥ï¼Œå½“ binlog_group_commit_sync_delay è®¾ç½®ä¸º 0 çš„æ—¶å€™ï¼Œbinlog_group_commit_sync_no_delay_count ä¹Ÿæ— æ•ˆäº†ã€‚</p><p>ä¹‹å‰æœ‰åŒå­¦åœ¨è¯„è®ºåŒºé—®åˆ°ï¼ŒWAL æœºåˆ¶æ˜¯å‡å°‘ç£ç›˜å†™ï¼Œå¯æ˜¯æ¯æ¬¡æäº¤äº‹åŠ¡éƒ½è¦å†™ redo log å’Œ binlogï¼Œè¿™ç£ç›˜è¯»å†™æ¬¡æ•°ä¹Ÿæ²¡å˜å°‘å‘€ï¼Ÿ</p><p>ç°åœ¨ä½ å°±èƒ½ç†è§£äº†ï¼ŒWAL æœºåˆ¶ä¸»è¦å¾—ç›Šäºä¸¤ä¸ªæ–¹é¢ï¼š</p><ol><li>redo log å’Œ binlog éƒ½æ˜¯é¡ºåºå†™ï¼Œç£ç›˜çš„é¡ºåºå†™æ¯”éšæœºå†™é€Ÿåº¦è¦å¿«ï¼›</li><li>ç»„æäº¤æœºåˆ¶ï¼Œå¯ä»¥å¤§å¹…åº¦é™ä½ç£ç›˜çš„ IOPS æ¶ˆè€—ã€‚</li></ol><p>åˆ†æåˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å†æ¥å›ç­”è¿™ä¸ªé—®é¢˜ï¼š<strong>å¦‚æœä½ çš„ MySQL ç°åœ¨å‡ºç°äº†æ€§èƒ½ç“¶é¢ˆï¼Œè€Œä¸”ç“¶é¢ˆåœ¨ IO ä¸Šï¼Œå¯ä»¥é€šè¿‡å“ªäº›æ–¹æ³•æ¥æå‡æ€§èƒ½å‘¢ï¼Ÿ</strong></p><p>é’ˆå¯¹è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥è€ƒè™‘ä»¥ä¸‹ä¸‰ç§æ–¹æ³•ï¼š</p><ol><li>è®¾ç½® binlog_group_commit_sync_delay å’Œ binlog_group_commit_sync_no_delay_count å‚æ•°ï¼Œå‡å°‘ binlog çš„å†™ç›˜æ¬¡æ•°ã€‚è¿™ä¸ªæ–¹æ³•æ˜¯åŸºäºâ€œé¢å¤–çš„æ•…æ„ç­‰å¾…â€æ¥å®ç°çš„ï¼Œå› æ­¤å¯èƒ½ä¼šå¢åŠ è¯­å¥çš„å“åº”æ—¶é—´ï¼Œä½†æ²¡æœ‰ä¸¢å¤±æ•°æ®çš„é£é™©ã€‚</li><li>å°† sync_binlog è®¾ç½®ä¸ºå¤§äº 1 çš„å€¼ï¼ˆæ¯”è¾ƒå¸¸è§æ˜¯ 100~1000ï¼‰ã€‚è¿™æ ·åšçš„é£é™©æ˜¯ï¼Œä¸»æœºæ‰ç”µæ—¶ä¼šä¸¢ binlog æ—¥å¿—ã€‚</li><li>å°† innodb_flush_log_at_trx_commit è®¾ç½®ä¸º 2ã€‚è¿™æ ·åšçš„é£é™©æ˜¯ï¼Œä¸»æœºæ‰ç”µçš„æ—¶å€™ä¼šä¸¢æ•°æ®ã€‚</li></ol><p>æˆ‘ä¸å»ºè®®ä½ æŠŠ innodb_flush_log_at_trx_commit è®¾ç½®æˆ 0ã€‚å› ä¸ºæŠŠè¿™ä¸ªå‚æ•°è®¾ç½®æˆ 0ï¼Œè¡¨ç¤º redo log åªä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œè¿™æ ·çš„è¯ MySQL æœ¬èº«å¼‚å¸¸é‡å¯ä¹Ÿä¼šä¸¢æ•°æ®ï¼Œé£é™©å¤ªå¤§ã€‚è€Œ redo log å†™åˆ°æ–‡ä»¶ç³»ç»Ÿçš„ page cache çš„é€Ÿåº¦ä¹Ÿæ˜¯å¾ˆå¿«çš„ï¼Œæ‰€ä»¥å°†è¿™ä¸ªå‚æ•°è®¾ç½®æˆ 2 è·Ÿè®¾ç½®æˆ 0 å…¶å®æ€§èƒ½å·®ä¸å¤šï¼Œä½†è¿™æ ·åš MySQL å¼‚å¸¸é‡å¯æ—¶å°±ä¸ä¼šä¸¢æ•°æ®äº†ï¼Œç›¸æ¯”ä¹‹ä¸‹é£é™©ä¼šæ›´å°ã€‚</p><h4 id="å°ç»“-14" tabindex="-1"><a class="header-anchor" href="#å°ç»“-14" aria-hidden="true">#</a> å°ç»“</h4><p>åœ¨ä¸“æ çš„[ç¬¬ 2 ç¯‡]å’Œ[ç¬¬ 15 ç¯‡]æ–‡ç« ä¸­ï¼Œæˆ‘å’Œä½ åˆ†æäº†ï¼Œå¦‚æœ redo log å’Œ binlog æ˜¯å®Œæ•´çš„ï¼ŒMySQL æ˜¯å¦‚ä½•ä¿è¯ crash-safe çš„ã€‚ä»Šå¤©è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ç€é‡å’Œä½ ä»‹ç»çš„æ˜¯ MySQL æ˜¯â€œæ€ä¹ˆä¿è¯ redo log å’Œ binlog æ˜¯å®Œæ•´çš„â€ã€‚</p><p>å¸Œæœ›è¿™ä¸‰ç¯‡æ–‡ç« ä¸²èµ·æ¥çš„å†…å®¹ï¼Œèƒ½å¤Ÿè®©ä½ å¯¹ crash-safe è¿™ä¸ªæ¦‚å¿µæœ‰æ›´æ¸…æ™°çš„ç†è§£ã€‚</p><p>ä¹‹å‰çš„ç¬¬ 15 ç¯‡ç­”ç–‘æ–‡ç« å‘å¸ƒä¹‹åï¼Œæœ‰åŒå­¦ç»§ç»­ç•™è¨€é—®åˆ°äº†ä¸€äº›è·Ÿæ—¥å¿—ç›¸å…³çš„é—®é¢˜ï¼Œè¿™é‡Œä¸ºäº†æ–¹ä¾¿ä½ å›é¡¾ã€å­¦ä¹ ï¼Œæˆ‘å†é›†ä¸­å›ç­”ä¸€æ¬¡è¿™äº›é—®é¢˜ã€‚</p><p>**é—®é¢˜ 1ï¼š**æ‰§è¡Œä¸€ä¸ª update è¯­å¥ä»¥åï¼Œæˆ‘å†å»æ‰§è¡Œ hexdump å‘½ä»¤ç›´æ¥æŸ¥çœ‹ ibd æ–‡ä»¶å†…å®¹ï¼Œä¸ºä»€ä¹ˆæ²¡æœ‰çœ‹åˆ°æ•°æ®æœ‰æ”¹å˜å‘¢ï¼Ÿ</p><p>å›ç­”ï¼šè¿™å¯èƒ½æ˜¯å› ä¸º WAL æœºåˆ¶çš„åŸå› ã€‚update è¯­å¥æ‰§è¡Œå®Œæˆåï¼ŒInnoDB åªä¿è¯å†™å®Œäº† redo logã€å†…å­˜ï¼Œå¯èƒ½è¿˜æ²¡æ¥å¾—åŠå°†æ•°æ®å†™åˆ°ç£ç›˜ã€‚</p><p>**é—®é¢˜ 2ï¼š**ä¸ºä»€ä¹ˆ binlog cache æ˜¯æ¯ä¸ªçº¿ç¨‹è‡ªå·±ç»´æŠ¤çš„ï¼Œè€Œ redo log buffer æ˜¯å…¨å±€å…±ç”¨çš„ï¼Ÿ</p><p>å›ç­”ï¼šMySQL è¿™ä¹ˆè®¾è®¡çš„ä¸»è¦åŸå› æ˜¯ï¼Œbinlog æ˜¯ä¸èƒ½â€œè¢«æ‰“æ–­çš„â€ã€‚ä¸€ä¸ªäº‹åŠ¡çš„ binlog å¿…é¡»è¿ç»­å†™ï¼Œå› æ­¤è¦æ•´ä¸ªäº‹åŠ¡å®Œæˆåï¼Œå†ä¸€èµ·å†™åˆ°æ–‡ä»¶é‡Œã€‚</p><p>è€Œ redo log å¹¶æ²¡æœ‰è¿™ä¸ªè¦æ±‚ï¼Œä¸­é—´æœ‰ç”Ÿæˆçš„æ—¥å¿—å¯ä»¥å†™åˆ° redo log buffer ä¸­ã€‚redo log buffer ä¸­çš„å†…å®¹è¿˜èƒ½â€œæ­ä¾¿è½¦â€ï¼Œå…¶ä»–äº‹åŠ¡æäº¤çš„æ—¶å€™å¯ä»¥è¢«ä¸€èµ·å†™åˆ°ç£ç›˜ä¸­ã€‚</p><p>**é—®é¢˜ 3ï¼š**äº‹åŠ¡æ‰§è¡ŒæœŸé—´ï¼Œè¿˜æ²¡åˆ°æäº¤é˜¶æ®µï¼Œå¦‚æœå‘ç”Ÿ crash çš„è¯ï¼Œredo log è‚¯å®šä¸¢äº†ï¼Œè¿™ä¼šä¸ä¼šå¯¼è‡´ä¸»å¤‡ä¸ä¸€è‡´å‘¢ï¼Ÿ</p><p>å›ç­”ï¼šä¸ä¼šã€‚å› ä¸ºè¿™æ—¶å€™ binlog ä¹Ÿè¿˜åœ¨ binlog cache é‡Œï¼Œæ²¡å‘ç»™å¤‡åº“ã€‚crash ä»¥å redo log å’Œ binlog éƒ½æ²¡æœ‰äº†ï¼Œä»ä¸šåŠ¡è§’åº¦çœ‹è¿™ä¸ªäº‹åŠ¡ä¹Ÿæ²¡æœ‰æäº¤ï¼Œæ‰€ä»¥æ•°æ®æ˜¯ä¸€è‡´çš„ã€‚</p><p>**é—®é¢˜ 4ï¼š**å¦‚æœ binlog å†™å®Œç›˜ä»¥åå‘ç”Ÿ crashï¼Œè¿™æ—¶å€™è¿˜æ²¡ç»™å®¢æˆ·ç«¯ç­”å¤å°±é‡å¯äº†ã€‚ç­‰å®¢æˆ·ç«¯å†é‡è¿è¿›æ¥ï¼Œå‘ç°äº‹åŠ¡å·²ç»æäº¤æˆåŠŸäº†ï¼Œè¿™æ˜¯ä¸æ˜¯ bugï¼Ÿ</p><p>å›ç­”ï¼šä¸æ˜¯ã€‚</p><p>ä½ å¯ä»¥è®¾æƒ³ä¸€ä¸‹æ›´æç«¯çš„æƒ…å†µï¼Œæ•´ä¸ªäº‹åŠ¡éƒ½æäº¤æˆåŠŸäº†ï¼Œredo log commit å®Œæˆäº†ï¼Œå¤‡åº“ä¹Ÿæ”¶åˆ° binlog å¹¶æ‰§è¡Œäº†ã€‚ä½†æ˜¯ä¸»åº“å’Œå®¢æˆ·ç«¯ç½‘ç»œæ–­å¼€äº†ï¼Œå¯¼è‡´äº‹åŠ¡æˆåŠŸçš„åŒ…è¿”å›ä¸å›å»ï¼Œè¿™æ—¶å€™å®¢æˆ·ç«¯ä¹Ÿä¼šæ”¶åˆ°â€œç½‘ç»œæ–­å¼€â€çš„å¼‚å¸¸ã€‚è¿™ç§ä¹Ÿåªèƒ½ç®—æ˜¯äº‹åŠ¡æˆåŠŸçš„ï¼Œä¸èƒ½è®¤ä¸ºæ˜¯ bugã€‚</p><p>å®é™…ä¸Šæ•°æ®åº“çš„ crash-safe ä¿è¯çš„æ˜¯ï¼š</p><ol><li>å¦‚æœå®¢æˆ·ç«¯æ”¶åˆ°äº‹åŠ¡æˆåŠŸçš„æ¶ˆæ¯ï¼Œäº‹åŠ¡å°±ä¸€å®šæŒä¹…åŒ–äº†ï¼›</li><li>å¦‚æœå®¢æˆ·ç«¯æ”¶åˆ°äº‹åŠ¡å¤±è´¥ï¼ˆæ¯”å¦‚ä¸»é”®å†²çªã€å›æ»šç­‰ï¼‰çš„æ¶ˆæ¯ï¼Œäº‹åŠ¡å°±ä¸€å®šå¤±è´¥äº†ï¼›</li><li>å¦‚æœå®¢æˆ·ç«¯æ”¶åˆ°â€œæ‰§è¡Œå¼‚å¸¸â€çš„æ¶ˆæ¯ï¼Œåº”ç”¨éœ€è¦é‡è¿åé€šè¿‡æŸ¥è¯¢å½“å‰çŠ¶æ€æ¥ç»§ç»­åç»­çš„é€»è¾‘ã€‚æ­¤æ—¶æ•°æ®åº“åªéœ€è¦ä¿è¯å†…éƒ¨ï¼ˆæ•°æ®å’Œæ—¥å¿—ä¹‹é—´ï¼Œä¸»åº“å’Œå¤‡åº“ä¹‹é—´ï¼‰ä¸€è‡´å°±å¯ä»¥äº†ã€‚</li></ol><p>æœ€åï¼Œåˆåˆ°äº†è¯¾åé—®é¢˜æ—¶é—´ã€‚</p><p>ä»Šå¤©æˆ‘ç•™ç»™ä½ çš„æ€è€ƒé¢˜æ˜¯ï¼šä½ çš„ç”Ÿäº§åº“è®¾ç½®çš„æ˜¯â€œåŒ 1â€å—ï¼Ÿ å¦‚æœå¹³æ—¶æ˜¯çš„è¯ï¼Œä½ æœ‰åœ¨ä»€ä¹ˆåœºæ™¯ä¸‹æ”¹æˆè¿‡â€œéåŒ 1â€å—ï¼Ÿä½ çš„è¿™ä¸ªæ“ä½œåˆæ˜¯åŸºäºä»€ä¹ˆå†³å®šçš„ï¼Ÿ</p><p>å¦å¤–ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“è¿™äº›è®¾ç½®å¯èƒ½æœ‰æŸï¼Œå¦‚æœå‘ç”Ÿäº†å¼‚å¸¸ï¼Œä½ çš„æ­¢æŸæ–¹æ¡ˆæ˜¯ä»€ä¹ˆï¼Ÿ</p><p>ä½ å¯ä»¥æŠŠä½ çš„ç†è§£æˆ–è€…ç»éªŒå†™åœ¨ç•™è¨€åŒºï¼Œæˆ‘ä¼šåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« çš„æœ«å°¾é€‰å–æœ‰è¶£çš„è¯„è®ºå’Œä½ ä¸€èµ·åˆ†äº«å’Œåˆ†æã€‚æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚</p><h4 id="ä¸ŠæœŸé—®é¢˜æ—¶é—´-11" tabindex="-1"><a class="header-anchor" href="#ä¸ŠæœŸé—®é¢˜æ—¶é—´-11" aria-hidden="true">#</a> ä¸ŠæœŸé—®é¢˜æ—¶é—´</h4><p>æˆ‘åœ¨ä¸Šç¯‡æ–‡ç« æœ€åï¼Œæƒ³è¦ä½ åˆ†äº«çš„æ˜¯çº¿ä¸Šâ€œæ•‘ç«â€çš„ç»éªŒã€‚</p><p>@Long åŒå­¦ï¼Œåœ¨ç•™è¨€ä¸­æåˆ°äº†å‡ ä¸ªå¾ˆå¥½çš„åœºæ™¯ã€‚</p><ul><li>å…¶ä¸­ç¬¬ 3 ä¸ªé—®é¢˜ï¼Œâ€œå¦‚æœä¸€ä¸ªæ•°æ®åº“æ˜¯è¢«å®¢æˆ·ç«¯çš„å‹åŠ›æ‰“æ»¡å¯¼è‡´æ— æ³•å“åº”çš„ï¼Œé‡å¯æ•°æ®åº“æ˜¯æ²¡ç”¨çš„ã€‚â€ï¼Œè¯´æ˜ä»–å¾ˆå¥½åœ°æ€è€ƒäº†ã€‚ è¿™ä¸ªé—®é¢˜æ˜¯å› ä¸ºé‡å¯ä¹‹åï¼Œä¸šåŠ¡è¯·æ±‚è¿˜ä¼šå†å‘ã€‚è€Œä¸”ç”±äºæ˜¯é‡å¯ï¼Œbuffer pool è¢«æ¸…ç©ºï¼Œå¯èƒ½ä¼šå¯¼è‡´è¯­å¥æ‰§è¡Œå¾—æ›´æ…¢ã€‚</li><li>ä»–æåˆ°çš„ç¬¬ 4 ä¸ªé—®é¢˜ä¹Ÿå¾ˆå…¸å‹ã€‚æœ‰æ—¶å€™ä¸€ä¸ªè¡¨ä¸Šä¼šå‡ºç°å¤šä¸ªå•å­—æ®µç´¢å¼•ï¼ˆè€Œä¸”å¾€å¾€è¿™æ˜¯å› ä¸ºè¿ç»´å·¥ç¨‹å¸ˆå¯¹ç´¢å¼•åŸç†ä¸å¤Ÿæ¸…æ™°åšçš„è®¾è®¡ï¼‰ï¼Œè¿™æ ·å°±å¯èƒ½å‡ºç°ä¼˜åŒ–å™¨é€‰æ‹©ç´¢å¼•åˆå¹¶ç®—æ³•çš„ç°è±¡ã€‚ä½†å®é™…ä¸Šï¼Œç´¢å¼•åˆå¹¶ç®—æ³•çš„æ•ˆç‡å¹¶ä¸å¥½ã€‚è€Œé€šè¿‡å°†å…¶ä¸­çš„ä¸€ä¸ªç´¢å¼•æ”¹æˆè”åˆç´¢å¼•çš„æ–¹æ³•ï¼Œæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„åº”å¯¹æ–¹æ¡ˆã€‚</li></ul><p>è¿˜æœ‰å…¶ä»–å‡ ä¸ªåŒå­¦æåˆ°çš„é—®é¢˜åœºæ™¯ï¼Œä¹Ÿå¾ˆå¥½ï¼Œå¾ˆå€¼å¾—ä½ ä¸€çœ‹ã€‚</p><blockquote><p>@Max åŒå­¦æåˆ°ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ï¼šå®¢æˆ·ç«¯ç¨‹åºçš„è¿æ¥å™¨ï¼Œè¿æ¥å®Œæˆåä¼šåšä¸€äº›è¯¸å¦‚ show columns çš„æ“ä½œï¼Œåœ¨çŸ­è¿æ¥æ¨¡å¼ä¸‹è¿™ä¸ªå½±å“å°±éå¸¸å¤§äº†ã€‚ è¿™ä¸ªæé†’æˆ‘ä»¬ï¼Œåœ¨ review é¡¹ç›®çš„æ—¶å€™ï¼Œä¸æ­¢è¦ review æˆ‘ä»¬è‡ªå·±ä¸šåŠ¡çš„ä»£ç ï¼Œä¹Ÿè¦ review è¿æ¥å™¨çš„è¡Œä¸ºã€‚ä¸€èˆ¬åšæ³•å°±æ˜¯åœ¨æµ‹è¯•ç¯å¢ƒï¼ŒæŠŠ general_log æ‰“å¼€ï¼Œç”¨ä¸šåŠ¡è¡Œä¸ºè§¦å‘è¿æ¥ï¼Œç„¶åé€šè¿‡ general log åˆ†æè¿æ¥å™¨çš„è¡Œä¸ºã€‚</p></blockquote><blockquote><p>@Manjusaka åŒå­¦çš„ç•™è¨€ä¸­ï¼Œç¬¬äºŒç‚¹æå¾—éå¸¸å¥½ï¼šå¦‚æœä½ çš„æ•°æ®åº“è¯·æ±‚æ¨¡å¼ç›´æ¥å¯¹åº”äºå®¢æˆ·è¯·æ±‚ï¼Œè¿™å¾€å¾€æ˜¯ä¸€ä¸ªå±é™©çš„è®¾è®¡ã€‚å› ä¸ºå®¢æˆ·è¡Œä¸ºä¸å¯æ§ï¼Œå¯èƒ½çªç„¶å› ä¸ºä½ ä»¬å…¬å¸çš„ä¸€ä¸ªè¿è¥æ¨å¹¿ï¼Œå‹åŠ›æš´å¢ï¼Œè¿™æ ·å¾ˆå®¹æ˜“æŠŠæ•°æ®åº“æ‰“æŒ‚ã€‚ åœ¨è®¾è®¡æ¨¡å‹é‡Œé¢è®¾è®¡ä¸€å±‚ï¼Œä¸“é—¨è´Ÿè´£ç®¡ç†è¯·æ±‚å’Œæ•°æ®åº“æœåŠ¡èµ„æºï¼Œå¯¹äºæ¯”è¾ƒé‡è¦å’Œå¤§æµé‡çš„ä¸šåŠ¡ï¼Œæ˜¯ä¸€ä¸ªå¥½çš„è®¾è®¡æ–¹å‘ã€‚</p></blockquote><blockquote><p>@Vincent åŒå­¦æäº†ä¸€ä¸ªå¥½é—®é¢˜ï¼Œç”¨æ–‡ä¸­æåˆ°çš„ DDL æ–¹æ¡ˆï¼Œä¼šå¯¼è‡´ binlog é‡Œé¢å°‘äº†è¿™ä¸ª DDL è¯­å¥ï¼Œåç»­å½±å“å¤‡ä»½æ¢å¤çš„åŠŸèƒ½ã€‚ç”±äºéœ€è¦å¦ä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼ˆä¸»å¤‡åŒæ­¥åè®®ï¼‰ï¼Œæˆ‘æ”¾åœ¨åé¢çš„æ–‡ç« ä¸­è¯´æ˜ã€‚</p></blockquote><h3 id="_24-mysqlæ˜¯æ€ä¹ˆä¿è¯ä¸»å¤‡ä¸€è‡´çš„" tabindex="-1"><a class="header-anchor" href="#_24-mysqlæ˜¯æ€ä¹ˆä¿è¯ä¸»å¤‡ä¸€è‡´çš„" aria-hidden="true">#</a> 24 MySQLæ˜¯æ€ä¹ˆä¿è¯ä¸»å¤‡ä¸€è‡´çš„ï¼Ÿ</h3><p>åœ¨å‰é¢çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä¸æ­¢ä¸€æ¬¡åœ°å’Œä½ æåˆ°äº† binlogï¼Œå¤§å®¶çŸ¥é“ binlog å¯ä»¥ç”¨æ¥å½’æ¡£ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥åšä¸»å¤‡åŒæ­¥ï¼Œä½†å®ƒçš„å†…å®¹æ˜¯ä»€ä¹ˆæ ·çš„å‘¢ï¼Ÿä¸ºä»€ä¹ˆå¤‡åº“æ‰§è¡Œäº† binlog å°±å¯ä»¥è·Ÿä¸»åº“ä¿æŒä¸€è‡´äº†å‘¢ï¼Ÿä»Šå¤©æˆ‘å°±æ­£å¼åœ°å’Œä½ ä»‹ç»ä¸€ä¸‹å®ƒã€‚</p><p>æ¯«ä¸å¤¸å¼ åœ°è¯´ï¼ŒMySQL èƒ½å¤Ÿæˆä¸ºç°ä¸‹æœ€æµè¡Œçš„å¼€æºæ•°æ®åº“ï¼Œbinlog åŠŸä¸å¯æ²¡ã€‚</p><p>åœ¨æœ€å¼€å§‹ï¼ŒMySQL æ˜¯ä»¥å®¹æ˜“å­¦ä¹ å’Œæ–¹ä¾¿çš„é«˜å¯ç”¨æ¶æ„ï¼Œè¢«å¼€å‘äººå‘˜é’ççš„ã€‚è€Œå®ƒçš„å‡ ä¹æ‰€æœ‰çš„é«˜å¯ç”¨æ¶æ„ï¼Œéƒ½ç›´æ¥ä¾èµ–äº binlogã€‚è™½ç„¶è¿™äº›é«˜å¯ç”¨æ¶æ„å·²ç»å‘ˆç°å‡ºè¶Šæ¥è¶Šå¤æ‚çš„è¶‹åŠ¿ï¼Œä½†éƒ½æ˜¯ä»æœ€åŸºæœ¬çš„ä¸€ä¸»ä¸€å¤‡æ¼”åŒ–è¿‡æ¥çš„ã€‚</p><p>ä»Šå¤©è¿™ç¯‡æ–‡ç« æˆ‘ä¸»è¦ä¸ºä½ ä»‹ç»ä¸»å¤‡çš„åŸºæœ¬åŸç†ã€‚ç†è§£äº†èƒŒåçš„è®¾è®¡åŸç†ï¼Œä½ ä¹Ÿå¯ä»¥ä»ä¸šåŠ¡å¼€å‘çš„è§’åº¦ï¼Œæ¥å€Ÿé‰´è¿™äº›è®¾è®¡æ€æƒ³ã€‚</p><h4 id="mysql-ä¸»å¤‡çš„åŸºæœ¬åŸç†" tabindex="-1"><a class="header-anchor" href="#mysql-ä¸»å¤‡çš„åŸºæœ¬åŸç†" aria-hidden="true">#</a> MySQL ä¸»å¤‡çš„åŸºæœ¬åŸç†</h4><p>å¦‚å›¾ 1 æ‰€ç¤ºå°±æ˜¯åŸºæœ¬çš„ä¸»å¤‡åˆ‡æ¢æµç¨‹ã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/fd75a2b37ae6ca709b7f16fe060c2c10-1584367395065.png" alt="img"></p><p>å›¾ 1 MySQL ä¸»å¤‡åˆ‡æ¢æµç¨‹</p><p>åœ¨çŠ¶æ€ 1 ä¸­ï¼Œå®¢æˆ·ç«¯çš„è¯»å†™éƒ½ç›´æ¥è®¿é—®èŠ‚ç‚¹ Aï¼Œè€ŒèŠ‚ç‚¹ B æ˜¯ A çš„å¤‡åº“ï¼Œåªæ˜¯å°† A çš„æ›´æ–°éƒ½åŒæ­¥è¿‡æ¥ï¼Œåˆ°æœ¬åœ°æ‰§è¡Œã€‚è¿™æ ·å¯ä»¥ä¿æŒèŠ‚ç‚¹ B å’Œ A çš„æ•°æ®æ˜¯ç›¸åŒçš„ã€‚</p><p>å½“éœ€è¦åˆ‡æ¢çš„æ—¶å€™ï¼Œå°±åˆ‡æˆçŠ¶æ€ 2ã€‚è¿™æ—¶å€™å®¢æˆ·ç«¯è¯»å†™è®¿é—®çš„éƒ½æ˜¯èŠ‚ç‚¹ Bï¼Œè€ŒèŠ‚ç‚¹ A æ˜¯ B çš„å¤‡åº“ã€‚</p><p>åœ¨çŠ¶æ€ 1 ä¸­ï¼Œè™½ç„¶èŠ‚ç‚¹ B æ²¡æœ‰è¢«ç›´æ¥è®¿é—®ï¼Œä½†æ˜¯æˆ‘ä¾ç„¶å»ºè®®ä½ æŠŠèŠ‚ç‚¹ Bï¼ˆä¹Ÿå°±æ˜¯å¤‡åº“ï¼‰è®¾ç½®æˆåªè¯»ï¼ˆreadonlyï¼‰æ¨¡å¼ã€‚è¿™æ ·åšï¼Œæœ‰ä»¥ä¸‹å‡ ä¸ªè€ƒè™‘ï¼š</p><ol><li>æœ‰æ—¶å€™ä¸€äº›è¿è¥ç±»çš„æŸ¥è¯¢è¯­å¥ä¼šè¢«æ”¾åˆ°å¤‡åº“ä¸Šå»æŸ¥ï¼Œè®¾ç½®ä¸ºåªè¯»å¯ä»¥é˜²æ­¢è¯¯æ“ä½œï¼›</li><li>é˜²æ­¢åˆ‡æ¢é€»è¾‘æœ‰ bugï¼Œæ¯”å¦‚åˆ‡æ¢è¿‡ç¨‹ä¸­å‡ºç°åŒå†™ï¼Œé€ æˆä¸»å¤‡ä¸ä¸€è‡´ï¼›</li><li>å¯ä»¥ç”¨ readonly çŠ¶æ€ï¼Œæ¥åˆ¤æ–­èŠ‚ç‚¹çš„è§’è‰²ã€‚</li></ol><p>ä½ å¯èƒ½ä¼šé—®ï¼Œæˆ‘æŠŠå¤‡åº“è®¾ç½®æˆåªè¯»äº†ï¼Œè¿˜æ€ä¹ˆè·Ÿä¸»åº“ä¿æŒåŒæ­¥æ›´æ–°å‘¢ï¼Ÿ</p><p>è¿™ä¸ªé—®é¢˜ï¼Œä½ ä¸ç”¨æ‹…å¿ƒã€‚å› ä¸º readonly è®¾ç½®å¯¹è¶…çº§ (super) æƒé™ç”¨æˆ·æ˜¯æ— æ•ˆçš„ï¼Œè€Œç”¨äºåŒæ­¥æ›´æ–°çš„çº¿ç¨‹ï¼Œå°±æ‹¥æœ‰è¶…çº§æƒé™ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†çœ‹çœ‹<strong>èŠ‚ç‚¹ A åˆ° B è¿™æ¡çº¿çš„å†…éƒ¨æµç¨‹æ˜¯ä»€ä¹ˆæ ·çš„</strong>ã€‚å›¾ 2 ä¸­ç”»å‡ºçš„å°±æ˜¯ä¸€ä¸ª update è¯­å¥åœ¨èŠ‚ç‚¹ A æ‰§è¡Œï¼Œç„¶ååŒæ­¥åˆ°èŠ‚ç‚¹ B çš„å®Œæ•´æµç¨‹å›¾ã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/a66c154c1bc51e071dd2cc8c1d6ca6a3-1584367397412.png" alt="img"></p><p>å›¾ 2 ä¸»å¤‡æµç¨‹å›¾</p><p>å›¾ 2 ä¸­ï¼ŒåŒ…å«äº†æˆ‘åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­è®²åˆ°çš„ binlog å’Œ redo log çš„å†™å…¥æœºåˆ¶ç›¸å…³çš„å†…å®¹ï¼Œå¯ä»¥çœ‹åˆ°ï¼šä¸»åº“æ¥æ”¶åˆ°å®¢æˆ·ç«¯çš„æ›´æ–°è¯·æ±‚åï¼Œæ‰§è¡Œå†…éƒ¨äº‹åŠ¡çš„æ›´æ–°é€»è¾‘ï¼ŒåŒæ—¶å†™ binlogã€‚</p><p>å¤‡åº“ B è·Ÿä¸»åº“ A ä¹‹é—´ç»´æŒäº†ä¸€ä¸ªé•¿è¿æ¥ã€‚ä¸»åº“ A å†…éƒ¨æœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œä¸“é—¨ç”¨äºæœåŠ¡å¤‡åº“ B çš„è¿™ä¸ªé•¿è¿æ¥ã€‚ä¸€ä¸ªäº‹åŠ¡æ—¥å¿—åŒæ­¥çš„å®Œæ•´è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><ol><li>åœ¨å¤‡åº“ B ä¸Šé€šè¿‡ change master å‘½ä»¤ï¼Œè®¾ç½®ä¸»åº“ A çš„ IPã€ç«¯å£ã€ç”¨æˆ·åã€å¯†ç ï¼Œä»¥åŠè¦ä»å“ªä¸ªä½ç½®å¼€å§‹è¯·æ±‚ binlogï¼Œè¿™ä¸ªä½ç½®åŒ…å«æ–‡ä»¶åå’Œæ—¥å¿—åç§»é‡ã€‚</li><li>åœ¨å¤‡åº“ B ä¸Šæ‰§è¡Œ start slave å‘½ä»¤ï¼Œè¿™æ—¶å€™å¤‡åº“ä¼šå¯åŠ¨ä¸¤ä¸ªçº¿ç¨‹ï¼Œå°±æ˜¯å›¾ä¸­çš„ io_thread å’Œ sql_threadã€‚å…¶ä¸­ io_thread è´Ÿè´£ä¸ä¸»åº“å»ºç«‹è¿æ¥ã€‚</li><li>ä¸»åº“ A æ ¡éªŒå®Œç”¨æˆ·åã€å¯†ç åï¼Œå¼€å§‹æŒ‰ç…§å¤‡åº“ B ä¼ è¿‡æ¥çš„ä½ç½®ï¼Œä»æœ¬åœ°è¯»å– binlogï¼Œå‘ç»™ Bã€‚</li><li>å¤‡åº“ B æ‹¿åˆ° binlog åï¼Œå†™åˆ°æœ¬åœ°æ–‡ä»¶ï¼Œç§°ä¸ºä¸­è½¬æ—¥å¿—ï¼ˆrelay logï¼‰ã€‚</li><li>sql_thread è¯»å–ä¸­è½¬æ—¥å¿—ï¼Œè§£æå‡ºæ—¥å¿—é‡Œçš„å‘½ä»¤ï¼Œå¹¶æ‰§è¡Œã€‚</li></ol><p>è¿™é‡Œéœ€è¦è¯´æ˜ï¼Œåæ¥ç”±äºå¤šçº¿ç¨‹å¤åˆ¶æ–¹æ¡ˆçš„å¼•å…¥ï¼Œsql_thread æ¼”åŒ–æˆä¸ºäº†å¤šä¸ªçº¿ç¨‹ï¼Œè·Ÿæˆ‘ä»¬ä»Šå¤©è¦ä»‹ç»çš„åŸç†æ²¡æœ‰ç›´æ¥å…³ç³»ï¼Œæš‚ä¸”ä¸å±•å¼€ã€‚</p><p>åˆ†æå®Œäº†è¿™ä¸ªé•¿è¿æ¥çš„é€»è¾‘ï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸ªé—®é¢˜ï¼šbinlog é‡Œé¢åˆ°åº•æ˜¯ä»€ä¹ˆå†…å®¹ï¼Œä¸ºä»€ä¹ˆå¤‡åº“æ‹¿è¿‡å»å¯ä»¥ç›´æ¥æ‰§è¡Œã€‚</p><h4 id="binlog-çš„ä¸‰ç§æ ¼å¼å¯¹æ¯”" tabindex="-1"><a class="header-anchor" href="#binlog-çš„ä¸‰ç§æ ¼å¼å¯¹æ¯”" aria-hidden="true">#</a> binlog çš„ä¸‰ç§æ ¼å¼å¯¹æ¯”</h4><p>æˆ‘åœ¨[ç¬¬ 15 ç¯‡ç­”ç–‘æ–‡ç« ]ä¸­ï¼Œå’Œä½ æåˆ°è¿‡ binlog æœ‰ä¸¤ç§æ ¼å¼ï¼Œä¸€ç§æ˜¯ statementï¼Œä¸€ç§æ˜¯ rowã€‚å¯èƒ½ä½ åœ¨å…¶ä»–èµ„æ–™ä¸Šè¿˜ä¼šçœ‹åˆ°æœ‰ç¬¬ä¸‰ç§æ ¼å¼ï¼Œå«ä½œ mixedï¼Œå…¶å®å®ƒå°±æ˜¯å‰ä¸¤ç§æ ¼å¼çš„æ··åˆã€‚</p><p>ä¸ºäº†ä¾¿äºæè¿° binlog çš„è¿™ä¸‰ç§æ ¼å¼é—´çš„åŒºåˆ«ï¼Œæˆ‘åˆ›å»ºäº†ä¸€ä¸ªè¡¨ï¼Œå¹¶åˆå§‹åŒ–å‡ è¡Œæ•°æ®ã€‚</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>t<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>a<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>t_modified<span class="token punctuation">`</span></span> <span class="token keyword">timestamp</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>a<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>a<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>t_modified<span class="token punctuation">`</span></span><span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>t_modified<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span><span class="token punctuation">;</span> 
<span class="token keyword">insert</span> <span class="token keyword">into</span> t <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&#39;2018-11-13&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> t <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">&#39;2018-11-12&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> t <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">&#39;2018-11-11&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> t <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token string">&#39;2018-11-10&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> t <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token string">&#39;2018-11-09&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœè¦åœ¨è¡¨ä¸­åˆ é™¤ä¸€è¡Œæ•°æ®çš„è¯ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ª delete è¯­å¥çš„ binlog æ˜¯æ€ä¹ˆè®°å½•çš„ã€‚</p><p>æ³¨æ„ï¼Œä¸‹é¢è¿™ä¸ªè¯­å¥åŒ…å«æ³¨é‡Šï¼Œå¦‚æœä½ ç”¨ MySQL å®¢æˆ·ç«¯æ¥åšè¿™ä¸ªå®éªŒçš„è¯ï¼Œè¦è®°å¾—åŠ  -c å‚æ•°ï¼Œå¦åˆ™å®¢æˆ·ç«¯ä¼šè‡ªåŠ¨å»æ‰æ³¨é‡Šã€‚</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">delete</span> <span class="token keyword">from</span> t <span class="token comment">/*comment*/</span>  <span class="token keyword">where</span> a<span class="token operator">&gt;=</span><span class="token number">4</span> <span class="token operator">and</span> t_modified<span class="token operator">&lt;=</span><span class="token string">&#39;2018-11-10&#39;</span> <span class="token keyword">limit</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å½“ binlog_format=statement æ—¶ï¼Œbinlog é‡Œé¢è®°å½•çš„å°±æ˜¯ SQL è¯­å¥çš„åŸæ–‡ã€‚ä½ å¯ä»¥ç”¨</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysql<span class="token operator">&gt;</span> show binlog events <span class="token keyword">in</span> <span class="token string">&#39;master.000001&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å‘½ä»¤çœ‹ binlog ä¸­çš„å†…å®¹ã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/b9818f73cd7d38a96ddcb75350b52931-1584367397413.png" alt="img"></p><p>å›¾ 3 statement æ ¼å¼ binlog ç¤ºä¾‹</p><p>ç°åœ¨ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å›¾ 3 çš„è¾“å‡ºç»“æœã€‚</p><ul><li>ç¬¬ä¸€è¡Œ SET @@SESSION.GTID_NEXT=&#39;ANONYMOUSâ€™ä½ å¯ä»¥å…ˆå¿½ç•¥ï¼Œåé¢æ–‡ç« æˆ‘ä»¬ä¼šåœ¨ä»‹ç»ä¸»å¤‡åˆ‡æ¢çš„æ—¶å€™å†æåˆ°ï¼›</li><li>ç¬¬äºŒè¡Œæ˜¯ä¸€ä¸ª BEGINï¼Œè·Ÿç¬¬å››è¡Œçš„ commit å¯¹åº”ï¼Œè¡¨ç¤ºä¸­é—´æ˜¯ä¸€ä¸ªäº‹åŠ¡ï¼›</li><li>ç¬¬ä¸‰è¡Œå°±æ˜¯çœŸå®æ‰§è¡Œçš„è¯­å¥äº†ã€‚å¯ä»¥çœ‹åˆ°ï¼Œåœ¨çœŸå®æ‰§è¡Œçš„ delete å‘½ä»¤ä¹‹å‰ï¼Œè¿˜æœ‰ä¸€ä¸ªâ€œuse â€˜testâ€™â€å‘½ä»¤ã€‚è¿™æ¡å‘½ä»¤ä¸æ˜¯æˆ‘ä»¬ä¸»åŠ¨æ‰§è¡Œçš„ï¼Œè€Œæ˜¯ MySQL æ ¹æ®å½“å‰è¦æ“ä½œçš„è¡¨æ‰€åœ¨çš„æ•°æ®åº“ï¼Œè‡ªè¡Œæ·»åŠ çš„ã€‚è¿™æ ·åšå¯ä»¥ä¿è¯æ—¥å¿—ä¼ åˆ°å¤‡åº“å»æ‰§è¡Œçš„æ—¶å€™ï¼Œä¸è®ºå½“å‰çš„å·¥ä½œçº¿ç¨‹åœ¨å“ªä¸ªåº“é‡Œï¼Œéƒ½èƒ½å¤Ÿæ­£ç¡®åœ°æ›´æ–°åˆ° test åº“çš„è¡¨ tã€‚ use &#39;testâ€™å‘½ä»¤ä¹‹åçš„ delete è¯­å¥ï¼Œå°±æ˜¯æˆ‘ä»¬è¾“å…¥çš„ SQL åŸæ–‡äº†ã€‚å¯ä»¥çœ‹åˆ°ï¼Œbinlogâ€œå¿ å®â€åœ°è®°å½•äº† SQL å‘½ä»¤ï¼Œç”šè‡³è¿æ³¨é‡Šä¹Ÿä¸€å¹¶è®°å½•äº†ã€‚</li><li>æœ€åä¸€è¡Œæ˜¯ä¸€ä¸ª COMMITã€‚ä½ å¯ä»¥çœ‹åˆ°é‡Œé¢å†™ç€ xid=61ã€‚ä½ è¿˜è®°å¾—è¿™ä¸ª XID æ˜¯åšä»€ä¹ˆç”¨çš„å—ï¼Ÿå¦‚æœè®°å¿†æ¨¡ç³Šäº†ï¼Œå¯ä»¥å†å›é¡¾ä¸€ä¸‹[ç¬¬ 15 ç¯‡æ–‡ç« ]ä¸­çš„ç›¸å…³å†…å®¹ã€‚</li></ul><p>ä¸ºäº†è¯´æ˜ statement å’Œ row æ ¼å¼çš„åŒºåˆ«ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¿™æ¡ delete å‘½ä»¤çš„æ‰§è¡Œæ•ˆæœå›¾ï¼š</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/96c2be9c0fcbff66883118526b26652b-1584367397421.png" alt="img"></p><p>å›¾ 4 delete æ‰§è¡Œ warnings</p><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿è¡Œè¿™æ¡ delete å‘½ä»¤äº§ç”Ÿäº†ä¸€ä¸ª warningï¼ŒåŸå› æ˜¯å½“å‰ binlog è®¾ç½®çš„æ˜¯ statement æ ¼å¼ï¼Œå¹¶ä¸”è¯­å¥ä¸­æœ‰ limitï¼Œæ‰€ä»¥è¿™ä¸ªå‘½ä»¤å¯èƒ½æ˜¯ unsafe çš„ã€‚</p><p>ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Ÿè¿™æ˜¯å› ä¸º delete å¸¦ limitï¼Œå¾ˆå¯èƒ½ä¼šå‡ºç°ä¸»å¤‡æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µã€‚æ¯”å¦‚ä¸Šé¢è¿™ä¸ªä¾‹å­ï¼š</p><ol><li>å¦‚æœ delete è¯­å¥ä½¿ç”¨çš„æ˜¯ç´¢å¼• aï¼Œé‚£ä¹ˆä¼šæ ¹æ®ç´¢å¼• a æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„è¡Œï¼Œä¹Ÿå°±æ˜¯è¯´åˆ é™¤çš„æ˜¯ a=4 è¿™ä¸€è¡Œï¼›</li><li>ä½†å¦‚æœä½¿ç”¨çš„æ˜¯ç´¢å¼• t_modifiedï¼Œé‚£ä¹ˆåˆ é™¤çš„å°±æ˜¯ t_modified=&#39;2018-11-09â€™ä¹Ÿå°±æ˜¯ a=5 è¿™ä¸€è¡Œã€‚</li></ol><p>ç”±äº statement æ ¼å¼ä¸‹ï¼Œè®°å½•åˆ° binlog é‡Œçš„æ˜¯è¯­å¥åŸæ–‡ï¼Œå› æ­¤å¯èƒ½ä¼šå‡ºç°è¿™æ ·ä¸€ç§æƒ…å†µï¼šåœ¨ä¸»åº“æ‰§è¡Œè¿™æ¡ SQL è¯­å¥çš„æ—¶å€™ï¼Œç”¨çš„æ˜¯ç´¢å¼• aï¼›è€Œåœ¨å¤‡åº“æ‰§è¡Œè¿™æ¡ SQL è¯­å¥çš„æ—¶å€™ï¼Œå´ä½¿ç”¨äº†ç´¢å¼• t_modifiedã€‚å› æ­¤ï¼ŒMySQL è®¤ä¸ºè¿™æ ·å†™æ˜¯æœ‰é£é™©çš„ã€‚</p><p>é‚£ä¹ˆï¼Œå¦‚æœæˆ‘æŠŠ binlog çš„æ ¼å¼æ”¹ä¸º binlog_format=â€˜rowâ€™ï¼Œ æ˜¯ä¸æ˜¯å°±æ²¡æœ‰è¿™ä¸ªé—®é¢˜äº†å‘¢ï¼Ÿæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹è¿™æ—¶å€™ binog ä¸­çš„å†…å®¹å§ã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/d67a38db154afff610ae3bb64e266826-1584367389320.png" alt="img"></p><p>å›¾ 5 row æ ¼å¼ binlog ç¤ºä¾‹</p><p>å¯ä»¥çœ‹åˆ°ï¼Œä¸ statement æ ¼å¼çš„ binlog ç›¸æ¯”ï¼Œå‰åçš„ BEGIN å’Œ COMMIT æ˜¯ä¸€æ ·çš„ã€‚ä½†æ˜¯ï¼Œrow æ ¼å¼çš„ binlog é‡Œæ²¡æœ‰äº† SQL è¯­å¥çš„åŸæ–‡ï¼Œè€Œæ˜¯æ›¿æ¢æˆäº†ä¸¤ä¸ª eventï¼šTable_map å’Œ Delete_rowsã€‚</p><ol><li>Table_map eventï¼Œç”¨äºè¯´æ˜æ¥ä¸‹æ¥è¦æ“ä½œçš„è¡¨æ˜¯ test åº“çš„è¡¨ t;</li><li>Delete_rows eventï¼Œç”¨äºå®šä¹‰åˆ é™¤çš„è¡Œä¸ºã€‚</li></ol><p>å…¶å®ï¼Œæˆ‘ä»¬é€šè¿‡å›¾ 5 æ˜¯çœ‹ä¸åˆ°è¯¦ç»†ä¿¡æ¯çš„ï¼Œè¿˜éœ€è¦å€ŸåŠ© mysqlbinlog å·¥å…·ï¼Œç”¨ä¸‹é¢è¿™ä¸ªå‘½ä»¤è§£æå’ŒæŸ¥çœ‹ binlog ä¸­çš„å†…å®¹ã€‚å› ä¸ºå›¾ 5 ä¸­çš„ä¿¡æ¯æ˜¾ç¤ºï¼Œè¿™ä¸ªäº‹åŠ¡çš„ binlog æ˜¯ä» 8900 è¿™ä¸ªä½ç½®å¼€å§‹çš„ï¼Œæ‰€ä»¥å¯ä»¥ç”¨ start-position å‚æ•°æ¥æŒ‡å®šä»è¿™ä¸ªä½ç½®çš„æ—¥å¿—å¼€å§‹è§£æã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysqlbinlog  <span class="token parameter variable">-vv</span> data/master.000001 --start-position<span class="token operator">=</span><span class="token number">8900</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/c342cf480d23b05d30a294b114cebfc2-1584367389357.png" alt="img"></p><p>å›¾ 6 row æ ¼å¼ binlog ç¤ºä¾‹çš„è¯¦ç»†ä¿¡æ¯</p><p>ä»è¿™ä¸ªå›¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä»¥ä¸‹å‡ ä¸ªä¿¡æ¯ï¼š</p><ul><li>server id 1ï¼Œè¡¨ç¤ºè¿™ä¸ªäº‹åŠ¡æ˜¯åœ¨ server_id=1 çš„è¿™ä¸ªåº“ä¸Šæ‰§è¡Œçš„ã€‚</li><li>æ¯ä¸ª event éƒ½æœ‰ CRC32 çš„å€¼ï¼Œè¿™æ˜¯å› ä¸ºæˆ‘æŠŠå‚æ•° binlog_checksum è®¾ç½®æˆäº† CRC32ã€‚</li><li>Table_map event è·Ÿåœ¨å›¾ 5 ä¸­çœ‹åˆ°çš„ç›¸åŒï¼Œæ˜¾ç¤ºäº†æ¥ä¸‹æ¥è¦æ‰“å¼€çš„è¡¨ï¼Œmap åˆ°æ•°å­— 226ã€‚ç°åœ¨æˆ‘ä»¬è¿™æ¡ SQL è¯­å¥åªæ“ä½œäº†ä¸€å¼ è¡¨ï¼Œå¦‚æœè¦æ“ä½œå¤šå¼ è¡¨å‘¢ï¼Ÿæ¯ä¸ªè¡¨éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„ Table_map eventã€éƒ½ä¼š map åˆ°ä¸€ä¸ªå•ç‹¬çš„æ•°å­—ï¼Œç”¨äºåŒºåˆ†å¯¹ä¸åŒè¡¨çš„æ“ä½œã€‚</li><li>æˆ‘ä»¬åœ¨ mysqlbinlog çš„å‘½ä»¤ä¸­ï¼Œä½¿ç”¨äº† -vv å‚æ•°æ˜¯ä¸ºäº†æŠŠå†…å®¹éƒ½è§£æå‡ºæ¥ï¼Œæ‰€ä»¥ä»ç»“æœé‡Œé¢å¯ä»¥çœ‹åˆ°å„ä¸ªå­—æ®µçš„å€¼ï¼ˆæ¯”å¦‚ï¼Œ@1=4ã€ @2=4 è¿™äº›å€¼ï¼‰ã€‚</li><li>binlog_row_image çš„é»˜è®¤é…ç½®æ˜¯ FULLï¼Œå› æ­¤ Delete_event é‡Œé¢ï¼ŒåŒ…å«äº†åˆ æ‰çš„è¡Œçš„æ‰€æœ‰å­—æ®µçš„å€¼ã€‚å¦‚æœæŠŠ binlog_row_image è®¾ç½®ä¸º MINIMALï¼Œåˆ™åªä¼šè®°å½•å¿…è¦çš„ä¿¡æ¯ï¼Œåœ¨è¿™ä¸ªä¾‹å­é‡Œï¼Œå°±æ˜¯åªä¼šè®°å½• id=4 è¿™ä¸ªä¿¡æ¯ã€‚</li><li>æœ€åçš„ Xid eventï¼Œç”¨äºè¡¨ç¤ºäº‹åŠ¡è¢«æ­£ç¡®åœ°æäº¤äº†ã€‚</li></ul><p>ä½ å¯ä»¥çœ‹åˆ°ï¼Œå½“ binlog_format ä½¿ç”¨ row æ ¼å¼çš„æ—¶å€™ï¼Œbinlog é‡Œé¢è®°å½•äº†çœŸå®åˆ é™¤è¡Œçš„ä¸»é”® idï¼Œè¿™æ · binlog ä¼ åˆ°å¤‡åº“å»çš„æ—¶å€™ï¼Œå°±è‚¯å®šä¼šåˆ é™¤ id=4 çš„è¡Œï¼Œä¸ä¼šæœ‰ä¸»å¤‡åˆ é™¤ä¸åŒè¡Œçš„é—®é¢˜ã€‚</p><h4 id="ä¸ºä»€ä¹ˆä¼šæœ‰-mixed-æ ¼å¼çš„-binlog" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆä¼šæœ‰-mixed-æ ¼å¼çš„-binlog" aria-hidden="true">#</a> ä¸ºä»€ä¹ˆä¼šæœ‰ mixed æ ¼å¼çš„ binlogï¼Ÿ</h4><p>åŸºäºä¸Šé¢çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬æ¥è®¨è®ºä¸€ä¸ªé—®é¢˜ï¼š**ä¸ºä»€ä¹ˆä¼šæœ‰ mixed è¿™ç§ binlog æ ¼å¼çš„å­˜åœ¨åœºæ™¯ï¼Ÿ**æ¨è®ºè¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><ul><li>å› ä¸ºæœ‰äº› statement æ ¼å¼çš„ binlog å¯èƒ½ä¼šå¯¼è‡´ä¸»å¤‡ä¸ä¸€è‡´ï¼Œæ‰€ä»¥è¦ä½¿ç”¨ row æ ¼å¼ã€‚</li><li>ä½† row æ ¼å¼çš„ç¼ºç‚¹æ˜¯ï¼Œå¾ˆå ç©ºé—´ã€‚æ¯”å¦‚ä½ ç”¨ä¸€ä¸ª delete è¯­å¥åˆ æ‰ 10 ä¸‡è¡Œæ•°æ®ï¼Œç”¨ statement çš„è¯å°±æ˜¯ä¸€ä¸ª SQL è¯­å¥è¢«è®°å½•åˆ° binlog ä¸­ï¼Œå ç”¨å‡ åä¸ªå­—èŠ‚çš„ç©ºé—´ã€‚ä½†å¦‚æœç”¨ row æ ¼å¼çš„ binlogï¼Œå°±è¦æŠŠè¿™ 10 ä¸‡æ¡è®°å½•éƒ½å†™åˆ° binlog ä¸­ã€‚è¿™æ ·åšï¼Œä¸ä»…ä¼šå ç”¨æ›´å¤§çš„ç©ºé—´ï¼ŒåŒæ—¶å†™ binlog ä¹Ÿè¦è€—è´¹ IO èµ„æºï¼Œå½±å“æ‰§è¡Œé€Ÿåº¦ã€‚</li><li>æ‰€ä»¥ï¼ŒMySQL å°±å–äº†ä¸ªæŠ˜ä¸­æ–¹æ¡ˆï¼Œä¹Ÿå°±æ˜¯æœ‰äº† mixed æ ¼å¼çš„ binlogã€‚mixed æ ¼å¼çš„æ„æ€æ˜¯ï¼ŒMySQL è‡ªå·±ä¼šåˆ¤æ–­è¿™æ¡ SQL è¯­å¥æ˜¯å¦å¯èƒ½å¼•èµ·ä¸»å¤‡ä¸ä¸€è‡´ï¼Œå¦‚æœæœ‰å¯èƒ½ï¼Œå°±ç”¨ row æ ¼å¼ï¼Œå¦åˆ™å°±ç”¨ statement æ ¼å¼ã€‚</li></ul><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œmixed æ ¼å¼å¯ä»¥åˆ©ç”¨ statment æ ¼å¼çš„ä¼˜ç‚¹ï¼ŒåŒæ—¶åˆé¿å…äº†æ•°æ®ä¸ä¸€è‡´çš„é£é™©ã€‚</p><p>å› æ­¤ï¼Œå¦‚æœä½ çš„çº¿ä¸Š MySQL è®¾ç½®çš„ binlog æ ¼å¼æ˜¯ statement çš„è¯ï¼Œé‚£åŸºæœ¬ä¸Šå°±å¯ä»¥è®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªä¸åˆç†çš„è®¾ç½®ã€‚ä½ è‡³å°‘åº”è¯¥æŠŠ binlog çš„æ ¼å¼è®¾ç½®ä¸º mixedã€‚</p><p>æ¯”å¦‚æˆ‘ä»¬è¿™ä¸ªä¾‹å­ï¼Œè®¾ç½®ä¸º mixed åï¼Œå°±ä¼šè®°å½•ä¸º row æ ¼å¼ï¼›è€Œå¦‚æœæ‰§è¡Œçš„è¯­å¥å»æ‰ limit 1ï¼Œå°±ä¼šè®°å½•ä¸º statement æ ¼å¼ã€‚</p><p>å½“ç„¶æˆ‘è¦è¯´çš„æ˜¯ï¼Œç°åœ¨è¶Šæ¥è¶Šå¤šçš„åœºæ™¯è¦æ±‚æŠŠ MySQL çš„ binlog æ ¼å¼è®¾ç½®æˆ rowã€‚è¿™ä¹ˆåšçš„ç†ç”±æœ‰å¾ˆå¤šï¼Œæˆ‘æ¥ç»™ä½ ä¸¾ä¸€ä¸ªå¯ä»¥ç›´æ¥çœ‹å‡ºæ¥çš„å¥½å¤„ï¼š<strong>æ¢å¤æ•°æ®</strong>ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±åˆ†åˆ«ä» deleteã€insert å’Œ update è¿™ä¸‰ç§ SQL è¯­å¥çš„è§’åº¦ï¼Œæ¥çœ‹çœ‹æ•°æ®æ¢å¤çš„é—®é¢˜ã€‚</p><p>é€šè¿‡å›¾ 6 ä½ å¯ä»¥çœ‹å‡ºæ¥ï¼Œå³ä½¿æˆ‘æ‰§è¡Œçš„æ˜¯ delete è¯­å¥ï¼Œrow æ ¼å¼çš„ binlog ä¹Ÿä¼šæŠŠè¢«åˆ æ‰çš„è¡Œçš„æ•´è¡Œä¿¡æ¯ä¿å­˜èµ·æ¥ã€‚æ‰€ä»¥ï¼Œå¦‚æœä½ åœ¨æ‰§è¡Œå®Œä¸€æ¡ delete è¯­å¥ä»¥åï¼Œå‘ç°åˆ é”™æ•°æ®äº†ï¼Œå¯ä»¥ç›´æ¥æŠŠ binlog ä¸­è®°å½•çš„ delete è¯­å¥è½¬æˆ insertï¼ŒæŠŠè¢«é”™åˆ çš„æ•°æ®æ’å…¥å›å»å°±å¯ä»¥æ¢å¤äº†ã€‚</p><p>å¦‚æœä½ æ˜¯æ‰§è¡Œé”™äº† insert è¯­å¥å‘¢ï¼Ÿé‚£å°±æ›´ç›´æ¥äº†ã€‚row æ ¼å¼ä¸‹ï¼Œinsert è¯­å¥çš„ binlog é‡Œä¼šè®°å½•æ‰€æœ‰çš„å­—æ®µä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯å¯ä»¥ç”¨æ¥ç²¾ç¡®å®šä½åˆšåˆšè¢«æ’å…¥çš„é‚£ä¸€è¡Œã€‚è¿™æ—¶ï¼Œä½ ç›´æ¥æŠŠ insert è¯­å¥è½¬æˆ delete è¯­å¥ï¼Œåˆ é™¤æ‰è¿™è¢«è¯¯æ’å…¥çš„ä¸€è¡Œæ•°æ®å°±å¯ä»¥äº†ã€‚</p><p>å¦‚æœæ‰§è¡Œçš„æ˜¯ update è¯­å¥çš„è¯ï¼Œbinlog é‡Œé¢ä¼šè®°å½•ä¿®æ”¹å‰æ•´è¡Œçš„æ•°æ®å’Œä¿®æ”¹åçš„æ•´è¡Œæ•°æ®ã€‚æ‰€ä»¥ï¼Œå¦‚æœä½ è¯¯æ‰§è¡Œäº† update è¯­å¥çš„è¯ï¼Œåªéœ€è¦æŠŠè¿™ä¸ª event å‰åçš„ä¸¤è¡Œä¿¡æ¯å¯¹è°ƒä¸€ä¸‹ï¼Œå†å»æ•°æ®åº“é‡Œé¢æ‰§è¡Œï¼Œå°±èƒ½æ¢å¤è¿™ä¸ªæ›´æ–°æ“ä½œäº†ã€‚</p><p>å…¶å®ï¼Œç”± deleteã€insert æˆ–è€… update è¯­å¥å¯¼è‡´çš„æ•°æ®æ“ä½œé”™è¯¯ï¼Œéœ€è¦æ¢å¤åˆ°æ“ä½œä¹‹å‰çŠ¶æ€çš„æƒ…å†µï¼Œä¹Ÿæ—¶æœ‰å‘ç”Ÿã€‚MariaDB çš„<a href="https://mariadb.com/kb/en/library/flashback/" target="_blank" rel="noopener noreferrer">Flashback<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>å·¥å…·å°±æ˜¯åŸºäºä¸Šé¢ä»‹ç»çš„åŸç†æ¥å›æ»šæ•°æ®çš„ã€‚</p><p>è™½ç„¶ mixed æ ¼å¼çš„ binlog ç°åœ¨å·²ç»ç”¨å¾—ä¸å¤šäº†ï¼Œä½†è¿™é‡Œæˆ‘è¿˜æ˜¯è¦å†å€Ÿç”¨ä¸€ä¸‹ mixed æ ¼å¼æ¥è¯´æ˜ä¸€ä¸ªé—®é¢˜ï¼Œæ¥çœ‹ä¸€ä¸‹è¿™æ¡ SQL è¯­å¥ï¼š</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">insert</span> <span class="token keyword">into</span> t <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å¦‚æœæˆ‘ä»¬æŠŠ binlog æ ¼å¼è®¾ç½®ä¸º mixedï¼Œä½ è§‰å¾— MySQL ä¼šæŠŠå®ƒè®°å½•ä¸º row æ ¼å¼è¿˜æ˜¯ statement æ ¼å¼å‘¢ï¼Ÿ</p><p>å…ˆä¸è¦ç€æ€¥è¯´ç»“æœï¼Œæˆ‘ä»¬ä¸€èµ·æ¥çœ‹ä¸€ä¸‹è¿™æ¡è¯­å¥æ‰§è¡Œçš„æ•ˆæœã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/0150301698979255a6f27711c35e9eef-1584367389377.png" alt="img"></p><p>å›¾ 7 mixed æ ¼å¼å’Œ now()</p><p>å¯ä»¥çœ‹åˆ°ï¼ŒMySQL ç”¨çš„å±…ç„¶æ˜¯ statement æ ¼å¼ã€‚ä½ ä¸€å®šä¼šå¥‡æ€ªï¼Œå¦‚æœè¿™ä¸ª binlog è¿‡äº† 1 åˆ†é’Ÿæ‰ä¼ ç»™å¤‡åº“çš„è¯ï¼Œé‚£ä¸»å¤‡çš„æ•°æ®ä¸å°±ä¸ä¸€è‡´äº†å—ï¼Ÿ</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†ç”¨ mysqlbinlog å·¥å…·æ¥çœ‹çœ‹ï¼š</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/1ad3a4c4b9a71955edba5195757dd041-1584367389377.png" alt="img"></p><p>å›¾ 8 TIMESTAMP å‘½ä»¤</p><p>ä»å›¾ä¸­çš„ç»“æœå¯ä»¥çœ‹åˆ°ï¼ŒåŸæ¥ binlog åœ¨è®°å½• event çš„æ—¶å€™ï¼Œå¤šè®°äº†ä¸€æ¡å‘½ä»¤ï¼šSET TIMESTAMP=1546103491ã€‚å®ƒç”¨ SET TIMESTAMP å‘½ä»¤çº¦å®šäº†æ¥ä¸‹æ¥çš„ now() å‡½æ•°çš„è¿”å›æ—¶é—´ã€‚</p><p>å› æ­¤ï¼Œä¸è®ºè¿™ä¸ª binlog æ˜¯ 1 åˆ†é’Ÿä¹‹åè¢«å¤‡åº“æ‰§è¡Œï¼Œè¿˜æ˜¯ 3 å¤©åç”¨æ¥æ¢å¤è¿™ä¸ªåº“çš„å¤‡ä»½ï¼Œè¿™ä¸ª insert è¯­å¥æ’å…¥çš„è¡Œï¼Œå€¼éƒ½æ˜¯å›ºå®šçš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œé€šè¿‡è¿™æ¡ SET TIMESTAMP å‘½ä»¤ï¼ŒMySQL å°±ç¡®ä¿äº†ä¸»å¤‡æ•°æ®çš„ä¸€è‡´æ€§ã€‚</p><p>æˆ‘ä¹‹å‰çœ‹è¿‡æœ‰äººåœ¨é‡æ”¾ binlog æ•°æ®çš„æ—¶å€™ï¼Œæ˜¯è¿™ä¹ˆåšçš„ï¼šç”¨ mysqlbinlog è§£æå‡ºæ—¥å¿—ï¼Œç„¶åæŠŠé‡Œé¢çš„ statement è¯­å¥ç›´æ¥æ‹·è´å‡ºæ¥æ‰§è¡Œã€‚</p><p>ä½ ç°åœ¨çŸ¥é“äº†ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯æœ‰é£é™©çš„ã€‚å› ä¸ºæœ‰äº›è¯­å¥çš„æ‰§è¡Œç»“æœæ˜¯ä¾èµ–äºä¸Šä¸‹æ–‡å‘½ä»¤çš„ï¼Œç›´æ¥æ‰§è¡Œçš„ç»“æœå¾ˆå¯èƒ½æ˜¯é”™è¯¯çš„ã€‚</p><p>æ‰€ä»¥ï¼Œç”¨ binlog æ¥æ¢å¤æ•°æ®çš„æ ‡å‡†åšæ³•æ˜¯ï¼Œç”¨ mysqlbinlog å·¥å…·è§£æå‡ºæ¥ï¼Œç„¶åæŠŠè§£æç»“æœæ•´ä¸ªå‘ç»™ MySQL æ‰§è¡Œã€‚ç±»ä¼¼ä¸‹é¢çš„å‘½ä»¤ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysqlbinlog master.000001  --start-position<span class="token operator">=</span><span class="token number">2738</span> --stop-position<span class="token operator">=</span><span class="token number">2973</span> <span class="token operator">|</span> mysql <span class="token parameter variable">-h127.0.0.1</span> <span class="token parameter variable">-P13000</span> -u<span class="token variable">$user</span> -p<span class="token variable">$pwd</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>è¿™ä¸ªå‘½ä»¤çš„æ„æ€æ˜¯ï¼Œå°† master.000001 æ–‡ä»¶é‡Œé¢ä»ç¬¬ 2738 å­—èŠ‚åˆ°ç¬¬ 2973 å­—èŠ‚ä¸­é—´è¿™æ®µå†…å®¹è§£æå‡ºæ¥ï¼Œæ”¾åˆ° MySQL å»æ‰§è¡Œã€‚</p><h4 id="å¾ªç¯å¤åˆ¶é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#å¾ªç¯å¤åˆ¶é—®é¢˜" aria-hidden="true">#</a> å¾ªç¯å¤åˆ¶é—®é¢˜</h4><p>é€šè¿‡ä¸Šé¢å¯¹ MySQL ä¸­ binlog åŸºæœ¬å†…å®¹çš„ç†è§£ï¼Œä½ ç°åœ¨å¯ä»¥çŸ¥é“ï¼Œbinlog çš„ç‰¹æ€§ç¡®ä¿äº†åœ¨å¤‡åº“æ‰§è¡Œç›¸åŒçš„ binlogï¼Œå¯ä»¥å¾—åˆ°ä¸ä¸»åº“ç›¸åŒçš„çŠ¶æ€ã€‚</p><p>å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºæ­£å¸¸æƒ…å†µä¸‹ä¸»å¤‡çš„æ•°æ®æ˜¯ä¸€è‡´çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå›¾ 1 ä¸­ Aã€B ä¸¤ä¸ªèŠ‚ç‚¹çš„å†…å®¹æ˜¯ä¸€è‡´çš„ã€‚å…¶å®ï¼Œå›¾ 1 ä¸­æˆ‘ç”»çš„æ˜¯ M-S ç»“æ„ï¼Œä½†å®é™…ç”Ÿäº§ä¸Šä½¿ç”¨æ¯”è¾ƒå¤šçš„æ˜¯åŒ M ç»“æ„ï¼Œä¹Ÿå°±æ˜¯å›¾ 9 æ‰€ç¤ºçš„ä¸»å¤‡åˆ‡æ¢æµç¨‹ã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/20ad4e163115198dc6cf372d5116c956-1584367389406.png" alt="img"></p><p>å›¾ 9 MySQL ä¸»å¤‡åˆ‡æ¢æµç¨‹ -- åŒ M ç»“æ„</p><p>å¯¹æ¯”å›¾ 9 å’Œå›¾ 1ï¼Œä½ å¯ä»¥å‘ç°ï¼ŒåŒ M ç»“æ„å’Œ M-S ç»“æ„ï¼Œå…¶å®åŒºåˆ«åªæ˜¯å¤šäº†ä¸€æ¡çº¿ï¼Œå³ï¼šèŠ‚ç‚¹ A å’Œ B ä¹‹é—´æ€»æ˜¯äº’ä¸ºä¸»å¤‡å…³ç³»ã€‚è¿™æ ·åœ¨åˆ‡æ¢çš„æ—¶å€™å°±ä¸ç”¨å†ä¿®æ”¹ä¸»å¤‡å…³ç³»ã€‚</p><p>ä½†æ˜¯ï¼ŒåŒ M ç»“æ„è¿˜æœ‰ä¸€ä¸ªé—®é¢˜éœ€è¦è§£å†³ã€‚</p><p>ä¸šåŠ¡é€»è¾‘åœ¨èŠ‚ç‚¹ A ä¸Šæ›´æ–°äº†ä¸€æ¡è¯­å¥ï¼Œç„¶åå†æŠŠç”Ÿæˆçš„ binlog å‘ç»™èŠ‚ç‚¹ Bï¼ŒèŠ‚ç‚¹ B æ‰§è¡Œå®Œè¿™æ¡æ›´æ–°è¯­å¥åä¹Ÿä¼šç”Ÿæˆ binlogã€‚ï¼ˆæˆ‘å»ºè®®ä½ æŠŠå‚æ•° log_slave_updates è®¾ç½®ä¸º onï¼Œè¡¨ç¤ºå¤‡åº“æ‰§è¡Œ relay log åç”Ÿæˆ binlogï¼‰ã€‚</p><p>é‚£ä¹ˆï¼Œå¦‚æœèŠ‚ç‚¹ A åŒæ—¶æ˜¯èŠ‚ç‚¹ B çš„å¤‡åº“ï¼Œç›¸å½“äºåˆæŠŠèŠ‚ç‚¹ B æ–°ç”Ÿæˆçš„ binlog æ‹¿è¿‡æ¥æ‰§è¡Œäº†ä¸€æ¬¡ï¼Œç„¶åèŠ‚ç‚¹ A å’Œ B é—´ï¼Œä¼šä¸æ–­åœ°å¾ªç¯æ‰§è¡Œè¿™ä¸ªæ›´æ–°è¯­å¥ï¼Œä¹Ÿå°±æ˜¯å¾ªç¯å¤åˆ¶äº†ã€‚è¿™ä¸ªè¦æ€ä¹ˆè§£å†³å‘¢ï¼Ÿ</p><p>ä»ä¸Šé¢çš„å›¾ 6 ä¸­å¯ä»¥çœ‹åˆ°ï¼ŒMySQL åœ¨ binlog ä¸­è®°å½•äº†è¿™ä¸ªå‘½ä»¤ç¬¬ä¸€æ¬¡æ‰§è¡Œæ—¶æ‰€åœ¨å®ä¾‹çš„ server idã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸‹é¢çš„é€»è¾‘ï¼Œæ¥è§£å†³ä¸¤ä¸ªèŠ‚ç‚¹é—´çš„å¾ªç¯å¤åˆ¶çš„é—®é¢˜ï¼š</p><ol><li>è§„å®šä¸¤ä¸ªåº“çš„ server id å¿…é¡»ä¸åŒï¼Œå¦‚æœç›¸åŒï¼Œåˆ™å®ƒä»¬ä¹‹é—´ä¸èƒ½è®¾å®šä¸ºä¸»å¤‡å…³ç³»ï¼›</li><li>ä¸€ä¸ªå¤‡åº“æ¥åˆ° binlog å¹¶åœ¨é‡æ”¾çš„è¿‡ç¨‹ä¸­ï¼Œç”Ÿæˆä¸åŸ binlog çš„ server id ç›¸åŒçš„æ–°çš„ binlogï¼›</li><li>æ¯ä¸ªåº“åœ¨æ”¶åˆ°ä»è‡ªå·±çš„ä¸»åº“å‘è¿‡æ¥çš„æ—¥å¿—åï¼Œå…ˆåˆ¤æ–­ server idï¼Œå¦‚æœè·Ÿè‡ªå·±çš„ç›¸åŒï¼Œè¡¨ç¤ºè¿™ä¸ªæ—¥å¿—æ˜¯è‡ªå·±ç”Ÿæˆçš„ï¼Œå°±ç›´æ¥ä¸¢å¼ƒè¿™ä¸ªæ—¥å¿—ã€‚</li></ol><p>æŒ‰ç…§è¿™ä¸ªé€»è¾‘ï¼Œå¦‚æœæˆ‘ä»¬è®¾ç½®äº†åŒ M ç»“æ„ï¼Œæ—¥å¿—çš„æ‰§è¡Œæµå°±ä¼šå˜æˆè¿™æ ·ï¼š</p><ol><li>ä»èŠ‚ç‚¹ A æ›´æ–°çš„äº‹åŠ¡ï¼Œbinlog é‡Œé¢è®°çš„éƒ½æ˜¯ A çš„ server idï¼›</li><li>ä¼ åˆ°èŠ‚ç‚¹ B æ‰§è¡Œä¸€æ¬¡ä»¥åï¼ŒèŠ‚ç‚¹ B ç”Ÿæˆçš„ binlog çš„ server id ä¹Ÿæ˜¯ A çš„ server idï¼›</li><li>å†ä¼ å›ç»™èŠ‚ç‚¹ Aï¼ŒA åˆ¤æ–­åˆ°è¿™ä¸ª server id ä¸è‡ªå·±çš„ç›¸åŒï¼Œå°±ä¸ä¼šå†å¤„ç†è¿™ä¸ªæ—¥å¿—ã€‚æ‰€ä»¥ï¼Œæ­»å¾ªç¯åœ¨è¿™é‡Œå°±æ–­æ‰äº†ã€‚</li></ol><h4 id="å°ç»“-15" tabindex="-1"><a class="header-anchor" href="#å°ç»“-15" aria-hidden="true">#</a> å°ç»“</h4><p>ä»Šå¤©è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ç»™ä½ ä»‹ç»äº† MySQL binlog çš„æ ¼å¼å’Œä¸€äº›åŸºæœ¬æœºåˆ¶ï¼Œæ˜¯åé¢æˆ‘è¦ä»‹ç»çš„è¯»å†™åˆ†ç¦»ç­‰ç³»åˆ—æ–‡ç« çš„èƒŒæ™¯çŸ¥è¯†ï¼Œå¸Œæœ›ä½ å¯ä»¥è®¤çœŸæ¶ˆåŒ–ç†è§£ã€‚</p><p>binlog åœ¨ MySQL çš„å„ç§é«˜å¯ç”¨æ–¹æ¡ˆä¸Šæ‰®æ¼”äº†é‡è¦è§’è‰²ã€‚ä»Šå¤©ä»‹ç»çš„å¯ä»¥è¯´æ˜¯æ‰€æœ‰ MySQL é«˜å¯ç”¨æ–¹æ¡ˆçš„åŸºç¡€ã€‚åœ¨è¿™ä¹‹ä¸Šæ¼”åŒ–å‡ºäº†è¯¸å¦‚å¤šèŠ‚ç‚¹ã€åŠåŒæ­¥ã€MySQL group replication ç­‰ç›¸å¯¹å¤æ‚çš„æ–¹æ¡ˆã€‚</p><p>æˆ‘ä¹Ÿè·Ÿä½ ä»‹ç»äº† MySQL ä¸åŒæ ¼å¼ binlog çš„ä¼˜ç¼ºç‚¹ï¼Œå’Œè®¾è®¡è€…çš„æ€è€ƒã€‚å¸Œæœ›ä½ åœ¨åšç³»ç»Ÿå¼€å‘æ—¶å€™ï¼Œä¹Ÿèƒ½å€Ÿé‰´è¿™äº›è®¾è®¡æ€æƒ³ã€‚</p><p>æœ€åï¼Œæˆ‘ç»™ä½ ç•™ä¸‹ä¸€ä¸ªæ€è€ƒé¢˜å§ã€‚</p><p>è¯´åˆ°å¾ªç¯å¤åˆ¶é—®é¢˜çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¯´ MySQL é€šè¿‡åˆ¤æ–­ server id çš„æ–¹å¼ï¼Œæ–­æ‰æ­»å¾ªç¯ã€‚ä½†æ˜¯ï¼Œè¿™ä¸ªæœºåˆ¶å…¶å®å¹¶ä¸å®Œå¤‡ï¼Œåœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œè¿˜æ˜¯æœ‰å¯èƒ½å‡ºç°æ­»å¾ªç¯ã€‚</p><p>ä½ èƒ½æ„é€ å‡ºä¸€ä¸ªè¿™æ ·çš„åœºæ™¯å—ï¼Ÿåˆåº”è¯¥æ€ä¹ˆè§£å†³å‘¢ï¼Ÿ</p><p>ä½ å¯ä»¥æŠŠä½ çš„è®¾è®¡å’Œåˆ†æå†™åœ¨è¯„è®ºåŒºï¼Œæˆ‘ä¼šåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« è·Ÿä½ è®¨è®ºè¿™ä¸ªé—®é¢˜ã€‚æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚</p><h4 id="ä¸ŠæœŸé—®é¢˜æ—¶é—´-12" tabindex="-1"><a class="header-anchor" href="#ä¸ŠæœŸé—®é¢˜æ—¶é—´-12" aria-hidden="true">#</a> ä¸ŠæœŸé—®é¢˜æ—¶é—´</h4><p>ä¸ŠæœŸæˆ‘ç•™ç»™ä½ çš„é—®é¢˜æ˜¯ï¼Œä½ åœ¨ä»€ä¹ˆæ—¶å€™ä¼šæŠŠçº¿ä¸Šç”Ÿäº§åº“è®¾ç½®æˆâ€œéåŒ 1â€ã€‚æˆ‘ç›®å‰çŸ¥é“çš„åœºæ™¯ï¼Œæœ‰ä»¥ä¸‹è¿™äº›ï¼š</p><ol><li>ä¸šåŠ¡é«˜å³°æœŸã€‚ä¸€èˆ¬å¦‚æœæœ‰é¢„çŸ¥çš„é«˜å³°æœŸï¼ŒDBA ä¼šæœ‰é¢„æ¡ˆï¼ŒæŠŠä¸»åº“è®¾ç½®æˆâ€œéåŒ 1â€ã€‚</li><li>å¤‡åº“å»¶è¿Ÿï¼Œä¸ºäº†è®©å¤‡åº“å°½å¿«èµ¶ä¸Šä¸»åº“ã€‚@æ°¸æ’è®°å¿†å’Œ @Second Sight æåˆ°äº†è¿™ä¸ªåœºæ™¯ã€‚</li><li>ç”¨å¤‡ä»½æ¢å¤ä¸»åº“çš„å‰¯æœ¬ï¼Œåº”ç”¨ binlog çš„è¿‡ç¨‹ï¼Œè¿™ä¸ªè·Ÿä¸Šä¸€ç§åœºæ™¯ç±»ä¼¼ã€‚</li><li>æ‰¹é‡å¯¼å…¥æ•°æ®çš„æ—¶å€™ã€‚</li></ol><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒæŠŠç”Ÿäº§åº“æ”¹æˆâ€œéåŒ 1â€é…ç½®ï¼Œæ˜¯è®¾ç½® innodb_flush_logs_at_trx_commit=2ã€sync_binlog=1000ã€‚</p><p>è¯„è®ºåŒºç•™è¨€ç‚¹èµæ¿ï¼š</p><blockquote><p>@way åŒå­¦æåˆ°äº†ä¸€ä¸ªæœ‰è¶£çš„ç°è±¡ï¼Œç”±äºä»åº“è®¾ç½®äº† binlog_group_commit_sync_delay å’Œ binlog_group_commit_sync_no_delay_count å¯¼è‡´ä¸€ç›´å»¶è¿Ÿçš„æƒ…å†µã€‚æˆ‘ä»¬åœ¨ä¸»åº“è®¾ç½®è¿™ä¸¤ä¸ªå‚æ•°ï¼Œæ˜¯ä¸ºäº†å‡å°‘ binlog çš„å†™ç›˜å‹åŠ›ã€‚å¤‡åº“è¿™ä¹ˆè®¾ç½®ï¼Œå°¤å…¶åœ¨â€œå¿«è¦è¿½ä¸Šâ€çš„æ—¶å€™ï¼Œå°±åè€Œä¼šå—è¿™ä¸¤ä¸ªå‚æ•°çš„æ‹–ç´¯ã€‚ä¸€èˆ¬è¿½ä¸»å¤‡å°±ç”¨â€œéåŒ 1â€ï¼ˆè¿½ä¸Šè®°å¾—æ”¹å›æ¥ï¼‰ã€‚</p></blockquote><blockquote><p>@ä¸€å¤§åª åŒå­¦éªŒè¯äº†åœ¨ sync_binlog=0 çš„æƒ…å†µä¸‹ï¼Œè®¾ç½® sync_delay å’Œ sync_no_delay_count çš„ç°è±¡ï¼Œç‚¹èµè¿™ç§å‘ç°è¾¹ç•Œçš„æ„è¯†å’Œæ‰‹åŠ¨éªŒè¯çš„å¥½ä¹ æƒ¯ã€‚æ˜¯è¿™æ ·çš„ï¼šsync_delay å’Œ sync_no_delay_count çš„é€»è¾‘å…ˆèµ°ï¼Œå› æ­¤è¯¥ç­‰è¿˜æ˜¯ä¼šç­‰ã€‚ç­‰åˆ°æ»¡è¶³äº†è¿™ä¸¤ä¸ªæ¡ä»¶ä¹‹ä¸€ï¼Œå°±è¿›å…¥ sync_binlog é˜¶æ®µã€‚è¿™æ—¶å€™å¦‚æœåˆ¤æ–­ sync_binlog=0ï¼Œå°±ç›´æ¥è·³è¿‡ï¼Œè¿˜æ˜¯ä¸è°ƒ fsyncã€‚</p></blockquote><blockquote><p>@é”…å­ åŒå­¦æåˆ°ï¼Œè®¾ç½® sync_binlog=0 çš„æ—¶å€™ï¼Œè¿˜æ˜¯å¯ä»¥çœ‹åˆ° binlog æ–‡ä»¶é©¬ä¸Šåšäº†ä¿®æ”¹ã€‚è¿™ä¸ªæ˜¯å¯¹çš„ï¼Œæˆ‘ä»¬è¯´â€œå†™åˆ°äº† page cacheâ€ï¼Œå°±æ˜¯æ–‡ä»¶ç³»ç»Ÿçš„ page cacheã€‚è€Œä½ ç”¨ ls å‘½ä»¤çœ‹åˆ°çš„å°±æ˜¯æ–‡ä»¶ç³»ç»Ÿè¿”å›çš„ç»“æœã€‚</p></blockquote><h3 id="_25-mysqlæ˜¯æ€ä¹ˆä¿è¯é«˜å¯ç”¨çš„" tabindex="-1"><a class="header-anchor" href="#_25-mysqlæ˜¯æ€ä¹ˆä¿è¯é«˜å¯ç”¨çš„" aria-hidden="true">#</a> 25 MySQLæ˜¯æ€ä¹ˆä¿è¯é«˜å¯ç”¨çš„ï¼Ÿ</h3><p>åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å’Œä½ ä»‹ç»äº† binlog çš„åŸºæœ¬å†…å®¹ï¼Œåœ¨ä¸€ä¸ªä¸»å¤‡å…³ç³»ä¸­ï¼Œæ¯ä¸ªå¤‡åº“æ¥æ”¶ä¸»åº“çš„ binlog å¹¶æ‰§è¡Œã€‚</p><p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œåªè¦ä¸»åº“æ‰§è¡Œæ›´æ–°ç”Ÿæˆçš„æ‰€æœ‰ binlogï¼Œéƒ½å¯ä»¥ä¼ åˆ°å¤‡åº“å¹¶è¢«æ­£ç¡®åœ°æ‰§è¡Œï¼Œå¤‡åº“å°±èƒ½è¾¾åˆ°è·Ÿä¸»åº“ä¸€è‡´çš„çŠ¶æ€ï¼Œè¿™å°±æ˜¯æœ€ç»ˆä¸€è‡´æ€§ã€‚</p><p>ä½†æ˜¯ï¼ŒMySQL è¦æä¾›é«˜å¯ç”¨èƒ½åŠ›ï¼Œåªæœ‰æœ€ç»ˆä¸€è‡´æ€§æ˜¯ä¸å¤Ÿçš„ã€‚ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Ÿä»Šå¤©æˆ‘å°±ç€é‡å’Œä½ åˆ†æä¸€ä¸‹ã€‚</p><p>è¿™é‡Œï¼Œæˆ‘å†æ”¾ä¸€æ¬¡ä¸Šä¸€ç¯‡æ–‡ç« ä¸­è®²åˆ°çš„åŒ M ç»“æ„çš„ä¸»å¤‡åˆ‡æ¢æµç¨‹å›¾ã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/89290bbcf454ff9a3dc5de42a85a69cc-1584367397421.png" alt="img"></p><p>å›¾ 1 MySQL ä¸»å¤‡åˆ‡æ¢æµç¨‹ -- åŒ M ç»“æ„</p><h4 id="ä¸»å¤‡å»¶è¿Ÿ" tabindex="-1"><a class="header-anchor" href="#ä¸»å¤‡å»¶è¿Ÿ" aria-hidden="true">#</a> ä¸»å¤‡å»¶è¿Ÿ</h4><p>ä¸»å¤‡åˆ‡æ¢å¯èƒ½æ˜¯ä¸€ä¸ªä¸»åŠ¨è¿ç»´åŠ¨ä½œï¼Œæ¯”å¦‚è½¯ä»¶å‡çº§ã€ä¸»åº“æ‰€åœ¨æœºå™¨æŒ‰è®¡åˆ’ä¸‹çº¿ç­‰ï¼Œä¹Ÿå¯èƒ½æ˜¯è¢«åŠ¨æ“ä½œï¼Œæ¯”å¦‚ä¸»åº“æ‰€åœ¨æœºå™¨æ‰ç”µã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å…ˆä¸€èµ·çœ‹çœ‹ä¸»åŠ¨åˆ‡æ¢çš„åœºæ™¯ã€‚</p><p>åœ¨ä»‹ç»ä¸»åŠ¨åˆ‡æ¢æµç¨‹çš„è¯¦ç»†æ­¥éª¤ä¹‹å‰ï¼Œæˆ‘è¦å…ˆè·Ÿä½ è¯´æ˜ä¸€ä¸ªæ¦‚å¿µï¼Œå³â€œåŒæ­¥å»¶è¿Ÿâ€ã€‚ä¸æ•°æ®åŒæ­¥æœ‰å…³çš„æ—¶é—´ç‚¹ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹ä¸‰ä¸ªï¼š</p><ol><li>ä¸»åº“ A æ‰§è¡Œå®Œæˆä¸€ä¸ªäº‹åŠ¡ï¼Œå†™å…¥ binlogï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªæ—¶åˆ»è®°ä¸º T1;</li><li>ä¹‹åä¼ ç»™å¤‡åº“ Bï¼Œæˆ‘ä»¬æŠŠå¤‡åº“ B æ¥æ”¶å®Œè¿™ä¸ª binlog çš„æ—¶åˆ»è®°ä¸º T2;</li><li>å¤‡åº“ B æ‰§è¡Œå®Œæˆè¿™ä¸ªäº‹åŠ¡ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªæ—¶åˆ»è®°ä¸º T3ã€‚</li></ol><p>æ‰€è°“ä¸»å¤‡å»¶è¿Ÿï¼Œå°±æ˜¯åŒä¸€ä¸ªäº‹åŠ¡ï¼Œåœ¨å¤‡åº“æ‰§è¡Œå®Œæˆçš„æ—¶é—´å’Œä¸»åº“æ‰§è¡Œå®Œæˆçš„æ—¶é—´ä¹‹é—´çš„å·®å€¼ï¼Œä¹Ÿå°±æ˜¯ T3-T1ã€‚</p><p>ä½ å¯ä»¥åœ¨å¤‡åº“ä¸Šæ‰§è¡Œ show slave status å‘½ä»¤ï¼Œå®ƒçš„è¿”å›ç»“æœé‡Œé¢ä¼šæ˜¾ç¤º seconds_behind_masterï¼Œç”¨äºè¡¨ç¤ºå½“å‰å¤‡åº“å»¶è¿Ÿäº†å¤šå°‘ç§’ã€‚</p><p>seconds_behind_master çš„è®¡ç®—æ–¹æ³•æ˜¯è¿™æ ·çš„ï¼š</p><ol><li>æ¯ä¸ªäº‹åŠ¡çš„ binlog é‡Œé¢éƒ½æœ‰ä¸€ä¸ªæ—¶é—´å­—æ®µï¼Œç”¨äºè®°å½•ä¸»åº“ä¸Šå†™å…¥çš„æ—¶é—´ï¼›</li><li>å¤‡åº“å–å‡ºå½“å‰æ­£åœ¨æ‰§è¡Œçš„äº‹åŠ¡çš„æ—¶é—´å­—æ®µçš„å€¼ï¼Œè®¡ç®—å®ƒä¸å½“å‰ç³»ç»Ÿæ—¶é—´çš„å·®å€¼ï¼Œå¾—åˆ° seconds_behind_masterã€‚</li></ol><p>å¯ä»¥çœ‹åˆ°ï¼Œå…¶å® seconds_behind_master è¿™ä¸ªå‚æ•°è®¡ç®—çš„å°±æ˜¯ T3-T1ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ seconds_behind_master æ¥ä½œä¸ºä¸»å¤‡å»¶è¿Ÿçš„å€¼ï¼Œè¿™ä¸ªå€¼çš„æ—¶é—´ç²¾åº¦æ˜¯ç§’ã€‚</p><p>ä½ å¯èƒ½ä¼šé—®ï¼Œå¦‚æœä¸»å¤‡åº“æœºå™¨çš„ç³»ç»Ÿæ—¶é—´è®¾ç½®ä¸ä¸€è‡´ï¼Œä¼šä¸ä¼šå¯¼è‡´ä¸»å¤‡å»¶è¿Ÿçš„å€¼ä¸å‡†ï¼Ÿ</p><p>å…¶å®ä¸ä¼šçš„ã€‚å› ä¸ºï¼Œå¤‡åº“è¿æ¥åˆ°ä¸»åº“çš„æ—¶å€™ï¼Œä¼šé€šè¿‡æ‰§è¡Œ SELECT UNIX_TIMESTAMP() å‡½æ•°æ¥è·å¾—å½“å‰ä¸»åº“çš„ç³»ç»Ÿæ—¶é—´ã€‚å¦‚æœè¿™æ—¶å€™å‘ç°ä¸»åº“çš„ç³»ç»Ÿæ—¶é—´ä¸è‡ªå·±ä¸ä¸€è‡´ï¼Œå¤‡åº“åœ¨æ‰§è¡Œ seconds_behind_master è®¡ç®—çš„æ—¶å€™ä¼šè‡ªåŠ¨æ‰£æ‰è¿™ä¸ªå·®å€¼ã€‚</p><p>éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œåœ¨ç½‘ç»œæ­£å¸¸çš„æ—¶å€™ï¼Œæ—¥å¿—ä»ä¸»åº“ä¼ ç»™å¤‡åº“æ‰€éœ€çš„æ—¶é—´æ˜¯å¾ˆçŸ­çš„ï¼Œå³ T2-T1 çš„å€¼æ˜¯éå¸¸å°çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç½‘ç»œæ­£å¸¸æƒ…å†µä¸‹ï¼Œä¸»å¤‡å»¶è¿Ÿçš„ä¸»è¦æ¥æºæ˜¯å¤‡åº“æ¥æ”¶å®Œ binlog å’Œæ‰§è¡Œå®Œè¿™ä¸ªäº‹åŠ¡ä¹‹é—´çš„æ—¶é—´å·®ã€‚</p><p>æ‰€ä»¥è¯´ï¼Œä¸»å¤‡å»¶è¿Ÿæœ€ç›´æ¥çš„è¡¨ç°æ˜¯ï¼Œå¤‡åº“æ¶ˆè´¹ä¸­è½¬æ—¥å¿—ï¼ˆrelay logï¼‰çš„é€Ÿåº¦ï¼Œæ¯”ä¸»åº“ç”Ÿäº§ binlog çš„é€Ÿåº¦è¦æ…¢ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘å°±å’Œä½ ä¸€èµ·åˆ†æä¸‹ï¼Œè¿™å¯èƒ½æ˜¯ç”±å“ªäº›åŸå› å¯¼è‡´çš„ã€‚</p><h4 id="ä¸»å¤‡å»¶è¿Ÿçš„æ¥æº" tabindex="-1"><a class="header-anchor" href="#ä¸»å¤‡å»¶è¿Ÿçš„æ¥æº" aria-hidden="true">#</a> ä¸»å¤‡å»¶è¿Ÿçš„æ¥æº</h4><p><strong>é¦–å…ˆï¼Œæœ‰äº›éƒ¨ç½²æ¡ä»¶ä¸‹ï¼Œå¤‡åº“æ‰€åœ¨æœºå™¨çš„æ€§èƒ½è¦æ¯”ä¸»åº“æ‰€åœ¨çš„æœºå™¨æ€§èƒ½å·®ã€‚</strong></p><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæœ‰äººè¿™ä¹ˆéƒ¨ç½²æ—¶çš„æƒ³æ³•æ˜¯ï¼Œåæ­£å¤‡åº“æ²¡æœ‰è¯·æ±‚ï¼Œæ‰€ä»¥å¯ä»¥ç”¨å·®ä¸€ç‚¹å„¿çš„æœºå™¨ã€‚æˆ–è€…ï¼Œä»–ä»¬ä¼šæŠŠ 20 ä¸ªä¸»åº“æ”¾åœ¨ 4 å°æœºå™¨ä¸Šï¼Œè€ŒæŠŠå¤‡åº“é›†ä¸­åœ¨ä¸€å°æœºå™¨ä¸Šã€‚</p><p>å…¶å®æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œæ›´æ–°è¯·æ±‚å¯¹ IOPS çš„å‹åŠ›ï¼Œåœ¨ä¸»åº“å’Œå¤‡åº“ä¸Šæ˜¯æ— å·®åˆ«çš„ã€‚æ‰€ä»¥ï¼Œåšè¿™ç§éƒ¨ç½²æ—¶ï¼Œä¸€èˆ¬éƒ½ä¼šå°†å¤‡åº“è®¾ç½®ä¸ºâ€œéåŒ 1â€çš„æ¨¡å¼ã€‚</p><p>ä½†å®é™…ä¸Šï¼Œæ›´æ–°è¿‡ç¨‹ä¸­ä¹Ÿä¼šè§¦å‘å¤§é‡çš„è¯»æ“ä½œã€‚æ‰€ä»¥ï¼Œå½“å¤‡åº“ä¸»æœºä¸Šçš„å¤šä¸ªå¤‡åº“éƒ½åœ¨äº‰æŠ¢èµ„æºçš„æ—¶å€™ï¼Œå°±å¯èƒ½ä¼šå¯¼è‡´ä¸»å¤‡å»¶è¿Ÿäº†ã€‚</p><p>å½“ç„¶ï¼Œè¿™ç§éƒ¨ç½²ç°åœ¨æ¯”è¾ƒå°‘äº†ã€‚å› ä¸ºä¸»å¤‡å¯èƒ½å‘ç”Ÿåˆ‡æ¢ï¼Œå¤‡åº“éšæ—¶å¯èƒ½å˜æˆä¸»åº“ï¼Œæ‰€ä»¥ä¸»å¤‡åº“é€‰ç”¨ç›¸åŒè§„æ ¼çš„æœºå™¨ï¼Œå¹¶ä¸”åšå¯¹ç§°éƒ¨ç½²ï¼Œæ˜¯ç°åœ¨æ¯”è¾ƒå¸¸è§çš„æƒ…å†µã€‚</p><p>è¿½é—® 1ï¼šä½†æ˜¯ï¼Œåšäº†å¯¹ç§°éƒ¨ç½²ä»¥åï¼Œè¿˜å¯èƒ½ä¼šæœ‰å»¶è¿Ÿã€‚è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p><p>è¿™å°±æ˜¯<strong>ç¬¬äºŒç§å¸¸è§çš„å¯èƒ½äº†ï¼Œå³å¤‡åº“çš„å‹åŠ›å¤§</strong>ã€‚ä¸€èˆ¬çš„æƒ³æ³•æ˜¯ï¼Œä¸»åº“æ—¢ç„¶æä¾›äº†å†™èƒ½åŠ›ï¼Œé‚£ä¹ˆå¤‡åº“å¯ä»¥æä¾›ä¸€äº›è¯»èƒ½åŠ›ã€‚æˆ–è€…ä¸€äº›è¿è¥åå°éœ€è¦çš„åˆ†æè¯­å¥ï¼Œä¸èƒ½å½±å“æ­£å¸¸ä¸šåŠ¡ï¼Œæ‰€ä»¥åªèƒ½åœ¨å¤‡åº“ä¸Šè·‘ã€‚</p><p>æˆ‘çœŸå°±è§è¿‡ä¸å°‘è¿™æ ·çš„æƒ…å†µã€‚ç”±äºä¸»åº“ç›´æ¥å½±å“ä¸šåŠ¡ï¼Œå¤§å®¶ä½¿ç”¨èµ·æ¥ä¼šæ¯”è¾ƒå…‹åˆ¶ï¼Œåè€Œå¿½è§†äº†å¤‡åº“çš„å‹åŠ›æ§åˆ¶ã€‚ç»“æœå°±æ˜¯ï¼Œå¤‡åº“ä¸Šçš„æŸ¥è¯¢è€—è´¹äº†å¤§é‡çš„ CPU èµ„æºï¼Œå½±å“äº†åŒæ­¥é€Ÿåº¦ï¼Œé€ æˆä¸»å¤‡å»¶è¿Ÿã€‚</p><p>è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬ä¸€èˆ¬å¯ä»¥è¿™ä¹ˆå¤„ç†ï¼š</p><ol><li>ä¸€ä¸»å¤šä»ã€‚é™¤äº†å¤‡åº“å¤–ï¼Œå¯ä»¥å¤šæ¥å‡ ä¸ªä»åº“ï¼Œè®©è¿™äº›ä»åº“æ¥åˆ†æ‹…è¯»çš„å‹åŠ›ã€‚</li><li>é€šè¿‡ binlog è¾“å‡ºåˆ°å¤–éƒ¨ç³»ç»Ÿï¼Œæ¯”å¦‚ Hadoop è¿™ç±»ç³»ç»Ÿï¼Œè®©å¤–éƒ¨ç³»ç»Ÿæä¾›ç»Ÿè®¡ç±»æŸ¥è¯¢çš„èƒ½åŠ›ã€‚</li></ol><p>å…¶ä¸­ï¼Œä¸€ä¸»å¤šä»çš„æ–¹å¼å¤§éƒ½ä¼šè¢«é‡‡ç”¨ã€‚å› ä¸ºä½œä¸ºæ•°æ®åº“ç³»ç»Ÿï¼Œè¿˜å¿…é¡»ä¿è¯æœ‰å®šæœŸå…¨é‡å¤‡ä»½çš„èƒ½åŠ›ã€‚è€Œä»åº“ï¼Œå°±å¾ˆé€‚åˆç”¨æ¥åšå¤‡ä»½ã€‚</p><blockquote><p>å¤‡æ³¨ï¼šè¿™é‡Œéœ€è¦è¯´æ˜ä¸€ä¸‹ï¼Œä»åº“å’Œå¤‡åº“åœ¨æ¦‚å¿µä¸Šå…¶å®å·®ä¸å¤šã€‚åœ¨æˆ‘ä»¬è¿™ä¸ªä¸“æ é‡Œï¼Œä¸ºäº†æ–¹ä¾¿æè¿°ï¼Œæˆ‘æŠŠä¼šåœ¨ HA è¿‡ç¨‹ä¸­è¢«é€‰æˆæ–°ä¸»åº“çš„ï¼Œç§°ä¸ºå¤‡åº“ï¼Œå…¶ä»–çš„ç§°ä¸ºä»åº“ã€‚</p></blockquote><p>è¿½é—® 2ï¼šé‡‡ç”¨äº†ä¸€ä¸»å¤šä»ï¼Œä¿è¯å¤‡åº“çš„å‹åŠ›ä¸ä¼šè¶…è¿‡ä¸»åº“ï¼Œè¿˜æœ‰ä»€ä¹ˆæƒ…å†µå¯èƒ½å¯¼è‡´ä¸»å¤‡å»¶è¿Ÿå—ï¼Ÿ</p><p><strong>è¿™å°±æ˜¯ç¬¬ä¸‰ç§å¯èƒ½äº†ï¼Œå³å¤§äº‹åŠ¡ã€‚</strong></p><p>å¤§äº‹åŠ¡è¿™ç§æƒ…å†µå¾ˆå¥½ç†è§£ã€‚å› ä¸ºä¸»åº“ä¸Šå¿…é¡»ç­‰äº‹åŠ¡æ‰§è¡Œå®Œæˆæ‰ä¼šå†™å…¥ binlogï¼Œå†ä¼ ç»™å¤‡åº“ã€‚æ‰€ä»¥ï¼Œå¦‚æœä¸€ä¸ªä¸»åº“ä¸Šçš„è¯­å¥æ‰§è¡Œ 10 åˆ†é’Ÿï¼Œé‚£è¿™ä¸ªäº‹åŠ¡å¾ˆå¯èƒ½å°±ä¼šå¯¼è‡´ä»åº“å»¶è¿Ÿ 10 åˆ†é’Ÿã€‚</p><p>ä¸çŸ¥é“ä½ æ‰€åœ¨å…¬å¸çš„ DBA æœ‰æ²¡æœ‰è·Ÿä½ è¿™ä¹ˆè¯´è¿‡ï¼šä¸è¦<strong>ä¸€æ¬¡æ€§åœ°ç”¨ delete è¯­å¥åˆ é™¤å¤ªå¤šæ•°æ®</strong>ã€‚å…¶å®ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„å¤§äº‹åŠ¡åœºæ™¯ã€‚</p><p>æ¯”å¦‚ï¼Œä¸€äº›å½’æ¡£ç±»çš„æ•°æ®ï¼Œå¹³æ—¶æ²¡æœ‰æ³¨æ„åˆ é™¤å†å²æ•°æ®ï¼Œç­‰åˆ°ç©ºé—´å¿«æ»¡äº†ï¼Œä¸šåŠ¡å¼€å‘äººå‘˜è¦ä¸€æ¬¡æ€§åœ°åˆ æ‰å¤§é‡å†å²æ•°æ®ã€‚åŒæ—¶ï¼Œåˆå› ä¸ºè¦é¿å…åœ¨é«˜å³°æœŸæ“ä½œä¼šå½±å“ä¸šåŠ¡ï¼ˆè‡³å°‘æœ‰è¿™ä¸ªæ„è¯†è¿˜æ˜¯å¾ˆä¸é”™çš„ï¼‰ï¼Œæ‰€ä»¥ä¼šåœ¨æ™šä¸Šæ‰§è¡Œè¿™äº›å¤§é‡æ•°æ®çš„åˆ é™¤æ“ä½œã€‚</p><p>ç»“æœï¼Œè´Ÿè´£çš„ DBA åŒå­¦åŠå¤œå°±ä¼šæ”¶åˆ°å»¶è¿ŸæŠ¥è­¦ã€‚ç„¶åï¼ŒDBA å›¢é˜Ÿå°±è¦æ±‚ä½ åç»­å†åˆ é™¤æ•°æ®çš„æ—¶å€™ï¼Œè¦æ§åˆ¶æ¯ä¸ªäº‹åŠ¡åˆ é™¤çš„æ•°æ®é‡ï¼Œåˆ†æˆå¤šæ¬¡åˆ é™¤ã€‚</p><p>**å¦ä¸€ç§å…¸å‹çš„å¤§äº‹åŠ¡åœºæ™¯ï¼Œå°±æ˜¯å¤§è¡¨ DDLã€‚**è¿™ä¸ªåœºæ™¯ï¼Œæˆ‘åœ¨å‰é¢çš„æ–‡ç« ä¸­ä»‹ç»è¿‡ã€‚å¤„ç†æ–¹æ¡ˆå°±æ˜¯ï¼Œè®¡åˆ’å†…çš„ DDLï¼Œå»ºè®®ä½¿ç”¨ gh-ost æ–¹æ¡ˆï¼ˆè¿™é‡Œï¼Œä½ å¯ä»¥å†å›é¡¾ä¸‹ç¬¬ 13 ç¯‡æ–‡ç« [ã€Šä¸ºä»€ä¹ˆè¡¨æ•°æ®åˆ æ‰ä¸€åŠï¼Œè¡¨æ–‡ä»¶å¤§å°ä¸å˜ï¼Ÿã€‹]ä¸­çš„ç›¸å…³å†…å®¹ï¼‰ã€‚</p><p>è¿½é—® 3ï¼šå¦‚æœä¸»åº“ä¸Šä¹Ÿä¸åšå¤§äº‹åŠ¡äº†ï¼Œè¿˜æœ‰ä»€ä¹ˆåŸå› ä¼šå¯¼è‡´ä¸»å¤‡å»¶è¿Ÿå—ï¼Ÿ</p><p>é€ æˆä¸»å¤‡å»¶è¿Ÿè¿˜æœ‰ä¸€ä¸ªå¤§æ–¹å‘çš„åŸå› ï¼Œå°±æ˜¯<strong>å¤‡åº“çš„å¹¶è¡Œå¤åˆ¶èƒ½åŠ›</strong>ã€‚è¿™ä¸ªè¯é¢˜ï¼Œæˆ‘ä¼šç•™åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« å†å’Œä½ è¯¦ç»†ä»‹ç»ã€‚</p><p>å…¶å®è¿˜æ˜¯æœ‰ä¸å°‘å…¶ä»–æƒ…å†µä¼šå¯¼è‡´ä¸»å¤‡å»¶è¿Ÿï¼Œå¦‚æœä½ è¿˜ç¢°åˆ°è¿‡å…¶ä»–åœºæ™¯ï¼Œæ¬¢è¿ä½ åœ¨è¯„è®ºåŒºç»™æˆ‘ç•™è¨€ï¼Œæˆ‘æ¥å’Œä½ ä¸€èµ·åˆ†æã€è®¨è®ºã€‚</p><p>ç”±äºä¸»å¤‡å»¶è¿Ÿçš„å­˜åœ¨ï¼Œæ‰€ä»¥åœ¨ä¸»å¤‡åˆ‡æ¢çš„æ—¶å€™ï¼Œå°±ç›¸åº”çš„æœ‰ä¸åŒçš„ç­–ç•¥ã€‚</p><h4 id="å¯é æ€§ä¼˜å…ˆç­–ç•¥" tabindex="-1"><a class="header-anchor" href="#å¯é æ€§ä¼˜å…ˆç­–ç•¥" aria-hidden="true">#</a> å¯é æ€§ä¼˜å…ˆç­–ç•¥</h4><p>åœ¨å›¾ 1 çš„åŒ M ç»“æ„ä¸‹ï¼Œä»çŠ¶æ€ 1 åˆ°çŠ¶æ€ 2 åˆ‡æ¢çš„è¯¦ç»†è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><ol><li>åˆ¤æ–­å¤‡åº“ B ç°åœ¨çš„ seconds_behind_masterï¼Œå¦‚æœå°äºæŸä¸ªå€¼ï¼ˆæ¯”å¦‚ 5 ç§’ï¼‰ç»§ç»­ä¸‹ä¸€æ­¥ï¼Œå¦åˆ™æŒç»­é‡è¯•è¿™ä¸€æ­¥ï¼›</li><li>æŠŠä¸»åº“ A æ”¹æˆåªè¯»çŠ¶æ€ï¼Œå³æŠŠ readonly è®¾ç½®ä¸º trueï¼›</li><li>åˆ¤æ–­å¤‡åº“ B çš„ seconds_behind_master çš„å€¼ï¼Œç›´åˆ°è¿™ä¸ªå€¼å˜æˆ 0 ä¸ºæ­¢ï¼›</li><li>æŠŠå¤‡åº“ B æ”¹æˆå¯è¯»å†™çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯æŠŠ readonly è®¾ç½®ä¸º falseï¼›</li><li>æŠŠä¸šåŠ¡è¯·æ±‚åˆ‡åˆ°å¤‡åº“ Bã€‚</li></ol><p>è¿™ä¸ªåˆ‡æ¢æµç¨‹ï¼Œä¸€èˆ¬æ˜¯ç”±ä¸“é—¨çš„ HA ç³»ç»Ÿæ¥å®Œæˆçš„ï¼Œæˆ‘ä»¬æš‚æ—¶ç§°ä¹‹ä¸ºå¯é æ€§ä¼˜å…ˆæµç¨‹ã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/54f4c7c31e6f0f807c2ab77f78c8844a-1584367397422.png" alt="img"></p><p>å›¾ 2 MySQL å¯é æ€§ä¼˜å…ˆä¸»å¤‡åˆ‡æ¢æµç¨‹</p><p>å¤‡æ³¨ï¼šå›¾ä¸­çš„ SBMï¼Œæ˜¯ seconds_behind_master å‚æ•°çš„ç®€å†™ã€‚</p><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªåˆ‡æ¢æµç¨‹ä¸­æ˜¯æœ‰ä¸å¯ç”¨æ—¶é—´çš„ã€‚å› ä¸ºåœ¨æ­¥éª¤ 2 ä¹‹åï¼Œä¸»åº“ A å’Œå¤‡åº“ B éƒ½å¤„äº readonly çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™æ—¶ç³»ç»Ÿå¤„äºä¸å¯å†™çŠ¶æ€ï¼Œç›´åˆ°æ­¥éª¤ 5 å®Œæˆåæ‰èƒ½æ¢å¤ã€‚</p><p>åœ¨è¿™ä¸ªä¸å¯ç”¨çŠ¶æ€ä¸­ï¼Œæ¯”è¾ƒè€—è´¹æ—¶é—´çš„æ˜¯æ­¥éª¤ 3ï¼Œå¯èƒ½éœ€è¦è€—è´¹å¥½å‡ ç§’çš„æ—¶é—´ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆéœ€è¦åœ¨æ­¥éª¤ 1 å…ˆåšåˆ¤æ–­ï¼Œç¡®ä¿ seconds_behind_master çš„å€¼è¶³å¤Ÿå°ã€‚</p><p>è¯•æƒ³å¦‚æœä¸€å¼€å§‹ä¸»å¤‡å»¶è¿Ÿå°±é•¿è¾¾ 30 åˆ†é’Ÿï¼Œè€Œä¸å…ˆåšåˆ¤æ–­ç›´æ¥åˆ‡æ¢çš„è¯ï¼Œç³»ç»Ÿçš„ä¸å¯ç”¨æ—¶é—´å°±ä¼šé•¿è¾¾ 30 åˆ†é’Ÿï¼Œè¿™ç§æƒ…å†µä¸€èˆ¬ä¸šåŠ¡éƒ½æ˜¯ä¸å¯æ¥å—çš„ã€‚</p><p>å½“ç„¶ï¼Œç³»ç»Ÿçš„ä¸å¯ç”¨æ—¶é—´ï¼Œæ˜¯ç”±è¿™ä¸ªæ•°æ®å¯é æ€§ä¼˜å…ˆçš„ç­–ç•¥å†³å®šçš„ã€‚ä½ ä¹Ÿå¯ä»¥é€‰æ‹©å¯ç”¨æ€§ä¼˜å…ˆçš„ç­–ç•¥ï¼Œæ¥æŠŠè¿™ä¸ªä¸å¯ç”¨æ—¶é—´å‡ ä¹é™ä¸º 0ã€‚</p><h4 id="å¯ç”¨æ€§ä¼˜å…ˆç­–ç•¥" tabindex="-1"><a class="header-anchor" href="#å¯ç”¨æ€§ä¼˜å…ˆç­–ç•¥" aria-hidden="true">#</a> å¯ç”¨æ€§ä¼˜å…ˆç­–ç•¥</h4><p>å¦‚æœæˆ‘å¼ºè¡ŒæŠŠæ­¥éª¤ 4ã€5 è°ƒæ•´åˆ°æœ€å¼€å§‹æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯è¯´ä¸ç­‰ä¸»å¤‡æ•°æ®åŒæ­¥ï¼Œç›´æ¥æŠŠè¿æ¥åˆ‡åˆ°å¤‡åº“ Bï¼Œå¹¶ä¸”è®©å¤‡åº“ B å¯ä»¥è¯»å†™ï¼Œé‚£ä¹ˆç³»ç»Ÿå‡ ä¹å°±æ²¡æœ‰ä¸å¯ç”¨æ—¶é—´äº†ã€‚</p><p>æˆ‘ä»¬æŠŠè¿™ä¸ªåˆ‡æ¢æµç¨‹ï¼Œæš‚æ—¶ç§°ä½œå¯ç”¨æ€§ä¼˜å…ˆæµç¨‹ã€‚è¿™ä¸ªåˆ‡æ¢æµç¨‹çš„ä»£ä»·ï¼Œå°±æ˜¯å¯èƒ½å‡ºç°æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘å°±å’Œä½ åˆ†äº«ä¸€ä¸ªå¯ç”¨æ€§ä¼˜å…ˆæµç¨‹äº§ç”Ÿæ•°æ®ä¸ä¸€è‡´çš„ä¾‹å­ã€‚å‡è®¾æœ‰ä¸€ä¸ªè¡¨ tï¼š</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>t<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>c<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span><span class="token punctuation">;</span> 
<span class="token keyword">insert</span> <span class="token keyword">into</span> t<span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªè¡¨å®šä¹‰äº†ä¸€ä¸ªè‡ªå¢ä¸»é”® idï¼Œåˆå§‹åŒ–æ•°æ®åï¼Œä¸»åº“å’Œå¤‡åº“ä¸Šéƒ½æ˜¯ 3 è¡Œæ•°æ®ã€‚æ¥ä¸‹æ¥ï¼Œä¸šåŠ¡äººå‘˜è¦ç»§ç»­åœ¨è¡¨ t ä¸Šæ‰§è¡Œä¸¤æ¡æ’å…¥è¯­å¥çš„å‘½ä»¤ï¼Œä¾æ¬¡æ˜¯ï¼š</p><div class="language-scss line-numbers-mode" data-ext="scss"><pre class="language-scss"><code>insert into <span class="token function">t</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token function">values</span><span class="token punctuation">(</span>4<span class="token punctuation">)</span><span class="token punctuation">;</span>
insert into <span class="token function">t</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token function">values</span><span class="token punctuation">(</span>5<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>å‡è®¾ï¼Œç°åœ¨ä¸»åº“ä¸Šå…¶ä»–çš„æ•°æ®è¡¨æœ‰å¤§é‡çš„æ›´æ–°ï¼Œå¯¼è‡´ä¸»å¤‡å»¶è¿Ÿè¾¾åˆ° 5 ç§’ã€‚åœ¨æ’å…¥ä¸€æ¡ c=4 çš„è¯­å¥åï¼Œå‘èµ·äº†ä¸»å¤‡åˆ‡æ¢ã€‚</p><p>å›¾ 3 æ˜¯<strong>å¯ç”¨æ€§ä¼˜å…ˆç­–ç•¥ï¼Œä¸” binlog_format=mixed</strong>æ—¶çš„åˆ‡æ¢æµç¨‹å’Œæ•°æ®ç»“æœã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/3786bd6ad37faa34aca25bf1a1d8af3a-1584367397423.png" alt="img"></p><p>å›¾ 3 å¯ç”¨æ€§ä¼˜å…ˆç­–ç•¥ï¼Œä¸” binlog_format=mixed</p><p>ç°åœ¨ï¼Œæˆ‘ä»¬ä¸€èµ·åˆ†æä¸‹è¿™ä¸ªåˆ‡æ¢æµç¨‹ï¼š</p><ol><li>æ­¥éª¤ 2 ä¸­ï¼Œä¸»åº“ A æ‰§è¡Œå®Œ insert è¯­å¥ï¼Œæ’å…¥äº†ä¸€è¡Œæ•°æ®ï¼ˆ4,4ï¼‰ï¼Œä¹‹åå¼€å§‹è¿›è¡Œä¸»å¤‡åˆ‡æ¢ã€‚</li><li>æ­¥éª¤ 3 ä¸­ï¼Œç”±äºä¸»å¤‡ä¹‹é—´æœ‰ 5 ç§’çš„å»¶è¿Ÿï¼Œæ‰€ä»¥å¤‡åº“ B è¿˜æ²¡æ¥å¾—åŠåº”ç”¨â€œæ’å…¥ c=4â€è¿™ä¸ªä¸­è½¬æ—¥å¿—ï¼Œå°±å¼€å§‹æ¥æ”¶å®¢æˆ·ç«¯â€œæ’å…¥ c=5â€çš„å‘½ä»¤ã€‚</li><li>æ­¥éª¤ 4 ä¸­ï¼Œå¤‡åº“ B æ’å…¥äº†ä¸€è¡Œæ•°æ®ï¼ˆ4,5ï¼‰ï¼Œå¹¶ä¸”æŠŠè¿™ä¸ª binlog å‘ç»™ä¸»åº“ Aã€‚</li><li>æ­¥éª¤ 5 ä¸­ï¼Œå¤‡åº“ B æ‰§è¡Œâ€œæ’å…¥ c=4â€è¿™ä¸ªä¸­è½¬æ—¥å¿—ï¼Œæ’å…¥äº†ä¸€è¡Œæ•°æ®ï¼ˆ5,4ï¼‰ã€‚è€Œç›´æ¥åœ¨å¤‡åº“ B æ‰§è¡Œçš„â€œæ’å…¥ c=5â€è¿™ä¸ªè¯­å¥ï¼Œä¼ åˆ°ä¸»åº“ Aï¼Œå°±æ’å…¥äº†ä¸€è¡Œæ–°æ•°æ®ï¼ˆ5,5ï¼‰ã€‚</li></ol><p>æœ€åçš„ç»“æœå°±æ˜¯ï¼Œä¸»åº“ A å’Œå¤‡åº“ B ä¸Šå‡ºç°äº†ä¸¤è¡Œä¸ä¸€è‡´çš„æ•°æ®ã€‚å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªæ•°æ®ä¸ä¸€è‡´ï¼Œæ˜¯ç”±å¯ç”¨æ€§ä¼˜å…ˆæµç¨‹å¯¼è‡´çš„ã€‚</p><p>é‚£ä¹ˆï¼Œå¦‚æœæˆ‘è¿˜æ˜¯ç”¨<strong>å¯ç”¨æ€§ä¼˜å…ˆç­–ç•¥ï¼Œä½†è®¾ç½® binlog_format=row</strong>ï¼Œæƒ…å†µåˆä¼šæ€æ ·å‘¢ï¼Ÿ</p><p>å› ä¸º row æ ¼å¼åœ¨è®°å½• binlog çš„æ—¶å€™ï¼Œä¼šè®°å½•æ–°æ’å…¥çš„è¡Œçš„æ‰€æœ‰å­—æ®µå€¼ï¼Œæ‰€ä»¥æœ€ååªä¼šæœ‰ä¸€è¡Œä¸ä¸€è‡´ã€‚è€Œä¸”ï¼Œä¸¤è¾¹çš„ä¸»å¤‡åŒæ­¥çš„åº”ç”¨çº¿ç¨‹ä¼šæŠ¥é”™ duplicate key error å¹¶åœæ­¢ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œå¤‡åº“ B çš„ (5,4) å’Œä¸»åº“ A çš„ (5,5) è¿™ä¸¤è¡Œæ•°æ®ï¼Œéƒ½ä¸ä¼šè¢«å¯¹æ–¹æ‰§è¡Œã€‚</p><p>å›¾ 4 ä¸­æˆ‘ç”»å‡ºäº†è¯¦ç»†è¿‡ç¨‹ï¼Œä½ å¯ä»¥è‡ªå·±å†åˆ†æä¸€ä¸‹ã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/b8d2229b2b40dd087fd3b111d1bdda43-1584367397424.png" alt="img"></p><p>å›¾ 4 å¯ç”¨æ€§ä¼˜å…ˆç­–ç•¥ï¼Œä¸” binlog_format=row</p><p>ä»ä¸Šé¢çš„åˆ†æä¸­ï¼Œä½ å¯ä»¥çœ‹åˆ°ä¸€äº›ç»“è®ºï¼š</p><ol><li>ä½¿ç”¨ row æ ¼å¼çš„ binlog æ—¶ï¼Œæ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜æ›´å®¹æ˜“è¢«å‘ç°ã€‚è€Œä½¿ç”¨ mixed æˆ–è€… statement æ ¼å¼çš„ binlog æ—¶ï¼Œæ•°æ®å¾ˆå¯èƒ½æ‚„æ‚„åœ°å°±ä¸ä¸€è‡´äº†ã€‚å¦‚æœä½ è¿‡äº†å¾ˆä¹…æ‰å‘ç°æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œå¾ˆå¯èƒ½è¿™æ—¶çš„æ•°æ®ä¸ä¸€è‡´å·²ç»ä¸å¯æŸ¥ï¼Œæˆ–è€…è¿å¸¦é€ æˆäº†æ›´å¤šçš„æ•°æ®é€»è¾‘ä¸ä¸€è‡´ã€‚</li><li>ä¸»å¤‡åˆ‡æ¢çš„å¯ç”¨æ€§ä¼˜å…ˆç­–ç•¥ä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´ã€‚å› æ­¤ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘éƒ½å»ºè®®ä½ ä½¿ç”¨å¯é æ€§ä¼˜å…ˆç­–ç•¥ã€‚æ¯•ç«Ÿå¯¹æ•°æ®æœåŠ¡æ¥è¯´çš„è¯ï¼Œæ•°æ®çš„å¯é æ€§ä¸€èˆ¬è¿˜æ˜¯è¦ä¼˜äºå¯ç”¨æ€§çš„ã€‚</li></ol><p>ä½†äº‹æ— ç»å¯¹ï¼Œ<strong>æœ‰æ²¡æœ‰å“ªç§æƒ…å†µæ•°æ®çš„å¯ç”¨æ€§ä¼˜å…ˆçº§æ›´é«˜å‘¢ï¼Ÿ</strong></p><p>ç­”æ¡ˆæ˜¯ï¼Œæœ‰çš„ã€‚</p><p>æˆ‘æ›¾ç»ç¢°åˆ°è¿‡è¿™æ ·çš„ä¸€ä¸ªåœºæ™¯ï¼š</p><ul><li>æœ‰ä¸€ä¸ªåº“çš„ä½œç”¨æ˜¯è®°å½•æ“ä½œæ—¥å¿—ã€‚è¿™æ—¶å€™ï¼Œå¦‚æœæ•°æ®ä¸ä¸€è‡´å¯ä»¥é€šè¿‡ binlog æ¥ä¿®è¡¥ï¼Œè€Œè¿™ä¸ªçŸ­æš‚çš„ä¸ä¸€è‡´ä¹Ÿä¸ä¼šå¼•å‘ä¸šåŠ¡é—®é¢˜ã€‚</li><li>åŒæ—¶ï¼Œä¸šåŠ¡ç³»ç»Ÿä¾èµ–äºè¿™ä¸ªæ—¥å¿—å†™å…¥é€»è¾‘ï¼Œå¦‚æœè¿™ä¸ªåº“ä¸å¯å†™ï¼Œä¼šå¯¼è‡´çº¿ä¸Šçš„ä¸šåŠ¡æ“ä½œæ— æ³•æ‰§è¡Œã€‚</li></ul><p>è¿™æ—¶å€™ï¼Œä½ å¯èƒ½å°±éœ€è¦é€‰æ‹©å…ˆå¼ºè¡Œåˆ‡æ¢ï¼Œäº‹åå†è¡¥æ•°æ®çš„ç­–ç•¥ã€‚</p><p>å½“ç„¶ï¼Œäº‹åå¤ç›˜çš„æ—¶å€™ï¼Œæˆ‘ä»¬æƒ³åˆ°äº†ä¸€ä¸ªæ”¹è¿›æªæ–½å°±æ˜¯ï¼Œè®©ä¸šåŠ¡é€»è¾‘ä¸è¦ä¾èµ–äºè¿™ç±»æ—¥å¿—çš„å†™å…¥ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ—¥å¿—å†™å…¥è¿™ä¸ªé€»è¾‘æ¨¡å—åº”è¯¥å¯ä»¥é™çº§ï¼Œæ¯”å¦‚å†™åˆ°æœ¬åœ°æ–‡ä»¶ï¼Œæˆ–è€…å†™åˆ°å¦å¤–ä¸€ä¸ªä¸´æ—¶åº“é‡Œé¢ã€‚</p><p>è¿™æ ·çš„è¯ï¼Œè¿™ç§åœºæ™¯å°±åˆå¯ä»¥ä½¿ç”¨å¯é æ€§ä¼˜å…ˆç­–ç•¥äº†ã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬å†çœ‹çœ‹ï¼Œ<strong>æŒ‰ç…§å¯é æ€§ä¼˜å…ˆçš„æ€è·¯ï¼Œå¼‚å¸¸åˆ‡æ¢ä¼šæ˜¯ä»€ä¹ˆæ•ˆæœï¼Ÿ</strong></p><p>å‡è®¾ï¼Œä¸»åº“ A å’Œå¤‡åº“ B é—´çš„ä¸»å¤‡å»¶è¿Ÿæ˜¯ 30 åˆ†é’Ÿï¼Œè¿™æ—¶å€™ä¸»åº“ A æ‰ç”µäº†ï¼ŒHA ç³»ç»Ÿè¦åˆ‡æ¢ B ä½œä¸ºä¸»åº“ã€‚æˆ‘ä»¬åœ¨ä¸»åŠ¨åˆ‡æ¢çš„æ—¶å€™ï¼Œå¯ä»¥ç­‰åˆ°ä¸»å¤‡å»¶è¿Ÿå°äº 5 ç§’çš„æ—¶å€™å†å¯åŠ¨åˆ‡æ¢ï¼Œä½†è¿™æ—¶å€™å·²ç»åˆ«æ— é€‰æ‹©äº†ã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/553b7fc2d0dce3ec78bb595e1806eb8b-1584367397425.png" alt="img"></p><p>å›¾ 5 å¯é æ€§ä¼˜å…ˆç­–ç•¥ï¼Œä¸»åº“ä¸å¯ç”¨</p><p>é‡‡ç”¨å¯é æ€§ä¼˜å…ˆç­–ç•¥çš„è¯ï¼Œä½ å°±å¿…é¡»å¾—ç­‰åˆ°å¤‡åº“ B çš„ seconds_behind_master=0 ä¹‹åï¼Œæ‰èƒ½åˆ‡æ¢ã€‚ä½†ç°åœ¨çš„æƒ…å†µæ¯”åˆšåˆšæ›´ä¸¥é‡ï¼Œå¹¶ä¸æ˜¯ç³»ç»Ÿåªè¯»ã€ä¸å¯å†™çš„é—®é¢˜äº†ï¼Œè€Œæ˜¯ç³»ç»Ÿå¤„äºå®Œå…¨ä¸å¯ç”¨çš„çŠ¶æ€ã€‚å› ä¸ºï¼Œä¸»åº“ A æ‰ç”µåï¼Œæˆ‘ä»¬çš„è¿æ¥è¿˜æ²¡æœ‰åˆ‡åˆ°å¤‡åº“ Bã€‚</p><p>ä½ å¯èƒ½ä¼šé—®ï¼Œé‚£èƒ½ä¸èƒ½ç›´æ¥åˆ‡æ¢åˆ°å¤‡åº“ Bï¼Œä½†æ˜¯ä¿æŒ B åªè¯»å‘¢ï¼Ÿ</p><p>è¿™æ ·ä¹Ÿä¸è¡Œã€‚</p><p>å› ä¸ºï¼Œè¿™æ®µæ—¶é—´å†…ï¼Œä¸­è½¬æ—¥å¿—è¿˜æ²¡æœ‰åº”ç”¨å®Œæˆï¼Œå¦‚æœç›´æ¥å‘èµ·ä¸»å¤‡åˆ‡æ¢ï¼Œå®¢æˆ·ç«¯æŸ¥è¯¢çœ‹ä¸åˆ°ä¹‹å‰æ‰§è¡Œå®Œæˆçš„äº‹åŠ¡ï¼Œä¼šè®¤ä¸ºæœ‰â€œæ•°æ®ä¸¢å¤±â€ã€‚</p><p>è™½ç„¶éšç€ä¸­è½¬æ—¥å¿—çš„ç»§ç»­åº”ç”¨ï¼Œè¿™äº›æ•°æ®ä¼šæ¢å¤å›æ¥ï¼Œä½†æ˜¯å¯¹äºä¸€äº›ä¸šåŠ¡æ¥è¯´ï¼ŒæŸ¥è¯¢åˆ°â€œæš‚æ—¶ä¸¢å¤±æ•°æ®çš„çŠ¶æ€â€ä¹Ÿæ˜¯ä¸èƒ½è¢«æ¥å—çš„ã€‚</p><p>èŠåˆ°è¿™é‡Œä½ å°±çŸ¥é“äº†ï¼Œåœ¨æ»¡è¶³æ•°æ®å¯é æ€§çš„å‰æä¸‹ï¼ŒMySQL é«˜å¯ç”¨ç³»ç»Ÿçš„å¯ç”¨æ€§ï¼Œæ˜¯ä¾èµ–äºä¸»å¤‡å»¶è¿Ÿçš„ã€‚å»¶è¿Ÿçš„æ—¶é—´è¶Šå°ï¼Œåœ¨ä¸»åº“æ•…éšœçš„æ—¶å€™ï¼ŒæœåŠ¡æ¢å¤éœ€è¦çš„æ—¶é—´å°±è¶ŠçŸ­ï¼Œå¯ç”¨æ€§å°±è¶Šé«˜ã€‚</p><h4 id="å°ç»“-16" tabindex="-1"><a class="header-anchor" href="#å°ç»“-16" aria-hidden="true">#</a> å°ç»“</h4><p>ä»Šå¤©è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘å…ˆå’Œä½ ä»‹ç»äº† MySQL é«˜å¯ç”¨ç³»ç»Ÿçš„åŸºç¡€ï¼Œå°±æ˜¯ä¸»å¤‡åˆ‡æ¢é€»è¾‘ã€‚ç´§æ¥ç€ï¼Œæˆ‘åˆå’Œä½ è®¨è®ºäº†å‡ ç§ä¼šå¯¼è‡´ä¸»å¤‡å»¶è¿Ÿçš„æƒ…å†µï¼Œä»¥åŠç›¸åº”çš„æ”¹è¿›æ–¹å‘ã€‚</p><p>ç„¶åï¼Œç”±äºä¸»å¤‡å»¶è¿Ÿçš„å­˜åœ¨ï¼Œåˆ‡æ¢ç­–ç•¥å°±æœ‰ä¸åŒçš„é€‰æ‹©ã€‚æ‰€ä»¥ï¼Œæˆ‘åˆå’Œä½ ä¸€èµ·åˆ†æäº†å¯é æ€§ä¼˜å…ˆå’Œå¯ç”¨æ€§ä¼˜å…ˆç­–ç•¥çš„åŒºåˆ«ã€‚</p><p>åœ¨å®é™…çš„åº”ç”¨ä¸­ï¼Œæˆ‘æ›´å»ºè®®ä½¿ç”¨å¯é æ€§ä¼˜å…ˆçš„ç­–ç•¥ã€‚æ¯•ç«Ÿä¿è¯æ•°æ®å‡†ç¡®ï¼Œåº”è¯¥æ˜¯æ•°æ®åº“æœåŠ¡çš„åº•çº¿ã€‚åœ¨è¿™ä¸ªåŸºç¡€ä¸Šï¼Œé€šè¿‡å‡å°‘ä¸»å¤‡å»¶è¿Ÿï¼Œæå‡ç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚</p><p>æœ€åï¼Œæˆ‘ç»™ä½ ç•™ä¸‹ä¸€ä¸ªæ€è€ƒé¢˜å§ã€‚</p><p>ä¸€èˆ¬ç°åœ¨çš„æ•°æ®åº“è¿ç»´ç³»ç»Ÿéƒ½æœ‰å¤‡åº“å»¶è¿Ÿç›‘æ§ï¼Œå…¶å®å°±æ˜¯åœ¨å¤‡åº“ä¸Šæ‰§è¡Œ show slave statusï¼Œé‡‡é›† seconds_behind_master çš„å€¼ã€‚</p><p>å‡è®¾ï¼Œç°åœ¨ä½ çœ‹åˆ°ä½ ç»´æŠ¤çš„ä¸€ä¸ªå¤‡åº“ï¼Œå®ƒçš„å»¶è¿Ÿç›‘æ§çš„å›¾åƒç±»ä¼¼å›¾ 6ï¼Œæ˜¯ä¸€ä¸ª 45Â°æ–œå‘ä¸Šçš„çº¿æ®µï¼Œä½ è§‰å¾—å¯èƒ½æ˜¯ä»€ä¹ˆåŸå› å¯¼è‡´å‘¢ï¼Ÿä½ åˆä¼šæ€ä¹ˆå»ç¡®è®¤è¿™ä¸ªåŸå› å‘¢ï¼Ÿ</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/cf5ea52aa3b26ef56c567125197fa171-1584367398739.png" alt="img"></p><p>å›¾ 6 å¤‡åº“å»¶è¿Ÿ</p><p>ä½ å¯ä»¥æŠŠä½ çš„åˆ†æå†™åœ¨è¯„è®ºåŒºï¼Œæˆ‘ä¼šåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« çš„æœ«å°¾è·Ÿä½ è®¨è®ºè¿™ä¸ªé—®é¢˜ã€‚æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚</p><h4 id="ä¸ŠæœŸé—®é¢˜æ—¶é—´-13" tabindex="-1"><a class="header-anchor" href="#ä¸ŠæœŸé—®é¢˜æ—¶é—´-13" aria-hidden="true">#</a> ä¸ŠæœŸé—®é¢˜æ—¶é—´</h4><p>ä¸ŠæœŸæˆ‘ç•™ç»™ä½ çš„é—®é¢˜æ˜¯ï¼Œä»€ä¹ˆæƒ…å†µä¸‹åŒ M ç»“æ„ä¼šå‡ºç°å¾ªç¯å¤åˆ¶ã€‚</p><p>ä¸€ç§åœºæ™¯æ˜¯ï¼Œåœ¨ä¸€ä¸ªä¸»åº“æ›´æ–°äº‹åŠ¡åï¼Œç”¨å‘½ä»¤ set global server_id=x ä¿®æ”¹äº† server_idã€‚ç­‰æ—¥å¿—å†ä¼ å›æ¥çš„æ—¶å€™ï¼Œå‘ç° server_id è·Ÿè‡ªå·±çš„ server_id ä¸åŒï¼Œå°±åªèƒ½æ‰§è¡Œäº†ã€‚</p><p>å¦ä¸€ç§åœºæ™¯æ˜¯ï¼Œæœ‰ä¸‰ä¸ªèŠ‚ç‚¹çš„æ—¶å€™ï¼Œå¦‚å›¾ 7 æ‰€ç¤ºï¼Œtrx1 æ˜¯åœ¨èŠ‚ç‚¹ B æ‰§è¡Œçš„ï¼Œå› æ­¤ binlog ä¸Šçš„ server_id å°±æ˜¯ Bï¼Œbinlog ä¼ ç»™èŠ‚ç‚¹ Aï¼Œç„¶å A å’Œ Aâ€™æ­å»ºäº†åŒ M ç»“æ„ï¼Œå°±ä¼šå‡ºç°å¾ªç¯å¤åˆ¶ã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/f968192ce2f436c939dd702b8f409771-1584367398746.png" alt="img"></p><p>å›¾ 7 ä¸‰èŠ‚ç‚¹å¾ªç¯å¤åˆ¶</p><p>è¿™ç§ä¸‰èŠ‚ç‚¹å¤åˆ¶çš„åœºæ™¯ï¼Œåšæ•°æ®åº“è¿ç§»çš„æ—¶å€™ä¼šå‡ºç°ã€‚</p><p>å¦‚æœå‡ºç°äº†å¾ªç¯å¤åˆ¶ï¼Œå¯ä»¥åœ¨ A æˆ–è€… Aâ€™ä¸Šï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p><div class="language-vbnet line-numbers-mode" data-ext="vbnet"><pre class="language-vbnet"><code><span class="token keyword">stop</span> slaveï¼›
CHANGE MASTER <span class="token keyword">TO</span> IGNORE_SERVER_IDS<span class="token operator">=</span><span class="token punctuation">(</span>server_id_of_B<span class="token punctuation">)</span><span class="token punctuation">;</span>
start slave<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ ·è¿™ä¸ªèŠ‚ç‚¹æ”¶åˆ°æ—¥å¿—åå°±ä¸ä¼šå†æ‰§è¡Œã€‚è¿‡ä¸€æ®µæ—¶é—´åï¼Œå†æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æŠŠè¿™ä¸ªå€¼æ”¹å›æ¥ã€‚</p><div class="language-vbnet line-numbers-mode" data-ext="vbnet"><pre class="language-vbnet"><code><span class="token keyword">stop</span> slaveï¼›
CHANGE MASTER <span class="token keyword">TO</span> IGNORE_SERVER_IDS<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
start slave<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¯„è®ºåŒºç•™è¨€ç‚¹èµæ¿ï¼š</p><blockquote><p>@ä¸€å¤§åªã€@HuaMax åŒå­¦æåˆ°äº†ç¬¬ä¸€ä¸ªå¤ç°æ–¹æ³•ï¼›</p></blockquote><blockquote><p>@Jonh åŒå­¦æåˆ°äº† IGNORE_SERVER_IDS è¿™ä¸ªè§£å†³æ–¹æ³•ï¼›</p></blockquote><blockquote><p>@React æåˆ°ï¼Œå¦‚æœä¸»å¤‡è®¾ç½®ä¸åŒçš„æ­¥é•¿ï¼Œå¤‡åº“æ˜¯ä¸æ˜¯å¯ä»¥è®¾ç½®ä¸ºå¯è¯»å†™ã€‚æˆ‘çš„å»ºè®®æ˜¯ï¼Œåªè¦è¿™ä¸ªèŠ‚ç‚¹è®¾è®¡å†…å°±ä¸ä¼šæœ‰ä¸šåŠ¡ç›´æ¥åœ¨ä¸Šé¢æ‰§è¡Œæ›´æ–°ï¼Œå°±å»ºè®®è®¾ç½®ä¸º readonlyã€‚</p></blockquote><h3 id="_27-ä¸»åº“å‡ºé—®é¢˜äº†-ä»åº“æ€ä¹ˆåŠ" tabindex="-1"><a class="header-anchor" href="#_27-ä¸»åº“å‡ºé—®é¢˜äº†-ä»åº“æ€ä¹ˆåŠ" aria-hidden="true">#</a> 27 ä¸»åº“å‡ºé—®é¢˜äº†ï¼Œä»åº“æ€ä¹ˆåŠï¼Ÿ</h3><p>åœ¨å‰é¢çš„ç¬¬[24]ã€[25]å’Œ[26]ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å’Œä½ ä»‹ç»äº† MySQL ä¸»å¤‡å¤åˆ¶çš„åŸºç¡€ç»“æ„ï¼Œä½†è¿™äº›éƒ½æ˜¯ä¸€ä¸»ä¸€å¤‡çš„ç»“æ„ã€‚</p><p>å¤§å¤šæ•°çš„äº’è”ç½‘åº”ç”¨åœºæ™¯éƒ½æ˜¯è¯»å¤šå†™å°‘ï¼Œå› æ­¤ä½ è´Ÿè´£çš„ä¸šåŠ¡ï¼Œåœ¨å‘å±•è¿‡ç¨‹ä¸­å¾ˆå¯èƒ½å…ˆä¼šé‡åˆ°è¯»æ€§èƒ½çš„é—®é¢˜ã€‚è€Œåœ¨æ•°æ®åº“å±‚è§£å†³è¯»æ€§èƒ½é—®é¢˜ï¼Œå°±è¦æ¶‰åŠåˆ°æ¥ä¸‹æ¥ä¸¤ç¯‡æ–‡ç« è¦è®¨è®ºçš„æ¶æ„ï¼šä¸€ä¸»å¤šä»ã€‚</p><p>ä»Šå¤©è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬å°±å…ˆèŠèŠä¸€ä¸»å¤šä»çš„åˆ‡æ¢æ­£ç¡®æ€§ã€‚ç„¶åï¼Œæˆ‘ä»¬åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­å†èŠèŠè§£å†³ä¸€ä¸»å¤šä»çš„æŸ¥è¯¢é€»è¾‘æ­£ç¡®æ€§çš„æ–¹æ³•ã€‚</p><p>å¦‚å›¾ 1 æ‰€ç¤ºï¼Œå°±æ˜¯ä¸€ä¸ªåŸºæœ¬çš„ä¸€ä¸»å¤šä»ç»“æ„ã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/aadb3b956d1ffc13ac46515a7d619e79-1584367399405.png" alt="img"></p><p>å›¾ 1 ä¸€ä¸»å¤šä»åŸºæœ¬ç»“æ„</p><p>å›¾ä¸­ï¼Œè™šçº¿ç®­å¤´è¡¨ç¤ºçš„æ˜¯ä¸»å¤‡å…³ç³»ï¼Œä¹Ÿå°±æ˜¯ A å’Œ Aâ€™äº’ä¸ºä¸»å¤‡ï¼Œ ä»åº“ Bã€Cã€D æŒ‡å‘çš„æ˜¯ä¸»åº“ Aã€‚ä¸€ä¸»å¤šä»çš„è®¾ç½®ï¼Œä¸€èˆ¬ç”¨äºè¯»å†™åˆ†ç¦»ï¼Œä¸»åº“è´Ÿè´£æ‰€æœ‰çš„å†™å…¥å’Œä¸€éƒ¨åˆ†è¯»ï¼Œå…¶ä»–çš„è¯»è¯·æ±‚åˆ™ç”±ä»åº“åˆ†æ‹…ã€‚</p><p>ä»Šå¤©æˆ‘ä»¬è¦è®¨è®ºçš„å°±æ˜¯ï¼Œåœ¨ä¸€ä¸»å¤šä»æ¶æ„ä¸‹ï¼Œä¸»åº“æ•…éšœåçš„ä¸»å¤‡åˆ‡æ¢é—®é¢˜ã€‚</p><p>å¦‚å›¾ 2 æ‰€ç¤ºï¼Œå°±æ˜¯ä¸»åº“å‘ç”Ÿæ•…éšœï¼Œä¸»å¤‡åˆ‡æ¢åçš„ç»“æœã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/0014f97423bd75235a9187f492fb2453-1584367399531.png" alt="img"></p><p>å›¾ 2 ä¸€ä¸»å¤šä»åŸºæœ¬ç»“æ„ -- ä¸»å¤‡åˆ‡æ¢</p><p>ç›¸æ¯”äºä¸€ä¸»ä¸€å¤‡çš„åˆ‡æ¢æµç¨‹ï¼Œä¸€ä¸»å¤šä»ç»“æ„åœ¨åˆ‡æ¢å®Œæˆåï¼ŒAâ€™ä¼šæˆä¸ºæ–°çš„ä¸»åº“ï¼Œä»åº“ Bã€Cã€D ä¹Ÿè¦æ”¹æ¥åˆ° Aâ€™ã€‚æ­£æ˜¯ç”±äºå¤šäº†ä»åº“ Bã€Cã€D é‡æ–°æŒ‡å‘çš„è¿™ä¸ªè¿‡ç¨‹ï¼Œæ‰€ä»¥ä¸»å¤‡åˆ‡æ¢çš„å¤æ‚æ€§ä¹Ÿç›¸åº”å¢åŠ äº†ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†ä¸€èµ·çœ‹çœ‹ä¸€ä¸ªåˆ‡æ¢ç³»ç»Ÿä¼šæ€ä¹ˆå®Œæˆä¸€ä¸»å¤šä»çš„ä¸»å¤‡åˆ‡æ¢è¿‡ç¨‹ã€‚</p><h4 id="åŸºäºä½ç‚¹çš„ä¸»å¤‡åˆ‡æ¢" tabindex="-1"><a class="header-anchor" href="#åŸºäºä½ç‚¹çš„ä¸»å¤‡åˆ‡æ¢" aria-hidden="true">#</a> åŸºäºä½ç‚¹çš„ä¸»å¤‡åˆ‡æ¢</h4><p>è¿™é‡Œï¼Œæˆ‘ä»¬éœ€è¦å…ˆæ¥å›é¡¾ä¸€ä¸ªçŸ¥è¯†ç‚¹ã€‚</p><p>å½“æˆ‘ä»¬æŠŠèŠ‚ç‚¹ B è®¾ç½®æˆèŠ‚ç‚¹ Aâ€™çš„ä»åº“çš„æ—¶å€™ï¼Œéœ€è¦æ‰§è¡Œä¸€æ¡ change master å‘½ä»¤ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>CHANGE MASTER TO 
<span class="token assign-left variable">MASTER_HOST</span><span class="token operator">=</span><span class="token variable">$host_name</span> 
<span class="token assign-left variable">MASTER_PORT</span><span class="token operator">=</span><span class="token variable">$port</span> 
<span class="token assign-left variable">MASTER_USER</span><span class="token operator">=</span><span class="token variable">$user_name</span> 
<span class="token assign-left variable">MASTER_PASSWORD</span><span class="token operator">=</span><span class="token variable">$password</span> 
<span class="token assign-left variable">MASTER_LOG_FILE</span><span class="token operator">=</span><span class="token variable">$master_log_name</span> 
<span class="token assign-left variable">MASTER_LOG_POS</span><span class="token operator">=</span><span class="token variable">$master_log_pos</span>  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ¡å‘½ä»¤æœ‰è¿™ä¹ˆ 6 ä¸ªå‚æ•°ï¼š</p><ul><li>MASTER_HOSTã€MASTER_PORTã€MASTER_USER å’Œ MASTER_PASSWORD å››ä¸ªå‚æ•°ï¼Œåˆ†åˆ«ä»£è¡¨äº†ä¸»åº“ Aâ€™çš„ IPã€ç«¯å£ã€ç”¨æˆ·åå’Œå¯†ç ã€‚</li><li>æœ€åä¸¤ä¸ªå‚æ•° MASTER_LOG_FILE å’Œ MASTER_LOG_POS è¡¨ç¤ºï¼Œè¦ä»ä¸»åº“çš„ master_log_name æ–‡ä»¶çš„ master_log_pos è¿™ä¸ªä½ç½®çš„æ—¥å¿—ç»§ç»­åŒæ­¥ã€‚è€Œè¿™ä¸ªä½ç½®å°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„åŒæ­¥ä½ç‚¹ï¼Œä¹Ÿå°±æ˜¯ä¸»åº“å¯¹åº”çš„æ–‡ä»¶åå’Œæ—¥å¿—åç§»é‡ã€‚</li></ul><p>é‚£ä¹ˆï¼Œè¿™é‡Œå°±æœ‰ä¸€ä¸ªé—®é¢˜äº†ï¼ŒèŠ‚ç‚¹ B è¦è®¾ç½®æˆ Aâ€™çš„ä»åº“ï¼Œå°±è¦æ‰§è¡Œ change master å‘½ä»¤ï¼Œå°±ä¸å¯é¿å…åœ°è¦è®¾ç½®ä½ç‚¹çš„è¿™ä¸¤ä¸ªå‚æ•°ï¼Œä½†æ˜¯è¿™ä¸¤ä¸ªå‚æ•°åˆ°åº•åº”è¯¥æ€ä¹ˆè®¾ç½®å‘¢ï¼Ÿ</p><p>åŸæ¥èŠ‚ç‚¹ B æ˜¯ A çš„ä»åº“ï¼Œæœ¬åœ°è®°å½•çš„ä¹Ÿæ˜¯ A çš„ä½ç‚¹ã€‚ä½†æ˜¯ç›¸åŒçš„æ—¥å¿—ï¼ŒA çš„ä½ç‚¹å’Œ Aâ€™çš„ä½ç‚¹æ˜¯ä¸åŒçš„ã€‚å› æ­¤ï¼Œä»åº“ B è¦åˆ‡æ¢çš„æ—¶å€™ï¼Œå°±éœ€è¦å…ˆç»è¿‡â€œæ‰¾åŒæ­¥ä½ç‚¹â€è¿™ä¸ªé€»è¾‘ã€‚</p><p>è¿™ä¸ªä½ç‚¹å¾ˆéš¾ç²¾ç¡®å–åˆ°ï¼Œåªèƒ½å–ä¸€ä¸ªå¤§æ¦‚ä½ç½®ã€‚ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Ÿ</p><p>æˆ‘æ¥å’Œä½ åˆ†æä¸€ä¸‹çœ‹çœ‹è¿™ä¸ªä½ç‚¹ä¸€èˆ¬æ˜¯æ€ä¹ˆè·å–åˆ°çš„ï¼Œä½ å°±æ¸…æ¥šå…¶ä¸­ä¸ç²¾ç¡®çš„åŸå› äº†ã€‚</p><p>è€ƒè™‘åˆ°åˆ‡æ¢è¿‡ç¨‹ä¸­ä¸èƒ½ä¸¢æ•°æ®ï¼Œæ‰€ä»¥æˆ‘ä»¬æ‰¾ä½ç‚¹çš„æ—¶å€™ï¼Œæ€»æ˜¯è¦æ‰¾ä¸€ä¸ªâ€œç¨å¾®å¾€å‰â€çš„ï¼Œç„¶åå†é€šè¿‡åˆ¤æ–­è·³è¿‡é‚£äº›åœ¨ä»åº“ B ä¸Šå·²ç»æ‰§è¡Œè¿‡çš„äº‹åŠ¡ã€‚</p><p>ä¸€ç§å–åŒæ­¥ä½ç‚¹çš„æ–¹æ³•æ˜¯è¿™æ ·çš„ï¼š</p><ol><li>ç­‰å¾…æ–°ä¸»åº“ Aâ€™æŠŠä¸­è½¬æ—¥å¿—ï¼ˆrelay logï¼‰å…¨éƒ¨åŒæ­¥å®Œæˆï¼›</li><li>åœ¨ Aâ€™ä¸Šæ‰§è¡Œ show master status å‘½ä»¤ï¼Œå¾—åˆ°å½“å‰ Aâ€™ä¸Šæœ€æ–°çš„ File å’Œ Positionï¼›</li><li>å–åŸä¸»åº“ A æ•…éšœçš„æ—¶åˆ» Tï¼›</li><li>ç”¨ mysqlbinlog å·¥å…·è§£æ Aâ€™çš„ Fileï¼Œå¾—åˆ° T æ—¶åˆ»çš„ä½ç‚¹ã€‚</li></ol><div class="language-r line-numbers-mode" data-ext="r"><pre class="language-r"><code>mysqlbinlog File <span class="token operator">-</span><span class="token operator">-</span>stop<span class="token operator">-</span>datetime<span class="token operator">=</span>T <span class="token operator">-</span><span class="token operator">-</span>start<span class="token operator">-</span>datetime<span class="token operator">=</span>T
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/3471dfe4aebcccfaec0523a08cdd0ddd-1584367399747.png" alt="img"></p><p>å›¾ 3 mysqlbinlog éƒ¨åˆ†è¾“å‡ºç»“æœ</p><p>å›¾ä¸­ï¼Œend_log_pos åé¢çš„å€¼â€œ123â€ï¼Œè¡¨ç¤ºçš„å°±æ˜¯ Aâ€™è¿™ä¸ªå®ä¾‹ï¼Œåœ¨ T æ—¶åˆ»å†™å…¥æ–°çš„ binlog çš„ä½ç½®ã€‚ç„¶åï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠ 123 è¿™ä¸ªå€¼ä½œä¸º $master_log_pos ï¼Œç”¨åœ¨èŠ‚ç‚¹ B çš„ change master å‘½ä»¤é‡Œã€‚</p><p>å½“ç„¶è¿™ä¸ªå€¼å¹¶ä¸ç²¾ç¡®ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p><p>ä½ å¯ä»¥è®¾æƒ³æœ‰è¿™ä¹ˆä¸€ç§æƒ…å†µï¼Œå‡è®¾åœ¨ T è¿™ä¸ªæ—¶åˆ»ï¼Œä¸»åº“ A å·²ç»æ‰§è¡Œå®Œæˆäº†ä¸€ä¸ª insert è¯­å¥æ’å…¥äº†ä¸€è¡Œæ•°æ® Rï¼Œå¹¶ä¸”å·²ç»å°† binlog ä¼ ç»™äº† Aâ€™å’Œ Bï¼Œç„¶ååœ¨ä¼ å®Œçš„ç¬é—´ä¸»åº“ A çš„ä¸»æœºå°±æ‰ç”µäº†ã€‚</p><p>é‚£ä¹ˆï¼Œè¿™æ—¶å€™ç³»ç»Ÿçš„çŠ¶æ€æ˜¯è¿™æ ·çš„ï¼š</p><ol><li>åœ¨ä»åº“ B ä¸Šï¼Œç”±äºåŒæ­¥äº† binlogï¼Œ R è¿™ä¸€è¡Œå·²ç»å­˜åœ¨ï¼›</li><li>åœ¨æ–°ä¸»åº“ Aâ€™ä¸Šï¼Œ R è¿™ä¸€è¡Œä¹Ÿå·²ç»å­˜åœ¨ï¼Œæ—¥å¿—æ˜¯å†™åœ¨ 123 è¿™ä¸ªä½ç½®ä¹‹åçš„ï¼›</li><li>æˆ‘ä»¬åœ¨ä»åº“ B ä¸Šæ‰§è¡Œ change master å‘½ä»¤ï¼ŒæŒ‡å‘ Aâ€™çš„ File æ–‡ä»¶çš„ 123 ä½ç½®ï¼Œå°±ä¼šæŠŠæ’å…¥ R è¿™ä¸€è¡Œæ•°æ®çš„ binlog åˆåŒæ­¥åˆ°ä»åº“ B å»æ‰§è¡Œã€‚</li></ol><p>è¿™æ—¶å€™ï¼Œä»åº“ B çš„åŒæ­¥çº¿ç¨‹å°±ä¼šæŠ¥å‘Š Duplicate entry â€˜id_of_Râ€™ for key â€˜PRIMARYâ€™ é”™è¯¯ï¼Œæç¤ºå‡ºç°äº†ä¸»é”®å†²çªï¼Œç„¶ååœæ­¢åŒæ­¥ã€‚</p><p>æ‰€ä»¥ï¼Œ<strong>é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åœ¨åˆ‡æ¢ä»»åŠ¡çš„æ—¶å€™ï¼Œè¦å…ˆä¸»åŠ¨è·³è¿‡è¿™äº›é”™è¯¯ï¼Œæœ‰ä¸¤ç§å¸¸ç”¨çš„æ–¹æ³•ã€‚</strong></p><p><strong>ä¸€ç§åšæ³•æ˜¯</strong>ï¼Œä¸»åŠ¨è·³è¿‡ä¸€ä¸ªäº‹åŠ¡ã€‚è·³è¿‡å‘½ä»¤çš„å†™æ³•æ˜¯ï¼š</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">set</span> <span class="token keyword">global</span> sql_slave_skip_counter<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">start</span> slave<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>å› ä¸ºåˆ‡æ¢è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šä¸æ­¢é‡å¤æ‰§è¡Œä¸€ä¸ªäº‹åŠ¡ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨ä»åº“ B åˆšå¼€å§‹æ¥åˆ°æ–°ä¸»åº“ Aâ€™æ—¶ï¼ŒæŒç»­è§‚å¯Ÿï¼Œæ¯æ¬¡ç¢°åˆ°è¿™äº›é”™è¯¯å°±åœä¸‹æ¥ï¼Œæ‰§è¡Œä¸€æ¬¡è·³è¿‡å‘½ä»¤ï¼Œç›´åˆ°ä¸å†å‡ºç°åœä¸‹æ¥çš„æƒ…å†µï¼Œä»¥æ­¤æ¥è·³è¿‡å¯èƒ½æ¶‰åŠçš„æ‰€æœ‰äº‹åŠ¡ã€‚</p><p>**å¦å¤–ä¸€ç§æ–¹å¼æ˜¯ï¼Œ**é€šè¿‡è®¾ç½® slave_skip_errors å‚æ•°ï¼Œç›´æ¥è®¾ç½®è·³è¿‡æŒ‡å®šçš„é”™è¯¯ã€‚</p><p>åœ¨æ‰§è¡Œä¸»å¤‡åˆ‡æ¢æ—¶ï¼Œæœ‰è¿™ä¹ˆä¸¤ç±»é”™è¯¯ï¼Œæ˜¯ç»å¸¸ä¼šé‡åˆ°çš„ï¼š</p><ul><li>1062 é”™è¯¯æ˜¯æ’å…¥æ•°æ®æ—¶å”¯ä¸€é”®å†²çªï¼›</li><li>1032 é”™è¯¯æ˜¯åˆ é™¤æ•°æ®æ—¶æ‰¾ä¸åˆ°è¡Œã€‚</li></ul><p>å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ slave_skip_errors è®¾ç½®ä¸º â€œ1032,1062â€ï¼Œè¿™æ ·ä¸­é—´ç¢°åˆ°è¿™ä¸¤ä¸ªé”™è¯¯æ—¶å°±ç›´æ¥è·³è¿‡ã€‚</p><p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ç§ç›´æ¥è·³è¿‡æŒ‡å®šé”™è¯¯çš„æ–¹æ³•ï¼Œé’ˆå¯¹çš„æ˜¯ä¸»å¤‡åˆ‡æ¢æ—¶ï¼Œç”±äºæ‰¾ä¸åˆ°ç²¾ç¡®çš„åŒæ­¥ä½ç‚¹ï¼Œæ‰€ä»¥åªèƒ½é‡‡ç”¨è¿™ç§æ–¹æ³•æ¥åˆ›å»ºä»åº“å’Œæ–°ä¸»åº“çš„ä¸»å¤‡å…³ç³»ã€‚</p><p>è¿™ä¸ªèƒŒæ™¯æ˜¯ï¼Œæˆ‘ä»¬å¾ˆæ¸…æ¥šåœ¨ä¸»å¤‡åˆ‡æ¢è¿‡ç¨‹ä¸­ï¼Œç›´æ¥è·³è¿‡ 1032 å’Œ 1062 è¿™ä¸¤ç±»é”™è¯¯æ˜¯æ— æŸçš„ï¼Œæ‰€ä»¥æ‰å¯ä»¥è¿™ä¹ˆè®¾ç½® slave_skip_errors å‚æ•°ã€‚ç­‰åˆ°ä¸»å¤‡é—´çš„åŒæ­¥å…³ç³»å»ºç«‹å®Œæˆï¼Œå¹¶ç¨³å®šæ‰§è¡Œä¸€æ®µæ—¶é—´ä¹‹åï¼Œæˆ‘ä»¬è¿˜éœ€è¦æŠŠè¿™ä¸ªå‚æ•°è®¾ç½®ä¸ºç©ºï¼Œä»¥å…ä¹‹åçœŸçš„å‡ºç°äº†ä¸»ä»æ•°æ®ä¸ä¸€è‡´ï¼Œä¹Ÿè·³è¿‡äº†ã€‚</p><h4 id="gtid" tabindex="-1"><a class="header-anchor" href="#gtid" aria-hidden="true">#</a> GTID</h4><p>é€šè¿‡ sql_slave_skip_counter è·³è¿‡äº‹åŠ¡å’Œé€šè¿‡ slave_skip_errors å¿½ç•¥é”™è¯¯çš„æ–¹æ³•ï¼Œè™½ç„¶éƒ½æœ€ç»ˆå¯ä»¥å»ºç«‹ä»åº“ B å’Œæ–°ä¸»åº“ Aâ€™çš„ä¸»å¤‡å…³ç³»ï¼Œä½†è¿™ä¸¤ç§æ“ä½œéƒ½å¾ˆå¤æ‚ï¼Œè€Œä¸”å®¹æ˜“å‡ºé”™ã€‚æ‰€ä»¥ï¼ŒMySQL 5.6 ç‰ˆæœ¬å¼•å…¥äº† GTIDï¼Œå½»åº•è§£å†³äº†è¿™ä¸ªå›°éš¾ã€‚</p><p>é‚£ä¹ˆï¼ŒGTID åˆ°åº•æ˜¯ä»€ä¹ˆæ„æ€ï¼Œåˆæ˜¯å¦‚ä½•è§£å†³æ‰¾åŒæ­¥ä½ç‚¹è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿç°åœ¨ï¼Œæˆ‘å°±å’Œä½ ç®€å•ä»‹ç»ä¸€ä¸‹ã€‚</p><p>GTID çš„å…¨ç§°æ˜¯ Global Transaction Identifierï¼Œä¹Ÿå°±æ˜¯å…¨å±€äº‹åŠ¡ IDï¼Œæ˜¯ä¸€ä¸ªäº‹åŠ¡åœ¨æäº¤çš„æ—¶å€™ç”Ÿæˆçš„ï¼Œæ˜¯è¿™ä¸ªäº‹åŠ¡çš„å”¯ä¸€æ ‡è¯†ã€‚å®ƒç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼Œæ ¼å¼æ˜¯ï¼š</p><div class="language-ini line-numbers-mode" data-ext="ini"><pre class="language-ini"><code><span class="token key attr-name">GTID</span><span class="token punctuation">=</span><span class="token value attr-value">server_uuid:gno</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å…¶ä¸­ï¼š</p><ul><li>server_uuid æ˜¯ä¸€ä¸ªå®ä¾‹ç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œæ˜¯ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„å€¼ï¼›</li><li>gno æ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œåˆå§‹å€¼æ˜¯ 1ï¼Œæ¯æ¬¡æäº¤äº‹åŠ¡çš„æ—¶å€™åˆ†é…ç»™è¿™ä¸ªäº‹åŠ¡ï¼Œå¹¶åŠ  1ã€‚</li></ul><p>è¿™é‡Œæˆ‘éœ€è¦å’Œä½ è¯´æ˜ä¸€ä¸‹ï¼Œåœ¨ MySQL çš„å®˜æ–¹æ–‡æ¡£é‡Œï¼ŒGTID æ ¼å¼æ˜¯è¿™ä¹ˆå®šä¹‰çš„ï¼š</p><div class="language-ini line-numbers-mode" data-ext="ini"><pre class="language-ini"><code><span class="token key attr-name">GTID</span><span class="token punctuation">=</span><span class="token value attr-value">source_id:transaction_id</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>è¿™é‡Œçš„ source_id å°±æ˜¯ server_uuidï¼›è€Œåé¢çš„è¿™ä¸ª transaction_idï¼Œæˆ‘è§‰å¾—å®¹æ˜“é€ æˆè¯¯å¯¼ï¼Œæ‰€ä»¥æˆ‘æ”¹æˆäº† gnoã€‚ä¸ºä»€ä¹ˆè¯´ä½¿ç”¨ transaction_id å®¹æ˜“é€ æˆè¯¯è§£å‘¢ï¼Ÿ</p><p>å› ä¸ºï¼Œåœ¨ MySQL é‡Œé¢æˆ‘ä»¬è¯´ transaction_id å°±æ˜¯æŒ‡äº‹åŠ¡ idï¼Œäº‹åŠ¡ id æ˜¯åœ¨äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­åˆ†é…çš„ï¼Œå¦‚æœè¿™ä¸ªäº‹åŠ¡å›æ»šäº†ï¼Œäº‹åŠ¡ id ä¹Ÿä¼šé€’å¢ï¼Œè€Œ gno æ˜¯åœ¨äº‹åŠ¡æäº¤çš„æ—¶å€™æ‰ä¼šåˆ†é…ã€‚</p><p>ä»æ•ˆæœä¸Šçœ‹ï¼ŒGTID å¾€å¾€æ˜¯è¿ç»­çš„ï¼Œå› æ­¤æˆ‘ä»¬ç”¨ gno æ¥è¡¨ç¤ºæ›´å®¹æ˜“ç†è§£ã€‚</p><p>GTID æ¨¡å¼çš„å¯åŠ¨ä¹Ÿå¾ˆç®€å•ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨å¯åŠ¨ä¸€ä¸ª MySQL å®ä¾‹çš„æ—¶å€™ï¼ŒåŠ ä¸Šå‚æ•° gtid_mode=on å’Œ enforce_gtid_consistency=on å°±å¯ä»¥äº†ã€‚</p><p>åœ¨ GTID æ¨¡å¼ä¸‹ï¼Œæ¯ä¸ªäº‹åŠ¡éƒ½ä¼šè·Ÿä¸€ä¸ª GTID ä¸€ä¸€å¯¹åº”ã€‚è¿™ä¸ª GTID æœ‰ä¸¤ç§ç”Ÿæˆæ–¹å¼ï¼Œè€Œä½¿ç”¨å“ªç§æ–¹å¼å–å†³äº session å˜é‡ gtid_next çš„å€¼ã€‚</p><ol><li>å¦‚æœ gtid_next=automaticï¼Œä»£è¡¨ä½¿ç”¨é»˜è®¤å€¼ã€‚è¿™æ—¶ï¼ŒMySQL å°±ä¼šæŠŠ server_uuid:gno åˆ†é…ç»™è¿™ä¸ªäº‹åŠ¡ã€‚ a. è®°å½• binlog çš„æ—¶å€™ï¼Œå…ˆè®°å½•ä¸€è¡Œ SET @@SESSION.GTID_NEXT=â€˜server_uuid:gnoâ€™; b. æŠŠè¿™ä¸ª GTID åŠ å…¥æœ¬å®ä¾‹çš„ GTID é›†åˆã€‚</li><li>å¦‚æœ gtid_next æ˜¯ä¸€ä¸ªæŒ‡å®šçš„ GTID çš„å€¼ï¼Œæ¯”å¦‚é€šè¿‡ set gtid_next=&#39;current_gtidâ€™æŒ‡å®šä¸º current_gtidï¼Œé‚£ä¹ˆå°±æœ‰ä¸¤ç§å¯èƒ½ï¼š a. å¦‚æœ current_gtid å·²ç»å­˜åœ¨äºå®ä¾‹çš„ GTID é›†åˆä¸­ï¼Œæ¥ä¸‹æ¥æ‰§è¡Œçš„è¿™ä¸ªäº‹åŠ¡ä¼šç›´æ¥è¢«ç³»ç»Ÿå¿½ç•¥ï¼› b. å¦‚æœ current_gtid æ²¡æœ‰å­˜åœ¨äºå®ä¾‹çš„ GTID é›†åˆä¸­ï¼Œå°±å°†è¿™ä¸ª current_gtid åˆ†é…ç»™æ¥ä¸‹æ¥è¦æ‰§è¡Œçš„äº‹åŠ¡ï¼Œä¹Ÿå°±æ˜¯è¯´ç³»ç»Ÿä¸éœ€è¦ç»™è¿™ä¸ªäº‹åŠ¡ç”Ÿæˆæ–°çš„ GTIDï¼Œå› æ­¤ gno ä¹Ÿä¸ç”¨åŠ  1ã€‚</li></ol><p>æ³¨æ„ï¼Œä¸€ä¸ª current_gtid åªèƒ½ç»™ä¸€ä¸ªäº‹åŠ¡ä½¿ç”¨ã€‚è¿™ä¸ªäº‹åŠ¡æäº¤åï¼Œå¦‚æœè¦æ‰§è¡Œä¸‹ä¸€ä¸ªäº‹åŠ¡ï¼Œå°±è¦æ‰§è¡Œ set å‘½ä»¤ï¼ŒæŠŠ gtid_next è®¾ç½®æˆå¦å¤–ä¸€ä¸ª gtid æˆ–è€… automaticã€‚</p><p>è¿™æ ·ï¼Œæ¯ä¸ª MySQL å®ä¾‹éƒ½ç»´æŠ¤äº†ä¸€ä¸ª GTID é›†åˆï¼Œç”¨æ¥å¯¹åº”â€œè¿™ä¸ªå®ä¾‹æ‰§è¡Œè¿‡çš„æ‰€æœ‰äº‹åŠ¡â€ã€‚</p><p>è¿™æ ·çœ‹ä¸Šå»ä¸å¤ªå®¹æ˜“ç†è§£ï¼Œæ¥ä¸‹æ¥æˆ‘å°±ç”¨ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œæ¥å’Œä½ è¯´æ˜ GTID çš„åŸºæœ¬ç”¨æ³•ã€‚</p><p>æˆ‘ä»¬åœ¨å®ä¾‹ X ä¸­åˆ›å»ºä¸€ä¸ªè¡¨ tã€‚</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>t<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>c<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span><span class="token punctuation">;</span> 
<span class="token keyword">insert</span> <span class="token keyword">into</span> t <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/28a5cab0079fb12fd5abecd92b3324c2-1584367399789.png" alt="img"></p><p>å›¾ 4 åˆå§‹åŒ–æ•°æ®çš„ binlog</p><p>å¯ä»¥çœ‹åˆ°ï¼Œäº‹åŠ¡çš„ BEGIN ä¹‹å‰æœ‰ä¸€æ¡ SET @@SESSION.GTID_NEXT å‘½ä»¤ã€‚è¿™æ—¶ï¼Œå¦‚æœå®ä¾‹ X æœ‰ä»åº“ï¼Œé‚£ä¹ˆå°† CREATE TABLE å’Œ insert è¯­å¥çš„ binlog åŒæ­¥è¿‡å»æ‰§è¡Œçš„è¯ï¼Œæ‰§è¡Œäº‹åŠ¡ä¹‹å‰å°±ä¼šå…ˆæ‰§è¡Œè¿™ä¸¤ä¸ª SET å‘½ä»¤ï¼Œ è¿™æ ·è¢«åŠ å…¥ä»åº“çš„ GTID é›†åˆçš„ï¼Œå°±æ˜¯å›¾ä¸­çš„è¿™ä¸¤ä¸ª GTIDã€‚</p><p>å‡è®¾ï¼Œç°åœ¨è¿™ä¸ªå®ä¾‹ X æ˜¯å¦å¤–ä¸€ä¸ªå®ä¾‹ Y çš„ä»åº“ï¼Œå¹¶ä¸”æ­¤æ—¶åœ¨å®ä¾‹ Y ä¸Šæ‰§è¡Œäº†ä¸‹é¢è¿™æ¡æ’å…¥è¯­å¥ï¼š</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">insert</span> <span class="token keyword">into</span> t <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å¹¶ä¸”ï¼Œè¿™æ¡è¯­å¥åœ¨å®ä¾‹ Y ä¸Šçš„ GTID æ˜¯ â€œaaaaaaaa-cccc-dddd-eeee-ffffffffffff:10â€ã€‚</p><p>é‚£ä¹ˆï¼Œå®ä¾‹ X ä½œä¸º Y çš„ä»åº“ï¼Œå°±è¦åŒæ­¥è¿™ä¸ªäº‹åŠ¡è¿‡æ¥æ‰§è¡Œï¼Œæ˜¾ç„¶ä¼šå‡ºç°ä¸»é”®å†²çªï¼Œå¯¼è‡´å®ä¾‹ X çš„åŒæ­¥çº¿ç¨‹åœæ­¢ã€‚è¿™æ—¶ï¼Œæˆ‘ä»¬åº”è¯¥æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿ</p><p>å¤„ç†æ–¹æ³•å°±æ˜¯ï¼Œä½ å¯ä»¥æ‰§è¡Œä¸‹é¢çš„è¿™ä¸ªè¯­å¥åºåˆ—ï¼š</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">set</span> gtid_next<span class="token operator">=</span><span class="token string">&#39;aaaaaaaa-cccc-dddd-eeee-ffffffffffff:10&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">begin</span><span class="token punctuation">;</span>
<span class="token keyword">commit</span><span class="token punctuation">;</span>
<span class="token keyword">set</span> gtid_next<span class="token operator">=</span>automatic<span class="token punctuation">;</span>
<span class="token keyword">start</span> slave<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å…¶ä¸­ï¼Œå‰ä¸‰æ¡è¯­å¥çš„ä½œç”¨ï¼Œæ˜¯é€šè¿‡æäº¤ä¸€ä¸ªç©ºäº‹åŠ¡ï¼ŒæŠŠè¿™ä¸ª GTID åŠ åˆ°å®ä¾‹ X çš„ GTID é›†åˆä¸­ã€‚å¦‚å›¾ 5 æ‰€ç¤ºï¼Œå°±æ˜¯æ‰§è¡Œå®Œè¿™ä¸ªç©ºäº‹åŠ¡ä¹‹åçš„ show master status çš„ç»“æœã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/c8d3299ece7d583a3ecd1557851ed157-1584367399827.png" alt="img"></p><p>å›¾ 5 show master status ç»“æœ</p><p>å¯ä»¥çœ‹åˆ°å®ä¾‹ X çš„ Executed_Gtid_set é‡Œé¢ï¼Œå·²ç»åŠ å…¥äº†è¿™ä¸ª GTIDã€‚</p><p>è¿™æ ·ï¼Œæˆ‘å†æ‰§è¡Œ start slave å‘½ä»¤è®©åŒæ­¥çº¿ç¨‹æ‰§è¡Œèµ·æ¥çš„æ—¶å€™ï¼Œè™½ç„¶å®ä¾‹ X ä¸Šè¿˜æ˜¯ä¼šç»§ç»­æ‰§è¡Œå®ä¾‹ Y ä¼ è¿‡æ¥çš„äº‹åŠ¡ï¼Œä½†æ˜¯ç”±äºâ€œaaaaaaaa-cccc-dddd-eeee-ffffffffffff:10â€å·²ç»å­˜åœ¨äºå®ä¾‹ X çš„ GTID é›†åˆä¸­äº†ï¼Œæ‰€ä»¥å®ä¾‹ X å°±ä¼šç›´æ¥è·³è¿‡è¿™ä¸ªäº‹åŠ¡ï¼Œä¹Ÿå°±ä¸ä¼šå†å‡ºç°ä¸»é”®å†²çªçš„é”™è¯¯ã€‚</p><p>åœ¨ä¸Šé¢çš„è¿™ä¸ªè¯­å¥åºåˆ—ä¸­ï¼Œstart slave å‘½ä»¤ä¹‹å‰è¿˜æœ‰ä¸€å¥ set gtid_next=automaticã€‚è¿™å¥è¯çš„ä½œç”¨æ˜¯â€œæ¢å¤ GTID çš„é»˜è®¤åˆ†é…è¡Œä¸ºâ€ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœä¹‹åæœ‰æ–°çš„äº‹åŠ¡å†æ‰§è¡Œï¼Œå°±è¿˜æ˜¯æŒ‰ç…§åŸæ¥çš„åˆ†é…æ–¹å¼ï¼Œç»§ç»­åˆ†é… gno=3ã€‚</p><h4 id="åŸºäº-gtid-çš„ä¸»å¤‡åˆ‡æ¢" tabindex="-1"><a class="header-anchor" href="#åŸºäº-gtid-çš„ä¸»å¤‡åˆ‡æ¢" aria-hidden="true">#</a> åŸºäº GTID çš„ä¸»å¤‡åˆ‡æ¢</h4><p>ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»ç†è§£ GTID çš„æ¦‚å¿µï¼Œå†ä¸€èµ·æ¥çœ‹çœ‹åŸºäº GTID çš„ä¸»å¤‡å¤åˆ¶çš„ç”¨æ³•ã€‚</p><p>åœ¨ GTID æ¨¡å¼ä¸‹ï¼Œå¤‡åº“ B è¦è®¾ç½®ä¸ºæ–°ä¸»åº“ Aâ€™çš„ä»åº“çš„è¯­æ³•å¦‚ä¸‹ï¼š</p><div class="language-makefile line-numbers-mode" data-ext="makefile"><pre class="language-makefile"><code>CHANGE MASTER TO 
MASTER_HOST<span class="token operator">=</span><span class="token variable">$host_name</span> 
MASTER_PORT<span class="token operator">=</span><span class="token variable">$port</span> 
MASTER_USER<span class="token operator">=</span><span class="token variable">$user_name</span> 
MASTER_PASSWORD<span class="token operator">=</span><span class="token variable">$password</span> 
master_auto_position<span class="token operator">=</span>1 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å…¶ä¸­ï¼Œmaster_auto_position=1 å°±è¡¨ç¤ºè¿™ä¸ªä¸»å¤‡å…³ç³»ä½¿ç”¨çš„æ˜¯ GTID åè®®ã€‚å¯ä»¥çœ‹åˆ°ï¼Œå‰é¢è®©æˆ‘ä»¬å¤´ç–¼ä¸å·²çš„ MASTER_LOG_FILE å’Œ MASTER_LOG_POS å‚æ•°ï¼Œå·²ç»ä¸éœ€è¦æŒ‡å®šäº†ã€‚</p><p>æˆ‘ä»¬æŠŠç°åœ¨è¿™ä¸ªæ—¶åˆ»ï¼Œå®ä¾‹ Aâ€™çš„ GTID é›†åˆè®°ä¸º set_aï¼Œå®ä¾‹ B çš„ GTID é›†åˆè®°ä¸º set_bã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±çœ‹çœ‹ç°åœ¨çš„ä¸»å¤‡åˆ‡æ¢é€»è¾‘ã€‚</p><p>æˆ‘ä»¬åœ¨å®ä¾‹ B ä¸Šæ‰§è¡Œ start slave å‘½ä»¤ï¼Œå– binlog çš„é€»è¾‘æ˜¯è¿™æ ·çš„ï¼š</p><ol><li>å®ä¾‹ B æŒ‡å®šä¸»åº“ Aâ€™ï¼ŒåŸºäºä¸»å¤‡åè®®å»ºç«‹è¿æ¥ã€‚</li><li>å®ä¾‹ B æŠŠ set_b å‘ç»™ä¸»åº“ Aâ€™ã€‚</li><li>å®ä¾‹ Aâ€™ç®—å‡º set_a ä¸ set_b çš„å·®é›†ï¼Œä¹Ÿå°±æ˜¯æ‰€æœ‰å­˜åœ¨äº set_aï¼Œä½†æ˜¯ä¸å­˜åœ¨äº set_b çš„ GITD çš„é›†åˆï¼Œåˆ¤æ–­ Aâ€™æœ¬åœ°æ˜¯å¦åŒ…å«äº†è¿™ä¸ªå·®é›†éœ€è¦çš„æ‰€æœ‰ binlog äº‹åŠ¡ã€‚ a. å¦‚æœä¸åŒ…å«ï¼Œè¡¨ç¤º Aâ€™å·²ç»æŠŠå®ä¾‹ B éœ€è¦çš„ binlog ç»™åˆ æ‰äº†ï¼Œç›´æ¥è¿”å›é”™è¯¯ï¼› b. å¦‚æœç¡®è®¤å…¨éƒ¨åŒ…å«ï¼ŒAâ€™ä»è‡ªå·±çš„ binlog æ–‡ä»¶é‡Œé¢ï¼Œæ‰¾å‡ºç¬¬ä¸€ä¸ªä¸åœ¨ set_b çš„äº‹åŠ¡ï¼Œå‘ç»™ Bï¼›</li><li>ä¹‹åå°±ä»è¿™ä¸ªäº‹åŠ¡å¼€å§‹ï¼Œå¾€åè¯»æ–‡ä»¶ï¼ŒæŒ‰é¡ºåºå– binlog å‘ç»™ B å»æ‰§è¡Œã€‚</li></ol><p>å…¶å®ï¼Œè¿™ä¸ªé€»è¾‘é‡Œé¢åŒ…å«äº†ä¸€ä¸ªè®¾è®¡æ€æƒ³ï¼šåœ¨åŸºäº GTID çš„ä¸»å¤‡å…³ç³»é‡Œï¼Œç³»ç»Ÿè®¤ä¸ºåªè¦å»ºç«‹ä¸»å¤‡å…³ç³»ï¼Œå°±å¿…é¡»ä¿è¯ä¸»åº“å‘ç»™å¤‡åº“çš„æ—¥å¿—æ˜¯å®Œæ•´çš„ã€‚å› æ­¤ï¼Œå¦‚æœå®ä¾‹ B éœ€è¦çš„æ—¥å¿—å·²ç»ä¸å­˜åœ¨ï¼ŒAâ€™å°±æ‹’ç»æŠŠæ—¥å¿—å‘ç»™ Bã€‚</p><p>è¿™è·ŸåŸºäºä½ç‚¹çš„ä¸»å¤‡åè®®ä¸åŒã€‚åŸºäºä½ç‚¹çš„åè®®ï¼Œæ˜¯ç”±å¤‡åº“å†³å®šçš„ï¼Œå¤‡åº“æŒ‡å®šå“ªä¸ªä½ç‚¹ï¼Œä¸»åº“å°±å‘å“ªä¸ªä½ç‚¹ï¼Œä¸åšæ—¥å¿—çš„å®Œæ•´æ€§åˆ¤æ–­ã€‚</p><p>åŸºäºä¸Šé¢çš„ä»‹ç»ï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹å¼•å…¥ GTID åï¼Œä¸€ä¸»å¤šä»çš„åˆ‡æ¢åœºæ™¯ä¸‹ï¼Œä¸»å¤‡åˆ‡æ¢æ˜¯å¦‚ä½•å®ç°çš„ã€‚</p><p>ç”±äºä¸éœ€è¦æ‰¾ä½ç‚¹äº†ï¼Œæ‰€ä»¥ä»åº“ Bã€Cã€D åªéœ€è¦åˆ†åˆ«æ‰§è¡Œ change master å‘½ä»¤æŒ‡å‘å®ä¾‹ Aâ€™å³å¯ã€‚</p><p>å…¶å®ï¼Œä¸¥è°¨åœ°è¯´ï¼Œä¸»å¤‡åˆ‡æ¢ä¸æ˜¯ä¸éœ€è¦æ‰¾ä½ç‚¹äº†ï¼Œè€Œæ˜¯æ‰¾ä½ç‚¹è¿™ä¸ªå·¥ä½œï¼Œåœ¨å®ä¾‹ Aâ€™å†…éƒ¨å°±å·²ç»è‡ªåŠ¨å®Œæˆäº†ã€‚ä½†ç”±äºè¿™ä¸ªå·¥ä½œæ˜¯è‡ªåŠ¨çš„ï¼Œæ‰€ä»¥å¯¹ HA ç³»ç»Ÿçš„å¼€å‘äººå‘˜æ¥è¯´ï¼Œéå¸¸å‹å¥½ã€‚</p><p>ä¹‹åè¿™ä¸ªç³»ç»Ÿå°±ç”±æ–°ä¸»åº“ Aâ€™å†™å…¥ï¼Œä¸»åº“ Aâ€™çš„è‡ªå·±ç”Ÿæˆçš„ binlog ä¸­çš„ GTID é›†åˆæ ¼å¼æ˜¯ï¼šserver_uuid_of_Aâ€™:1-Mã€‚</p><p>å¦‚æœä¹‹å‰ä»åº“ B çš„ GTID é›†åˆæ ¼å¼æ˜¯ server_uuid_of_A:1-Nï¼Œ é‚£ä¹ˆåˆ‡æ¢ä¹‹å GTID é›†åˆçš„æ ¼å¼å°±å˜æˆäº† server_uuid_of_A:1-N, server_uuid_of_Aâ€™:1-Mã€‚</p><p>å½“ç„¶ï¼Œä¸»åº“ Aâ€™ä¹‹å‰ä¹Ÿæ˜¯ A çš„å¤‡åº“ï¼Œå› æ­¤ä¸»åº“ Aâ€™å’Œä»åº“ B çš„ GTID é›†åˆæ˜¯ä¸€æ ·çš„ã€‚è¿™å°±è¾¾åˆ°äº†æˆ‘ä»¬é¢„æœŸã€‚</p><h4 id="gtid-å’Œåœ¨çº¿-ddl" tabindex="-1"><a class="header-anchor" href="#gtid-å’Œåœ¨çº¿-ddl" aria-hidden="true">#</a> GTID å’Œåœ¨çº¿ DDL</h4><p>æ¥ä¸‹æ¥ï¼Œæˆ‘å†ä¸¾ä¸ªä¾‹å­å¸®ä½ ç†è§£ GTIDã€‚</p><p>ä¹‹å‰åœ¨ç¬¬ 22 ç¯‡æ–‡ç« [ã€ŠMySQL æœ‰å“ªäº›â€œé¥®é¸©æ­¢æ¸´â€æé«˜æ€§èƒ½çš„æ–¹æ³•ï¼Ÿã€‹]ä¸­ï¼Œæˆ‘å’Œä½ æåˆ°ä¸šåŠ¡é«˜å³°æœŸçš„æ…¢æŸ¥è¯¢æ€§èƒ½é—®é¢˜æ—¶ï¼Œåˆ†æåˆ°å¦‚æœæ˜¯ç”±äºç´¢å¼•ç¼ºå¤±å¼•èµ·çš„æ€§èƒ½é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨çº¿åŠ ç´¢å¼•æ¥è§£å†³ã€‚ä½†æ˜¯ï¼Œè€ƒè™‘åˆ°è¦é¿å…æ–°å¢ç´¢å¼•å¯¹ä¸»åº“æ€§èƒ½é€ æˆçš„å½±å“ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆåœ¨å¤‡åº“åŠ ç´¢å¼•ï¼Œç„¶åå†åˆ‡æ¢ã€‚</p><p>å½“æ—¶æˆ‘è¯´ï¼Œåœ¨åŒ M ç»“æ„ä¸‹ï¼Œå¤‡åº“æ‰§è¡Œçš„ DDL è¯­å¥ä¹Ÿä¼šä¼ ç»™ä¸»åº“ï¼Œä¸ºäº†é¿å…ä¼ å›åå¯¹ä¸»åº“é€ æˆå½±å“ï¼Œè¦é€šè¿‡ set sql_log_bin=off å…³æ‰ binlogã€‚</p><p>è¯„è®ºåŒºæœ‰ä½åŒå­¦æå‡ºäº†ä¸€ä¸ªé—®é¢˜ï¼šè¿™æ ·æ“ä½œçš„è¯ï¼Œæ•°æ®åº“é‡Œé¢æ˜¯åŠ äº†ç´¢å¼•ï¼Œä½†æ˜¯ binlog å¹¶æ²¡æœ‰è®°å½•ä¸‹è¿™ä¸€ä¸ªæ›´æ–°ï¼Œæ˜¯ä¸æ˜¯ä¼šå¯¼è‡´æ•°æ®å’Œæ—¥å¿—ä¸ä¸€è‡´ï¼Ÿ</p><p>è¿™ä¸ªé—®é¢˜æå¾—éå¸¸å¥½ã€‚å½“æ—¶ï¼Œæˆ‘åœ¨ç•™è¨€çš„å›å¤ä¸­å°±å¼•ç”¨äº† GTID æ¥è¯´æ˜ã€‚ä»Šå¤©ï¼Œæˆ‘å†å’Œä½ å±•å¼€è¯´æ˜ä¸€ä¸‹ã€‚</p><p>å‡è®¾ï¼Œè¿™ä¸¤ä¸ªäº’ä¸ºä¸»å¤‡å…³ç³»çš„åº“è¿˜æ˜¯å®ä¾‹ X å’Œå®ä¾‹ Yï¼Œä¸”å½“å‰ä¸»åº“æ˜¯ Xï¼Œå¹¶ä¸”éƒ½æ‰“å¼€äº† GTID æ¨¡å¼ã€‚è¿™æ—¶çš„ä¸»å¤‡åˆ‡æ¢æµç¨‹å¯ä»¥å˜æˆä¸‹é¢è¿™æ ·ï¼š</p><ul><li>åœ¨å®ä¾‹ X ä¸Šæ‰§è¡Œ stop slaveã€‚</li><li>åœ¨å®ä¾‹ Y ä¸Šæ‰§è¡Œ DDL è¯­å¥ã€‚æ³¨æ„ï¼Œè¿™é‡Œå¹¶ä¸éœ€è¦å…³é—­ binlogã€‚</li><li>æ‰§è¡Œå®Œæˆåï¼ŒæŸ¥å‡ºè¿™ä¸ª DDL è¯­å¥å¯¹åº”çš„ GTIDï¼Œå¹¶è®°ä¸º server_uuid_of_Y:gnoã€‚</li><li>åˆ°å®ä¾‹ X ä¸Šæ‰§è¡Œä»¥ä¸‹è¯­å¥åºåˆ—ï¼š</li></ul><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">set</span> GTID_NEXT<span class="token operator">=</span><span class="token string">&quot;server_uuid_of_Y:gno&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">begin</span><span class="token punctuation">;</span>
<span class="token keyword">commit</span><span class="token punctuation">;</span>
<span class="token keyword">set</span> gtid_next<span class="token operator">=</span>automatic<span class="token punctuation">;</span>
<span class="token keyword">start</span> slave<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ ·åšçš„ç›®çš„åœ¨äºï¼Œæ—¢å¯ä»¥è®©å®ä¾‹ Y çš„æ›´æ–°æœ‰ binlog è®°å½•ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥ç¡®ä¿ä¸ä¼šåœ¨å®ä¾‹ X ä¸Šæ‰§è¡Œè¿™æ¡æ›´æ–°ã€‚</p><ul><li>æ¥ä¸‹æ¥ï¼Œæ‰§è¡Œå®Œä¸»å¤‡åˆ‡æ¢ï¼Œç„¶åç…§ç€ä¸Šè¿°æµç¨‹å†æ‰§è¡Œä¸€éå³å¯ã€‚</li></ul><h4 id="å°ç»“-17" tabindex="-1"><a class="header-anchor" href="#å°ç»“-17" aria-hidden="true">#</a> å°ç»“</h4><p>åœ¨ä»Šå¤©è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å…ˆå’Œä½ ä»‹ç»äº†ä¸€ä¸»å¤šä»çš„ä¸»å¤‡åˆ‡æ¢æµç¨‹ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œä»åº“æ‰¾æ–°ä¸»åº“çš„ä½ç‚¹æ˜¯ä¸€ä¸ªç—›ç‚¹ã€‚ç”±æ­¤ï¼Œæˆ‘ä»¬å¼•å‡ºäº† MySQL 5.6 ç‰ˆæœ¬å¼•å…¥çš„ GTID æ¨¡å¼ï¼Œä»‹ç»äº† GTID çš„åŸºæœ¬æ¦‚å¿µå’Œç”¨æ³•ã€‚</p><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ GTID æ¨¡å¼ä¸‹ï¼Œä¸€ä¸»å¤šä»åˆ‡æ¢å°±éå¸¸æ–¹ä¾¿äº†ã€‚</p><p>å› æ­¤ï¼Œå¦‚æœä½ ä½¿ç”¨çš„ MySQL ç‰ˆæœ¬æ”¯æŒ GTID çš„è¯ï¼Œæˆ‘éƒ½å»ºè®®ä½ å°½é‡ä½¿ç”¨ GTID æ¨¡å¼æ¥åšä¸€ä¸»å¤šä»çš„åˆ‡æ¢ã€‚</p><p>åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬è¿˜èƒ½çœ‹åˆ° GTID æ¨¡å¼åœ¨è¯»å†™åˆ†ç¦»åœºæ™¯çš„åº”ç”¨ã€‚</p><p>æœ€åï¼Œåˆåˆ°äº†æˆ‘ä»¬çš„æ€è€ƒé¢˜æ—¶é—´ã€‚</p><p>ä½ åœ¨ GTID æ¨¡å¼ä¸‹è®¾ç½®ä¸»ä»å…³ç³»çš„æ—¶å€™ï¼Œä»åº“æ‰§è¡Œ start slave å‘½ä»¤åï¼Œä¸»åº“å‘ç°éœ€è¦çš„ binlog å·²ç»è¢«åˆ é™¤æ‰äº†ï¼Œå¯¼è‡´ä¸»å¤‡åˆ›å»ºä¸æˆåŠŸã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œä½ è§‰å¾—å¯ä»¥æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿ</p><p>ä½ å¯ä»¥æŠŠä½ çš„æ–¹æ³•å†™åœ¨ç•™è¨€åŒºï¼Œæˆ‘ä¼šåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« çš„æœ«å°¾å’Œä½ è®¨è®ºè¿™ä¸ªé—®é¢˜ã€‚æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚</p><h4 id="ä¸ŠæœŸé—®é¢˜æ—¶é—´-14" tabindex="-1"><a class="header-anchor" href="#ä¸ŠæœŸé—®é¢˜æ—¶é—´-14" aria-hidden="true">#</a> ä¸ŠæœŸé—®é¢˜æ—¶é—´</h4><p>ä¸Šä¸€ç¯‡æ–‡ç« æœ€åï¼Œæˆ‘ç»™ä½ ç•™çš„é—®é¢˜æ˜¯ï¼Œå¦‚æœä¸»åº“éƒ½æ˜¯å•çº¿ç¨‹å‹åŠ›æ¨¡å¼ï¼Œåœ¨ä»åº“è¿½ä¸»åº“çš„è¿‡ç¨‹ä¸­ï¼Œbinlog-transaction-dependency-tracking åº”è¯¥é€‰ç”¨ä»€ä¹ˆå‚æ•°ï¼Ÿ</p><p>è¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆæ˜¯ï¼Œåº”è¯¥å°†è¿™ä¸ªå‚æ•°è®¾ç½®ä¸º WRITESETã€‚</p><p>ç”±äºä¸»åº“æ˜¯å•çº¿ç¨‹å‹åŠ›æ¨¡å¼ï¼Œæ‰€ä»¥æ¯ä¸ªäº‹åŠ¡çš„ commit_id éƒ½ä¸åŒï¼Œé‚£ä¹ˆè®¾ç½®ä¸º COMMIT_ORDER æ¨¡å¼çš„è¯ï¼Œä»åº“ä¹Ÿåªèƒ½å•çº¿ç¨‹æ‰§è¡Œã€‚</p><p>åŒæ ·åœ°ï¼Œç”±äº WRITESET_SESSION æ¨¡å¼è¦æ±‚åœ¨å¤‡åº“åº”ç”¨æ—¥å¿—çš„æ—¶å€™ï¼ŒåŒä¸€ä¸ªçº¿ç¨‹çš„æ—¥å¿—å¿…é¡»ä¸ä¸»åº“ä¸Šæ‰§è¡Œçš„å…ˆåé¡ºåºç›¸åŒï¼Œä¹Ÿä¼šå¯¼è‡´ä¸»åº“å•çº¿ç¨‹å‹åŠ›æ¨¡å¼ä¸‹é€€åŒ–æˆå•çº¿ç¨‹å¤åˆ¶ã€‚</p><p>æ‰€ä»¥ï¼Œåº”è¯¥å°† binlog-transaction-dependency-tracking è®¾ç½®ä¸º WRITESETã€‚</p><p><strong>è¯„è®ºåŒºç•™è¨€ç‚¹èµæ¿ï¼š</strong></p><blockquote><p>@æ…§é‘« coming é—®äº†ä¸€ä¸ªå¥½é—®é¢˜ï¼Œå¯¹åŒä¸€è¡Œä½œæ›´æ–°çš„å‡ ä¸ªäº‹åŠ¡ï¼Œå¦‚æœ commit_id ç›¸åŒï¼Œæ˜¯ä¸æ˜¯åœ¨å¤‡åº“å¹¶è¡Œæ‰§è¡Œçš„æ—¶å€™ä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´ï¼Ÿè¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆæ˜¯æ›´æ–°åŒä¸€è¡Œçš„äº‹åŠ¡æ˜¯ä¸å¯èƒ½åŒæ—¶è¿›å…¥ commit çŠ¶æ€çš„ã€‚ @è€æ¨åŒå¿— å¯¹è¿™ä¸ªé—®é¢˜ç»™å‡ºäº†æ›´è¯¦ç»†çš„å›ç­”ï¼Œå¤§å®¶å¯ä»¥å»çœ‹ä¸€ä¸‹ã€‚</p></blockquote><h3 id="_28-è¯»å†™åˆ†ç¦»æœ‰å“ªäº›å‘" tabindex="-1"><a class="header-anchor" href="#_28-è¯»å†™åˆ†ç¦»æœ‰å“ªäº›å‘" aria-hidden="true">#</a> 28 è¯»å†™åˆ†ç¦»æœ‰å“ªäº›å‘ï¼Ÿ</h3><p>åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å’Œä½ ä»‹ç»äº†ä¸€ä¸»å¤šä»çš„ç»“æ„ä»¥åŠåˆ‡æ¢æµç¨‹ã€‚ä»Šå¤©æˆ‘ä»¬å°±ç»§ç»­èŠèŠä¸€ä¸»å¤šä»æ¶æ„çš„åº”ç”¨åœºæ™¯ï¼šè¯»å†™åˆ†ç¦»ï¼Œä»¥åŠæ€ä¹ˆå¤„ç†ä¸»å¤‡å»¶è¿Ÿå¯¼è‡´çš„è¯»å†™åˆ†ç¦»é—®é¢˜ã€‚</p><p>æˆ‘ä»¬åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­æåˆ°çš„ä¸€ä¸»å¤šä»çš„ç»“æ„ï¼Œå…¶å®å°±æ˜¯è¯»å†™åˆ†ç¦»çš„åŸºæœ¬ç»“æ„äº†ã€‚è¿™é‡Œï¼Œæˆ‘å†æŠŠè¿™å¼ å›¾è´´è¿‡æ¥ï¼Œæ–¹ä¾¿ä½ ç†è§£ã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/1334b9c08b8fd837832fdb2d82e6b0aa-1584367399834.png" alt="img"></p><p>å›¾ 1 è¯»å†™åˆ†ç¦»åŸºæœ¬ç»“æ„</p><p>è¯»å†™åˆ†ç¦»çš„ä¸»è¦ç›®æ ‡å°±æ˜¯åˆ†æ‘Šä¸»åº“çš„å‹åŠ›ã€‚å›¾ 1 ä¸­çš„ç»“æ„æ˜¯å®¢æˆ·ç«¯ï¼ˆclientï¼‰ä¸»åŠ¨åšè´Ÿè½½å‡è¡¡ï¼Œè¿™ç§æ¨¡å¼ä¸‹ä¸€èˆ¬ä¼šæŠŠæ•°æ®åº“çš„è¿æ¥ä¿¡æ¯æ”¾åœ¨å®¢æˆ·ç«¯çš„è¿æ¥å±‚ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç”±å®¢æˆ·ç«¯æ¥é€‰æ‹©åç«¯æ•°æ®åº“è¿›è¡ŒæŸ¥è¯¢ã€‚</p><p>è¿˜æœ‰ä¸€ç§æ¶æ„æ˜¯ï¼Œåœ¨ MySQL å’Œå®¢æˆ·ç«¯ä¹‹é—´æœ‰ä¸€ä¸ªä¸­é—´ä»£ç†å±‚ proxyï¼Œå®¢æˆ·ç«¯åªè¿æ¥ proxyï¼Œ ç”± proxy æ ¹æ®è¯·æ±‚ç±»å‹å’Œä¸Šä¸‹æ–‡å†³å®šè¯·æ±‚çš„åˆ†å‘è·¯ç”±ã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/065ef246c59019effc8384967d774318-1584367399845.png" alt="img"></p><p>å›¾ 2 å¸¦ proxy çš„è¯»å†™åˆ†ç¦»æ¶æ„</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±çœ‹ä¸€ä¸‹å®¢æˆ·ç«¯ç›´è¿å’Œå¸¦ proxy çš„è¯»å†™åˆ†ç¦»æ¶æ„ï¼Œå„æœ‰å“ªäº›ç‰¹ç‚¹ã€‚</p><ol><li>å®¢æˆ·ç«¯ç›´è¿æ–¹æ¡ˆï¼Œå› ä¸ºå°‘äº†ä¸€å±‚ proxy è½¬å‘ï¼Œæ‰€ä»¥æŸ¥è¯¢æ€§èƒ½ç¨å¾®å¥½ä¸€ç‚¹å„¿ï¼Œå¹¶ä¸”æ•´ä½“æ¶æ„ç®€å•ï¼Œæ’æŸ¥é—®é¢˜æ›´æ–¹ä¾¿ã€‚ä½†æ˜¯è¿™ç§æ–¹æ¡ˆï¼Œç”±äºè¦äº†è§£åç«¯éƒ¨ç½²ç»†èŠ‚ï¼Œæ‰€ä»¥åœ¨å‡ºç°ä¸»å¤‡åˆ‡æ¢ã€åº“è¿ç§»ç­‰æ“ä½œçš„æ—¶å€™ï¼Œå®¢æˆ·ç«¯éƒ½ä¼šæ„ŸçŸ¥åˆ°ï¼Œå¹¶ä¸”éœ€è¦è°ƒæ•´æ•°æ®åº“è¿æ¥ä¿¡æ¯ã€‚ ä½ å¯èƒ½ä¼šè§‰å¾—è¿™æ ·å®¢æˆ·ç«¯ä¹Ÿå¤ªéº»çƒ¦äº†ï¼Œä¿¡æ¯å¤§é‡å†—ä½™ï¼Œæ¶æ„å¾ˆä¸‘ã€‚å…¶å®ä¹Ÿæœªå¿…ï¼Œä¸€èˆ¬é‡‡ç”¨è¿™æ ·çš„æ¶æ„ï¼Œä¸€å®šä¼šä¼´éšä¸€ä¸ªè´Ÿè´£ç®¡ç†åç«¯çš„ç»„ä»¶ï¼Œæ¯”å¦‚ Zookeeperï¼Œå°½é‡è®©ä¸šåŠ¡ç«¯åªä¸“æ³¨äºä¸šåŠ¡é€»è¾‘å¼€å‘ã€‚</li><li>å¸¦ proxy çš„æ¶æ„ï¼Œå¯¹å®¢æˆ·ç«¯æ¯”è¾ƒå‹å¥½ã€‚å®¢æˆ·ç«¯ä¸éœ€è¦å…³æ³¨åç«¯ç»†èŠ‚ï¼Œè¿æ¥ç»´æŠ¤ã€åç«¯ä¿¡æ¯ç»´æŠ¤ç­‰å·¥ä½œï¼Œéƒ½æ˜¯ç”± proxy å®Œæˆçš„ã€‚ä½†è¿™æ ·çš„è¯ï¼Œå¯¹åç«¯ç»´æŠ¤å›¢é˜Ÿçš„è¦æ±‚ä¼šæ›´é«˜ã€‚è€Œä¸”ï¼Œproxy ä¹Ÿéœ€è¦æœ‰é«˜å¯ç”¨æ¶æ„ã€‚å› æ­¤ï¼Œå¸¦ proxy æ¶æ„çš„æ•´ä½“å°±ç›¸å¯¹æ¯”è¾ƒå¤æ‚ã€‚</li></ol><p>ç†è§£äº†è¿™ä¸¤ç§æ–¹æ¡ˆçš„ä¼˜åŠ£ï¼Œå…·ä½“é€‰æ‹©å“ªä¸ªæ–¹æ¡ˆå°±å–å†³äºæ•°æ®åº“å›¢é˜Ÿæä¾›çš„èƒ½åŠ›äº†ã€‚ä½†ç›®å‰çœ‹ï¼Œè¶‹åŠ¿æ˜¯å¾€å¸¦ proxy çš„æ¶æ„æ–¹å‘å‘å±•çš„ã€‚</p><p>ä½†æ˜¯ï¼Œä¸è®ºä½¿ç”¨å“ªç§æ¶æ„ï¼Œä½ éƒ½ä¼šç¢°åˆ°æˆ‘ä»¬ä»Šå¤©è¦è®¨è®ºçš„é—®é¢˜ï¼šç”±äºä¸»ä»å¯èƒ½å­˜åœ¨å»¶è¿Ÿï¼Œå®¢æˆ·ç«¯æ‰§è¡Œå®Œä¸€ä¸ªæ›´æ–°äº‹åŠ¡åé©¬ä¸Šå‘èµ·æŸ¥è¯¢ï¼Œå¦‚æœæŸ¥è¯¢é€‰æ‹©çš„æ˜¯ä»åº“çš„è¯ï¼Œå°±æœ‰å¯èƒ½è¯»åˆ°åˆšåˆšçš„äº‹åŠ¡æ›´æ–°ä¹‹å‰çš„çŠ¶æ€ã€‚</p><p><strong>è¿™ç§â€œåœ¨ä»åº“ä¸Šä¼šè¯»åˆ°ç³»ç»Ÿçš„ä¸€ä¸ªè¿‡æœŸçŠ¶æ€â€çš„ç°è±¡ï¼Œåœ¨è¿™ç¯‡æ–‡ç« é‡Œï¼Œæˆ‘ä»¬æš‚ä¸”ç§°ä¹‹ä¸ºâ€œè¿‡æœŸè¯»â€ã€‚</strong></p><p>å‰é¢æˆ‘ä»¬è¯´è¿‡äº†å‡ ç§å¯èƒ½å¯¼è‡´ä¸»å¤‡å»¶è¿Ÿçš„åŸå› ï¼Œä»¥åŠå¯¹åº”çš„ä¼˜åŒ–ç­–ç•¥ï¼Œä½†æ˜¯ä¸»ä»å»¶è¿Ÿè¿˜æ˜¯ä¸èƒ½ 100% é¿å…çš„ã€‚</p><p>ä¸è®ºå“ªç§ç»“æ„ï¼Œå®¢æˆ·ç«¯éƒ½å¸Œæœ›æŸ¥è¯¢ä»åº“çš„æ•°æ®ç»“æœï¼Œè·ŸæŸ¥ä¸»åº“çš„æ•°æ®ç»“æœæ˜¯ä¸€æ ·çš„ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±æ¥è®¨è®ºæ€ä¹ˆå¤„ç†è¿‡æœŸè¯»é—®é¢˜ã€‚</p><p>è¿™é‡Œï¼Œæˆ‘å…ˆæŠŠæ–‡ç« ä¸­æ¶‰åŠåˆ°çš„å¤„ç†è¿‡æœŸè¯»çš„æ–¹æ¡ˆæ±‡æ€»åœ¨è¿™é‡Œï¼Œä»¥å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å’ŒæŒæ¡å…¨æ–‡çš„çŸ¥è¯†è„‰ç»œã€‚è¿™äº›æ–¹æ¡ˆåŒ…æ‹¬ï¼š</p><ul><li>å¼ºåˆ¶èµ°ä¸»åº“æ–¹æ¡ˆï¼›</li><li>sleep æ–¹æ¡ˆï¼›</li><li>åˆ¤æ–­ä¸»å¤‡æ— å»¶è¿Ÿæ–¹æ¡ˆï¼›</li><li>é…åˆ semi-sync æ–¹æ¡ˆï¼›</li><li>ç­‰ä¸»åº“ä½ç‚¹æ–¹æ¡ˆï¼›</li><li>ç­‰ GTID æ–¹æ¡ˆã€‚</li></ul><h4 id="å¼ºåˆ¶èµ°ä¸»åº“æ–¹æ¡ˆ" tabindex="-1"><a class="header-anchor" href="#å¼ºåˆ¶èµ°ä¸»åº“æ–¹æ¡ˆ" aria-hidden="true">#</a> å¼ºåˆ¶èµ°ä¸»åº“æ–¹æ¡ˆ</h4><p>å¼ºåˆ¶èµ°ä¸»åº“æ–¹æ¡ˆå…¶å®å°±æ˜¯ï¼Œå°†æŸ¥è¯¢è¯·æ±‚åšåˆ†ç±»ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥å°†æŸ¥è¯¢è¯·æ±‚åˆ†ä¸ºè¿™ä¹ˆä¸¤ç±»ï¼š</p><ol><li>å¯¹äºå¿…é¡»è¦æ‹¿åˆ°æœ€æ–°ç»“æœçš„è¯·æ±‚ï¼Œå¼ºåˆ¶å°†å…¶å‘åˆ°ä¸»åº“ä¸Šã€‚æ¯”å¦‚ï¼Œåœ¨ä¸€ä¸ªäº¤æ˜“å¹³å°ä¸Šï¼Œå–å®¶å‘å¸ƒå•†å“ä»¥åï¼Œé©¬ä¸Šè¦è¿”å›ä¸»é¡µé¢ï¼Œçœ‹å•†å“æ˜¯å¦å‘å¸ƒæˆåŠŸã€‚é‚£ä¹ˆï¼Œè¿™ä¸ªè¯·æ±‚éœ€è¦æ‹¿åˆ°æœ€æ–°çš„ç»“æœï¼Œå°±å¿…é¡»èµ°ä¸»åº“ã€‚</li><li>å¯¹äºå¯ä»¥è¯»åˆ°æ—§æ•°æ®çš„è¯·æ±‚ï¼Œæ‰å°†å…¶å‘åˆ°ä»åº“ä¸Šã€‚åœ¨è¿™ä¸ªäº¤æ˜“å¹³å°ä¸Šï¼Œä¹°å®¶æ¥é€›å•†é“ºé¡µé¢ï¼Œå°±ç®—æ™šå‡ ç§’çœ‹åˆ°æœ€æ–°å‘å¸ƒçš„å•†å“ï¼Œä¹Ÿæ˜¯å¯ä»¥æ¥å—çš„ã€‚é‚£ä¹ˆï¼Œè¿™ç±»è¯·æ±‚å°±å¯ä»¥èµ°ä»åº“ã€‚</li></ol><p>ä½ å¯èƒ½ä¼šè¯´ï¼Œè¿™ä¸ªæ–¹æ¡ˆæ˜¯ä¸æ˜¯æœ‰ç‚¹ç•éš¾å’Œå–å·§çš„æ„æ€ï¼Œä½†å…¶å®è¿™ä¸ªæ–¹æ¡ˆæ˜¯ç”¨å¾—æœ€å¤šçš„ã€‚</p><p>å½“ç„¶ï¼Œè¿™ä¸ªæ–¹æ¡ˆæœ€å¤§çš„é—®é¢˜åœ¨äºï¼Œæœ‰æ—¶å€™ä½ ä¼šç¢°åˆ°â€œæ‰€æœ‰æŸ¥è¯¢éƒ½ä¸èƒ½æ˜¯è¿‡æœŸè¯»â€çš„éœ€æ±‚ï¼Œæ¯”å¦‚ä¸€äº›é‡‘èç±»çš„ä¸šåŠ¡ã€‚è¿™æ ·çš„è¯ï¼Œä½ å°±è¦æ”¾å¼ƒè¯»å†™åˆ†ç¦»ï¼Œæ‰€æœ‰è¯»å†™å‹åŠ›éƒ½åœ¨ä¸»åº“ï¼Œç­‰åŒäºæ”¾å¼ƒäº†æ‰©å±•æ€§ã€‚</p><p>å› æ­¤æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥è®¨è®ºçš„è¯é¢˜æ˜¯ï¼šå¯ä»¥æ”¯æŒè¯»å†™åˆ†ç¦»çš„åœºæ™¯ä¸‹ï¼Œæœ‰å“ªäº›è§£å†³è¿‡æœŸè¯»çš„æ–¹æ¡ˆï¼Œå¹¶åˆ†æå„ä¸ªæ–¹æ¡ˆçš„ä¼˜ç¼ºç‚¹ã€‚</p><h4 id="sleep-æ–¹æ¡ˆ" tabindex="-1"><a class="header-anchor" href="#sleep-æ–¹æ¡ˆ" aria-hidden="true">#</a> Sleep æ–¹æ¡ˆ</h4><p>ä¸»åº“æ›´æ–°åï¼Œè¯»ä»åº“ä¹‹å‰å…ˆ sleep ä¸€ä¸‹ã€‚å…·ä½“çš„æ–¹æ¡ˆå°±æ˜¯ï¼Œç±»ä¼¼äºæ‰§è¡Œä¸€æ¡ select sleep(1) å‘½ä»¤ã€‚</p><p>è¿™ä¸ªæ–¹æ¡ˆçš„å‡è®¾æ˜¯ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ä¸»å¤‡å»¶è¿Ÿåœ¨ 1 ç§’ä¹‹å†…ï¼Œåšä¸€ä¸ª sleep å¯ä»¥æœ‰å¾ˆå¤§æ¦‚ç‡æ‹¿åˆ°æœ€æ–°çš„æ•°æ®ã€‚</p><p>è¿™ä¸ªæ–¹æ¡ˆç»™ä½ çš„ç¬¬ä¸€æ„Ÿè§‰ï¼Œå¾ˆå¯èƒ½æ˜¯ä¸é è°±å„¿ï¼Œåº”è¯¥ä¸ä¼šæœ‰äººç”¨å§ï¼Ÿå¹¶ä¸”ï¼Œä½ è¿˜å¯èƒ½ä¼šè¯´ï¼Œç›´æ¥åœ¨å‘èµ·æŸ¥è¯¢æ—¶å…ˆæ‰§è¡Œä¸€æ¡ sleep è¯­å¥ï¼Œç”¨æˆ·ä½“éªŒå¾ˆä¸å‹å¥½å•Šã€‚</p><p>ä½†ï¼Œè¿™ä¸ªæ€è·¯ç¡®å®å¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šè§£å†³é—®é¢˜ã€‚ä¸ºäº†çœ‹èµ·æ¥æ›´é è°±å„¿ï¼Œæˆ‘ä»¬å¯ä»¥æ¢ä¸€ç§æ–¹å¼ã€‚</p><p>ä»¥å–å®¶å‘å¸ƒå•†å“ä¸ºä¾‹ï¼Œå•†å“å‘å¸ƒåï¼Œç”¨ Ajaxï¼ˆAsynchronous JavaScript + XMLï¼Œå¼‚æ­¥ JavaScript å’Œ XMLï¼‰ç›´æ¥æŠŠå®¢æˆ·ç«¯è¾“å…¥çš„å†…å®¹ä½œä¸ºâ€œæ–°çš„å•†å“â€æ˜¾ç¤ºåœ¨é¡µé¢ä¸Šï¼Œè€Œä¸æ˜¯çœŸæ­£åœ°å»æ•°æ®åº“åšæŸ¥è¯¢ã€‚</p><p>è¿™æ ·ï¼Œå–å®¶å°±å¯ä»¥é€šè¿‡è¿™ä¸ªæ˜¾ç¤ºï¼Œæ¥ç¡®è®¤äº§å“å·²ç»å‘å¸ƒæˆåŠŸäº†ã€‚ç­‰åˆ°å–å®¶å†åˆ·æ–°é¡µé¢ï¼Œå»æŸ¥çœ‹å•†å“çš„æ—¶å€™ï¼Œå…¶å®å·²ç»è¿‡äº†ä¸€æ®µæ—¶é—´ï¼Œä¹Ÿå°±è¾¾åˆ°äº† sleep çš„ç›®çš„ï¼Œè¿›è€Œä¹Ÿå°±è§£å†³äº†è¿‡æœŸè¯»çš„é—®é¢˜ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ª sleep æ–¹æ¡ˆç¡®å®è§£å†³äº†ç±»ä¼¼åœºæ™¯ä¸‹çš„è¿‡æœŸè¯»é—®é¢˜ã€‚ä½†ï¼Œä»ä¸¥æ ¼æ„ä¹‰ä¸Šæ¥è¯´ï¼Œè¿™ä¸ªæ–¹æ¡ˆå­˜åœ¨çš„é—®é¢˜å°±æ˜¯ä¸ç²¾ç¡®ã€‚è¿™ä¸ªä¸ç²¾ç¡®åŒ…å«äº†ä¸¤å±‚æ„æ€ï¼š</p><ol><li>å¦‚æœè¿™ä¸ªæŸ¥è¯¢è¯·æ±‚æœ¬æ¥ 0.5 ç§’å°±å¯ä»¥åœ¨ä»åº“ä¸Šæ‹¿åˆ°æ­£ç¡®ç»“æœï¼Œä¹Ÿä¼šç­‰ 1 ç§’ï¼›</li><li>å¦‚æœå»¶è¿Ÿè¶…è¿‡ 1 ç§’ï¼Œè¿˜æ˜¯ä¼šå‡ºç°è¿‡æœŸè¯»ã€‚</li></ol><p>çœ‹åˆ°è¿™é‡Œï¼Œä½ æ˜¯ä¸æ˜¯æœ‰ä¸€ç§â€œä½ æ˜¯ä¸æ˜¯åœ¨é€—æˆ‘â€çš„æ„Ÿè§‰ï¼Œè¿™ä¸ªæ”¹è¿›æ–¹æ¡ˆè™½ç„¶å¯ä»¥è§£å†³ç±»ä¼¼ Ajax åœºæ™¯ä¸‹çš„è¿‡æœŸè¯»é—®é¢˜ï¼Œä½†è¿˜æ˜¯æ€ä¹ˆçœ‹éƒ½ä¸é è°±å„¿ã€‚åˆ«ç€æ€¥ï¼Œæ¥ä¸‹æ¥æˆ‘å°±å’Œä½ ä»‹ç»ä¸€äº›æ›´å‡†ç¡®çš„æ–¹æ¡ˆã€‚</p><h4 id="åˆ¤æ–­ä¸»å¤‡æ— å»¶è¿Ÿæ–¹æ¡ˆ" tabindex="-1"><a class="header-anchor" href="#åˆ¤æ–­ä¸»å¤‡æ— å»¶è¿Ÿæ–¹æ¡ˆ" aria-hidden="true">#</a> åˆ¤æ–­ä¸»å¤‡æ— å»¶è¿Ÿæ–¹æ¡ˆ</h4><p>è¦ç¡®ä¿å¤‡åº“æ— å»¶è¿Ÿï¼Œé€šå¸¸æœ‰ä¸‰ç§åšæ³•ã€‚</p><p>é€šè¿‡å‰é¢çš„[ç¬¬ 25 ç¯‡]æ–‡ç« ï¼Œæˆ‘ä»¬çŸ¥é“ show slave status ç»“æœé‡Œçš„ seconds_behind_master å‚æ•°çš„å€¼ï¼Œå¯ä»¥ç”¨æ¥è¡¡é‡ä¸»å¤‡å»¶è¿Ÿæ—¶é—´çš„é•¿çŸ­ã€‚</p><p>æ‰€ä»¥**ç¬¬ä¸€ç§ç¡®ä¿ä¸»å¤‡æ— å»¶è¿Ÿçš„æ–¹æ³•æ˜¯ï¼Œ**æ¯æ¬¡ä»åº“æ‰§è¡ŒæŸ¥è¯¢è¯·æ±‚å‰ï¼Œå…ˆåˆ¤æ–­ seconds_behind_master æ˜¯å¦å·²ç»ç­‰äº 0ã€‚å¦‚æœè¿˜ä¸ç­‰äº 0 ï¼Œé‚£å°±å¿…é¡»ç­‰åˆ°è¿™ä¸ªå‚æ•°å˜ä¸º 0 æ‰èƒ½æ‰§è¡ŒæŸ¥è¯¢è¯·æ±‚ã€‚</p><p>seconds_behind_master çš„å•ä½æ˜¯ç§’ï¼Œå¦‚æœä½ è§‰å¾—ç²¾åº¦ä¸å¤Ÿçš„è¯ï¼Œè¿˜å¯ä»¥é‡‡ç”¨å¯¹æ¯”ä½ç‚¹å’Œ GTID çš„æ–¹æ³•æ¥ç¡®ä¿ä¸»å¤‡æ— å»¶è¿Ÿï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æ¥ä¸‹æ¥è¦è¯´çš„ç¬¬äºŒå’Œç¬¬ä¸‰ç§æ–¹æ³•ã€‚</p><p>å¦‚å›¾ 3 æ‰€ç¤ºï¼Œæ˜¯ä¸€ä¸ª show slave status ç»“æœçš„éƒ¨åˆ†æˆªå›¾ã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/00110923007513e865d7f43a124887c1-1584367399854.png" alt="img"></p><p>å›¾ 3 show slave status ç»“æœ</p><p>ç°åœ¨ï¼Œæˆ‘ä»¬å°±é€šè¿‡è¿™ä¸ªç»“æœï¼Œæ¥çœ‹çœ‹å…·ä½“å¦‚ä½•é€šè¿‡å¯¹æ¯”ä½ç‚¹å’Œ GTID æ¥ç¡®ä¿ä¸»å¤‡æ— å»¶è¿Ÿã€‚</p><p>**ç¬¬äºŒç§æ–¹æ³•ï¼Œ**å¯¹æ¯”ä½ç‚¹ç¡®ä¿ä¸»å¤‡æ— å»¶è¿Ÿï¼š</p><ul><li>Master_Log_File å’Œ Read_Master_Log_Posï¼Œè¡¨ç¤ºçš„æ˜¯è¯»åˆ°çš„ä¸»åº“çš„æœ€æ–°ä½ç‚¹ï¼›</li><li>Relay_Master_Log_File å’Œ Exec_Master_Log_Posï¼Œè¡¨ç¤ºçš„æ˜¯å¤‡åº“æ‰§è¡Œçš„æœ€æ–°ä½ç‚¹ã€‚</li></ul><p>å¦‚æœ Master_Log_File å’Œ Relay_Master_Log_Fileã€Read_Master_Log_Pos å’Œ Exec_Master_Log_Pos è¿™ä¸¤ç»„å€¼å®Œå…¨ç›¸åŒï¼Œå°±è¡¨ç¤ºæ¥æ”¶åˆ°çš„æ—¥å¿—å·²ç»åŒæ­¥å®Œæˆã€‚</p><p>**ç¬¬ä¸‰ç§æ–¹æ³•ï¼Œ**å¯¹æ¯” GTID é›†åˆç¡®ä¿ä¸»å¤‡æ— å»¶è¿Ÿï¼š</p><ul><li>Auto_Position=1 ï¼Œè¡¨ç¤ºè¿™å¯¹ä¸»å¤‡å…³ç³»ä½¿ç”¨äº† GTID åè®®ã€‚</li><li>Retrieved_Gtid_Setï¼Œæ˜¯å¤‡åº“æ”¶åˆ°çš„æ‰€æœ‰æ—¥å¿—çš„ GTID é›†åˆï¼›</li><li>Executed_Gtid_Setï¼Œæ˜¯å¤‡åº“æ‰€æœ‰å·²ç»æ‰§è¡Œå®Œæˆçš„ GTID é›†åˆã€‚</li></ul><p>å¦‚æœè¿™ä¸¤ä¸ªé›†åˆç›¸åŒï¼Œä¹Ÿè¡¨ç¤ºå¤‡åº“æ¥æ”¶åˆ°çš„æ—¥å¿—éƒ½å·²ç»åŒæ­¥å®Œæˆã€‚</p><p>å¯è§ï¼Œå¯¹æ¯”ä½ç‚¹å’Œå¯¹æ¯” GTID è¿™ä¸¤ç§æ–¹æ³•ï¼Œéƒ½è¦æ¯”åˆ¤æ–­ seconds_behind_master æ˜¯å¦ä¸º 0 æ›´å‡†ç¡®ã€‚</p><p>åœ¨æ‰§è¡ŒæŸ¥è¯¢è¯·æ±‚ä¹‹å‰ï¼Œå…ˆåˆ¤æ–­ä»åº“æ˜¯å¦åŒæ­¥å®Œæˆçš„æ–¹æ³•ï¼Œç›¸æ¯”äº sleep æ–¹æ¡ˆï¼Œå‡†ç¡®åº¦ç¡®å®æå‡äº†ä¸å°‘ï¼Œä½†è¿˜æ˜¯æ²¡æœ‰è¾¾åˆ°â€œç²¾ç¡®â€çš„ç¨‹åº¦ã€‚ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬ç°åœ¨ä¸€èµ·æ¥å›é¡¾ä¸‹ï¼Œä¸€ä¸ªäº‹åŠ¡çš„ binlog åœ¨ä¸»å¤‡åº“ä¹‹é—´çš„çŠ¶æ€ï¼š</p><ol><li>ä¸»åº“æ‰§è¡Œå®Œæˆï¼Œå†™å…¥ binlogï¼Œå¹¶åé¦ˆç»™å®¢æˆ·ç«¯ï¼›</li><li>binlog è¢«ä»ä¸»åº“å‘é€ç»™å¤‡åº“ï¼Œå¤‡åº“æ”¶åˆ°ï¼›</li><li>åœ¨å¤‡åº“æ‰§è¡Œ binlog å®Œæˆã€‚</li></ol><p>æˆ‘ä»¬ä¸Šé¢åˆ¤æ–­ä¸»å¤‡æ— å»¶è¿Ÿçš„é€»è¾‘ï¼Œæ˜¯â€œå¤‡åº“æ”¶åˆ°çš„æ—¥å¿—éƒ½æ‰§è¡Œå®Œæˆäº†â€ã€‚ä½†æ˜¯ï¼Œä» binlog åœ¨ä¸»å¤‡ä¹‹é—´çŠ¶æ€çš„åˆ†æä¸­ï¼Œä¸éš¾çœ‹å‡ºè¿˜æœ‰ä¸€éƒ¨åˆ†æ—¥å¿—ï¼Œå¤„äºå®¢æˆ·ç«¯å·²ç»æ”¶åˆ°æäº¤ç¡®è®¤ï¼Œè€Œå¤‡åº“è¿˜æ²¡æ”¶åˆ°æ—¥å¿—çš„çŠ¶æ€ã€‚</p><p>å¦‚å›¾ 4 æ‰€ç¤ºå°±æ˜¯è¿™æ ·çš„ä¸€ä¸ªçŠ¶æ€ã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/557445207b57d6c0f2747509d7d6619e-1584367399858.png" alt="img"></p><p>å›¾ 4 å¤‡åº“è¿˜æ²¡æ”¶åˆ° trx3</p><p>è¿™æ—¶ï¼Œä¸»åº“ä¸Šæ‰§è¡Œå®Œæˆäº†ä¸‰ä¸ªäº‹åŠ¡ trx1ã€trx2 å’Œ trx3ï¼Œå…¶ä¸­ï¼š</p><ol><li>trx1 å’Œ trx2 å·²ç»ä¼ åˆ°ä»åº“ï¼Œå¹¶ä¸”å·²ç»æ‰§è¡Œå®Œæˆäº†ï¼›</li><li>trx3 åœ¨ä¸»åº“æ‰§è¡Œå®Œæˆï¼Œå¹¶ä¸”å·²ç»å›å¤ç»™å®¢æˆ·ç«¯ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰ä¼ åˆ°ä»åº“ä¸­ã€‚</li></ol><p>å¦‚æœè¿™æ—¶å€™ä½ åœ¨ä»åº“ B ä¸Šæ‰§è¡ŒæŸ¥è¯¢è¯·æ±‚ï¼ŒæŒ‰ç…§æˆ‘ä»¬ä¸Šé¢çš„é€»è¾‘ï¼Œä»åº“è®¤ä¸ºå·²ç»æ²¡æœ‰åŒæ­¥å»¶è¿Ÿï¼Œä½†è¿˜æ˜¯æŸ¥ä¸åˆ° trx3 çš„ã€‚ä¸¥æ ¼åœ°è¯´ï¼Œå°±æ˜¯å‡ºç°äº†è¿‡æœŸè¯»ã€‚</p><p>é‚£ä¹ˆï¼Œè¿™ä¸ªé—®é¢˜æœ‰æ²¡æœ‰åŠæ³•è§£å†³å‘¢ï¼Ÿ</p><h4 id="é…åˆ-semi-sync" tabindex="-1"><a class="header-anchor" href="#é…åˆ-semi-sync" aria-hidden="true">#</a> é…åˆ semi-sync</h4><p>è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå°±è¦å¼•å…¥åŠåŒæ­¥å¤åˆ¶ï¼Œä¹Ÿå°±æ˜¯ semi-sync replicationã€‚</p><p>semi-sync åšäº†è¿™æ ·çš„è®¾è®¡ï¼š</p><ol><li>äº‹åŠ¡æäº¤çš„æ—¶å€™ï¼Œä¸»åº“æŠŠ binlog å‘ç»™ä»åº“ï¼›</li><li>ä»åº“æ”¶åˆ° binlog ä»¥åï¼Œå‘å›ç»™ä¸»åº“ä¸€ä¸ª ackï¼Œè¡¨ç¤ºæ”¶åˆ°äº†ï¼›</li><li>ä¸»åº“æ”¶åˆ°è¿™ä¸ª ack ä»¥åï¼Œæ‰èƒ½ç»™å®¢æˆ·ç«¯è¿”å›â€œäº‹åŠ¡å®Œæˆâ€çš„ç¡®è®¤ã€‚</li></ol><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœå¯ç”¨äº† semi-syncï¼Œå°±è¡¨ç¤ºæ‰€æœ‰ç»™å®¢æˆ·ç«¯å‘é€è¿‡ç¡®è®¤çš„äº‹åŠ¡ï¼Œéƒ½ç¡®ä¿äº†å¤‡åº“å·²ç»æ”¶åˆ°äº†è¿™ä¸ªæ—¥å¿—ã€‚</p><p>åœ¨[ç¬¬ 25 ç¯‡æ–‡ç« ]çš„è¯„è®ºåŒºï¼Œæœ‰åŒå­¦é—®åˆ°ï¼šå¦‚æœä¸»åº“æ‰ç”µçš„æ—¶å€™ï¼Œæœ‰äº› binlog è¿˜æ¥ä¸åŠå‘ç»™ä»åº“ï¼Œä¼šä¸ä¼šå¯¼è‡´ç³»ç»Ÿæ•°æ®ä¸¢å¤±ï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯ï¼Œå¦‚æœä½¿ç”¨çš„æ˜¯æ™®é€šçš„å¼‚æ­¥å¤åˆ¶æ¨¡å¼ï¼Œå°±å¯èƒ½ä¼šä¸¢å¤±ï¼Œä½† semi-sync å°±å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><p>è¿™æ ·ï¼Œsemi-sync é…åˆå‰é¢å…³äºä½ç‚¹çš„åˆ¤æ–­ï¼Œå°±èƒ½å¤Ÿç¡®å®šåœ¨ä»åº“ä¸Šæ‰§è¡Œçš„æŸ¥è¯¢è¯·æ±‚ï¼Œå¯ä»¥é¿å…è¿‡æœŸè¯»ã€‚</p><p>ä½†æ˜¯ï¼Œsemi-sync+ ä½ç‚¹åˆ¤æ–­çš„æ–¹æ¡ˆï¼Œåªå¯¹ä¸€ä¸»ä¸€å¤‡çš„åœºæ™¯æ˜¯æˆç«‹çš„ã€‚åœ¨ä¸€ä¸»å¤šä»åœºæ™¯ä¸­ï¼Œä¸»åº“åªè¦ç­‰åˆ°ä¸€ä¸ªä»åº“çš„ ackï¼Œå°±å¼€å§‹ç»™å®¢æˆ·ç«¯è¿”å›ç¡®è®¤ã€‚è¿™æ—¶ï¼Œåœ¨ä»åº“ä¸Šæ‰§è¡ŒæŸ¥è¯¢è¯·æ±‚ï¼Œå°±æœ‰ä¸¤ç§æƒ…å†µï¼š</p><ol><li>å¦‚æœæŸ¥è¯¢æ˜¯è½åœ¨è¿™ä¸ªå“åº”äº† ack çš„ä»åº“ä¸Šï¼Œæ˜¯èƒ½å¤Ÿç¡®ä¿è¯»åˆ°æœ€æ–°æ•°æ®ï¼›</li><li>ä½†å¦‚æœæ˜¯æŸ¥è¯¢è½åˆ°å…¶ä»–ä»åº“ä¸Šï¼Œå®ƒä»¬å¯èƒ½è¿˜æ²¡æœ‰æ”¶åˆ°æœ€æ–°çš„æ—¥å¿—ï¼Œå°±ä¼šäº§ç”Ÿè¿‡æœŸè¯»çš„é—®é¢˜ã€‚</li></ol><p>å…¶å®ï¼Œåˆ¤æ–­åŒæ­¥ä½ç‚¹çš„æ–¹æ¡ˆè¿˜æœ‰å¦å¤–ä¸€ä¸ªæ½œåœ¨çš„é—®é¢˜ï¼Œå³ï¼šå¦‚æœåœ¨ä¸šåŠ¡æ›´æ–°çš„é«˜å³°æœŸï¼Œä¸»åº“çš„ä½ç‚¹æˆ–è€… GTID é›†åˆæ›´æ–°å¾ˆå¿«ï¼Œé‚£ä¹ˆä¸Šé¢çš„ä¸¤ä¸ªä½ç‚¹ç­‰å€¼åˆ¤æ–­å°±ä¼šä¸€ç›´ä¸æˆç«‹ï¼Œå¾ˆå¯èƒ½å‡ºç°ä»åº“ä¸Šè¿Ÿè¿Ÿæ— æ³•å“åº”æŸ¥è¯¢è¯·æ±‚çš„æƒ…å†µã€‚</p><p>å®é™…ä¸Šï¼Œå›åˆ°æˆ‘ä»¬æœ€åˆçš„ä¸šåŠ¡é€»è¾‘é‡Œï¼Œå½“å‘èµ·ä¸€ä¸ªæŸ¥è¯¢è¯·æ±‚ä»¥åï¼Œæˆ‘ä»¬è¦å¾—åˆ°å‡†ç¡®çš„ç»“æœï¼Œå…¶å®å¹¶ä¸éœ€è¦ç­‰åˆ°â€œä¸»å¤‡å®Œå…¨åŒæ­¥â€ã€‚</p><p>ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Ÿæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¿™ä¸ªæ—¶åºå›¾ã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/9cf54f3e91dc8f7b8947d7d8e384aa09-1584367399864.png" alt="img"></p><p>å›¾ 5 ä¸»å¤‡æŒç»­å»¶è¿Ÿä¸€ä¸ªäº‹åŠ¡</p><p>å›¾ 5 æ‰€ç¤ºï¼Œå°±æ˜¯ç­‰å¾…ä½ç‚¹æ–¹æ¡ˆçš„ä¸€ä¸ª bad caseã€‚å›¾ä¸­å¤‡åº“ B ä¸‹çš„è™šçº¿æ¡†ï¼Œåˆ†åˆ«è¡¨ç¤º relaylog å’Œ binlog ä¸­çš„äº‹åŠ¡ã€‚å¯ä»¥çœ‹åˆ°ï¼Œå›¾ 5 ä¸­ä»çŠ¶æ€ 1 åˆ°çŠ¶æ€ 4ï¼Œä¸€ç›´å¤„äºå»¶è¿Ÿä¸€ä¸ªäº‹åŠ¡çš„çŠ¶æ€ã€‚</p><p>å¤‡åº“ B ä¸€ç›´åˆ°çŠ¶æ€ 4 éƒ½å’Œä¸»åº“ A å­˜åœ¨å»¶è¿Ÿï¼Œå¦‚æœç”¨ä¸Šé¢å¿…é¡»ç­‰åˆ°æ— å»¶è¿Ÿæ‰èƒ½æŸ¥è¯¢çš„æ–¹æ¡ˆï¼Œselect è¯­å¥ç›´åˆ°çŠ¶æ€ 4 éƒ½ä¸èƒ½è¢«æ‰§è¡Œã€‚</p><p>ä½†æ˜¯ï¼Œå…¶å®å®¢æˆ·ç«¯æ˜¯åœ¨å‘å®Œ trx1 æ›´æ–°åå‘èµ·çš„ select è¯­å¥ï¼Œæˆ‘ä»¬åªéœ€è¦ç¡®ä¿ trx1 å·²ç»æ‰§è¡Œå®Œæˆå°±å¯ä»¥æ‰§è¡Œ select è¯­å¥äº†ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœåœ¨çŠ¶æ€ 3 æ‰§è¡ŒæŸ¥è¯¢è¯·æ±‚ï¼Œå¾—åˆ°çš„å°±æ˜¯é¢„æœŸç»“æœäº†ã€‚</p><p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å°ç»“ä¸€ä¸‹ï¼Œsemi-sync é…åˆåˆ¤æ–­ä¸»å¤‡æ— å»¶è¿Ÿçš„æ–¹æ¡ˆï¼Œå­˜åœ¨ä¸¤ä¸ªé—®é¢˜ï¼š</p><ol><li>ä¸€ä¸»å¤šä»çš„æ—¶å€™ï¼Œåœ¨æŸäº›ä»åº“æ‰§è¡ŒæŸ¥è¯¢è¯·æ±‚ä¼šå­˜åœ¨è¿‡æœŸè¯»çš„ç°è±¡ï¼›</li><li>åœ¨æŒç»­å»¶è¿Ÿçš„æƒ…å†µä¸‹ï¼Œå¯èƒ½å‡ºç°è¿‡åº¦ç­‰å¾…çš„é—®é¢˜ã€‚</li></ol><p>æ¥ä¸‹æ¥ï¼Œæˆ‘è¦å’Œä½ ä»‹ç»çš„ç­‰ä¸»åº“ä½ç‚¹æ–¹æ¡ˆï¼Œå°±å¯ä»¥è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜ã€‚</p><h4 id="ç­‰ä¸»åº“ä½ç‚¹æ–¹æ¡ˆ" tabindex="-1"><a class="header-anchor" href="#ç­‰ä¸»åº“ä½ç‚¹æ–¹æ¡ˆ" aria-hidden="true">#</a> ç­‰ä¸»åº“ä½ç‚¹æ–¹æ¡ˆ</h4><p>è¦ç†è§£ç­‰ä¸»åº“ä½ç‚¹æ–¹æ¡ˆï¼Œæˆ‘éœ€è¦å…ˆå’Œä½ ä»‹ç»ä¸€æ¡å‘½ä»¤ï¼š</p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">select</span> <span class="token function">master_pos_wait</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> pos<span class="token punctuation">[</span><span class="token punctuation">,</span> timeout<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>è¿™æ¡å‘½ä»¤çš„é€»è¾‘å¦‚ä¸‹ï¼š</p><ol><li>å®ƒæ˜¯åœ¨ä»åº“æ‰§è¡Œçš„ï¼›</li><li>å‚æ•° file å’Œ pos æŒ‡çš„æ˜¯ä¸»åº“ä¸Šçš„æ–‡ä»¶åå’Œä½ç½®ï¼›</li><li>timeout å¯é€‰ï¼Œè®¾ç½®ä¸ºæ­£æ•´æ•° N è¡¨ç¤ºè¿™ä¸ªå‡½æ•°æœ€å¤šç­‰å¾… N ç§’ã€‚</li></ol><p>è¿™ä¸ªå‘½ä»¤æ­£å¸¸è¿”å›çš„ç»“æœæ˜¯ä¸€ä¸ªæ­£æ•´æ•° Mï¼Œè¡¨ç¤ºä»å‘½ä»¤å¼€å§‹æ‰§è¡Œï¼Œåˆ°åº”ç”¨å®Œ file å’Œ pos è¡¨ç¤ºçš„ binlog ä½ç½®ï¼Œæ‰§è¡Œäº†å¤šå°‘äº‹åŠ¡ã€‚</p><p>å½“ç„¶ï¼Œé™¤äº†æ­£å¸¸è¿”å›ä¸€ä¸ªæ­£æ•´æ•° M å¤–ï¼Œè¿™æ¡å‘½ä»¤è¿˜ä¼šè¿”å›ä¸€äº›å…¶ä»–ç»“æœï¼ŒåŒ…æ‹¬ï¼š</p><ol><li>å¦‚æœæ‰§è¡ŒæœŸé—´ï¼Œå¤‡åº“åŒæ­¥çº¿ç¨‹å‘ç”Ÿå¼‚å¸¸ï¼Œåˆ™è¿”å› NULLï¼›</li><li>å¦‚æœç­‰å¾…è¶…è¿‡ N ç§’ï¼Œå°±è¿”å› -1ï¼›</li><li>å¦‚æœåˆšå¼€å§‹æ‰§è¡Œçš„æ—¶å€™ï¼Œå°±å‘ç°å·²ç»æ‰§è¡Œè¿‡è¿™ä¸ªä½ç½®äº†ï¼Œåˆ™è¿”å› 0ã€‚</li></ol><p>å¯¹äºå›¾ 5 ä¸­å…ˆæ‰§è¡Œ trx1ï¼Œå†æ‰§è¡Œä¸€ä¸ªæŸ¥è¯¢è¯·æ±‚çš„é€»è¾‘ï¼Œè¦ä¿è¯èƒ½å¤ŸæŸ¥åˆ°æ­£ç¡®çš„æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªé€»è¾‘ï¼š</p><ol><li>trx1 äº‹åŠ¡æ›´æ–°å®Œæˆåï¼Œé©¬ä¸Šæ‰§è¡Œ show master status å¾—åˆ°å½“å‰ä¸»åº“æ‰§è¡Œåˆ°çš„ File å’Œ Positionï¼›</li><li>é€‰å®šä¸€ä¸ªä»åº“æ‰§è¡ŒæŸ¥è¯¢è¯­å¥ï¼›</li><li>åœ¨ä»åº“ä¸Šæ‰§è¡Œ select master_pos_wait(File, Position, 1)ï¼›</li><li>å¦‚æœè¿”å›å€¼æ˜¯ &gt;=0 çš„æ­£æ•´æ•°ï¼Œåˆ™åœ¨è¿™ä¸ªä»åº“æ‰§è¡ŒæŸ¥è¯¢è¯­å¥ï¼›</li><li>å¦åˆ™ï¼Œåˆ°ä¸»åº“æ‰§è¡ŒæŸ¥è¯¢è¯­å¥ã€‚</li></ol><p>æˆ‘æŠŠä¸Šé¢è¿™ä¸ªæµç¨‹ç”»å‡ºæ¥ã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/b20ae91ea46803df1b63ed683e1de357-1584367399926.png" alt="img"></p><p>å›¾ 6 master_pos_wait æ–¹æ¡ˆ</p><p>è¿™é‡Œæˆ‘ä»¬å‡è®¾ï¼Œè¿™æ¡ select æŸ¥è¯¢æœ€å¤šåœ¨ä»åº“ä¸Šç­‰å¾… 1 ç§’ã€‚é‚£ä¹ˆï¼Œå¦‚æœ 1 ç§’å†… master_pos_wait è¿”å›ä¸€ä¸ªå¤§äºç­‰äº 0 çš„æ•´æ•°ï¼Œå°±ç¡®ä¿äº†ä»åº“ä¸Šæ‰§è¡Œçš„è¿™ä¸ªæŸ¥è¯¢ç»“æœä¸€å®šåŒ…å«äº† trx1 çš„æ•°æ®ã€‚</p><p>æ­¥éª¤ 5 åˆ°ä¸»åº“æ‰§è¡ŒæŸ¥è¯¢è¯­å¥ï¼Œæ˜¯è¿™ç±»æ–¹æ¡ˆå¸¸ç”¨çš„é€€åŒ–æœºåˆ¶ã€‚å› ä¸ºä»åº“çš„å»¶è¿Ÿæ—¶é—´ä¸å¯æ§ï¼Œä¸èƒ½æ— é™ç­‰å¾…ï¼Œæ‰€ä»¥å¦‚æœç­‰å¾…è¶…æ—¶ï¼Œå°±åº”è¯¥æ”¾å¼ƒï¼Œç„¶ååˆ°ä¸»åº“å»æŸ¥ã€‚</p><p>ä½ å¯èƒ½ä¼šè¯´ï¼Œå¦‚æœæ‰€æœ‰çš„ä»åº“éƒ½å»¶è¿Ÿè¶…è¿‡ 1 ç§’äº†ï¼Œé‚£æŸ¥è¯¢å‹åŠ›ä¸å°±éƒ½è·‘åˆ°ä¸»åº“ä¸Šäº†å—ï¼Ÿç¡®å®æ˜¯è¿™æ ·ã€‚</p><p>ä½†æ˜¯ï¼ŒæŒ‰ç…§æˆ‘ä»¬è®¾å®šä¸å…è®¸è¿‡æœŸè¯»çš„è¦æ±‚ï¼Œå°±åªæœ‰ä¸¤ç§é€‰æ‹©ï¼Œä¸€ç§æ˜¯è¶…æ—¶æ”¾å¼ƒï¼Œä¸€ç§æ˜¯è½¬åˆ°ä¸»åº“æŸ¥è¯¢ã€‚å…·ä½“æ€ä¹ˆé€‰æ‹©ï¼Œå°±éœ€è¦ä¸šåŠ¡å¼€å‘åŒå­¦åšå¥½é™æµç­–ç•¥äº†ã€‚</p><h4 id="gtid-æ–¹æ¡ˆ" tabindex="-1"><a class="header-anchor" href="#gtid-æ–¹æ¡ˆ" aria-hidden="true">#</a> GTID æ–¹æ¡ˆ</h4><p>å¦‚æœä½ çš„æ•°æ®åº“å¼€å¯äº† GTID æ¨¡å¼ï¼Œå¯¹åº”çš„ä¹Ÿæœ‰ç­‰å¾… GTID çš„æ–¹æ¡ˆã€‚</p><p>MySQL ä¸­åŒæ ·æä¾›äº†ä¸€ä¸ªç±»ä¼¼çš„å‘½ä»¤ï¼š</p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code> <span class="token keyword">select</span> <span class="token function">wait_for_executed_gtid_set</span><span class="token punctuation">(</span>gtid_set<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>è¿™æ¡å‘½ä»¤çš„é€»è¾‘æ˜¯ï¼š</p><ol><li>ç­‰å¾…ï¼Œç›´åˆ°è¿™ä¸ªåº“æ‰§è¡Œçš„äº‹åŠ¡ä¸­åŒ…å«ä¼ å…¥çš„ gtid_setï¼Œè¿”å› 0ï¼›</li><li>è¶…æ—¶è¿”å› 1ã€‚</li></ol><p>åœ¨å‰é¢ç­‰ä½ç‚¹çš„æ–¹æ¡ˆä¸­ï¼Œæˆ‘ä»¬æ‰§è¡Œå®Œäº‹åŠ¡åï¼Œè¿˜è¦ä¸»åŠ¨å»ä¸»åº“æ‰§è¡Œ show master statusã€‚è€Œ MySQL 5.7.6 ç‰ˆæœ¬å¼€å§‹ï¼Œå…è®¸åœ¨æ‰§è¡Œå®Œæ›´æ–°ç±»äº‹åŠ¡åï¼ŒæŠŠè¿™ä¸ªäº‹åŠ¡çš„ GTID è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œè¿™æ ·ç­‰ GTID çš„æ–¹æ¡ˆå°±å¯ä»¥å‡å°‘ä¸€æ¬¡æŸ¥è¯¢ã€‚</p><p>è¿™æ—¶ï¼Œç­‰ GTID çš„æ‰§è¡Œæµç¨‹å°±å˜æˆäº†ï¼š</p><ol><li>trx1 äº‹åŠ¡æ›´æ–°å®Œæˆåï¼Œä»è¿”å›åŒ…ç›´æ¥è·å–è¿™ä¸ªäº‹åŠ¡çš„ GTIDï¼Œè®°ä¸º gtid1ï¼›</li><li>é€‰å®šä¸€ä¸ªä»åº“æ‰§è¡ŒæŸ¥è¯¢è¯­å¥ï¼›</li><li>åœ¨ä»åº“ä¸Šæ‰§è¡Œ select wait_for_executed_gtid_set(gtid1, 1)ï¼›</li><li>å¦‚æœè¿”å›å€¼æ˜¯ 0ï¼Œåˆ™åœ¨è¿™ä¸ªä»åº“æ‰§è¡ŒæŸ¥è¯¢è¯­å¥ï¼›</li><li>å¦åˆ™ï¼Œåˆ°ä¸»åº“æ‰§è¡ŒæŸ¥è¯¢è¯­å¥ã€‚</li></ol><p>è·Ÿç­‰ä¸»åº“ä½ç‚¹çš„æ–¹æ¡ˆä¸€æ ·ï¼Œç­‰å¾…è¶…æ—¶åæ˜¯å¦ç›´æ¥åˆ°ä¸»åº“æŸ¥è¯¢ï¼Œéœ€è¦ä¸šåŠ¡å¼€å‘åŒå­¦æ¥åšé™æµè€ƒè™‘ã€‚</p><p>æˆ‘æŠŠè¿™ä¸ªæµç¨‹å›¾ç”»å‡ºæ¥ã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/d521de8017297aff59db2f68170ee739-1584367399972.png" alt="img"></p><p>å›¾ 7 wait_for_executed_gtid_set æ–¹æ¡ˆ</p><p>åœ¨ä¸Šé¢çš„ç¬¬ä¸€æ­¥ä¸­ï¼Œtrx1 äº‹åŠ¡æ›´æ–°å®Œæˆåï¼Œä»è¿”å›åŒ…ç›´æ¥è·å–è¿™ä¸ªäº‹åŠ¡çš„ GTIDã€‚é—®é¢˜æ˜¯ï¼Œæ€ä¹ˆèƒ½å¤Ÿè®© MySQL åœ¨æ‰§è¡Œäº‹åŠ¡åï¼Œè¿”å›åŒ…ä¸­å¸¦ä¸Š GTID å‘¢ï¼Ÿ</p><p>ä½ åªéœ€è¦å°†å‚æ•° session_track_gtids è®¾ç½®ä¸º OWN_GTIDï¼Œç„¶åé€šè¿‡ API æ¥å£ mysql_session_track_get_first ä»è¿”å›åŒ…è§£æå‡º GTID çš„å€¼å³å¯ã€‚</p><p>åœ¨ä¸“æ çš„[ç¬¬ä¸€ç¯‡æ–‡ç« ]ä¸­ï¼Œæˆ‘ä»‹ç» mysql_reset_connection çš„æ—¶å€™ï¼Œè¯„è®ºåŒºæœ‰åŒå­¦ç•™è¨€é—®è¿™ç±»æ¥å£åº”è¯¥æ€ä¹ˆä½¿ç”¨ã€‚</p><p>è¿™é‡Œæˆ‘å†å›ç­”ä¸€ä¸‹ã€‚å…¶å®ï¼ŒMySQL å¹¶æ²¡æœ‰æä¾›è¿™ç±»æ¥å£çš„ SQL ç”¨æ³•ï¼Œæ˜¯æä¾›ç»™ç¨‹åºçš„ API(https://dev.mysql.com/doc/refman/5.7/en/c-api-functions.html)ã€‚</p><p>æ¯”å¦‚ï¼Œä¸ºäº†è®©å®¢æˆ·ç«¯åœ¨äº‹åŠ¡æäº¤åï¼Œè¿”å›çš„ GITD èƒ½å¤Ÿåœ¨å®¢æˆ·ç«¯æ˜¾ç¤ºå‡ºæ¥ï¼Œæˆ‘å¯¹ MySQL å®¢æˆ·ç«¯ä»£ç åšäº†ç‚¹ä¿®æ”¹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/973bdd8741f830acebe005cbf37a7663-1584367400038.png" alt="img"></p><p>å›¾ 8 æ˜¾ç¤ºæ›´æ–°äº‹åŠ¡çš„ GTID-- ä»£ç </p><p>è¿™æ ·ï¼Œå°±å¯ä»¥çœ‹åˆ°è¯­å¥æ‰§è¡Œå®Œæˆï¼Œæ˜¾ç¤ºå‡º GITD çš„å€¼ã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/253106d31d9d97aaa2846b2015f593fe-1584367400043.png" alt="img"></p><p>å›¾ 9 æ˜¾ç¤ºæ›´æ–°äº‹åŠ¡çš„ GTID-- æ•ˆæœ</p><p>å½“ç„¶äº†ï¼Œè¿™åªæ˜¯ä¸€ä¸ªä¾‹å­ã€‚ä½ è¦ä½¿ç”¨è¿™ä¸ªæ–¹æ¡ˆçš„æ—¶å€™ï¼Œè¿˜æ˜¯åº”è¯¥åœ¨ä½ çš„å®¢æˆ·ç«¯ä»£ç ä¸­è°ƒç”¨ mysql_session_track_get_first è¿™ä¸ªå‡½æ•°ã€‚</p><h4 id="å°ç»“-18" tabindex="-1"><a class="header-anchor" href="#å°ç»“-18" aria-hidden="true">#</a> å°ç»“</h4><p>åœ¨ä»Šå¤©è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘è·Ÿä½ ä»‹ç»äº†ä¸€ä¸»å¤šä»åšè¯»å†™åˆ†ç¦»æ—¶ï¼Œå¯èƒ½ç¢°åˆ°è¿‡æœŸè¯»çš„åŸå› ï¼Œä»¥åŠå‡ ç§åº”å¯¹çš„æ–¹æ¡ˆã€‚</p><p>è¿™å‡ ç§æ–¹æ¡ˆä¸­ï¼Œæœ‰çš„æ–¹æ¡ˆçœ‹ä¸Šå»æ˜¯åšäº†å¦¥åï¼Œæœ‰çš„æ–¹æ¡ˆçœ‹ä¸Šå»ä¸é‚£ä¹ˆé è°±å„¿ï¼Œä½†éƒ½æ˜¯æœ‰å®é™…åº”ç”¨åœºæ™¯çš„ï¼Œä½ éœ€è¦æ ¹æ®ä¸šåŠ¡éœ€æ±‚é€‰æ‹©ã€‚</p><p>å³ä½¿æ˜¯æœ€åç­‰å¾…ä½ç‚¹å’Œç­‰å¾… GTID è¿™ä¸¤ä¸ªæ–¹æ¡ˆï¼Œè™½ç„¶çœ‹ä¸Šå»æ¯”è¾ƒé è°±å„¿ï¼Œä½†ä»ç„¶å­˜åœ¨éœ€è¦æƒè¡¡çš„æƒ…å†µã€‚å¦‚æœæ‰€æœ‰çš„ä»åº“éƒ½å»¶è¿Ÿï¼Œé‚£ä¹ˆè¯·æ±‚å°±ä¼šå…¨éƒ¨è½åˆ°ä¸»åº“ä¸Šï¼Œè¿™æ—¶å€™ä¼šä¸ä¼šç”±äºå‹åŠ›çªç„¶å¢å¤§ï¼ŒæŠŠä¸»åº“æ‰“æŒ‚äº†å‘¢ï¼Ÿ</p><p>å…¶å®ï¼Œåœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™å‡ ä¸ªæ–¹æ¡ˆæ˜¯å¯ä»¥æ··åˆä½¿ç”¨çš„ã€‚</p><p>æ¯”å¦‚ï¼Œå…ˆåœ¨å®¢æˆ·ç«¯å¯¹è¯·æ±‚åšåˆ†ç±»ï¼ŒåŒºåˆ†å“ªäº›è¯·æ±‚å¯ä»¥æ¥å—è¿‡æœŸè¯»ï¼Œè€Œå“ªäº›è¯·æ±‚å®Œå…¨ä¸èƒ½æ¥å—è¿‡æœŸè¯»ï¼›ç„¶åï¼Œå¯¹äºä¸èƒ½æ¥å—è¿‡æœŸè¯»çš„è¯­å¥ï¼Œå†ä½¿ç”¨ç­‰ GTID æˆ–ç­‰ä½ç‚¹çš„æ–¹æ¡ˆã€‚</p><p>ä½†è¯è¯´å›æ¥ï¼Œè¿‡æœŸè¯»åœ¨æœ¬è´¨ä¸Šæ˜¯ç”±ä¸€å†™å¤šè¯»å¯¼è‡´çš„ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œå¯èƒ½ä¼šæœ‰åˆ«çš„ä¸éœ€è¦ç­‰å¾…å°±å¯ä»¥æ°´å¹³æ‰©å±•çš„æ•°æ®åº“æ–¹æ¡ˆï¼Œä½†è¿™å¾€å¾€æ˜¯ç”¨ç‰ºç‰²å†™æ€§èƒ½æ¢æ¥çš„ï¼Œä¹Ÿå°±æ˜¯éœ€è¦åœ¨è¯»æ€§èƒ½å’Œå†™æ€§èƒ½ä¸­å–æƒè¡¡ã€‚</p><p>æœ€å ï¼Œæˆ‘ç»™ä½ ç•™ä¸‹ä¸€ä¸ªé—®é¢˜å§ã€‚</p><p>å‡è®¾ä½ çš„ç³»ç»Ÿé‡‡ç”¨äº†æˆ‘ä»¬æ–‡ä¸­ä»‹ç»çš„æœ€åä¸€ä¸ªæ–¹æ¡ˆï¼Œä¹Ÿå°±æ˜¯ç­‰ GTID çš„æ–¹æ¡ˆï¼Œç°åœ¨ä½ è¦å¯¹ä¸»åº“çš„ä¸€å¼ å¤§è¡¨åš DDLï¼Œå¯èƒ½ä¼šå‡ºç°ä»€ä¹ˆæƒ…å†µå‘¢ï¼Ÿä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œä½ ä¼šæ€ä¹ˆåšå‘¢ï¼Ÿ</p><p>ä½ å¯ä»¥æŠŠä½ çš„åˆ†æå’Œæ–¹æ¡ˆè®¾è®¡å†™åœ¨è¯„è®ºåŒºï¼Œæˆ‘ä¼šåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« è·Ÿä½ è®¨è®ºè¿™ä¸ªé—®é¢˜ã€‚æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚</p><h4 id="ä¸ŠæœŸé—®é¢˜æ—¶é—´-15" tabindex="-1"><a class="header-anchor" href="#ä¸ŠæœŸé—®é¢˜æ—¶é—´-15" aria-hidden="true">#</a> ä¸ŠæœŸé—®é¢˜æ—¶é—´</h4><p>ä¸ŠæœŸç»™ä½ ç•™çš„é—®é¢˜æ˜¯ï¼Œåœ¨ GTID æ¨¡å¼ä¸‹ï¼Œå¦‚æœä¸€ä¸ªæ–°çš„ä»åº“æ¥ä¸Šä¸»åº“ï¼Œä½†æ˜¯éœ€è¦çš„ binlog å·²ç»æ²¡äº†ï¼Œè¦æ€ä¹ˆåšï¼Ÿ</p><p>@æŸã€äººåŒå­¦ç»™äº†å¾ˆè¯¦ç»†çš„åˆ†æï¼Œæˆ‘æŠŠä»–çš„å›ç­”ç•¥åšä¿®æ”¹è´´è¿‡æ¥ã€‚</p><ol><li>å¦‚æœä¸šåŠ¡å…è®¸ä¸»ä»ä¸ä¸€è‡´çš„æƒ…å†µï¼Œé‚£ä¹ˆå¯ä»¥åœ¨ä¸»åº“ä¸Šå…ˆæ‰§è¡Œ show global variables like â€˜gtid_purgedâ€™ï¼Œå¾—åˆ°ä¸»åº“å·²ç»åˆ é™¤çš„ GTID é›†åˆï¼Œå‡è®¾æ˜¯ gtid_purged1ï¼›ç„¶åå…ˆåœ¨ä»åº“ä¸Šæ‰§è¡Œ reset masterï¼Œå†æ‰§è¡Œ set global gtid_purged =â€˜gtid_purged1â€™ï¼›æœ€åæ‰§è¡Œ start slaveï¼Œå°±ä¼šä»ä¸»åº“ç°å­˜çš„ binlog å¼€å§‹åŒæ­¥ã€‚binlog ç¼ºå¤±çš„é‚£ä¸€éƒ¨åˆ†ï¼Œæ•°æ®åœ¨ä»åº“ä¸Šå°±å¯èƒ½ä¼šæœ‰ä¸¢å¤±ï¼Œé€ æˆä¸»ä»ä¸ä¸€è‡´ã€‚</li><li>å¦‚æœéœ€è¦ä¸»ä»æ•°æ®ä¸€è‡´çš„è¯ï¼Œæœ€å¥½è¿˜æ˜¯é€šè¿‡é‡æ–°æ­å»ºä»åº“æ¥åšã€‚</li><li>å¦‚æœæœ‰å…¶ä»–çš„ä»åº“ä¿ç•™æœ‰å…¨é‡çš„ binlog çš„è¯ï¼Œå¯ä»¥æŠŠæ–°çš„ä»åº“å…ˆæ¥åˆ°è¿™ä¸ªä¿ç•™äº†å…¨é‡ binlog çš„ä»åº“ï¼Œè¿½ä¸Šæ—¥å¿—ä»¥åï¼Œå¦‚æœæœ‰éœ€è¦ï¼Œå†æ¥å›ä¸»åº“ã€‚</li><li>å¦‚æœ binlog æœ‰å¤‡ä»½çš„æƒ…å†µï¼Œå¯ä»¥å…ˆåœ¨ä»åº“ä¸Šåº”ç”¨ç¼ºå¤±çš„ binlogï¼Œç„¶åå†æ‰§è¡Œ start slaveã€‚</li></ol><p>è¯„è®ºåŒºç•™è¨€ç‚¹èµæ¿ï¼š</p><blockquote><p>@æ‚Ÿç©º åŒå­¦çº§è”å®éªŒï¼ŒéªŒè¯äº† seconds_behind_master çš„è®¡ç®—é€»è¾‘ã€‚</p></blockquote><blockquote><p>@_CountingStars é—®äº†ä¸€ä¸ªå¥½é—®é¢˜ï¼šMySQL æ˜¯æ€ä¹ˆå¿«é€Ÿå®šä½ binlog é‡Œé¢çš„æŸä¸€ä¸ª GTID ä½ç½®çš„ï¼Ÿç­”æ¡ˆæ˜¯ï¼Œåœ¨ binlog æ–‡ä»¶å¤´éƒ¨çš„ Previous_gtids å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p></blockquote><blockquote><p>@ç‹æœ‹é£ åŒå­¦é—®äº†ä¸€ä¸ªå¥½é—®é¢˜ï¼Œsql_slave_skip_counter è·³è¿‡çš„æ˜¯ä¸€ä¸ª eventï¼Œç”±äº MySQL æ€»ä¸èƒ½æ‰§è¡Œä¸€åŠçš„äº‹åŠ¡ï¼Œæ‰€ä»¥æ—¢ç„¶è·³è¿‡äº†ä¸€ä¸ª eventï¼Œå°±ä¼šè·³åˆ°è¿™ä¸ªäº‹åŠ¡çš„æœ«å°¾ï¼Œå› æ­¤ set global sql_slave_skip_counter=1;start slave æ˜¯å¯ä»¥è·³è¿‡æ•´ä¸ªäº‹åŠ¡çš„ã€‚</p></blockquote><h3 id="_29-å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªæ•°æ®åº“æ˜¯ä¸æ˜¯å‡ºé—®é¢˜äº†" tabindex="-1"><a class="header-anchor" href="#_29-å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªæ•°æ®åº“æ˜¯ä¸æ˜¯å‡ºé—®é¢˜äº†" aria-hidden="true">#</a> 29 å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªæ•°æ®åº“æ˜¯ä¸æ˜¯å‡ºé—®é¢˜äº†ï¼Ÿ</h3><p>æˆ‘åœ¨ç¬¬[25]å’Œ[27]ç¯‡æ–‡ç« ä¸­ï¼Œå’Œä½ ä»‹ç»äº†ä¸»å¤‡åˆ‡æ¢æµç¨‹ã€‚é€šè¿‡è¿™äº›å†…å®¹çš„è®²è§£ï¼Œä½ åº”è¯¥å·²ç»å¾ˆæ¸…æ¥šäº†ï¼šåœ¨ä¸€ä¸»ä¸€å¤‡çš„åŒ M æ¶æ„é‡Œï¼Œä¸»å¤‡åˆ‡æ¢åªéœ€è¦æŠŠå®¢æˆ·ç«¯æµé‡åˆ‡åˆ°å¤‡åº“ï¼›è€Œåœ¨ä¸€ä¸»å¤šä»æ¶æ„é‡Œï¼Œä¸»å¤‡åˆ‡æ¢é™¤äº†è¦æŠŠå®¢æˆ·ç«¯æµé‡åˆ‡åˆ°å¤‡åº“å¤–ï¼Œè¿˜éœ€è¦æŠŠä»åº“æ¥åˆ°æ–°ä¸»åº“ä¸Šã€‚</p><p>ä¸»å¤‡åˆ‡æ¢æœ‰ä¸¤ç§åœºæ™¯ï¼Œä¸€ç§æ˜¯ä¸»åŠ¨åˆ‡æ¢ï¼Œä¸€ç§æ˜¯è¢«åŠ¨åˆ‡æ¢ã€‚è€Œå…¶ä¸­è¢«åŠ¨åˆ‡æ¢ï¼Œå¾€å¾€æ˜¯å› ä¸ºä¸»åº“å‡ºé—®é¢˜äº†ï¼Œç”± HA ç³»ç»Ÿå‘èµ·çš„ã€‚</p><p>è¿™ä¹Ÿå°±å¼•å‡ºäº†æˆ‘ä»¬ä»Šå¤©è¦è®¨è®ºçš„é—®é¢˜ï¼šæ€ä¹ˆåˆ¤æ–­ä¸€ä¸ªä¸»åº“å‡ºé—®é¢˜äº†ï¼Ÿ</p><p>ä½ ä¸€å®šä¼šè¯´ï¼Œè¿™å¾ˆç®€å•å•Šï¼Œè¿ä¸Š MySQLï¼Œæ‰§è¡Œä¸ª select 1 å°±å¥½äº†ã€‚ä½†æ˜¯ select 1 æˆåŠŸè¿”å›äº†ï¼Œå°±è¡¨ç¤ºä¸»åº“æ²¡é—®é¢˜å—ï¼Ÿ</p><h4 id="select-1-åˆ¤æ–­" tabindex="-1"><a class="header-anchor" href="#select-1-åˆ¤æ–­" aria-hidden="true">#</a> select 1 åˆ¤æ–­</h4><p>å®é™…ä¸Šï¼Œselect 1 æˆåŠŸè¿”å›ï¼Œåªèƒ½è¯´æ˜è¿™ä¸ªåº“çš„è¿›ç¨‹è¿˜åœ¨ï¼Œå¹¶ä¸èƒ½è¯´æ˜ä¸»åº“æ²¡é—®é¢˜ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¿™ä¸ªåœºæ™¯ã€‚</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">set</span> <span class="token keyword">global</span> innodb_thread_concurrency<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">;</span> 
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>t<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>c<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span><span class="token punctuation">;</span> 
 <span class="token keyword">insert</span> <span class="token keyword">into</span> t <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/35076dd3d0a0d44d22b76d2a29885255-1584367400048.png" alt="img"></p><p>å›¾ 1 æŸ¥è¯¢ blocked</p><p>æˆ‘ä»¬è®¾ç½® innodb_thread_concurrency å‚æ•°çš„ç›®çš„æ˜¯ï¼Œæ§åˆ¶ InnoDB çš„å¹¶å‘çº¿ç¨‹ä¸Šé™ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€æ—¦å¹¶å‘çº¿ç¨‹æ•°è¾¾åˆ°è¿™ä¸ªå€¼ï¼ŒInnoDB åœ¨æ¥æ”¶åˆ°æ–°è¯·æ±‚çš„æ—¶å€™ï¼Œå°±ä¼šè¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œç›´åˆ°æœ‰çº¿ç¨‹é€€å‡ºã€‚</p><p>è¿™é‡Œï¼Œæˆ‘æŠŠ innodb_thread_concurrency è®¾ç½®æˆ 3ï¼Œè¡¨ç¤º InnoDB åªå…è®¸ 3 ä¸ªçº¿ç¨‹å¹¶è¡Œæ‰§è¡Œã€‚è€Œåœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œå‰ä¸‰ä¸ª session ä¸­çš„ sleep(100)ï¼Œä½¿å¾—è¿™ä¸‰ä¸ªè¯­å¥éƒ½å¤„äºâ€œæ‰§è¡Œâ€çŠ¶æ€ï¼Œä»¥æ­¤æ¥æ¨¡æ‹Ÿå¤§æŸ¥è¯¢ã€‚</p><p>ä½ çœ‹åˆ°äº†ï¼Œ session D é‡Œé¢ï¼Œselect 1 æ˜¯èƒ½æ‰§è¡ŒæˆåŠŸçš„ï¼Œä½†æ˜¯æŸ¥è¯¢è¡¨ t çš„è¯­å¥ä¼šè¢«å µä½ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœè¿™æ—¶å€™æˆ‘ä»¬ç”¨ select 1 æ¥æ£€æµ‹å®ä¾‹æ˜¯å¦æ­£å¸¸çš„è¯ï¼Œæ˜¯æ£€æµ‹ä¸å‡ºé—®é¢˜çš„ã€‚</p><p>åœ¨ InnoDB ä¸­ï¼Œinnodb_thread_concurrency è¿™ä¸ªå‚æ•°çš„é»˜è®¤å€¼æ˜¯ 0ï¼Œè¡¨ç¤ºä¸é™åˆ¶å¹¶å‘çº¿ç¨‹æ•°é‡ã€‚ä½†æ˜¯ï¼Œä¸é™åˆ¶å¹¶å‘çº¿ç¨‹æ•°è‚¯å®šæ˜¯ä¸è¡Œçš„ã€‚å› ä¸ºï¼Œä¸€ä¸ªæœºå™¨çš„ CPU æ ¸æ•°æœ‰é™ï¼Œçº¿ç¨‹å…¨å†²è¿›æ¥ï¼Œä¸Šä¸‹æ–‡åˆ‡æ¢çš„æˆæœ¬å°±ä¼šå¤ªé«˜ã€‚</p><p>æ‰€ä»¥ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å»ºè®®æŠŠ innodb_thread_concurrency è®¾ç½®ä¸º 64~128 ä¹‹é—´çš„å€¼ã€‚è¿™æ—¶ï¼Œä½ ä¸€å®šä¼šæœ‰ç–‘é—®ï¼Œå¹¶å‘çº¿ç¨‹ä¸Šé™æ•°è®¾ç½®ä¸º 128 å¤Ÿå¹²å•¥ï¼Œçº¿ä¸Šçš„å¹¶å‘è¿æ¥æ•°åŠ¨ä¸åŠ¨å°±ä¸Šåƒäº†ã€‚</p><p>äº§ç”Ÿè¿™ä¸ªç–‘é—®çš„åŸå› ï¼Œæ˜¯ææ··äº†<strong>å¹¶å‘è¿æ¥å’Œå¹¶å‘æŸ¥è¯¢ã€‚</strong></p><p>å¹¶å‘è¿æ¥å’Œå¹¶å‘æŸ¥è¯¢ï¼Œå¹¶ä¸æ˜¯åŒä¸€ä¸ªæ¦‚å¿µã€‚ä½ åœ¨ show processlist çš„ç»“æœé‡Œï¼Œçœ‹åˆ°çš„å‡ åƒä¸ªè¿æ¥ï¼ŒæŒ‡çš„å°±æ˜¯å¹¶å‘è¿æ¥ã€‚è€Œâ€œå½“å‰æ­£åœ¨æ‰§è¡Œâ€çš„è¯­å¥ï¼Œæ‰æ˜¯æˆ‘ä»¬æ‰€è¯´çš„å¹¶å‘æŸ¥è¯¢ã€‚</p><p>å¹¶å‘è¿æ¥æ•°è¾¾åˆ°å‡ åƒä¸ªå½±å“å¹¶ä¸å¤§ï¼Œå°±æ˜¯å¤šå ä¸€äº›å†…å­˜è€Œå·²ã€‚æˆ‘ä»¬åº”è¯¥å…³æ³¨çš„æ˜¯å¹¶å‘æŸ¥è¯¢ï¼Œå› ä¸ºå¹¶å‘æŸ¥è¯¢å¤ªé«˜æ‰æ˜¯ CPU æ€æ‰‹ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦è®¾ç½® innodb_thread_concurrency å‚æ•°çš„åŸå› ã€‚</p><p>ç„¶åï¼Œä½ å¯èƒ½è¿˜ä¼šæƒ³èµ·æˆ‘ä»¬åœ¨[ç¬¬ 7 ç¯‡æ–‡ç« ]ä¸­è®²åˆ°çš„çƒ­ç‚¹æ›´æ–°å’Œæ­»é”æ£€æµ‹çš„æ—¶å€™ï¼Œå¦‚æœæŠŠ innodb_thread_concurrency è®¾ç½®ä¸º 128 çš„è¯ï¼Œé‚£ä¹ˆå‡ºç°åŒä¸€è¡Œçƒ­ç‚¹æ›´æ–°çš„é—®é¢˜æ—¶ï¼Œæ˜¯ä¸æ˜¯å¾ˆå¿«å°±æŠŠ 128 æ¶ˆè€—å®Œäº†ï¼Œè¿™æ ·æ•´ä¸ªç³»ç»Ÿæ˜¯ä¸æ˜¯å°±æŒ‚äº†å‘¢ï¼Ÿ</p><p>å®é™…ä¸Šï¼Œ<strong>åœ¨çº¿ç¨‹è¿›å…¥é”ç­‰å¾…ä»¥åï¼Œå¹¶å‘çº¿ç¨‹çš„è®¡æ•°ä¼šå‡ä¸€</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´ç­‰è¡Œé”ï¼ˆä¹ŸåŒ…æ‹¬é—´éš™é”ï¼‰çš„çº¿ç¨‹æ˜¯ä¸ç®—åœ¨ 128 é‡Œé¢çš„ã€‚</p><p>MySQL è¿™æ ·è®¾è®¡æ˜¯éå¸¸æœ‰æ„ä¹‰çš„ã€‚å› ä¸ºï¼Œè¿›å…¥é”ç­‰å¾…çš„çº¿ç¨‹å·²ç»ä¸åƒ CPU äº†ï¼›æ›´é‡è¦çš„æ˜¯ï¼Œå¿…é¡»è¿™ä¹ˆè®¾è®¡ï¼Œæ‰èƒ½é¿å…æ•´ä¸ªç³»ç»Ÿé”æ­»ã€‚</p><p>ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå‡è®¾å¤„äºé”ç­‰å¾…çš„çº¿ç¨‹ä¹Ÿå å¹¶å‘çº¿ç¨‹çš„è®¡æ•°ï¼Œä½ å¯ä»¥è®¾æƒ³ä¸€ä¸‹è¿™ä¸ªåœºæ™¯ï¼š</p><ol><li>çº¿ç¨‹ 1 æ‰§è¡Œ begin; update t set c=c+1 where id=1, å¯åŠ¨äº†äº‹åŠ¡ trx1ï¼Œ ç„¶åä¿æŒè¿™ä¸ªçŠ¶æ€ã€‚è¿™æ—¶å€™ï¼Œçº¿ç¨‹å¤„äºç©ºé—²çŠ¶æ€ï¼Œä¸ç®—åœ¨å¹¶å‘çº¿ç¨‹é‡Œé¢ã€‚</li><li>çº¿ç¨‹ 2 åˆ°çº¿ç¨‹ 129 éƒ½æ‰§è¡Œ update t set c=c+1 where id=1; ç”±äºç­‰è¡Œé”ï¼Œè¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚è¿™æ ·å°±æœ‰ 128 ä¸ªçº¿ç¨‹å¤„äºç­‰å¾…çŠ¶æ€ï¼›</li><li>å¦‚æœå¤„äºé”ç­‰å¾…çŠ¶æ€çš„çº¿ç¨‹è®¡æ•°ä¸å‡ä¸€ï¼ŒInnoDB å°±ä¼šè®¤ä¸ºçº¿ç¨‹æ•°ç”¨æ»¡äº†ï¼Œä¼šé˜»æ­¢å…¶ä»–è¯­å¥è¿›å…¥å¼•æ“æ‰§è¡Œï¼Œè¿™æ ·çº¿ç¨‹ 1 ä¸èƒ½æäº¤äº‹åŠ¡ã€‚è€Œå¦å¤–çš„ 128 ä¸ªçº¿ç¨‹åˆå¤„äºé”ç­‰å¾…çŠ¶æ€ï¼Œæ•´ä¸ªç³»ç»Ÿå°±å µä½äº†ã€‚</li></ol><p>ä¸‹å›¾ 2 æ˜¾ç¤ºçš„å°±æ˜¯è¿™ä¸ªçŠ¶æ€ã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/3206ea18b8a24b546515b1b95dc4a11d-1584367400052.png" alt="img"></p><p>å›¾ 2 ç³»ç»Ÿé”æ­»çŠ¶æ€ï¼ˆå‡è®¾ç­‰è¡Œé”çš„è¯­å¥å ç”¨å¹¶å‘è®¡æ•°ï¼‰</p><p>è¿™æ—¶å€™ InnoDB ä¸èƒ½å“åº”ä»»ä½•è¯·æ±‚ï¼Œæ•´ä¸ªç³»ç»Ÿè¢«é”æ­»ã€‚è€Œä¸”ï¼Œç”±äºæ‰€æœ‰çº¿ç¨‹éƒ½å¤„äºç­‰å¾…çŠ¶æ€ï¼Œæ­¤æ—¶å ç”¨çš„ CPU å´æ˜¯ 0ï¼Œè€Œè¿™æ˜æ˜¾ä¸åˆç†ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬è¯´ InnoDB åœ¨è®¾è®¡æ—¶ï¼Œé‡åˆ°è¿›ç¨‹è¿›å…¥é”ç­‰å¾…çš„æƒ…å†µæ—¶ï¼Œå°†å¹¶å‘çº¿ç¨‹çš„è®¡æ•°å‡ 1 çš„è®¾è®¡ï¼Œæ˜¯åˆç†è€Œä¸”æ˜¯å¿…è¦çš„ã€‚</p><p>è™½ç„¶è¯´ç­‰é”çš„çº¿ç¨‹ä¸ç®—åœ¨å¹¶å‘çº¿ç¨‹è®¡æ•°é‡Œï¼Œä½†å¦‚æœå®ƒåœ¨çœŸæ­£åœ°æ‰§è¡ŒæŸ¥è¯¢ï¼Œå°±æ¯”å¦‚æˆ‘ä»¬ä¸Šé¢ä¾‹å­ä¸­å‰ä¸‰ä¸ªäº‹åŠ¡ä¸­çš„ select sleep(100) from tï¼Œè¿˜æ˜¯è¦ç®—è¿›å¹¶å‘çº¿ç¨‹çš„è®¡æ•°çš„ã€‚</p><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒåŒæ—¶åœ¨æ‰§è¡Œçš„è¯­å¥è¶…è¿‡äº†è®¾ç½®çš„ innodb_thread_concurrency çš„å€¼ï¼Œè¿™æ—¶å€™ç³»ç»Ÿå…¶å®å·²ç»ä¸è¡Œäº†ï¼Œä½†æ˜¯é€šè¿‡ select 1 æ¥æ£€æµ‹ç³»ç»Ÿï¼Œä¼šè®¤ä¸ºç³»ç»Ÿè¿˜æ˜¯æ­£å¸¸çš„ã€‚</p><p>å› æ­¤ï¼Œæˆ‘ä»¬ä½¿ç”¨ select 1 çš„åˆ¤æ–­é€»è¾‘è¦ä¿®æ”¹ä¸€ä¸‹ã€‚</p><h4 id="æŸ¥è¡¨åˆ¤æ–­" tabindex="-1"><a class="header-anchor" href="#æŸ¥è¡¨åˆ¤æ–­" aria-hidden="true">#</a> æŸ¥è¡¨åˆ¤æ–­</h4><p>ä¸ºäº†èƒ½å¤Ÿæ£€æµ‹ InnoDB å¹¶å‘çº¿ç¨‹æ•°è¿‡å¤šå¯¼è‡´çš„ç³»ç»Ÿä¸å¯ç”¨æƒ…å†µï¼Œæˆ‘ä»¬éœ€è¦æ‰¾ä¸€ä¸ªè®¿é—® InnoDB çš„åœºæ™¯ã€‚ä¸€èˆ¬çš„åšæ³•æ˜¯ï¼Œåœ¨ç³»ç»Ÿåº“ï¼ˆmysql åº“ï¼‰é‡Œåˆ›å»ºä¸€ä¸ªè¡¨ï¼Œæ¯”å¦‚å‘½åä¸º health_checkï¼Œé‡Œé¢åªæ”¾ä¸€è¡Œæ•°æ®ï¼Œç„¶åå®šæœŸæ‰§è¡Œï¼š</p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> mysql<span class="token punctuation">.</span>health_check<span class="token punctuation">;</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥æ£€æµ‹å‡ºç”±äºå¹¶å‘çº¿ç¨‹è¿‡å¤šå¯¼è‡´çš„æ•°æ®åº“ä¸å¯ç”¨çš„æƒ…å†µã€‚</p><p>ä½†æ˜¯ï¼Œæˆ‘ä»¬é©¬ä¸Šè¿˜ä¼šç¢°åˆ°ä¸‹ä¸€ä¸ªé—®é¢˜ï¼Œå³ï¼šç©ºé—´æ»¡äº†ä»¥åï¼Œè¿™ç§æ–¹æ³•åˆä¼šå˜å¾—ä¸å¥½ä½¿ã€‚</p><p>æˆ‘ä»¬çŸ¥é“ï¼Œæ›´æ–°äº‹åŠ¡è¦å†™ binlogï¼Œè€Œä¸€æ—¦ binlog æ‰€åœ¨ç£ç›˜çš„ç©ºé—´å ç”¨ç‡è¾¾åˆ° 100%ï¼Œé‚£ä¹ˆæ‰€æœ‰çš„æ›´æ–°è¯­å¥å’Œäº‹åŠ¡æäº¤çš„ commit è¯­å¥å°±éƒ½ä¼šè¢«å µä½ã€‚ä½†æ˜¯ï¼Œç³»ç»Ÿè¿™æ—¶å€™è¿˜æ˜¯å¯ä»¥æ­£å¸¸è¯»æ•°æ®çš„ã€‚</p><p>å› æ­¤ï¼Œæˆ‘ä»¬è¿˜æ˜¯æŠŠè¿™æ¡ç›‘æ§è¯­å¥å†æ”¹è¿›ä¸€ä¸‹ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±çœ‹çœ‹æŠŠæŸ¥è¯¢è¯­å¥æ”¹æˆæ›´æ–°è¯­å¥åçš„æ•ˆæœã€‚</p><h4 id="æ›´æ–°åˆ¤æ–­" tabindex="-1"><a class="header-anchor" href="#æ›´æ–°åˆ¤æ–­" aria-hidden="true">#</a> æ›´æ–°åˆ¤æ–­</h4><p>æ—¢ç„¶è¦æ›´æ–°ï¼Œå°±è¦æ”¾ä¸ªæœ‰æ„ä¹‰çš„å­—æ®µï¼Œå¸¸è§åšæ³•æ˜¯æ”¾ä¸€ä¸ª timestamp å­—æ®µï¼Œç”¨æ¥è¡¨ç¤ºæœ€åä¸€æ¬¡æ‰§è¡Œæ£€æµ‹çš„æ—¶é—´ã€‚è¿™æ¡æ›´æ–°è¯­å¥ç±»ä¼¼äºï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysql<span class="token operator">&gt;</span> update mysql.health_check <span class="token builtin class-name">set</span> <span class="token assign-left variable">t_modified</span><span class="token operator">=</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>èŠ‚ç‚¹å¯ç”¨æ€§çš„æ£€æµ‹éƒ½åº”è¯¥åŒ…å«ä¸»åº“å’Œå¤‡åº“ã€‚å¦‚æœç”¨æ›´æ–°æ¥æ£€æµ‹ä¸»åº“çš„è¯ï¼Œé‚£ä¹ˆå¤‡åº“ä¹Ÿè¦è¿›è¡Œæ›´æ–°æ£€æµ‹ã€‚</p><p>ä½†ï¼Œå¤‡åº“çš„æ£€æµ‹ä¹Ÿæ˜¯è¦å†™ binlog çš„ã€‚ç”±äºæˆ‘ä»¬ä¸€èˆ¬ä¼šæŠŠæ•°æ®åº“ A å’Œ B çš„ä¸»å¤‡å…³ç³»è®¾è®¡ä¸ºåŒ M ç»“æ„ï¼Œæ‰€ä»¥åœ¨å¤‡åº“ B ä¸Šæ‰§è¡Œçš„æ£€æµ‹å‘½ä»¤ï¼Œä¹Ÿè¦å‘å›ç»™ä¸»åº“ Aã€‚</p><p>ä½†æ˜¯ï¼Œå¦‚æœä¸»åº“ A å’Œå¤‡åº“ B éƒ½ç”¨ç›¸åŒçš„æ›´æ–°å‘½ä»¤ï¼Œå°±å¯èƒ½å‡ºç°è¡Œå†²çªï¼Œä¹Ÿå°±æ˜¯å¯èƒ½ä¼šå¯¼è‡´ä¸»å¤‡åŒæ­¥åœæ­¢ã€‚æ‰€ä»¥ï¼Œç°åœ¨çœ‹æ¥ mysql.health_check è¿™ä¸ªè¡¨å°±ä¸èƒ½åªæœ‰ä¸€è¡Œæ•°æ®äº†ã€‚</p><p>ä¸ºäº†è®©ä¸»å¤‡ä¹‹é—´çš„æ›´æ–°ä¸äº§ç”Ÿå†²çªï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ mysql.health_check è¡¨ä¸Šå­˜å…¥å¤šè¡Œæ•°æ®ï¼Œå¹¶ç”¨ Aã€B çš„ server_id åšä¸»é”®ã€‚</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>health_check<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>t_modified<span class="token punctuation">`</span></span> <span class="token keyword">timestamp</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span><span class="token punctuation">;</span> 
<span class="token comment">/* æ£€æµ‹å‘½ä»¤ */</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> mysql<span class="token punctuation">.</span>health_check<span class="token punctuation">(</span>id<span class="token punctuation">,</span> t_modified<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span>@<span class="token variable">@server_id</span><span class="token punctuation">,</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">on</span> <span class="token keyword">duplicate</span> <span class="token keyword">key</span> <span class="token keyword">update</span> t_modified<span class="token operator">=</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç”±äº MySQL è§„å®šäº†ä¸»åº“å’Œå¤‡åº“çš„ server_id å¿…é¡»ä¸åŒï¼ˆå¦åˆ™åˆ›å»ºä¸»å¤‡å…³ç³»çš„æ—¶å€™å°±ä¼šæŠ¥é”™ï¼‰ï¼Œè¿™æ ·å°±å¯ä»¥ä¿è¯ä¸»ã€å¤‡åº“å„è‡ªçš„æ£€æµ‹å‘½ä»¤ä¸ä¼šå‘ç”Ÿå†²çªã€‚</p><p>æ›´æ–°åˆ¤æ–­æ˜¯ä¸€ä¸ªç›¸å¯¹æ¯”è¾ƒå¸¸ç”¨çš„æ–¹æ¡ˆäº†ï¼Œä¸è¿‡ä¾ç„¶å­˜åœ¨ä¸€äº›é—®é¢˜ã€‚å…¶ä¸­ï¼Œâ€œåˆ¤å®šæ…¢â€ä¸€ç›´æ˜¯è®© DBA å¤´ç–¼çš„é—®é¢˜ã€‚</p><p>ä½ ä¸€å®šä¼šç–‘æƒ‘ï¼Œ<strong>æ›´æ–°è¯­å¥ï¼Œå¦‚æœå¤±è´¥æˆ–è€…è¶…æ—¶ï¼Œå°±å¯ä»¥å‘èµ·ä¸»å¤‡åˆ‡æ¢äº†ï¼Œä¸ºä»€ä¹ˆè¿˜ä¼šæœ‰åˆ¤å®šæ…¢çš„é—®é¢˜å‘¢ï¼Ÿ</strong></p><p>å…¶å®ï¼Œè¿™é‡Œæ¶‰åŠåˆ°çš„æ˜¯æœåŠ¡å™¨ IO èµ„æºåˆ†é…çš„é—®é¢˜ã€‚</p><p>é¦–å…ˆï¼Œæ‰€æœ‰çš„æ£€æµ‹é€»è¾‘éƒ½éœ€è¦ä¸€ä¸ªè¶…æ—¶æ—¶é—´ Nã€‚æ‰§è¡Œä¸€æ¡ update è¯­å¥ï¼Œè¶…è¿‡ N ç§’åè¿˜ä¸è¿”å›ï¼Œå°±è®¤ä¸ºç³»ç»Ÿä¸å¯ç”¨ã€‚</p><p>ä½ å¯ä»¥è®¾æƒ³ä¸€ä¸ªæ—¥å¿—ç›˜çš„ IO åˆ©ç”¨ç‡å·²ç»æ˜¯ 100% çš„åœºæ™¯ã€‚è¿™æ—¶å€™ï¼Œæ•´ä¸ªç³»ç»Ÿå“åº”éå¸¸æ…¢ï¼Œå·²ç»éœ€è¦åšä¸»å¤‡åˆ‡æ¢äº†ã€‚</p><p>ä½†æ˜¯ä½ è¦çŸ¥é“ï¼ŒIO åˆ©ç”¨ç‡ 100% è¡¨ç¤ºç³»ç»Ÿçš„ IO æ˜¯åœ¨å·¥ä½œçš„ï¼Œæ¯ä¸ªè¯·æ±‚éƒ½æœ‰æœºä¼šè·å¾— IO èµ„æºï¼Œæ‰§è¡Œè‡ªå·±çš„ä»»åŠ¡ã€‚è€Œæˆ‘ä»¬çš„æ£€æµ‹ä½¿ç”¨çš„ update å‘½ä»¤ï¼Œéœ€è¦çš„èµ„æºå¾ˆå°‘ï¼Œæ‰€ä»¥å¯èƒ½åœ¨æ‹¿åˆ° IO èµ„æºçš„æ—¶å€™å°±å¯ä»¥æäº¤æˆåŠŸï¼Œå¹¶ä¸”åœ¨è¶…æ—¶æ—¶é—´ N ç§’æœªåˆ°è¾¾ä¹‹å‰å°±è¿”å›ç»™äº†æ£€æµ‹ç³»ç»Ÿã€‚</p><p>æ£€æµ‹ç³»ç»Ÿä¸€çœ‹ï¼Œupdate å‘½ä»¤æ²¡æœ‰è¶…æ—¶ï¼Œäºæ˜¯å°±å¾—åˆ°äº†â€œç³»ç»Ÿæ­£å¸¸â€çš„ç»“è®ºã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™æ—¶å€™åœ¨ä¸šåŠ¡ç³»ç»Ÿä¸Šæ­£å¸¸çš„ SQL è¯­å¥å·²ç»æ‰§è¡Œå¾—å¾ˆæ…¢äº†ï¼Œä½†æ˜¯ DBA ä¸Šå»ä¸€çœ‹ï¼ŒHA ç³»ç»Ÿè¿˜åœ¨æ­£å¸¸å·¥ä½œï¼Œå¹¶ä¸”è®¤ä¸ºä¸»åº“ç°åœ¨å¤„äºå¯ç”¨çŠ¶æ€ã€‚</p><p>ä¹‹æ‰€ä»¥ä¼šå‡ºç°è¿™ä¸ªç°è±¡ï¼Œæ ¹æœ¬åŸå› æ˜¯æˆ‘ä»¬ä¸Šé¢è¯´çš„æ‰€æœ‰æ–¹æ³•ï¼Œéƒ½æ˜¯åŸºäºå¤–éƒ¨æ£€æµ‹çš„ã€‚å¤–éƒ¨æ£€æµ‹å¤©ç„¶æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯éšæœºæ€§ã€‚</p><p>å› ä¸ºï¼Œå¤–éƒ¨æ£€æµ‹éƒ½éœ€è¦å®šæ—¶è½®è¯¢ï¼Œæ‰€ä»¥ç³»ç»Ÿå¯èƒ½å·²ç»å‡ºé—®é¢˜äº†ï¼Œä½†æ˜¯å´éœ€è¦ç­‰åˆ°ä¸‹ä¸€ä¸ªæ£€æµ‹å‘èµ·æ‰§è¡Œè¯­å¥çš„æ—¶å€™ï¼Œæˆ‘ä»¬æ‰æœ‰å¯èƒ½å‘ç°é—®é¢˜ã€‚è€Œä¸”ï¼Œå¦‚æœä½ çš„è¿æ°”ä¸å¤Ÿå¥½çš„è¯ï¼Œå¯èƒ½ç¬¬ä¸€æ¬¡è½®è¯¢è¿˜ä¸èƒ½å‘ç°ï¼Œè¿™å°±ä¼šå¯¼è‡´åˆ‡æ¢æ…¢çš„é—®é¢˜ã€‚</p><p>æ‰€ä»¥ï¼Œæ¥ä¸‹æ¥æˆ‘è¦å†å’Œä½ ä»‹ç»ä¸€ç§åœ¨ MySQL å†…éƒ¨å‘ç°æ•°æ®åº“é—®é¢˜çš„æ–¹æ³•ã€‚</p><h4 id="å†…éƒ¨ç»Ÿè®¡" tabindex="-1"><a class="header-anchor" href="#å†…éƒ¨ç»Ÿè®¡" aria-hidden="true">#</a> å†…éƒ¨ç»Ÿè®¡</h4><p>é’ˆå¯¹ç£ç›˜åˆ©ç”¨ç‡è¿™ä¸ªé—®é¢˜ï¼Œå¦‚æœ MySQL å¯ä»¥å‘Šè¯‰æˆ‘ä»¬ï¼Œå†…éƒ¨æ¯ä¸€æ¬¡ IO è¯·æ±‚çš„æ—¶é—´ï¼Œé‚£æˆ‘ä»¬åˆ¤æ–­æ•°æ®åº“æ˜¯å¦å‡ºé—®é¢˜çš„æ–¹æ³•å°±å¯é å¾—å¤šäº†ã€‚</p><p>å…¶å®ï¼ŒMySQL 5.6 ç‰ˆæœ¬ä»¥åæä¾›çš„ performance_schema åº“ï¼Œå°±åœ¨ file_summary_by_event_name è¡¨é‡Œç»Ÿè®¡äº†æ¯æ¬¡ IO è¯·æ±‚çš„æ—¶é—´ã€‚</p><p>file_summary_by_event_name è¡¨é‡Œæœ‰å¾ˆå¤šè¡Œæ•°æ®ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ event_name=&#39;wait/io/file/innodb/innodb_log_fileâ€™è¿™ä¸€è¡Œã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/752ccfe43b4eab155be17401838c62dd-1584367400232.png" alt="img"></p><p>å›¾ 3 performance_schema.file_summary_by_event_name çš„ä¸€è¡Œ</p><p>å›¾ä¸­è¿™ä¸€è¡Œè¡¨ç¤ºç»Ÿè®¡çš„æ˜¯ redo log çš„å†™å…¥æ—¶é—´ï¼Œç¬¬ä¸€åˆ— EVENT_NAME è¡¨ç¤ºç»Ÿè®¡çš„ç±»å‹ã€‚</p><p>æ¥ä¸‹æ¥çš„ä¸‰ç»„æ•°æ®ï¼Œæ˜¾ç¤ºçš„æ˜¯ redo log æ“ä½œçš„æ—¶é—´ç»Ÿè®¡ã€‚</p><p>ç¬¬ä¸€ç»„äº”åˆ—ï¼Œæ˜¯æ‰€æœ‰ IO ç±»å‹çš„ç»Ÿè®¡ã€‚å…¶ä¸­ï¼ŒCOUNT_STAR æ˜¯æ‰€æœ‰ IO çš„æ€»æ¬¡æ•°ï¼Œæ¥ä¸‹æ¥å››åˆ—æ˜¯å…·ä½“çš„ç»Ÿè®¡é¡¹ï¼Œ å•ä½æ˜¯çš®ç§’ï¼›å‰ç¼€ SUMã€MINã€AVGã€MAXï¼Œé¡¾åæ€ä¹‰æŒ‡çš„å°±æ˜¯æ€»å’Œã€æœ€å°å€¼ã€å¹³å‡å€¼å’Œæœ€å¤§å€¼ã€‚</p><p>ç¬¬äºŒç»„å…­åˆ—ï¼Œæ˜¯è¯»æ“ä½œçš„ç»Ÿè®¡ã€‚æœ€åä¸€åˆ— SUM_NUMBER_OF_BYTES_READ ç»Ÿè®¡çš„æ˜¯ï¼Œæ€»å…±ä» redo log é‡Œè¯»äº†å¤šå°‘ä¸ªå­—èŠ‚ã€‚</p><p>ç¬¬ä¸‰ç»„å…­åˆ—ï¼Œç»Ÿè®¡çš„æ˜¯å†™æ“ä½œã€‚</p><p>æœ€åçš„ç¬¬å››ç»„æ•°æ®ï¼Œæ˜¯å¯¹å…¶ä»–ç±»å‹æ•°æ®çš„ç»Ÿè®¡ã€‚åœ¨ redo log é‡Œï¼Œä½ å¯ä»¥è®¤ä¸ºå®ƒä»¬å°±æ˜¯å¯¹ fsync çš„ç»Ÿè®¡ã€‚</p><p>åœ¨ performance_schema åº“çš„ file_summary_by_event_name è¡¨é‡Œï¼Œbinlog å¯¹åº”çš„æ˜¯ event_name = &quot;wait/io/file/sql/binlog&quot;è¿™ä¸€è¡Œã€‚å„ä¸ªå­—æ®µçš„ç»Ÿè®¡é€»è¾‘ï¼Œä¸ redo log çš„å„ä¸ªå­—æ®µå®Œå…¨ç›¸åŒã€‚è¿™é‡Œï¼Œæˆ‘å°±ä¸å†èµ˜è¿°äº†ã€‚</p><p>å› ä¸ºæˆ‘ä»¬æ¯ä¸€æ¬¡æ“ä½œæ•°æ®åº“ï¼Œperformance_schema éƒ½éœ€è¦é¢å¤–åœ°ç»Ÿè®¡è¿™äº›ä¿¡æ¯ï¼Œæ‰€ä»¥æˆ‘ä»¬æ‰“å¼€è¿™ä¸ªç»Ÿè®¡åŠŸèƒ½æ˜¯æœ‰æ€§èƒ½æŸè€—çš„ã€‚</p><p>æˆ‘çš„æµ‹è¯•ç»“æœæ˜¯ï¼Œå¦‚æœæ‰“å¼€æ‰€æœ‰çš„ performance_schema é¡¹ï¼Œæ€§èƒ½å¤§æ¦‚ä¼šä¸‹é™ 10% å·¦å³ã€‚æ‰€ä»¥ï¼Œæˆ‘å»ºè®®ä½ åªæ‰“å¼€è‡ªå·±éœ€è¦çš„é¡¹è¿›è¡Œç»Ÿè®¡ã€‚ä½ å¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹æ³•æ‰“å¼€æˆ–è€…å…³é—­æŸä¸ªå…·ä½“é¡¹çš„ç»Ÿè®¡ã€‚</p><p>å¦‚æœè¦æ‰“å¼€ redo log çš„æ—¶é—´ç›‘æ§ï¼Œä½ å¯ä»¥æ‰§è¡Œè¿™ä¸ªè¯­å¥ï¼š</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">update</span> setup_instruments <span class="token keyword">set</span> ENABLED<span class="token operator">=</span><span class="token string">&#39;YES&#39;</span><span class="token punctuation">,</span> Timed<span class="token operator">=</span><span class="token string">&#39;YES&#39;</span> <span class="token keyword">where</span> name <span class="token operator">like</span> <span class="token string">&#39;%wait/io/file/innodb/innodb_log_file%&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å‡è®¾ï¼Œç°åœ¨ä½ å·²ç»å¼€å¯äº† redo log å’Œ binlog è¿™ä¸¤ä¸ªç»Ÿè®¡ä¿¡æ¯ï¼Œé‚£è¦æ€ä¹ˆæŠŠè¿™ä¸ªä¿¡æ¯ç”¨åœ¨å®ä¾‹çŠ¶æ€è¯Šæ–­ä¸Šå‘¢ï¼Ÿ</p><p>å¾ˆç®€å•ï¼Œä½ å¯ä»¥é€šè¿‡ MAX_TIMER çš„å€¼æ¥åˆ¤æ–­æ•°æ®åº“æ˜¯å¦å‡ºé—®é¢˜äº†ã€‚æ¯”å¦‚ï¼Œä½ å¯ä»¥è®¾å®šé˜ˆå€¼ï¼Œå•æ¬¡ IO è¯·æ±‚æ—¶é—´è¶…è¿‡ 200 æ¯«ç§’å±äºå¼‚å¸¸ï¼Œç„¶åä½¿ç”¨ç±»ä¼¼ä¸‹é¢è¿™æ¡è¯­å¥ä½œä¸ºæ£€æµ‹é€»è¾‘ã€‚</p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> event_name<span class="token punctuation">,</span>MAX_TIMER_WAIT  FROM performance_schema<span class="token punctuation">.</span>file_summary_by_event_name <span class="token keyword">where</span> <span class="token class-name">event_name</span> <span class="token keyword">in</span> <span class="token punctuation">(</span>&#39;wait<span class="token operator">/</span>io<span class="token operator">/</span>file<span class="token operator">/</span>innodb<span class="token operator">/</span>innodb_log_file<span class="token char">&#39;,&#39;</span>wait<span class="token operator">/</span>io<span class="token operator">/</span>file<span class="token operator">/</span>sql<span class="token operator">/</span>binlog&#39;<span class="token punctuation">)</span> <span class="token keyword">and</span> MAX_TIMER_WAIT<span class="token operator">&gt;</span><span class="token number">200</span><span class="token operator">*</span><span class="token number">1000000000</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å‘ç°å¼‚å¸¸åï¼Œå–åˆ°ä½ éœ€è¦çš„ä¿¡æ¯ï¼Œå†é€šè¿‡ä¸‹é¢è¿™æ¡è¯­å¥ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysql<span class="token operator">&gt;</span> truncate table performance_schema.file_summary_by_event_name<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æŠŠä¹‹å‰çš„ç»Ÿè®¡ä¿¡æ¯æ¸…ç©ºã€‚è¿™æ ·å¦‚æœåé¢çš„ç›‘æ§ä¸­ï¼Œå†æ¬¡å‡ºç°è¿™ä¸ªå¼‚å¸¸ï¼Œå°±å¯ä»¥åŠ å…¥ç›‘æ§ç´¯ç§¯å€¼äº†ã€‚</p><h4 id="å°ç»“-19" tabindex="-1"><a class="header-anchor" href="#å°ç»“-19" aria-hidden="true">#</a> å°ç»“</h4><p>ä»Šå¤©ï¼Œæˆ‘å’Œä½ ä»‹ç»äº†æ£€æµ‹ä¸€ä¸ª MySQL å®ä¾‹å¥åº·çŠ¶æ€çš„å‡ ç§æ–¹æ³•ï¼Œä»¥åŠå„ç§æ–¹æ³•å­˜åœ¨çš„é—®é¢˜å’Œæ¼”è¿›çš„é€»è¾‘ã€‚</p><p>ä½ çœ‹å®Œåå¯èƒ½ä¼šè§‰å¾—ï¼Œselect 1 è¿™æ ·çš„æ–¹æ³•æ˜¯ä¸æ˜¯å·²ç»è¢«æ·˜æ±°äº†å‘¢ï¼Œä½†å®é™…ä¸Šä½¿ç”¨éå¸¸å¹¿æ³›çš„ MHAï¼ˆMaster High Availabilityï¼‰ï¼Œé»˜è®¤ä½¿ç”¨çš„å°±æ˜¯è¿™ä¸ªæ–¹æ³•ã€‚</p><p>MHA ä¸­çš„å¦ä¸€ä¸ªå¯é€‰æ–¹æ³•æ˜¯åªåšè¿æ¥ï¼Œå°±æ˜¯ â€œå¦‚æœè¿æ¥æˆåŠŸå°±è®¤ä¸ºä¸»åº“æ²¡é—®é¢˜â€ã€‚ä¸è¿‡æ®æˆ‘æ‰€çŸ¥ï¼Œé€‰æ‹©è¿™ä¸ªæ–¹æ³•çš„å¾ˆå°‘ã€‚</p><p>å…¶å®ï¼Œæ¯ä¸ªæ”¹è¿›çš„æ–¹æ¡ˆï¼Œéƒ½ä¼šå¢åŠ é¢å¤–æŸè€—ï¼Œå¹¶ä¸èƒ½ç”¨â€œå¯¹é”™â€åšç›´æ¥åˆ¤æ–­ï¼Œéœ€è¦ä½ æ ¹æ®ä¸šåŠ¡å®é™…æƒ…å†µå»åšæƒè¡¡ã€‚</p><p>æˆ‘ä¸ªäººæ¯”è¾ƒå€¾å‘çš„æ–¹æ¡ˆï¼Œæ˜¯ä¼˜å…ˆè€ƒè™‘ update ç³»ç»Ÿè¡¨ï¼Œç„¶åå†é…åˆå¢åŠ æ£€æµ‹ performance_schema çš„ä¿¡æ¯ã€‚</p><p>æœ€åï¼Œåˆåˆ°äº†æˆ‘ä»¬çš„æ€è€ƒé¢˜æ—¶é—´ã€‚</p><p>ä»Šå¤©ï¼Œæˆ‘æƒ³é—®ä½ çš„æ˜¯ï¼šä¸šåŠ¡ç³»ç»Ÿä¸€èˆ¬ä¹Ÿæœ‰é«˜å¯ç”¨çš„éœ€æ±‚ï¼Œåœ¨ä½ å¼€å‘å’Œç»´æŠ¤è¿‡çš„æœåŠ¡ä¸­ï¼Œä½ æ˜¯æ€ä¹ˆåˆ¤æ–­æœåŠ¡æœ‰æ²¡æœ‰å‡ºé—®é¢˜çš„å‘¢ï¼Ÿ</p><p>ä½ å¯ä»¥æŠŠä½ ç”¨åˆ°çš„æ–¹æ³•å’Œåˆ†æå†™åœ¨ç•™è¨€åŒºï¼Œæˆ‘ä¼šåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­é€‰å–æœ‰è¶£çš„æ–¹æ¡ˆä¸€èµ·æ¥åˆ†äº«å’Œåˆ†æã€‚æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚</p><h4 id="ä¸ŠæœŸé—®é¢˜æ—¶é—´-16" tabindex="-1"><a class="header-anchor" href="#ä¸ŠæœŸé—®é¢˜æ—¶é—´-16" aria-hidden="true">#</a> ä¸ŠæœŸé—®é¢˜æ—¶é—´</h4><p>ä¸ŠæœŸçš„é—®é¢˜æ˜¯ï¼Œå¦‚æœä½¿ç”¨ GTID ç­‰ä½ç‚¹çš„æ–¹æ¡ˆåšè¯»å†™åˆ†ç¦»ï¼Œåœ¨å¯¹å¤§è¡¨åš DDL çš„æ—¶å€™ä¼šæ€ä¹ˆæ ·ã€‚</p><p>å‡è®¾ï¼Œè¿™æ¡è¯­å¥åœ¨ä¸»åº“ä¸Šè¦æ‰§è¡Œ 10 åˆ†é’Ÿï¼Œæäº¤åä¼ åˆ°å¤‡åº“å°±è¦ 10 åˆ†é’Ÿï¼ˆå…¸å‹çš„å¤§äº‹åŠ¡ï¼‰ã€‚é‚£ä¹ˆï¼Œåœ¨ä¸»åº“ DDL ä¹‹åå†æäº¤çš„äº‹åŠ¡çš„ GTIDï¼Œå»å¤‡åº“æŸ¥çš„æ—¶å€™ï¼Œå°±ä¼šç­‰ 10 åˆ†é’Ÿæ‰å‡ºç°ã€‚</p><p>è¿™æ ·ï¼Œè¿™ä¸ªè¯»å†™åˆ†ç¦»æœºåˆ¶åœ¨è¿™ 10 åˆ†é’Ÿä¹‹å†…éƒ½ä¼šè¶…æ—¶ï¼Œç„¶åèµ°ä¸»åº“ã€‚</p><p>è¿™ç§é¢„æœŸå†…çš„æ“ä½œï¼Œåº”è¯¥åœ¨ä¸šåŠ¡ä½å³°æœŸçš„æ—¶å€™ï¼Œç¡®ä¿ä¸»åº“èƒ½å¤Ÿæ”¯æŒæ‰€æœ‰ä¸šåŠ¡æŸ¥è¯¢ï¼Œç„¶åæŠŠè¯»è¯·æ±‚éƒ½åˆ‡åˆ°ä¸»åº“ï¼Œå†åœ¨ä¸»åº“ä¸Šåš DDLã€‚ç­‰å¤‡åº“å»¶è¿Ÿè¿½ä¸Šä»¥åï¼Œå†æŠŠè¯»è¯·æ±‚åˆ‡å›å¤‡åº“ã€‚</p><p>é€šè¿‡è¿™ä¸ªæ€è€ƒé¢˜ï¼Œæˆ‘ä¸»è¦æƒ³è®©å…³æ³¨çš„æ˜¯ï¼Œå¤§äº‹åŠ¡å¯¹ç­‰ä½ç‚¹æ–¹æ¡ˆçš„å½±å“ã€‚</p><p>å½“ç„¶äº†ï¼Œä½¿ç”¨ gh-ost æ–¹æ¡ˆæ¥è§£å†³è¿™ä¸ªé—®é¢˜ä¹Ÿæ˜¯ä¸é”™çš„é€‰æ‹©ã€‚</p><p>è¯„è®ºåŒºç•™è¨€ç‚¹èµæ¿ï¼š</p><blockquote><p>@æ›¾å‰‘ã€@max åŒå­¦æåˆ°çš„å¤‡åº“å…ˆåšï¼Œå†åˆ‡ä¸»åº“çš„æ–¹æ³•ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚</p></blockquote><h3 id="_33-æˆ‘æŸ¥è¿™ä¹ˆå¤šæ•°æ®-ä¼šä¸ä¼šæŠŠæ•°æ®åº“å†…å­˜æ‰“çˆ†" tabindex="-1"><a class="header-anchor" href="#_33-æˆ‘æŸ¥è¿™ä¹ˆå¤šæ•°æ®-ä¼šä¸ä¼šæŠŠæ•°æ®åº“å†…å­˜æ‰“çˆ†" aria-hidden="true">#</a> 33 æˆ‘æŸ¥è¿™ä¹ˆå¤šæ•°æ®ï¼Œä¼šä¸ä¼šæŠŠæ•°æ®åº“å†…å­˜æ‰“çˆ†ï¼Ÿ</h3><p>æˆ‘ç»å¸¸ä¼šè¢«é—®åˆ°è¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼šæˆ‘çš„ä¸»æœºå†…å­˜åªæœ‰ 100Gï¼Œç°åœ¨è¦å¯¹ä¸€ä¸ª 200G çš„å¤§è¡¨åšå…¨è¡¨æ‰«æï¼Œä¼šä¸ä¼šæŠŠæ•°æ®åº“ä¸»æœºçš„å†…å­˜ç”¨å…‰äº†ï¼Ÿ</p><p>è¿™ä¸ªé—®é¢˜ç¡®å®å€¼å¾—æ‹…å¿ƒï¼Œè¢«ç³»ç»Ÿ OOMï¼ˆout of memoryï¼‰å¯ä¸æ˜¯é—¹ç€ç©çš„ã€‚ä½†æ˜¯ï¼Œåè¿‡æ¥æƒ³æƒ³ï¼Œé€»è¾‘å¤‡ä»½çš„æ—¶å€™ï¼Œå¯ä¸å°±æ˜¯åšæ•´åº“æ‰«æå—ï¼Ÿå¦‚æœè¿™æ ·å°±ä¼šæŠŠå†…å­˜åƒå…‰ï¼Œé€»è¾‘å¤‡ä»½ä¸æ˜¯æ—©å°±æŒ‚äº†ï¼Ÿ</p><p>æ‰€ä»¥è¯´ï¼Œå¯¹å¤§è¡¨åšå…¨è¡¨æ‰«æï¼Œçœ‹æ¥åº”è¯¥æ˜¯æ²¡é—®é¢˜çš„ã€‚ä½†æ˜¯ï¼Œè¿™ä¸ªæµç¨‹åˆ°åº•æ˜¯æ€ä¹ˆæ ·çš„å‘¢ï¼Ÿ</p><h4 id="å…¨è¡¨æ‰«æå¯¹-server-å±‚çš„å½±å“" tabindex="-1"><a class="header-anchor" href="#å…¨è¡¨æ‰«æå¯¹-server-å±‚çš„å½±å“" aria-hidden="true">#</a> å…¨è¡¨æ‰«æå¯¹ server å±‚çš„å½±å“</h4><p>å‡è®¾ï¼Œæˆ‘ä»¬ç°åœ¨è¦å¯¹ä¸€ä¸ª 200G çš„ InnoDB è¡¨ db1. tï¼Œæ‰§è¡Œä¸€ä¸ªå…¨è¡¨æ‰«æã€‚å½“ç„¶ï¼Œä½ è¦æŠŠæ‰«æç»“æœä¿å­˜åœ¨å®¢æˆ·ç«¯ï¼Œä¼šä½¿ç”¨ç±»ä¼¼è¿™æ ·çš„å‘½ä»¤ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysql -h<span class="token variable">$host</span> -P<span class="token variable">$port</span> -u<span class="token variable">$user</span> -p<span class="token variable">$pwd</span> <span class="token parameter variable">-e</span> <span class="token string">&quot;select * from db1.t&quot;</span> <span class="token operator">&gt;</span> <span class="token variable">$target_file</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ä½ å·²ç»çŸ¥é“äº†ï¼ŒInnoDB çš„æ•°æ®æ˜¯ä¿å­˜åœ¨ä¸»é”®ç´¢å¼•ä¸Šçš„ï¼Œæ‰€ä»¥å…¨è¡¨æ‰«æå®é™…ä¸Šæ˜¯ç›´æ¥æ‰«æè¡¨ t çš„ä¸»é”®ç´¢å¼•ã€‚è¿™æ¡æŸ¥è¯¢è¯­å¥ç”±äºæ²¡æœ‰å…¶ä»–çš„åˆ¤æ–­æ¡ä»¶ï¼Œæ‰€ä»¥æŸ¥åˆ°çš„æ¯ä¸€è¡Œéƒ½å¯ä»¥ç›´æ¥æ”¾åˆ°ç»“æœé›†é‡Œé¢ï¼Œç„¶åè¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p><p>é‚£ä¹ˆï¼Œè¿™ä¸ªâ€œç»“æœé›†â€å­˜åœ¨å“ªé‡Œå‘¢ï¼Ÿ</p><p>å®é™…ä¸Šï¼ŒæœåŠ¡ç«¯å¹¶ä¸éœ€è¦ä¿å­˜ä¸€ä¸ªå®Œæ•´çš„ç»“æœé›†ã€‚å–æ•°æ®å’Œå‘æ•°æ®çš„æµç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><ol><li>è·å–ä¸€è¡Œï¼Œå†™åˆ° net_buffer ä¸­ã€‚è¿™å—å†…å­˜çš„å¤§å°æ˜¯ç”±å‚æ•° net_buffer_length å®šä¹‰çš„ï¼Œé»˜è®¤æ˜¯ 16kã€‚</li><li>é‡å¤è·å–è¡Œï¼Œç›´åˆ° net_buffer å†™æ»¡ï¼Œè°ƒç”¨ç½‘ç»œæ¥å£å‘å‡ºå»ã€‚</li><li>å¦‚æœå‘é€æˆåŠŸï¼Œå°±æ¸…ç©º net_bufferï¼Œç„¶åç»§ç»­å–ä¸‹ä¸€è¡Œï¼Œå¹¶å†™å…¥ net_bufferã€‚</li><li>å¦‚æœå‘é€å‡½æ•°è¿”å› EAGAIN æˆ– WSAEWOULDBLOCKï¼Œå°±è¡¨ç¤ºæœ¬åœ°ç½‘ç»œæ ˆï¼ˆsocket send bufferï¼‰å†™æ»¡äº†ï¼Œè¿›å…¥ç­‰å¾…ã€‚ç›´åˆ°ç½‘ç»œæ ˆé‡æ–°å¯å†™ï¼Œå†ç»§ç»­å‘é€ã€‚</li></ol><p>è¿™ä¸ªè¿‡ç¨‹å¯¹åº”çš„æµç¨‹å›¾å¦‚ä¸‹æ‰€ç¤ºã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/a027c300d7dde8cea4fad8f34b670ebd-1584367400340.jpg" alt="img"></p><p>å›¾ 1 æŸ¥è¯¢ç»“æœå‘é€æµç¨‹</p><p>ä»è¿™ä¸ªæµç¨‹ä¸­ï¼Œä½ å¯ä»¥çœ‹åˆ°ï¼š</p><ol><li>ä¸€ä¸ªæŸ¥è¯¢åœ¨å‘é€è¿‡ç¨‹ä¸­ï¼Œå ç”¨çš„ MySQL å†…éƒ¨çš„å†…å­˜æœ€å¤§å°±æ˜¯ net_buffer_length è¿™ä¹ˆå¤§ï¼Œå¹¶ä¸ä¼šè¾¾åˆ° 200Gï¼›</li><li>socket send buffer ä¹Ÿä¸å¯èƒ½è¾¾åˆ° 200Gï¼ˆé»˜è®¤å®šä¹‰ /proc/sys/net/core/wmem_defaultï¼‰ï¼Œå¦‚æœ socket send buffer è¢«å†™æ»¡ï¼Œå°±ä¼šæš‚åœè¯»æ•°æ®çš„æµç¨‹ã€‚</li></ol><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>MySQL æ˜¯â€œè¾¹è¯»è¾¹å‘çš„â€</strong>ï¼Œè¿™ä¸ªæ¦‚å¿µå¾ˆé‡è¦ã€‚è¿™å°±æ„å‘³ç€ï¼Œå¦‚æœå®¢æˆ·ç«¯æ¥æ”¶å¾—æ…¢ï¼Œä¼šå¯¼è‡´ MySQL æœåŠ¡ç«¯ç”±äºç»“æœå‘ä¸å‡ºå»ï¼Œè¿™ä¸ªäº‹åŠ¡çš„æ‰§è¡Œæ—¶é—´å˜é•¿ã€‚</p><p>æ¯”å¦‚ä¸‹é¢è¿™ä¸ªçŠ¶æ€ï¼Œå°±æ˜¯æˆ‘æ•…æ„è®©å®¢æˆ·ç«¯ä¸å»è¯» socket receive buffer ä¸­çš„å†…å®¹ï¼Œç„¶ååœ¨æœåŠ¡ç«¯ show processlist çœ‹åˆ°çš„ç»“æœã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/183a704d4495bebbc13c524695b5b6c3-1584367400345.png" alt="img"></p><p>å›¾ 2 æœåŠ¡ç«¯å‘é€é˜»å¡</p><p>å¦‚æœä½ çœ‹åˆ° State çš„å€¼ä¸€ç›´å¤„äº**â€œSending to clientâ€**ï¼Œå°±è¡¨ç¤ºæœåŠ¡å™¨ç«¯çš„ç½‘ç»œæ ˆå†™æ»¡äº†ã€‚</p><p>æˆ‘åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­æ›¾æåˆ°ï¼Œå¦‚æœå®¢æˆ·ç«¯ä½¿ç”¨â€“quick å‚æ•°ï¼Œä¼šä½¿ç”¨ mysql_use_result æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•æ˜¯è¯»ä¸€è¡Œå¤„ç†ä¸€è¡Œã€‚ä½ å¯ä»¥æƒ³è±¡ä¸€ä¸‹ï¼Œå‡è®¾æœ‰ä¸€ä¸ªä¸šåŠ¡çš„é€»è¾‘æ¯”è¾ƒå¤æ‚ï¼Œæ¯è¯»ä¸€è¡Œæ•°æ®ä»¥åè¦å¤„ç†çš„é€»è¾‘å¦‚æœå¾ˆæ…¢ï¼Œå°±ä¼šå¯¼è‡´å®¢æˆ·ç«¯è¦è¿‡å¾ˆä¹…æ‰ä¼šå»å–ä¸‹ä¸€è¡Œæ•°æ®ï¼Œå¯èƒ½å°±ä¼šå‡ºç°å¦‚å›¾ 2 æ‰€ç¤ºçš„è¿™ç§æƒ…å†µã€‚</p><p>å› æ­¤ï¼Œ<strong>å¯¹äºæ­£å¸¸çš„çº¿ä¸Šä¸šåŠ¡æ¥è¯´ï¼Œå¦‚æœä¸€ä¸ªæŸ¥è¯¢çš„è¿”å›ç»“æœä¸ä¼šå¾ˆå¤šçš„è¯ï¼Œæˆ‘éƒ½å»ºè®®ä½ ä½¿ç”¨ mysql_store_result è¿™ä¸ªæ¥å£ï¼Œç›´æ¥æŠŠæŸ¥è¯¢ç»“æœä¿å­˜åˆ°æœ¬åœ°å†…å­˜ã€‚</strong></p><p>å½“ç„¶å‰ææ˜¯æŸ¥è¯¢è¿”å›ç»“æœä¸å¤šã€‚åœ¨[ç¬¬ 30 ç¯‡æ–‡ç« ]è¯„è®ºåŒºï¼Œæœ‰åŒå­¦è¯´åˆ°è‡ªå·±å› ä¸ºæ‰§è¡Œäº†ä¸€ä¸ªå¤§æŸ¥è¯¢å¯¼è‡´å®¢æˆ·ç«¯å ç”¨å†…å­˜è¿‘ 20Gï¼Œè¿™ç§æƒ…å†µä¸‹å°±éœ€è¦æ”¹ç”¨ mysql_use_result æ¥å£äº†ã€‚</p><p>å¦ä¸€æ–¹é¢ï¼Œå¦‚æœä½ åœ¨è‡ªå·±è´Ÿè´£ç»´æŠ¤çš„ MySQL é‡Œçœ‹åˆ°å¾ˆå¤šä¸ªçº¿ç¨‹éƒ½å¤„äºâ€œSending to clientâ€è¿™ä¸ªçŠ¶æ€ï¼Œå°±æ„å‘³ç€ä½ è¦è®©ä¸šåŠ¡å¼€å‘åŒå­¦ä¼˜åŒ–æŸ¥è¯¢ç»“æœï¼Œå¹¶è¯„ä¼°è¿™ä¹ˆå¤šçš„è¿”å›ç»“æœæ˜¯å¦åˆç†ã€‚</p><p>è€Œå¦‚æœè¦å¿«é€Ÿå‡å°‘å¤„äºè¿™ä¸ªçŠ¶æ€çš„çº¿ç¨‹çš„è¯ï¼Œå°† net_buffer_length å‚æ•°è®¾ç½®ä¸ºä¸€ä¸ªæ›´å¤§çš„å€¼æ˜¯ä¸€ä¸ªå¯é€‰æ–¹æ¡ˆã€‚</p><p>ä¸â€œSending to clientâ€é•¿ç›¸å¾ˆç±»ä¼¼çš„ä¸€ä¸ªçŠ¶æ€æ˜¯**â€œSending dataâ€**ï¼Œè¿™æ˜¯ä¸€ä¸ªç»å¸¸è¢«è¯¯ä¼šçš„é—®é¢˜ã€‚æœ‰åŒå­¦é—®æˆ‘è¯´ï¼Œåœ¨è‡ªå·±ç»´æŠ¤çš„å®ä¾‹ä¸Šçœ‹åˆ°å¾ˆå¤šæŸ¥è¯¢è¯­å¥çš„çŠ¶æ€æ˜¯â€œSending dataâ€ï¼Œä½†æŸ¥çœ‹ç½‘ç»œä¹Ÿæ²¡ä»€ä¹ˆé—®é¢˜å•Šï¼Œä¸ºä»€ä¹ˆ Sending data è¦è¿™ä¹ˆä¹…ï¼Ÿ</p><p>å®é™…ä¸Šï¼Œä¸€ä¸ªæŸ¥è¯¢è¯­å¥çš„çŠ¶æ€å˜åŒ–æ˜¯è¿™æ ·çš„ï¼ˆæ³¨æ„ï¼šè¿™é‡Œï¼Œæˆ‘ç•¥å»äº†å…¶ä»–æ— å…³çš„çŠ¶æ€ï¼‰ï¼š</p><ul><li>MySQL æŸ¥è¯¢è¯­å¥è¿›å…¥æ‰§è¡Œé˜¶æ®µåï¼Œé¦–å…ˆæŠŠçŠ¶æ€è®¾ç½®æˆâ€œSending dataâ€ï¼›</li><li>ç„¶åï¼Œå‘é€æ‰§è¡Œç»“æœçš„åˆ—ç›¸å…³çš„ä¿¡æ¯ï¼ˆmeta data) ç»™å®¢æˆ·ç«¯ï¼›</li><li>å†ç»§ç»­æ‰§è¡Œè¯­å¥çš„æµç¨‹ï¼›</li><li>æ‰§è¡Œå®Œæˆåï¼ŒæŠŠçŠ¶æ€è®¾ç½®æˆç©ºå­—ç¬¦ä¸²ã€‚</li></ul><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œâ€œSending dataâ€å¹¶ä¸ä¸€å®šæ˜¯æŒ‡â€œæ­£åœ¨å‘é€æ•°æ®â€ï¼Œè€Œå¯èƒ½æ˜¯å¤„äºæ‰§è¡Œå™¨è¿‡ç¨‹ä¸­çš„ä»»æ„é˜¶æ®µã€‚æ¯”å¦‚ï¼Œä½ å¯ä»¥æ„é€ ä¸€ä¸ªé”ç­‰å¾…çš„åœºæ™¯ï¼Œå°±èƒ½çœ‹åˆ° Sending data çŠ¶æ€ã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/7640b0d82965bf8b305514f30425424b-1584367400348.png" alt="img"></p><p>å›¾ 3 è¯»å…¨è¡¨è¢«é”</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/84533515cf36be65582309fbb85e13c0-1584367400352.png" alt="img"></p><p>å›¾ 4 Sending data çŠ¶æ€</p><p>å¯ä»¥çœ‹åˆ°ï¼Œsession B æ˜æ˜¾æ˜¯åœ¨ç­‰é”ï¼ŒçŠ¶æ€æ˜¾ç¤ºä¸º Sending dataã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œä»…å½“ä¸€ä¸ªçº¿ç¨‹å¤„äºâ€œç­‰å¾…å®¢æˆ·ç«¯æ¥æ”¶ç»“æœâ€çš„çŠ¶æ€ï¼Œæ‰ä¼šæ˜¾ç¤º&quot;Sending to client&quot;ï¼›è€Œå¦‚æœæ˜¾ç¤ºæˆâ€œSending dataâ€ï¼Œå®ƒçš„æ„æ€åªæ˜¯â€œæ­£åœ¨æ‰§è¡Œâ€ã€‚</p><p>ç°åœ¨ä½ çŸ¥é“äº†ï¼ŒæŸ¥è¯¢çš„ç»“æœæ˜¯åˆ†æ®µå‘ç»™å®¢æˆ·ç«¯çš„ï¼Œå› æ­¤æ‰«æå…¨è¡¨ï¼ŒæŸ¥è¯¢è¿”å›å¤§é‡çš„æ•°æ®ï¼Œå¹¶ä¸ä¼šæŠŠå†…å­˜æ‰“çˆ†ã€‚</p><p>åœ¨ server å±‚çš„å¤„ç†é€»è¾‘æˆ‘ä»¬éƒ½æ¸…æ¥šäº†ï¼Œåœ¨ InnoDB å¼•æ“é‡Œé¢åˆæ˜¯æ€ä¹ˆå¤„ç†çš„å‘¢ï¼Ÿ æ‰«æå…¨è¡¨ä¼šä¸ä¼šå¯¹å¼•æ“ç³»ç»Ÿé€ æˆå½±å“å‘¢ï¼Ÿ</p><h4 id="å…¨è¡¨æ‰«æå¯¹-innodb-çš„å½±å“" tabindex="-1"><a class="header-anchor" href="#å…¨è¡¨æ‰«æå¯¹-innodb-çš„å½±å“" aria-hidden="true">#</a> å…¨è¡¨æ‰«æå¯¹ InnoDB çš„å½±å“</h4><p>åœ¨[ç¬¬ 2]å’Œ[ç¬¬ 15 ç¯‡]æ–‡ç« ä¸­ï¼Œæˆ‘ä»‹ç» WAL æœºåˆ¶çš„æ—¶å€™ï¼Œå’Œä½ åˆ†æäº† InnoDB å†…å­˜çš„ä¸€ä¸ªä½œç”¨ï¼Œæ˜¯ä¿å­˜æ›´æ–°çš„ç»“æœï¼Œå†é…åˆ redo logï¼Œå°±é¿å…äº†éšæœºå†™ç›˜ã€‚</p><p>å†…å­˜çš„æ•°æ®é¡µæ˜¯åœ¨ Buffer Pool (BP) ä¸­ç®¡ç†çš„ï¼Œåœ¨ WAL é‡Œ Buffer Pool èµ·åˆ°äº†åŠ é€Ÿæ›´æ–°çš„ä½œç”¨ã€‚è€Œå®é™…ä¸Šï¼ŒBuffer Pool è¿˜æœ‰ä¸€ä¸ªæ›´é‡è¦çš„ä½œç”¨ï¼Œå°±æ˜¯åŠ é€ŸæŸ¥è¯¢ã€‚</p><p>åœ¨ç¬¬ 2 ç¯‡æ–‡ç« çš„è¯„è®ºåŒºæœ‰åŒå­¦é—®é“ï¼Œç”±äºæœ‰ WAL æœºåˆ¶ï¼Œå½“äº‹åŠ¡æäº¤çš„æ—¶å€™ï¼Œç£ç›˜ä¸Šçš„æ•°æ®é¡µæ˜¯æ—§çš„ï¼Œé‚£å¦‚æœè¿™æ—¶å€™é©¬ä¸Šæœ‰ä¸€ä¸ªæŸ¥è¯¢è¦æ¥è¯»è¿™ä¸ªæ•°æ®é¡µï¼Œæ˜¯ä¸æ˜¯è¦é©¬ä¸ŠæŠŠ redo log åº”ç”¨åˆ°æ•°æ®é¡µå‘¢ï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯ä¸éœ€è¦ã€‚å› ä¸ºè¿™æ—¶å€™å†…å­˜æ•°æ®é¡µçš„ç»“æœæ˜¯æœ€æ–°çš„ï¼Œç›´æ¥è¯»å†…å­˜é¡µå°±å¯ä»¥äº†ã€‚ä½ çœ‹ï¼Œè¿™æ—¶å€™æŸ¥è¯¢æ ¹æœ¬ä¸éœ€è¦è¯»ç£ç›˜ï¼Œç›´æ¥ä»å†…å­˜æ‹¿ç»“æœï¼Œé€Ÿåº¦æ˜¯å¾ˆå¿«çš„ã€‚æ‰€ä»¥è¯´ï¼ŒBuffer Pool è¿˜æœ‰åŠ é€ŸæŸ¥è¯¢çš„ä½œç”¨ã€‚</p><p>è€Œ Buffer Pool å¯¹æŸ¥è¯¢çš„åŠ é€Ÿæ•ˆæœï¼Œä¾èµ–äºä¸€ä¸ªé‡è¦çš„æŒ‡æ ‡ï¼Œå³ï¼š<strong>å†…å­˜å‘½ä¸­ç‡</strong>ã€‚</p><p>ä½ å¯ä»¥åœ¨ show engine innodb status ç»“æœä¸­ï¼ŒæŸ¥çœ‹ä¸€ä¸ªç³»ç»Ÿå½“å‰çš„ BP å‘½ä¸­ç‡ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸€ä¸ªç¨³å®šæœåŠ¡çš„çº¿ä¸Šç³»ç»Ÿï¼Œè¦ä¿è¯å“åº”æ—¶é—´ç¬¦åˆè¦æ±‚çš„è¯ï¼Œå†…å­˜å‘½ä¸­ç‡è¦åœ¨ 99% ä»¥ä¸Šã€‚</p><p>æ‰§è¡Œ show engine innodb status ï¼Œå¯ä»¥çœ‹åˆ°â€œBuffer pool hit rateâ€å­—æ ·ï¼Œæ˜¾ç¤ºçš„å°±æ˜¯å½“å‰çš„å‘½ä¸­ç‡ã€‚æ¯”å¦‚å›¾ 5 è¿™ä¸ªå‘½ä¸­ç‡ï¼Œå°±æ˜¯ 99.0%ã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/c70a95ee99826812c292c46de508982e-1584367400354.png" alt="img"></p><p>å›¾ 5 show engine innodb status æ˜¾ç¤ºå†…å­˜å‘½ä¸­ç‡</p><p>å¦‚æœæ‰€æœ‰æŸ¥è¯¢éœ€è¦çš„æ•°æ®é¡µéƒ½èƒ½å¤Ÿç›´æ¥ä»å†…å­˜å¾—åˆ°ï¼Œé‚£æ˜¯æœ€å¥½çš„ï¼Œå¯¹åº”çš„å‘½ä¸­ç‡å°±æ˜¯ 100%ã€‚ä½†ï¼Œè¿™åœ¨å®é™…ç”Ÿäº§ä¸Šæ˜¯å¾ˆéš¾åšåˆ°çš„ã€‚</p><p>InnoDB Buffer Pool çš„å¤§å°æ˜¯ç”±å‚æ•° innodb_buffer_pool_size ç¡®å®šçš„ï¼Œä¸€èˆ¬å»ºè®®è®¾ç½®æˆå¯ç”¨ç‰©ç†å†…å­˜çš„ 60%~80%ã€‚</p><p>åœ¨å¤§çº¦åå¹´å‰ï¼Œå•æœºçš„æ•°æ®é‡æ˜¯ä¸Šç™¾ä¸ª Gï¼Œè€Œç‰©ç†å†…å­˜æ˜¯å‡ ä¸ª Gï¼›ç°åœ¨è™½ç„¶å¾ˆå¤šæœåŠ¡å™¨éƒ½èƒ½æœ‰ 128G ç”šè‡³æ›´é«˜çš„å†…å­˜ï¼Œä½†æ˜¯å•æœºçš„æ•°æ®é‡å´è¾¾åˆ°äº† T çº§åˆ«ã€‚</p><p>æ‰€ä»¥ï¼Œinnodb_buffer_pool_size å°äºç£ç›˜çš„æ•°æ®é‡æ˜¯å¾ˆå¸¸è§çš„ã€‚å¦‚æœä¸€ä¸ª Buffer Pool æ»¡äº†ï¼Œè€Œåˆè¦ä»ç£ç›˜è¯»å…¥ä¸€ä¸ªæ•°æ®é¡µï¼Œé‚£è‚¯å®šæ˜¯è¦æ·˜æ±°ä¸€ä¸ªæ—§æ•°æ®é¡µçš„ã€‚</p><p>InnoDB å†…å­˜ç®¡ç†ç”¨çš„æ˜¯æœ€è¿‘æœ€å°‘ä½¿ç”¨ (Least Recently Used, LRU) ç®—æ³•ï¼Œè¿™ä¸ªç®—æ³•çš„æ ¸å¿ƒå°±æ˜¯æ·˜æ±°æœ€ä¹…æœªä½¿ç”¨çš„æ•°æ®ã€‚</p><p>ä¸‹å›¾æ˜¯ä¸€ä¸ª LRU ç®—æ³•çš„åŸºæœ¬æ¨¡å‹ã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/e0ac92febac50a5d881f1188ea5bfd65-1584367400359.jpg" alt="img"></p><p>å›¾ 6 åŸºæœ¬ LRU ç®—æ³•</p><p>InnoDB ç®¡ç† Buffer Pool çš„ LRU ç®—æ³•ï¼Œæ˜¯ç”¨é“¾è¡¨æ¥å®ç°çš„ã€‚</p><ol><li>åœ¨å›¾ 6 çš„çŠ¶æ€ 1 é‡Œï¼Œé“¾è¡¨å¤´éƒ¨æ˜¯ P1ï¼Œè¡¨ç¤º P1 æ˜¯æœ€è¿‘åˆšåˆšè¢«è®¿é—®è¿‡çš„æ•°æ®é¡µï¼›å‡è®¾å†…å­˜é‡Œåªèƒ½æ”¾ä¸‹è¿™ä¹ˆå¤šæ•°æ®é¡µï¼›</li><li>è¿™æ—¶å€™æœ‰ä¸€ä¸ªè¯»è¯·æ±‚è®¿é—® P3ï¼Œå› æ­¤å˜æˆçŠ¶æ€ 2ï¼ŒP3 è¢«ç§»åˆ°æœ€å‰é¢ï¼›</li><li>çŠ¶æ€ 3 è¡¨ç¤ºï¼Œè¿™æ¬¡è®¿é—®çš„æ•°æ®é¡µæ˜¯ä¸å­˜åœ¨äºé“¾è¡¨ä¸­çš„ï¼Œæ‰€ä»¥éœ€è¦åœ¨ Buffer Pool ä¸­æ–°ç”³è¯·ä¸€ä¸ªæ•°æ®é¡µ Pxï¼ŒåŠ åˆ°é“¾è¡¨å¤´éƒ¨ã€‚ä½†æ˜¯ç”±äºå†…å­˜å·²ç»æ»¡äº†ï¼Œä¸èƒ½ç”³è¯·æ–°çš„å†…å­˜ã€‚äºæ˜¯ï¼Œä¼šæ¸…ç©ºé“¾è¡¨æœ«å°¾ Pm è¿™ä¸ªæ•°æ®é¡µçš„å†…å­˜ï¼Œå­˜å…¥ Px çš„å†…å®¹ï¼Œç„¶åæ”¾åˆ°é“¾è¡¨å¤´éƒ¨ã€‚</li><li>ä»æ•ˆæœä¸Šçœ‹ï¼Œå°±æ˜¯æœ€ä¹…æ²¡æœ‰è¢«è®¿é—®çš„æ•°æ®é¡µ Pmï¼Œè¢«æ·˜æ±°äº†ã€‚</li></ol><p>è¿™ä¸ªç®—æ³•ä¹ä¸€çœ‹ä¸Šå»æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯å¦‚æœè€ƒè™‘åˆ°è¦åšä¸€ä¸ªå…¨è¡¨æ‰«æï¼Œä¼šä¸ä¼šæœ‰é—®é¢˜å‘¢ï¼Ÿ</p><p>å‡è®¾æŒ‰ç…§è¿™ä¸ªç®—æ³•ï¼Œæˆ‘ä»¬è¦æ‰«æä¸€ä¸ª 200G çš„è¡¨ï¼Œè€Œè¿™ä¸ªè¡¨æ˜¯ä¸€ä¸ªå†å²æ•°æ®è¡¨ï¼Œå¹³æ—¶æ²¡æœ‰ä¸šåŠ¡è®¿é—®å®ƒã€‚</p><p>é‚£ä¹ˆï¼ŒæŒ‰ç…§è¿™ä¸ªç®—æ³•æ‰«æçš„è¯ï¼Œå°±ä¼šæŠŠå½“å‰çš„ Buffer Pool é‡Œçš„æ•°æ®å…¨éƒ¨æ·˜æ±°æ‰ï¼Œå­˜å…¥æ‰«æè¿‡ç¨‹ä¸­è®¿é—®åˆ°çš„æ•°æ®é¡µçš„å†…å®¹ã€‚ä¹Ÿå°±æ˜¯è¯´ Buffer Pool é‡Œé¢ä¸»è¦æ”¾çš„æ˜¯è¿™ä¸ªå†å²æ•°æ®è¡¨çš„æ•°æ®ã€‚</p><p>å¯¹äºä¸€ä¸ªæ­£åœ¨åšä¸šåŠ¡æœåŠ¡çš„åº“ï¼Œè¿™å¯ä¸å¦™ã€‚ä½ ä¼šçœ‹åˆ°ï¼ŒBuffer Pool çš„å†…å­˜å‘½ä¸­ç‡æ€¥å‰§ä¸‹é™ï¼Œç£ç›˜å‹åŠ›å¢åŠ ï¼ŒSQL è¯­å¥å“åº”å˜æ…¢ã€‚</p><p>æ‰€ä»¥ï¼ŒInnoDB ä¸èƒ½ç›´æ¥ä½¿ç”¨è¿™ä¸ª LRU ç®—æ³•ã€‚å®é™…ä¸Šï¼ŒInnoDB å¯¹ LRU ç®—æ³•åšäº†æ”¹è¿›ã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/25e18920dd204cf99eec2d62755fe99e-1584367400443.png" alt="img"></p><p>å›¾ 7 æ”¹è¿›çš„ LRU ç®—æ³•</p><p>åœ¨ InnoDB å®ç°ä¸Šï¼ŒæŒ‰ç…§ 5:3 çš„æ¯”ä¾‹æŠŠæ•´ä¸ª LRU é“¾è¡¨åˆ†æˆäº† young åŒºåŸŸå’Œ old åŒºåŸŸã€‚å›¾ä¸­ LRU_old æŒ‡å‘çš„å°±æ˜¯ old åŒºåŸŸçš„ç¬¬ä¸€ä¸ªä½ç½®ï¼Œæ˜¯æ•´ä¸ªé“¾è¡¨çš„ 5/8 å¤„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œé è¿‘é“¾è¡¨å¤´éƒ¨çš„ 5/8 æ˜¯ young åŒºåŸŸï¼Œé è¿‘é“¾è¡¨å°¾éƒ¨çš„ 3/8 æ˜¯ old åŒºåŸŸã€‚</p><p>æ”¹è¿›åçš„ LRU ç®—æ³•æ‰§è¡Œæµç¨‹å˜æˆäº†ä¸‹é¢è¿™æ ·ã€‚</p><ol><li>å›¾ 7 ä¸­çŠ¶æ€ 1ï¼Œè¦è®¿é—®æ•°æ®é¡µ P3ï¼Œç”±äº P3 åœ¨ young åŒºåŸŸï¼Œå› æ­¤å’Œä¼˜åŒ–å‰çš„ LRU ç®—æ³•ä¸€æ ·ï¼Œå°†å…¶ç§»åˆ°é“¾è¡¨å¤´éƒ¨ï¼Œå˜æˆçŠ¶æ€ 2ã€‚</li><li>ä¹‹åè¦è®¿é—®ä¸€ä¸ªæ–°çš„ä¸å­˜åœ¨äºå½“å‰é“¾è¡¨çš„æ•°æ®é¡µï¼Œè¿™æ—¶å€™ä¾ç„¶æ˜¯æ·˜æ±°æ‰æ•°æ®é¡µ Pmï¼Œä½†æ˜¯æ–°æ’å…¥çš„æ•°æ®é¡µ Pxï¼Œæ˜¯æ”¾åœ¨ LRU_old å¤„ã€‚</li><li>å¤„äº old åŒºåŸŸçš„æ•°æ®é¡µï¼Œæ¯æ¬¡è¢«è®¿é—®çš„æ—¶å€™éƒ½è¦åšä¸‹é¢è¿™ä¸ªåˆ¤æ–­ï¼š <ul><li>è‹¥è¿™ä¸ªæ•°æ®é¡µåœ¨ LRU é“¾è¡¨ä¸­å­˜åœ¨çš„æ—¶é—´è¶…è¿‡äº† 1 ç§’ï¼Œå°±æŠŠå®ƒç§»åŠ¨åˆ°é“¾è¡¨å¤´éƒ¨ï¼›</li><li>å¦‚æœè¿™ä¸ªæ•°æ®é¡µåœ¨ LRU é“¾è¡¨ä¸­å­˜åœ¨çš„æ—¶é—´çŸ­äº 1 ç§’ï¼Œä½ç½®ä¿æŒä¸å˜ã€‚1 ç§’è¿™ä¸ªæ—¶é—´ï¼Œæ˜¯ç”±å‚æ•° innodb_old_blocks_time æ§åˆ¶çš„ã€‚å…¶é»˜è®¤å€¼æ˜¯ 1000ï¼Œå•ä½æ¯«ç§’ã€‚</li></ul></li></ol><p>è¿™ä¸ªç­–ç•¥ï¼Œå°±æ˜¯ä¸ºäº†å¤„ç†ç±»ä¼¼å…¨è¡¨æ‰«æçš„æ“ä½œé‡èº«å®šåˆ¶çš„ã€‚è¿˜æ˜¯ä»¥åˆšåˆšçš„æ‰«æ 200G çš„å†å²æ•°æ®è¡¨ä¸ºä¾‹ï¼Œæˆ‘ä»¬çœ‹çœ‹æ”¹è¿›åçš„ LRU ç®—æ³•çš„æ“ä½œé€»è¾‘ï¼š</p><ol><li>æ‰«æè¿‡ç¨‹ä¸­ï¼Œéœ€è¦æ–°æ’å…¥çš„æ•°æ®é¡µï¼Œéƒ½è¢«æ”¾åˆ° old åŒºåŸŸ ;</li><li>ä¸€ä¸ªæ•°æ®é¡µé‡Œé¢æœ‰å¤šæ¡è®°å½•ï¼Œè¿™ä¸ªæ•°æ®é¡µä¼šè¢«å¤šæ¬¡è®¿é—®åˆ°ï¼Œä½†ç”±äºæ˜¯é¡ºåºæ‰«æï¼Œè¿™ä¸ªæ•°æ®é¡µç¬¬ä¸€æ¬¡è¢«è®¿é—®å’Œæœ€åä¸€æ¬¡è¢«è®¿é—®çš„æ—¶é—´é—´éš”ä¸ä¼šè¶…è¿‡ 1 ç§’ï¼Œå› æ­¤è¿˜æ˜¯ä¼šè¢«ä¿ç•™åœ¨ old åŒºåŸŸï¼›</li><li>å†ç»§ç»­æ‰«æåç»­çš„æ•°æ®ï¼Œä¹‹å‰çš„è¿™ä¸ªæ•°æ®é¡µä¹‹åä¹Ÿä¸ä¼šå†è¢«è®¿é—®åˆ°ï¼Œäºæ˜¯å§‹ç»ˆæ²¡æœ‰æœºä¼šç§»åˆ°é“¾è¡¨å¤´éƒ¨ï¼ˆä¹Ÿå°±æ˜¯ young åŒºåŸŸï¼‰ï¼Œå¾ˆå¿«å°±ä¼šè¢«æ·˜æ±°å‡ºå»ã€‚</li></ol><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªç­–ç•¥æœ€å¤§çš„æ”¶ç›Šï¼Œå°±æ˜¯åœ¨æ‰«æè¿™ä¸ªå¤§è¡¨çš„è¿‡ç¨‹ä¸­ï¼Œè™½ç„¶ä¹Ÿç”¨åˆ°äº† Buffer Poolï¼Œä½†æ˜¯å¯¹ young åŒºåŸŸå®Œå…¨æ²¡æœ‰å½±å“ï¼Œä»è€Œä¿è¯äº† Buffer Pool å“åº”æ­£å¸¸ä¸šåŠ¡çš„æŸ¥è¯¢å‘½ä¸­ç‡ã€‚</p><h4 id="å°ç»“-20" tabindex="-1"><a class="header-anchor" href="#å°ç»“-20" aria-hidden="true">#</a> å°ç»“</h4><p>ä»Šå¤©ï¼Œæˆ‘ç”¨â€œå¤§æŸ¥è¯¢ä¼šä¸ä¼šæŠŠå†…å­˜ç”¨å…‰â€è¿™ä¸ªé—®é¢˜ï¼Œå’Œä½ ä»‹ç»äº† MySQL çš„æŸ¥è¯¢ç»“æœï¼Œå‘é€ç»™å®¢æˆ·ç«¯çš„è¿‡ç¨‹ã€‚</p><p>ç”±äº MySQL é‡‡ç”¨çš„æ˜¯è¾¹ç®—è¾¹å‘çš„é€»è¾‘ï¼Œå› æ­¤å¯¹äºæ•°æ®é‡å¾ˆå¤§çš„æŸ¥è¯¢ç»“æœæ¥è¯´ï¼Œä¸ä¼šåœ¨ server ç«¯ä¿å­˜å®Œæ•´çš„ç»“æœé›†ã€‚æ‰€ä»¥ï¼Œå¦‚æœå®¢æˆ·ç«¯è¯»ç»“æœä¸åŠæ—¶ï¼Œä¼šå µä½ MySQL çš„æŸ¥è¯¢è¿‡ç¨‹ï¼Œä½†æ˜¯ä¸ä¼šæŠŠå†…å­˜æ‰“çˆ†ã€‚</p><p>è€Œå¯¹äº InnoDB å¼•æ“å†…éƒ¨ï¼Œç”±äºæœ‰æ·˜æ±°ç­–ç•¥ï¼Œå¤§æŸ¥è¯¢ä¹Ÿä¸ä¼šå¯¼è‡´å†…å­˜æš´æ¶¨ã€‚å¹¶ä¸”ï¼Œç”±äº InnoDB å¯¹ LRU ç®—æ³•åšäº†æ”¹è¿›ï¼Œå†·æ•°æ®çš„å…¨è¡¨æ‰«æï¼Œå¯¹ Buffer Pool çš„å½±å“ä¹Ÿèƒ½åšåˆ°å¯æ§ã€‚</p><p>å½“ç„¶ï¼Œæˆ‘ä»¬å‰é¢æ–‡ç« æœ‰è¯´è¿‡ï¼Œå…¨è¡¨æ‰«æè¿˜æ˜¯æ¯”è¾ƒè€—è´¹ IO èµ„æºçš„ï¼Œæ‰€ä»¥ä¸šåŠ¡é«˜å³°æœŸè¿˜æ˜¯ä¸èƒ½ç›´æ¥åœ¨çº¿ä¸Šä¸»åº“æ‰§è¡Œå…¨è¡¨æ‰«æçš„ã€‚</p><p>æœ€åï¼Œæˆ‘ç»™ä½ ç•™ä¸€ä¸ªæ€è€ƒé¢˜å§ã€‚</p><p>æˆ‘åœ¨æ–‡ç« ä¸­è¯´åˆ°ï¼Œå¦‚æœç”±äºå®¢æˆ·ç«¯å‹åŠ›å¤ªå¤§ï¼Œè¿Ÿè¿Ÿä¸èƒ½æ¥æ”¶ç»“æœï¼Œä¼šå¯¼è‡´ MySQL æ— æ³•å‘é€ç»“æœè€Œå½±å“è¯­å¥æ‰§è¡Œã€‚ä½†ï¼Œè¿™è¿˜ä¸æ˜¯æœ€ç³Ÿç³•çš„æƒ…å†µã€‚</p><p>ä½ å¯ä»¥è®¾æƒ³å‡ºç”±äºå®¢æˆ·ç«¯çš„æ€§èƒ½é—®é¢˜ï¼Œå¯¹æ•°æ®åº“å½±å“æ›´ä¸¥é‡çš„ä¾‹å­å—ï¼Ÿæˆ–è€…ä½ æ˜¯å¦ç»å†è¿‡è¿™æ ·çš„åœºæ™¯ï¼Ÿä½ åˆæ˜¯æ€ä¹ˆä¼˜åŒ–çš„ï¼Ÿ</p><p>ä½ å¯ä»¥æŠŠä½ çš„ç»éªŒå’Œåˆ†æå†™åœ¨ç•™è¨€åŒºï¼Œæˆ‘ä¼šåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« çš„æœ«å°¾å’Œä½ è®¨è®ºè¿™ä¸ªé—®é¢˜ã€‚æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚</p><h4 id="ä¸ŠæœŸé—®é¢˜æ—¶é—´-17" tabindex="-1"><a class="header-anchor" href="#ä¸ŠæœŸé—®é¢˜æ—¶é—´-17" aria-hidden="true">#</a> ä¸ŠæœŸé—®é¢˜æ—¶é—´</h4><p>ä¸ŠæœŸçš„é—®é¢˜æ˜¯ï¼Œå¦‚æœä¸€ä¸ªäº‹åŠ¡è¢« kill ä¹‹åï¼ŒæŒç»­å¤„äºå›æ»šçŠ¶æ€ï¼Œä»æ¢å¤é€Ÿåº¦çš„è§’åº¦çœ‹ï¼Œä½ æ˜¯åº”è¯¥é‡å¯ç­‰å®ƒæ‰§è¡Œç»“æŸï¼Œè¿˜æ˜¯åº”è¯¥å¼ºè¡Œé‡å¯æ•´ä¸ª MySQL è¿›ç¨‹ã€‚</p><p>å› ä¸ºé‡å¯ä¹‹åè¯¥åšçš„å›æ»šåŠ¨ä½œè¿˜æ˜¯ä¸èƒ½å°‘çš„ï¼Œæ‰€ä»¥ä»æ¢å¤é€Ÿåº¦çš„è§’åº¦æ¥è¯´ï¼Œåº”è¯¥è®©å®ƒè‡ªå·±ç»“æŸã€‚</p><p>å½“ç„¶ï¼Œå¦‚æœè¿™ä¸ªè¯­å¥å¯èƒ½ä¼šå ç”¨åˆ«çš„é”ï¼Œæˆ–è€…ç”±äºå ç”¨ IO èµ„æºè¿‡å¤šï¼Œä»è€Œå½±å“åˆ°äº†åˆ«çš„è¯­å¥æ‰§è¡Œçš„è¯ï¼Œå°±éœ€è¦å…ˆåšä¸»å¤‡åˆ‡æ¢ï¼Œåˆ‡åˆ°æ–°ä¸»åº“æä¾›æœåŠ¡ã€‚</p><p>åˆ‡æ¢ä¹‹ååˆ«çš„çº¿ç¨‹éƒ½æ–­å¼€äº†è¿æ¥ï¼Œè‡ªåŠ¨åœæ­¢æ‰§è¡Œã€‚æ¥ä¸‹æ¥è¿˜æ˜¯ç­‰å®ƒè‡ªå·±æ‰§è¡Œå®Œæˆã€‚è¿™ä¸ªæ“ä½œå±äºæˆ‘ä»¬åœ¨æ–‡ç« ä¸­è¯´åˆ°çš„ï¼Œå‡å°‘ç³»ç»Ÿå‹åŠ›ï¼ŒåŠ é€Ÿç»ˆæ­¢é€»è¾‘ã€‚</p><p>è¯„è®ºåŒºç•™è¨€ç‚¹èµæ¿ï¼š</p><blockquote><p>@HuaMax çš„å›ç­”ä¸­æåˆ°äº†å¯¹å…¶ä»–çº¿ç¨‹çš„å½±å“ï¼› @å¤¹å¿ƒé¢åŒ… @Ryoma @æ›¾å‰‘ åŒå­¦æåˆ°äº†é‡å¯åä¾ç„¶ç»§ç»­åšå›æ»šæ“ä½œçš„é€»è¾‘ã€‚</p></blockquote><h3 id="_34-åˆ°åº•å¯ä¸å¯ä»¥ä½¿ç”¨join" tabindex="-1"><a class="header-anchor" href="#_34-åˆ°åº•å¯ä¸å¯ä»¥ä½¿ç”¨join" aria-hidden="true">#</a> 34 åˆ°åº•å¯ä¸å¯ä»¥ä½¿ç”¨joinï¼Ÿ</h3><p>åœ¨å®é™…ç”Ÿäº§ä¸­ï¼Œå…³äº join è¯­å¥ä½¿ç”¨çš„é—®é¢˜ï¼Œä¸€èˆ¬ä¼šé›†ä¸­åœ¨ä»¥ä¸‹ä¸¤ç±»ï¼š</p><ol><li>æˆ‘ä»¬ DBA ä¸è®©ä½¿ç”¨ joinï¼Œä½¿ç”¨ join æœ‰ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ</li><li>å¦‚æœæœ‰ä¸¤ä¸ªå¤§å°ä¸åŒçš„è¡¨åš joinï¼Œåº”è¯¥ç”¨å“ªä¸ªè¡¨åšé©±åŠ¨è¡¨å‘¢ï¼Ÿ</li></ol><p>ä»Šå¤©è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘å°±å…ˆè·Ÿä½ è¯´è¯´ join è¯­å¥åˆ°åº•æ˜¯æ€ä¹ˆæ‰§è¡Œçš„ï¼Œç„¶åå†æ¥å›ç­”è¿™ä¸¤ä¸ªé—®é¢˜ã€‚</p><p>ä¸ºäº†ä¾¿äºé‡åŒ–åˆ†æï¼Œæˆ‘è¿˜æ˜¯åˆ›å»ºä¸¤ä¸ªè¡¨ t1 å’Œ t2 æ¥å’Œä½ è¯´æ˜ã€‚</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>t2<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>a<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>b<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>a<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>a<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span><span class="token punctuation">;</span> 
<span class="token keyword">drop</span> <span class="token keyword">procedure</span> idata<span class="token punctuation">;</span>
<span class="token keyword">delimiter</span> <span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">create</span> <span class="token keyword">procedure</span> idata<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">begin</span>
  <span class="token keyword">declare</span> i <span class="token keyword">int</span><span class="token punctuation">;</span>
  <span class="token keyword">set</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span><span class="token punctuation">(</span>i<span class="token operator">&lt;=</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token keyword">do</span>
    <span class="token keyword">insert</span> <span class="token keyword">into</span> t2 <span class="token keyword">values</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> i<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">set</span> i<span class="token operator">=</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">end</span> <span class="token keyword">while</span><span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">delimiter</span> <span class="token punctuation">;</span>
<span class="token keyword">call</span> idata<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">create</span> <span class="token keyword">table</span> t1 <span class="token operator">like</span> t2<span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> t1 <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t2 <span class="token keyword">where</span> id<span class="token operator">&lt;=</span><span class="token number">100</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸¤ä¸ªè¡¨éƒ½æœ‰ä¸€ä¸ªä¸»é”®ç´¢å¼• id å’Œä¸€ä¸ªç´¢å¼• aï¼Œå­—æ®µ b ä¸Šæ— ç´¢å¼•ã€‚å­˜å‚¨è¿‡ç¨‹ idata() å¾€è¡¨ t2 é‡Œæ’å…¥äº† 1000 è¡Œæ•°æ®ï¼Œåœ¨è¡¨ t1 é‡Œæ’å…¥çš„æ˜¯ 100 è¡Œæ•°æ®ã€‚</p><h4 id="index-nested-loop-join" tabindex="-1"><a class="header-anchor" href="#index-nested-loop-join" aria-hidden="true">#</a> Index Nested-Loop Join</h4><p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¿™ä¸ªè¯­å¥ï¼š</p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t1 straight_join t2 <span class="token keyword">on</span> <span class="token punctuation">(</span>t1<span class="token punctuation">.</span>a<span class="token operator">=</span>t2<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å¦‚æœç›´æ¥ä½¿ç”¨ join è¯­å¥ï¼ŒMySQL ä¼˜åŒ–å™¨å¯èƒ½ä¼šé€‰æ‹©è¡¨ t1 æˆ– t2 ä½œä¸ºé©±åŠ¨è¡¨ï¼Œè¿™æ ·ä¼šå½±å“æˆ‘ä»¬åˆ†æ SQL è¯­å¥çš„æ‰§è¡Œè¿‡ç¨‹ã€‚æ‰€ä»¥ï¼Œä¸ºäº†ä¾¿äºåˆ†ææ‰§è¡Œè¿‡ç¨‹ä¸­çš„æ€§èƒ½é—®é¢˜ï¼Œæˆ‘æ”¹ç”¨ straight_join è®© MySQL ä½¿ç”¨å›ºå®šçš„è¿æ¥æ–¹å¼æ‰§è¡ŒæŸ¥è¯¢ï¼Œè¿™æ ·ä¼˜åŒ–å™¨åªä¼šæŒ‰ç…§æˆ‘ä»¬æŒ‡å®šçš„æ–¹å¼å» joinã€‚åœ¨è¿™ä¸ªè¯­å¥é‡Œï¼Œt1 æ˜¯é©±åŠ¨è¡¨ï¼Œt2 æ˜¯è¢«é©±åŠ¨è¡¨ã€‚</p><p>ç°åœ¨ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¿™æ¡è¯­å¥çš„ explain ç»“æœã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/4b9cb0e0b83618e01c9bfde44a0ea990-1584367400492.png" alt="img"></p><p>å›¾ 1 ä½¿ç”¨ç´¢å¼•å­—æ®µ join çš„ explain ç»“æœ</p><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨è¿™æ¡è¯­å¥é‡Œï¼Œè¢«é©±åŠ¨è¡¨ t2 çš„å­—æ®µ a ä¸Šæœ‰ç´¢å¼•ï¼Œjoin è¿‡ç¨‹ç”¨ä¸Šäº†è¿™ä¸ªç´¢å¼•ï¼Œå› æ­¤è¿™ä¸ªè¯­å¥çš„æ‰§è¡Œæµç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><ol><li>ä»è¡¨ t1 ä¸­è¯»å…¥ä¸€è¡Œæ•°æ® Rï¼›</li><li>ä»æ•°æ®è¡Œ R ä¸­ï¼Œå–å‡º a å­—æ®µåˆ°è¡¨ t2 é‡Œå»æŸ¥æ‰¾ï¼›</li><li>å–å‡ºè¡¨ t2 ä¸­æ»¡è¶³æ¡ä»¶çš„è¡Œï¼Œè·Ÿ R ç»„æˆä¸€è¡Œï¼Œä½œä¸ºç»“æœé›†çš„ä¸€éƒ¨åˆ†ï¼›</li><li>é‡å¤æ‰§è¡Œæ­¥éª¤ 1 åˆ° 3ï¼Œç›´åˆ°è¡¨ t1 çš„æœ«å°¾å¾ªç¯ç»“æŸã€‚</li></ol><p>è¿™ä¸ªè¿‡ç¨‹æ˜¯å…ˆéå†è¡¨ t1ï¼Œç„¶åæ ¹æ®ä»è¡¨ t1 ä¸­å–å‡ºçš„æ¯è¡Œæ•°æ®ä¸­çš„ a å€¼ï¼Œå»è¡¨ t2 ä¸­æŸ¥æ‰¾æ»¡è¶³æ¡ä»¶çš„è®°å½•ã€‚åœ¨å½¢å¼ä¸Šï¼Œè¿™ä¸ªè¿‡ç¨‹å°±è·Ÿæˆ‘ä»¬å†™ç¨‹åºæ—¶çš„åµŒå¥—æŸ¥è¯¢ç±»ä¼¼ï¼Œå¹¶ä¸”å¯ä»¥ç”¨ä¸Šè¢«é©±åŠ¨è¡¨çš„ç´¢å¼•ï¼Œæ‰€ä»¥æˆ‘ä»¬ç§°ä¹‹ä¸ºâ€œIndex Nested-Loop Joinâ€ï¼Œç®€ç§° NLJã€‚</p><p>å®ƒå¯¹åº”çš„æµç¨‹å›¾å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/d83ad1cbd6118603be795b26d38f8df6-1584367400497.jpg" alt="img"></p><p>å›¾ 2 Index Nested-Loop Join ç®—æ³•çš„æ‰§è¡Œæµç¨‹</p><p>åœ¨è¿™ä¸ªæµç¨‹é‡Œï¼š</p><ol><li>å¯¹é©±åŠ¨è¡¨ t1 åšäº†å…¨è¡¨æ‰«æï¼Œè¿™ä¸ªè¿‡ç¨‹éœ€è¦æ‰«æ 100 è¡Œï¼›</li><li>è€Œå¯¹äºæ¯ä¸€è¡Œ Rï¼Œæ ¹æ® a å­—æ®µå»è¡¨ t2 æŸ¥æ‰¾ï¼Œèµ°çš„æ˜¯æ ‘æœç´¢è¿‡ç¨‹ã€‚ç”±äºæˆ‘ä»¬æ„é€ çš„æ•°æ®éƒ½æ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œå› æ­¤æ¯æ¬¡çš„æœç´¢è¿‡ç¨‹éƒ½åªæ‰«æä¸€è¡Œï¼Œä¹Ÿæ˜¯æ€»å…±æ‰«æ 100 è¡Œï¼›</li><li>æ‰€ä»¥ï¼Œæ•´ä¸ªæ‰§è¡Œæµç¨‹ï¼Œæ€»æ‰«æè¡Œæ•°æ˜¯ 200ã€‚</li></ol><p>ç°åœ¨æˆ‘ä»¬çŸ¥é“äº†è¿™ä¸ªè¿‡ç¨‹ï¼Œå†è¯•ç€å›ç­”ä¸€ä¸‹æ–‡ç« å¼€å¤´çš„ä¸¤ä¸ªé—®é¢˜ã€‚</p><p>å…ˆçœ‹ç¬¬ä¸€ä¸ªé—®é¢˜ï¼š<strong>èƒ½ä¸èƒ½ä½¿ç”¨ join?</strong></p><p>å‡è®¾ä¸ä½¿ç”¨ joinï¼Œé‚£æˆ‘ä»¬å°±åªèƒ½ç”¨å•è¡¨æŸ¥è¯¢ã€‚æˆ‘ä»¬çœ‹çœ‹ä¸Šé¢è¿™æ¡è¯­å¥çš„éœ€æ±‚ï¼Œç”¨å•è¡¨æŸ¥è¯¢æ€ä¹ˆå®ç°ã€‚</p><ol><li>æ‰§è¡Œ<code>select * from t1</code>ï¼ŒæŸ¥å‡ºè¡¨ t1 çš„æ‰€æœ‰æ•°æ®ï¼Œè¿™é‡Œæœ‰ 100 è¡Œï¼›</li><li>å¾ªç¯éå†è¿™ 100 è¡Œæ•°æ®ï¼š <ul><li>ä»æ¯ä¸€è¡Œ R å–å‡ºå­—æ®µ a çš„å€¼ $R.aï¼›</li><li>æ‰§è¡Œ<code>select * from t2 where a=$R.a</code>ï¼›</li><li>æŠŠè¿”å›çš„ç»“æœå’Œ R æ„æˆç»“æœé›†çš„ä¸€è¡Œã€‚</li></ul></li></ol><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨è¿™ä¸ªæŸ¥è¯¢è¿‡ç¨‹ï¼Œä¹Ÿæ˜¯æ‰«æäº† 200 è¡Œï¼Œä½†æ˜¯æ€»å…±æ‰§è¡Œäº† 101 æ¡è¯­å¥ï¼Œæ¯”ç›´æ¥ join å¤šäº† 100 æ¬¡äº¤äº’ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå®¢æˆ·ç«¯è¿˜è¦è‡ªå·±æ‹¼æ¥ SQL è¯­å¥å’Œç»“æœã€‚</p><p>æ˜¾ç„¶ï¼Œè¿™ä¹ˆåšè¿˜ä¸å¦‚ç›´æ¥ join å¥½ã€‚</p><p>æˆ‘ä»¬å†æ¥çœ‹çœ‹ç¬¬äºŒä¸ªé—®é¢˜ï¼š<strong>æ€ä¹ˆé€‰æ‹©é©±åŠ¨è¡¨ï¼Ÿ</strong></p><p>åœ¨è¿™ä¸ª join è¯­å¥æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œé©±åŠ¨è¡¨æ˜¯èµ°å…¨è¡¨æ‰«æï¼Œè€Œè¢«é©±åŠ¨è¡¨æ˜¯èµ°æ ‘æœç´¢ã€‚</p><p>å‡è®¾è¢«é©±åŠ¨è¡¨çš„è¡Œæ•°æ˜¯ Mã€‚æ¯æ¬¡åœ¨è¢«é©±åŠ¨è¡¨æŸ¥ä¸€è¡Œæ•°æ®ï¼Œè¦å…ˆæœç´¢ç´¢å¼• aï¼Œå†æœç´¢ä¸»é”®ç´¢å¼•ã€‚æ¯æ¬¡æœç´¢ä¸€æ£µæ ‘è¿‘ä¼¼å¤æ‚åº¦æ˜¯ä»¥ 2 ä¸ºåº•çš„ M çš„å¯¹æ•°ï¼Œè®°ä¸º log2Mï¼Œæ‰€ä»¥åœ¨è¢«é©±åŠ¨è¡¨ä¸ŠæŸ¥ä¸€è¡Œçš„æ—¶é—´å¤æ‚åº¦æ˜¯ 2*log2Mã€‚</p><p>å‡è®¾é©±åŠ¨è¡¨çš„è¡Œæ•°æ˜¯ Nï¼Œæ‰§è¡Œè¿‡ç¨‹å°±è¦æ‰«æé©±åŠ¨è¡¨ N è¡Œï¼Œç„¶åå¯¹äºæ¯ä¸€è¡Œï¼Œåˆ°è¢«é©±åŠ¨è¡¨ä¸ŠåŒ¹é…ä¸€æ¬¡ã€‚</p><p>å› æ­¤æ•´ä¸ªæ‰§è¡Œè¿‡ç¨‹ï¼Œè¿‘ä¼¼å¤æ‚åº¦æ˜¯ N + N<em>2</em>log2Mã€‚</p><p>æ˜¾ç„¶ï¼ŒN å¯¹æ‰«æè¡Œæ•°çš„å½±å“æ›´å¤§ï¼Œå› æ­¤åº”è¯¥è®©å°è¡¨æ¥åšé©±åŠ¨è¡¨ã€‚</p><blockquote><p>å¦‚æœä½ æ²¡è§‰å¾—è¿™ä¸ªå½±å“æœ‰é‚£ä¹ˆâ€œæ˜¾ç„¶â€ï¼Œ å¯ä»¥è¿™ä¹ˆç†è§£ï¼šN æ‰©å¤§ 1000 å€çš„è¯ï¼Œæ‰«æè¡Œæ•°å°±ä¼šæ‰©å¤§ 1000 å€ï¼›è€Œ M æ‰©å¤§ 1000 å€ï¼Œæ‰«æè¡Œæ•°æ‰©å¤§ä¸åˆ° 10 å€ã€‚</p></blockquote><p>åˆ°è¿™é‡Œå°ç»“ä¸€ä¸‹ï¼Œé€šè¿‡ä¸Šé¢çš„åˆ†ææˆ‘ä»¬å¾—åˆ°äº†ä¸¤ä¸ªç»“è®ºï¼š</p><ol><li>ä½¿ç”¨ join è¯­å¥ï¼Œæ€§èƒ½æ¯”å¼ºè¡Œæ‹†æˆå¤šä¸ªå•è¡¨æ‰§è¡Œ SQL è¯­å¥çš„æ€§èƒ½è¦å¥½ï¼›</li><li>å¦‚æœä½¿ç”¨ join è¯­å¥çš„è¯ï¼Œéœ€è¦è®©å°è¡¨åšé©±åŠ¨è¡¨ã€‚</li></ol><p>ä½†æ˜¯ï¼Œä½ éœ€è¦æ³¨æ„ï¼Œè¿™ä¸ªç»“è®ºçš„å‰ææ˜¯â€œå¯ä»¥ä½¿ç”¨è¢«é©±åŠ¨è¡¨çš„ç´¢å¼•â€ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†çœ‹çœ‹è¢«é©±åŠ¨è¡¨ç”¨ä¸ä¸Šç´¢å¼•çš„æƒ…å†µã€‚</p><h4 id="simple-nested-loop-join" tabindex="-1"><a class="header-anchor" href="#simple-nested-loop-join" aria-hidden="true">#</a> Simple Nested-Loop Join</h4><p>ç°åœ¨ï¼Œæˆ‘ä»¬æŠŠ SQL è¯­å¥æ”¹æˆè¿™æ ·ï¼š</p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t1 straight_join t2 <span class="token keyword">on</span> <span class="token punctuation">(</span>t1<span class="token punctuation">.</span>a<span class="token operator">=</span>t2<span class="token punctuation">.</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ç”±äºè¡¨ t2 çš„å­—æ®µ b ä¸Šæ²¡æœ‰ç´¢å¼•ï¼Œå› æ­¤å†ç”¨å›¾ 2 çš„æ‰§è¡Œæµç¨‹æ—¶ï¼Œæ¯æ¬¡åˆ° t2 å»åŒ¹é…çš„æ—¶å€™ï¼Œå°±è¦åšä¸€æ¬¡å…¨è¡¨æ‰«æã€‚</p><p>ä½ å¯ä»¥å…ˆè®¾æƒ³ä¸€ä¸‹è¿™ä¸ªé—®é¢˜ï¼Œç»§ç»­ä½¿ç”¨å›¾ 2 çš„ç®—æ³•ï¼Œæ˜¯ä¸æ˜¯å¯ä»¥å¾—åˆ°æ­£ç¡®çš„ç»“æœå‘¢ï¼Ÿå¦‚æœåªçœ‹ç»“æœçš„è¯ï¼Œè¿™ä¸ªç®—æ³•æ˜¯æ­£ç¡®çš„ï¼Œè€Œä¸”è¿™ä¸ªç®—æ³•ä¹Ÿæœ‰ä¸€ä¸ªåå­—ï¼Œå«åšâ€œSimple Nested-Loop Joinâ€ã€‚</p><p>ä½†æ˜¯ï¼Œè¿™æ ·ç®—æ¥ï¼Œè¿™ä¸ª SQL è¯·æ±‚å°±è¦æ‰«æè¡¨ t2 å¤šè¾¾ 100 æ¬¡ï¼Œæ€»å…±æ‰«æ 100*1000=10 ä¸‡è¡Œã€‚</p><p>è¿™è¿˜åªæ˜¯ä¸¤ä¸ªå°è¡¨ï¼Œå¦‚æœ t1 å’Œ t2 éƒ½æ˜¯ 10 ä¸‡è¡Œçš„è¡¨ï¼ˆå½“ç„¶äº†ï¼Œè¿™ä¹Ÿè¿˜æ˜¯å±äºå°è¡¨çš„èŒƒå›´ï¼‰ï¼Œå°±è¦æ‰«æ 100 äº¿è¡Œï¼Œè¿™ä¸ªç®—æ³•çœ‹ä¸Šå»å¤ªâ€œç¬¨é‡â€äº†ã€‚</p><p>å½“ç„¶ï¼ŒMySQL ä¹Ÿæ²¡æœ‰ä½¿ç”¨è¿™ä¸ª Simple Nested-Loop Join ç®—æ³•ï¼Œè€Œæ˜¯ä½¿ç”¨äº†å¦ä¸€ä¸ªå«ä½œâ€œBlock Nested-Loop Joinâ€çš„ç®—æ³•ï¼Œç®€ç§° BNLã€‚</p><h4 id="block-nested-loop-join" tabindex="-1"><a class="header-anchor" href="#block-nested-loop-join" aria-hidden="true">#</a> Block Nested-Loop Join</h4><p>è¿™æ—¶å€™ï¼Œè¢«é©±åŠ¨è¡¨ä¸Šæ²¡æœ‰å¯ç”¨çš„ç´¢å¼•ï¼Œç®—æ³•çš„æµç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><ol><li>æŠŠè¡¨ t1 çš„æ•°æ®è¯»å…¥çº¿ç¨‹å†…å­˜ join_buffer ä¸­ï¼Œç”±äºæˆ‘ä»¬è¿™ä¸ªè¯­å¥ä¸­å†™çš„æ˜¯ select *ï¼Œå› æ­¤æ˜¯æŠŠæ•´ä¸ªè¡¨ t1 æ”¾å…¥äº†å†…å­˜ï¼›</li><li>æ‰«æè¡¨ t2ï¼ŒæŠŠè¡¨ t2 ä¸­çš„æ¯ä¸€è¡Œå–å‡ºæ¥ï¼Œè·Ÿ join_buffer ä¸­çš„æ•°æ®åšå¯¹æ¯”ï¼Œæ»¡è¶³ join æ¡ä»¶çš„ï¼Œä½œä¸ºç»“æœé›†çš„ä¸€éƒ¨åˆ†è¿”å›ã€‚</li></ol><p>è¿™ä¸ªè¿‡ç¨‹çš„æµç¨‹å›¾å¦‚ä¸‹ï¼š</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/15ae4f17c46bf71e8349a8f2ef70d573-1584367400733.jpg" alt="img"></p><p>å›¾ 3 Block Nested-Loop Join ç®—æ³•çš„æ‰§è¡Œæµç¨‹</p><p>å¯¹åº”åœ°ï¼Œè¿™æ¡ SQL è¯­å¥çš„ explain ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/676921fa0883e9463dd34fb2bc5e87e1-1584367400742.png" alt="img"></p><p>å›¾ 4 ä¸ä½¿ç”¨ç´¢å¼•å­—æ®µ join çš„ explain ç»“æœ</p><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œå¯¹è¡¨ t1 å’Œ t2 éƒ½åšäº†ä¸€æ¬¡å…¨è¡¨æ‰«æï¼Œå› æ­¤æ€»çš„æ‰«æè¡Œæ•°æ˜¯ 1100ã€‚ç”±äº join_buffer æ˜¯ä»¥æ— åºæ•°ç»„çš„æ–¹å¼ç»„ç»‡çš„ï¼Œå› æ­¤å¯¹è¡¨ t2 ä¸­çš„æ¯ä¸€è¡Œï¼Œéƒ½è¦åš 100 æ¬¡åˆ¤æ–­ï¼Œæ€»å…±éœ€è¦åœ¨å†…å­˜ä¸­åšçš„åˆ¤æ–­æ¬¡æ•°æ˜¯ï¼š100*1000=10 ä¸‡æ¬¡ã€‚</p><p>å‰é¢æˆ‘ä»¬è¯´è¿‡ï¼Œå¦‚æœä½¿ç”¨ Simple Nested-Loop Join ç®—æ³•è¿›è¡ŒæŸ¥è¯¢ï¼Œæ‰«æè¡Œæ•°ä¹Ÿæ˜¯ 10 ä¸‡è¡Œã€‚å› æ­¤ï¼Œä»æ—¶é—´å¤æ‚åº¦ä¸Šæ¥è¯´ï¼Œè¿™ä¸¤ä¸ªç®—æ³•æ˜¯ä¸€æ ·çš„ã€‚ä½†æ˜¯ï¼ŒBlock Nested-Loop Join ç®—æ³•çš„è¿™ 10 ä¸‡æ¬¡åˆ¤æ–­æ˜¯å†…å­˜æ“ä½œï¼Œé€Ÿåº¦ä¸Šä¼šå¿«å¾ˆå¤šï¼Œæ€§èƒ½ä¹Ÿæ›´å¥½ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåº”è¯¥é€‰æ‹©å“ªä¸ªè¡¨åšé©±åŠ¨è¡¨ã€‚</p><p>å‡è®¾å°è¡¨çš„è¡Œæ•°æ˜¯ Nï¼Œå¤§è¡¨çš„è¡Œæ•°æ˜¯ Mï¼Œé‚£ä¹ˆåœ¨è¿™ä¸ªç®—æ³•é‡Œï¼š</p><ol><li>ä¸¤ä¸ªè¡¨éƒ½åšä¸€æ¬¡å…¨è¡¨æ‰«æï¼Œæ‰€ä»¥æ€»çš„æ‰«æè¡Œæ•°æ˜¯ M+Nï¼›</li><li>å†…å­˜ä¸­çš„åˆ¤æ–­æ¬¡æ•°æ˜¯ M*Nã€‚</li></ol><p>å¯ä»¥çœ‹åˆ°ï¼Œè°ƒæ¢è¿™ä¸¤ä¸ªç®—å¼ä¸­çš„ M å’Œ N æ²¡å·®åˆ«ï¼Œå› æ­¤è¿™æ—¶å€™é€‰æ‹©å¤§è¡¨è¿˜æ˜¯å°è¡¨åšé©±åŠ¨è¡¨ï¼Œæ‰§è¡Œè€—æ—¶æ˜¯ä¸€æ ·çš„ã€‚</p><p>ç„¶åï¼Œä½ å¯èƒ½é©¬ä¸Šå°±ä¼šé—®äº†ï¼Œè¿™ä¸ªä¾‹å­é‡Œè¡¨ t1 æ‰ 100 è¡Œï¼Œè¦æ˜¯è¡¨ t1 æ˜¯ä¸€ä¸ªå¤§è¡¨ï¼Œjoin_buffer æ”¾ä¸ä¸‹æ€ä¹ˆåŠå‘¢ï¼Ÿ</p><p>join_buffer çš„å¤§å°æ˜¯ç”±å‚æ•° join_buffer_size è®¾å®šçš„ï¼Œé»˜è®¤å€¼æ˜¯ 256kã€‚**å¦‚æœæ”¾ä¸ä¸‹è¡¨ t1 çš„æ‰€æœ‰æ•°æ®è¯ï¼Œç­–ç•¥å¾ˆç®€å•ï¼Œå°±æ˜¯åˆ†æ®µæ”¾ã€‚**æˆ‘æŠŠ join_buffer_size æ”¹æˆ 1200ï¼Œå†æ‰§è¡Œï¼š</p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t1 straight_join t2 <span class="token keyword">on</span> <span class="token punctuation">(</span>t1<span class="token punctuation">.</span>a<span class="token operator">=</span>t2<span class="token punctuation">.</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æ‰§è¡Œè¿‡ç¨‹å°±å˜æˆäº†ï¼š</p><ol><li>æ‰«æè¡¨ t1ï¼Œé¡ºåºè¯»å–æ•°æ®è¡Œæ”¾å…¥ join_buffer ä¸­ï¼Œæ”¾å®Œç¬¬ 88 è¡Œ join_buffer æ»¡äº†ï¼Œç»§ç»­ç¬¬ 2 æ­¥ï¼›</li><li>æ‰«æè¡¨ t2ï¼ŒæŠŠ t2 ä¸­çš„æ¯ä¸€è¡Œå–å‡ºæ¥ï¼Œè·Ÿ join_buffer ä¸­çš„æ•°æ®åšå¯¹æ¯”ï¼Œæ»¡è¶³ join æ¡ä»¶çš„ï¼Œä½œä¸ºç»“æœé›†çš„ä¸€éƒ¨åˆ†è¿”å›ï¼›</li><li>æ¸…ç©º join_bufferï¼›</li><li>ç»§ç»­æ‰«æè¡¨ t1ï¼Œé¡ºåºè¯»å–æœ€åçš„ 12 è¡Œæ•°æ®æ”¾å…¥ join_buffer ä¸­ï¼Œç»§ç»­æ‰§è¡Œç¬¬ 2 æ­¥ã€‚</li></ol><p>æ‰§è¡Œæµç¨‹å›¾ä¹Ÿå°±å˜æˆè¿™æ ·ï¼š</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/695adf810fcdb07e393467bcfd2f6ac4-1584367400746.jpg" alt="img"></p><p>å›¾ 5 Block Nested-Loop Join -- ä¸¤æ®µ</p><p>å›¾ä¸­çš„æ­¥éª¤ 4 å’Œ 5ï¼Œè¡¨ç¤ºæ¸…ç©º join_buffer å†å¤ç”¨ã€‚</p><p>è¿™ä¸ªæµç¨‹æ‰ä½“ç°å‡ºäº†è¿™ä¸ªç®—æ³•åå­—ä¸­â€œBlockâ€çš„ç”±æ¥ï¼Œè¡¨ç¤ºâ€œåˆ†å—å» joinâ€ã€‚</p><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™æ—¶å€™ç”±äºè¡¨ t1 è¢«åˆ†æˆäº†ä¸¤æ¬¡æ”¾å…¥ join_buffer ä¸­ï¼Œå¯¼è‡´è¡¨ t2 ä¼šè¢«æ‰«æä¸¤æ¬¡ã€‚è™½ç„¶åˆ†æˆä¸¤æ¬¡æ”¾å…¥ join_bufferï¼Œä½†æ˜¯åˆ¤æ–­ç­‰å€¼æ¡ä»¶çš„æ¬¡æ•°è¿˜æ˜¯ä¸å˜çš„ï¼Œä¾ç„¶æ˜¯ (88+12)*1000=10 ä¸‡æ¬¡ã€‚</p><p>æˆ‘ä»¬å†æ¥çœ‹ä¸‹ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹é©±åŠ¨è¡¨çš„é€‰æ‹©é—®é¢˜ã€‚</p><p>å‡è®¾ï¼Œé©±åŠ¨è¡¨çš„æ•°æ®è¡Œæ•°æ˜¯ Nï¼Œéœ€è¦åˆ† K æ®µæ‰èƒ½å®Œæˆç®—æ³•æµç¨‹ï¼Œè¢«é©±åŠ¨è¡¨çš„æ•°æ®è¡Œæ•°æ˜¯ Mã€‚</p><p>æ³¨æ„ï¼Œè¿™é‡Œçš„ K ä¸æ˜¯å¸¸æ•°ï¼ŒN è¶Šå¤§ K å°±ä¼šè¶Šå¤§ï¼Œå› æ­¤æŠŠ K è¡¨ç¤ºä¸ºÎ»*Nï¼Œæ˜¾ç„¶Î»çš„å–å€¼èŒƒå›´æ˜¯ (0,1)ã€‚</p><p>æ‰€ä»¥ï¼Œåœ¨è¿™ä¸ªç®—æ³•çš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼š</p><ol><li>æ‰«æè¡Œæ•°æ˜¯ N+Î»<em>N</em>Mï¼›</li><li>å†…å­˜åˆ¤æ–­ N*M æ¬¡ã€‚</li></ol><p>æ˜¾ç„¶ï¼Œå†…å­˜åˆ¤æ–­æ¬¡æ•°æ˜¯ä¸å—é€‰æ‹©å“ªä¸ªè¡¨ä½œä¸ºé©±åŠ¨è¡¨å½±å“çš„ã€‚è€Œè€ƒè™‘åˆ°æ‰«æè¡Œæ•°ï¼Œåœ¨ M å’Œ N å¤§å°ç¡®å®šçš„æƒ…å†µä¸‹ï¼ŒN å°ä¸€äº›ï¼Œæ•´ä¸ªç®—å¼çš„ç»“æœä¼šæ›´å°ã€‚</p><p>æ‰€ä»¥ç»“è®ºæ˜¯ï¼Œåº”è¯¥è®©å°è¡¨å½“é©±åŠ¨è¡¨ã€‚</p><p>å½“ç„¶ï¼Œä½ ä¼šå‘ç°ï¼Œåœ¨ N+Î»<em>N</em>M è¿™ä¸ªå¼å­é‡Œï¼ŒÎ»æ‰æ˜¯å½±å“æ‰«æè¡Œæ•°çš„å…³é”®å› ç´ ï¼Œè¿™ä¸ªå€¼è¶Šå°è¶Šå¥½ã€‚</p><p>åˆšåˆšæˆ‘ä»¬è¯´äº† N è¶Šå¤§ï¼Œåˆ†æ®µæ•° K è¶Šå¤§ã€‚é‚£ä¹ˆï¼ŒN å›ºå®šçš„æ—¶å€™ï¼Œä»€ä¹ˆå‚æ•°ä¼šå½±å“ K çš„å¤§å°å‘¢ï¼Ÿï¼ˆä¹Ÿå°±æ˜¯Î»çš„å¤§å°ï¼‰ç­”æ¡ˆæ˜¯ join_buffer_sizeã€‚join_buffer_size è¶Šå¤§ï¼Œä¸€æ¬¡å¯ä»¥æ”¾å…¥çš„è¡Œè¶Šå¤šï¼Œåˆ†æˆçš„æ®µæ•°ä¹Ÿå°±è¶Šå°‘ï¼Œå¯¹è¢«é©±åŠ¨è¡¨çš„å…¨è¡¨æ‰«ææ¬¡æ•°å°±è¶Šå°‘ã€‚</p><p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆï¼Œä½ å¯èƒ½ä¼šçœ‹åˆ°ä¸€äº›å»ºè®®å‘Šè¯‰ä½ ï¼Œå¦‚æœä½ çš„ join è¯­å¥å¾ˆæ…¢ï¼Œå°±æŠŠ join_buffer_size æ”¹å¤§ã€‚</p><p>ç†è§£äº† MySQL æ‰§è¡Œ join çš„ä¸¤ç§ç®—æ³•ï¼Œç°åœ¨æˆ‘ä»¬å†æ¥è¯•ç€<strong>å›ç­”æ–‡ç« å¼€å¤´çš„ä¸¤ä¸ªé—®é¢˜</strong>ã€‚</p><p>ç¬¬ä¸€ä¸ªé—®é¢˜ï¼šèƒ½ä¸èƒ½ä½¿ç”¨ join è¯­å¥ï¼Ÿ</p><ol><li>å¦‚æœå¯ä»¥ä½¿ç”¨ Index Nested-Loop Join ç®—æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´å¯ä»¥ç”¨ä¸Šè¢«é©±åŠ¨è¡¨ä¸Šçš„ç´¢å¼•ï¼Œå…¶å®æ˜¯æ²¡é—®é¢˜çš„ï¼›</li><li>å¦‚æœä½¿ç”¨ Block Nested-Loop Join ç®—æ³•ï¼Œæ‰«æè¡Œæ•°å°±ä¼šè¿‡å¤šã€‚å°¤å…¶æ˜¯åœ¨å¤§è¡¨ä¸Šçš„ join æ“ä½œï¼Œè¿™æ ·å¯èƒ½è¦æ‰«æè¢«é©±åŠ¨è¡¨å¾ˆå¤šæ¬¡ï¼Œä¼šå ç”¨å¤§é‡çš„ç³»ç»Ÿèµ„æºã€‚æ‰€ä»¥è¿™ç§ join å°½é‡ä¸è¦ç”¨ã€‚</li></ol><p>æ‰€ä»¥ä½ åœ¨åˆ¤æ–­è¦ä¸è¦ä½¿ç”¨ join è¯­å¥æ—¶ï¼Œå°±æ˜¯çœ‹ explain ç»“æœé‡Œé¢ï¼ŒExtra å­—æ®µé‡Œé¢æœ‰æ²¡æœ‰å‡ºç°â€œBlock Nested Loopâ€å­—æ ·ã€‚</p><p>ç¬¬äºŒä¸ªé—®é¢˜æ˜¯ï¼šå¦‚æœè¦ä½¿ç”¨ joinï¼Œåº”è¯¥é€‰æ‹©å¤§è¡¨åšé©±åŠ¨è¡¨è¿˜æ˜¯é€‰æ‹©å°è¡¨åšé©±åŠ¨è¡¨ï¼Ÿ</p><ol><li>å¦‚æœæ˜¯ Index Nested-Loop Join ç®—æ³•ï¼Œåº”è¯¥é€‰æ‹©å°è¡¨åšé©±åŠ¨è¡¨ï¼›</li><li>å¦‚æœæ˜¯ Block Nested-Loop Join ç®—æ³•ï¼š <ul><li>åœ¨ join_buffer_size è¶³å¤Ÿå¤§çš„æ—¶å€™ï¼Œæ˜¯ä¸€æ ·çš„ï¼›</li><li>åœ¨ join_buffer_size ä¸å¤Ÿå¤§çš„æ—¶å€™ï¼ˆè¿™ç§æƒ…å†µæ›´å¸¸è§ï¼‰ï¼Œåº”è¯¥é€‰æ‹©å°è¡¨åšé©±åŠ¨è¡¨ã€‚</li></ul></li></ol><p>æ‰€ä»¥ï¼Œè¿™ä¸ªé—®é¢˜çš„ç»“è®ºå°±æ˜¯ï¼Œæ€»æ˜¯åº”è¯¥ä½¿ç”¨å°è¡¨åšé©±åŠ¨è¡¨ã€‚</p><p>å½“ç„¶äº†ï¼Œè¿™é‡Œæˆ‘éœ€è¦è¯´æ˜ä¸‹ï¼Œ<strong>ä»€ä¹ˆå«ä½œâ€œå°è¡¨â€</strong>ã€‚</p><p>æˆ‘ä»¬å‰é¢çš„ä¾‹å­æ˜¯æ²¡æœ‰åŠ æ¡ä»¶çš„ã€‚å¦‚æœæˆ‘åœ¨è¯­å¥çš„ where æ¡ä»¶åŠ ä¸Š t2.id&lt;=50 è¿™ä¸ªé™å®šæ¡ä»¶ï¼Œå†æ¥çœ‹ä¸‹è¿™ä¸¤æ¡è¯­å¥ï¼š</p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t1 straight_join t2 <span class="token keyword">on</span> <span class="token punctuation">(</span>t1<span class="token punctuation">.</span>b<span class="token operator">=</span>t2<span class="token punctuation">.</span>b<span class="token punctuation">)</span> <span class="token keyword">where</span> <span class="token class-name">t2</span><span class="token punctuation">.</span>id<span class="token operator">&lt;=</span><span class="token number">50</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t2 straight_join t1 <span class="token keyword">on</span> <span class="token punctuation">(</span>t1<span class="token punctuation">.</span>b<span class="token operator">=</span>t2<span class="token punctuation">.</span>b<span class="token punctuation">)</span> <span class="token keyword">where</span> <span class="token class-name">t2</span><span class="token punctuation">.</span>id<span class="token operator">&lt;=</span><span class="token number">50</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>æ³¨æ„ï¼Œä¸ºäº†è®©ä¸¤æ¡è¯­å¥çš„è¢«é©±åŠ¨è¡¨éƒ½ç”¨ä¸ä¸Šç´¢å¼•ï¼Œæ‰€ä»¥ join å­—æ®µéƒ½ä½¿ç”¨äº†æ²¡æœ‰ç´¢å¼•çš„å­—æ®µ bã€‚</p><p>ä½†å¦‚æœæ˜¯ç”¨ç¬¬äºŒä¸ªè¯­å¥çš„è¯ï¼Œjoin_buffer åªéœ€è¦æ”¾å…¥ t2 çš„å‰ 50 è¡Œï¼Œæ˜¾ç„¶æ˜¯æ›´å¥½çš„ã€‚æ‰€ä»¥è¿™é‡Œï¼Œâ€œt2 çš„å‰ 50 è¡Œâ€æ˜¯é‚£ä¸ªç›¸å¯¹å°çš„è¡¨ï¼Œä¹Ÿå°±æ˜¯â€œå°è¡¨â€ã€‚</p><p>æˆ‘ä»¬å†æ¥çœ‹å¦å¤–ä¸€ç»„ä¾‹å­ï¼š</p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">select</span> t1<span class="token punctuation">.</span>b<span class="token punctuation">,</span>t2<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">from</span>  t1  straight_join t2 <span class="token keyword">on</span> <span class="token punctuation">(</span>t1<span class="token punctuation">.</span>b<span class="token operator">=</span>t2<span class="token punctuation">.</span>b<span class="token punctuation">)</span> <span class="token keyword">where</span> <span class="token class-name">t2</span><span class="token punctuation">.</span>id<span class="token operator">&lt;=</span><span class="token number">100</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> t1<span class="token punctuation">.</span>b<span class="token punctuation">,</span>t2<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">from</span>  t2  straight_join t1 <span class="token keyword">on</span> <span class="token punctuation">(</span>t1<span class="token punctuation">.</span>b<span class="token operator">=</span>t2<span class="token punctuation">.</span>b<span class="token punctuation">)</span> <span class="token keyword">where</span> <span class="token class-name">t2</span><span class="token punctuation">.</span>id<span class="token operator">&lt;=</span><span class="token number">100</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªä¾‹å­é‡Œï¼Œè¡¨ t1 å’Œ t2 éƒ½æ˜¯åªæœ‰ 100 è¡Œå‚åŠ  joinã€‚ä½†æ˜¯ï¼Œè¿™ä¸¤æ¡è¯­å¥æ¯æ¬¡æŸ¥è¯¢æ”¾å…¥ join_buffer ä¸­çš„æ•°æ®æ˜¯ä¸ä¸€æ ·çš„ï¼š</p><ul><li>è¡¨ t1 åªæŸ¥å­—æ®µ bï¼Œå› æ­¤å¦‚æœæŠŠ t1 æ”¾åˆ° join_buffer ä¸­ï¼Œåˆ™ join_buffer ä¸­åªéœ€è¦æ”¾å…¥ b çš„å€¼ï¼›</li><li>è¡¨ t2 éœ€è¦æŸ¥æ‰€æœ‰çš„å­—æ®µï¼Œå› æ­¤å¦‚æœæŠŠè¡¨ t2 æ”¾åˆ° join_buffer ä¸­çš„è¯ï¼Œå°±éœ€è¦æ”¾å…¥ä¸‰ä¸ªå­—æ®µ idã€a å’Œ bã€‚</li></ul><p>è¿™é‡Œï¼Œæˆ‘ä»¬åº”è¯¥é€‰æ‹©è¡¨ t1 ä½œä¸ºé©±åŠ¨è¡¨ã€‚ä¹Ÿå°±æ˜¯è¯´åœ¨è¿™ä¸ªä¾‹å­é‡Œï¼Œâ€œåªéœ€è¦ä¸€åˆ—å‚ä¸ join çš„è¡¨ t1â€æ˜¯é‚£ä¸ªç›¸å¯¹å°çš„è¡¨ã€‚</p><p>æ‰€ä»¥ï¼Œæ›´å‡†ç¡®åœ°è¯´ï¼Œ<strong>åœ¨å†³å®šå“ªä¸ªè¡¨åšé©±åŠ¨è¡¨çš„æ—¶å€™ï¼Œåº”è¯¥æ˜¯ä¸¤ä¸ªè¡¨æŒ‰ç…§å„è‡ªçš„æ¡ä»¶è¿‡æ»¤ï¼Œè¿‡æ»¤å®Œæˆä¹‹åï¼Œè®¡ç®—å‚ä¸ join çš„å„ä¸ªå­—æ®µçš„æ€»æ•°æ®é‡ï¼Œæ•°æ®é‡å°çš„é‚£ä¸ªè¡¨ï¼Œå°±æ˜¯â€œå°è¡¨â€ï¼Œåº”è¯¥ä½œä¸ºé©±åŠ¨è¡¨ã€‚</strong></p><h4 id="å°ç»“-21" tabindex="-1"><a class="header-anchor" href="#å°ç»“-21" aria-hidden="true">#</a> å°ç»“</h4><p>ä»Šå¤©ï¼Œæˆ‘å’Œä½ ä»‹ç»äº† MySQL æ‰§è¡Œ join è¯­å¥çš„ä¸¤ç§å¯èƒ½ç®—æ³•ï¼Œè¿™ä¸¤ç§ç®—æ³•æ˜¯ç”±èƒ½å¦ä½¿ç”¨è¢«é©±åŠ¨è¡¨çš„ç´¢å¼•å†³å®šçš„ã€‚è€Œèƒ½å¦ç”¨ä¸Šè¢«é©±åŠ¨è¡¨çš„ç´¢å¼•ï¼Œå¯¹ join è¯­å¥çš„æ€§èƒ½å½±å“å¾ˆå¤§ã€‚</p><p>é€šè¿‡å¯¹ Index Nested-Loop Join å’Œ Block Nested-Loop Join ä¸¤ä¸ªç®—æ³•æ‰§è¡Œè¿‡ç¨‹çš„åˆ†æï¼Œæˆ‘ä»¬ä¹Ÿå¾—åˆ°äº†æ–‡ç« å¼€å¤´ä¸¤ä¸ªé—®é¢˜çš„ç­”æ¡ˆï¼š</p><ol><li>å¦‚æœå¯ä»¥ä½¿ç”¨è¢«é©±åŠ¨è¡¨çš„ç´¢å¼•ï¼Œjoin è¯­å¥è¿˜æ˜¯æœ‰å…¶ä¼˜åŠ¿çš„ï¼›</li><li>ä¸èƒ½ä½¿ç”¨è¢«é©±åŠ¨è¡¨çš„ç´¢å¼•ï¼Œåªèƒ½ä½¿ç”¨ Block Nested-Loop Join ç®—æ³•ï¼Œè¿™æ ·çš„è¯­å¥å°±å°½é‡ä¸è¦ä½¿ç”¨ï¼›</li><li>åœ¨ä½¿ç”¨ join çš„æ—¶å€™ï¼Œåº”è¯¥è®©å°è¡¨åšé©±åŠ¨è¡¨ã€‚</li></ol><p>æœ€åï¼Œåˆåˆ°äº†ä»Šå¤©çš„é—®é¢˜æ—¶é—´ã€‚</p><p>æˆ‘ä»¬åœ¨ä¸Šæ–‡è¯´åˆ°ï¼Œä½¿ç”¨ Block Nested-Loop Join ç®—æ³•ï¼Œå¯èƒ½ä¼šå› ä¸º join_buffer ä¸å¤Ÿå¤§ï¼Œéœ€è¦å¯¹è¢«é©±åŠ¨è¡¨åšå¤šæ¬¡å…¨è¡¨æ‰«æã€‚</p><p>æˆ‘çš„é—®é¢˜æ˜¯ï¼Œå¦‚æœè¢«é©±åŠ¨è¡¨æ˜¯ä¸€ä¸ªå¤§è¡¨ï¼Œå¹¶ä¸”æ˜¯ä¸€ä¸ªå†·æ•°æ®è¡¨ï¼Œé™¤äº†æŸ¥è¯¢è¿‡ç¨‹ä¸­å¯èƒ½ä¼šå¯¼è‡´ IO å‹åŠ›å¤§ä»¥å¤–ï¼Œä½ è§‰å¾—å¯¹è¿™ä¸ª MySQL æœåŠ¡è¿˜æœ‰ä»€ä¹ˆæ›´ä¸¥é‡çš„å½±å“å—ï¼Ÿï¼ˆè¿™ä¸ªé—®é¢˜éœ€è¦ç»“åˆä¸Šä¸€ç¯‡æ–‡ç« çš„çŸ¥è¯†ç‚¹ï¼‰</p><p>ä½ å¯ä»¥æŠŠä½ çš„ç»“è®ºå’Œåˆ†æå†™åœ¨ç•™è¨€åŒºï¼Œæˆ‘ä¼šåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« çš„æœ«å°¾å’Œä½ è®¨è®ºè¿™ä¸ªé—®é¢˜ã€‚æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚</p><h4 id="ä¸ŠæœŸé—®é¢˜æ—¶é—´-18" tabindex="-1"><a class="header-anchor" href="#ä¸ŠæœŸé—®é¢˜æ—¶é—´-18" aria-hidden="true">#</a> ä¸ŠæœŸé—®é¢˜æ—¶é—´</h4><p>æˆ‘åœ¨ä¸Šä¸€ç¯‡æ–‡ç« æœ€åç•™ä¸‹çš„é—®é¢˜æ˜¯ï¼Œå¦‚æœå®¢æˆ·ç«¯ç”±äºå‹åŠ›è¿‡å¤§ï¼Œè¿Ÿè¿Ÿä¸èƒ½æ¥æ”¶æ•°æ®ï¼Œä¼šå¯¹æœåŠ¡ç«¯é€ æˆä»€ä¹ˆä¸¥é‡çš„å½±å“ã€‚</p><p>è¿™ä¸ªé—®é¢˜çš„æ ¸å¿ƒæ˜¯ï¼Œé€ æˆäº†â€œé•¿äº‹åŠ¡â€ã€‚</p><p>è‡³äºé•¿äº‹åŠ¡çš„å½±å“ï¼Œå°±è¦ç»“åˆæˆ‘ä»¬å‰é¢æ–‡ç« ä¸­æåˆ°çš„é”ã€MVCC çš„çŸ¥è¯†ç‚¹äº†ã€‚</p><ul><li>å¦‚æœå‰é¢çš„è¯­å¥æœ‰æ›´æ–°ï¼Œæ„å‘³ç€å®ƒä»¬åœ¨å ç”¨ç€è¡Œé”ï¼Œä¼šå¯¼è‡´åˆ«çš„è¯­å¥æ›´æ–°è¢«é”ä½ï¼›</li><li>å½“ç„¶è¯»çš„äº‹åŠ¡ä¹Ÿæœ‰é—®é¢˜ï¼Œå°±æ˜¯ä¼šå¯¼è‡´ undo log ä¸èƒ½è¢«å›æ”¶ï¼Œå¯¼è‡´å›æ»šæ®µç©ºé—´è†¨èƒ€ã€‚</li></ul><p>è¯„è®ºåŒºç•™è¨€ç‚¹èµæ¿ï¼š</p><blockquote><p>@è€æ¨åŒå¿— æåˆ°äº†æ›´æ–°ä¹‹é—´ä¼šäº’ç›¸ç­‰é”çš„é—®é¢˜ã€‚åŒä¸€ä¸ªäº‹åŠ¡ï¼Œæ›´æ–°ä¹‹åè¦å°½å¿«æäº¤ï¼Œä¸è¦åšæ²¡å¿…è¦çš„æŸ¥è¯¢ï¼Œå°¤å…¶æ˜¯ä¸è¦æ‰§è¡Œéœ€è¦è¿”å›å¤§é‡æ•°æ®çš„æŸ¥è¯¢ï¼› @é•¿æ° åŒå­¦æåˆ°äº† undo è¡¨ç©ºé—´å˜å¤§ï¼Œdb æœåŠ¡å µå¡ï¼ŒæœåŠ¡ç«¯ç£ç›˜ç©ºé—´ä¸è¶³çš„ä¾‹å­ã€‚</p></blockquote><h3 id="_35-joinè¯­å¥æ€ä¹ˆä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#_35-joinè¯­å¥æ€ä¹ˆä¼˜åŒ–" aria-hidden="true">#</a> 35 joinè¯­å¥æ€ä¹ˆä¼˜åŒ–ï¼Ÿ</h3><p>åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å’Œä½ ä»‹ç»äº† join è¯­å¥çš„ä¸¤ç§ç®—æ³•ï¼Œåˆ†åˆ«æ˜¯ Index Nested-Loop Join(NLJ) å’Œ Block Nested-Loop Join(BNL)ã€‚</p><p>æˆ‘ä»¬å‘ç°åœ¨ä½¿ç”¨ NLJ ç®—æ³•çš„æ—¶å€™ï¼Œå…¶å®æ•ˆæœè¿˜æ˜¯ä¸é”™çš„ï¼Œæ¯”é€šè¿‡åº”ç”¨å±‚æ‹†åˆ†æˆå¤šä¸ªè¯­å¥ç„¶åå†æ‹¼æ¥æŸ¥è¯¢ç»“æœæ›´æ–¹ä¾¿ï¼Œè€Œä¸”æ€§èƒ½ä¹Ÿä¸ä¼šå·®ã€‚</p><p>ä½†æ˜¯ï¼ŒBNL ç®—æ³•åœ¨å¤§è¡¨ join çš„æ—¶å€™æ€§èƒ½å°±å·®å¤šäº†ï¼Œæ¯”è¾ƒæ¬¡æ•°ç­‰äºä¸¤ä¸ªè¡¨å‚ä¸ join çš„è¡Œæ•°çš„ä¹˜ç§¯ï¼Œå¾ˆæ¶ˆè€— CPU èµ„æºã€‚</p><p>å½“ç„¶äº†ï¼Œè¿™ä¸¤ä¸ªç®—æ³•éƒ½è¿˜æœ‰ç»§ç»­ä¼˜åŒ–çš„ç©ºé—´ï¼Œæˆ‘ä»¬ä»Šå¤©å°±æ¥èŠèŠè¿™ä¸ªè¯é¢˜ã€‚</p><p>ä¸ºäº†ä¾¿äºåˆ†æï¼Œæˆ‘è¿˜æ˜¯åˆ›å»ºä¸¤ä¸ªè¡¨ t1ã€t2 æ¥å’Œä½ å±•å¼€ä»Šå¤©çš„é—®é¢˜ã€‚</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> t1<span class="token punctuation">(</span>id <span class="token keyword">int</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span> a <span class="token keyword">int</span><span class="token punctuation">,</span> b <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">index</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> t2 <span class="token operator">like</span> t1<span class="token punctuation">;</span>
<span class="token keyword">drop</span> <span class="token keyword">procedure</span> idata<span class="token punctuation">;</span>
<span class="token keyword">delimiter</span> <span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">create</span> <span class="token keyword">procedure</span> idata<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">begin</span>
  <span class="token keyword">declare</span> i <span class="token keyword">int</span><span class="token punctuation">;</span>
  <span class="token keyword">set</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span><span class="token punctuation">(</span>i<span class="token operator">&lt;=</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token keyword">do</span>
    <span class="token keyword">insert</span> <span class="token keyword">into</span> t1 <span class="token keyword">values</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1001</span><span class="token operator">-</span>i<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">set</span> i<span class="token operator">=</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">end</span> <span class="token keyword">while</span><span class="token punctuation">;</span>
  
  <span class="token keyword">set</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span><span class="token punctuation">(</span>i<span class="token operator">&lt;=</span><span class="token number">1000000</span><span class="token punctuation">)</span><span class="token keyword">do</span>
    <span class="token keyword">insert</span> <span class="token keyword">into</span> t2 <span class="token keyword">values</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> i<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">set</span> i<span class="token operator">=</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">end</span> <span class="token keyword">while</span><span class="token punctuation">;</span> 
<span class="token keyword">end</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">delimiter</span> <span class="token punctuation">;</span>
<span class="token keyword">call</span> idata<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸ºäº†ä¾¿äºåé¢é‡åŒ–è¯´æ˜ï¼Œæˆ‘åœ¨è¡¨ t1 é‡Œï¼Œæ’å…¥äº† 1000 è¡Œæ•°æ®ï¼Œæ¯ä¸€è¡Œçš„ a=1001-id çš„å€¼ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¡¨ t1 ä¸­å­—æ®µ a æ˜¯é€†åºçš„ã€‚åŒæ—¶ï¼Œæˆ‘åœ¨è¡¨ t2 ä¸­æ’å…¥äº† 100 ä¸‡è¡Œæ•°æ®ã€‚</p><h4 id="multi-range-read-ä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#multi-range-read-ä¼˜åŒ–" aria-hidden="true">#</a> Multi-Range Read ä¼˜åŒ–</h4><p>åœ¨ä»‹ç» join è¯­å¥çš„ä¼˜åŒ–æ–¹æ¡ˆä¹‹å‰ï¼Œæˆ‘éœ€è¦å…ˆå’Œä½ ä»‹ç»ä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼Œå³ï¼šMulti-Range Read ä¼˜åŒ– (MRR)ã€‚è¿™ä¸ªä¼˜åŒ–çš„ä¸»è¦ç›®çš„æ˜¯å°½é‡ä½¿ç”¨é¡ºåºè¯»ç›˜ã€‚</p><p>åœ¨[ç¬¬ 4 ç¯‡æ–‡ç« ]ä¸­ï¼Œæˆ‘å’Œä½ ä»‹ç» InnoDB çš„ç´¢å¼•ç»“æ„æ—¶ï¼Œæåˆ°äº†â€œå›è¡¨â€çš„æ¦‚å¿µã€‚æˆ‘ä»¬å…ˆæ¥å›é¡¾ä¸€ä¸‹è¿™ä¸ªæ¦‚å¿µã€‚å›è¡¨æ˜¯æŒ‡ï¼ŒInnoDB åœ¨æ™®é€šç´¢å¼• a ä¸ŠæŸ¥åˆ°ä¸»é”® id çš„å€¼åï¼Œå†æ ¹æ®ä¸€ä¸ªä¸ªä¸»é”® id çš„å€¼åˆ°ä¸»é”®ç´¢å¼•ä¸Šå»æŸ¥æ•´è¡Œæ•°æ®çš„è¿‡ç¨‹ã€‚</p><p>ç„¶åï¼Œæœ‰åŒå­¦åœ¨ç•™è¨€åŒºé—®åˆ°ï¼Œå›è¡¨è¿‡ç¨‹æ˜¯ä¸€è¡Œè¡Œåœ°æŸ¥æ•°æ®ï¼Œè¿˜æ˜¯æ‰¹é‡åœ°æŸ¥æ•°æ®ï¼Ÿ</p><p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹è¿™ä¸ªé—®é¢˜ã€‚å‡è®¾ï¼Œæˆ‘æ‰§è¡Œè¿™ä¸ªè¯­å¥ï¼š</p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t1 <span class="token keyword">where</span> <span class="token class-name">a</span><span class="token operator">&gt;=</span><span class="token number">1</span> <span class="token keyword">and</span> a<span class="token operator">&lt;=</span><span class="token number">100</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ä¸»é”®ç´¢å¼•æ˜¯ä¸€æ£µ B+ æ ‘ï¼Œåœ¨è¿™æ£µæ ‘ä¸Šï¼Œæ¯æ¬¡åªèƒ½æ ¹æ®ä¸€ä¸ªä¸»é”® id æŸ¥åˆ°ä¸€è¡Œæ•°æ®ã€‚å› æ­¤ï¼Œå›è¡¨è‚¯å®šæ˜¯ä¸€è¡Œè¡Œæœç´¢ä¸»é”®ç´¢å¼•çš„ï¼ŒåŸºæœ¬æµç¨‹å¦‚å›¾ 1 æ‰€ç¤ºã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/1761edbd7734276ae0a213af3cdd3311-1584367401565.jpg" alt="img"></p><p>å›¾ 1 åŸºæœ¬å›è¡¨æµç¨‹</p><p>å¦‚æœéšç€ a çš„å€¼é€’å¢é¡ºåºæŸ¥è¯¢çš„è¯ï¼Œid çš„å€¼å°±å˜æˆéšæœºçš„ï¼Œé‚£ä¹ˆå°±ä¼šå‡ºç°éšæœºè®¿é—®ï¼Œæ€§èƒ½ç›¸å¯¹è¾ƒå·®ã€‚è™½ç„¶â€œæŒ‰è¡ŒæŸ¥â€è¿™ä¸ªæœºåˆ¶ä¸èƒ½æ”¹ï¼Œä½†æ˜¯è°ƒæ•´æŸ¥è¯¢çš„é¡ºåºï¼Œè¿˜æ˜¯èƒ½å¤ŸåŠ é€Ÿçš„ã€‚</p><p><strong>å› ä¸ºå¤§å¤šæ•°çš„æ•°æ®éƒ½æ˜¯æŒ‰ç…§ä¸»é”®é€’å¢é¡ºåºæ’å…¥å¾—åˆ°çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è®¤ä¸ºï¼Œå¦‚æœæŒ‰ç…§ä¸»é”®çš„é€’å¢é¡ºåºæŸ¥è¯¢çš„è¯ï¼Œå¯¹ç£ç›˜çš„è¯»æ¯”è¾ƒæ¥è¿‘é¡ºåºè¯»ï¼Œèƒ½å¤Ÿæå‡è¯»æ€§èƒ½ã€‚</strong></p><p>è¿™ï¼Œå°±æ˜¯ MRR ä¼˜åŒ–çš„è®¾è®¡æ€è·¯ã€‚æ­¤æ—¶ï¼Œè¯­å¥çš„æ‰§è¡Œæµç¨‹å˜æˆäº†è¿™æ ·ï¼š</p><ol><li>æ ¹æ®ç´¢å¼• aï¼Œå®šä½åˆ°æ»¡è¶³æ¡ä»¶çš„è®°å½•ï¼Œå°† id å€¼æ”¾å…¥ read_rnd_buffer ä¸­ ;</li><li>å°† read_rnd_buffer ä¸­çš„ id è¿›è¡Œé€’å¢æ’åºï¼›</li><li>æ’åºåçš„ id æ•°ç»„ï¼Œä¾æ¬¡åˆ°ä¸»é”® id ç´¢å¼•ä¸­æŸ¥è®°å½•ï¼Œå¹¶ä½œä¸ºç»“æœè¿”å›ã€‚</li></ol><p>è¿™é‡Œï¼Œread_rnd_buffer çš„å¤§å°æ˜¯ç”± read_rnd_buffer_size å‚æ•°æ§åˆ¶çš„ã€‚å¦‚æœæ­¥éª¤ 1 ä¸­ï¼Œread_rnd_buffer æ”¾æ»¡äº†ï¼Œå°±ä¼šå…ˆæ‰§è¡Œå®Œæ­¥éª¤ 2 å’Œ 3ï¼Œç„¶åæ¸…ç©º read_rnd_bufferã€‚ä¹‹åç»§ç»­æ‰¾ç´¢å¼• a çš„ä¸‹ä¸ªè®°å½•ï¼Œå¹¶ç»§ç»­å¾ªç¯ã€‚</p><p>å¦å¤–éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œå¦‚æœä½ æƒ³è¦ç¨³å®šåœ°ä½¿ç”¨ MRR ä¼˜åŒ–çš„è¯ï¼Œéœ€è¦è®¾ç½®<code>set optimizer_switch=&quot;mrr_cost_based=off&quot;</code>ã€‚ï¼ˆå®˜æ–¹æ–‡æ¡£çš„è¯´æ³•ï¼Œæ˜¯ç°åœ¨çš„ä¼˜åŒ–å™¨ç­–ç•¥ï¼Œåˆ¤æ–­æ¶ˆè€—çš„æ—¶å€™ï¼Œä¼šæ›´å€¾å‘äºä¸ä½¿ç”¨ MRRï¼ŒæŠŠ mrr_cost_based è®¾ç½®ä¸º offï¼Œå°±æ˜¯å›ºå®šä½¿ç”¨ MRR äº†ã€‚ï¼‰</p><p>ä¸‹é¢ä¸¤å¹…å›¾å°±æ˜¯ä½¿ç”¨äº† MRR ä¼˜åŒ–åçš„æ‰§è¡Œæµç¨‹å’Œ explain ç»“æœã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/d502fbaea7cac6f815c626b078da86c7-1584367401571.jpg" alt="img"></p><p>å›¾ 2 MRR æ‰§è¡Œæµç¨‹</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/a513d07ebaf1ae044d44391c89bc6432-1584367401988.png" alt="img"></p><p>å›¾ 3 MRR æ‰§è¡Œæµç¨‹çš„ explain ç»“æœ</p><p>ä»å›¾ 3 çš„ explain ç»“æœä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° Extra å­—æ®µå¤šäº† Using MRRï¼Œè¡¨ç¤ºçš„æ˜¯ç”¨ä¸Šäº† MRR ä¼˜åŒ–ã€‚è€Œä¸”ï¼Œç”±äºæˆ‘ä»¬åœ¨ read_rnd_buffer ä¸­æŒ‰ç…§ id åšäº†æ’åºï¼Œæ‰€ä»¥æœ€åå¾—åˆ°çš„ç»“æœé›†ä¹Ÿæ˜¯æŒ‰ç…§ä¸»é”® id é€’å¢é¡ºåºçš„ï¼Œä¹Ÿå°±æ˜¯ä¸å›¾ 1 ç»“æœé›†ä¸­è¡Œçš„é¡ºåºç›¸åã€‚</p><p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å°ç»“ä¸€ä¸‹ã€‚</p><p><strong>MRR èƒ½å¤Ÿæå‡æ€§èƒ½çš„æ ¸å¿ƒ</strong>åœ¨äºï¼Œè¿™æ¡æŸ¥è¯¢è¯­å¥åœ¨ç´¢å¼• a ä¸Šåšçš„æ˜¯ä¸€ä¸ªèŒƒå›´æŸ¥è¯¢ï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªå¤šå€¼æŸ¥è¯¢ï¼‰ï¼Œå¯ä»¥å¾—åˆ°è¶³å¤Ÿå¤šçš„ä¸»é”® idã€‚è¿™æ ·é€šè¿‡æ’åºä»¥åï¼Œå†å»ä¸»é”®ç´¢å¼•æŸ¥æ•°æ®ï¼Œæ‰èƒ½ä½“ç°å‡ºâ€œé¡ºåºæ€§â€çš„ä¼˜åŠ¿ã€‚</p><h4 id="batched-key-access" tabindex="-1"><a class="header-anchor" href="#batched-key-access" aria-hidden="true">#</a> Batched Key Access</h4><p>ç†è§£äº† MRR æ€§èƒ½æå‡çš„åŸç†ï¼Œæˆ‘ä»¬å°±èƒ½ç†è§£ MySQL åœ¨ 5.6 ç‰ˆæœ¬åå¼€å§‹å¼•å…¥çš„ Batched Key Acess(BKA) ç®—æ³•äº†ã€‚è¿™ä¸ª BKA ç®—æ³•ï¼Œå…¶å®å°±æ˜¯å¯¹ NLJ ç®—æ³•çš„ä¼˜åŒ–ã€‚</p><p>æˆ‘ä»¬å†æ¥çœ‹çœ‹ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ç”¨åˆ°çš„ NLJ ç®—æ³•çš„æµç¨‹å›¾ï¼š</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/10e14e8b9691ac6337d457172b641a3d-1584367401994.jpg" alt="img"></p><p>å›¾ 4 Index Nested-Loop Join æµç¨‹å›¾</p><p>NLJ ç®—æ³•æ‰§è¡Œçš„é€»è¾‘æ˜¯ï¼šä»é©±åŠ¨è¡¨ t1ï¼Œä¸€è¡Œè¡Œåœ°å–å‡º a çš„å€¼ï¼Œå†åˆ°è¢«é©±åŠ¨è¡¨ t2 å»åš joinã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹äºè¡¨ t2 æ¥è¯´ï¼Œæ¯æ¬¡éƒ½æ˜¯åŒ¹é…ä¸€ä¸ªå€¼ã€‚è¿™æ—¶ï¼ŒMRR çš„ä¼˜åŠ¿å°±ç”¨ä¸ä¸Šäº†ã€‚</p><p>é‚£æ€ä¹ˆæ‰èƒ½ä¸€æ¬¡æ€§åœ°å¤šä¼ äº›å€¼ç»™è¡¨ t2 å‘¢ï¼Ÿæ–¹æ³•å°±æ˜¯ï¼Œä»è¡¨ t1 é‡Œä¸€æ¬¡æ€§åœ°å¤šæ‹¿äº›è¡Œå‡ºæ¥ï¼Œä¸€èµ·ä¼ ç»™è¡¨ t2ã€‚</p><p>æ—¢ç„¶å¦‚æ­¤ï¼Œæˆ‘ä»¬å°±æŠŠè¡¨ t1 çš„æ•°æ®å–å‡ºæ¥ä¸€éƒ¨åˆ†ï¼Œå…ˆæ”¾åˆ°ä¸€ä¸ªä¸´æ—¶å†…å­˜ã€‚è¿™ä¸ªä¸´æ—¶å†…å­˜ä¸æ˜¯åˆ«äººï¼Œå°±æ˜¯ join_bufferã€‚</p><p>é€šè¿‡ä¸Šä¸€ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬çŸ¥é“ join_buffer åœ¨ BNL ç®—æ³•é‡Œçš„ä½œç”¨ï¼Œæ˜¯æš‚å­˜é©±åŠ¨è¡¨çš„æ•°æ®ã€‚ä½†æ˜¯åœ¨ NLJ ç®—æ³•é‡Œå¹¶æ²¡æœ‰ç”¨ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬åˆšå¥½å°±å¯ä»¥å¤ç”¨ join_buffer åˆ° BKA ç®—æ³•ä¸­ã€‚</p><p>å¦‚å›¾ 5 æ‰€ç¤ºï¼Œæ˜¯ä¸Šé¢çš„ NLJ ç®—æ³•ä¼˜åŒ–åçš„ BKA ç®—æ³•çš„æµç¨‹ã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/31d85666542b9cb0b47a447a8593a47e-1584367402099.jpg" alt="img"></p><p>å›¾ 5 Batched Key Acess æµç¨‹</p><p>å›¾ä¸­ï¼Œæˆ‘åœ¨ join_buffer ä¸­æ”¾å…¥çš„æ•°æ®æ˜¯ P1~P100ï¼Œè¡¨ç¤ºçš„æ˜¯åªä¼šå–æŸ¥è¯¢éœ€è¦çš„å­—æ®µã€‚å½“ç„¶ï¼Œå¦‚æœ join buffer æ”¾ä¸ä¸‹ P1~P100 çš„æ‰€æœ‰æ•°æ®ï¼Œå°±ä¼šæŠŠè¿™ 100 è¡Œæ•°æ®åˆ†æˆå¤šæ®µæ‰§è¡Œä¸Šå›¾çš„æµç¨‹ã€‚</p><p>é‚£ä¹ˆï¼Œè¿™ä¸ª BKA ç®—æ³•åˆ°åº•è¦æ€ä¹ˆå¯ç”¨å‘¢ï¼Ÿ</p><p>å¦‚æœè¦ä½¿ç”¨ BKA ä¼˜åŒ–ç®—æ³•çš„è¯ï¼Œä½ éœ€è¦åœ¨æ‰§è¡Œ SQL è¯­å¥ä¹‹å‰ï¼Œå…ˆè®¾ç½®</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">set</span> <span class="token assign-left variable">optimizer_switch</span><span class="token operator">=</span><span class="token string">&#39;mrr=on,mrr_cost_based=off,batched_key_access=on&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å…¶ä¸­ï¼Œå‰ä¸¤ä¸ªå‚æ•°çš„ä½œç”¨æ˜¯è¦å¯ç”¨ MRRã€‚è¿™ä¹ˆåšçš„åŸå› æ˜¯ï¼ŒBKA ç®—æ³•çš„ä¼˜åŒ–è¦ä¾èµ–äº MRRã€‚</p><h4 id="bnl-ç®—æ³•çš„æ€§èƒ½é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#bnl-ç®—æ³•çš„æ€§èƒ½é—®é¢˜" aria-hidden="true">#</a> BNL ç®—æ³•çš„æ€§èƒ½é—®é¢˜</h4><p>è¯´å®Œäº† NLJ ç®—æ³•çš„ä¼˜åŒ–ï¼Œæˆ‘ä»¬å†æ¥çœ‹ BNL ç®—æ³•çš„ä¼˜åŒ–ã€‚</p><p>æˆ‘åœ¨ä¸Šä¸€ç¯‡æ–‡ç« æœ«å°¾ï¼Œç»™ä½ ç•™ä¸‹çš„æ€è€ƒé¢˜æ˜¯ï¼Œä½¿ç”¨ Block Nested-Loop Join(BNL) ç®—æ³•æ—¶ï¼Œå¯èƒ½ä¼šå¯¹è¢«é©±åŠ¨è¡¨åšå¤šæ¬¡æ‰«æã€‚å¦‚æœè¿™ä¸ªè¢«é©±åŠ¨è¡¨æ˜¯ä¸€ä¸ªå¤§çš„å†·æ•°æ®è¡¨ï¼Œé™¤äº†ä¼šå¯¼è‡´ IO å‹åŠ›å¤§ä»¥å¤–ï¼Œè¿˜ä¼šå¯¹ç³»ç»Ÿæœ‰ä»€ä¹ˆå½±å“å‘¢ï¼Ÿ</p><p>åœ¨[ç¬¬ 33 ç¯‡æ–‡ç« ]ä¸­ï¼Œæˆ‘ä»¬è¯´åˆ° InnoDB çš„ LRU ç®—æ³•çš„æ—¶å€™æåˆ°ï¼Œç”±äº InnoDB å¯¹ Bufffer Pool çš„ LRU ç®—æ³•åšäº†ä¼˜åŒ–ï¼Œå³ï¼šç¬¬ä¸€æ¬¡ä»ç£ç›˜è¯»å…¥å†…å­˜çš„æ•°æ®é¡µï¼Œä¼šå…ˆæ”¾åœ¨ old åŒºåŸŸã€‚å¦‚æœ 1 ç§’ä¹‹åè¿™ä¸ªæ•°æ®é¡µä¸å†è¢«è®¿é—®äº†ï¼Œå°±ä¸ä¼šè¢«ç§»åŠ¨åˆ° LRU é“¾è¡¨å¤´éƒ¨ï¼Œè¿™æ ·å¯¹ Buffer Pool çš„å‘½ä¸­ç‡å½±å“å°±ä¸å¤§ã€‚</p><p>ä½†æ˜¯ï¼Œå¦‚æœä¸€ä¸ªä½¿ç”¨ BNL ç®—æ³•çš„ join è¯­å¥ï¼Œå¤šæ¬¡æ‰«æä¸€ä¸ªå†·è¡¨ï¼Œè€Œä¸”è¿™ä¸ªè¯­å¥æ‰§è¡Œæ—¶é—´è¶…è¿‡ 1 ç§’ï¼Œå°±ä¼šåœ¨å†æ¬¡æ‰«æå†·è¡¨çš„æ—¶å€™ï¼ŒæŠŠå†·è¡¨çš„æ•°æ®é¡µç§»åˆ° LRU é“¾è¡¨å¤´éƒ¨ã€‚</p><p>è¿™ç§æƒ…å†µå¯¹åº”çš„ï¼Œæ˜¯å†·è¡¨çš„æ•°æ®é‡å°äºæ•´ä¸ª Buffer Pool çš„ 3/8ï¼Œèƒ½å¤Ÿå®Œå…¨æ”¾å…¥ old åŒºåŸŸçš„æƒ…å†µã€‚</p><p>å¦‚æœè¿™ä¸ªå†·è¡¨å¾ˆå¤§ï¼Œå°±ä¼šå‡ºç°å¦å¤–ä¸€ç§æƒ…å†µï¼šä¸šåŠ¡æ­£å¸¸è®¿é—®çš„æ•°æ®é¡µï¼Œæ²¡æœ‰æœºä¼šè¿›å…¥ young åŒºåŸŸã€‚</p><p>ç”±äºä¼˜åŒ–æœºåˆ¶çš„å­˜åœ¨ï¼Œä¸€ä¸ªæ­£å¸¸è®¿é—®çš„æ•°æ®é¡µï¼Œè¦è¿›å…¥ young åŒºåŸŸï¼Œéœ€è¦éš” 1 ç§’åå†æ¬¡è¢«è®¿é—®åˆ°ã€‚ä½†æ˜¯ï¼Œç”±äºæˆ‘ä»¬çš„ join è¯­å¥åœ¨å¾ªç¯è¯»ç£ç›˜å’Œæ·˜æ±°å†…å­˜é¡µï¼Œè¿›å…¥ old åŒºåŸŸçš„æ•°æ®é¡µï¼Œå¾ˆå¯èƒ½åœ¨ 1 ç§’ä¹‹å†…å°±è¢«æ·˜æ±°äº†ã€‚è¿™æ ·ï¼Œå°±ä¼šå¯¼è‡´è¿™ä¸ª MySQL å®ä¾‹çš„ Buffer Pool åœ¨è¿™æ®µæ—¶é—´å†…ï¼Œyoung åŒºåŸŸçš„æ•°æ®é¡µæ²¡æœ‰è¢«åˆç†åœ°æ·˜æ±°ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸¤ç§æƒ…å†µéƒ½ä¼šå½±å“ Buffer Pool çš„æ­£å¸¸è¿ä½œã€‚</p><p><strong>å¤§è¡¨ join æ“ä½œè™½ç„¶å¯¹ IO æœ‰å½±å“ï¼Œä½†æ˜¯åœ¨è¯­å¥æ‰§è¡Œç»“æŸåï¼Œå¯¹ IO çš„å½±å“ä¹Ÿå°±ç»“æŸäº†ã€‚ä½†æ˜¯ï¼Œå¯¹ Buffer Pool çš„å½±å“å°±æ˜¯æŒç»­æ€§çš„ï¼Œéœ€è¦ä¾é åç»­çš„æŸ¥è¯¢è¯·æ±‚æ…¢æ…¢æ¢å¤å†…å­˜å‘½ä¸­ç‡ã€‚</strong></p><p>ä¸ºäº†å‡å°‘è¿™ç§å½±å“ï¼Œä½ å¯ä»¥è€ƒè™‘å¢å¤§ join_buffer_size çš„å€¼ï¼Œå‡å°‘å¯¹è¢«é©±åŠ¨è¡¨çš„æ‰«ææ¬¡æ•°ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼ŒBNL ç®—æ³•å¯¹ç³»ç»Ÿçš„å½±å“ä¸»è¦åŒ…æ‹¬ä¸‰ä¸ªæ–¹é¢ï¼š</p><ol><li>å¯èƒ½ä¼šå¤šæ¬¡æ‰«æè¢«é©±åŠ¨è¡¨ï¼Œå ç”¨ç£ç›˜ IO èµ„æºï¼›</li><li>åˆ¤æ–­ join æ¡ä»¶éœ€è¦æ‰§è¡Œ M*N æ¬¡å¯¹æ¯”ï¼ˆMã€N åˆ†åˆ«æ˜¯ä¸¤å¼ è¡¨çš„è¡Œæ•°ï¼‰ï¼Œå¦‚æœæ˜¯å¤§è¡¨å°±ä¼šå ç”¨éå¸¸å¤šçš„ CPU èµ„æºï¼›</li><li>å¯èƒ½ä¼šå¯¼è‡´ Buffer Pool çš„çƒ­æ•°æ®è¢«æ·˜æ±°ï¼Œå½±å“å†…å­˜å‘½ä¸­ç‡ã€‚</li></ol><p>æˆ‘ä»¬æ‰§è¡Œè¯­å¥ä¹‹å‰ï¼Œéœ€è¦é€šè¿‡ç†è®ºåˆ†æå’ŒæŸ¥çœ‹ explain ç»“æœçš„æ–¹å¼ï¼Œç¡®è®¤æ˜¯å¦è¦ä½¿ç”¨ BNL ç®—æ³•ã€‚å¦‚æœç¡®è®¤ä¼˜åŒ–å™¨ä¼šä½¿ç”¨ BNL ç®—æ³•ï¼Œå°±éœ€è¦åšä¼˜åŒ–ã€‚ä¼˜åŒ–çš„å¸¸è§åšæ³•æ˜¯ï¼Œç»™è¢«é©±åŠ¨è¡¨çš„ join å­—æ®µåŠ ä¸Šç´¢å¼•ï¼ŒæŠŠ BNL ç®—æ³•è½¬æˆ BKA ç®—æ³•ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±å…·ä½“çœ‹çœ‹ï¼Œè¿™ä¸ªä¼˜åŒ–æ€ä¹ˆåšï¼Ÿ</p><h4 id="bnl-è½¬-bka" tabindex="-1"><a class="header-anchor" href="#bnl-è½¬-bka" aria-hidden="true">#</a> BNL è½¬ BKA</h4><p>ä¸€äº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨è¢«é©±åŠ¨è¡¨ä¸Šå»ºç´¢å¼•ï¼Œè¿™æ—¶å°±å¯ä»¥ç›´æ¥è½¬æˆ BKA ç®—æ³•äº†ã€‚</p><p>ä½†æ˜¯ï¼Œæœ‰æ—¶å€™ä½ ç¡®å®ä¼šç¢°åˆ°ä¸€äº›ä¸é€‚åˆåœ¨è¢«é©±åŠ¨è¡¨ä¸Šå»ºç´¢å¼•çš„æƒ…å†µã€‚æ¯”å¦‚ä¸‹é¢è¿™ä¸ªè¯­å¥ï¼š</p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t1 <span class="token keyword">join</span> t2 <span class="token keyword">on</span> <span class="token punctuation">(</span>t1<span class="token punctuation">.</span>b<span class="token operator">=</span>t2<span class="token punctuation">.</span>b<span class="token punctuation">)</span> <span class="token keyword">where</span> <span class="token class-name">t2</span><span class="token punctuation">.</span>b<span class="token operator">&gt;=</span><span class="token number">1</span> <span class="token keyword">and</span> t2<span class="token punctuation">.</span>b<span class="token operator">&lt;=</span><span class="token number">2000</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æˆ‘ä»¬åœ¨æ–‡ç« å¼€å§‹çš„æ—¶å€™ï¼Œåœ¨è¡¨ t2 ä¸­æ’å…¥äº† 100 ä¸‡è¡Œæ•°æ®ï¼Œä½†æ˜¯ç»è¿‡ where æ¡ä»¶è¿‡æ»¤åï¼Œéœ€è¦å‚ä¸ join çš„åªæœ‰ 2000 è¡Œæ•°æ®ã€‚å¦‚æœè¿™æ¡è¯­å¥åŒæ—¶æ˜¯ä¸€ä¸ªä½é¢‘çš„ SQL è¯­å¥ï¼Œé‚£ä¹ˆå†ä¸ºè¿™ä¸ªè¯­å¥åœ¨è¡¨ t2 çš„å­—æ®µ b ä¸Šåˆ›å»ºä¸€ä¸ªç´¢å¼•å°±å¾ˆæµªè´¹äº†ã€‚</p><p>ä½†æ˜¯ï¼Œå¦‚æœä½¿ç”¨ BNL ç®—æ³•æ¥ join çš„è¯ï¼Œè¿™ä¸ªè¯­å¥çš„æ‰§è¡Œæµç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><ol><li>æŠŠè¡¨ t1 çš„æ‰€æœ‰å­—æ®µå–å‡ºæ¥ï¼Œå­˜å…¥ join_buffer ä¸­ã€‚è¿™ä¸ªè¡¨åªæœ‰ 1000 è¡Œï¼Œjoin_buffer_size é»˜è®¤å€¼æ˜¯ 256kï¼Œå¯ä»¥å®Œå…¨å­˜å…¥ã€‚</li><li>æ‰«æè¡¨ t2ï¼Œå–å‡ºæ¯ä¸€è¡Œæ•°æ®è·Ÿ join_buffer ä¸­çš„æ•°æ®è¿›è¡Œå¯¹æ¯”ï¼Œ <ul><li>å¦‚æœä¸æ»¡è¶³ t1.b=t2.bï¼Œåˆ™è·³è¿‡ï¼›</li><li>å¦‚æœæ»¡è¶³ t1.b=t2.b, å†åˆ¤æ–­å…¶ä»–æ¡ä»¶ï¼Œä¹Ÿå°±æ˜¯æ˜¯å¦æ»¡è¶³ t2.b å¤„äº [1,2000] çš„æ¡ä»¶ï¼Œå¦‚æœæ˜¯ï¼Œå°±ä½œä¸ºç»“æœé›†çš„ä¸€éƒ¨åˆ†è¿”å›ï¼Œå¦åˆ™è·³è¿‡ã€‚</li></ul></li></ol><p>æˆ‘åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­è¯´è¿‡ï¼Œå¯¹äºè¡¨ t2 çš„æ¯ä¸€è¡Œï¼Œåˆ¤æ–­ join æ˜¯å¦æ»¡è¶³çš„æ—¶å€™ï¼Œéƒ½éœ€è¦éå† join_buffer ä¸­çš„æ‰€æœ‰è¡Œã€‚å› æ­¤åˆ¤æ–­ç­‰å€¼æ¡ä»¶çš„æ¬¡æ•°æ˜¯ 1000*100 ä¸‡ =10 äº¿æ¬¡ï¼Œè¿™ä¸ªåˆ¤æ–­çš„å·¥ä½œé‡å¾ˆå¤§ã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/92fbdbfc35da3040396401250cb33f60-1584367402648.png" alt="img"></p><p>å›¾ 6 explain ç»“æœ</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/d862bc3e88305688df2c354a4b26809c-1584367402652.png" alt="img"></p><p>å›¾ 7 è¯­å¥æ‰§è¡Œæ—¶é—´</p><p>å¯ä»¥çœ‹åˆ°ï¼Œexplain ç»“æœé‡Œ Extra å­—æ®µæ˜¾ç¤ºä½¿ç”¨äº† BNL ç®—æ³•ã€‚åœ¨æˆ‘çš„æµ‹è¯•ç¯å¢ƒé‡Œï¼Œè¿™æ¡è¯­å¥éœ€è¦æ‰§è¡Œ 1 åˆ† 11 ç§’ã€‚</p><p>åœ¨è¡¨ t2 çš„å­—æ®µ b ä¸Šåˆ›å»ºç´¢å¼•ä¼šæµªè´¹èµ„æºï¼Œä½†æ˜¯ä¸åˆ›å»ºç´¢å¼•çš„è¯è¿™ä¸ªè¯­å¥çš„ç­‰å€¼æ¡ä»¶è¦åˆ¤æ–­ 10 äº¿æ¬¡ï¼Œæƒ³æƒ³ä¹Ÿæ˜¯æµªè´¹ã€‚é‚£ä¹ˆï¼Œæœ‰æ²¡æœ‰ä¸¤å…¨å…¶ç¾çš„åŠæ³•å‘¢ï¼Ÿ</p><p>è¿™æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘ä½¿ç”¨ä¸´æ—¶è¡¨ã€‚ä½¿ç”¨ä¸´æ—¶è¡¨çš„å¤§è‡´æ€è·¯æ˜¯ï¼š</p><ol><li>æŠŠè¡¨ t2 ä¸­æ»¡è¶³æ¡ä»¶çš„æ•°æ®æ”¾åœ¨ä¸´æ—¶è¡¨ tmp_t ä¸­ï¼›</li><li>ä¸ºäº†è®© join ä½¿ç”¨ BKA ç®—æ³•ï¼Œç»™ä¸´æ—¶è¡¨ tmp_t çš„å­—æ®µ b åŠ ä¸Šç´¢å¼•ï¼›</li><li>è®©è¡¨ t1 å’Œ tmp_t åš join æ“ä½œã€‚</li></ol><p>æ­¤æ—¶ï¼Œå¯¹åº”çš„ SQL è¯­å¥çš„å†™æ³•å¦‚ä¸‹ï¼š</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">temporary</span> <span class="token keyword">table</span> temp_t<span class="token punctuation">(</span>id <span class="token keyword">int</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span> a <span class="token keyword">int</span><span class="token punctuation">,</span> b <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">index</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">engine</span><span class="token operator">=</span><span class="token keyword">innodb</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> temp_t <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t2 <span class="token keyword">where</span> b<span class="token operator">&gt;=</span><span class="token number">1</span> <span class="token operator">and</span> b<span class="token operator">&lt;=</span><span class="token number">2000</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t1 <span class="token keyword">join</span> temp_t <span class="token keyword">on</span> <span class="token punctuation">(</span>t1<span class="token punctuation">.</span>b<span class="token operator">=</span>temp_t<span class="token punctuation">.</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å›¾ 8 å°±æ˜¯è¿™ä¸ªè¯­å¥åºåˆ—çš„æ‰§è¡Œæ•ˆæœã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/a80cdffe8173fa0fd8969ed976ac6ac7-1584367402655.png" alt="img"></p><p>å›¾ 8 ä½¿ç”¨ä¸´æ—¶è¡¨çš„æ‰§è¡Œæ•ˆæœ</p><p>å¯ä»¥çœ‹åˆ°ï¼Œæ•´ä¸ªè¿‡ç¨‹ 3 ä¸ªè¯­å¥æ‰§è¡Œæ—¶é—´çš„æ€»å’Œè¿˜ä¸åˆ° 1 ç§’ï¼Œç›¸æ¯”äºå‰é¢çš„ 1 åˆ† 11 ç§’ï¼Œæ€§èƒ½å¾—åˆ°äº†å¤§å¹…æå‡ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä¸€èµ·çœ‹ä¸€ä¸‹è¿™ä¸ªè¿‡ç¨‹çš„æ¶ˆè€—ï¼š</p><ol><li>æ‰§è¡Œ insert è¯­å¥æ„é€  temp_t è¡¨å¹¶æ’å…¥æ•°æ®çš„è¿‡ç¨‹ä¸­ï¼Œå¯¹è¡¨ t2 åšäº†å…¨è¡¨æ‰«æï¼Œè¿™é‡Œæ‰«æè¡Œæ•°æ˜¯ 100 ä¸‡ã€‚</li><li>ä¹‹åçš„ join è¯­å¥ï¼Œæ‰«æè¡¨ t1ï¼Œè¿™é‡Œçš„æ‰«æè¡Œæ•°æ˜¯ 1000ï¼›join æ¯”è¾ƒè¿‡ç¨‹ä¸­ï¼Œåšäº† 1000 æ¬¡å¸¦ç´¢å¼•çš„æŸ¥è¯¢ã€‚ç›¸æ¯”äºä¼˜åŒ–å‰çš„ join è¯­å¥éœ€è¦åš 10 äº¿æ¬¡æ¡ä»¶åˆ¤æ–­æ¥è¯´ï¼Œè¿™ä¸ªä¼˜åŒ–æ•ˆæœè¿˜æ˜¯å¾ˆæ˜æ˜¾çš„ã€‚</li></ol><p>æ€»ä½“æ¥çœ‹ï¼Œä¸è®ºæ˜¯åœ¨åŸè¡¨ä¸ŠåŠ ç´¢å¼•ï¼Œè¿˜æ˜¯ç”¨æœ‰ç´¢å¼•çš„ä¸´æ—¶è¡¨ï¼Œæˆ‘ä»¬çš„æ€è·¯éƒ½æ˜¯è®© join è¯­å¥èƒ½å¤Ÿç”¨ä¸Šè¢«é©±åŠ¨è¡¨ä¸Šçš„ç´¢å¼•ï¼Œæ¥è§¦å‘ BKA ç®—æ³•ï¼Œæå‡æŸ¥è¯¢æ€§èƒ½ã€‚</p><h4 id="æ‰©å±•-hash-join" tabindex="-1"><a class="header-anchor" href="#æ‰©å±•-hash-join" aria-hidden="true">#</a> æ‰©å±• -hash join</h4><p>çœ‹åˆ°è¿™é‡Œä½ å¯èƒ½å‘ç°äº†ï¼Œå…¶å®ä¸Šé¢è®¡ç®— 10 äº¿æ¬¡é‚£ä¸ªæ“ä½œï¼Œçœ‹ä¸Šå»æœ‰ç‚¹å„¿å‚»ã€‚å¦‚æœ join_buffer é‡Œé¢ç»´æŠ¤çš„ä¸æ˜¯ä¸€ä¸ªæ— åºæ•°ç»„ï¼Œè€Œæ˜¯ä¸€ä¸ªå“ˆå¸Œè¡¨çš„è¯ï¼Œé‚£ä¹ˆå°±ä¸æ˜¯ 10 äº¿æ¬¡åˆ¤æ–­ï¼Œè€Œæ˜¯ 100 ä¸‡æ¬¡ hash æŸ¥æ‰¾ã€‚è¿™æ ·çš„è¯ï¼Œæ•´æ¡è¯­å¥çš„æ‰§è¡Œé€Ÿåº¦å°±å¿«å¤šäº†å§ï¼Ÿ</p><p>ç¡®å®å¦‚æ­¤ã€‚</p><p>è¿™ï¼Œä¹Ÿæ­£æ˜¯ MySQL çš„ä¼˜åŒ–å™¨å’Œæ‰§è¡Œå™¨ä¸€ç›´è¢«è¯Ÿç—…çš„ä¸€ä¸ªåŸå› ï¼šä¸æ”¯æŒå“ˆå¸Œ joinã€‚å¹¶ä¸”ï¼ŒMySQL å®˜æ–¹çš„ roadmapï¼Œä¹Ÿæ˜¯è¿Ÿè¿Ÿæ²¡æœ‰æŠŠè¿™ä¸ªä¼˜åŒ–æ’ä¸Šè®®ç¨‹ã€‚</p><p>å®é™…ä¸Šï¼Œè¿™ä¸ªä¼˜åŒ–æ€è·¯ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå·±å®ç°åœ¨ä¸šåŠ¡ç«¯ã€‚å®ç°æµç¨‹å¤§è‡´å¦‚ä¸‹ï¼š</p><ol><li><code>select * from t1;</code>å–å¾—è¡¨ t1 çš„å…¨éƒ¨ 1000 è¡Œæ•°æ®ï¼Œåœ¨ä¸šåŠ¡ç«¯å­˜å…¥ä¸€ä¸ª hash ç»“æ„ï¼Œæ¯”å¦‚ C++ é‡Œçš„ setã€PHP çš„ dict è¿™æ ·çš„æ•°æ®ç»“æ„ã€‚</li><li><code>select * from t2 where b&gt;=1 and b&lt;=2000;</code> è·å–è¡¨ t2 ä¸­æ»¡è¶³æ¡ä»¶çš„ 2000 è¡Œæ•°æ®ã€‚</li><li>æŠŠè¿™ 2000 è¡Œæ•°æ®ï¼Œä¸€è¡Œä¸€è¡Œåœ°å–åˆ°ä¸šåŠ¡ç«¯ï¼Œåˆ° hash ç»“æ„çš„æ•°æ®è¡¨ä¸­å¯»æ‰¾åŒ¹é…çš„æ•°æ®ã€‚æ»¡è¶³åŒ¹é…çš„æ¡ä»¶çš„è¿™è¡Œæ•°æ®ï¼Œå°±ä½œä¸ºç»“æœé›†çš„ä¸€è¡Œã€‚</li></ol><p>ç†è®ºä¸Šï¼Œè¿™ä¸ªè¿‡ç¨‹ä¼šæ¯”ä¸´æ—¶è¡¨æ–¹æ¡ˆçš„æ‰§è¡Œé€Ÿåº¦è¿˜è¦å¿«ä¸€äº›ã€‚å¦‚æœä½ æ„Ÿå…´è¶£çš„è¯ï¼Œå¯ä»¥è‡ªå·±éªŒè¯ä¸€ä¸‹ã€‚</p><h4 id="å°ç»“-22" tabindex="-1"><a class="header-anchor" href="#å°ç»“-22" aria-hidden="true">#</a> å°ç»“</h4><p>ä»Šå¤©ï¼Œæˆ‘å’Œä½ åˆ†äº«äº† Index Nested-Loop Joinï¼ˆNLJï¼‰å’Œ Block Nested-Loop Joinï¼ˆBNLï¼‰çš„ä¼˜åŒ–æ–¹æ³•ã€‚</p><p>åœ¨è¿™äº›ä¼˜åŒ–æ–¹æ³•ä¸­ï¼š</p><ol><li>BKA ä¼˜åŒ–æ˜¯ MySQL å·²ç»å†…ç½®æ”¯æŒçš„ï¼Œå»ºè®®ä½ é»˜è®¤ä½¿ç”¨ï¼›</li><li>BNL ç®—æ³•æ•ˆç‡ä½ï¼Œå»ºè®®ä½ éƒ½å°½é‡è½¬æˆ BKA ç®—æ³•ã€‚ä¼˜åŒ–çš„æ–¹å‘å°±æ˜¯ç»™è¢«é©±åŠ¨è¡¨çš„å…³è”å­—æ®µåŠ ä¸Šç´¢å¼•ï¼›</li><li>åŸºäºä¸´æ—¶è¡¨çš„æ”¹è¿›æ–¹æ¡ˆï¼Œå¯¹äºèƒ½å¤Ÿæå‰è¿‡æ»¤å‡ºå°æ•°æ®çš„ join è¯­å¥æ¥è¯´ï¼Œæ•ˆæœè¿˜æ˜¯å¾ˆå¥½çš„ï¼›</li><li>MySQL ç›®å‰çš„ç‰ˆæœ¬è¿˜ä¸æ”¯æŒ hash joinï¼Œä½†ä½ å¯ä»¥é…åˆåº”ç”¨ç«¯è‡ªå·±æ¨¡æ‹Ÿå‡ºæ¥ï¼Œç†è®ºä¸Šæ•ˆæœè¦å¥½äºä¸´æ—¶è¡¨çš„æ–¹æ¡ˆã€‚</li></ol><p>æœ€åï¼Œæˆ‘ç»™ä½ ç•™ä¸‹ä¸€é“æ€è€ƒé¢˜å§ã€‚</p><p>æˆ‘ä»¬åœ¨è®² join è¯­å¥çš„è¿™ä¸¤ç¯‡æ–‡ç« ä¸­ï¼Œéƒ½åªæ¶‰åŠåˆ°äº†ä¸¤ä¸ªè¡¨çš„ joinã€‚é‚£ä¹ˆï¼Œç°åœ¨æœ‰ä¸€ä¸ªä¸‰ä¸ªè¡¨ join çš„éœ€æ±‚ï¼Œå‡è®¾è¿™ä¸‰ä¸ªè¡¨çš„è¡¨ç»“æ„å¦‚ä¸‹ï¼š</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>t1<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
 <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
 <span class="token identifier"><span class="token punctuation">`</span>a<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
 <span class="token identifier"><span class="token punctuation">`</span>b<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
 <span class="token identifier"><span class="token punctuation">`</span>c<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span><span class="token punctuation">;</span> 
<span class="token keyword">create</span> <span class="token keyword">table</span> t2 <span class="token operator">like</span> t1<span class="token punctuation">;</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> t3 <span class="token operator">like</span> t2<span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token comment">// åˆå§‹åŒ–ä¸‰å¼ è¡¨çš„æ•°æ®</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¯­å¥çš„éœ€æ±‚å®ç°å¦‚ä¸‹çš„ join é€»è¾‘ï¼š</p><div class="language-vbnet line-numbers-mode" data-ext="vbnet"><pre class="language-vbnet"><code><span class="token keyword">select</span> <span class="token operator">*</span> from t1 join t2 <span class="token keyword">on</span><span class="token punctuation">(</span>t1.a<span class="token operator">=</span>t2.a<span class="token punctuation">)</span> join t3 <span class="token keyword">on</span> <span class="token punctuation">(</span>t2.b<span class="token operator">=</span>t3.b<span class="token punctuation">)</span> where t1.c<span class="token operator">&gt;=</span>X <span class="token keyword">and</span> t2.c<span class="token operator">&gt;=</span>Y <span class="token keyword">and</span> t3.c<span class="token operator">&gt;=</span>Z<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ç°åœ¨ä¸ºäº†å¾—åˆ°æœ€å¿«çš„æ‰§è¡Œé€Ÿåº¦ï¼Œå¦‚æœè®©ä½ æ¥è®¾è®¡è¡¨ t1ã€t2ã€t3 ä¸Šçš„ç´¢å¼•ï¼Œæ¥æ”¯æŒè¿™ä¸ª join è¯­å¥ï¼Œä½ ä¼šåŠ å“ªäº›ç´¢å¼•å‘¢ï¼Ÿ</p><p>åŒæ—¶ï¼Œå¦‚æœæˆ‘å¸Œæœ›ä½ ç”¨ straight_join æ¥é‡å†™è¿™ä¸ªè¯­å¥ï¼Œé…åˆä½ åˆ›å»ºçš„ç´¢å¼•ï¼Œä½ å°±éœ€è¦å®‰æ’è¿æ¥é¡ºåºï¼Œä½ ä¸»è¦è€ƒè™‘çš„å› ç´ æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><p>ä½ å¯ä»¥æŠŠä½ çš„æ–¹æ¡ˆå’Œåˆ†æå†™åœ¨ç•™è¨€åŒºï¼Œæˆ‘ä¼šåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« çš„æœ«å°¾å’Œä½ è®¨è®ºè¿™ä¸ªé—®é¢˜ã€‚æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚</p><h4 id="ä¸ŠæœŸé—®é¢˜æ—¶é—´-19" tabindex="-1"><a class="header-anchor" href="#ä¸ŠæœŸé—®é¢˜æ—¶é—´-19" aria-hidden="true">#</a> ä¸ŠæœŸé—®é¢˜æ—¶é—´</h4><p>æˆ‘åœ¨ä¸Šç¯‡æ–‡ç« æœ€åç•™ç»™ä½ çš„é—®é¢˜ï¼Œå·²ç»åœ¨æœ¬ç¯‡æ–‡ç« ä¸­è§£ç­”äº†ã€‚</p><p>è¿™é‡Œæˆ‘å†æ ¹æ®è¯„è®ºåŒºç•™è¨€çš„æƒ…å†µï¼Œç®€å•æ€»ç»“ä¸‹ã€‚æ ¹æ®æ•°æ®é‡çš„å¤§å°ï¼Œæœ‰è¿™ä¹ˆä¸¤ç§æƒ…å†µï¼š</p><ul><li>@é•¿æ° å’Œ @è€æ¨åŒå¿— æåˆ°äº†æ•°æ®é‡å°äº old åŒºåŸŸå†…å­˜çš„æƒ…å†µï¼›</li><li>@Zzz åŒå­¦ï¼Œå¾ˆè®¤çœŸåœ°çœ‹äº†å…¶ä»–åŒå­¦çš„è¯„è®ºï¼Œå¹¶ä¸”æäº†ä¸€ä¸ªå¾ˆæ·±çš„é—®é¢˜ã€‚å¯¹è¢«é©±åŠ¨è¡¨æ•°æ®é‡å¤§äº Buffer Pool çš„åœºæ™¯ï¼Œåšäº†å¾ˆç»†è‡´çš„æ¨æ¼”å’Œåˆ†æã€‚</li></ul><p>ç»™è¿™äº›åŒå­¦ç‚¹èµï¼Œéå¸¸å¥½çš„æ€è€ƒå’Œè®¨è®ºã€‚</p><h3 id="_38-éƒ½è¯´innodbå¥½-é‚£è¿˜è¦ä¸è¦ä½¿ç”¨memoryå¼•æ“" tabindex="-1"><a class="header-anchor" href="#_38-éƒ½è¯´innodbå¥½-é‚£è¿˜è¦ä¸è¦ä½¿ç”¨memoryå¼•æ“" aria-hidden="true">#</a> 38 éƒ½è¯´InnoDBå¥½ï¼Œé‚£è¿˜è¦ä¸è¦ä½¿ç”¨Memoryå¼•æ“ï¼Ÿ</h3><p>æˆ‘åœ¨ä¸Šä¸€ç¯‡æ–‡ç« æœ«å°¾ç•™ç»™ä½ çš„é—®é¢˜æ˜¯ï¼šä¸¤ä¸ª group by è¯­å¥éƒ½ç”¨äº† order by nullï¼Œä¸ºä»€ä¹ˆä½¿ç”¨å†…å­˜ä¸´æ—¶è¡¨å¾—åˆ°çš„è¯­å¥ç»“æœé‡Œï¼Œ0 è¿™ä¸ªå€¼åœ¨æœ€åä¸€è¡Œï¼›è€Œä½¿ç”¨ç£ç›˜ä¸´æ—¶è¡¨å¾—åˆ°çš„ç»“æœé‡Œï¼Œ0 è¿™ä¸ªå€¼åœ¨ç¬¬ä¸€è¡Œï¼Ÿ</p><p>ä»Šå¤©æˆ‘ä»¬å°±æ¥çœ‹çœ‹ï¼Œå‡ºç°è¿™ä¸ªé—®é¢˜çš„åŸå› å§ã€‚</p><h4 id="å†…å­˜è¡¨çš„æ•°æ®ç»„ç»‡ç»“æ„" tabindex="-1"><a class="header-anchor" href="#å†…å­˜è¡¨çš„æ•°æ®ç»„ç»‡ç»“æ„" aria-hidden="true">#</a> å†…å­˜è¡¨çš„æ•°æ®ç»„ç»‡ç»“æ„</h4><p>ä¸ºäº†ä¾¿äºåˆ†æï¼Œæˆ‘æ¥æŠŠè¿™ä¸ªé—®é¢˜ç®€åŒ–ä¸€ä¸‹ï¼Œå‡è®¾æœ‰ä»¥ä¸‹çš„ä¸¤å¼ è¡¨ t1 å’Œ t2ï¼Œå…¶ä¸­è¡¨ t1 ä½¿ç”¨ Memory å¼•æ“ï¼Œ è¡¨ t2 ä½¿ç”¨ InnoDB å¼•æ“ã€‚</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> t1<span class="token punctuation">(</span>id <span class="token keyword">int</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span> c <span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token keyword">engine</span><span class="token operator">=</span>Memory<span class="token punctuation">;</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> t2<span class="token punctuation">(</span>id <span class="token keyword">int</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span> c <span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token keyword">engine</span><span class="token operator">=</span><span class="token keyword">innodb</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> t1 <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> t2 <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åï¼Œæˆ‘åˆ†åˆ«æ‰§è¡Œ select * from t1 å’Œ select * from t2ã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/3fb1100b6e3390357d4efff0ba4765e6-1584367406946.png" alt="img"></p><p>å›¾ 1 ä¸¤ä¸ªæŸ¥è¯¢ç»“æœ -0 çš„ä½ç½®</p><p>å¯ä»¥çœ‹åˆ°ï¼Œå†…å­˜è¡¨ t1 çš„è¿”å›ç»“æœé‡Œé¢ 0 åœ¨æœ€åä¸€è¡Œï¼Œè€Œ InnoDB è¡¨ t2 çš„è¿”å›ç»“æœé‡Œ 0 åœ¨ç¬¬ä¸€è¡Œã€‚</p><p>å‡ºç°è¿™ä¸ªåŒºåˆ«çš„åŸå› ï¼Œè¦ä»è¿™ä¸¤ä¸ªå¼•æ“çš„ä¸»é”®ç´¢å¼•çš„ç»„ç»‡æ–¹å¼è¯´èµ·ã€‚</p><p>è¡¨ t2 ç”¨çš„æ˜¯ InnoDB å¼•æ“ï¼Œå®ƒçš„ä¸»é”®ç´¢å¼• id çš„ç»„ç»‡æ–¹å¼ï¼Œä½ å·²ç»å¾ˆç†Ÿæ‚‰äº†ï¼šInnoDB è¡¨çš„æ•°æ®å°±æ”¾åœ¨ä¸»é”®ç´¢å¼•æ ‘ä¸Šï¼Œä¸»é”®ç´¢å¼•æ˜¯ B+ æ ‘ã€‚æ‰€ä»¥è¡¨ t2 çš„æ•°æ®ç»„ç»‡æ–¹å¼å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/4e29e4f9db55ace6ab09161c68ad8c8d-1584367406946.jpg" alt="img"></p><p>å›¾ 2 è¡¨ t2 çš„æ•°æ®ç»„ç»‡</p><p>ä¸»é”®ç´¢å¼•ä¸Šçš„å€¼æ˜¯æœ‰åºå­˜å‚¨çš„ã€‚åœ¨æ‰§è¡Œ select * çš„æ—¶å€™ï¼Œå°±ä¼šæŒ‰ç…§å¶å­èŠ‚ç‚¹ä»å·¦åˆ°å³æ‰«æï¼Œæ‰€ä»¥å¾—åˆ°çš„ç»“æœé‡Œï¼Œ0 å°±å‡ºç°åœ¨ç¬¬ä¸€è¡Œã€‚</p><p>ä¸ InnoDB å¼•æ“ä¸åŒï¼ŒMemory å¼•æ“çš„æ•°æ®å’Œç´¢å¼•æ˜¯åˆ†å¼€çš„ã€‚æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¡¨ t1 ä¸­çš„æ•°æ®å†…å®¹ã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/dde03e92074cecba4154d30cd16a9684-1584367406946.jpg" alt="img"></p><p>å›¾ 3 è¡¨ t1 çš„æ•°æ®ç»„ç»‡</p><p>å¯ä»¥çœ‹åˆ°ï¼Œå†…å­˜è¡¨çš„æ•°æ®éƒ¨åˆ†ä»¥æ•°ç»„çš„æ–¹å¼å•ç‹¬å­˜æ”¾ï¼Œè€Œä¸»é”® id ç´¢å¼•é‡Œï¼Œå­˜çš„æ˜¯æ¯ä¸ªæ•°æ®çš„ä½ç½®ã€‚ä¸»é”® id æ˜¯ hash ç´¢å¼•ï¼Œå¯ä»¥çœ‹åˆ°ç´¢å¼•ä¸Šçš„ key å¹¶ä¸æ˜¯æœ‰åºçš„ã€‚</p><p>åœ¨å†…å­˜è¡¨ t1 ä¸­ï¼Œå½“æˆ‘æ‰§è¡Œ select * çš„æ—¶å€™ï¼Œèµ°çš„æ˜¯å…¨è¡¨æ‰«æï¼Œä¹Ÿå°±æ˜¯é¡ºåºæ‰«æè¿™ä¸ªæ•°ç»„ã€‚å› æ­¤ï¼Œ0 å°±æ˜¯æœ€åä¸€ä¸ªè¢«è¯»åˆ°ï¼Œå¹¶æ”¾å…¥ç»“æœé›†çš„æ•°æ®ã€‚</p><p>å¯è§ï¼ŒInnoDB å’Œ Memory å¼•æ“çš„æ•°æ®ç»„ç»‡æ–¹å¼æ˜¯ä¸åŒçš„ï¼š</p><ul><li>InnoDB å¼•æ“æŠŠæ•°æ®æ”¾åœ¨ä¸»é”®ç´¢å¼•ä¸Šï¼Œå…¶ä»–ç´¢å¼•ä¸Šä¿å­˜çš„æ˜¯ä¸»é”® idã€‚è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º<strong>ç´¢å¼•ç»„ç»‡è¡¨</strong>ï¼ˆIndex Organizied Tableï¼‰ã€‚</li><li>è€Œ Memory å¼•æ“é‡‡ç”¨çš„æ˜¯æŠŠæ•°æ®å•ç‹¬å­˜æ”¾ï¼Œç´¢å¼•ä¸Šä¿å­˜æ•°æ®ä½ç½®çš„æ•°æ®ç»„ç»‡å½¢å¼ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º<strong>å †ç»„ç»‡è¡¨</strong>ï¼ˆHeap Organizied Tableï¼‰ã€‚</li></ul><p>ä»ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œè¿™ä¸¤ä¸ªå¼•æ“çš„ä¸€äº›å…¸å‹ä¸åŒï¼š</p><ol><li>InnoDB è¡¨çš„æ•°æ®æ€»æ˜¯æœ‰åºå­˜æ”¾çš„ï¼Œè€Œå†…å­˜è¡¨çš„æ•°æ®å°±æ˜¯æŒ‰ç…§å†™å…¥é¡ºåºå­˜æ”¾çš„ï¼›</li><li>å½“æ•°æ®æ–‡ä»¶æœ‰ç©ºæ´çš„æ—¶å€™ï¼ŒInnoDB è¡¨åœ¨æ’å…¥æ–°æ•°æ®çš„æ—¶å€™ï¼Œä¸ºäº†ä¿è¯æ•°æ®æœ‰åºæ€§ï¼Œåªèƒ½åœ¨å›ºå®šçš„ä½ç½®å†™å…¥æ–°å€¼ï¼Œè€Œå†…å­˜è¡¨æ‰¾åˆ°ç©ºä½å°±å¯ä»¥æ’å…¥æ–°å€¼ï¼›</li><li>æ•°æ®ä½ç½®å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼ŒInnoDB è¡¨åªéœ€è¦ä¿®æ”¹ä¸»é”®ç´¢å¼•ï¼Œè€Œå†…å­˜è¡¨éœ€è¦ä¿®æ”¹æ‰€æœ‰ç´¢å¼•ï¼›</li><li>InnoDB è¡¨ç”¨ä¸»é”®ç´¢å¼•æŸ¥è¯¢æ—¶éœ€è¦èµ°ä¸€æ¬¡ç´¢å¼•æŸ¥æ‰¾ï¼Œç”¨æ™®é€šç´¢å¼•æŸ¥è¯¢çš„æ—¶å€™ï¼Œéœ€è¦èµ°ä¸¤æ¬¡ç´¢å¼•æŸ¥æ‰¾ã€‚è€Œå†…å­˜è¡¨æ²¡æœ‰è¿™ä¸ªåŒºåˆ«ï¼Œæ‰€æœ‰ç´¢å¼•çš„â€œåœ°ä½â€éƒ½æ˜¯ç›¸åŒçš„ã€‚</li><li>InnoDB æ”¯æŒå˜é•¿æ•°æ®ç±»å‹ï¼Œä¸åŒè®°å½•çš„é•¿åº¦å¯èƒ½ä¸åŒï¼›å†…å­˜è¡¨ä¸æ”¯æŒ Blob å’Œ Text å­—æ®µï¼Œå¹¶ä¸”å³ä½¿å®šä¹‰äº† varchar(N)ï¼Œå®é™…ä¹Ÿå½“ä½œ char(N)ï¼Œä¹Ÿå°±æ˜¯å›ºå®šé•¿åº¦å­—ç¬¦ä¸²æ¥å­˜å‚¨ï¼Œå› æ­¤å†…å­˜è¡¨çš„æ¯è¡Œæ•°æ®é•¿åº¦ç›¸åŒã€‚</li></ol><p>ç”±äºå†…å­˜è¡¨çš„è¿™äº›ç‰¹æ€§ï¼Œæ¯ä¸ªæ•°æ®è¡Œè¢«åˆ é™¤ä»¥åï¼Œç©ºå‡ºçš„è¿™ä¸ªä½ç½®éƒ½å¯ä»¥è¢«æ¥ä¸‹æ¥è¦æ’å…¥çš„æ•°æ®å¤ç”¨ã€‚æ¯”å¦‚ï¼Œå¦‚æœè¦åœ¨è¡¨ t1 ä¸­æ‰§è¡Œï¼š</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">delete</span> <span class="token keyword">from</span> t1 <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> t1 <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t1<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å°±ä¼šçœ‹åˆ°è¿”å›ç»“æœé‡Œï¼Œid=10 è¿™ä¸€è¡Œå‡ºç°åœ¨ id=4 ä¹‹åï¼Œä¹Ÿå°±æ˜¯åŸæ¥ id=5 è¿™è¡Œæ•°æ®çš„ä½ç½®ã€‚</p><p>éœ€è¦æŒ‡å‡ºçš„æ˜¯ï¼Œè¡¨ t1 çš„è¿™ä¸ªä¸»é”®ç´¢å¼•æ˜¯å“ˆå¸Œç´¢å¼•ï¼Œå› æ­¤å¦‚æœæ‰§è¡ŒèŒƒå›´æŸ¥è¯¢ï¼Œæ¯”å¦‚</p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t1 <span class="token keyword">where</span> <span class="token class-name">id</span><span class="token operator">&lt;</span><span class="token number">5</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æ˜¯ç”¨ä¸ä¸Šä¸»é”®ç´¢å¼•çš„ï¼Œéœ€è¦èµ°å…¨è¡¨æ‰«æã€‚ä½ å¯ä»¥å€Ÿæ­¤å†å›é¡¾ä¸‹[ç¬¬ 4 ç¯‡æ–‡ç« ]çš„å†…å®¹ã€‚é‚£å¦‚æœè¦è®©å†…å­˜è¡¨æ”¯æŒèŒƒå›´æ‰«æï¼Œåº”è¯¥æ€ä¹ˆåŠå‘¢ ï¼Ÿ</p><h4 id="hash-ç´¢å¼•å’Œ-b-tree-ç´¢å¼•" tabindex="-1"><a class="header-anchor" href="#hash-ç´¢å¼•å’Œ-b-tree-ç´¢å¼•" aria-hidden="true">#</a> hash ç´¢å¼•å’Œ B-Tree ç´¢å¼•</h4><p>å®é™…ä¸Šï¼Œå†…å­˜è¡¨ä¹Ÿæ˜¯æ”¯ B-Tree ç´¢å¼•çš„ã€‚åœ¨ id åˆ—ä¸Šåˆ›å»ºä¸€ä¸ª B-Tree ç´¢å¼•ï¼ŒSQL è¯­å¥å¯ä»¥è¿™ä¹ˆå†™ï¼š</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">alter</span> <span class="token keyword">table</span> t1 <span class="token keyword">add</span> <span class="token keyword">index</span> a_btree_index <span class="token keyword">using</span> <span class="token keyword">btree</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>è¿™æ—¶ï¼Œè¡¨ t1 çš„æ•°æ®ç»„ç»‡å½¢å¼å°±å˜æˆäº†è¿™æ ·ï¼š</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/1788deca56cb83c114d8353c92e3bde3-1584367406946.jpg" alt="img"></p><p>å›¾ 4 è¡¨ t1 çš„æ•°æ®ç»„ç»‡ -- å¢åŠ  B-Tree ç´¢å¼•</p><p>æ–°å¢çš„è¿™ä¸ª B-Tree ç´¢å¼•ä½ çœ‹ç€å°±çœ¼ç†Ÿäº†ï¼Œè¿™è·Ÿ InnoDB çš„ b+ æ ‘ç´¢å¼•ç»„ç»‡å½¢å¼ç±»ä¼¼ã€‚</p><p>ä½œä¸ºå¯¹æ¯”ï¼Œä½ å¯ä»¥çœ‹ä¸€ä¸‹è¿™ä¸‹é¢è¿™ä¸¤ä¸ªè¯­å¥çš„è¾“å‡ºï¼š</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/a85808fcccab24911d257d720550328a-1584367406947.png" alt="img"></p><p>å›¾ 5 ä½¿ç”¨ B-Tree å’Œ hash ç´¢å¼•æŸ¥è¯¢è¿”å›ç»“æœå¯¹æ¯”</p><p>å¯ä»¥çœ‹åˆ°ï¼Œæ‰§è¡Œ select * from t1 where id&lt;5 çš„æ—¶å€™ï¼Œä¼˜åŒ–å™¨ä¼šé€‰æ‹© B-Tree ç´¢å¼•ï¼Œæ‰€ä»¥è¿”å›ç»“æœæ˜¯ 0 åˆ° 4ã€‚ ä½¿ç”¨ force index å¼ºè¡Œä½¿ç”¨ä¸»é”® id è¿™ä¸ªç´¢å¼•ï¼Œid=0 è¿™ä¸€è¡Œå°±åœ¨ç»“æœé›†çš„æœ€æœ«å°¾äº†ã€‚</p><p>å…¶å®ï¼Œä¸€èˆ¬åœ¨æˆ‘ä»¬çš„å°è±¡ä¸­ï¼Œå†…å­˜è¡¨çš„ä¼˜åŠ¿æ˜¯é€Ÿåº¦å¿«ï¼Œå…¶ä¸­çš„ä¸€ä¸ªåŸå› å°±æ˜¯ Memory å¼•æ“æ”¯æŒ hash ç´¢å¼•ã€‚å½“ç„¶ï¼Œæ›´é‡è¦çš„åŸå› æ˜¯ï¼Œå†…å­˜è¡¨çš„æ‰€æœ‰æ•°æ®éƒ½ä¿å­˜åœ¨å†…å­˜ï¼Œè€Œå†…å­˜çš„è¯»å†™é€Ÿåº¦æ€»æ˜¯æ¯”ç£ç›˜å¿«ã€‚</p><p>ä½†æ˜¯ï¼Œæ¥ä¸‹æ¥æˆ‘è¦è·Ÿä½ è¯´æ˜ï¼Œä¸ºä»€ä¹ˆæˆ‘ä¸å»ºè®®ä½ åœ¨ç”Ÿäº§ç¯å¢ƒä¸Šä½¿ç”¨å†…å­˜è¡¨ã€‚è¿™é‡Œçš„åŸå› ä¸»è¦åŒ…æ‹¬ä¸¤ä¸ªæ–¹é¢ï¼š</p><ol><li>é”ç²’åº¦é—®é¢˜ï¼›</li><li>æ•°æ®æŒä¹…åŒ–é—®é¢˜ã€‚</li></ol><h4 id="å†…å­˜è¡¨çš„é”" tabindex="-1"><a class="header-anchor" href="#å†…å­˜è¡¨çš„é”" aria-hidden="true">#</a> å†…å­˜è¡¨çš„é”</h4><p>æˆ‘ä»¬å…ˆæ¥è¯´è¯´å†…å­˜è¡¨çš„é”ç²’åº¦é—®é¢˜ã€‚</p><p>å†…å­˜è¡¨ä¸æ”¯æŒè¡Œé”ï¼Œåªæ”¯æŒè¡¨é”ã€‚å› æ­¤ï¼Œä¸€å¼ è¡¨åªè¦æœ‰æ›´æ–°ï¼Œå°±ä¼šå µä½å…¶ä»–æ‰€æœ‰åœ¨è¿™ä¸ªè¡¨ä¸Šçš„è¯»å†™æ“ä½œã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œçš„è¡¨é”è·Ÿä¹‹å‰æˆ‘ä»¬ä»‹ç»è¿‡çš„ MDL é”ä¸åŒï¼Œä½†éƒ½æ˜¯è¡¨çº§çš„é”ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘é€šè¿‡ä¸‹é¢è¿™ä¸ªåœºæ™¯ï¼Œè·Ÿä½ æ¨¡æ‹Ÿä¸€ä¸‹å†…å­˜è¡¨çš„è¡¨çº§é”ã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/f216e2d707559ed2ca98fbe21e509f29-1584367406948.png" alt="img"></p><p>å›¾ 6 å†…å­˜è¡¨çš„è¡¨é” -- å¤ç°æ­¥éª¤</p><p>åœ¨è¿™ä¸ªæ‰§è¡Œåºåˆ—é‡Œï¼Œsession A çš„ update è¯­å¥è¦æ‰§è¡Œ 50 ç§’ï¼Œåœ¨è¿™ä¸ªè¯­å¥æ‰§è¡ŒæœŸé—´ session B çš„æŸ¥è¯¢ä¼šè¿›å…¥é”ç­‰å¾…çŠ¶æ€ã€‚session C çš„ show processlist ç»“æœè¾“å‡ºå¦‚ä¸‹ï¼š</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/14d88076dad6db573f0b66f2c17df916-1584367406948.png" alt="img"></p><p>å›¾ 7 å†…å­˜è¡¨çš„è¡¨é” -- ç»“æœ</p><p>è·Ÿè¡Œé”æ¯”èµ·æ¥ï¼Œè¡¨é”å¯¹å¹¶å‘è®¿é—®çš„æ”¯æŒä¸å¤Ÿå¥½ã€‚æ‰€ä»¥ï¼Œå†…å­˜è¡¨çš„é”ç²’åº¦é—®é¢˜ï¼Œå†³å®šäº†å®ƒåœ¨å¤„ç†å¹¶å‘äº‹åŠ¡çš„æ—¶å€™ï¼Œæ€§èƒ½ä¹Ÿä¸ä¼šå¤ªå¥½ã€‚</p><h4 id="æ•°æ®æŒä¹…æ€§é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#æ•°æ®æŒä¹…æ€§é—®é¢˜" aria-hidden="true">#</a> æ•°æ®æŒä¹…æ€§é—®é¢˜</h4><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†çœ‹çœ‹æ•°æ®æŒä¹…æ€§çš„é—®é¢˜ã€‚</p><p>æ•°æ®æ”¾åœ¨å†…å­˜ä¸­ï¼Œæ˜¯å†…å­˜è¡¨çš„ä¼˜åŠ¿ï¼Œä½†ä¹Ÿæ˜¯ä¸€ä¸ªåŠ£åŠ¿ã€‚å› ä¸ºï¼Œæ•°æ®åº“é‡å¯çš„æ—¶å€™ï¼Œæ‰€æœ‰çš„å†…å­˜è¡¨éƒ½ä¼šè¢«æ¸…ç©ºã€‚</p><p>ä½ å¯èƒ½ä¼šè¯´ï¼Œå¦‚æœæ•°æ®åº“å¼‚å¸¸é‡å¯ï¼Œå†…å­˜è¡¨è¢«æ¸…ç©ºä¹Ÿå°±æ¸…ç©ºäº†ï¼Œä¸ä¼šæœ‰ä»€ä¹ˆé—®é¢˜å•Šã€‚ä½†æ˜¯ï¼Œåœ¨é«˜å¯ç”¨æ¶æ„ä¸‹ï¼Œå†…å­˜è¡¨çš„è¿™ä¸ªç‰¹ç‚¹ç®€ç›´å¯ä»¥å½“åš bug æ¥çœ‹å¾…äº†ã€‚ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Ÿ</p><p><strong>æˆ‘ä»¬å…ˆçœ‹çœ‹ M-S æ¶æ„ä¸‹ï¼Œä½¿ç”¨å†…å­˜è¡¨å­˜åœ¨çš„é—®é¢˜ã€‚</strong></p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/5b910e4c0f1afa219aeecd1f291c95e9-1584367406948.jpg" alt="img"></p><p>å›¾ 8 M-S åŸºæœ¬æ¶æ„</p><p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ä¸‹é¢è¿™ä¸ªæ—¶åºï¼š</p><ol><li>ä¸šåŠ¡æ­£å¸¸è®¿é—®ä¸»åº“ï¼›</li><li>å¤‡åº“ç¡¬ä»¶å‡çº§ï¼Œå¤‡åº“é‡å¯ï¼Œå†…å­˜è¡¨ t1 å†…å®¹è¢«æ¸…ç©ºï¼›</li><li>å¤‡åº“é‡å¯åï¼Œå®¢æˆ·ç«¯å‘é€ä¸€æ¡ update è¯­å¥ï¼Œä¿®æ”¹è¡¨ t1 çš„æ•°æ®è¡Œï¼Œè¿™æ—¶å¤‡åº“åº”ç”¨çº¿ç¨‹å°±ä¼šæŠ¥é”™â€œæ‰¾ä¸åˆ°è¦æ›´æ–°çš„è¡Œâ€ã€‚</li></ol><p>è¿™æ ·å°±ä¼šå¯¼è‡´ä¸»å¤‡åŒæ­¥åœæ­¢ã€‚å½“ç„¶ï¼Œå¦‚æœè¿™æ—¶å€™å‘ç”Ÿä¸»å¤‡åˆ‡æ¢çš„è¯ï¼Œå®¢æˆ·ç«¯ä¼šçœ‹åˆ°ï¼Œè¡¨ t1 çš„æ•°æ®â€œä¸¢å¤±â€äº†ã€‚</p><p>åœ¨å›¾ 8 ä¸­è¿™ç§æœ‰ proxy çš„æ¶æ„é‡Œï¼Œå¤§å®¶é»˜è®¤ä¸»å¤‡åˆ‡æ¢çš„é€»è¾‘æ˜¯ç”±æ•°æ®åº“ç³»ç»Ÿè‡ªå·±ç»´æŠ¤çš„ã€‚è¿™æ ·å¯¹å®¢æˆ·ç«¯æ¥è¯´ï¼Œå°±æ˜¯â€œç½‘ç»œæ–­å¼€ï¼Œé‡è¿ä¹‹åï¼Œå‘ç°å†…å­˜è¡¨æ•°æ®ä¸¢å¤±äº†â€ã€‚</p><p>ä½ å¯èƒ½è¯´è¿™è¿˜å¥½å•Šï¼Œæ¯•ç«Ÿä¸»å¤‡å‘ç”Ÿåˆ‡æ¢ï¼Œè¿æ¥ä¼šæ–­å¼€ï¼Œä¸šåŠ¡ç«¯èƒ½å¤Ÿæ„ŸçŸ¥åˆ°å¼‚å¸¸ã€‚</p><p>ä½†æ˜¯ï¼Œæ¥ä¸‹æ¥å†…å­˜è¡¨çš„è¿™ä¸ªç‰¹æ€§å°±ä¼šè®©ä½¿ç”¨ç°è±¡æ˜¾å¾—æ›´â€œè¯¡å¼‚â€äº†ã€‚ç”±äº MySQL çŸ¥é“é‡å¯ä¹‹åï¼Œå†…å­˜è¡¨çš„æ•°æ®ä¼šä¸¢å¤±ã€‚æ‰€ä»¥ï¼Œæ‹…å¿ƒä¸»åº“é‡å¯ä¹‹åï¼Œå‡ºç°ä¸»å¤‡ä¸ä¸€è‡´ï¼ŒMySQL åœ¨å®ç°ä¸Šåšäº†è¿™æ ·ä¸€ä»¶äº‹å„¿ï¼šåœ¨æ•°æ®åº“é‡å¯ä¹‹åï¼Œå¾€ binlog é‡Œé¢å†™å…¥ä¸€è¡Œ DELETE FROM t1ã€‚</p><p><strong>å¦‚æœä½ ä½¿ç”¨æ˜¯å¦‚å›¾ 9 æ‰€ç¤ºçš„åŒ M ç»“æ„çš„è¯ï¼š</strong></p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/4089c9c1f92ce61d2ed779fd0932ba57-1584367406948.jpg" alt="img"></p><p>å›¾ 9 åŒ M ç»“æ„</p><p>åœ¨å¤‡åº“é‡å¯çš„æ—¶å€™ï¼Œå¤‡åº“ binlog é‡Œçš„ delete è¯­å¥å°±ä¼šä¼ åˆ°ä¸»åº“ï¼Œç„¶åæŠŠä¸»åº“å†…å­˜è¡¨çš„å†…å®¹åˆ é™¤ã€‚è¿™æ ·ä½ åœ¨ä½¿ç”¨çš„æ—¶å€™å°±ä¼šå‘ç°ï¼Œä¸»åº“çš„å†…å­˜è¡¨æ•°æ®çªç„¶è¢«æ¸…ç©ºäº†ã€‚</p><p>åŸºäºä¸Šé¢çš„åˆ†æï¼Œä½ å¯ä»¥çœ‹åˆ°ï¼Œå†…å­˜è¡¨å¹¶ä¸é€‚åˆåœ¨ç”Ÿäº§ç¯å¢ƒä¸Šä½œä¸ºæ™®é€šæ•°æ®è¡¨ä½¿ç”¨ã€‚</p><p>æœ‰åŒå­¦ä¼šè¯´ï¼Œä½†æ˜¯å†…å­˜è¡¨æ‰§è¡Œé€Ÿåº¦å¿«å‘€ã€‚è¿™ä¸ªé—®é¢˜ï¼Œå…¶å®ä½ å¯ä»¥è¿™ä¹ˆåˆ†æï¼š</p><ol><li>å¦‚æœä½ çš„è¡¨æ›´æ–°é‡å¤§ï¼Œé‚£ä¹ˆå¹¶å‘åº¦æ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„å‚è€ƒæŒ‡æ ‡ï¼ŒInnoDB æ”¯æŒè¡Œé”ï¼Œå¹¶å‘åº¦æ¯”å†…å­˜è¡¨å¥½ï¼›</li><li>èƒ½æ”¾åˆ°å†…å­˜è¡¨çš„æ•°æ®é‡éƒ½ä¸å¤§ã€‚å¦‚æœä½ è€ƒè™‘çš„æ˜¯è¯»çš„æ€§èƒ½ï¼Œä¸€ä¸ªè¯» QPS å¾ˆé«˜å¹¶ä¸”æ•°æ®é‡ä¸å¤§çš„è¡¨ï¼Œå³ä½¿æ˜¯ä½¿ç”¨ InnoDBï¼Œæ•°æ®ä¹Ÿæ˜¯éƒ½ä¼šç¼“å­˜åœ¨ InnoDB Buffer Pool é‡Œçš„ã€‚å› æ­¤ï¼Œä½¿ç”¨ InnoDB è¡¨çš„è¯»æ€§èƒ½ä¹Ÿä¸ä¼šå·®ã€‚</li></ol><p>æ‰€ä»¥ï¼Œ**æˆ‘å»ºè®®ä½ æŠŠæ™®é€šå†…å­˜è¡¨éƒ½ç”¨ InnoDB è¡¨æ¥ä»£æ›¿ã€‚**ä½†æ˜¯ï¼Œæœ‰ä¸€ä¸ªåœºæ™¯å´æ˜¯ä¾‹å¤–çš„ã€‚</p><p>è¿™ä¸ªåœºæ™¯å°±æ˜¯ï¼Œæˆ‘ä»¬åœ¨ç¬¬ 35 å’Œ 36 ç¯‡è¯´åˆ°çš„ç”¨æˆ·ä¸´æ—¶è¡¨ã€‚åœ¨æ•°æ®é‡å¯æ§ï¼Œä¸ä¼šè€—è´¹è¿‡å¤šå†…å­˜çš„æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥è€ƒè™‘ä½¿ç”¨å†…å­˜è¡¨ã€‚</p><p>å†…å­˜ä¸´æ—¶è¡¨åˆšå¥½å¯ä»¥æ— è§†å†…å­˜è¡¨çš„ä¸¤ä¸ªä¸è¶³ï¼Œä¸»è¦æ˜¯ä¸‹é¢çš„ä¸‰ä¸ªåŸå› ï¼š</p><ol><li>ä¸´æ—¶è¡¨ä¸ä¼šè¢«å…¶ä»–çº¿ç¨‹è®¿é—®ï¼Œæ²¡æœ‰å¹¶å‘æ€§çš„é—®é¢˜ï¼›</li><li>ä¸´æ—¶è¡¨é‡å¯åä¹Ÿæ˜¯éœ€è¦åˆ é™¤çš„ï¼Œæ¸…ç©ºæ•°æ®è¿™ä¸ªé—®é¢˜ä¸å­˜åœ¨ï¼›</li><li>å¤‡åº“çš„ä¸´æ—¶è¡¨ä¹Ÿä¸ä¼šå½±å“ä¸»åº“çš„ç”¨æˆ·çº¿ç¨‹ã€‚</li></ol><p>ç°åœ¨ï¼Œæˆ‘ä»¬å›è¿‡å¤´å†çœ‹ä¸€ä¸‹ç¬¬ 35 ç¯‡ join è¯­å¥ä¼˜åŒ–çš„ä¾‹å­ï¼Œå½“æ—¶æˆ‘å»ºè®®çš„æ˜¯åˆ›å»ºä¸€ä¸ª InnoDB ä¸´æ—¶è¡¨ï¼Œä½¿ç”¨çš„è¯­å¥åºåˆ—æ˜¯ï¼š</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">temporary</span> <span class="token keyword">table</span> temp_t<span class="token punctuation">(</span>id <span class="token keyword">int</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span> a <span class="token keyword">int</span><span class="token punctuation">,</span> b <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">index</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">engine</span><span class="token operator">=</span><span class="token keyword">innodb</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> temp_t <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t2 <span class="token keyword">where</span> b<span class="token operator">&gt;=</span><span class="token number">1</span> <span class="token operator">and</span> b<span class="token operator">&lt;=</span><span class="token number">2000</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t1 <span class="token keyword">join</span> temp_t <span class="token keyword">on</span> <span class="token punctuation">(</span>t1<span class="token punctuation">.</span>b<span class="token operator">=</span>temp_t<span class="token punctuation">.</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>äº†è§£äº†å†…å­˜è¡¨çš„ç‰¹æ€§ï¼Œä½ å°±çŸ¥é“äº†ï¼Œ å…¶å®è¿™é‡Œä½¿ç”¨å†…å­˜ä¸´æ—¶è¡¨çš„æ•ˆæœæ›´å¥½ï¼ŒåŸå› æœ‰ä¸‰ä¸ªï¼š</p><ol><li>ç›¸æ¯”äº InnoDB è¡¨ï¼Œä½¿ç”¨å†…å­˜è¡¨ä¸éœ€è¦å†™ç£ç›˜ï¼Œå¾€è¡¨ temp_t çš„å†™æ•°æ®çš„é€Ÿåº¦æ›´å¿«ï¼›</li><li>ç´¢å¼• b ä½¿ç”¨ hash ç´¢å¼•ï¼ŒæŸ¥æ‰¾çš„é€Ÿåº¦æ¯” B-Tree ç´¢å¼•å¿«ï¼›</li><li>ä¸´æ—¶è¡¨æ•°æ®åªæœ‰ 2000 è¡Œï¼Œå ç”¨çš„å†…å­˜æœ‰é™ã€‚</li></ol><p>å› æ­¤ï¼Œä½ å¯ä»¥å¯¹[ç¬¬ 35 ç¯‡æ–‡ç« ]çš„è¯­å¥åºåˆ—åšä¸€ä¸ªæ”¹å†™ï¼Œå°†ä¸´æ—¶è¡¨ t1 æ”¹æˆå†…å­˜ä¸´æ—¶è¡¨ï¼Œå¹¶ä¸”åœ¨å­—æ®µ b ä¸Šåˆ›å»ºä¸€ä¸ª hash ç´¢å¼•ã€‚</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">temporary</span> <span class="token keyword">table</span> temp_t<span class="token punctuation">(</span>id <span class="token keyword">int</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span> a <span class="token keyword">int</span><span class="token punctuation">,</span> b <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">index</span> <span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">engine</span><span class="token operator">=</span>memory<span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> temp_t <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t2 <span class="token keyword">where</span> b<span class="token operator">&gt;=</span><span class="token number">1</span> <span class="token operator">and</span> b<span class="token operator">&lt;=</span><span class="token number">2000</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t1 <span class="token keyword">join</span> temp_t <span class="token keyword">on</span> <span class="token punctuation">(</span>t1<span class="token punctuation">.</span>b<span class="token operator">=</span>temp_t<span class="token punctuation">.</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/a468ba6d14ea225623074b6255b99f92-1584367406948.png" alt="img"></p><p>å›¾ 10 ä½¿ç”¨å†…å­˜ä¸´æ—¶è¡¨çš„æ‰§è¡Œæ•ˆæœ</p><p>å¯ä»¥çœ‹åˆ°ï¼Œä¸è®ºæ˜¯å¯¼å…¥æ•°æ®çš„æ—¶é—´ï¼Œè¿˜æ˜¯æ‰§è¡Œ join çš„æ—¶é—´ï¼Œä½¿ç”¨å†…å­˜ä¸´æ—¶è¡¨çš„é€Ÿåº¦éƒ½æ¯”ä½¿ç”¨ InnoDB ä¸´æ—¶è¡¨è¦æ›´å¿«ä¸€äº›ã€‚</p><h4 id="å°ç»“-23" tabindex="-1"><a class="header-anchor" href="#å°ç»“-23" aria-hidden="true">#</a> å°ç»“</h4><p>ä»Šå¤©è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ä»â€œè¦ä¸è¦ä½¿ç”¨å†…å­˜è¡¨â€è¿™ä¸ªé—®é¢˜å±•å¼€ï¼Œå’Œä½ ä»‹ç»äº† Memory å¼•æ“çš„å‡ ä¸ªç‰¹æ€§ã€‚</p><p>å¯ä»¥çœ‹åˆ°ï¼Œç”±äºé‡å¯ä¼šä¸¢æ•°æ®ï¼Œå¦‚æœä¸€ä¸ªå¤‡åº“é‡å¯ï¼Œä¼šå¯¼è‡´ä¸»å¤‡åŒæ­¥çº¿ç¨‹åœæ­¢ï¼›å¦‚æœä¸»åº“è·Ÿè¿™ä¸ªå¤‡åº“æ˜¯åŒ M æ¶æ„ï¼Œè¿˜å¯èƒ½å¯¼è‡´ä¸»åº“çš„å†…å­˜è¡¨æ•°æ®è¢«åˆ æ‰ã€‚</p><p>å› æ­¤ï¼Œåœ¨ç”Ÿäº§ä¸Šï¼Œæˆ‘ä¸å»ºè®®ä½ ä½¿ç”¨æ™®é€šå†…å­˜è¡¨ã€‚</p><p>å¦‚æœä½ æ˜¯ DBAï¼Œå¯ä»¥åœ¨å»ºè¡¨çš„å®¡æ ¸ç³»ç»Ÿä¸­å¢åŠ è¿™ç±»è§„åˆ™ï¼Œè¦æ±‚ä¸šåŠ¡æ”¹ç”¨ InnoDB è¡¨ã€‚æˆ‘ä»¬åœ¨æ–‡ä¸­ä¹Ÿåˆ†æäº†ï¼Œå…¶å® InnoDB è¡¨æ€§èƒ½è¿˜ä¸é”™ï¼Œè€Œä¸”æ•°æ®å®‰å…¨ä¹Ÿæœ‰ä¿éšœã€‚è€Œå†…å­˜è¡¨ç”±äºä¸æ”¯æŒè¡Œé”ï¼Œæ›´æ–°è¯­å¥ä¼šé˜»å¡æŸ¥è¯¢ï¼Œæ€§èƒ½ä¹Ÿæœªå¿…å°±å¦‚æƒ³è±¡ä¸­é‚£ä¹ˆå¥½ã€‚</p><p>åŸºäºå†…å­˜è¡¨çš„ç‰¹æ€§ï¼Œæˆ‘ä»¬è¿˜åˆ†æäº†å®ƒçš„ä¸€ä¸ªé€‚ç”¨åœºæ™¯ï¼Œå°±æ˜¯å†…å­˜ä¸´æ—¶è¡¨ã€‚å†…å­˜è¡¨æ”¯æŒ hash ç´¢å¼•ï¼Œè¿™ä¸ªç‰¹æ€§åˆ©ç”¨èµ·æ¥ï¼Œå¯¹å¤æ‚æŸ¥è¯¢çš„åŠ é€Ÿæ•ˆæœè¿˜æ˜¯å¾ˆä¸é”™çš„ã€‚</p><p>æœ€åï¼Œæˆ‘ç»™ä½ ç•™ä¸€ä¸ªé—®é¢˜å§ã€‚</p><p>å‡è®¾ä½ åˆšåˆšæ¥æ‰‹çš„ä¸€ä¸ªæ•°æ®åº“ä¸Šï¼ŒçœŸçš„å‘ç°äº†ä¸€ä¸ªå†…å­˜è¡¨ã€‚å¤‡åº“é‡å¯ä¹‹åè‚¯å®šæ˜¯ä¼šå¯¼è‡´å¤‡åº“çš„å†…å­˜è¡¨æ•°æ®è¢«æ¸…ç©ºï¼Œè¿›è€Œå¯¼è‡´ä¸»å¤‡åŒæ­¥åœæ­¢ã€‚è¿™æ—¶ï¼Œæœ€å¥½çš„åšæ³•æ˜¯å°†å®ƒä¿®æ”¹æˆ InnoDB å¼•æ“è¡¨ã€‚</p><p>å‡è®¾å½“æ—¶çš„ä¸šåŠ¡åœºæ™¯æš‚æ—¶ä¸å…è®¸ä½ ä¿®æ”¹å¼•æ“ï¼Œä½ å¯ä»¥åŠ ä¸Šä»€ä¹ˆè‡ªåŠ¨åŒ–é€»è¾‘ï¼Œæ¥é¿å…ä¸»å¤‡åŒæ­¥åœæ­¢å‘¢ï¼Ÿ</p><p>ä½ å¯ä»¥æŠŠä½ çš„æ€è€ƒå’Œåˆ†æå†™åœ¨è¯„è®ºåŒºï¼Œæˆ‘ä¼šåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« çš„æœ«å°¾è·Ÿä½ è®¨è®ºè¿™ä¸ªé—®é¢˜ã€‚æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚</p><h4 id="ä¸ŠæœŸé—®é¢˜æ—¶é—´-20" tabindex="-1"><a class="header-anchor" href="#ä¸ŠæœŸé—®é¢˜æ—¶é—´-20" aria-hidden="true">#</a> ä¸ŠæœŸé—®é¢˜æ—¶é—´</h4><p>ä»Šå¤©æ–‡ç« çš„æ­£æ–‡å†…å®¹ï¼Œå·²ç»å›ç­”äº†æˆ‘ä»¬ä¸ŠæœŸçš„é—®é¢˜ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°äº†ã€‚</p><p>è¯„è®ºåŒºç•™è¨€ç‚¹èµæ¿ï¼š</p><blockquote><p>@è€æ¨åŒå¿—ã€@poppyã€@é•¿æ° è¿™ä¸‰ä½åŒå­¦ç»™å‡ºäº†æ­£ç¡®ç­”æ¡ˆï¼Œæ˜¥èŠ‚æœŸé—´è¿˜æŒç»­ä¿æŒè·Ÿè¿›å­¦ä¹ ï¼Œç»™ä½ ä»¬ç‚¹èµã€‚</p></blockquote><h3 id="_39-è‡ªå¢ä¸»é”®ä¸ºä»€ä¹ˆä¸æ˜¯è¿ç»­çš„" tabindex="-1"><a class="header-anchor" href="#_39-è‡ªå¢ä¸»é”®ä¸ºä»€ä¹ˆä¸æ˜¯è¿ç»­çš„" aria-hidden="true">#</a> 39 è‡ªå¢ä¸»é”®ä¸ºä»€ä¹ˆä¸æ˜¯è¿ç»­çš„ï¼Ÿ</h3><p>åœ¨[ç¬¬ 4 ç¯‡æ–‡ç« ]ä¸­ï¼Œæˆ‘ä»¬æåˆ°è¿‡è‡ªå¢ä¸»é”®ï¼Œç”±äºè‡ªå¢ä¸»é”®å¯ä»¥è®©ä¸»é”®ç´¢å¼•å°½é‡åœ°ä¿æŒé€’å¢é¡ºåºæ’å…¥ï¼Œé¿å…äº†é¡µåˆ†è£‚ï¼Œå› æ­¤ç´¢å¼•æ›´ç´§å‡‘ã€‚</p><p>ä¹‹å‰æˆ‘è§è¿‡æœ‰çš„ä¸šåŠ¡è®¾è®¡ä¾èµ–äºè‡ªå¢ä¸»é”®çš„è¿ç»­æ€§ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªè®¾è®¡å‡è®¾è‡ªå¢ä¸»é”®æ˜¯è¿ç»­çš„ã€‚ä½†å®é™…ä¸Šï¼Œè¿™æ ·çš„å‡è®¾æ˜¯é”™çš„ï¼Œå› ä¸ºè‡ªå¢ä¸»é”®ä¸èƒ½ä¿è¯è¿ç»­é€’å¢ã€‚</p><p>ä»Šå¤©è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬å°±æ¥è¯´è¯´è¿™ä¸ªé—®é¢˜ï¼Œçœ‹çœ‹ä»€ä¹ˆæƒ…å†µä¸‹è‡ªå¢ä¸»é”®ä¼šå‡ºç° â€œç©ºæ´â€ï¼Ÿ</p><p>ä¸ºäº†ä¾¿äºè¯´æ˜ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªè¡¨ tï¼Œå…¶ä¸­ id æ˜¯è‡ªå¢ä¸»é”®å­—æ®µã€c æ˜¯å”¯ä¸€ç´¢å¼•ã€‚</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>t<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>c<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>d<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">UNIQUE</span> <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>c<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>c<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="è‡ªå¢å€¼ä¿å­˜åœ¨å“ªå„¿" tabindex="-1"><a class="header-anchor" href="#è‡ªå¢å€¼ä¿å­˜åœ¨å“ªå„¿" aria-hidden="true">#</a> è‡ªå¢å€¼ä¿å­˜åœ¨å“ªå„¿ï¼Ÿ</h4><p>åœ¨è¿™ä¸ªç©ºè¡¨ t é‡Œé¢æ‰§è¡Œ insert into t values(null, 1, 1); æ’å…¥ä¸€è¡Œæ•°æ®ï¼Œå†æ‰§è¡Œ show create table å‘½ä»¤ï¼Œå°±å¯ä»¥çœ‹åˆ°å¦‚ä¸‹å›¾æ‰€ç¤ºçš„ç»“æœï¼š</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/cb2637cada0201b18650f56875e94fff-1584367406950.png" alt="img"></p><p>å›¾ 1 è‡ªåŠ¨ç”Ÿæˆçš„ AUTO_INCREMENT å€¼</p><p>å¯ä»¥çœ‹åˆ°ï¼Œè¡¨å®šä¹‰é‡Œé¢å‡ºç°äº†ä¸€ä¸ª AUTO_INCREMENT=2ï¼Œè¡¨ç¤ºä¸‹ä¸€æ¬¡æ’å…¥æ•°æ®æ—¶ï¼Œå¦‚æœéœ€è¦è‡ªåŠ¨ç”Ÿæˆè‡ªå¢å€¼ï¼Œä¼šç”Ÿæˆ id=2ã€‚</p><p>å…¶å®ï¼Œè¿™ä¸ªè¾“å‡ºç»“æœå®¹æ˜“å¼•èµ·è¿™æ ·çš„è¯¯è§£ï¼šè‡ªå¢å€¼æ˜¯ä¿å­˜åœ¨è¡¨ç»“æ„å®šä¹‰é‡Œçš„ã€‚å®é™…ä¸Šï¼Œ<strong>è¡¨çš„ç»“æ„å®šä¹‰å­˜æ”¾åœ¨åç¼€åä¸º.frm çš„æ–‡ä»¶ä¸­ï¼Œä½†æ˜¯å¹¶ä¸ä¼šä¿å­˜è‡ªå¢å€¼ã€‚</strong></p><p>ä¸åŒçš„å¼•æ“å¯¹äºè‡ªå¢å€¼çš„ä¿å­˜ç­–ç•¥ä¸åŒã€‚</p><ul><li>MyISAM å¼•æ“çš„è‡ªå¢å€¼ä¿å­˜åœ¨æ•°æ®æ–‡ä»¶ä¸­ã€‚</li><li>InnoDB å¼•æ“çš„è‡ªå¢å€¼ï¼Œå…¶å®æ˜¯ä¿å­˜åœ¨äº†å†…å­˜é‡Œï¼Œå¹¶ä¸”åˆ°äº† MySQL 8.0 ç‰ˆæœ¬åï¼Œæ‰æœ‰äº†â€œè‡ªå¢å€¼æŒä¹…åŒ–â€çš„èƒ½åŠ›ï¼Œä¹Ÿå°±æ˜¯æ‰å®ç°äº†â€œå¦‚æœå‘ç”Ÿé‡å¯ï¼Œè¡¨çš„è‡ªå¢å€¼å¯ä»¥æ¢å¤ä¸º MySQL é‡å¯å‰çš„å€¼â€ï¼Œå…·ä½“æƒ…å†µæ˜¯ï¼š <ul><li>åœ¨ MySQL 5.7 åŠä¹‹å‰çš„ç‰ˆæœ¬ï¼Œè‡ªå¢å€¼ä¿å­˜åœ¨å†…å­˜é‡Œï¼Œå¹¶æ²¡æœ‰æŒä¹…åŒ–ã€‚æ¯æ¬¡é‡å¯åï¼Œç¬¬ä¸€æ¬¡æ‰“å¼€è¡¨çš„æ—¶å€™ï¼Œéƒ½ä¼šå»æ‰¾è‡ªå¢å€¼çš„æœ€å¤§å€¼ max(id)ï¼Œç„¶åå°† max(id)+1 ä½œä¸ºè¿™ä¸ªè¡¨å½“å‰çš„è‡ªå¢å€¼ã€‚ï»¿ ä¸¾ä¾‹æ¥è¯´ï¼Œå¦‚æœä¸€ä¸ªè¡¨å½“å‰æ•°æ®è¡Œé‡Œæœ€å¤§çš„ id æ˜¯ 10ï¼ŒAUTO_INCREMENT=11ã€‚è¿™æ—¶å€™ï¼Œæˆ‘ä»¬åˆ é™¤ id=10 çš„è¡Œï¼ŒAUTO_INCREMENT è¿˜æ˜¯ 11ã€‚ä½†å¦‚æœé©¬ä¸Šé‡å¯å®ä¾‹ï¼Œé‡å¯åè¿™ä¸ªè¡¨çš„ AUTO_INCREMENT å°±ä¼šå˜æˆ 10ã€‚ï»¿ ä¹Ÿå°±æ˜¯è¯´ï¼ŒMySQL é‡å¯å¯èƒ½ä¼šä¿®æ”¹ä¸€ä¸ªè¡¨çš„ AUTO_INCREMENT çš„å€¼ã€‚</li><li>åœ¨ MySQL 8.0 ç‰ˆæœ¬ï¼Œå°†è‡ªå¢å€¼çš„å˜æ›´è®°å½•åœ¨äº† redo log ä¸­ï¼Œé‡å¯çš„æ—¶å€™ä¾é  redo log æ¢å¤é‡å¯ä¹‹å‰çš„å€¼ã€‚</li></ul></li></ul><p>ç†è§£äº† MySQL å¯¹è‡ªå¢å€¼çš„ä¿å­˜ç­–ç•¥ä»¥åï¼Œæˆ‘ä»¬å†çœ‹çœ‹è‡ªå¢å€¼ä¿®æ”¹æœºåˆ¶ã€‚</p><h4 id="è‡ªå¢å€¼ä¿®æ”¹æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#è‡ªå¢å€¼ä¿®æ”¹æœºåˆ¶" aria-hidden="true">#</a> è‡ªå¢å€¼ä¿®æ”¹æœºåˆ¶</h4><p>åœ¨ MySQL é‡Œé¢ï¼Œå¦‚æœå­—æ®µ id è¢«å®šä¹‰ä¸º AUTO_INCREMENTï¼Œåœ¨æ’å…¥ä¸€è¡Œæ•°æ®çš„æ—¶å€™ï¼Œè‡ªå¢å€¼çš„è¡Œä¸ºå¦‚ä¸‹ï¼š</p><ol><li>å¦‚æœæ’å…¥æ•°æ®æ—¶ id å­—æ®µæŒ‡å®šä¸º 0ã€null æˆ–æœªæŒ‡å®šå€¼ï¼Œé‚£ä¹ˆå°±æŠŠè¿™ä¸ªè¡¨å½“å‰çš„ AUTO_INCREMENT å€¼å¡«åˆ°è‡ªå¢å­—æ®µï¼›</li><li>å¦‚æœæ’å…¥æ•°æ®æ—¶ id å­—æ®µæŒ‡å®šäº†å…·ä½“çš„å€¼ï¼Œå°±ç›´æ¥ä½¿ç”¨è¯­å¥é‡ŒæŒ‡å®šçš„å€¼ã€‚</li></ol><p>æ ¹æ®è¦æ’å…¥çš„å€¼å’Œå½“å‰è‡ªå¢å€¼çš„å¤§å°å…³ç³»ï¼Œè‡ªå¢å€¼çš„å˜æ›´ç»“æœä¹Ÿä¼šæœ‰æ‰€ä¸åŒã€‚å‡è®¾ï¼ŒæŸæ¬¡è¦æ’å…¥çš„å€¼æ˜¯ Xï¼Œå½“å‰çš„è‡ªå¢å€¼æ˜¯ Yã€‚</p><ol><li>å¦‚æœ X&lt;Yï¼Œé‚£ä¹ˆè¿™ä¸ªè¡¨çš„è‡ªå¢å€¼ä¸å˜ï¼›</li><li>å¦‚æœ Xâ‰¥Yï¼Œå°±éœ€è¦æŠŠå½“å‰è‡ªå¢å€¼ä¿®æ”¹ä¸ºæ–°çš„è‡ªå¢å€¼ã€‚</li></ol><p><strong>æ–°çš„è‡ªå¢å€¼ç”Ÿæˆç®—æ³•æ˜¯</strong>ï¼šä» auto_increment_offset å¼€å§‹ï¼Œä»¥ auto_increment_increment ä¸ºæ­¥é•¿ï¼ŒæŒç»­å åŠ ï¼Œç›´åˆ°æ‰¾åˆ°ç¬¬ä¸€ä¸ªå¤§äº X çš„å€¼ï¼Œä½œä¸ºæ–°çš„è‡ªå¢å€¼ã€‚</p><p>å…¶ä¸­ï¼Œauto_increment_offset å’Œ auto_increment_increment æ˜¯ä¸¤ä¸ªç³»ç»Ÿå‚æ•°ï¼Œåˆ†åˆ«ç”¨æ¥è¡¨ç¤ºè‡ªå¢çš„åˆå§‹å€¼å’Œæ­¥é•¿ï¼Œé»˜è®¤å€¼éƒ½æ˜¯ 1ã€‚</p><blockquote><p>å¤‡æ³¨ï¼šåœ¨ä¸€äº›åœºæ™¯ä¸‹ï¼Œä½¿ç”¨çš„å°±ä¸å…¨æ˜¯é»˜è®¤å€¼ã€‚æ¯”å¦‚ï¼ŒåŒ M çš„ä¸»å¤‡ç»“æ„é‡Œè¦æ±‚åŒå†™çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯èƒ½ä¼šè®¾ç½®æˆ auto_increment_increment=2ï¼Œè®©ä¸€ä¸ªåº“çš„è‡ªå¢ id éƒ½æ˜¯å¥‡æ•°ï¼Œå¦ä¸€ä¸ªåº“çš„è‡ªå¢ id éƒ½æ˜¯å¶æ•°ï¼Œé¿å…ä¸¤ä¸ªåº“ç”Ÿæˆçš„ä¸»é”®å‘ç”Ÿå†²çªã€‚</p></blockquote><p>å½“ auto_increment_offset å’Œ auto_increment_increment éƒ½æ˜¯ 1 çš„æ—¶å€™ï¼Œæ–°çš„è‡ªå¢å€¼ç”Ÿæˆé€»è¾‘å¾ˆç®€å•ï¼Œå°±æ˜¯ï¼š</p><ol><li>å¦‚æœå‡†å¤‡æ’å…¥çš„å€¼ &gt;= å½“å‰è‡ªå¢å€¼ï¼Œæ–°çš„è‡ªå¢å€¼å°±æ˜¯â€œå‡†å¤‡æ’å…¥çš„å€¼ +1â€ï¼›</li><li>å¦åˆ™ï¼Œè‡ªå¢å€¼ä¸å˜ã€‚</li></ol><p>è¿™å°±å¼•å…¥äº†æˆ‘ä»¬æ–‡ç« å¼€å¤´æåˆ°çš„é—®é¢˜ï¼Œåœ¨è¿™ä¸¤ä¸ªå‚æ•°éƒ½è®¾ç½®ä¸º 1 çš„æ—¶å€™ï¼Œè‡ªå¢ä¸»é”® id å´ä¸èƒ½ä¿è¯æ˜¯è¿ç»­çš„ï¼Œè¿™æ˜¯ä»€ä¹ˆåŸå› å‘¢ï¼Ÿ</p><h4 id="è‡ªå¢å€¼çš„ä¿®æ”¹æ—¶æœº" tabindex="-1"><a class="header-anchor" href="#è‡ªå¢å€¼çš„ä¿®æ”¹æ—¶æœº" aria-hidden="true">#</a> è‡ªå¢å€¼çš„ä¿®æ”¹æ—¶æœº</h4><p>è¦å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å°±è¦çœ‹ä¸€ä¸‹è‡ªå¢å€¼çš„ä¿®æ”¹æ—¶æœºã€‚</p><p>å‡è®¾ï¼Œè¡¨ t é‡Œé¢å·²ç»æœ‰äº† (1,1,1) è¿™æ¡è®°å½•ï¼Œè¿™æ—¶æˆ‘å†æ‰§è¡Œä¸€æ¡æ’å…¥æ•°æ®å‘½ä»¤ï¼š</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">insert</span> <span class="token keyword">into</span> t <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>è¿™ä¸ªè¯­å¥çš„æ‰§è¡Œæµç¨‹å°±æ˜¯ï¼š</p><ol><li>æ‰§è¡Œå™¨è°ƒç”¨ InnoDB å¼•æ“æ¥å£å†™å…¥ä¸€è¡Œï¼Œä¼ å…¥çš„è¿™ä¸€è¡Œçš„å€¼æ˜¯ (0,1,1);</li><li>InnoDB å‘ç°ç”¨æˆ·æ²¡æœ‰æŒ‡å®šè‡ªå¢ id çš„å€¼ï¼Œè·å–è¡¨ t å½“å‰çš„è‡ªå¢å€¼ 2ï¼›</li><li>å°†ä¼ å…¥çš„è¡Œçš„å€¼æ”¹æˆ (2,1,1);</li><li>å°†è¡¨çš„è‡ªå¢å€¼æ”¹æˆ 3ï¼›</li><li>ç»§ç»­æ‰§è¡Œæ’å…¥æ•°æ®æ“ä½œï¼Œç”±äºå·²ç»å­˜åœ¨ c=1 çš„è®°å½•ï¼Œæ‰€ä»¥æŠ¥ Duplicate key errorï¼Œè¯­å¥è¿”å›ã€‚</li></ol><p>å¯¹åº”çš„æ‰§è¡Œæµç¨‹å›¾å¦‚ä¸‹ï¼š</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/f16d89a6e7ad6e2cde13b32bb2292dd3-1584367406951.jpg" alt="img"></p><p>å›¾ 2 insert(null, 1,1) å”¯ä¸€é”®å†²çª</p><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªè¡¨çš„è‡ªå¢å€¼æ”¹æˆ 3ï¼Œæ˜¯åœ¨çœŸæ­£æ‰§è¡Œæ’å…¥æ•°æ®çš„æ“ä½œä¹‹å‰ã€‚è¿™ä¸ªè¯­å¥çœŸæ­£æ‰§è¡Œçš„æ—¶å€™ï¼Œå› ä¸ºç¢°åˆ°å”¯ä¸€é”® c å†²çªï¼Œæ‰€ä»¥ id=2 è¿™ä¸€è¡Œå¹¶æ²¡æœ‰æ’å…¥æˆåŠŸï¼Œä½†ä¹Ÿæ²¡æœ‰å°†è‡ªå¢å€¼å†æ”¹å›å»ã€‚</p><p>æ‰€ä»¥ï¼Œåœ¨è¿™ä¹‹åï¼Œå†æ’å…¥æ–°çš„æ•°æ®è¡Œæ—¶ï¼Œæ‹¿åˆ°çš„è‡ªå¢ id å°±æ˜¯ 3ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå‡ºç°äº†è‡ªå¢ä¸»é”®ä¸è¿ç»­çš„æƒ…å†µã€‚</p><p>å¦‚å›¾ 3 æ‰€ç¤ºå°±æ˜¯å®Œæ•´çš„æ¼”ç¤ºç»“æœã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/77b87820b649692a555f19b562d5d926-1584367406952.png" alt="img"></p><p>å›¾ 3 ä¸€ä¸ªè‡ªå¢ä¸»é”® id ä¸è¿ç»­çš„å¤ç°æ­¥éª¤</p><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªæ“ä½œåºåˆ—å¤ç°äº†ä¸€ä¸ªè‡ªå¢ä¸»é”® id ä¸è¿ç»­çš„ç°åœº (æ²¡æœ‰ id=2 çš„è¡Œï¼‰ã€‚å¯è§ï¼Œ<strong>å”¯ä¸€é”®å†²çªæ˜¯å¯¼è‡´è‡ªå¢ä¸»é”® id ä¸è¿ç»­çš„ç¬¬ä¸€ç§åŸå› ã€‚</strong></p><p>åŒæ ·åœ°ï¼Œäº‹åŠ¡<strong>å›æ»šä¹Ÿä¼šäº§ç”Ÿç±»ä¼¼çš„ç°è±¡ï¼Œè¿™å°±æ˜¯ç¬¬äºŒç§åŸå› ã€‚</strong></p><p>ä¸‹é¢è¿™ä¸ªè¯­å¥åºåˆ—å°±å¯ä»¥æ„é€ ä¸è¿ç»­çš„è‡ªå¢ idï¼Œä½ å¯ä»¥è‡ªå·±éªŒè¯ä¸€ä¸‹ã€‚</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">insert</span> <span class="token keyword">into</span> t <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token boolean">null</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">begin</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> t <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token boolean">null</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">rollback</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> t <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token boolean">null</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// æ’å…¥çš„è¡Œæ˜¯ (3,2,2)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½ å¯èƒ½ä¼šé—®ï¼Œä¸ºä»€ä¹ˆåœ¨å‡ºç°å”¯ä¸€é”®å†²çªæˆ–è€…å›æ»šçš„æ—¶å€™ï¼ŒMySQL æ²¡æœ‰æŠŠè¡¨ t çš„è‡ªå¢å€¼æ”¹å›å»å‘¢ï¼Ÿå¦‚æœæŠŠè¡¨ t çš„å½“å‰è‡ªå¢å€¼ä» 3 æ”¹å› 2ï¼Œå†æ’å…¥æ–°æ•°æ®çš„æ—¶å€™ï¼Œä¸å°±å¯ä»¥ç”Ÿæˆ id=2 çš„ä¸€è¡Œæ•°æ®äº†å—ï¼Ÿ</p><p>å…¶å®ï¼ŒMySQL è¿™ä¹ˆè®¾è®¡æ˜¯ä¸ºäº†æå‡æ€§èƒ½ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘å°±è·Ÿä½ åˆ†æä¸€ä¸‹è¿™ä¸ªè®¾è®¡æ€è·¯ï¼Œçœ‹çœ‹<strong>è‡ªå¢å€¼ä¸ºä»€ä¹ˆä¸èƒ½å›é€€ã€‚</strong></p><p>å‡è®¾æœ‰ä¸¤ä¸ªå¹¶è¡Œæ‰§è¡Œçš„äº‹åŠ¡ï¼Œåœ¨ç”³è¯·è‡ªå¢å€¼çš„æ—¶å€™ï¼Œä¸ºäº†é¿å…ä¸¤ä¸ªäº‹åŠ¡ç”³è¯·åˆ°ç›¸åŒçš„è‡ªå¢ idï¼Œè‚¯å®šè¦åŠ é”ï¼Œç„¶åé¡ºåºç”³è¯·ã€‚</p><ol><li>å‡è®¾äº‹åŠ¡ A ç”³è¯·åˆ°äº† id=2ï¼Œ äº‹åŠ¡ B ç”³è¯·åˆ° id=3ï¼Œé‚£ä¹ˆè¿™æ—¶å€™è¡¨ t çš„è‡ªå¢å€¼æ˜¯ 4ï¼Œä¹‹åç»§ç»­æ‰§è¡Œã€‚</li><li>äº‹åŠ¡ B æ­£ç¡®æäº¤äº†ï¼Œä½†äº‹åŠ¡ A å‡ºç°äº†å”¯ä¸€é”®å†²çªã€‚</li><li>å¦‚æœå…è®¸äº‹åŠ¡ A æŠŠè‡ªå¢ id å›é€€ï¼Œä¹Ÿå°±æ˜¯æŠŠè¡¨ t çš„å½“å‰è‡ªå¢å€¼æ”¹å› 2ï¼Œé‚£ä¹ˆå°±ä¼šå‡ºç°è¿™æ ·çš„æƒ…å†µï¼šè¡¨é‡Œé¢å·²ç»æœ‰ id=3 çš„è¡Œï¼Œè€Œå½“å‰çš„è‡ªå¢ id å€¼æ˜¯ 2ã€‚</li><li>æ¥ä¸‹æ¥ï¼Œç»§ç»­æ‰§è¡Œçš„å…¶ä»–äº‹åŠ¡å°±ä¼šç”³è¯·åˆ° id=2ï¼Œç„¶åå†ç”³è¯·åˆ° id=3ã€‚è¿™æ—¶ï¼Œå°±ä¼šå‡ºç°æ’å…¥è¯­å¥æŠ¥é”™â€œä¸»é”®å†²çªâ€ã€‚</li></ol><p>è€Œä¸ºäº†è§£å†³è¿™ä¸ªä¸»é”®å†²çªï¼Œæœ‰ä¸¤ç§æ–¹æ³•ï¼š</p><ol><li>æ¯æ¬¡ç”³è¯· id ä¹‹å‰ï¼Œå…ˆåˆ¤æ–­è¡¨é‡Œé¢æ˜¯å¦å·²ç»å­˜åœ¨è¿™ä¸ª idã€‚å¦‚æœå­˜åœ¨ï¼Œå°±è·³è¿‡è¿™ä¸ª idã€‚ä½†æ˜¯ï¼Œè¿™ä¸ªæ–¹æ³•çš„æˆæœ¬å¾ˆé«˜ã€‚å› ä¸ºï¼Œæœ¬æ¥ç”³è¯· id æ˜¯ä¸€ä¸ªå¾ˆå¿«çš„æ“ä½œï¼Œç°åœ¨è¿˜è¦å†å»ä¸»é”®ç´¢å¼•æ ‘ä¸Šåˆ¤æ–­ id æ˜¯å¦å­˜åœ¨ã€‚</li><li>æŠŠè‡ªå¢ id çš„é”èŒƒå›´æ‰©å¤§ï¼Œå¿…é¡»ç­‰åˆ°ä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œå®Œæˆå¹¶æäº¤ï¼Œä¸‹ä¸€ä¸ªäº‹åŠ¡æ‰èƒ½å†ç”³è¯·è‡ªå¢ idã€‚è¿™ä¸ªæ–¹æ³•çš„é—®é¢˜ï¼Œå°±æ˜¯é”çš„ç²’åº¦å¤ªå¤§ï¼Œç³»ç»Ÿå¹¶å‘èƒ½åŠ›å¤§å¤§ä¸‹é™ã€‚</li></ol><p>å¯è§ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•éƒ½ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ã€‚é€ æˆè¿™äº›éº»çƒ¦çš„ç½ªé­ç¥¸é¦–ï¼Œå°±æ˜¯æˆ‘ä»¬å‡è®¾çš„è¿™ä¸ªâ€œå…è®¸è‡ªå¢ id å›é€€â€çš„å‰æå¯¼è‡´çš„ã€‚</p><p>å› æ­¤ï¼ŒInnoDB æ”¾å¼ƒäº†è¿™ä¸ªè®¾è®¡ï¼Œè¯­å¥æ‰§è¡Œå¤±è´¥ä¹Ÿä¸å›é€€è‡ªå¢ idã€‚ä¹Ÿæ­£æ˜¯å› ä¸ºè¿™æ ·ï¼Œæ‰€ä»¥æ‰åªä¿è¯äº†è‡ªå¢ id æ˜¯é€’å¢çš„ï¼Œä½†ä¸ä¿è¯æ˜¯è¿ç»­çš„ã€‚</p><h4 id="è‡ªå¢é”çš„ä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#è‡ªå¢é”çš„ä¼˜åŒ–" aria-hidden="true">#</a> è‡ªå¢é”çš„ä¼˜åŒ–</h4><p>å¯ä»¥çœ‹åˆ°ï¼Œè‡ªå¢ id é”å¹¶ä¸æ˜¯ä¸€ä¸ªäº‹åŠ¡é”ï¼Œè€Œæ˜¯æ¯æ¬¡ç”³è¯·å®Œå°±é©¬ä¸Šé‡Šæ”¾ï¼Œä»¥ä¾¿å…è®¸åˆ«çš„äº‹åŠ¡å†ç”³è¯·ã€‚å…¶å®ï¼Œåœ¨ MySQL 5.1 ç‰ˆæœ¬ä¹‹å‰ï¼Œå¹¶ä¸æ˜¯è¿™æ ·çš„ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä¼šå…ˆç»™ä½ ä»‹ç»ä¸‹è‡ªå¢é”è®¾è®¡çš„å†å²ï¼Œè¿™æ ·æœ‰åŠ©äºä½ åˆ†ææ¥ä¸‹æ¥çš„ä¸€ä¸ªé—®é¢˜ã€‚</p><p>åœ¨ MySQL 5.0 ç‰ˆæœ¬çš„æ—¶å€™ï¼Œè‡ªå¢é”çš„èŒƒå›´æ˜¯è¯­å¥çº§åˆ«ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä¸€ä¸ªè¯­å¥ç”³è¯·äº†ä¸€ä¸ªè¡¨è‡ªå¢é”ï¼Œè¿™ä¸ªé”ä¼šç­‰è¯­å¥æ‰§è¡Œç»“æŸä»¥åæ‰é‡Šæ”¾ã€‚æ˜¾ç„¶ï¼Œè¿™æ ·è®¾è®¡ä¼šå½±å“å¹¶å‘åº¦ã€‚</p><p>MySQL 5.1.22 ç‰ˆæœ¬å¼•å…¥äº†ä¸€ä¸ªæ–°ç­–ç•¥ï¼Œæ–°å¢å‚æ•° innodb_autoinc_lock_modeï¼Œé»˜è®¤å€¼æ˜¯ 1ã€‚</p><ol><li>è¿™ä¸ªå‚æ•°çš„å€¼è¢«è®¾ç½®ä¸º 0 æ—¶ï¼Œè¡¨ç¤ºé‡‡ç”¨ä¹‹å‰ MySQL 5.0 ç‰ˆæœ¬çš„ç­–ç•¥ï¼Œå³è¯­å¥æ‰§è¡Œç»“æŸåæ‰é‡Šæ”¾é”ï¼›</li><li>è¿™ä¸ªå‚æ•°çš„å€¼è¢«è®¾ç½®ä¸º 1 æ—¶ï¼š <ul><li>æ™®é€š insert è¯­å¥ï¼Œè‡ªå¢é”åœ¨ç”³è¯·ä¹‹åå°±é©¬ä¸Šé‡Šæ”¾ï¼›</li><li>ç±»ä¼¼ insert â€¦ select è¿™æ ·çš„æ‰¹é‡æ’å…¥æ•°æ®çš„è¯­å¥ï¼Œè‡ªå¢é”è¿˜æ˜¯è¦ç­‰è¯­å¥ç»“æŸåæ‰è¢«é‡Šæ”¾ï¼›</li></ul></li><li>è¿™ä¸ªå‚æ•°çš„å€¼è¢«è®¾ç½®ä¸º 2 æ—¶ï¼Œæ‰€æœ‰çš„ç”³è¯·è‡ªå¢ä¸»é”®çš„åŠ¨ä½œéƒ½æ˜¯ç”³è¯·åå°±é‡Šæ”¾é”ã€‚</li></ol><p>ä½ ä¸€å®šæœ‰ä¸¤ä¸ªç–‘é—®ï¼š<strong>ä¸ºä»€ä¹ˆé»˜è®¤è®¾ç½®ä¸‹ï¼Œinsert â€¦ select è¦ä½¿ç”¨è¯­å¥çº§çš„é”ï¼Ÿä¸ºä»€ä¹ˆè¿™ä¸ªå‚æ•°çš„é»˜è®¤å€¼ä¸æ˜¯ 2ï¼Ÿ</strong></p><p>ç­”æ¡ˆæ˜¯ï¼Œè¿™ä¹ˆè®¾è®¡è¿˜æ˜¯ä¸ºäº†æ•°æ®çš„ä¸€è‡´æ€§ã€‚</p><p>æˆ‘ä»¬ä¸€èµ·æ¥çœ‹ä¸€ä¸‹è¿™ä¸ªåœºæ™¯ï¼š</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/e0a69e151277de54a8262657e4ec89df-1584367406952.png" alt="img"></p><p>å›¾ 4 æ‰¹é‡æ’å…¥æ•°æ®çš„è‡ªå¢é”</p><p>åœ¨è¿™ä¸ªä¾‹å­é‡Œï¼Œæˆ‘å¾€è¡¨ t1 ä¸­æ’å…¥äº† 4 è¡Œæ•°æ®ï¼Œç„¶ååˆ›å»ºäº†ä¸€ä¸ªç›¸åŒç»“æ„çš„è¡¨ t2ï¼Œç„¶åä¸¤ä¸ª session åŒæ—¶æ‰§è¡Œå‘è¡¨ t2 ä¸­æ’å…¥æ•°æ®çš„æ“ä½œã€‚</p><p>ä½ å¯ä»¥è®¾æƒ³ä¸€ä¸‹ï¼Œå¦‚æœ session B æ˜¯ç”³è¯·äº†è‡ªå¢å€¼ä»¥åé©¬ä¸Šå°±é‡Šæ”¾è‡ªå¢é”ï¼Œé‚£ä¹ˆå°±å¯èƒ½å‡ºç°è¿™æ ·çš„æƒ…å†µï¼š</p><ul><li>session B å…ˆæ’å…¥äº†ä¸¤ä¸ªè®°å½•ï¼Œ(1,1,1)ã€(2,2,2)ï¼›</li><li>ç„¶åï¼Œsession A æ¥ç”³è¯·è‡ªå¢ id å¾—åˆ° id=3ï¼Œæ’å…¥äº†ï¼ˆ3,5,5)ï¼›</li><li>ä¹‹åï¼Œsession B ç»§ç»­æ‰§è¡Œï¼Œæ’å…¥ä¸¤æ¡è®°å½• (4,3,3)ã€ (5,4,4)ã€‚</li></ul><p>ä½ å¯èƒ½ä¼šè¯´ï¼Œè¿™ä¹Ÿæ²¡å…³ç³»å§ï¼Œæ¯•ç«Ÿ session B çš„è¯­ä¹‰æœ¬èº«å°±æ²¡æœ‰è¦æ±‚è¡¨ t2 çš„æ‰€æœ‰è¡Œçš„æ•°æ®éƒ½è·Ÿ session A ç›¸åŒã€‚</p><p>æ˜¯çš„ï¼Œä»æ•°æ®é€»è¾‘ä¸Šçœ‹æ˜¯å¯¹çš„ã€‚ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬ç°åœ¨çš„ binlog_format=statementï¼Œä½ å¯ä»¥è®¾æƒ³ä¸‹ï¼Œbinlog ä¼šæ€ä¹ˆè®°å½•å‘¢ï¼Ÿ</p><p>ç”±äºä¸¤ä¸ª session æ˜¯åŒæ—¶æ‰§è¡Œæ’å…¥æ•°æ®å‘½ä»¤çš„ï¼Œæ‰€ä»¥ binlog é‡Œé¢å¯¹è¡¨ t2 çš„æ›´æ–°æ—¥å¿—åªæœ‰ä¸¤ç§æƒ…å†µï¼šè¦ä¹ˆå…ˆè®° session A çš„ï¼Œè¦ä¹ˆå…ˆè®° session B çš„ã€‚</p><p>ä½†ä¸è®ºæ˜¯å“ªä¸€ç§ï¼Œè¿™ä¸ª binlog æ‹¿å»ä»åº“æ‰§è¡Œï¼Œæˆ–è€…ç”¨æ¥æ¢å¤ä¸´æ—¶å®ä¾‹ï¼Œå¤‡åº“å’Œä¸´æ—¶å®ä¾‹é‡Œé¢ï¼Œsession B è¿™ä¸ªè¯­å¥æ‰§è¡Œå‡ºæ¥ï¼Œç”Ÿæˆçš„ç»“æœé‡Œé¢ï¼Œid éƒ½æ˜¯è¿ç»­çš„ã€‚è¿™æ—¶ï¼Œè¿™ä¸ªåº“å°±å‘ç”Ÿäº†æ•°æ®ä¸ä¸€è‡´ã€‚</p><p>ä½ å¯ä»¥åˆ†æä¸€ä¸‹ï¼Œå‡ºç°è¿™ä¸ªé—®é¢˜çš„åŸå› æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>å…¶å®ï¼Œè¿™æ˜¯å› ä¸ºåŸåº“ session B çš„ insert è¯­å¥ï¼Œç”Ÿæˆçš„ id ä¸è¿ç»­ã€‚è¿™ä¸ªä¸è¿ç»­çš„ idï¼Œç”¨ statement æ ¼å¼çš„ binlog æ¥ä¸²è¡Œæ‰§è¡Œï¼Œæ˜¯æ‰§è¡Œä¸å‡ºæ¥çš„ã€‚</p><p>è€Œè¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæœ‰ä¸¤ç§æ€è·¯ï¼š</p><ol><li>ä¸€ç§æ€è·¯æ˜¯ï¼Œè®©åŸåº“çš„æ‰¹é‡æ’å…¥æ•°æ®è¯­å¥ï¼Œå›ºå®šç”Ÿæˆè¿ç»­çš„ id å€¼ã€‚æ‰€ä»¥ï¼Œè‡ªå¢é”ç›´åˆ°è¯­å¥æ‰§è¡Œç»“æŸæ‰é‡Šæ”¾ï¼Œå°±æ˜¯ä¸ºäº†è¾¾åˆ°è¿™ä¸ªç›®çš„ã€‚</li><li>å¦ä¸€ç§æ€è·¯æ˜¯ï¼Œåœ¨ binlog é‡Œé¢æŠŠæ’å…¥æ•°æ®çš„æ“ä½œéƒ½å¦‚å®è®°å½•è¿›æ¥ï¼Œåˆ°å¤‡åº“æ‰§è¡Œçš„æ—¶å€™ï¼Œä¸å†ä¾èµ–äºè‡ªå¢ä¸»é”®å»ç”Ÿæˆã€‚è¿™ç§æƒ…å†µï¼Œå…¶å®å°±æ˜¯ innodb_autoinc_lock_mode è®¾ç½®ä¸º 2ï¼ŒåŒæ—¶ binlog_format è®¾ç½®ä¸º rowã€‚</li></ol><p>å› æ­¤ï¼Œ<strong>åœ¨ç”Ÿäº§ä¸Šï¼Œå°¤å…¶æ˜¯æœ‰ insert â€¦ select è¿™ç§æ‰¹é‡æ’å…¥æ•°æ®çš„åœºæ™¯æ—¶ï¼Œä»å¹¶å‘æ’å…¥æ•°æ®æ€§èƒ½çš„è§’åº¦è€ƒè™‘ï¼Œæˆ‘å»ºè®®ä½ è¿™æ ·è®¾ç½®ï¼šinnodb_autoinc_lock_mode=2 ï¼Œå¹¶ä¸” binlog_format=row</strong>. è¿™æ ·åšï¼Œæ—¢èƒ½æå‡å¹¶å‘æ€§ï¼Œåˆä¸ä¼šå‡ºç°æ•°æ®ä¸€è‡´æ€§é—®é¢˜ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘è¿™é‡Œè¯´çš„<strong>æ‰¹é‡æ’å…¥æ•°æ®ï¼ŒåŒ…å«çš„è¯­å¥ç±»å‹æ˜¯ insert â€¦ selectã€replace â€¦ select å’Œ load data è¯­å¥ã€‚</strong></p><p>ä½†æ˜¯ï¼Œåœ¨æ™®é€šçš„ insert è¯­å¥é‡Œé¢åŒ…å«å¤šä¸ª value å€¼çš„æƒ…å†µä¸‹ï¼Œå³ä½¿ innodb_autoinc_lock_mode è®¾ç½®ä¸º 1ï¼Œä¹Ÿä¸ä¼šç­‰è¯­å¥æ‰§è¡Œå®Œæˆæ‰é‡Šæ”¾é”ã€‚å› ä¸ºè¿™ç±»è¯­å¥åœ¨ç”³è¯·è‡ªå¢ id çš„æ—¶å€™ï¼Œæ˜¯å¯ä»¥ç²¾ç¡®è®¡ç®—å‡ºéœ€è¦å¤šå°‘ä¸ª id çš„ï¼Œç„¶åä¸€æ¬¡æ€§ç”³è¯·ï¼Œç”³è¯·å®Œæˆåé”å°±å¯ä»¥é‡Šæ”¾äº†ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæ‰¹é‡æ’å…¥æ•°æ®çš„è¯­å¥ï¼Œä¹‹æ‰€ä»¥éœ€è¦è¿™ä¹ˆè®¾ç½®ï¼Œæ˜¯å› ä¸ºâ€œä¸çŸ¥é“è¦é¢„å…ˆç”³è¯·å¤šå°‘ä¸ª idâ€ã€‚</p><p>æ—¢ç„¶é¢„å…ˆä¸çŸ¥é“è¦ç”³è¯·å¤šå°‘ä¸ªè‡ªå¢ idï¼Œé‚£ä¹ˆä¸€ç§ç›´æ¥çš„æƒ³æ³•å°±æ˜¯éœ€è¦ä¸€ä¸ªæ—¶ç”³è¯·ä¸€ä¸ªã€‚ä½†å¦‚æœä¸€ä¸ª select â€¦ insert è¯­å¥è¦æ’å…¥ 10 ä¸‡è¡Œæ•°æ®ï¼ŒæŒ‰ç…§è¿™ä¸ªé€»è¾‘çš„è¯å°±è¦ç”³è¯· 10 ä¸‡æ¬¡ã€‚æ˜¾ç„¶ï¼Œè¿™ç§ç”³è¯·è‡ªå¢ id çš„ç­–ç•¥ï¼Œåœ¨å¤§æ‰¹é‡æ’å…¥æ•°æ®çš„æƒ…å†µä¸‹ï¼Œä¸ä½†é€Ÿåº¦æ…¢ï¼Œè¿˜ä¼šå½±å“å¹¶å‘æ’å…¥çš„æ€§èƒ½ã€‚</p><p>å› æ­¤ï¼Œå¯¹äºæ‰¹é‡æ’å…¥æ•°æ®çš„è¯­å¥ï¼ŒMySQL æœ‰ä¸€ä¸ªæ‰¹é‡ç”³è¯·è‡ªå¢ id çš„ç­–ç•¥ï¼š</p><ol><li>è¯­å¥æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œç¬¬ä¸€æ¬¡ç”³è¯·è‡ªå¢ idï¼Œä¼šåˆ†é… 1 ä¸ªï¼›</li><li>1 ä¸ªç”¨å®Œä»¥åï¼Œè¿™ä¸ªè¯­å¥ç¬¬äºŒæ¬¡ç”³è¯·è‡ªå¢ idï¼Œä¼šåˆ†é… 2 ä¸ªï¼›</li><li>2 ä¸ªç”¨å®Œä»¥åï¼Œè¿˜æ˜¯è¿™ä¸ªè¯­å¥ï¼Œç¬¬ä¸‰æ¬¡ç”³è¯·è‡ªå¢ idï¼Œä¼šåˆ†é… 4 ä¸ªï¼›</li><li>ä¾æ­¤ç±»æ¨ï¼ŒåŒä¸€ä¸ªè¯­å¥å»ç”³è¯·è‡ªå¢ idï¼Œæ¯æ¬¡ç”³è¯·åˆ°çš„è‡ªå¢ id ä¸ªæ•°éƒ½æ˜¯ä¸Šä¸€æ¬¡çš„ä¸¤å€ã€‚</li></ol><p>ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬ä¸€èµ·çœ‹çœ‹ä¸‹é¢çš„è¿™ä¸ªè¯­å¥åºåˆ—ï¼š</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">insert</span> <span class="token keyword">into</span> t <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> t <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> t <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> t <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> t2 <span class="token operator">like</span> t<span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> t2<span class="token punctuation">(</span>c<span class="token punctuation">,</span>d<span class="token punctuation">)</span> <span class="token keyword">select</span> c<span class="token punctuation">,</span>d <span class="token keyword">from</span> t<span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> t2 <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>insertâ€¦selectï¼Œå®é™…ä¸Šå¾€è¡¨ t2 ä¸­æ’å…¥äº† 4 è¡Œæ•°æ®ã€‚ä½†æ˜¯ï¼Œè¿™å››è¡Œæ•°æ®æ˜¯åˆ†ä¸‰æ¬¡ç”³è¯·çš„è‡ªå¢ idï¼Œç¬¬ä¸€æ¬¡ç”³è¯·åˆ°äº† id=1ï¼Œç¬¬äºŒæ¬¡è¢«åˆ†é…äº† id=2 å’Œ id=3ï¼Œ ç¬¬ä¸‰æ¬¡è¢«åˆ†é…åˆ° id=4 åˆ° id=7ã€‚</p><p>ç”±äºè¿™æ¡è¯­å¥å®é™…åªç”¨ä¸Šäº† 4 ä¸ª idï¼Œæ‰€ä»¥ id=5 åˆ° id=7 å°±è¢«æµªè´¹æ‰äº†ã€‚ä¹‹åï¼Œå†æ‰§è¡Œ insert into t2 values(null, 5,5)ï¼Œå®é™…ä¸Šæ’å…¥çš„æ•°æ®å°±æ˜¯ï¼ˆ8,5,5)ã€‚</p><p><strong>è¿™æ˜¯ä¸»é”® id å‡ºç°è‡ªå¢ id ä¸è¿ç»­çš„ç¬¬ä¸‰ç§åŸå› ã€‚</strong></p><h4 id="å°ç»“-24" tabindex="-1"><a class="header-anchor" href="#å°ç»“-24" aria-hidden="true">#</a> å°ç»“</h4><p>ä»Šå¤©ï¼Œæˆ‘ä»¬ä»â€œè‡ªå¢ä¸»é”®ä¸ºä»€ä¹ˆä¼šå‡ºç°ä¸è¿ç»­çš„å€¼â€è¿™ä¸ªé—®é¢˜å¼€å§‹ï¼Œé¦–å…ˆè®¨è®ºäº†è‡ªå¢å€¼çš„å­˜å‚¨ã€‚</p><p>åœ¨ MyISAM å¼•æ“é‡Œé¢ï¼Œè‡ªå¢å€¼æ˜¯è¢«å†™åœ¨æ•°æ®æ–‡ä»¶ä¸Šçš„ã€‚è€Œåœ¨ InnoDB ä¸­ï¼Œè‡ªå¢å€¼æ˜¯è¢«è®°å½•åœ¨å†…å­˜çš„ã€‚MySQL ç›´åˆ° 8.0 ç‰ˆæœ¬ï¼Œæ‰ç»™ InnoDB è¡¨çš„è‡ªå¢å€¼åŠ ä¸Šäº†æŒä¹…åŒ–çš„èƒ½åŠ›ï¼Œç¡®ä¿é‡å¯å‰åä¸€ä¸ªè¡¨çš„è‡ªå¢å€¼ä¸å˜ã€‚</p><p>ç„¶åï¼Œæˆ‘å’Œä½ åˆ†äº«äº†åœ¨ä¸€ä¸ªè¯­å¥æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œè‡ªå¢å€¼æ”¹å˜çš„æ—¶æœºï¼Œåˆ†æäº†ä¸ºä»€ä¹ˆ MySQL åœ¨äº‹åŠ¡å›æ»šçš„æ—¶å€™ä¸èƒ½å›æ”¶è‡ªå¢ idã€‚</p><p>MySQL 5.1.22 ç‰ˆæœ¬å¼€å§‹å¼•å…¥çš„å‚æ•° innodb_autoinc_lock_modeï¼Œæ§åˆ¶äº†è‡ªå¢å€¼ç”³è¯·æ—¶çš„é”èŒƒå›´ã€‚ä»å¹¶å‘æ€§èƒ½çš„è§’åº¦è€ƒè™‘ï¼Œæˆ‘å»ºè®®ä½ å°†å…¶è®¾ç½®ä¸º 2ï¼ŒåŒæ—¶å°† binlog_format è®¾ç½®ä¸º rowã€‚æˆ‘åœ¨å‰é¢çš„æ–‡ç« ä¸­å…¶å®å¤šæ¬¡æåˆ°ï¼Œbinlog_format è®¾ç½®ä¸º rowï¼Œæ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚ä»Šå¤©çš„ä¾‹å­ç»™è¿™ä¸ªç»“è®ºå¤šäº†ä¸€ä¸ªç†ç”±ã€‚</p><p>æœ€åï¼Œæˆ‘ç»™ä½ ç•™ä¸€ä¸ªæ€è€ƒé¢˜å§ã€‚</p><p>åœ¨æœ€åä¸€ä¸ªä¾‹å­ä¸­ï¼Œæ‰§è¡Œ insert into t2(c,d) select c,d from t; è¿™ä¸ªè¯­å¥çš„æ—¶å€™ï¼Œå¦‚æœéš”ç¦»çº§åˆ«æ˜¯å¯é‡å¤è¯»ï¼ˆrepeatable readï¼‰ï¼Œbinlog_format=statementã€‚è¿™ä¸ªè¯­å¥ä¼šå¯¹è¡¨ t çš„æ‰€æœ‰è®°å½•å’Œé—´éš™åŠ é”ã€‚</p><p>ä½ è§‰å¾—ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¹ˆåšå‘¢ï¼Ÿ</p><p>ä½ å¯ä»¥æŠŠä½ çš„æ€è€ƒå’Œåˆ†æå†™åœ¨è¯„è®ºåŒºï¼Œæˆ‘ä¼šåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« å’Œä½ è®¨è®ºè¿™ä¸ªé—®é¢˜ã€‚æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚</p><h4 id="ä¸ŠæœŸé—®é¢˜æ—¶é—´-21" tabindex="-1"><a class="header-anchor" href="#ä¸ŠæœŸé—®é¢˜æ—¶é—´-21" aria-hidden="true">#</a> ä¸ŠæœŸé—®é¢˜æ—¶é—´</h4><p>ä¸ŠæœŸçš„é—®é¢˜æ˜¯ï¼Œå¦‚æœä½ ç»´æŠ¤çš„ MySQL ç³»ç»Ÿé‡Œæœ‰å†…å­˜è¡¨ï¼Œæ€ä¹ˆé¿å…å†…å­˜è¡¨çªç„¶ä¸¢æ•°æ®ï¼Œç„¶åå¯¼è‡´ä¸»å¤‡åŒæ­¥åœæ­¢çš„æƒ…å†µã€‚</p><p>æˆ‘ä»¬å‡è®¾çš„æ˜¯ä¸»åº“æš‚æ—¶ä¸èƒ½ä¿®æ”¹å¼•æ“ï¼Œé‚£ä¹ˆå°±æŠŠå¤‡åº“çš„å†…å­˜è¡¨å¼•æ“å…ˆéƒ½æ”¹æˆ InnoDBã€‚å¯¹äºæ¯ä¸ªå†…å­˜è¡¨ï¼Œæ‰§è¡Œ</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">set</span> sql_log_bin<span class="token operator">=</span><span class="token keyword">off</span><span class="token punctuation">;</span>
<span class="token keyword">alter</span> <span class="token keyword">table</span> tbl_name <span class="token keyword">engine</span><span class="token operator">=</span><span class="token keyword">innodb</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ ·å°±èƒ½é¿å…å¤‡åº“é‡å¯çš„æ—¶å€™ï¼Œæ•°æ®ä¸¢å¤±çš„é—®é¢˜ã€‚</p><p>ç”±äºä¸»åº“é‡å¯åï¼Œä¼šå¾€ binlog é‡Œé¢å†™â€œdelete from tbl_nameâ€ï¼Œè¿™ä¸ªå‘½ä»¤ä¼ åˆ°å¤‡åº“ï¼Œå¤‡åº“çš„åŒåçš„è¡¨æ•°æ®ä¹Ÿä¼šè¢«æ¸…ç©ºã€‚</p><p>å› æ­¤ï¼Œå°±ä¸ä¼šå‡ºç°ä¸»å¤‡åŒæ­¥åœæ­¢çš„é—®é¢˜ã€‚</p><p>å¦‚æœç”±äºä¸»åº“å¼‚å¸¸é‡å¯ï¼Œè§¦å‘äº† HAï¼Œè¿™æ—¶å€™æˆ‘ä»¬ä¹‹å‰ä¿®æ”¹è¿‡å¼•æ“çš„å¤‡åº“å˜æˆäº†ä¸»åº“ã€‚è€ŒåŸæ¥çš„ä¸»åº“å˜æˆäº†æ–°å¤‡åº“ï¼Œåœ¨æ–°å¤‡åº“ä¸ŠæŠŠæ‰€æœ‰çš„å†…å­˜è¡¨ï¼ˆè¿™æ—¶å€™è¡¨é‡Œæ²¡æ•°æ®ï¼‰éƒ½æ”¹æˆ InnoDB è¡¨ã€‚</p><p>æ‰€ä»¥ï¼Œå¦‚æœæˆ‘ä»¬ä¸èƒ½ç›´æ¥ä¿®æ”¹ä¸»åº“ä¸Šçš„è¡¨å¼•æ“ï¼Œå¯ä»¥é…ç½®ä¸€ä¸ªè‡ªåŠ¨å·¡æ£€çš„å·¥å…·ï¼Œåœ¨å¤‡åº“ä¸Šå‘ç°å†…å­˜è¡¨å°±æŠŠå¼•æ“æ”¹äº†ã€‚</p><p>åŒæ—¶ï¼Œè·Ÿä¸šåŠ¡å¼€å‘åŒå­¦çº¦å®šå¥½å»ºè¡¨è§„åˆ™ï¼Œé¿å…åˆ›å»ºæ–°çš„å†…å­˜è¡¨ã€‚</p><p>è¯„è®ºåŒºç•™è¨€ç‚¹èµæ¿ï¼š</p><blockquote><p>å¤§å®¶åœ¨æ˜¥èŠ‚æœŸé—´è¿˜åšæŒçœ‹ä¸“æ ï¼Œå¹¶ä¸”æ·±å…¥åœ°æ€è€ƒå’Œå›å¤ï¼Œç»™å¤§å®¶ç‚¹èµã€‚ @é•¿æ° åŒå­¦æåˆ°çš„å°†æ•°æ®ä¿å­˜åˆ° InnoDB è¡¨ç”¨æ¥æŒä¹…åŒ–ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªæ–¹æ³•ã€‚ä¸è¿‡ï¼Œæˆ‘è¿˜æ˜¯å»ºè®®é‡œåº•æŠ½è–ªï¼Œç›´æ¥ä¿®æ”¹å¤‡åº“çš„å†…å­˜è¡¨çš„å¼•æ“ã€‚ @è€æ¨åŒå¿— æåˆ°çš„æ˜¯ä¸»åº“å¼‚å¸¸é‡å¯çš„åœºæ™¯ï¼Œè¿™æ—¶å€™æ˜¯ä¸ä¼šæŠ¥ä¸»å¤‡ä¸ä¸€è‡´çš„ï¼Œå› ä¸ºä¸»åº“é‡å¯çš„æ—¶å€™å†™äº† delete from tbl_nameï¼Œä¸»å¤‡çš„å†…å­˜è¡¨éƒ½æ¸…ç©ºäº†ã€‚</p></blockquote><h3 id="_40-insertè¯­å¥çš„é”ä¸ºä»€ä¹ˆè¿™ä¹ˆå¤š" tabindex="-1"><a class="header-anchor" href="#_40-insertè¯­å¥çš„é”ä¸ºä»€ä¹ˆè¿™ä¹ˆå¤š" aria-hidden="true">#</a> 40 insertè¯­å¥çš„é”ä¸ºä»€ä¹ˆè¿™ä¹ˆå¤šï¼Ÿ</h3><p>åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘æåˆ° MySQL å¯¹è‡ªå¢ä¸»é”®é”åšäº†ä¼˜åŒ–ï¼Œå°½é‡åœ¨ç”³è¯·åˆ°è‡ªå¢ id ä»¥åï¼Œå°±é‡Šæ”¾è‡ªå¢é”ã€‚</p><p>å› æ­¤ï¼Œinsert è¯­å¥æ˜¯ä¸€ä¸ªå¾ˆè½»é‡çš„æ“ä½œã€‚ä¸è¿‡ï¼Œè¿™ä¸ªç»“è®ºå¯¹äºâ€œæ™®é€šçš„ insert è¯­å¥â€æ‰æœ‰æ•ˆã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿˜æœ‰äº› insert è¯­å¥æ˜¯å±äºâ€œç‰¹æ®Šæƒ…å†µâ€çš„ï¼Œåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­éœ€è¦ç»™å…¶ä»–èµ„æºåŠ é”ï¼Œæˆ–è€…æ— æ³•åœ¨ç”³è¯·åˆ°è‡ªå¢ id ä»¥åå°±ç«‹é©¬é‡Šæ”¾è‡ªå¢é”ã€‚</p><p>é‚£ä¹ˆï¼Œä»Šå¤©è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬å°±ä¸€èµ·æ¥èŠèŠè¿™ä¸ªè¯é¢˜ã€‚</p><h4 id="insert-select-è¯­å¥" tabindex="-1"><a class="header-anchor" href="#insert-select-è¯­å¥" aria-hidden="true">#</a> insert â€¦ select è¯­å¥</h4><p>æˆ‘ä»¬å…ˆä»æ˜¨å¤©çš„é—®é¢˜è¯´èµ·å§ã€‚è¡¨ t å’Œ t2 çš„è¡¨ç»“æ„ã€åˆå§‹åŒ–æ•°æ®è¯­å¥å¦‚ä¸‹ï¼Œä»Šå¤©çš„ä¾‹å­æˆ‘ä»¬è¿˜æ˜¯é’ˆå¯¹è¿™ä¸¤ä¸ªè¡¨å±•å¼€ã€‚</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>t<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>c<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>d<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">UNIQUE</span> <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>c<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>c<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span><span class="token punctuation">;</span> 
<span class="token keyword">insert</span> <span class="token keyword">into</span> t <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> t <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> t <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> t <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">create</span> <span class="token keyword">table</span> t2 <span class="token operator">like</span> t
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç°åœ¨ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹ä¸ºä»€ä¹ˆåœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹ï¼Œbinlog_format=statement æ—¶æ‰§è¡Œï¼š</p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code>insert <span class="token keyword">into</span> <span class="token function">t2</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span>d<span class="token punctuation">)</span> <span class="token keyword">select</span> c<span class="token punctuation">,</span>d <span class="token keyword">from</span> t<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>è¿™ä¸ªè¯­å¥æ—¶ï¼Œéœ€è¦å¯¹è¡¨ t çš„æ‰€æœ‰è¡Œå’Œé—´éš™åŠ é”å‘¢ï¼Ÿ</p><p>å…¶å®ï¼Œè¿™ä¸ªé—®é¢˜æˆ‘ä»¬éœ€è¦è€ƒè™‘çš„è¿˜æ˜¯æ—¥å¿—å’Œæ•°æ®çš„ä¸€è‡´æ€§ã€‚æˆ‘ä»¬çœ‹ä¸‹è¿™ä¸ªæ‰§è¡Œåºåˆ—ï¼š</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/33e513ee55d5700dc67f32bcdafb9386-1584367406953.png" alt="img"></p><p>å›¾ 1 å¹¶å‘ insert åœºæ™¯</p><p>å®é™…çš„æ‰§è¡Œæ•ˆæœæ˜¯ï¼Œå¦‚æœ session B å…ˆæ‰§è¡Œï¼Œç”±äºè¿™ä¸ªè¯­å¥å¯¹è¡¨ t ä¸»é”®ç´¢å¼•åŠ äº† (-âˆ,1] è¿™ä¸ª next-key lockï¼Œä¼šåœ¨è¯­å¥æ‰§è¡Œå®Œæˆåï¼Œæ‰å…è®¸ session A çš„ insert è¯­å¥æ‰§è¡Œã€‚</p><p>ä½†å¦‚æœæ²¡æœ‰é”çš„è¯ï¼Œå°±å¯èƒ½å‡ºç° session B çš„ insert è¯­å¥å…ˆæ‰§è¡Œï¼Œä½†æ˜¯åå†™å…¥ binlog çš„æƒ…å†µã€‚äºæ˜¯ï¼Œåœ¨ binlog_format=statement çš„æƒ…å†µä¸‹ï¼Œbinlog é‡Œé¢å°±è®°å½•äº†è¿™æ ·çš„è¯­å¥åºåˆ—ï¼š</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">insert</span> <span class="token keyword">into</span> t <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> t2<span class="token punctuation">(</span>c<span class="token punctuation">,</span>d<span class="token punctuation">)</span> <span class="token keyword">select</span> c<span class="token punctuation">,</span>d <span class="token keyword">from</span> t<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªè¯­å¥åˆ°äº†å¤‡åº“æ‰§è¡Œï¼Œå°±ä¼šæŠŠ id=-1 è¿™ä¸€è¡Œä¹Ÿå†™åˆ°è¡¨ t2 ä¸­ï¼Œå‡ºç°ä¸»å¤‡ä¸ä¸€è‡´ã€‚</p><h4 id="insert-å¾ªç¯å†™å…¥" tabindex="-1"><a class="header-anchor" href="#insert-å¾ªç¯å†™å…¥" aria-hidden="true">#</a> insert å¾ªç¯å†™å…¥</h4><p>å½“ç„¶äº†ï¼Œæ‰§è¡Œ insert â€¦ select çš„æ—¶å€™ï¼Œå¯¹ç›®æ ‡è¡¨ä¹Ÿä¸æ˜¯é”å…¨è¡¨ï¼Œè€Œæ˜¯åªé”ä½éœ€è¦è®¿é—®çš„èµ„æºã€‚</p><p>å¦‚æœç°åœ¨æœ‰è¿™ä¹ˆä¸€ä¸ªéœ€æ±‚ï¼šè¦å¾€è¡¨ t2 ä¸­æ’å…¥ä¸€è¡Œæ•°æ®ï¼Œè¿™ä¸€è¡Œçš„ c å€¼æ˜¯è¡¨ t ä¸­ c å€¼çš„æœ€å¤§å€¼åŠ  1ã€‚</p><p>æ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥è¿™ä¹ˆå†™è¿™æ¡ SQL è¯­å¥ ï¼š</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">insert</span> <span class="token keyword">into</span> t2<span class="token punctuation">(</span>c<span class="token punctuation">,</span>d<span class="token punctuation">)</span>  <span class="token punctuation">(</span><span class="token keyword">select</span> c<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> d <span class="token keyword">from</span> t <span class="token keyword">force</span> <span class="token keyword">index</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token keyword">order</span> <span class="token keyword">by</span> c <span class="token keyword">desc</span> <span class="token keyword">limit</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>è¿™ä¸ªè¯­å¥çš„åŠ é”èŒƒå›´ï¼Œå°±æ˜¯è¡¨ t ç´¢å¼• c ä¸Šçš„ (3,4] å’Œ (4,supremum] è¿™ä¸¤ä¸ª next-key lockï¼Œä»¥åŠä¸»é”®ç´¢å¼•ä¸Š id=4 è¿™ä¸€è¡Œã€‚</p><p>å®ƒçš„æ‰§è¡Œæµç¨‹ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œä»è¡¨ t ä¸­æŒ‰ç…§ç´¢å¼• c å€’åºï¼Œæ‰«æç¬¬ä¸€è¡Œï¼Œæ‹¿åˆ°ç»“æœå†™å…¥åˆ°è¡¨ t2 ä¸­ã€‚</p><p>å› æ­¤æ•´æ¡è¯­å¥çš„æ‰«æè¡Œæ•°æ˜¯ 1ã€‚</p><p>è¿™ä¸ªè¯­å¥æ‰§è¡Œçš„æ…¢æŸ¥è¯¢æ—¥å¿—ï¼ˆslow logï¼‰ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/3efdf8256309a44e23d93089459eda74-1584367406953.png" alt="img"></p><p>å›¾ 2 æ…¢æŸ¥è¯¢æ—¥å¿— -- å°†æ•°æ®æ’å…¥è¡¨ t2</p><p>é€šè¿‡è¿™ä¸ªæ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œæˆ‘ä»¬çœ‹åˆ° Rows_examined=1ï¼Œæ­£å¥½éªŒè¯äº†æ‰§è¡Œè¿™æ¡è¯­å¥çš„æ‰«æè¡Œæ•°ä¸º 1ã€‚</p><p>é‚£ä¹ˆï¼Œå¦‚æœæˆ‘ä»¬æ˜¯è¦æŠŠè¿™æ ·çš„ä¸€è¡Œæ•°æ®æ’å…¥åˆ°è¡¨ t ä¸­çš„è¯ï¼š</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">insert</span> <span class="token keyword">into</span> t<span class="token punctuation">(</span>c<span class="token punctuation">,</span>d<span class="token punctuation">)</span>  <span class="token punctuation">(</span><span class="token keyword">select</span> c<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> d <span class="token keyword">from</span> t <span class="token keyword">force</span> <span class="token keyword">index</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token keyword">order</span> <span class="token keyword">by</span> c <span class="token keyword">desc</span> <span class="token keyword">limit</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>è¯­å¥çš„æ‰§è¡Œæµç¨‹æ˜¯æ€æ ·çš„ï¼Ÿæ‰«æè¡Œæ•°åˆæ˜¯å¤šå°‘å‘¢ï¼Ÿ</p><p>è¿™æ—¶å€™ï¼Œæˆ‘ä»¬å†çœ‹æ…¢æŸ¥è¯¢æ—¥å¿—å°±ä¼šå‘ç°ä¸å¯¹äº†ã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/6f90b04c09188bff11dae6e788abb918-1584367406953.png" alt="img"></p><p>å›¾ 3 æ…¢æŸ¥è¯¢æ—¥å¿— -- å°†æ•°æ®æ’å…¥è¡¨ t</p><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™æ—¶å€™çš„ Rows_examined çš„å€¼æ˜¯ 5ã€‚</p><p>æˆ‘åœ¨å‰é¢çš„æ–‡ç« ä¸­æåˆ°è¿‡ï¼Œå¸Œæœ›ä½ éƒ½èƒ½å¤Ÿå­¦ä¼šç”¨ explain çš„ç»“æœæ¥â€œè„‘è¡¥â€æ•´æ¡è¯­å¥çš„æ‰§è¡Œè¿‡ç¨‹ã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬å°±æ¥ä¸€èµ·è¯•è¯•ã€‚</p><p>å¦‚å›¾ 4 æ‰€ç¤ºå°±æ˜¯è¿™æ¡è¯­å¥çš„ explain ç»“æœã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/d7270781ee3f216325b73bd53999b82a-1584367406953.png" alt="img"></p><p>å›¾ 4 explain ç»“æœ</p><p>ä» Extra å­—æ®µå¯ä»¥çœ‹åˆ°â€œUsing temporaryâ€å­—æ ·ï¼Œè¡¨ç¤ºè¿™ä¸ªè¯­å¥ç”¨åˆ°äº†ä¸´æ—¶è¡¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œéœ€è¦æŠŠè¡¨ t çš„å†…å®¹è¯»å‡ºæ¥ï¼Œå†™å…¥ä¸´æ—¶è¡¨ã€‚</p><p>å›¾ä¸­ rows æ˜¾ç¤ºçš„æ˜¯ 1ï¼Œæˆ‘ä»¬ä¸å¦¨å…ˆå¯¹è¿™ä¸ªè¯­å¥çš„æ‰§è¡Œæµç¨‹åšä¸€ä¸ªçŒœæµ‹ï¼šå¦‚æœè¯´æ˜¯æŠŠå­æŸ¥è¯¢çš„ç»“æœè¯»å‡ºæ¥ï¼ˆæ‰«æ 1 è¡Œï¼‰ï¼Œå†™å…¥ä¸´æ—¶è¡¨ï¼Œç„¶åå†ä»ä¸´æ—¶è¡¨è¯»å‡ºæ¥ï¼ˆæ‰«æ 1 è¡Œï¼‰ï¼Œå†™å›è¡¨ t ä¸­ã€‚é‚£ä¹ˆï¼Œè¿™ä¸ªè¯­å¥çš„æ‰«æè¡Œæ•°å°±åº”è¯¥æ˜¯ 2ï¼Œè€Œä¸æ˜¯ 5ã€‚</p><p>æ‰€ä»¥ï¼Œè¿™ä¸ªçŒœæµ‹ä¸å¯¹ã€‚å®é™…ä¸Šï¼ŒExplain ç»“æœé‡Œçš„ rows=1 æ˜¯å› ä¸ºå—åˆ°äº† limit 1 çš„å½±å“ã€‚</p><p>ä»å¦ä¸€ä¸ªè§’åº¦è€ƒè™‘çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹çœ‹ InnoDB æ‰«æäº†å¤šå°‘è¡Œã€‚å¦‚å›¾ 5 æ‰€ç¤ºï¼Œæ˜¯åœ¨æ‰§è¡Œè¿™ä¸ªè¯­å¥å‰åæŸ¥çœ‹ Innodb_rows_read çš„ç»“æœã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/489281d8029e8f60979cb7c4494010d7-1584367406953.png" alt="img"></p><p>å›¾ 5 æŸ¥çœ‹ Innodb_rows_read å˜åŒ–</p><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªè¯­å¥æ‰§è¡Œå‰åï¼ŒInnodb_rows_read çš„å€¼å¢åŠ äº† 4ã€‚å› ä¸ºé»˜è®¤ä¸´æ—¶è¡¨æ˜¯ä½¿ç”¨ Memory å¼•æ“çš„ï¼Œæ‰€ä»¥è¿™ 4 è¡ŒæŸ¥çš„éƒ½æ˜¯è¡¨ tï¼Œä¹Ÿå°±æ˜¯è¯´å¯¹è¡¨ t åšäº†å…¨è¡¨æ‰«æã€‚</p><p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±æŠŠæ•´ä¸ªæ‰§è¡Œè¿‡ç¨‹ç†æ¸…æ¥šäº†ï¼š</p><ol><li>åˆ›å»ºä¸´æ—¶è¡¨ï¼Œè¡¨é‡Œæœ‰ä¸¤ä¸ªå­—æ®µ c å’Œ dã€‚</li><li>æŒ‰ç…§ç´¢å¼• c æ‰«æè¡¨ tï¼Œä¾æ¬¡å– c=4ã€3ã€2ã€1ï¼Œç„¶åå›è¡¨ï¼Œè¯»åˆ° c å’Œ d çš„å€¼å†™å…¥ä¸´æ—¶è¡¨ã€‚è¿™æ—¶ï¼ŒRows_examined=4ã€‚</li><li>ç”±äºè¯­ä¹‰é‡Œé¢æœ‰ limit 1ï¼Œæ‰€ä»¥åªå–äº†ä¸´æ—¶è¡¨çš„ç¬¬ä¸€è¡Œï¼Œå†æ’å…¥åˆ°è¡¨ t ä¸­ã€‚è¿™æ—¶ï¼ŒRows_examined çš„å€¼åŠ  1ï¼Œå˜æˆäº† 5ã€‚</li></ol><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªè¯­å¥ä¼šå¯¼è‡´åœ¨è¡¨ t ä¸Šåšå…¨è¡¨æ‰«æï¼Œå¹¶ä¸”ä¼šç»™ç´¢å¼• c ä¸Šçš„æ‰€æœ‰é—´éš™éƒ½åŠ ä¸Šå…±äº«çš„ next-key lockã€‚æ‰€ä»¥ï¼Œè¿™ä¸ªè¯­å¥æ‰§è¡ŒæœŸé—´ï¼Œå…¶ä»–äº‹åŠ¡ä¸èƒ½åœ¨è¿™ä¸ªè¡¨ä¸Šæ’å…¥æ•°æ®ã€‚</p><p>è‡³äºè¿™ä¸ªè¯­å¥çš„æ‰§è¡Œä¸ºä»€ä¹ˆéœ€è¦ä¸´æ—¶è¡¨ï¼ŒåŸå› æ˜¯è¿™ç±»ä¸€è¾¹éå†æ•°æ®ï¼Œä¸€è¾¹æ›´æ–°æ•°æ®çš„æƒ…å†µï¼Œå¦‚æœè¯»å‡ºæ¥çš„æ•°æ®ç›´æ¥å†™å›åŸè¡¨ï¼Œå°±å¯èƒ½åœ¨éå†è¿‡ç¨‹ä¸­ï¼Œè¯»åˆ°åˆšåˆšæ’å…¥çš„è®°å½•ï¼Œæ–°æ’å…¥çš„è®°å½•å¦‚æœå‚ä¸è®¡ç®—é€»è¾‘ï¼Œå°±è·Ÿè¯­ä¹‰ä¸ç¬¦ã€‚</p><p>ç”±äºå®ç°ä¸Šè¿™ä¸ªè¯­å¥æ²¡æœ‰åœ¨å­æŸ¥è¯¢ä¸­å°±ç›´æ¥ä½¿ç”¨ limit 1ï¼Œä»è€Œå¯¼è‡´äº†è¿™ä¸ªè¯­å¥çš„æ‰§è¡Œéœ€è¦éå†æ•´ä¸ªè¡¨ tã€‚å®ƒçš„ä¼˜åŒ–æ–¹æ³•ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯ç”¨å‰é¢ä»‹ç»çš„æ–¹æ³•ï¼Œå…ˆ insert into åˆ°ä¸´æ—¶è¡¨ temp_tï¼Œè¿™æ ·å°±åªéœ€è¦æ‰«æä¸€è¡Œï¼›ç„¶åå†ä»è¡¨ temp_t é‡Œé¢å–å‡ºè¿™è¡Œæ•°æ®æ’å…¥è¡¨ t1ã€‚</p><p>å½“ç„¶ï¼Œç”±äºè¿™ä¸ªè¯­å¥æ¶‰åŠçš„æ•°æ®é‡å¾ˆå°ï¼Œä½ å¯ä»¥è€ƒè™‘ä½¿ç”¨å†…å­˜ä¸´æ—¶è¡¨æ¥åšè¿™ä¸ªä¼˜åŒ–ã€‚ä½¿ç”¨å†…å­˜ä¸´æ—¶è¡¨ä¼˜åŒ–æ—¶ï¼Œè¯­å¥åºåˆ—çš„å†™æ³•å¦‚ä¸‹ï¼š</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">temporary</span> <span class="token keyword">table</span> temp_t<span class="token punctuation">(</span>c <span class="token keyword">int</span><span class="token punctuation">,</span>d <span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token keyword">engine</span><span class="token operator">=</span>memory<span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> temp_t  <span class="token punctuation">(</span><span class="token keyword">select</span> c<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> d <span class="token keyword">from</span> t <span class="token keyword">force</span> <span class="token keyword">index</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token keyword">order</span> <span class="token keyword">by</span> c <span class="token keyword">desc</span> <span class="token keyword">limit</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> t <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> temp_t<span class="token punctuation">;</span>
<span class="token keyword">drop</span> <span class="token keyword">table</span> temp_t<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="insert-å”¯ä¸€é”®å†²çª" tabindex="-1"><a class="header-anchor" href="#insert-å”¯ä¸€é”®å†²çª" aria-hidden="true">#</a> insert å”¯ä¸€é”®å†²çª</h4><p>å‰é¢çš„ä¸¤ä¸ªä¾‹å­æ˜¯ä½¿ç”¨ insert â€¦ select çš„æƒ…å†µï¼Œæ¥ä¸‹æ¥æˆ‘è¦ä»‹ç»çš„è¿™ä¸ªä¾‹å­å°±æ˜¯æœ€å¸¸è§çš„ insert è¯­å¥å‡ºç°å”¯ä¸€é”®å†²çªçš„æƒ…å†µã€‚</p><p>å¯¹äºæœ‰å”¯ä¸€é”®çš„è¡¨ï¼Œæ’å…¥æ•°æ®æ—¶å‡ºç°å”¯ä¸€é”®å†²çªä¹Ÿæ˜¯å¸¸è§çš„æƒ…å†µäº†ã€‚æˆ‘å…ˆç»™ä½ ä¸¾ä¸€ä¸ªç®€å•çš„å”¯ä¸€é”®å†²çªçš„ä¾‹å­ã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/83fb2d877932941b230d6b5be8cca6ca-1584367406954.png" alt="img"></p><p>å›¾ 6 å”¯ä¸€é”®å†²çªåŠ é”</p><p>è¿™ä¸ªä¾‹å­ä¹Ÿæ˜¯åœ¨å¯é‡å¤è¯»ï¼ˆrepeatable readï¼‰éš”ç¦»çº§åˆ«ä¸‹æ‰§è¡Œçš„ã€‚å¯ä»¥çœ‹åˆ°ï¼Œsession B è¦æ‰§è¡Œçš„ insert è¯­å¥è¿›å…¥äº†é”ç­‰å¾…çŠ¶æ€ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œsession A æ‰§è¡Œçš„ insert è¯­å¥ï¼Œå‘ç”Ÿå”¯ä¸€é”®å†²çªçš„æ—¶å€™ï¼Œå¹¶ä¸åªæ˜¯ç®€å•åœ°æŠ¥é”™è¿”å›ï¼Œè¿˜åœ¨å†²çªçš„ç´¢å¼•ä¸ŠåŠ äº†é”ã€‚æˆ‘ä»¬å‰é¢è¯´è¿‡ï¼Œä¸€ä¸ª next-key lock å°±æ˜¯ç”±å®ƒå³è¾¹ç•Œçš„å€¼å®šä¹‰çš„ã€‚è¿™æ—¶å€™ï¼Œsession A æŒæœ‰ç´¢å¼• c ä¸Šçš„ (5,10] å…±äº« next-key lockï¼ˆè¯»é”ï¼‰ã€‚</p><p>è‡³äºä¸ºä»€ä¹ˆè¦åŠ è¿™ä¸ªè¯»é”ï¼Œå…¶å®æˆ‘ä¹Ÿæ²¡æœ‰æ‰¾åˆ°åˆç†çš„è§£é‡Šã€‚ä»ä½œç”¨ä¸Šæ¥çœ‹ï¼Œè¿™æ ·åšå¯ä»¥é¿å…è¿™ä¸€è¡Œè¢«åˆ«çš„äº‹åŠ¡åˆ æ‰ã€‚</p><p>è¿™é‡Œ<a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-locks-set.html" target="_blank" rel="noopener noreferrer">å®˜æ–¹æ–‡æ¡£<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>æœ‰ä¸€ä¸ªæè¿°é”™è¯¯ï¼Œè®¤ä¸ºå¦‚æœå†²çªçš„æ˜¯ä¸»é”®ç´¢å¼•ï¼Œå°±åŠ è®°å½•é”ï¼Œå”¯ä¸€ç´¢å¼•æ‰åŠ  next-key lockã€‚ä½†å®é™…ä¸Šï¼Œè¿™ä¸¤ç±»ç´¢å¼•å†²çªåŠ çš„éƒ½æ˜¯ next-key lockã€‚</p><blockquote><p>å¤‡æ³¨ï¼šè¿™ä¸ª bugï¼Œæ˜¯æˆ‘åœ¨å†™è¿™ç¯‡æ–‡ç« æŸ¥é˜…æ–‡æ¡£æ—¶å‘ç°çš„ï¼Œå·²ç»<a href="https://bugs.mysql.com/bug.php?id=93806" target="_blank" rel="noopener noreferrer">å‘ç»™å®˜æ–¹<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>å¹¶è¢« verified äº†ã€‚</p></blockquote><p>æœ‰åŒå­¦åœ¨å‰é¢æ–‡ç« çš„è¯„è®ºåŒºé—®åˆ°ï¼Œåœ¨æœ‰å¤šä¸ªå”¯ä¸€ç´¢å¼•çš„è¡¨ä¸­å¹¶å‘æ’å…¥æ•°æ®æ—¶ï¼Œä¼šå‡ºç°æ­»é”ã€‚ä½†æ˜¯ï¼Œç”±äºä»–æ²¡æœ‰æä¾›å¤ç°æ–¹æ³•æˆ–è€…ç°åœºï¼Œæˆ‘ä¹Ÿæ— æ³•åšåˆ†æã€‚æ‰€ä»¥ï¼Œæˆ‘å»ºè®®ä½ åœ¨è¯„è®ºåŒºå‘é—®é¢˜çš„æ—¶å€™ï¼Œå°½é‡åŒæ—¶é™„ä¸Šå¤ç°æ–¹æ³•ï¼Œæˆ–è€…ç°åœºä¿¡æ¯ï¼Œè¿™æ ·æˆ‘æ‰å¥½å’Œä½ ä¸€èµ·åˆ†æé—®é¢˜ã€‚</p><p>è¿™é‡Œï¼Œæˆ‘å°±å…ˆå’Œä½ åˆ†äº«ä¸€ä¸ªç»å…¸çš„æ­»é”åœºæ™¯ï¼Œå¦‚æœä½ è¿˜é‡åˆ°è¿‡å…¶ä»–å”¯ä¸€é”®å†²çªå¯¼è‡´çš„æ­»é”åœºæ™¯ï¼Œä¹Ÿæ¬¢è¿ç»™æˆ‘ç•™è¨€ã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/63658eb26e7a03b49f123fceed94cd2d-1584367406954.png" alt="img"></p><p>å›¾ 7 å”¯ä¸€é”®å†²çª -- æ­»é”</p><p>åœ¨ session A æ‰§è¡Œ rollback è¯­å¥å›æ»šçš„æ—¶å€™ï¼Œsession C å‡ ä¹åŒæ—¶å‘ç°æ­»é”å¹¶è¿”å›ã€‚</p><p>è¿™ä¸ªæ­»é”äº§ç”Ÿçš„é€»è¾‘æ˜¯è¿™æ ·çš„ï¼š</p><ol><li>åœ¨ T1 æ—¶åˆ»ï¼Œå¯åŠ¨ session Aï¼Œå¹¶æ‰§è¡Œ insert è¯­å¥ï¼Œæ­¤æ—¶åœ¨ç´¢å¼• c çš„ c=5 ä¸ŠåŠ äº†è®°å½•é”ã€‚æ³¨æ„ï¼Œè¿™ä¸ªç´¢å¼•æ˜¯å”¯ä¸€ç´¢å¼•ï¼Œå› æ­¤é€€åŒ–ä¸ºè®°å½•é”ï¼ˆå¦‚æœä½ çš„å°è±¡æ¨¡ç³Šäº†ï¼Œå¯ä»¥å›é¡¾ä¸‹[ç¬¬ 21 ç¯‡æ–‡ç« ]ä»‹ç»çš„åŠ é”è§„åˆ™ï¼‰ã€‚</li><li>åœ¨ T2 æ—¶åˆ»ï¼Œsession B è¦æ‰§è¡Œç›¸åŒçš„ insert è¯­å¥ï¼Œå‘ç°äº†å”¯ä¸€é”®å†²çªï¼ŒåŠ ä¸Šè¯»é”ï¼›åŒæ ·åœ°ï¼Œsession C ä¹Ÿåœ¨ç´¢å¼• c ä¸Šï¼Œc=5 è¿™ä¸€ä¸ªè®°å½•ä¸Šï¼ŒåŠ äº†è¯»é”ã€‚</li><li>T3 æ—¶åˆ»ï¼Œsession A å›æ»šã€‚è¿™æ—¶å€™ï¼Œsession B å’Œ session C éƒ½è¯•å›¾ç»§ç»­æ‰§è¡Œæ’å…¥æ“ä½œï¼Œéƒ½è¦åŠ ä¸Šå†™é”ã€‚ä¸¤ä¸ª session éƒ½è¦ç­‰å¾…å¯¹æ–¹çš„è¡Œé”ï¼Œæ‰€ä»¥å°±å‡ºç°äº†æ­»é”ã€‚</li></ol><p>è¿™ä¸ªæµç¨‹çš„çŠ¶æ€å˜åŒ–å›¾å¦‚ä¸‹æ‰€ç¤ºã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/3e0bf1a1241931c14360e73fd10032b8-1584367406954.jpg" alt="img"></p><p>å›¾ 8 çŠ¶æ€å˜åŒ–å›¾ -- æ­»é”</p><h4 id="insert-into-on-duplicate-key-update" tabindex="-1"><a class="header-anchor" href="#insert-into-on-duplicate-key-update" aria-hidden="true">#</a> insert into â€¦ on duplicate key update</h4><p>ä¸Šé¢è¿™ä¸ªä¾‹å­æ˜¯ä¸»é”®å†²çªåç›´æ¥æŠ¥é”™ï¼Œå¦‚æœæ˜¯æ”¹å†™æˆ</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">insert</span> <span class="token keyword">into</span> t <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">on</span> <span class="token keyword">duplicate</span> <span class="token keyword">key</span> <span class="token keyword">update</span> d<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">;</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>çš„è¯ï¼Œå°±ä¼šç»™ç´¢å¼• c ä¸Š (5,10] åŠ ä¸€ä¸ªæ’ä»–çš„ next-key lockï¼ˆå†™é”ï¼‰ã€‚</p><p><strong>insert into â€¦ on duplicate key update è¿™ä¸ªè¯­ä¹‰çš„é€»è¾‘æ˜¯ï¼Œæ’å…¥ä¸€è¡Œæ•°æ®ï¼Œå¦‚æœç¢°åˆ°å”¯ä¸€é”®çº¦æŸï¼Œå°±æ‰§è¡Œåé¢çš„æ›´æ–°è¯­å¥ã€‚</strong></p><p>æ³¨æ„ï¼Œå¦‚æœæœ‰å¤šä¸ªåˆ—è¿åäº†å”¯ä¸€æ€§çº¦æŸï¼Œå°±ä¼šæŒ‰ç…§ç´¢å¼•çš„é¡ºåºï¼Œä¿®æ”¹è·Ÿç¬¬ä¸€ä¸ªç´¢å¼•å†²çªçš„è¡Œã€‚</p><p>ç°åœ¨è¡¨ t é‡Œé¢å·²ç»æœ‰äº† (1,1,1) å’Œ (2,2,2) è¿™ä¸¤è¡Œï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹ä¸‹é¢è¿™ä¸ªè¯­å¥æ‰§è¡Œçš„æ•ˆæœï¼š</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/5f384d6671c87a60e1ec7e490447d702-1584367407242.png" alt="img"></p><p>å›¾ 9 ä¸¤ä¸ªå”¯ä¸€é”®åŒæ—¶å†²çª</p><p>å¯ä»¥çœ‹åˆ°ï¼Œä¸»é”® id æ˜¯å…ˆåˆ¤æ–­çš„ï¼ŒMySQL è®¤ä¸ºè¿™ä¸ªè¯­å¥è·Ÿ id=2 è¿™ä¸€è¡Œå†²çªï¼Œæ‰€ä»¥ä¿®æ”¹çš„æ˜¯ id=2 çš„è¡Œã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ‰§è¡Œè¿™æ¡è¯­å¥çš„ affected rows è¿”å›çš„æ˜¯ 2ï¼Œå¾ˆå®¹æ˜“é€ æˆè¯¯è§£ã€‚å®é™…ä¸Šï¼ŒçœŸæ­£æ›´æ–°çš„åªæœ‰ä¸€è¡Œï¼Œåªæ˜¯åœ¨ä»£ç å®ç°ä¸Šï¼Œinsert å’Œ update éƒ½è®¤ä¸ºè‡ªå·±æˆåŠŸäº†ï¼Œupdate è®¡æ•°åŠ äº† 1ï¼Œ insert è®¡æ•°ä¹ŸåŠ äº† 1ã€‚</p><h4 id="å°ç»“-25" tabindex="-1"><a class="header-anchor" href="#å°ç»“-25" aria-hidden="true">#</a> å°ç»“</h4><p>ä»Šå¤©è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘å’Œä½ ä»‹ç»äº†å‡ ç§ç‰¹æ®Šæƒ…å†µä¸‹çš„ insert è¯­å¥ã€‚</p><p>insert â€¦ select æ˜¯å¾ˆå¸¸è§çš„åœ¨ä¸¤ä¸ªè¡¨ä¹‹é—´æ‹·è´æ•°æ®çš„æ–¹æ³•ã€‚ä½ éœ€è¦æ³¨æ„ï¼Œåœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹ï¼Œè¿™ä¸ªè¯­å¥ä¼šç»™ select çš„è¡¨é‡Œæ‰«æåˆ°çš„è®°å½•å’Œé—´éš™åŠ è¯»é”ã€‚</p><p>è€Œå¦‚æœ insert å’Œ select çš„å¯¹è±¡æ˜¯åŒä¸€ä¸ªè¡¨ï¼Œåˆ™æœ‰å¯èƒ½ä¼šé€ æˆå¾ªç¯å†™å…¥ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦å¼•å…¥ç”¨æˆ·ä¸´æ—¶è¡¨æ¥åšä¼˜åŒ–ã€‚</p><p>insert è¯­å¥å¦‚æœå‡ºç°å”¯ä¸€é”®å†²çªï¼Œä¼šåœ¨å†²çªçš„å”¯ä¸€å€¼ä¸ŠåŠ å…±äº«çš„ next-key lock(S é”)ã€‚å› æ­¤ï¼Œç¢°åˆ°ç”±äºå”¯ä¸€é”®çº¦æŸå¯¼è‡´æŠ¥é”™åï¼Œè¦å°½å¿«æäº¤æˆ–å›æ»šäº‹åŠ¡ï¼Œé¿å…åŠ é”æ—¶é—´è¿‡é•¿ã€‚</p><p>æœ€åï¼Œæˆ‘ç»™ä½ ç•™ä¸€ä¸ªé—®é¢˜å§ã€‚</p><p>ä½ å¹³æ—¶åœ¨ä¸¤ä¸ªè¡¨ä¹‹é—´æ‹·è´æ•°æ®ç”¨çš„æ˜¯ä»€ä¹ˆæ–¹æ³•ï¼Œæœ‰ä»€ä¹ˆæ³¨æ„äº‹é¡¹å—ï¼Ÿåœ¨ä½ çš„åº”ç”¨åœºæ™¯é‡Œï¼Œè¿™ä¸ªæ–¹æ³•ï¼Œç›¸è¾ƒäºå…¶ä»–æ–¹æ³•çš„ä¼˜åŠ¿æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><p>ä½ å¯ä»¥æŠŠä½ çš„ç»éªŒå’Œåˆ†æå†™åœ¨è¯„è®ºåŒºï¼Œæˆ‘ä¼šåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« çš„æœ«å°¾é€‰å–æœ‰è¶£çš„è¯„è®ºæ¥å’Œä½ ä¸€èµ·åˆ†æã€‚æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚</p><h4 id="ä¸ŠæœŸé—®é¢˜æ—¶é—´-22" tabindex="-1"><a class="header-anchor" href="#ä¸ŠæœŸé—®é¢˜æ—¶é—´-22" aria-hidden="true">#</a> ä¸ŠæœŸé—®é¢˜æ—¶é—´</h4><p>æˆ‘ä»¬å·²ç»åœ¨æ–‡ç« ä¸­å›ç­”äº†ä¸ŠæœŸé—®é¢˜ã€‚</p><p>æœ‰åŒå­¦æåˆ°ï¼Œå¦‚æœåœ¨ insert â€¦ select æ‰§è¡ŒæœŸé—´æœ‰å…¶ä»–çº¿ç¨‹æ“ä½œåŸè¡¨ï¼Œä¼šå¯¼è‡´é€»è¾‘é”™è¯¯ã€‚å…¶å®ï¼Œè¿™æ˜¯ä¸ä¼šçš„ï¼Œå¦‚æœä¸åŠ é”ï¼Œå°±æ˜¯å¿«ç…§è¯»ã€‚</p><p>ä¸€æ¡è¯­å¥æ‰§è¡ŒæœŸé—´ï¼Œå®ƒçš„ä¸€è‡´æ€§è§†å›¾æ˜¯ä¸ä¼šä¿®æ”¹çš„ï¼Œæ‰€ä»¥å³ä½¿æœ‰å…¶ä»–äº‹åŠ¡ä¿®æ”¹äº†åŸè¡¨çš„æ•°æ®ï¼Œä¹Ÿä¸ä¼šå½±å“è¿™æ¡è¯­å¥çœ‹åˆ°çš„æ•°æ®ã€‚</p><p>è¯„è®ºåŒºç•™è¨€ç‚¹èµæ¿ï¼š</p><blockquote><p>@é•¿æ° åŒå­¦å›ç­”å¾—éå¸¸å‡†ç¡®ã€‚</p></blockquote><h3 id="_41-æ€ä¹ˆæœ€å¿«åœ°å¤åˆ¶ä¸€å¼ è¡¨" tabindex="-1"><a class="header-anchor" href="#_41-æ€ä¹ˆæœ€å¿«åœ°å¤åˆ¶ä¸€å¼ è¡¨" aria-hidden="true">#</a> 41 æ€ä¹ˆæœ€å¿«åœ°å¤åˆ¶ä¸€å¼ è¡¨ï¼Ÿ</h3><p>æˆ‘åœ¨ä¸Šä¸€ç¯‡æ–‡ç« æœ€åï¼Œç»™ä½ ç•™ä¸‹çš„é—®é¢˜æ˜¯æ€ä¹ˆåœ¨ä¸¤å¼ è¡¨ä¸­æ‹·è´æ•°æ®ã€‚å¦‚æœå¯ä»¥æ§åˆ¶å¯¹æºè¡¨çš„æ‰«æè¡Œæ•°å’ŒåŠ é”èŒƒå›´å¾ˆå°çš„è¯ï¼Œæˆ‘ä»¬ç®€å•åœ°ä½¿ç”¨ insert â€¦ select è¯­å¥å³å¯å®ç°ã€‚</p><p>å½“ç„¶ï¼Œä¸ºäº†é¿å…å¯¹æºè¡¨åŠ è¯»é”ï¼Œæ›´ç¨³å¦¥çš„æ–¹æ¡ˆæ˜¯å…ˆå°†æ•°æ®å†™åˆ°å¤–éƒ¨æ–‡æœ¬æ–‡ä»¶ï¼Œç„¶åå†å†™å›ç›®æ ‡è¡¨ã€‚è¿™æ—¶ï¼Œæœ‰ä¸¤ç§å¸¸ç”¨çš„æ–¹æ³•ã€‚æ¥ä¸‹æ¥çš„å†…å®¹ï¼Œæˆ‘ä¼šå’Œä½ è¯¦ç»†å±•å¼€ä¸€ä¸‹è¿™ä¸¤ç§æ–¹æ³•ã€‚</p><p>ä¸ºäº†ä¾¿äºè¯´æ˜ï¼Œæˆ‘è¿˜æ˜¯å…ˆåˆ›å»ºä¸€ä¸ªè¡¨ db1.tï¼Œå¹¶æ’å…¥ 1000 è¡Œæ•°æ®ï¼ŒåŒæ—¶åˆ›å»ºä¸€ä¸ªç›¸åŒç»“æ„çš„è¡¨ db2.tã€‚</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">database</span> db1<span class="token punctuation">;</span>
<span class="token keyword">use</span> db1<span class="token punctuation">;</span> 
<span class="token keyword">create</span> <span class="token keyword">table</span> t<span class="token punctuation">(</span>id <span class="token keyword">int</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span> a <span class="token keyword">int</span><span class="token punctuation">,</span> b <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">index</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">engine</span><span class="token operator">=</span><span class="token keyword">innodb</span><span class="token punctuation">;</span>
<span class="token keyword">delimiter</span> <span class="token punctuation">;</span><span class="token punctuation">;</span>
  <span class="token keyword">create</span> <span class="token keyword">procedure</span> idata<span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">begin</span>
    <span class="token keyword">declare</span> i <span class="token keyword">int</span><span class="token punctuation">;</span>
    <span class="token keyword">set</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>i<span class="token operator">&lt;=</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token keyword">do</span>
      <span class="token keyword">insert</span> <span class="token keyword">into</span> t <span class="token keyword">values</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>i<span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">set</span> i<span class="token operator">=</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span> <span class="token keyword">while</span><span class="token punctuation">;</span>
  <span class="token keyword">end</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">delimiter</span> <span class="token punctuation">;</span>
<span class="token keyword">call</span> idata<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">create</span> <span class="token keyword">database</span> db2<span class="token punctuation">;</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> db2<span class="token punctuation">.</span>t <span class="token operator">like</span> db1<span class="token punctuation">.</span>t
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å‡è®¾ï¼Œæˆ‘ä»¬è¦æŠŠ db1.t é‡Œé¢ a&gt;900 çš„æ•°æ®è¡Œå¯¼å‡ºæ¥ï¼Œæ’å…¥åˆ° db2.t ä¸­ã€‚</p><h4 id="mysqldump-æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#mysqldump-æ–¹æ³•" aria-hidden="true">#</a> mysqldump æ–¹æ³•</h4><p>ä¸€ç§æ–¹æ³•æ˜¯ï¼Œä½¿ç”¨ mysqldump å‘½ä»¤å°†æ•°æ®å¯¼å‡ºæˆä¸€ç»„ INSERT è¯­å¥ã€‚ä½ å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysqldump -h<span class="token variable">$host</span> -P<span class="token variable">$port</span> -u<span class="token variable">$user</span> --add-locks<span class="token operator">=</span><span class="token number">0</span> --no-create-info --single-transaction  --set-gtid-purged<span class="token operator">=</span>OFF db1 t <span class="token parameter variable">--where</span><span class="token operator">=</span><span class="token string">&quot;a&gt;900&quot;</span> --result-file<span class="token operator">=</span>/client_tmp/t.sql
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æŠŠç»“æœè¾“å‡ºåˆ°ä¸´æ—¶æ–‡ä»¶ã€‚</p><p>è¿™æ¡å‘½ä»¤ä¸­ï¼Œä¸»è¦å‚æ•°å«ä¹‰å¦‚ä¸‹ï¼š</p><ol><li>â€“single-transaction çš„ä½œç”¨æ˜¯ï¼Œåœ¨å¯¼å‡ºæ•°æ®çš„æ—¶å€™ä¸éœ€è¦å¯¹è¡¨ db1.t åŠ è¡¨é”ï¼Œè€Œæ˜¯ä½¿ç”¨ START TRANSACTION WITH CONSISTENT SNAPSHOT çš„æ–¹æ³•ï¼›</li><li>â€“add-locks è®¾ç½®ä¸º 0ï¼Œè¡¨ç¤ºåœ¨è¾“å‡ºçš„æ–‡ä»¶ç»“æœé‡Œï¼Œä¸å¢åŠ &quot; LOCK TABLES <code>t</code> WRITE;&quot; ï¼›</li><li>â€“no-create-info çš„æ„æ€æ˜¯ï¼Œä¸éœ€è¦å¯¼å‡ºè¡¨ç»“æ„ï¼›</li><li>â€“set-gtid-purged=off è¡¨ç¤ºçš„æ˜¯ï¼Œä¸è¾“å‡ºè·Ÿ GTID ç›¸å…³çš„ä¿¡æ¯ï¼›</li><li>â€“result-file æŒ‡å®šäº†è¾“å‡ºæ–‡ä»¶çš„è·¯å¾„ï¼Œå…¶ä¸­ client è¡¨ç¤ºç”Ÿæˆçš„æ–‡ä»¶æ˜¯åœ¨å®¢æˆ·ç«¯æœºå™¨ä¸Šçš„ã€‚</li></ol><p>é€šè¿‡è¿™æ¡ mysqldump å‘½ä»¤ç”Ÿæˆçš„ t.sql æ–‡ä»¶ä¸­å°±åŒ…å«äº†å¦‚å›¾ 1 æ‰€ç¤ºçš„ INSERT è¯­å¥ã€‚</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/8acdcefcaf5c9940570bf7e8f73dbdde-1584367407247.png" alt="img"></p><p>å›¾ 1 mysqldump è¾“å‡ºæ–‡ä»¶çš„éƒ¨åˆ†ç»“æœ</p><p>å¯ä»¥çœ‹åˆ°ï¼Œä¸€æ¡ INSERT è¯­å¥é‡Œé¢ä¼šåŒ…å«å¤šä¸ª value å¯¹ï¼Œè¿™æ˜¯ä¸ºäº†åç»­ç”¨è¿™ä¸ªæ–‡ä»¶æ¥å†™å…¥æ•°æ®çš„æ—¶å€™ï¼Œæ‰§è¡Œé€Ÿåº¦å¯ä»¥æ›´å¿«ã€‚</p><p>å¦‚æœä½ å¸Œæœ›ç”Ÿæˆçš„æ–‡ä»¶ä¸­ä¸€æ¡ INSERT è¯­å¥åªæ’å…¥ä¸€è¡Œæ•°æ®çš„è¯ï¼Œå¯ä»¥åœ¨æ‰§è¡Œ mysqldump å‘½ä»¤æ—¶ï¼ŒåŠ ä¸Šå‚æ•°â€“skip-extended-insertã€‚</p><p>ç„¶åï¼Œä½ å¯ä»¥é€šè¿‡ä¸‹é¢è¿™æ¡å‘½ä»¤ï¼Œå°†è¿™äº› INSERT è¯­å¥æ”¾åˆ° db2 åº“é‡Œå»æ‰§è¡Œã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysql <span class="token parameter variable">-h127.0.0.1</span> <span class="token parameter variable">-P13000</span>  <span class="token parameter variable">-uroot</span> db2 <span class="token parameter variable">-e</span> <span class="token string">&quot;source /client_tmp/t.sql&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œsource å¹¶ä¸æ˜¯ä¸€æ¡ SQL è¯­å¥ï¼Œè€Œæ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯å‘½ä»¤ã€‚mysql å®¢æˆ·ç«¯æ‰§è¡Œè¿™ä¸ªå‘½ä»¤çš„æµç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><ol><li>æ‰“å¼€æ–‡ä»¶ï¼Œé»˜è®¤ä»¥åˆ†å·ä¸ºç»“å°¾è¯»å–ä¸€æ¡æ¡çš„ SQL è¯­å¥ï¼›</li><li>å°† SQL è¯­å¥å‘é€åˆ°æœåŠ¡ç«¯æ‰§è¡Œã€‚</li></ol><p>ä¹Ÿå°±æ˜¯è¯´ï¼ŒæœåŠ¡ç«¯æ‰§è¡Œçš„å¹¶ä¸æ˜¯è¿™ä¸ªâ€œsource t.sql&quot;è¯­å¥ï¼Œè€Œæ˜¯ INSERT è¯­å¥ã€‚æ‰€ä»¥ï¼Œä¸è®ºæ˜¯åœ¨æ…¢æŸ¥è¯¢æ—¥å¿—ï¼ˆslow logï¼‰ï¼Œè¿˜æ˜¯åœ¨ binlogï¼Œè®°å½•çš„éƒ½æ˜¯è¿™äº›è¦è¢«çœŸæ­£æ‰§è¡Œçš„ INSERT è¯­å¥ã€‚</p><h4 id="å¯¼å‡º-csv-æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#å¯¼å‡º-csv-æ–‡ä»¶" aria-hidden="true">#</a> å¯¼å‡º CSV æ–‡ä»¶</h4><p>å¦ä¸€ç§æ–¹æ³•æ˜¯ç›´æ¥å°†ç»“æœå¯¼å‡ºæˆ.csv æ–‡ä»¶ã€‚MySQL æä¾›äº†ä¸‹é¢çš„è¯­æ³•ï¼Œç”¨æ¥å°†æŸ¥è¯¢ç»“æœå¯¼å‡ºåˆ°æœåŠ¡ç«¯æœ¬åœ°ç›®å½•ï¼š</p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> db1<span class="token punctuation">.</span>t <span class="token keyword">where</span> <span class="token class-name">a</span><span class="token operator">&gt;</span><span class="token number">900</span> <span class="token keyword">into</span> outfile &#39;<span class="token operator">/</span>server_tmp<span class="token operator">/</span>t<span class="token punctuation">.</span>csv&#39;<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æˆ‘ä»¬åœ¨ä½¿ç”¨è¿™æ¡è¯­å¥æ—¶ï¼Œéœ€è¦æ³¨æ„å¦‚ä¸‹å‡ ç‚¹ã€‚</p><ol><li>è¿™æ¡è¯­å¥ä¼šå°†ç»“æœä¿å­˜åœ¨æœåŠ¡ç«¯ã€‚å¦‚æœä½ æ‰§è¡Œå‘½ä»¤çš„å®¢æˆ·ç«¯å’Œ MySQL æœåŠ¡ç«¯ä¸åœ¨åŒä¸€ä¸ªæœºå™¨ä¸Šï¼Œå®¢æˆ·ç«¯æœºå™¨çš„ä¸´æ—¶ç›®å½•ä¸‹æ˜¯ä¸ä¼šç”Ÿæˆ t.csv æ–‡ä»¶çš„ã€‚</li><li>into outfile æŒ‡å®šäº†æ–‡ä»¶çš„ç”Ÿæˆä½ç½®ï¼ˆ/server_tmp/ï¼‰ï¼Œè¿™ä¸ªä½ç½®å¿…é¡»å—å‚æ•° secure_file_priv çš„é™åˆ¶ã€‚å‚æ•° secure_file_priv çš„å¯é€‰å€¼å’Œä½œç”¨åˆ†åˆ«æ˜¯ï¼š <ul><li>å¦‚æœè®¾ç½®ä¸º emptyï¼Œè¡¨ç¤ºä¸é™åˆ¶æ–‡ä»¶ç”Ÿæˆçš„ä½ç½®ï¼Œè¿™æ˜¯ä¸å®‰å…¨çš„è®¾ç½®ï¼›</li><li>å¦‚æœè®¾ç½®ä¸ºä¸€ä¸ªè¡¨ç¤ºè·¯å¾„çš„å­—ç¬¦ä¸²ï¼Œå°±è¦æ±‚ç”Ÿæˆçš„æ–‡ä»¶åªèƒ½æ”¾åœ¨è¿™ä¸ªæŒ‡å®šçš„ç›®å½•ï¼Œæˆ–è€…å®ƒçš„å­ç›®å½•ï¼›</li><li>å¦‚æœè®¾ç½®ä¸º NULLï¼Œå°±è¡¨ç¤ºç¦æ­¢åœ¨è¿™ä¸ª MySQL å®ä¾‹ä¸Šæ‰§è¡Œ select â€¦ into outfile æ“ä½œã€‚</li></ul></li><li>è¿™æ¡å‘½ä»¤ä¸ä¼šå¸®ä½ è¦†ç›–æ–‡ä»¶ï¼Œå› æ­¤ä½ éœ€è¦ç¡®ä¿ /server_tmp/t.csv è¿™ä¸ªæ–‡ä»¶ä¸å­˜åœ¨ï¼Œå¦åˆ™æ‰§è¡Œè¯­å¥æ—¶å°±ä¼šå› ä¸ºæœ‰åŒåæ–‡ä»¶çš„å­˜åœ¨è€ŒæŠ¥é”™ã€‚</li><li>è¿™æ¡å‘½ä»¤ç”Ÿæˆçš„æ–‡æœ¬æ–‡ä»¶ä¸­ï¼ŒåŸåˆ™ä¸Šä¸€ä¸ªæ•°æ®è¡Œå¯¹åº”æ–‡æœ¬æ–‡ä»¶çš„ä¸€è¡Œã€‚ä½†æ˜¯ï¼Œå¦‚æœå­—æ®µä¸­åŒ…å«æ¢è¡Œç¬¦ï¼Œåœ¨ç”Ÿæˆçš„æ–‡æœ¬ä¸­ä¹Ÿä¼šæœ‰æ¢è¡Œç¬¦ã€‚ä¸è¿‡ç±»ä¼¼æ¢è¡Œç¬¦ã€åˆ¶è¡¨ç¬¦è¿™ç±»ç¬¦å·ï¼Œå‰é¢éƒ½ä¼šè·Ÿä¸Šâ€œ\â€è¿™ä¸ªè½¬ä¹‰ç¬¦ï¼Œè¿™æ ·å°±å¯ä»¥è·Ÿå­—æ®µä¹‹é—´ã€æ•°æ®è¡Œä¹‹é—´çš„åˆ†éš”ç¬¦åŒºåˆ†å¼€ã€‚</li></ol><p>å¾—åˆ°.csv å¯¼å‡ºæ–‡ä»¶åï¼Œä½ å°±å¯ä»¥ç”¨ä¸‹é¢çš„ load data å‘½ä»¤å°†æ•°æ®å¯¼å…¥åˆ°ç›®æ ‡è¡¨ db2.t ä¸­ã€‚</p><div class="language-lua line-numbers-mode" data-ext="lua"><pre class="language-lua"><code>load data infile <span class="token string">&#39;/server_tmp/t.csv&#39;</span> into table db2<span class="token punctuation">.</span>t<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>è¿™æ¡è¯­å¥çš„æ‰§è¡Œæµç¨‹å¦‚ä¸‹æ‰€ç¤ºã€‚</p><ol><li>æ‰“å¼€æ–‡ä»¶ /server_tmp/t.csvï¼Œä»¥åˆ¶è¡¨ç¬¦ (\t) ä½œä¸ºå­—æ®µé—´çš„åˆ†éš”ç¬¦ï¼Œä»¥æ¢è¡Œç¬¦ï¼ˆ\nï¼‰ä½œä¸ºè®°å½•ä¹‹é—´çš„åˆ†éš”ç¬¦ï¼Œè¿›è¡Œæ•°æ®è¯»å–ï¼›</li><li>å¯åŠ¨äº‹åŠ¡ã€‚</li><li>åˆ¤æ–­æ¯ä¸€è¡Œçš„å­—æ®µæ•°ä¸è¡¨ db2.t æ˜¯å¦ç›¸åŒï¼š <ul><li>è‹¥ä¸ç›¸åŒï¼Œåˆ™ç›´æ¥æŠ¥é”™ï¼Œäº‹åŠ¡å›æ»šï¼›</li><li>è‹¥ç›¸åŒï¼Œåˆ™æ„é€ æˆä¸€è¡Œï¼Œè°ƒç”¨ InnoDB å¼•æ“æ¥å£ï¼Œå†™å…¥åˆ°è¡¨ä¸­ã€‚</li></ul></li><li>é‡å¤æ­¥éª¤ 3ï¼Œç›´åˆ° /server_tmp/t.csv æ•´ä¸ªæ–‡ä»¶è¯»å…¥å®Œæˆï¼Œæäº¤äº‹åŠ¡ã€‚</li></ol><p>ä½ å¯èƒ½æœ‰ä¸€ä¸ªç–‘é—®ï¼Œ<strong>å¦‚æœ binlog_format=statementï¼Œè¿™ä¸ª load è¯­å¥è®°å½•åˆ° binlog é‡Œä»¥åï¼Œæ€ä¹ˆåœ¨å¤‡åº“é‡æ”¾å‘¢ï¼Ÿ</strong></p><p>ç”±äº /server_tmp/t.csv æ–‡ä»¶åªä¿å­˜åœ¨ä¸»åº“æ‰€åœ¨çš„ä¸»æœºä¸Šï¼Œå¦‚æœåªæ˜¯æŠŠè¿™æ¡è¯­å¥åŸæ–‡å†™åˆ° binlog ä¸­ï¼Œåœ¨å¤‡åº“æ‰§è¡Œçš„æ—¶å€™ï¼Œå¤‡åº“çš„æœ¬åœ°æœºå™¨ä¸Šæ²¡æœ‰è¿™ä¸ªæ–‡ä»¶ï¼Œå°±ä¼šå¯¼è‡´ä¸»å¤‡åŒæ­¥åœæ­¢ã€‚</p><p>æ‰€ä»¥ï¼Œè¿™æ¡è¯­å¥æ‰§è¡Œçš„å®Œæ•´æµç¨‹ï¼Œå…¶å®æ˜¯ä¸‹é¢è¿™æ ·çš„ã€‚</p><ol><li>ä¸»åº“æ‰§è¡Œå®Œæˆåï¼Œå°† /server_tmp/t.csv æ–‡ä»¶çš„å†…å®¹ç›´æ¥å†™åˆ° binlog æ–‡ä»¶ä¸­ã€‚</li><li>å¾€ binlog æ–‡ä»¶ä¸­å†™å…¥è¯­å¥ load data local infile â€˜/tmp/SQL_LOAD_MB-1-0â€™ INTO TABLE <code>db2</code>.<code>t</code>ã€‚</li><li>æŠŠè¿™ä¸ª binlog æ—¥å¿—ä¼ åˆ°å¤‡åº“ã€‚</li><li>å¤‡åº“çš„ apply çº¿ç¨‹åœ¨æ‰§è¡Œè¿™ä¸ªäº‹åŠ¡æ—¥å¿—æ—¶ï¼š a. å…ˆå°† binlog ä¸­ t.csv æ–‡ä»¶çš„å†…å®¹è¯»å‡ºæ¥ï¼Œå†™å…¥åˆ°æœ¬åœ°ä¸´æ—¶ç›®å½• /tmp/SQL_LOAD_MB-1-0 ä¸­ï¼› b. å†æ‰§è¡Œ load data è¯­å¥ï¼Œå¾€å¤‡åº“çš„ db2.t è¡¨ä¸­æ’å…¥è·Ÿä¸»åº“ç›¸åŒçš„æ•°æ®ã€‚</li></ol><p>æ‰§è¡Œæµç¨‹å¦‚å›¾ 2 æ‰€ç¤ºï¼š</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/3a6790bc933af5ac45a75deba0f52cfd-1584367390347.jpg" alt="img"></p><p>å›¾ 2 load data çš„åŒæ­¥æµç¨‹</p><p>æ³¨æ„ï¼Œè¿™é‡Œå¤‡åº“æ‰§è¡Œçš„ load data è¯­å¥é‡Œé¢ï¼Œå¤šäº†ä¸€ä¸ªâ€œlocalâ€ã€‚å®ƒçš„æ„æ€æ˜¯â€œå°†æ‰§è¡Œè¿™æ¡å‘½ä»¤çš„å®¢æˆ·ç«¯æ‰€åœ¨æœºå™¨çš„æœ¬åœ°æ–‡ä»¶ /tmp/SQL_LOAD_MB-1-0 çš„å†…å®¹ï¼ŒåŠ è½½åˆ°ç›®æ ‡è¡¨ db2.t ä¸­â€ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>load data å‘½ä»¤æœ‰ä¸¤ç§ç”¨æ³•</strong>ï¼š</p><ol><li>ä¸åŠ â€œlocalâ€ï¼Œæ˜¯è¯»å–æœåŠ¡ç«¯çš„æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶å¿…é¡»åœ¨ secure_file_priv æŒ‡å®šçš„ç›®å½•æˆ–å­ç›®å½•ä¸‹ï¼›</li><li>åŠ ä¸Šâ€œlocalâ€ï¼Œè¯»å–çš„æ˜¯å®¢æˆ·ç«¯çš„æ–‡ä»¶ï¼Œåªè¦ mysql å®¢æˆ·ç«¯æœ‰è®¿é—®è¿™ä¸ªæ–‡ä»¶çš„æƒé™å³å¯ã€‚è¿™æ—¶å€™ï¼ŒMySQL å®¢æˆ·ç«¯ä¼šå…ˆæŠŠæœ¬åœ°æ–‡ä»¶ä¼ ç»™æœåŠ¡ç«¯ï¼Œç„¶åæ‰§è¡Œä¸Šè¿°çš„ load data æµç¨‹ã€‚</li></ol><p>å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<strong>select â€¦into outfile æ–¹æ³•ä¸ä¼šç”Ÿæˆè¡¨ç»“æ„æ–‡ä»¶</strong>, æ‰€ä»¥æˆ‘ä»¬å¯¼æ•°æ®æ—¶è¿˜éœ€è¦å•ç‹¬çš„å‘½ä»¤å¾—åˆ°è¡¨ç»“æ„å®šä¹‰ã€‚mysqldump æä¾›äº†ä¸€ä¸ªâ€“tab å‚æ•°ï¼Œå¯ä»¥åŒæ—¶å¯¼å‡ºè¡¨ç»“æ„å®šä¹‰æ–‡ä»¶å’Œ csv æ•°æ®æ–‡ä»¶ã€‚è¿™æ¡å‘½ä»¤çš„ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</p><div class="language-swift line-numbers-mode" data-ext="swift"><pre class="language-swift"><code>mysqldump <span class="token operator">-</span>h$host <span class="token operator">-</span><span class="token class-name">P</span>$port <span class="token operator">-</span>u$user <span class="token operator">---</span>single<span class="token operator">-</span>transaction  <span class="token operator">--</span><span class="token keyword">set</span><span class="token operator">-</span>gtid<span class="token operator">-</span>purged<span class="token operator">=</span><span class="token constant">OFF</span> db1 t <span class="token operator">--</span><span class="token keyword">where</span><span class="token operator">=</span><span class="token string-literal"><span class="token string">&quot;a&gt;900&quot;</span></span> <span class="token operator">--</span>tab<span class="token operator">=</span>$secure_file_priv
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>è¿™æ¡å‘½ä»¤ä¼šåœ¨ $secure_file_priv å®šä¹‰çš„ç›®å½•ä¸‹ï¼Œåˆ›å»ºä¸€ä¸ª t.sql æ–‡ä»¶ä¿å­˜å»ºè¡¨è¯­å¥ï¼ŒåŒæ—¶åˆ›å»ºä¸€ä¸ª t.txt æ–‡ä»¶ä¿å­˜ CSV æ•°æ®ã€‚</p><h4 id="ç‰©ç†æ‹·è´æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#ç‰©ç†æ‹·è´æ–¹æ³•" aria-hidden="true">#</a> ç‰©ç†æ‹·è´æ–¹æ³•</h4><p>å‰é¢æˆ‘ä»¬æåˆ°çš„ mysqldump æ–¹æ³•å’Œå¯¼å‡º CSV æ–‡ä»¶çš„æ–¹æ³•ï¼Œéƒ½æ˜¯é€»è¾‘å¯¼æ•°æ®çš„æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯å°†æ•°æ®ä»è¡¨ db1.t ä¸­è¯»å‡ºæ¥ï¼Œç”Ÿæˆæ–‡æœ¬ï¼Œç„¶åå†å†™å…¥ç›®æ ‡è¡¨ db2.t ä¸­ã€‚</p><p>ä½ å¯èƒ½ä¼šé—®ï¼Œæœ‰ç‰©ç†å¯¼æ•°æ®çš„æ–¹æ³•å—ï¼Ÿæ¯”å¦‚ï¼Œç›´æ¥æŠŠ db1.t è¡¨çš„.frm æ–‡ä»¶å’Œ.ibd æ–‡ä»¶æ‹·è´åˆ° db2 ç›®å½•ä¸‹ï¼Œæ˜¯å¦å¯è¡Œå‘¢ï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯ä¸è¡Œçš„ã€‚</p><p>å› ä¸ºï¼Œä¸€ä¸ª InnoDB è¡¨ï¼Œé™¤äº†åŒ…å«è¿™ä¸¤ä¸ªç‰©ç†æ–‡ä»¶å¤–ï¼Œè¿˜éœ€è¦åœ¨æ•°æ®å­—å…¸ä¸­æ³¨å†Œã€‚ç›´æ¥æ‹·è´è¿™ä¸¤ä¸ªæ–‡ä»¶çš„è¯ï¼Œå› ä¸ºæ•°æ®å­—å…¸ä¸­æ²¡æœ‰ db2.t è¿™ä¸ªè¡¨ï¼Œç³»ç»Ÿæ˜¯ä¸ä¼šè¯†åˆ«å’Œæ¥å—å®ƒä»¬çš„ã€‚</p><p>ä¸è¿‡ï¼Œåœ¨ MySQL 5.6 ç‰ˆæœ¬å¼•å…¥äº†<strong>å¯ä¼ è¾“è¡¨ç©ºé—´</strong>(transportable tablespace) çš„æ–¹æ³•ï¼Œå¯ä»¥é€šè¿‡å¯¼å‡º + å¯¼å…¥è¡¨ç©ºé—´çš„æ–¹å¼ï¼Œå®ç°ç‰©ç†æ‹·è´è¡¨çš„åŠŸèƒ½ã€‚</p><p>å‡è®¾æˆ‘ä»¬ç°åœ¨çš„ç›®æ ‡æ˜¯åœ¨ db1 åº“ä¸‹ï¼Œå¤åˆ¶ä¸€ä¸ªè·Ÿè¡¨ t ç›¸åŒçš„è¡¨ rï¼Œå…·ä½“çš„æ‰§è¡Œæ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li>æ‰§è¡Œ create table r like tï¼Œåˆ›å»ºä¸€ä¸ªç›¸åŒè¡¨ç»“æ„çš„ç©ºè¡¨ï¼›</li><li>æ‰§è¡Œ alter table r discard tablespaceï¼Œè¿™æ—¶å€™ r.ibd æ–‡ä»¶ä¼šè¢«åˆ é™¤ï¼›</li><li>æ‰§è¡Œ flush table t for exportï¼Œè¿™æ—¶å€™ db1 ç›®å½•ä¸‹ä¼šç”Ÿæˆä¸€ä¸ª t.cfg æ–‡ä»¶ï¼›</li><li>åœ¨ db1 ç›®å½•ä¸‹æ‰§è¡Œ cp t.cfg r.cfg; cp t.ibd r.ibdï¼›è¿™ä¸¤ä¸ªå‘½ä»¤ï¼ˆè¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ‹·è´å¾—åˆ°çš„ä¸¤ä¸ªæ–‡ä»¶ï¼ŒMySQL è¿›ç¨‹è¦æœ‰è¯»å†™æƒé™ï¼‰ï¼›</li><li>æ‰§è¡Œ unlock tablesï¼Œè¿™æ—¶å€™ t.cfg æ–‡ä»¶ä¼šè¢«åˆ é™¤ï¼›</li><li>æ‰§è¡Œ alter table r import tablespaceï¼Œå°†è¿™ä¸ª r.ibd æ–‡ä»¶ä½œä¸ºè¡¨ r çš„æ–°çš„è¡¨ç©ºé—´ï¼Œç”±äºè¿™ä¸ªæ–‡ä»¶çš„æ•°æ®å†…å®¹å’Œ t.ibd æ˜¯ç›¸åŒçš„ï¼Œæ‰€ä»¥è¡¨ r ä¸­å°±æœ‰äº†å’Œè¡¨ t ç›¸åŒçš„æ•°æ®ã€‚</li></ol><p>è‡³æ­¤ï¼Œæ‹·è´è¡¨æ•°æ®çš„æ“ä½œå°±å®Œæˆäº†ã€‚è¿™ä¸ªæµç¨‹çš„æ‰§è¡Œè¿‡ç¨‹å›¾å¦‚ä¸‹ï¼š</p><p><img src="http://learn.lianglianglee.com/æå®¢æ—¶é—´/assets/ba1ced43eed4a55d49435c062fee21a7-1584367390359.jpg" alt="img"></p><p>å›¾ 3 ç‰©ç†æ‹·è´è¡¨</p><p>å…³äºæ‹·è´è¡¨çš„è¿™ä¸ªæµç¨‹ï¼Œæœ‰ä»¥ä¸‹å‡ ä¸ªæ³¨æ„ç‚¹ï¼š</p><ol><li>åœ¨ç¬¬ 3 æ­¥æ‰§è¡Œå®Œ flsuh table å‘½ä»¤ä¹‹åï¼Œdb1.t æ•´ä¸ªè¡¨å¤„äºåªè¯»çŠ¶æ€ï¼Œç›´åˆ°æ‰§è¡Œ unlock tables å‘½ä»¤åæ‰é‡Šæ”¾è¯»é”ï¼›</li><li>åœ¨æ‰§è¡Œ import tablespace çš„æ—¶å€™ï¼Œä¸ºäº†è®©æ–‡ä»¶é‡Œçš„è¡¨ç©ºé—´ id å’Œæ•°æ®å­—å…¸ä¸­çš„ä¸€è‡´ï¼Œä¼šä¿®æ”¹ r.ibd çš„è¡¨ç©ºé—´ idã€‚è€Œè¿™ä¸ªè¡¨ç©ºé—´ id å­˜åœ¨äºæ¯ä¸€ä¸ªæ•°æ®é¡µä¸­ã€‚å› æ­¤ï¼Œå¦‚æœæ˜¯ä¸€ä¸ªå¾ˆå¤§çš„æ–‡ä»¶ï¼ˆæ¯”å¦‚ TB çº§åˆ«ï¼‰ï¼Œæ¯ä¸ªæ•°æ®é¡µéƒ½éœ€è¦ä¿®æ”¹ï¼Œæ‰€ä»¥ä½ ä¼šçœ‹åˆ°è¿™ä¸ª import è¯­å¥çš„æ‰§è¡Œæ˜¯éœ€è¦ä¸€äº›æ—¶é—´çš„ã€‚å½“ç„¶ï¼Œå¦‚æœæ˜¯ç›¸æ¯”äºé€»è¾‘å¯¼å…¥çš„æ–¹æ³•ï¼Œimport è¯­å¥çš„è€—æ—¶æ˜¯éå¸¸çŸ­çš„ã€‚</li></ol><h4 id="å°ç»“-26" tabindex="-1"><a class="header-anchor" href="#å°ç»“-26" aria-hidden="true">#</a> å°ç»“</h4><p>ä»Šå¤©è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘å’Œä½ ä»‹ç»äº†ä¸‰ç§å°†ä¸€ä¸ªè¡¨çš„æ•°æ®å¯¼å…¥åˆ°å¦å¤–ä¸€ä¸ªè¡¨ä¸­çš„æ–¹æ³•ã€‚</p><p>æˆ‘ä»¬æ¥å¯¹æ¯”ä¸€ä¸‹è¿™ä¸‰ç§æ–¹æ³•çš„ä¼˜ç¼ºç‚¹ã€‚</p><ol><li>ç‰©ç†æ‹·è´çš„æ–¹å¼é€Ÿåº¦æœ€å¿«ï¼Œå°¤å…¶å¯¹äºå¤§è¡¨æ‹·è´æ¥è¯´æ˜¯æœ€å¿«çš„æ–¹æ³•ã€‚å¦‚æœå‡ºç°è¯¯åˆ è¡¨çš„æƒ…å†µï¼Œç”¨å¤‡ä»½æ¢å¤å‡ºè¯¯åˆ ä¹‹å‰çš„ä¸´æ—¶åº“ï¼Œç„¶åå†æŠŠä¸´æ—¶åº“ä¸­çš„è¡¨æ‹·è´åˆ°ç”Ÿäº§åº“ä¸Šï¼Œæ˜¯æ¢å¤æ•°æ®æœ€å¿«çš„æ–¹æ³•ã€‚ä½†æ˜¯ï¼Œè¿™ç§æ–¹æ³•çš„ä½¿ç”¨ä¹Ÿæœ‰ä¸€å®šçš„å±€é™æ€§ï¼š <ul><li>å¿…é¡»æ˜¯å…¨è¡¨æ‹·è´ï¼Œä¸èƒ½åªæ‹·è´éƒ¨åˆ†æ•°æ®ï¼›</li><li>éœ€è¦åˆ°æœåŠ¡å™¨ä¸Šæ‹·è´æ•°æ®ï¼Œåœ¨ç”¨æˆ·æ— æ³•ç™»å½•æ•°æ®åº“ä¸»æœºçš„åœºæ™¯ä¸‹æ— æ³•ä½¿ç”¨ï¼›</li><li>ç”±äºæ˜¯é€šè¿‡æ‹·è´ç‰©ç†æ–‡ä»¶å®ç°çš„ï¼Œæºè¡¨å’Œç›®æ ‡è¡¨éƒ½æ˜¯ä½¿ç”¨ InnoDB å¼•æ“æ—¶æ‰èƒ½ä½¿ç”¨ã€‚</li></ul></li><li>ç”¨ mysqldump ç”ŸæˆåŒ…å« INSERT è¯­å¥æ–‡ä»¶çš„æ–¹æ³•ï¼Œå¯ä»¥åœ¨ where å‚æ•°å¢åŠ è¿‡æ»¤æ¡ä»¶ï¼Œæ¥å®ç°åªå¯¼å‡ºéƒ¨åˆ†æ•°æ®ã€‚è¿™ä¸ªæ–¹å¼çš„ä¸è¶³ä¹‹ä¸€æ˜¯ï¼Œä¸èƒ½ä½¿ç”¨ join è¿™ç§æ¯”è¾ƒå¤æ‚çš„ where æ¡ä»¶å†™æ³•ã€‚</li><li>ç”¨ select â€¦ into outfile çš„æ–¹æ³•æ˜¯æœ€çµæ´»çš„ï¼Œæ”¯æŒæ‰€æœ‰çš„ SQL å†™æ³•ã€‚ä½†ï¼Œè¿™ä¸ªæ–¹æ³•çš„ç¼ºç‚¹ä¹‹ä¸€å°±æ˜¯ï¼Œæ¯æ¬¡åªèƒ½å¯¼å‡ºä¸€å¼ è¡¨çš„æ•°æ®ï¼Œè€Œä¸”è¡¨ç»“æ„ä¹Ÿéœ€è¦å¦å¤–çš„è¯­å¥å•ç‹¬å¤‡ä»½ã€‚</li></ol><p>åä¸¤ç§æ–¹å¼éƒ½æ˜¯é€»è¾‘å¤‡ä»½æ–¹å¼ï¼Œæ˜¯å¯ä»¥è·¨å¼•æ“ä½¿ç”¨çš„ã€‚</p><p>æœ€åï¼Œæˆ‘ç»™ä½ ç•™ä¸‹ä¸€ä¸ªæ€è€ƒé¢˜å§ã€‚</p><p>æˆ‘ä»¬å‰é¢ä»‹ç» binlog_format=statement çš„æ—¶å€™ï¼Œbinlog è®°å½•çš„ load data å‘½ä»¤æ˜¯å¸¦ local çš„ã€‚æ—¢ç„¶è¿™æ¡å‘½ä»¤æ˜¯å‘é€åˆ°å¤‡åº“å»æ‰§è¡Œçš„ï¼Œé‚£ä¹ˆå¤‡åº“æ‰§è¡Œçš„æ—¶å€™ä¹Ÿæ˜¯æœ¬åœ°æ‰§è¡Œï¼Œä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸ª local å‘¢ï¼Ÿå¦‚æœå†™åˆ° binlog ä¸­çš„å‘½ä»¤ä¸å¸¦ localï¼Œåˆä¼šå‡ºç°ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ</p><p>ä½ å¯ä»¥æŠŠä½ çš„åˆ†æå†™åœ¨è¯„è®ºåŒºï¼Œæˆ‘ä¼šåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« çš„æœ«å°¾å’Œä½ è®¨è®ºè¿™ä¸ªé—®é¢˜ã€‚æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚</p><h4 id="ä¸ŠæœŸé—®é¢˜æ—¶é—´-23" tabindex="-1"><a class="header-anchor" href="#ä¸ŠæœŸé—®é¢˜æ—¶é—´-23" aria-hidden="true">#</a> ä¸ŠæœŸé—®é¢˜æ—¶é—´</h4><p>æˆ‘åœ¨ä¸Šç¯‡æ–‡ç« æœ€åç»™ä½ ç•™ä¸‹çš„æ€è€ƒé¢˜ï¼Œå·²ç»åœ¨ä»Šå¤©è¿™ç¯‡æ–‡ç« çš„æ­£æ–‡éƒ¨åˆ†åšäº†å›ç­”ã€‚</p><p>ä¸Šç¯‡æ–‡ç« çš„è¯„è®ºåŒºæœ‰å‡ ä¸ªéå¸¸å¥½çš„ç•™è¨€ï¼Œæˆ‘åœ¨è¿™é‡Œå’Œä½ åˆ†äº«ä¸€ä¸‹ã€‚</p><p>@huolang åŒå­¦æäº†ä¸€ä¸ªé—®é¢˜ï¼šå¦‚æœ sessionA æ‹¿åˆ° c=5 çš„è®°å½•é”æ˜¯å†™é”ï¼Œé‚£ä¸ºä»€ä¹ˆ sessionB å’Œ sessionC è¿˜èƒ½åŠ  c=5 çš„è¯»é”å‘¢ï¼Ÿ</p><p>è¿™æ˜¯å› ä¸º next-key lock æ˜¯å…ˆåŠ é—´éš™é”ï¼Œå†åŠ è®°å½•é”çš„ã€‚åŠ é—´éš™é”æˆåŠŸäº†ï¼ŒåŠ è®°å½•é”å°±ä¼šè¢«å µä½ã€‚å¦‚æœä½ å¯¹è¿™ä¸ªè¿‡ç¨‹æœ‰ç–‘é—®çš„è¯ï¼Œå¯ä»¥å†å¤ä¹ ä¸€ä¸‹[ç¬¬ 30 ç¯‡æ–‡ç« ]ä¸­çš„ç›¸å…³å†…å®¹ã€‚</p><p>@ä¸€å¤§åª åŒå­¦åšäº†ä¸€ä¸ªå®éªŒï¼ŒéªŒè¯äº†ä¸»é”®å†²çªä»¥åï¼Œinsert è¯­å¥åŠ é—´éš™é”çš„æ•ˆæœã€‚æ¯”æˆ‘åœ¨ä¸Šç¯‡æ–‡ç« æ­£æ–‡ä¸­æçš„é‚£ä¸ªå›æ»šå¯¼è‡´æ­»é”çš„ä¾‹å­æ›´ç›´è§‚ï¼Œä½“ç°äº†ä»–å¯¹è¿™ä¸ªçŸ¥è¯†ç‚¹éå¸¸å¥½çš„ç†è§£å’Œæ€è€ƒï¼Œå¾ˆèµã€‚</p><p>@roaming åŒå­¦éªŒè¯äº†åœ¨ MySQL 8.0 ç‰ˆæœ¬ä¸­ï¼Œå·²ç»èƒ½å¤Ÿç”¨ä¸´æ—¶è¡¨å¤„ç† insert â€¦ select å†™å…¥åŸè¡¨çš„è¯­å¥äº†ã€‚</p><p>@è€æ¨åŒå¿— çš„å›ç­”æåˆ°äº†æˆ‘ä»¬æœ¬æ–‡ä¸­è¯´åˆ°çš„å‡ ä¸ªæ–¹æ³•ã€‚</p><h2 id="mysqlæ•°æ®åº“è®¾è®¡è§„èŒƒ" tabindex="-1"><a class="header-anchor" href="#mysqlæ•°æ®åº“è®¾è®¡è§„èŒƒ" aria-hidden="true">#</a> MySQLæ•°æ®åº“è®¾è®¡è§„èŒƒ</h2><p>https://github.com/guanguans/notes/blob/master/MySQL/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.md</p><h3 id="_1-è§„èŒƒèƒŒæ™¯ä¸ç›®çš„" tabindex="-1"><a class="header-anchor" href="#_1-è§„èŒƒèƒŒæ™¯ä¸ç›®çš„" aria-hidden="true">#</a> 1. è§„èŒƒèƒŒæ™¯ä¸ç›®çš„</h3><p>MySQL æ•°æ®åº“ä¸ Oracleã€ SQL Server ç­‰æ•°æ®åº“ç›¸æ¯”ï¼Œæœ‰å…¶å†…æ ¸ä¸Šçš„ä¼˜åŠ¿ä¸åŠ£åŠ¿ã€‚æˆ‘ä»¬åœ¨ä½¿ç”¨ MySQL æ•°æ®åº“çš„æ—¶å€™éœ€è¦éµå¾ªä¸€å®šè§„èŒƒï¼Œæ‰¬é•¿é¿çŸ­ã€‚æœ¬è§„èŒƒæ—¨åœ¨å¸®åŠ©æˆ–æŒ‡å¯¼ RDã€QAã€OP ç­‰æŠ€æœ¯äººå‘˜åšå‡ºé€‚åˆçº¿ä¸Šä¸šåŠ¡çš„æ•°æ®åº“è®¾è®¡ã€‚åœ¨æ•°æ®åº“å˜æ›´å’Œå¤„ç†æµç¨‹ã€æ•°æ®åº“è¡¨è®¾è®¡ã€SQL ç¼–å†™ç­‰æ–¹é¢äºˆä»¥è§„èŒƒï¼Œä»è€Œä¸ºå…¬å¸ä¸šåŠ¡ç³»ç»Ÿç¨³å®šã€å¥åº·åœ°è¿è¡Œæä¾›ä¿éšœã€‚</p><h3 id="_2-è®¾è®¡è§„èŒƒ" tabindex="-1"><a class="header-anchor" href="#_2-è®¾è®¡è§„èŒƒ" aria-hidden="true">#</a> 2. è®¾è®¡è§„èŒƒ</h3><h4 id="_2-1-æ•°æ®åº“è®¾è®¡" tabindex="-1"><a class="header-anchor" href="#_2-1-æ•°æ®åº“è®¾è®¡" aria-hidden="true">#</a> 2.1 æ•°æ®åº“è®¾è®¡</h4><p>ä»¥ä¸‹æ‰€æœ‰è§„èŒƒä¼šæŒ‰ç…§ã€é«˜å±ã€‘ã€ã€å¼ºåˆ¶ã€‘ã€ã€å»ºè®®ã€‘ä¸‰ä¸ªçº§åˆ«è¿›è¡Œæ ‡æ³¨ï¼Œéµå®ˆä¼˜å…ˆçº§ä»é«˜åˆ°ä½ã€‚</p><p>å¯¹äºä¸æ»¡è¶³ã€é«˜å±ã€‘å’Œã€å¼ºåˆ¶ã€‘ä¸¤ä¸ªçº§åˆ«çš„è®¾è®¡ï¼ŒDBA ä¼šå¼ºåˆ¶æ‰“å›è¦æ±‚ä¿®æ”¹ã€‚</p><h5 id="_2-1-1-ä¸€èˆ¬å‘½åè§„åˆ™" tabindex="-1"><a class="header-anchor" href="#_2-1-1-ä¸€èˆ¬å‘½åè§„åˆ™" aria-hidden="true">#</a> 2.1.1 ä¸€èˆ¬å‘½åè§„åˆ™</h5><ol><li>ã€å¼ºåˆ¶ã€‘ä½¿ç”¨å°å†™ï¼Œæœ‰åŠ©äºæé«˜æ‰“å­—é€Ÿåº¦ï¼Œé¿å…å› å¤§å°å†™æ•æ„Ÿè€Œå¯¼è‡´çš„é”™è¯¯ã€‚</li><li>ã€å¼ºåˆ¶ã€‘æ²¡æœ‰ç©ºæ ¼ï¼Œä½¿ç”¨ä¸‹åˆ’çº¿ä»£æ›¿ã€‚</li><li>ã€å¼ºåˆ¶ã€‘åç§°ä¸­æ²¡æœ‰æ•°å­—ï¼Œåªæœ‰è‹±æ–‡å­—æ¯ã€‚</li><li>ã€å¼ºåˆ¶ã€‘æœ‰æ•ˆçš„å¯ç†è§£çš„åç§°ã€‚</li><li>ã€å¼ºåˆ¶ã€‘åç§°åº”è¯¥æ˜¯è‡ªæˆ‘è§£é‡Šçš„ã€‚</li><li>ã€å¼ºåˆ¶ã€‘åç§°ä¸åº”è¶…è¿‡ 32 ä¸ªå­—ç¬¦ã€‚</li><li>ã€å¼ºåˆ¶ã€‘é¿å…ä½¿ç”¨å‰ç¼€ã€‚</li></ol><h5 id="_2-1-2-åº“" tabindex="-1"><a class="header-anchor" href="#_2-1-2-åº“" aria-hidden="true">#</a> 2.1.2 åº“</h5><ol><li><p>ã€å¼ºåˆ¶ã€‘éµå®ˆä»¥ä¸Šå…¨éƒ¨ä¸€èˆ¬å‘½åè§„åˆ™ã€‚</p></li><li><p>ã€å¼ºåˆ¶ã€‘ä½¿ç”¨å•æ•°ã€‚</p></li><li><p>ã€å¼ºåˆ¶ã€‘åº“çš„åç§°æ ¼å¼ï¼šä¸šåŠ¡ç³»ç»Ÿåç§°_å­ç³»ç»Ÿåã€‚</p></li><li><p>ã€å¼ºåˆ¶ã€‘ä¸€èˆ¬åˆ†åº“åç§°å‘½åæ ¼å¼æ˜¯<code>åº“é€šé…å_ç¼–å·</code>ï¼Œç¼–å·ä» 0 å¼€å§‹é€’å¢ï¼Œæ¯”å¦‚ <code>northwind_001</code>ï¼Œä»¥æ—¶é—´è¿›è¡Œåˆ†åº“çš„åç§°æ ¼å¼æ˜¯<code>åº“é€šé…å_æ—¶é—´</code>ã€‚</p></li><li><p>ã€å¼ºåˆ¶ã€‘åˆ›å»ºæ•°æ®åº“æ—¶å¿…é¡»æ˜¾å¼æŒ‡å®šå­—ç¬¦é›†ï¼Œå¹¶ä¸”å­—ç¬¦é›†åªèƒ½æ˜¯ utf8 æˆ–è€… utf8mb4ã€‚åˆ›å»ºæ•°æ®åº“ SQL ä¸¾ä¾‹ï¼š</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">database</span> db_name <span class="token keyword">default</span> <span class="token keyword">character</span> <span class="token keyword">set</span> utf8<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ol><h5 id="_2-1-3-è¡¨" tabindex="-1"><a class="header-anchor" href="#_2-1-3-è¡¨" aria-hidden="true">#</a> 2.1.3 è¡¨</h5><ol><li>ã€å¼ºåˆ¶ã€‘éµå®ˆä»¥ä¸Šå…¨éƒ¨ä¸€èˆ¬å‘½åè§„åˆ™ã€‚</li><li>ã€å¼ºåˆ¶ã€‘ä½¿ç”¨å•æ•°ã€‚</li><li>ã€å¼ºåˆ¶ã€‘ç›¸å…³æ¨¡å—çš„è¡¨åä¸è¡¨åä¹‹é—´å°½é‡ä½“ç° join çš„å…³ç³»ï¼Œå¦‚ <code>user</code> è¡¨å’Œ <code>user_login</code> è¡¨ã€‚</li><li>ã€å¼ºåˆ¶ã€‘åˆ›å»ºè¡¨æ—¶å¿…é¡»æ˜¾å¼æŒ‡å®šå­—ç¬¦é›†ä¸º utf8 æˆ– utf8mb4ã€‚</li><li>ã€å¼ºåˆ¶ã€‘åˆ›å»ºè¡¨æ—¶å¿…é¡»æ˜¾å¼æŒ‡å®šè¡¨å­˜å‚¨å¼•æ“ç±»å‹ï¼Œå¦‚æ— ç‰¹æ®Šéœ€æ±‚ï¼Œä¸€å¾‹ä¸º InnoDBã€‚å½“éœ€è¦ä½¿ç”¨é™¤ InnoDB/MyISAM/Memory ä»¥å¤–çš„å­˜å‚¨å¼•æ“æ—¶ï¼Œå¿…é¡»é€šè¿‡ DBA å®¡æ ¸æ‰èƒ½åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ã€‚å› ä¸º InnoDB è¡¨æ”¯æŒäº‹åŠ¡ã€è¡Œé”ã€å®•æœºæ¢å¤ã€MVCC ç­‰å…³ç³»å‹æ•°æ®åº“é‡è¦ç‰¹æ€§ï¼Œä¸ºä¸šç•Œä½¿ç”¨æœ€å¤šçš„ MySQL å­˜å‚¨å¼•æ“ã€‚è€Œè¿™æ˜¯å…¶å®ƒå¤§å¤šæ•°å­˜å‚¨å¼•æ“ä¸å…·å¤‡çš„ï¼Œå› æ­¤é¦–æ¨ InnoDBã€‚</li><li>ã€å¼ºåˆ¶ã€‘å»ºè¡¨å¿…é¡»æœ‰ commentã€‚</li><li>ã€å¼ºåˆ¶ã€‘å…³äºä¸»é”®ï¼š(1) å‘½åä¸º <code>id</code>ï¼Œç±»å‹ä¸º int æˆ– bigintï¼Œä¸”ä¸º <code>auto_increment</code>ï¼›(2) æ ‡è¯†è¡¨é‡Œæ¯ä¸€è¡Œä¸»ä½“çš„å­—æ®µä¸è¦è®¾ä¸ºä¸»é”®ï¼Œå»ºè®®è®¾ä¸ºå…¶å®ƒå­—æ®µå¦‚ <code>user_id</code>ï¼Œ<code>order_id</code>ç­‰ï¼Œå¹¶å»ºç«‹ <code>unique key</code> ç´¢å¼•ã€‚å› ä¸ºå¦‚æœè®¾ä¸ºä¸»é”®ä¸”ä¸»é”®å€¼ä¸ºéšæœºæ’å…¥ï¼Œåˆ™ä¼šå¯¼è‡´ InnoDB å†…éƒ¨ page åˆ†è£‚å’Œå¤§é‡éšæœº I/Oï¼Œæ€§èƒ½ä¸‹é™ã€‚</li><li>ã€å»ºè®®ã€‘æ ¸å¿ƒè¡¨ï¼ˆå¦‚ç”¨æˆ·è¡¨ï¼Œé‡‘é’±ç›¸å…³çš„è¡¨ï¼‰å¿…é¡»æœ‰è¡Œæ•°æ®çš„åˆ›å»ºæ—¶é—´å­—æ®µ <code>create_time</code> å’Œæœ€åæ›´æ–°æ—¶é—´å­—æ®µ <code>update_time</code>ï¼Œä¾¿äºæ’æŸ¥é—®é¢˜ã€‚</li><li>ã€å»ºè®®ã€‘è¡¨ä¸­æ‰€æœ‰å­—æ®µå¿…é¡»éƒ½æ˜¯ <code>NOT NULL</code> å±æ€§ï¼Œä¸šåŠ¡å¯ä»¥æ ¹æ®éœ€è¦å®šä¹‰ <code>DEFAULT</code> å€¼ã€‚å› ä¸ºä½¿ç”¨ <code>NULL</code> å€¼ä¼šå­˜åœ¨æ¯ä¸€è¡Œéƒ½ä¼šå ç”¨é¢å¤–å­˜å‚¨ç©ºé—´ã€æ•°æ®è¿ç§»å®¹æ˜“å‡ºé”™ã€èšåˆå‡½æ•°è®¡ç®—ç»“æœåå·®ç­‰é—®é¢˜ã€‚</li><li>ã€å»ºè®®ã€‘å»ºè®®å¯¹è¡¨é‡Œçš„ <code>blob</code>ã€<code>text</code> ç­‰å¤§å­—æ®µï¼Œå‚ç›´æ‹†åˆ†åˆ°å…¶å®ƒè¡¨é‡Œï¼Œä»…åœ¨éœ€è¦è¯»è¿™äº›å¯¹è±¡çš„æ—¶å€™æ‰å» selectã€‚</li><li>ã€å»ºè®®ã€‘åèŒƒå¼è®¾è®¡ï¼šæŠŠç»å¸¸éœ€è¦ join æŸ¥è¯¢çš„å­—æ®µï¼Œåœ¨å…¶å®ƒè¡¨é‡Œå†—ä½™ä¸€ä»½ã€‚å¦‚ <code>username</code> å±æ€§åœ¨ <code>user_account</code>ï¼Œ<code>user_login_log</code> ç­‰è¡¨é‡Œå†—ä½™ä¸€ä»½ï¼Œå‡å°‘ join æŸ¥è¯¢ã€‚</li><li>ã€å¼ºåˆ¶ã€‘ä¸­é—´è¡¨ç”¨äºä¿ç•™ä¸­é—´ç»“æœé›†ï¼Œåç§°å¿…é¡»ä»¥ <code>tmp_</code> å¼€å¤´ã€‚å¤‡ä»½è¡¨ç”¨äºå¤‡ä»½æˆ–æŠ“å–æºè¡¨å¿«ç…§ï¼Œåç§°å¿…é¡»ä»¥ <code>bak_</code> å¼€å¤´ã€‚ä¸­é—´è¡¨å’Œå¤‡ä»½è¡¨å®šæœŸæ¸…ç†ã€‚</li><li>ã€å¼ºåˆ¶ã€‘å¯¹äºè¶…è¿‡ 100W è¡Œçš„å¤§è¡¨è¿›è¡Œ <code>alter table</code>ï¼Œå¿…é¡»ç»è¿‡ DBA å®¡æ ¸ï¼Œå¹¶åœ¨ä¸šåŠ¡ä½å³°æœŸæ‰§è¡Œã€‚å› ä¸º <code>alter table</code> ä¼šäº§ç”Ÿè¡¨é”ï¼ŒæœŸé—´é˜»å¡å¯¹äºè¯¥è¡¨çš„æ‰€æœ‰å†™å…¥ï¼Œå¯¹äºä¸šåŠ¡å¯èƒ½ä¼šäº§ç”Ÿæå¤§å½±å“ã€‚</li></ol><h5 id="_2-1-4-å­—æ®µ" tabindex="-1"><a class="header-anchor" href="#_2-1-4-å­—æ®µ" aria-hidden="true">#</a> 2.1.4 å­—æ®µ</h5><ol><li>ã€å¼ºåˆ¶ã€‘éµå®ˆä»¥ä¸Šå…¨éƒ¨ä¸€èˆ¬å‘½åè§„åˆ™ã€‚</li><li>ã€å»ºè®®ã€‘å°½å¯èƒ½é€‰æ‹©çŸ­çš„æˆ–ä¸€ä¸¤ä¸ªå•è¯ã€‚</li><li>ã€å¼ºåˆ¶ã€‘é¿å…ä½¿ç”¨ä¿ç•™å­—ä½œä¸ºå­—æ®µåç§°ï¼š<code>order</code>ï¼Œ<code>date</code>ï¼Œ<code>name</code> æ˜¯æ•°æ®åº“çš„ä¿ç•™å­—ï¼Œé¿å…ä½¿ç”¨å®ƒã€‚å¯ä»¥ä¸ºè¿™äº›åç§°æ·»åŠ å‰ç¼€ä½¿å…¶æ˜“äºç†è§£ï¼Œå¦‚ <code>user_name</code>ï¼Œ<code>signup_date</code> ç­‰ã€‚</li><li>ã€å¼ºåˆ¶ã€‘é¿å…ä½¿ç”¨ä¸è¡¨åç›¸åŒçš„å­—æ®µåï¼Œè¿™ä¼šåœ¨ç¼–å†™æŸ¥è¯¢æ—¶é€ æˆæ··æ·†ã€‚</li><li>ã€å¼ºåˆ¶ã€‘åœ¨æ•°æ®åº“æ¨¡å¼ä¸Šå®šä¹‰å¤–é”®ã€‚</li><li>ã€å¼ºåˆ¶ã€‘é¿å…ä½¿ç”¨ç¼©å†™æˆ–åŸºäºé¦–å­—æ¯ç¼©å†™è¯çš„åç§°ã€‚</li><li>ã€å¼ºåˆ¶ã€‘å¤–é”®åˆ—å¿…é¡»å…·æœ‰è¡¨ååŠå…¶ä¸»é”®ï¼Œä¾‹å¦‚ï¼š<code>blog_id</code> è¡¨ç¤ºæ¥è‡ªè¡¨åšå®¢çš„å¤–é”® idã€‚</li></ol><h5 id="_2-1-5-å­—æ®µæ•°æ®ç±»å‹ä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#_2-1-5-å­—æ®µæ•°æ®ç±»å‹ä¼˜åŒ–" aria-hidden="true">#</a> 2.1.5 å­—æ®µæ•°æ®ç±»å‹ä¼˜åŒ–</h5><ol><li><p>ã€å»ºè®®ã€‘è¡¨ä¸­çš„è‡ªå¢åˆ—ï¼ˆ<code>auto_increment</code> å±æ€§ï¼‰ï¼Œæ¨èä½¿ç”¨ <code>bigint</code> ç±»å‹ã€‚å› ä¸ºæ— ç¬¦å· <code>int</code> å­˜å‚¨èŒƒå›´ä¸º <code>0~4,294,967,295</code>ï¼ˆä¸åˆ° 43 äº¿ï¼‰ï¼Œæº¢å‡ºåä¼šå¯¼è‡´æŠ¥é”™ã€‚</p></li><li><p>ã€å»ºè®®ã€‘ä¸šåŠ¡ä¸­é€‰æ‹©æ€§å¾ˆå°‘çš„çŠ¶æ€ <code>status</code>ã€ç±»å‹ <code>type</code> ç­‰å­—æ®µæ¨èä½¿ç”¨ <code>tinytint</code> æˆ–è€… <code>smallint</code> ç±»å‹èŠ‚çœå­˜å‚¨ç©ºé—´ã€‚</p></li><li><p>ã€å»ºè®®ã€‘ä¸šåŠ¡ä¸­ IP åœ°å€å­—æ®µæ¨èä½¿ç”¨ <code>int</code> ç±»å‹ï¼Œä¸æ¨èç”¨ <code>char(15)</code>ã€‚å› ä¸º <code>int</code> åªå  4 å­—èŠ‚ï¼Œå¯ä»¥ç”¨å¦‚ä¸‹å‡½æ•°ç›¸äº’è½¬æ¢ï¼Œè€Œ <code>char(15)</code> å ç”¨è‡³å°‘ 15 å­—èŠ‚ã€‚</p><p>SQL:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">select</span> inet_aton<span class="token punctuation">(</span><span class="token string">&#39;192.168.2.12&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> inet_ntoa<span class="token punctuation">(</span><span class="token number">3232236044</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>PHP:</p><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token function">ip2long</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;192.168.2.12&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token function">long2ip</span><span class="token punctuation">(</span><span class="token number">3530427185</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>Java:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">long</span> <span class="token function">ipToLong</span><span class="token punctuation">(</span><span class="token class-name">String</span> addr<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> addrArray <span class="token operator">=</span> addr<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;\\.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">long</span> num <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> addrArray<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">int</span> power <span class="token operator">=</span> <span class="token number">3</span> <span class="token operator">-</span> i<span class="token punctuation">;</span>
        num <span class="token operator">+=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>addrArray<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">256</span> <span class="token operator">*</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">,</span> power<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> num<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">longToIp</span><span class="token punctuation">(</span><span class="token keyword">long</span> i<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>i <span class="token operator">&gt;&gt;</span> <span class="token number">24</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;.&quot;</span> <span class="token operator">+</span>
           <span class="token punctuation">(</span><span class="token punctuation">(</span>i <span class="token operator">&gt;&gt;</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;.&quot;</span> <span class="token operator">+</span>
           <span class="token punctuation">(</span><span class="token punctuation">(</span>i <span class="token operator">&gt;&gt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;.&quot;</span> <span class="token operator">+</span>
           <span class="token punctuation">(</span>i <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>ã€å»ºè®®ã€‘ä¸æ¨èä½¿ç”¨ <code>enum</code>ï¼Œ<code>set</code>ã€‚ å› ä¸ºå®ƒä»¬æµªè´¹ç©ºé—´ï¼Œä¸”æšä¸¾å€¼å†™æ­»äº†ï¼Œå˜æ›´ä¸æ–¹ä¾¿ã€‚æ¨èä½¿ç”¨ <code>tinyint</code> æˆ– <code>smallint</code>ã€‚</p></li><li><p>ã€å»ºè®®ã€‘ä¸æ¨èä½¿ç”¨ <code>blob</code>ï¼Œ<code>text</code> ç­‰ç±»å‹ã€‚å®ƒä»¬éƒ½æ¯”è¾ƒæµªè´¹ç¡¬ç›˜å’Œå†…å­˜ç©ºé—´ã€‚åœ¨åŠ è½½è¡¨æ•°æ®æ—¶ï¼Œä¼šè¯»å–å¤§å­—æ®µåˆ°å†…å­˜é‡Œä»è€Œæµªè´¹å†…å­˜ç©ºé—´ï¼Œå½±å“ç³»ç»Ÿæ€§èƒ½ã€‚å»ºè®®å’Œ PMã€RD æ²Ÿé€šï¼Œæ˜¯å¦çœŸçš„éœ€è¦è¿™ä¹ˆå¤§å­—æ®µã€‚InnoDB ä¸­å½“ä¸€è¡Œè®°å½•è¶…è¿‡ 8098 å­—èŠ‚æ—¶ï¼Œä¼šå°†è¯¥è®°å½•ä¸­é€‰å–æœ€é•¿çš„ä¸€ä¸ªå­—æ®µå°†å…¶ 768 å­—èŠ‚æ”¾åœ¨åŸå§‹ page é‡Œï¼Œè¯¥å­—æ®µä½™ä¸‹å†…å®¹æ”¾åœ¨ <code>overflow-page</code> é‡Œã€‚ä¸å¹¸çš„æ˜¯åœ¨ <code>compact</code> è¡Œæ ¼å¼ä¸‹ï¼ŒåŸå§‹ <code>page</code> å’Œ <code>overflow-page</code> éƒ½ä¼šåŠ è½½ã€‚</p></li><li><p>ã€å»ºè®®ã€‘å­˜å‚¨é‡‘é’±çš„å­—æ®µï¼Œå»ºè®®ç”¨ <code>int</code> ä»¥åˆ†ä¸ºå•ä½å­˜å‚¨ï¼Œæœ€å¤§æ•°å€¼çº¦ 4290 ä¸‡ï¼Œç¨‹åºç«¯ä¹˜ä»¥ 100 å’Œé™¤ä»¥ 100 è¿›è¡Œå­˜å–ã€‚å› ä¸º <code>int</code> å ç”¨ 4 å­—èŠ‚ï¼Œè€Œ <code>double</code> å ç”¨ 8 å­—èŠ‚ï¼Œç©ºé—´æµªè´¹ã€‚</p></li><li><p>ã€å»ºè®®ã€‘æ–‡æœ¬æ•°æ®å°½é‡ç”¨ <code>varchar</code> å­˜å‚¨ã€‚å› ä¸º <code>varchar</code> æ˜¯å˜é•¿å­˜å‚¨ï¼Œæ¯” <code>char</code> æ›´çœç©ºé—´ã€‚MySQL server å±‚è§„å®šä¸€è¡Œæ‰€æœ‰æ–‡æœ¬æœ€å¤šå­˜ 65535 å­—èŠ‚ï¼Œå› æ­¤åœ¨ utf8 å­—ç¬¦é›†ä¸‹æœ€å¤šå­˜ 21844 ä¸ªå­—ç¬¦ï¼Œè¶…è¿‡ä¼šè‡ªåŠ¨è½¬æ¢ä¸º <code>mediumtext</code> å­—æ®µã€‚è€Œ <code>text</code> åœ¨ utf8 å­—ç¬¦é›†ä¸‹æœ€å¤šå­˜ 21844 ä¸ªå­—ç¬¦ï¼Œ<code>mediumtext</code> æœ€å¤šå­˜ 2^24/3 ä¸ªå­—ç¬¦ï¼Œ<code>longtext</code> æœ€å¤šå­˜ 2^32 ä¸ªå­—ç¬¦ã€‚ä¸€èˆ¬å»ºè®®ç”¨ <code>varchar</code> ç±»å‹ï¼Œå­—ç¬¦æ•°ä¸è¦è¶…è¿‡ 2700ã€‚</p></li><li><p>ã€å»ºè®®ã€‘æ—¶é—´ç±»å‹å°½é‡é€‰å– <code>timestamp</code>ã€‚å› ä¸º <code>datetime</code> å ç”¨ 8 å­—èŠ‚ï¼Œ<code>timestamp</code> ä»…å ç”¨ 4 å­—èŠ‚ï¼Œä½†æ˜¯èŒƒå›´ä¸º <code>1970-01-01 00:00:01</code> åˆ° <code>2038-01-01 00:00:00</code>ã€‚æ›´ä¸ºé«˜é˜¶çš„æ–¹æ³•ï¼Œé€‰ç”¨ <code>int</code> æ¥å­˜å‚¨æ—¶é—´ï¼Œä½¿ç”¨ SQL å‡½æ•° <code>unix_timestamp()</code> å’Œ <code>from_unixtime()</code> æ¥è¿›è¡Œè½¬æ¢ã€‚</p></li></ol><ul><li><p>è¯¦ç»†å­˜å‚¨å¤§å°å‚è€ƒä¸‹å›¾ï¼š</p><table><thead><tr><th>ç±»å‹ï¼ˆåŒä¹‰è¯ï¼‰</th><th>å­˜å‚¨é•¿åº¦(BYTES)</th><th>æœ€å°å€¼(SIGNED/UNSIGNED)</th><th>æœ€å¤§å€¼(SIGNED/UNSIGNED)</th></tr></thead><tbody><tr><td><em>æ•´å½¢æ•°å­—</em></td><td></td><td></td><td></td></tr><tr><td>TINYINT</td><td>1</td><td>-128/0</td><td>127/255</td></tr><tr><td>SMALLINT</td><td>2</td><td>-32,768/0</td><td>32767/65,535</td></tr><tr><td>MEDIUMINT</td><td>3</td><td>-8,388,608/0</td><td>8388607/16,777,215/</td></tr><tr><td>INT(INTEGER)</td><td>4</td><td>-2,14,7483,648/0</td><td>2147483647/4,294,967,295/</td></tr><tr><td>BIGINT</td><td>8</td><td>-2^63/0</td><td>2^63-1/2^64-1</td></tr><tr><td><em>å°æ•°æ”¯æŒ</em></td><td></td><td></td><td></td></tr><tr><td>FLOAT[(M[,D])]</td><td>4 or 8</td><td>-</td><td></td></tr><tr><td>DOUBLE[(M[,D])]<br>(REAL, DOUBLE PRECISION)</td><td>8</td><td>-</td><td></td></tr><tr><td><em>æ—¶é—´ç±»å‹</em></td><td></td><td></td><td></td></tr><tr><td>DATETIME</td><td>8</td><td>1001-01-01 00:00:00</td><td>9999-12-31 23:59:59</td></tr><tr><td>DATE</td><td>3</td><td>1001-01-01</td><td>9999-12-31</td></tr><tr><td>TIME</td><td>3</td><td>00:00:00</td><td>23:59:59</td></tr><tr><td>YEAR</td><td>1</td><td>1001</td><td>9999</td></tr><tr><td>TIMESTAMP</td><td>4</td><td>1970-01-01 00:00:00</td><td></td></tr></tbody></table></li></ul><h5 id="_2-1-6-ç´¢å¼•è®¾è®¡" tabindex="-1"><a class="header-anchor" href="#_2-1-6-ç´¢å¼•è®¾è®¡" aria-hidden="true">#</a> 2.1.6 ç´¢å¼•è®¾è®¡</h5><ol><li>ã€å¼ºåˆ¶ã€‘InnoDB è¡¨å¿…é¡»ä¸»é”®ä¸º <code>id int/bigint auto_increment</code>ï¼Œä¸”ä¸»é”®å€¼ç¦æ­¢è¢«æ›´æ–°ã€‚</li><li>ã€å»ºè®®ã€‘ä¸»é”®çš„åç§°ä»¥ <code>pk_</code> å¼€å¤´ï¼Œå”¯ä¸€é”®ä»¥ <code>uk_</code> å¼€å¤´ï¼Œæ™®é€šç´¢å¼•ä»¥ <code>ix_</code> å¼€å¤´ï¼Œä¸€å¾‹ä½¿ç”¨å°å†™æ ¼å¼ï¼Œä»¥è¡¨å/å­—æ®µçš„åç§°æˆ–ç¼©å†™ä½œä¸ºåç¼€ã€‚</li><li>ã€å¼ºåˆ¶ã€‘InnoDB å’Œ MyISAM å­˜å‚¨å¼•æ“è¡¨ï¼Œç´¢å¼•ç±»å‹å¿…é¡»ä¸º <code>BTREE</code>ï¼›MEMORY è¡¨å¯ä»¥æ ¹æ®éœ€è¦é€‰æ‹© <code>HASH</code> æˆ–è€… <code>BTREE</code> ç±»å‹ç´¢å¼•ã€‚</li><li>ã€å¼ºåˆ¶ã€‘å•ä¸ªç´¢å¼•ä¸­æ¯ä¸ªç´¢å¼•è®°å½•çš„é•¿åº¦ä¸èƒ½è¶…è¿‡ 64KBã€‚</li><li>ã€å»ºè®®ã€‘å•ä¸ªè¡¨ä¸Šçš„ç´¢å¼•ä¸ªæ•°ä¸èƒ½è¶…è¿‡ 7 ä¸ªã€‚</li><li>ã€å»ºè®®ã€‘åœ¨å»ºç«‹ç´¢å¼•æ—¶ï¼Œå¤šè€ƒè™‘å»ºç«‹è”åˆç´¢å¼•ï¼Œå¹¶æŠŠåŒºåˆ†åº¦æœ€é«˜çš„å­—æ®µæ”¾åœ¨æœ€å‰é¢ã€‚å¦‚åˆ— <code>user_id</code> çš„åŒºåˆ†åº¦å¯ç”± <code>select count(distinct user_id)</code> è®¡ç®—å‡ºæ¥ã€‚</li><li>ã€å»ºè®®ã€‘åœ¨å¤šè¡¨ join çš„ SQL é‡Œï¼Œä¿è¯è¢«é©±åŠ¨è¡¨çš„è¿æ¥åˆ—ä¸Šæœ‰ç´¢å¼•ï¼Œè¿™æ · join æ‰§è¡Œæ•ˆç‡æœ€é«˜ã€‚</li><li>ã€å»ºè®®ã€‘å»ºè¡¨æˆ–åŠ ç´¢å¼•æ—¶ï¼Œä¿è¯è¡¨é‡Œäº’ç›¸ä¸å­˜åœ¨å†—ä½™ç´¢å¼•ã€‚å¯¹äº MySQL æ¥è¯´ï¼Œå¦‚æœè¡¨é‡Œå·²ç»å­˜åœ¨ <code>key(a, b)</code>ï¼Œåˆ™ <code>key(a)</code> ä¸ºå†—ä½™ç´¢å¼•ï¼Œéœ€è¦åˆ é™¤ã€‚</li><li>ã€å»ºè®®ã€‘å¦‚æœé€‰æ‹©æ€§è¶…è¿‡ 20%ï¼Œé‚£ä¹ˆå…¨è¡¨æ‰«ææ¯”ä½¿ç”¨ç´¢å¼•æ€§èƒ½æ›´ä¼˜ï¼Œå³æ²¡æœ‰è®¾ç½®ç´¢å¼•çš„å¿…è¦ã€‚</li></ol><h5 id="_2-1-7-åˆ†åº“åˆ†è¡¨ã€åˆ†åŒºè¡¨" tabindex="-1"><a class="header-anchor" href="#_2-1-7-åˆ†åº“åˆ†è¡¨ã€åˆ†åŒºè¡¨" aria-hidden="true">#</a> 2.1.7 åˆ†åº“åˆ†è¡¨ã€åˆ†åŒºè¡¨</h5><ol><li>ã€å¼ºåˆ¶ã€‘åˆ†åŒºè¡¨çš„åˆ†åŒºå­—æ®µï¼ˆ<code>partition-key</code>ï¼‰å¿…é¡»æœ‰ç´¢å¼•ï¼Œæˆ–è€…æ˜¯ç»„åˆç´¢å¼•çš„é¦–åˆ—ã€‚</li><li>ã€å¼ºåˆ¶ã€‘å•ä¸ªåˆ†åŒºè¡¨ä¸­çš„åˆ†åŒºï¼ˆåŒ…æ‹¬å­åˆ†åŒºï¼‰ä¸ªæ•°ä¸èƒ½è¶…è¿‡ 1024ã€‚</li><li>ã€å¼ºåˆ¶ã€‘ä¸Šçº¿å‰ RD æˆ–è€… DBA å¿…é¡»æŒ‡å®šåˆ†åŒºè¡¨çš„åˆ›å»ºã€æ¸…ç†ç­–ç•¥ã€‚</li><li>ã€å¼ºåˆ¶ã€‘è®¿é—®åˆ†åŒºè¡¨çš„ SQL å¿…é¡»åŒ…å«åˆ†åŒºé”®ã€‚</li><li>ã€å»ºè®®ã€‘å•ä¸ªåˆ†åŒºæ–‡ä»¶ä¸è¶…è¿‡ 2Gï¼Œæ€»å¤§å°ä¸è¶…è¿‡ 50Gã€‚å»ºè®®æ€»åˆ†åŒºæ•°ä¸è¶…è¿‡ 20 ä¸ªã€‚</li><li>ã€å¼ºåˆ¶ã€‘å¯¹äºåˆ†åŒºè¡¨æ‰§è¡Œ <code>alter table</code> æ“ä½œï¼Œå¿…é¡»åœ¨ä¸šåŠ¡ä½å³°æœŸæ‰§è¡Œã€‚</li><li>ã€å¼ºåˆ¶ã€‘é‡‡ç”¨åˆ†åº“ç­–ç•¥çš„ï¼Œåº“çš„æ•°é‡ä¸èƒ½è¶…è¿‡ 1024ã€‚</li><li>ã€å¼ºåˆ¶ã€‘é‡‡ç”¨åˆ†è¡¨ç­–ç•¥çš„ï¼Œè¡¨çš„æ•°é‡ä¸èƒ½è¶…è¿‡ 4096ã€‚</li><li>ã€å»ºè®®ã€‘å•ä¸ªåˆ†è¡¨ä¸è¶…è¿‡ 500W è¡Œï¼Œibd æ–‡ä»¶å¤§å°ä¸è¶…è¿‡ 2Gï¼Œè¿™æ ·æ‰èƒ½è®©æ•°æ®åˆ†å¸ƒå¼å˜å¾—æ€§èƒ½æ›´ä½³ã€‚</li><li>ã€å»ºè®®ã€‘æ°´å¹³åˆ†è¡¨å°½é‡ç”¨å–æ¨¡æ–¹å¼ï¼Œæ—¥å¿—ã€æŠ¥è¡¨ç±»æ•°æ®å»ºè®®é‡‡ç”¨æ—¥æœŸè¿›è¡Œåˆ†è¡¨ã€‚</li></ol><h5 id="_2-1-8-å­—ç¬¦é›†" tabindex="-1"><a class="header-anchor" href="#_2-1-8-å­—ç¬¦é›†" aria-hidden="true">#</a> 2.1.8 å­—ç¬¦é›†</h5><ol><li>ã€å¼ºåˆ¶ã€‘æ•°æ®åº“æœ¬èº«åº“ã€è¡¨ã€åˆ—æ‰€æœ‰å­—ç¬¦é›†å¿…é¡»ä¿æŒä¸€è‡´ï¼Œä¸º <code>utf8</code> æˆ– <code>utf8mb4</code>ã€‚</li><li>ã€å¼ºåˆ¶ã€‘å‰ç«¯ç¨‹åºå­—ç¬¦é›†æˆ–è€…ç¯å¢ƒå˜é‡ä¸­çš„å­—ç¬¦é›†ï¼Œä¸æ•°æ®åº“ã€è¡¨çš„å­—ç¬¦é›†å¿…é¡»ä¸€è‡´ï¼Œç»Ÿä¸€ä¸º <code>utf8</code>ã€‚</li></ol><h5 id="_2-1-9-ç¨‹åºå±‚-dao-è®¾è®¡å»ºè®®" tabindex="-1"><a class="header-anchor" href="#_2-1-9-ç¨‹åºå±‚-dao-è®¾è®¡å»ºè®®" aria-hidden="true">#</a> 2.1.9 ç¨‹åºå±‚ DAO è®¾è®¡å»ºè®®</h5><ol><li>ã€å»ºè®®ã€‘æ–°çš„ä»£ç ä¸è¦ç”¨ modelï¼Œæ¨èä½¿ç”¨æ‰‹åŠ¨æ‹¼ SQL + ç»‘å®šå˜é‡ä¼ å…¥å‚æ•°çš„æ–¹å¼ã€‚å› ä¸º model è™½ç„¶å¯ä»¥ä½¿ç”¨é¢å‘å¯¹è±¡çš„æ–¹å¼æ“ä½œ dbï¼Œä½†æ˜¯å…¶ä½¿ç”¨ä¸å½“å¾ˆå®¹æ˜“é€ æˆç”Ÿæˆçš„ SQL éå¸¸å¤æ‚ï¼Œä¸” model å±‚è‡ªå·±åšçš„å¼ºåˆ¶ç±»å‹è½¬æ¢æ€§èƒ½è¾ƒå·®ï¼Œæœ€ç»ˆå¯¼è‡´æ•°æ®åº“æ€§èƒ½ä¸‹é™ã€‚</li><li>ã€å»ºè®®ã€‘å‰ç«¯ç¨‹åºè¿æ¥ MySQL æˆ–è€… Redisï¼Œå¿…é¡»è¦æœ‰è¿æ¥è¶…æ—¶å’Œå¤±è´¥é‡è¿æœºåˆ¶ï¼Œä¸”å¤±è´¥é‡è¯•å¿…é¡»æœ‰é—´éš”æ—¶é—´ã€‚</li><li>ã€å»ºè®®ã€‘å‰ç«¯ç¨‹åºæŠ¥é”™é‡Œå°½é‡èƒ½å¤Ÿæç¤º MySQL æˆ– Redis åŸç”Ÿæ€çš„æŠ¥é”™ä¿¡æ¯ï¼Œä¾¿äºæ’æŸ¥é”™è¯¯ã€‚</li><li>ã€å»ºè®®ã€‘å¯¹äºæœ‰è¿æ¥æ± çš„å‰ç«¯ç¨‹åºï¼Œå¿…é¡»æ ¹æ®ä¸šåŠ¡éœ€è¦é…ç½®åˆå§‹ã€æœ€å°ã€æœ€å¤§è¿æ¥æ•°ï¼Œè¶…æ—¶æ—¶é—´ä»¥åŠè¿æ¥å›æ”¶æœºåˆ¶ï¼Œå¦åˆ™ä¼šè€—å°½æ•°æ®åº“è¿æ¥èµ„æºï¼Œé€ æˆçº¿ä¸Šäº‹æ•…ã€‚</li><li>ã€å»ºè®®ã€‘å¯¹äº <code>log</code> æˆ– <code>history</code> ç±»å‹çš„è¡¨ï¼Œéšæ—¶é—´å¢é•¿å®¹æ˜“è¶Šæ¥è¶Šå¤§ï¼Œå› æ­¤ä¸Šçº¿å‰ RD æˆ–è€… DBA å¿…é¡»å»ºç«‹è¡¨æ•°æ®æ¸…ç†æˆ–å½’æ¡£æ–¹æ¡ˆã€‚</li><li>ã€å»ºè®®ã€‘åœ¨åº”ç”¨ç¨‹åºè®¾è®¡é˜¶æ®µï¼ŒRD å¿…é¡»è€ƒè™‘å¹¶è§„é¿æ•°æ®åº“ä¸­ä¸»ä»å»¶è¿Ÿå¯¹äºä¸šåŠ¡çš„å½±å“ã€‚å°½é‡é¿å…ä»åº“çŸ­æ—¶å»¶è¿Ÿï¼ˆ20 ç§’ä»¥å†…ï¼‰å¯¹ä¸šåŠ¡é€ æˆå½±å“ï¼Œå»ºè®®å¼ºåˆ¶ä¸€è‡´æ€§çš„è¯»å¼€å¯äº‹åŠ¡èµ°ä¸»åº“ï¼Œæˆ–æ›´æ–°åè¿‡ä¸€æ®µæ—¶é—´å†å»è¯»ä»åº“ã€‚</li><li>ã€å»ºè®®ã€‘å¤šä¸ªå¹¶å‘ä¸šåŠ¡é€»è¾‘è®¿é—®åŒä¸€å—æ•°æ®ï¼ˆInnoDB è¡¨ï¼‰æ—¶ï¼Œä¼šåœ¨æ•°æ®åº“ç«¯äº§ç”Ÿè¡Œé”ç”šè‡³è¡¨é”å¯¼è‡´å¹¶å‘ä¸‹é™ï¼Œå› æ­¤å»ºè®®æ›´æ–°ç±» SQL å°½é‡åŸºäºä¸»é”®å»æ›´æ–°ã€‚</li><li>ã€å»ºè®®ã€‘ä¸šåŠ¡é€»è¾‘ä¹‹é—´åŠ é”é¡ºåºå°½é‡ä¿æŒä¸€è‡´ï¼Œå¦åˆ™ä¼šå¯¼è‡´æ­»é”ã€‚</li><li>ã€å»ºè®®ã€‘å¯¹äºå•è¡¨è¯»å†™æ¯”å¤§äº 10:1 çš„æ•°æ®è¡Œæˆ–å•ä¸ªåˆ—ï¼Œå¯ä»¥å°†çƒ­ç‚¹æ•°æ®æ”¾åœ¨ç¼“å­˜é‡Œï¼ˆå¦‚ Memcached æˆ– Redisï¼‰ï¼ŒåŠ å¿«è®¿é—®é€Ÿåº¦ï¼Œé™ä½ MySQL å‹åŠ›ã€‚</li></ol><h5 id="_2-1-10-ä¸€ä¸ªè§„èŒƒçš„å»ºè¡¨è¯­å¥ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#_2-1-10-ä¸€ä¸ªè§„èŒƒçš„å»ºè¡¨è¯­å¥ç¤ºä¾‹" aria-hidden="true">#</a> 2.1.10 ä¸€ä¸ªè§„èŒƒçš„å»ºè¡¨è¯­å¥ç¤ºä¾‹</h5><ul><li>ä¸€ä¸ªè¾ƒä¸ºè§„èŒƒçš„å»ºè¡¨è¯­å¥ä¸ºï¼š<div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> <span class="token keyword">user</span> 
<span class="token punctuation">(</span> 
    <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span>            <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">auto_increment</span><span class="token punctuation">,</span> 
    <span class="token identifier"><span class="token punctuation">`</span>user_id<span class="token punctuation">`</span></span>       <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">comment</span> <span class="token string">&#39;ç”¨æˆ· ID&#39;</span><span class="token punctuation">,</span> 
    <span class="token identifier"><span class="token punctuation">`</span>username<span class="token punctuation">`</span></span>      <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">45</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">comment</span> <span class="token string">&#39;ç™»å½•å&#39;</span><span class="token punctuation">,</span> 
    <span class="token identifier"><span class="token punctuation">`</span>email<span class="token punctuation">`</span></span>         <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">comment</span> <span class="token string">&#39;é‚®ç®±&#39;</span><span class="token punctuation">,</span> 
    <span class="token identifier"><span class="token punctuation">`</span>nickname<span class="token punctuation">`</span></span>      <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">45</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">comment</span> <span class="token string">&#39;æ˜µç§°&#39;</span><span class="token punctuation">,</span> 
    <span class="token identifier"><span class="token punctuation">`</span>avatar<span class="token punctuation">`</span></span>        <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">comment</span> <span class="token string">&#39;å¤´åƒ&#39;</span><span class="token punctuation">,</span> 
    <span class="token identifier"><span class="token punctuation">`</span>birthday<span class="token punctuation">`</span></span>      <span class="token keyword">date</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">comment</span> <span class="token string">&#39;ç”Ÿæ—¥&#39;</span><span class="token punctuation">,</span> 
    <span class="token identifier"><span class="token punctuation">`</span>gender<span class="token punctuation">`</span></span>        <span class="token keyword">tinyint</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">&#39;0&#39;</span> <span class="token keyword">comment</span> <span class="token string">&#39;æ€§åˆ«&#39;</span><span class="token punctuation">,</span> 
    <span class="token identifier"><span class="token punctuation">`</span>intro<span class="token punctuation">`</span></span>         <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">150</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token boolean">null</span> <span class="token keyword">comment</span> <span class="token string">&#39;ç®€ä»‹&#39;</span><span class="token punctuation">,</span> 
    <span class="token identifier"><span class="token punctuation">`</span>resume_url<span class="token punctuation">`</span></span>    <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">comment</span> <span class="token string">&#39;ç®€å†å­˜æ”¾åœ°å€&#39;</span><span class="token punctuation">,</span> 
    <span class="token identifier"><span class="token punctuation">`</span>register_ip<span class="token punctuation">`</span></span>   <span class="token keyword">int</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">comment</span> <span class="token string">&#39;ç”¨æˆ·æ³¨å†Œæ—¶çš„æº IP&#39;</span><span class="token punctuation">,</span> 
    <span class="token identifier"><span class="token punctuation">`</span>review_status<span class="token punctuation">`</span></span> <span class="token keyword">tinyint</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">comment</span> <span class="token string">&#39;å®¡æ ¸çŠ¶æ€ï¼Œ1-é€šè¿‡ï¼Œ2-å®¡æ ¸ä¸­ï¼Œ3-æœªé€šè¿‡ï¼Œ4-å°šæœªæäº¤å®¡æ ¸&#39;</span><span class="token punctuation">,</span> 
    <span class="token identifier"><span class="token punctuation">`</span>create_time<span class="token punctuation">`</span></span>   <span class="token keyword">timestamp</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">comment</span> <span class="token string">&#39;è®°å½•åˆ›å»ºçš„æ—¶é—´&#39;</span><span class="token punctuation">,</span> 
    <span class="token identifier"><span class="token punctuation">`</span>update_time<span class="token punctuation">`</span></span>   <span class="token keyword">timestamp</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">comment</span> <span class="token string">&#39;èµ„æ–™ä¿®æ”¹çš„æ—¶é—´&#39;</span><span class="token punctuation">,</span> 
    
    <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
    <span class="token keyword">unique</span> <span class="token identifier"><span class="token punctuation">`</span>idx_user_id<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>user_id<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
    <span class="token keyword">key</span> <span class="token identifier"><span class="token punctuation">`</span>idx_username<span class="token punctuation">`</span></span><span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>username<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
    <span class="token keyword">key</span> <span class="token identifier"><span class="token punctuation">`</span>idx_create_time<span class="token punctuation">`</span></span><span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>create_time<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>review_status<span class="token punctuation">`</span></span><span class="token punctuation">)</span> 
<span class="token punctuation">)</span> 
<span class="token keyword">engine</span> <span class="token operator">=</span> <span class="token keyword">InnoDB</span>
<span class="token keyword">default</span> <span class="token keyword">charset</span> <span class="token operator">=</span> utf8 
<span class="token keyword">comment</span> <span class="token operator">=</span> <span class="token string">&#39;ç”¨æˆ·åŸºæœ¬ä¿¡æ¯&#39;</span><span class="token punctuation">;</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h4 id="_2-2-sql-ç¼–å†™" tabindex="-1"><a class="header-anchor" href="#_2-2-sql-ç¼–å†™" aria-hidden="true">#</a> 2.2 SQL ç¼–å†™</h4><h5 id="_2-2-1-dml-è¯­å¥" tabindex="-1"><a class="header-anchor" href="#_2-2-1-dml-è¯­å¥" aria-hidden="true">#</a> 2.2.1 DML è¯­å¥</h5><ol><li>ã€å¼ºåˆ¶ã€‘select è¯­å¥å¿…é¡»æŒ‡å®šå…·ä½“å­—æ®µåç§°ï¼Œç¦æ­¢å†™æˆ <code>*</code>ã€‚å› ä¸º <code>select *</code> ä¼šå°†ä¸è¯¥è¯»çš„æ•°æ®ä¹Ÿä» MySQL é‡Œè¯»å‡ºæ¥ï¼Œé€ æˆç½‘å¡å‹åŠ›ã€‚</li><li>ã€å¼ºåˆ¶ã€‘insert è¯­å¥æŒ‡å®šå…·ä½“å­—æ®µåç§°ï¼Œä¸è¦å†™æˆ <code>insert into t1 values(â€¦)</code>ï¼Œé“ç†åŒä¸Šã€‚</li><li>ã€å»ºè®®ã€‘<code>insert into â€¦ values(xx),(xx),(xx)â€¦</code>ï¼Œè¿™é‡Œ xx çš„å€¼ä¸è¦è¶…è¿‡ 5000 ä¸ªã€‚å€¼è¿‡å¤šè™½ç„¶ä¸Šçº¿å¾ˆå¿«ï¼Œä½†ä¼šå¼•èµ·ä¸»ä»åŒæ­¥å»¶è¿Ÿã€‚</li><li>ã€å»ºè®®ã€‘select è¯­å¥ä¸è¦ä½¿ç”¨ <code>union</code>ï¼Œæ¨èä½¿ç”¨ <code>union all</code>ï¼Œå¹¶ä¸” <code>union</code> å­å¥ä¸ªæ•°é™åˆ¶åœ¨ 5 ä¸ªä»¥å†…ã€‚å› ä¸º <code>union all</code> ä¸éœ€è¦å»é‡ï¼ŒèŠ‚çœæ•°æ®åº“èµ„æºï¼Œæé«˜æ€§èƒ½ã€‚</li><li>ã€å»ºè®®ã€‘in å€¼åˆ—è¡¨é™åˆ¶åœ¨ 500 ä»¥å†…ã€‚ä¾‹å¦‚ <code>select â€¦ where user_id in(â€¦500 ä¸ªä»¥å†…â€¦)</code>ï¼Œè¿™ä¹ˆåšæ˜¯ä¸ºäº†å‡å°‘åº•å±‚æ‰«æï¼Œå‡è½»æ•°æ®åº“å‹åŠ›ä»è€ŒåŠ é€ŸæŸ¥è¯¢ã€‚</li><li>ã€å»ºè®®ã€‘äº‹åŠ¡é‡Œæ‰¹é‡æ›´æ–°æ•°æ®éœ€è¦æ§åˆ¶æ•°é‡ï¼Œè¿›è¡Œå¿…è¦çš„ sleepï¼Œåšåˆ°å°‘é‡å¤šæ¬¡ã€‚</li><li>ã€å¼ºåˆ¶ã€‘äº‹åŠ¡æ¶‰åŠçš„è¡¨å¿…é¡»å…¨éƒ¨æ˜¯ InnoDB è¡¨ã€‚å¦åˆ™ä¸€æ—¦å¤±è´¥ä¸ä¼šå…¨éƒ¨å›æ»šï¼Œä¸”æ˜“é€ æˆä¸»ä»åº“åŒæ­¥ç»ˆç«¯ã€‚</li><li>ã€å¼ºåˆ¶ã€‘å†™å…¥å’Œäº‹åŠ¡å‘å¾€ä¸»åº“ï¼Œåªè¯» SQL å‘å¾€ä»åº“ã€‚</li><li>ã€å¼ºåˆ¶ã€‘é™¤é™æ€è¡¨æˆ–å°è¡¨ï¼ˆ100 è¡Œä»¥å†…ï¼‰ï¼Œdml è¯­å¥å¿…é¡»æœ‰ where æ¡ä»¶ï¼Œä¸”ä½¿ç”¨ç´¢å¼•æŸ¥æ‰¾ã€‚</li><li>ã€å¼ºåˆ¶ã€‘ç”Ÿäº§ç¯å¢ƒç¦æ­¢ä½¿ç”¨ <code>hint</code>ï¼Œå¦‚ <code>sql_no_cache</code>ï¼Œ<code>force index</code>ï¼Œ<code>ignore key</code>ï¼Œ<code>straight join</code> ç­‰ã€‚å› ä¸º <code>hint</code> æ˜¯ç”¨æ¥å¼ºåˆ¶ sql æŒ‰ç…§æŸä¸ªæ‰§è¡Œè®¡åˆ’æ¥æ‰§è¡Œï¼Œä½†éšç€æ•°æ®é‡å˜åŒ–æˆ‘ä»¬æ— æ³•ä¿è¯è‡ªå·±å½“åˆçš„é¢„åˆ¤æ˜¯æ­£ç¡®çš„ï¼Œå› æ­¤æˆ‘ä»¬è¦ç›¸ä¿¡ MySQL ä¼˜åŒ–å™¨ã€‚</li><li>ã€å¼ºåˆ¶ã€‘where æ¡ä»¶é‡Œç­‰å·å·¦å³å­—æ®µç±»å‹å¿…é¡»ä¸€è‡´ï¼Œå¦åˆ™æ— æ³•åˆ©ç”¨ç´¢å¼•ã€‚</li><li>ã€å»ºè®®ã€‘<code>select|update|delete|replace</code> è¦æœ‰ where å­å¥ï¼Œä¸” where å­å¥çš„æ¡ä»¶å¿…éœ€ä½¿ç”¨ç´¢å¼•æŸ¥æ‰¾ã€‚</li><li>ã€å¼ºåˆ¶ã€‘ç”Ÿäº§æ•°æ®åº“ä¸­å¼ºçƒˆä¸æ¨èå¤§è¡¨ä¸Šå‘ç”Ÿå…¨è¡¨æ‰«æï¼Œä½†å¯¹äº 100 è¡Œä»¥ä¸‹çš„é™æ€è¡¨å¯ä»¥å…¨è¡¨æ‰«æã€‚æŸ¥è¯¢æ•°æ®é‡ä¸è¦è¶…è¿‡è¡¨è¡Œæ•°çš„ 25%ï¼Œå¦åˆ™ä¸ä¼šåˆ©ç”¨ç´¢å¼•ã€‚</li><li>ã€å¼ºåˆ¶ã€‘where å­å¥ä¸­ç¦æ­¢åªä½¿ç”¨å…¨æ¨¡ç³Šçš„ like æ¡ä»¶è¿›è¡ŒæŸ¥æ‰¾ï¼Œå¿…é¡»æœ‰å…¶å®ƒç­‰å€¼æˆ–èŒƒå›´æŸ¥è¯¢æ¡ä»¶ï¼Œå¦åˆ™æ— æ³•åˆ©ç”¨ç´¢å¼•ã€‚</li><li>ã€å»ºè®®ã€‘ç´¢å¼•åˆ—ä¸è¦ä½¿ç”¨å‡½æ•°æˆ–è¡¨è¾¾å¼ï¼Œå¦åˆ™æ— æ³•åˆ©ç”¨ç´¢å¼•ã€‚å¦‚ <code>where length(name) = &#39;admin&#39;</code> æˆ– <code>where user_id + 2 = 10023</code>ã€‚</li><li>ã€å»ºè®®ã€‘å‡å°‘ä½¿ç”¨ or è¯­å¥ï¼Œå¯å°† or è¯­å¥ä¼˜åŒ–ä¸º unionï¼Œç„¶ååœ¨å„ä¸ª where æ¡ä»¶ä¸Šå»ºç«‹ç´¢å¼•ã€‚å¦‚ <code>where a = 1 or b = 2</code> ä¼˜åŒ–ä¸º <code>where a = 1 â€¦ union â€¦ where b = 2, key(a), key(b)</code>ã€‚</li><li>ã€å»ºè®®ã€‘åˆ†é¡µæŸ¥è¯¢ï¼Œå½“ <code>limit</code> èµ·ç‚¹è¾ƒé«˜æ—¶ï¼Œå¯å…ˆç”¨è¿‡æ»¤æ¡ä»¶è¿›è¡Œè¿‡æ»¤ã€‚å¦‚ <code>select a, b, c from t1 limit 10000, 20;</code> ä¼˜åŒ–ä¸º: <code>select a, b, c from t1 where id &gt; 10000 limit 20;</code>ã€‚</li></ol><h5 id="_2-2-2-å¤šè¡¨è¿æ¥" tabindex="-1"><a class="header-anchor" href="#_2-2-2-å¤šè¡¨è¿æ¥" aria-hidden="true">#</a> 2.2.2 å¤šè¡¨è¿æ¥</h5><ol><li>ã€å¼ºåˆ¶ã€‘ç¦æ­¢è·¨ DB çš„ join è¯­å¥ã€‚å› ä¸ºè¿™æ ·å¯ä»¥å‡å°‘æ¨¡å—é—´è€¦åˆï¼Œä¸ºæ•°æ®åº“æ‹†åˆ†å¥ å®šåšå®åŸºç¡€ã€‚</li><li>ã€å¼ºåˆ¶ã€‘ç¦æ­¢åœ¨ä¸šåŠ¡çš„æ›´æ–°ç±» SQL è¯­å¥ä¸­ä½¿ç”¨ joinï¼Œæ¯”å¦‚ <code>update t1 join t2 â€¦</code>ã€‚</li><li>ã€å»ºè®®ã€‘ä¸å»ºè®®ä½¿ç”¨å­æŸ¥è¯¢ï¼Œå»ºè®®å°†å­æŸ¥è¯¢ SQL æ‹†å¼€ç»“åˆç¨‹åºå¤šæ¬¡æŸ¥è¯¢ï¼Œæˆ–ä½¿ç”¨ join æ¥ä»£æ›¿å­æŸ¥è¯¢ã€‚</li><li>ã€å»ºè®®ã€‘çº¿ä¸Šç¯å¢ƒï¼Œå¤šè¡¨ join ä¸è¦è¶…è¿‡ 3 ä¸ªè¡¨ã€‚</li><li>ã€å»ºè®®ã€‘å¤šè¡¨è¿æ¥æŸ¥è¯¢æ¨èä½¿ç”¨åˆ«åï¼Œä¸” select åˆ—è¡¨ä¸­è¦ç”¨åˆ«åå¼•ç”¨å­—æ®µï¼Œæ•°æ®åº“.è¡¨æ ¼å¼ï¼Œå¦‚ <code>select a from db1.table1 alias1 where â€¦</code>ã€‚</li><li>ã€å»ºè®®ã€‘åœ¨å¤šè¡¨ join ä¸­ï¼Œå°½é‡é€‰å–ç»“æœé›†è¾ƒå°çš„è¡¨ä½œä¸ºé©±åŠ¨è¡¨ï¼Œæ¥ join å…¶å®ƒè¡¨ã€‚</li></ol><h5 id="_2-2-3-äº‹åŠ¡" tabindex="-1"><a class="header-anchor" href="#_2-2-3-äº‹åŠ¡" aria-hidden="true">#</a> 2.2.3 äº‹åŠ¡</h5><ol><li>ã€å»ºè®®ã€‘äº‹åŠ¡ä¸­ <code>insert|update|delete|replace</code> è¯­å¥æ“ä½œçš„è¡Œæ•°æ§åˆ¶åœ¨ 2000 ä»¥å†…ï¼Œä»¥åŠ where å­å¥ä¸­ in åˆ—è¡¨çš„ä¼ å‚ä¸ªæ•°æ§åˆ¶åœ¨ 500 ä»¥å†…ã€‚</li><li>ã€å»ºè®®ã€‘æ‰¹é‡æ“ä½œæ•°æ®æ—¶ï¼Œéœ€è¦æ§åˆ¶äº‹åŠ¡å¤„ç†é—´éš”æ—¶é—´ï¼Œè¿›è¡Œå¿…è¦çš„ sleepï¼Œä¸€èˆ¬å»ºè®®å€¼ 5-10 ç§’ã€‚</li><li>ã€å»ºè®®ã€‘å¯¹äºæœ‰ <code>auto_increment</code> å±æ€§å­—æ®µçš„è¡¨çš„æ’å…¥æ“ä½œï¼Œå¹¶å‘éœ€è¦æ§åˆ¶åœ¨ 200 ä»¥å†…ã€‚</li><li>ã€å¼ºåˆ¶ã€‘ç¨‹åºè®¾è®¡å¿…é¡»è€ƒè™‘â€œæ•°æ®åº“äº‹åŠ¡éš”ç¦»çº§åˆ«â€å¸¦æ¥çš„å½±å“ï¼ŒåŒ…æ‹¬è„è¯»ã€ä¸å¯é‡å¤è¯»å’Œå¹»è¯»ã€‚çº¿ä¸Šå»ºè®®äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸º <code>repeatable-read</code>ã€‚</li><li>ã€å»ºè®®ã€‘äº‹åŠ¡é‡ŒåŒ…å« SQL ä¸è¶…è¿‡ 5 ä¸ªï¼ˆæ”¯ä»˜ä¸šåŠ¡é™¤å¤–ï¼‰ã€‚å› ä¸ºè¿‡é•¿çš„äº‹åŠ¡ä¼šå¯¼è‡´é”æ•°æ®è¾ƒä¹…ï¼ŒMySQL å†…éƒ¨ç¼“å­˜ã€è¿æ¥æ¶ˆè€—è¿‡å¤šç­‰é›ªå´©é—®é¢˜ã€‚</li><li>ã€å»ºè®®ã€‘äº‹åŠ¡é‡Œæ›´æ–°è¯­å¥å°½é‡åŸºäºä¸»é”®æˆ– <code>unique key</code>ï¼Œå¦‚ <code>update â€¦ where id = XX;</code>ï¼Œå¦åˆ™ä¼šäº§ç”Ÿé—´éš™é”ï¼Œå†…éƒ¨æ‰©å¤§é”å®šèŒƒå›´ï¼Œå¯¼è‡´ç³»ç»Ÿæ€§èƒ½ä¸‹é™ï¼Œäº§ç”Ÿæ­»é”ã€‚</li><li>ã€å»ºè®®ã€‘å°½é‡æŠŠä¸€äº›å…¸å‹å¤–éƒ¨è°ƒç”¨ç§»å‡ºäº‹åŠ¡ï¼Œå¦‚è°ƒç”¨ Web Serviceï¼Œè®¿é—®æ–‡ä»¶å­˜å‚¨ç­‰ï¼Œä»è€Œé¿å…äº‹åŠ¡è¿‡é•¿ã€‚</li><li>ã€å»ºè®®ã€‘å¯¹äº MySQL ä¸»ä»å»¶è¿Ÿä¸¥æ ¼æ•æ„Ÿçš„ select è¯­å¥ï¼Œè¯·å¼€å¯äº‹åŠ¡å¼ºåˆ¶è®¿é—®ä¸»åº“ã€‚</li></ol><h5 id="_2-2-4-æ’åºå’Œåˆ†ç»„" tabindex="-1"><a class="header-anchor" href="#_2-2-4-æ’åºå’Œåˆ†ç»„" aria-hidden="true">#</a> 2.2.4 æ’åºå’Œåˆ†ç»„</h5><ol><li>ã€å»ºè®®ã€‘å‡å°‘ä½¿ç”¨ <code>order by</code>ï¼Œå’Œä¸šåŠ¡æ²Ÿé€šèƒ½ä¸æ’åºå°±ä¸æ’åºï¼Œæˆ–å°†æ’åºæ”¾åˆ°ç¨‹åºç«¯å»åšã€‚<code>order by</code>ã€<code>group by</code>ã€<code>distinct</code> è¿™äº›è¯­å¥è¾ƒä¸ºè€—è´¹ CPUï¼Œæ•°æ®åº“çš„ CPU èµ„æºæ˜¯æå…¶å®è´µçš„ã€‚</li><li>ã€å»ºè®®ã€‘<code>order by</code>ã€<code>group by</code>ã€<code>distinct</code> è¿™äº› SQL å°½é‡åˆ©ç”¨ç´¢å¼•ç›´æ¥æ£€ç´¢å‡ºæ’åºå¥½çš„æ•°æ®ã€‚å¦‚ <code>where a = 1 order by</code> å¯ä»¥åˆ©ç”¨ <code>key(a, b)</code>ã€‚</li><li>ã€å»ºè®®ã€‘åŒ…å«äº† <code>order by</code>ã€<code>group by</code>ã€<code>distinct</code> è¿™äº›æŸ¥è¯¢çš„è¯­å¥ï¼Œwhere æ¡ä»¶è¿‡æ»¤å‡ºæ¥çš„ç»“æœé›†è¯·ä¿æŒåœ¨ 1000 è¡Œä»¥å†…ï¼Œå¦åˆ™ SQL ä¼šå¾ˆæ…¢ã€‚</li></ol><h5 id="_2-2-5-çº¿ä¸Šç¦æ­¢ä½¿ç”¨çš„-sql-è¯­å¥" tabindex="-1"><a class="header-anchor" href="#_2-2-5-çº¿ä¸Šç¦æ­¢ä½¿ç”¨çš„-sql-è¯­å¥" aria-hidden="true">#</a> 2.2.5 çº¿ä¸Šç¦æ­¢ä½¿ç”¨çš„ SQL è¯­å¥</h5><ol><li>ã€é«˜å±ã€‘ç¦ç”¨ <code>update|delete t1 â€¦ where a = XX limit XX;</code> è¿™ç§å¸¦ limit çš„æ›´æ–°è¯­å¥ã€‚å› ä¸ºä¼šå¯¼è‡´ä¸»ä»ä¸ä¸€è‡´ï¼Œå¯¼è‡´æ•°æ®é”™ä¹±ã€‚å»ºè®®åŠ ä¸Š <code>order by PK</code>ã€‚</li><li>ã€é«˜å±ã€‘ç¦æ­¢ä½¿ç”¨å…³è”å­æŸ¥è¯¢ï¼Œå¦‚ <code>update t1 set â€¦ where name in(select name from user where â€¦);</code>ï¼Œæ•ˆç‡æå…¶ä½ä¸‹ã€‚</li><li>ã€å¼ºåˆ¶ã€‘ç¦ç”¨ procedureã€functionã€triggerã€viewsã€eventã€å¤–é”®çº¦æŸã€‚å› ä¸ºä»–ä»¬æ¶ˆè€—æ•°æ®åº“èµ„æºï¼Œé™ä½æ•°æ®åº“å®ä¾‹å¯æ‰©å±•æ€§ã€‚æ¨èéƒ½åœ¨ç¨‹åºç«¯å®ç°ã€‚</li><li>ã€å¼ºåˆ¶ã€‘ç¦ç”¨ <code>insert into â€¦ on duplicate key update â€¦</code> åœ¨é«˜å¹¶å‘ç¯å¢ƒä¸‹ï¼Œä¼šé€ æˆä¸»ä»ä¸ä¸€è‡´ã€‚</li><li>ã€å¼ºåˆ¶ã€‘ç¦æ­¢è”è¡¨æ›´æ–°è¯­å¥ï¼Œå¦‚ <code>update t1, t2 where t1.id = t2.id â€¦</code>ã€‚</li></ol><h2 id="mysql-advanced" tabindex="-1"><a class="header-anchor" href="#mysql-advanced" aria-hidden="true">#</a> Mysql Advanced</h2><h3 id="é€»è¾‘æ¶æ„" tabindex="-1"><a class="header-anchor" href="#é€»è¾‘æ¶æ„" aria-hidden="true">#</a> é€»è¾‘æ¶æ„</h3><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230201105202736.png" alt="image-20230201105202736"></p><p>â€‹ <strong>InnoDB(Storage Engines) Architecture</strong></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230201133131813.png" alt="image-20230201133131813"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230201105921902.png" alt="image-20230201105921902"></p><h3 id="mysqlä¸‰å¤§æ—¥å¿—" tabindex="-1"><a class="header-anchor" href="#mysqlä¸‰å¤§æ—¥å¿—" aria-hidden="true">#</a> MySQLä¸‰å¤§æ—¥å¿—</h3><blockquote><p>MySQL<strong>é‡‡ç”¨WALï¼ˆWrite-Ahead Logï¼‰å…ˆå†™æ—¥å¿—æœºåˆ¶</strong></p><ul><li>redo log å’Œ binlogéƒ½æ˜¯<strong>é¡ºåºå†™</strong>ï¼Œç£ç›˜çš„é¡ºåºå†™æ¯”éšæœºå†™é€Ÿåº¦è¦å¿«ï¼›</li><li><strong>ç»„æäº¤æœºåˆ¶</strong>ï¼Œå¯ä»¥å¤§å¹…åº¦é™ä½ç£ç›˜çš„IOPSæ¶ˆè€—ã€‚ï¼ˆæ—¥å¿—é€»è¾‘åºåˆ—å·ï¼ˆlog sequence numberï¼ŒLSNï¼‰çš„æ¦‚å¿µã€‚LSNæ˜¯å•è°ƒé€’å¢çš„ï¼Œç”¨æ¥å¯¹åº”redo logçš„ä¸€ä¸ªä¸ªå†™å…¥ç‚¹ã€‚æ¯æ¬¡å†™å…¥é•¿åº¦ä¸ºlengthçš„redo logï¼Œ LSNçš„å€¼å°±ä¼šåŠ ä¸Šlengthã€‚ï¼‰</li></ul><p><code>MySQL</code> æ—¥å¿— ä¸»è¦åŒ…æ‹¬é”™è¯¯æ—¥å¿—ã€æŸ¥è¯¢æ—¥å¿—ã€æ…¢æŸ¥è¯¢æ—¥å¿—ã€äº‹åŠ¡æ—¥å¿—ã€äºŒè¿›åˆ¶æ—¥å¿—å‡ å¤§ç±»ã€‚</p><p>å…¶ä¸­ï¼Œæ¯”è¾ƒé‡è¦çš„è¿˜è¦å±</p><ul><li><code>binlog</code>ï¼ˆå½’æ¡£æ—¥å¿—ï¼‰MySQLçš„<strong>Serverå±‚å®ç°çš„</strong>ï¼›<code>MySQL</code>æ•°æ®åº“çš„<strong>æ•°æ®å¤‡ä»½ã€ä¸»å¤‡ã€ä¸»ä¸»ã€ä¸»ä»</strong>éƒ½ç¦»ä¸å¼€<code>binlog</code>ï¼Œéœ€è¦ä¾é <code>binlog</code>æ¥åŒæ­¥æ•°æ®ï¼Œä¿è¯æ•°æ®ä¸€è‡´æ€§ã€‚</li><li><code>redo log</code>ï¼ˆé‡åšæ—¥å¿—ï¼‰ <strong>InnoDB ç‰¹æœ‰çš„</strong>è®©<code>MySQL</code>æ‹¥æœ‰äº†<strong>å´©æºƒæ¢å¤èƒ½åŠ›</strong><code>MySQL</code> å®ä¾‹å®•æœºäº†ï¼Œé‡å¯æ—¶ï¼Œ<code>InnoDB</code>å­˜å‚¨å¼•æ“ä½¿ç”¨<code>redo log</code>æ¢å¤æ•°æ®ï¼Œ ä¿è¯æ•°æ®çš„æŒä¹…æ€§ä¸å®Œæ•´æ€§ã€‚</li><li><code>undo log</code>ï¼ˆå›æ»šæ—¥å¿—ï¼‰ã€‚<code>MySQL</code>æ‰§è¡Œè¿‡ç¨‹ä¸­é‡åˆ°å¼‚å¸¸çš„è¯ï¼Œæˆ‘ä»¬ç›´æ¥åˆ©ç”¨ <strong>å›æ»šæ—¥å¿—</strong> ä¸­çš„ä¿¡æ¯å°†æ•°æ®å›æ»šåˆ°ä¿®æ”¹ä¹‹å‰çš„æ ·å­å³å¯ï¼äº‹åŠ¡è¿›è¡Œä¿®æ”¹å‰éƒ½ä¼šå…ˆè®°å½•åˆ°è¿™ä¸ªå›æ»šæ—¥å¿—ä¸­</li></ul><p><strong>â€œåŒ1â€é…ç½®</strong>ï¼ŒæŒ‡çš„å°±æ˜¯<strong>sync_binlogå’Œinnodb_flush_log_at_trx_commitéƒ½è®¾ç½®æˆ 1</strong>ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªäº‹åŠ¡å®Œæ•´æäº¤å‰ï¼Œéœ€è¦ç­‰å¾…ä¸¤æ¬¡åˆ·ç›˜ï¼Œä¸€æ¬¡æ˜¯redo logï¼ˆprepare é˜¶æ®µï¼‰ï¼Œä¸€æ¬¡æ˜¯binlogã€‚</p><p><strong>é€šè¿‡è°ƒæ•´æ—¥å¿—é…ç½®æå‡MySQLçš„I/Oç“¶é¢ˆ</strong>ï¼ˆå¯¹æ•°æ®çš„å®‰å…¨æ€§åšç›¸åº”çš„å¦¥åï¼‰</p><ol><li>è®¾ç½® binlog_group_commit_sync_delay å’Œ binlog_group_commit_sync_no_delay_countå‚æ•°ï¼Œå‡å°‘binlogçš„å†™ç›˜æ¬¡æ•°ã€‚è¿™ä¸ªæ–¹æ³•æ˜¯åŸºäºâ€œé¢å¤–çš„æ•…æ„ç­‰å¾…â€æ¥å®ç°çš„ï¼Œå› æ­¤å¯èƒ½ä¼šå¢åŠ è¯­å¥çš„å“åº”æ—¶é—´ï¼Œä½†æ²¡æœ‰ä¸¢å¤±æ•°æ®çš„é£é™©ã€‚</li><li>å°†sync_binlog è®¾ç½®ä¸ºå¤§äº1çš„å€¼ï¼ˆç´¯ç§¯Nä¸ªäº‹åŠ¡åæ‰fsyncï¼‰ï¼ˆæ¯”è¾ƒå¸¸è§æ˜¯100~1000ï¼‰ã€‚è¿™æ ·åšçš„é£é™©æ˜¯ï¼Œä¸»æœºæ‰ç”µæ—¶ä¼šä¸¢binlogæ—¥å¿—ã€‚</li><li>å°†innodb_flush_log_at_trx_commitè®¾ç½®ä¸º2ï¼ˆæ¯æ¬¡äº‹åŠ¡æäº¤æ—¶éƒ½åªæŠŠ redo log buffer å†…å®¹å†™å…¥ page cacheï¼‰ã€‚é£é™©æ˜¯ï¼Œä¸»æœºæ‰ç”µçš„æ—¶å€™ä¼šä¸¢æ•°æ®ã€‚</li></ol></blockquote><h4 id="redo-log" tabindex="-1"><a class="header-anchor" href="#redo-log" aria-hidden="true">#</a> redo log</h4><blockquote><p><code>redo log</code>ï¼ˆé‡åšæ—¥å¿—ï¼‰æ˜¯<code>InnoDB</code>å­˜å‚¨å¼•æ“ç‹¬æœ‰çš„ï¼Œå®ƒè®©<code>MySQL</code>æ‹¥æœ‰äº†å´©æºƒæ¢å¤èƒ½åŠ›ã€‚</p><p>æ¯”å¦‚ <code>MySQL</code> å®ä¾‹æŒ‚äº†æˆ–å®•æœºäº†ï¼Œé‡å¯æ—¶ï¼Œ<code>InnoDB</code>å­˜å‚¨å¼•æ“ä¼šä½¿ç”¨<code>redo log</code>æ¢å¤æ•°æ®ï¼Œä¿è¯æ•°æ®çš„æŒä¹…æ€§ä¸å®Œæ•´æ€§ã€‚</p><p><strong>redo logåˆ·ç›˜æ—¶æœº</strong></p><p><code>InnoDB</code> å­˜å‚¨å¼•æ“ä¸º <code>redo log</code> çš„åˆ·ç›˜ç­–ç•¥æä¾›äº† <code>innodb_flush_log_at_trx_commit</code> å‚æ•°ï¼Œå®ƒæ”¯æŒä¸‰ç§ç­–ç•¥ï¼š</p><ul><li><strong>0</strong> ï¼šè®¾ç½®ä¸º 0 çš„æ—¶å€™ï¼Œè¡¨ç¤ºæ¯æ¬¡äº‹åŠ¡æäº¤æ—¶ä¸è¿›è¡Œåˆ·ç›˜æ“ä½œ</li><li><strong>1</strong> ï¼šè®¾ç½®ä¸º 1 çš„æ—¶å€™ï¼Œè¡¨ç¤ºæ¯æ¬¡äº‹åŠ¡æäº¤æ—¶éƒ½å°†è¿›è¡Œåˆ·ç›˜æ“ä½œï¼ˆé»˜è®¤å€¼ï¼‰</li><li><strong>2</strong> ï¼šè®¾ç½®ä¸º 2 çš„æ—¶å€™ï¼Œè¡¨ç¤ºæ¯æ¬¡äº‹åŠ¡æäº¤æ—¶éƒ½åªæŠŠ redo log buffer å†…å®¹å†™å…¥ page cache</li></ul><p><code>innodb_flush_log_at_trx_commit</code> å‚æ•°é»˜è®¤ä¸º 1 ï¼Œä¹Ÿå°±æ˜¯è¯´å½“äº‹åŠ¡æäº¤æ—¶ä¼šè°ƒç”¨ <code>fsync</code> å¯¹ redo log è¿›è¡Œåˆ·ç›˜</p><p><strong>åå°çº¿ç¨‹è¿›è¡Œæ¯ç§’fsync</strong>ï¼š<code>InnoDB</code> å­˜å‚¨å¼•æ“æœ‰ä¸€ä¸ªåå°çº¿ç¨‹ï¼Œæ¯éš”<code>1</code> ç§’ï¼Œå°±ä¼šæŠŠ <code>redo log buffer</code> ä¸­çš„å†…å®¹å†™åˆ°æ–‡ä»¶ç³»ç»Ÿç¼“å­˜ï¼ˆ<code>page cache</code>ï¼‰ï¼Œç„¶åè°ƒç”¨ <code>fsync</code> åˆ·ç›˜ã€‚</p></blockquote><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230201162750599.png" alt="image-20230201162750599"></p><p><code>MySQL</code> ä¸­æ•°æ®æ˜¯ä»¥é¡µä¸ºå•ä½ï¼Œä½ æŸ¥è¯¢ä¸€æ¡è®°å½•ï¼Œä¼šä»ç¡¬ç›˜æŠŠä¸€é¡µçš„æ•°æ®åŠ è½½å‡ºæ¥ï¼ŒåŠ è½½å‡ºæ¥çš„æ•°æ®å«æ•°æ®é¡µï¼Œä¼šæ”¾å…¥åˆ° <code>Buffer Pool</code> ä¸­ã€‚</p><p>åç»­çš„æŸ¥è¯¢éƒ½æ˜¯å…ˆä» <code>Buffer Pool</code> ä¸­æ‰¾ï¼Œæ²¡æœ‰å‘½ä¸­å†å»ç¡¬ç›˜åŠ è½½ï¼Œå‡å°‘ç¡¬ç›˜ <code>IO</code> å¼€é”€ï¼Œæå‡æ€§èƒ½ã€‚</p><p>æ›´æ–°è¡¨æ•°æ®çš„æ—¶å€™ï¼Œä¹Ÿæ˜¯å¦‚æ­¤ï¼Œå‘ç° <code>Buffer Pool</code> é‡Œå­˜åœ¨è¦æ›´æ–°çš„æ•°æ®ï¼Œå°±ç›´æ¥åœ¨ <code>Buffer Pool</code> é‡Œæ›´æ–°ã€‚</p><p>ç„¶åä¼šæŠŠâ€œåœ¨æŸä¸ªæ•°æ®é¡µä¸Šåšäº†ä»€ä¹ˆä¿®æ”¹â€è®°å½•åˆ°é‡åšæ—¥å¿—ç¼“å­˜ï¼ˆ<code>redo log buffer</code>ï¼‰é‡Œï¼Œæ¥ç€åˆ·ç›˜åˆ° <code>redo log</code> æ–‡ä»¶é‡Œã€‚</p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230201162830131.png" alt="image-20230201162830131"></p><blockquote><p>å›¾ç‰‡ç¬”è¯¯æç¤ºï¼šç¬¬ 4 æ­¥ â€œæ¸…ç©º redo log buffe åˆ·ç›˜åˆ° redo æ—¥å¿—ä¸­â€è¿™å¥è¯ä¸­çš„ buffe åº”è¯¥æ˜¯ bufferã€‚</p></blockquote><p>ç†æƒ³æƒ…å†µï¼Œäº‹åŠ¡ä¸€æäº¤å°±ä¼šè¿›è¡Œåˆ·ç›˜æ“ä½œï¼Œä½†å®é™…ä¸Šï¼Œåˆ·ç›˜çš„æ—¶æœºæ˜¯æ ¹æ®ç­–ç•¥æ¥è¿›è¡Œçš„ã€‚</p><blockquote><p>å°è´´å£«ï¼šæ¯æ¡ redo è®°å½•ç”±â€œè¡¨ç©ºé—´å·+æ•°æ®é¡µå·+åç§»é‡+ä¿®æ”¹æ•°æ®é•¿åº¦+å…·ä½“ä¿®æ”¹çš„æ•°æ®â€ç»„æˆ</p></blockquote><p><strong>åˆ·ç›˜æ—¶æœº</strong></p><p><code>InnoDB</code> å­˜å‚¨å¼•æ“ä¸º <code>redo log</code> çš„åˆ·ç›˜ç­–ç•¥æä¾›äº† <code>innodb_flush_log_at_trx_commit</code> å‚æ•°ï¼Œå®ƒæ”¯æŒä¸‰ç§ç­–ç•¥ï¼š</p><ul><li><strong>0</strong> ï¼šè®¾ç½®ä¸º 0 çš„æ—¶å€™ï¼Œè¡¨ç¤ºæ¯æ¬¡äº‹åŠ¡æäº¤æ—¶ä¸è¿›è¡Œåˆ·ç›˜æ“ä½œ</li><li><strong>1</strong> ï¼šè®¾ç½®ä¸º 1 çš„æ—¶å€™ï¼Œè¡¨ç¤ºæ¯æ¬¡äº‹åŠ¡æäº¤æ—¶éƒ½å°†è¿›è¡Œåˆ·ç›˜æ“ä½œï¼ˆé»˜è®¤å€¼ï¼‰</li><li><strong>2</strong> ï¼šè®¾ç½®ä¸º 2 çš„æ—¶å€™ï¼Œè¡¨ç¤ºæ¯æ¬¡äº‹åŠ¡æäº¤æ—¶éƒ½åªæŠŠ redo log buffer å†…å®¹å†™å…¥ page cache</li></ul><p><code>innodb_flush_log_at_trx_commit</code> å‚æ•°é»˜è®¤ä¸º 1 ï¼Œä¹Ÿå°±æ˜¯è¯´å½“äº‹åŠ¡æäº¤æ—¶ä¼šè°ƒç”¨ <code>fsync</code> å¯¹ redo log è¿›è¡Œåˆ·ç›˜</p><p>å¦å¤–ï¼Œ<code>InnoDB</code> å­˜å‚¨å¼•æ“æœ‰ä¸€ä¸ªåå°çº¿ç¨‹ï¼Œæ¯éš”<code>1</code> ç§’ï¼Œå°±ä¼šæŠŠ <code>redo log buffer</code> ä¸­çš„å†…å®¹å†™åˆ°æ–‡ä»¶ç³»ç»Ÿç¼“å­˜ï¼ˆ<code>page cache</code>ï¼‰ï¼Œç„¶åè°ƒç”¨ <code>fsync</code> åˆ·ç›˜ã€‚</p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230201162843799.png" alt="image-20230201162843799"></p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªæ²¡æœ‰æäº¤äº‹åŠ¡çš„ <code>redo log</code> è®°å½•ï¼Œä¹Ÿå¯èƒ½ä¼šåˆ·ç›˜ã€‚</p><p><strong>ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</strong></p><p>å› ä¸ºåœ¨äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ <code>redo log</code> è®°å½•æ˜¯ä¼šå†™å…¥<code>redo log buffer</code> ä¸­ï¼Œè¿™äº› <code>redo log</code> è®°å½•ä¼šè¢«åå°çº¿ç¨‹åˆ·ç›˜ã€‚</p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230201162856200.png" alt="image-20230201162856200"></p><p>é™¤äº†åå°çº¿ç¨‹æ¯ç§’<code>1</code>æ¬¡çš„è½®è¯¢æ“ä½œï¼Œè¿˜æœ‰ä¸€ç§æƒ…å†µï¼Œå½“ <code>redo log buffer</code> å ç”¨çš„ç©ºé—´å³å°†è¾¾åˆ° <code>innodb_log_buffer_size</code> ä¸€åŠçš„æ—¶å€™ï¼Œåå°çº¿ç¨‹ä¼šä¸»åŠ¨åˆ·ç›˜ã€‚</p><p>ä¸‹é¢æ˜¯ä¸åŒåˆ·ç›˜ç­–ç•¥çš„æµç¨‹å›¾ã€‚</p><p><strong>innodb_flush_log_at_trx_commit=0</strong></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230201162915440.png" alt="image-20230201162915440"></p><p>ä¸º<code>0</code>æ—¶ï¼Œå¦‚æœ<code>MySQL</code>æŒ‚äº†æˆ–å®•æœºå¯èƒ½ä¼šæœ‰<code>1</code>ç§’æ•°æ®çš„ä¸¢å¤±ã€‚</p><p><strong>innodb_flush_log_at_trx_commit=1</strong></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230201162928627.png" alt="image-20230201162928627"></p><p>ä¸º<code>1</code>æ—¶ï¼Œ åªè¦äº‹åŠ¡æäº¤æˆåŠŸï¼Œ<code>redo log</code>è®°å½•å°±ä¸€å®šåœ¨ç¡¬ç›˜é‡Œï¼Œä¸ä¼šæœ‰ä»»ä½•æ•°æ®ä¸¢å¤±ã€‚</p><p>å¦‚æœäº‹åŠ¡æ‰§è¡ŒæœŸé—´<code>MySQL</code>æŒ‚äº†æˆ–å®•æœºï¼Œè¿™éƒ¨åˆ†æ—¥å¿—ä¸¢äº†ï¼Œä½†æ˜¯äº‹åŠ¡å¹¶æ²¡æœ‰æäº¤ï¼Œæ‰€ä»¥æ—¥å¿—ä¸¢äº†ä¹Ÿä¸ä¼šæœ‰æŸå¤±ã€‚</p><p><strong>innodb_flush_log_at_trx_commit=2</strong></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230201162939325.png" alt="image-20230201162939325"></p><p>ä¸º<code>2</code>æ—¶ï¼Œ åªè¦äº‹åŠ¡æäº¤æˆåŠŸï¼Œ<code>redo log buffer</code>ä¸­çš„å†…å®¹åªå†™å…¥æ–‡ä»¶ç³»ç»Ÿç¼“å­˜ï¼ˆ<code>page cache</code>ï¼‰ã€‚</p><p>å¦‚æœä»…ä»…åªæ˜¯<code>MySQL</code>æŒ‚äº†ä¸ä¼šæœ‰ä»»ä½•æ•°æ®ä¸¢å¤±ï¼Œä½†æ˜¯å®•æœºå¯èƒ½ä¼šæœ‰<code>1</code>ç§’æ•°æ®çš„ä¸¢å¤±ã€‚</p><p><strong>æ—¥å¿—æ–‡ä»¶ç»„</strong></p><p>ç¡¬ç›˜ä¸Šå­˜å‚¨çš„ <code>redo log</code> æ—¥å¿—æ–‡ä»¶ä¸åªä¸€ä¸ªï¼Œè€Œæ˜¯ä»¥ä¸€ä¸ª<strong>æ—¥å¿—æ–‡ä»¶ç»„</strong>çš„å½¢å¼å‡ºç°çš„ï¼Œæ¯ä¸ªçš„<code>redo</code>æ—¥å¿—æ–‡ä»¶å¤§å°éƒ½æ˜¯ä¸€æ ·çš„ã€‚</p><p>æ¯”å¦‚å¯ä»¥é…ç½®ä¸ºä¸€ç»„<code>4</code>ä¸ªæ–‡ä»¶ï¼Œæ¯ä¸ªæ–‡ä»¶çš„å¤§å°æ˜¯ <code>1GB</code>ï¼Œæ•´ä¸ª <code>redo log</code> æ—¥å¿—æ–‡ä»¶ç»„å¯ä»¥è®°å½•<code>4G</code>çš„å†…å®¹ã€‚</p><p>å®ƒé‡‡ç”¨çš„æ˜¯ç¯å½¢æ•°ç»„å½¢å¼ï¼Œä»å¤´å¼€å§‹å†™ï¼Œå†™åˆ°æœ«å°¾åˆå›åˆ°å¤´å¾ªç¯å†™ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230201163003913.png" alt="image-20230201163003913"></p><p>åœ¨ä¸ª<strong>æ—¥å¿—æ–‡ä»¶ç»„</strong>ä¸­è¿˜æœ‰ä¸¤ä¸ªé‡è¦çš„å±æ€§ï¼Œåˆ†åˆ«æ˜¯ <code>write posã€checkpoint</code></p><ul><li><strong>write pos</strong> æ˜¯å½“å‰è®°å½•çš„ä½ç½®ï¼Œä¸€è¾¹å†™ä¸€è¾¹åç§»</li><li><strong>checkpoint</strong> æ˜¯å½“å‰è¦æ“¦é™¤çš„ä½ç½®ï¼Œä¹Ÿæ˜¯å¾€åæ¨ç§»</li></ul><p>æ¯æ¬¡åˆ·ç›˜ <code>redo log</code> è®°å½•åˆ°<strong>æ—¥å¿—æ–‡ä»¶ç»„</strong>ä¸­ï¼Œ<code>write pos</code> ä½ç½®å°±ä¼šåç§»æ›´æ–°ã€‚</p><p>æ¯æ¬¡ <code>MySQL</code> åŠ è½½<strong>æ—¥å¿—æ–‡ä»¶ç»„</strong>æ¢å¤æ•°æ®æ—¶ï¼Œä¼šæ¸…ç©ºåŠ è½½è¿‡çš„ <code>redo log</code> è®°å½•ï¼Œå¹¶æŠŠ <code>checkpoint</code> åç§»æ›´æ–°ã€‚</p><p><code>write pos</code> å’Œ <code>checkpoint</code> ä¹‹é—´çš„è¿˜ç©ºç€çš„éƒ¨åˆ†å¯ä»¥ç”¨æ¥å†™å…¥æ–°çš„ <code>redo log</code> è®°å½•ã€‚</p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230201163014042.png" alt="image-20230201163014042"></p><p>å¦‚æœ <code>write pos</code> è¿½ä¸Š <code>checkpoint</code> ï¼Œè¡¨ç¤º<strong>æ—¥å¿—æ–‡ä»¶ç»„</strong>æ»¡äº†ï¼Œè¿™æ—¶å€™ä¸èƒ½å†å†™å…¥æ–°çš„ <code>redo log</code> è®°å½•ï¼Œ<code>MySQL</code> å¾—åœä¸‹æ¥ï¼Œæ¸…ç©ºä¸€äº›è®°å½•ï¼ŒæŠŠ <code>checkpoint</code> æ¨è¿›ä¸€ä¸‹ã€‚</p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230201163023927.png" alt="image-20230201163023927"></p><p><strong>redo log å°ç»“</strong></p><p>ç›¸ä¿¡å¤§å®¶éƒ½çŸ¥é“ <code>redo log</code> çš„ä½œç”¨å’Œå®ƒçš„åˆ·ç›˜æ—¶æœºã€å­˜å‚¨å½¢å¼ã€‚</p><p>ç°åœ¨æˆ‘ä»¬æ¥æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼š <strong>åªè¦æ¯æ¬¡æŠŠä¿®æ”¹åçš„æ•°æ®é¡µç›´æ¥åˆ·ç›˜ä¸å°±å¥½äº†ï¼Œè¿˜æœ‰ <code>redo log</code> ä»€ä¹ˆäº‹ï¼Ÿ</strong></p><p>å®ƒä»¬ä¸éƒ½æ˜¯åˆ·ç›˜ä¹ˆï¼Ÿå·®åˆ«åœ¨å“ªé‡Œï¼Ÿ</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token number">1</span> <span class="token class-name">Byte</span> <span class="token operator">=</span> <span class="token number">8</span>bit
<span class="token number">1</span> <span class="token constant">KB</span> <span class="token operator">=</span> <span class="token number">1024</span> <span class="token class-name">Byte</span>
<span class="token number">1</span> <span class="token constant">MB</span> <span class="token operator">=</span> <span class="token number">1024</span> <span class="token constant">KB</span>
<span class="token number">1</span> <span class="token constant">GB</span> <span class="token operator">=</span> <span class="token number">1024</span> <span class="token constant">MB</span>
<span class="token number">1</span> <span class="token constant">TB</span> <span class="token operator">=</span> <span class="token number">1024</span> <span class="token constant">GB</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®é™…ä¸Šï¼Œæ•°æ®é¡µå¤§å°æ˜¯<code>16KB</code>ï¼Œåˆ·ç›˜æ¯”è¾ƒè€—æ—¶ï¼Œå¯èƒ½å°±ä¿®æ”¹äº†æ•°æ®é¡µé‡Œçš„å‡  <code>Byte</code> æ•°æ®ï¼Œæœ‰å¿…è¦æŠŠå®Œæ•´çš„æ•°æ®é¡µåˆ·ç›˜å—ï¼Ÿ</p><p>è€Œä¸”æ•°æ®é¡µåˆ·ç›˜æ˜¯éšæœºå†™ï¼Œå› ä¸ºä¸€ä¸ªæ•°æ®é¡µå¯¹åº”çš„ä½ç½®å¯èƒ½åœ¨ç¡¬ç›˜æ–‡ä»¶çš„éšæœºä½ç½®ï¼Œæ‰€ä»¥æ€§èƒ½æ˜¯å¾ˆå·®ã€‚</p><p>å¦‚æœæ˜¯å†™ <code>redo log</code>ï¼Œä¸€è¡Œè®°å½•å¯èƒ½å°±å å‡ å <code>Byte</code>ï¼ŒåªåŒ…å«è¡¨ç©ºé—´å·ã€æ•°æ®é¡µå·ã€ç£ç›˜æ–‡ä»¶åç§» é‡ã€æ›´æ–°å€¼ï¼Œå†åŠ ä¸Šæ˜¯é¡ºåºå†™ï¼Œæ‰€ä»¥åˆ·ç›˜é€Ÿåº¦å¾ˆå¿«ã€‚</p><p>æ‰€ä»¥ç”¨ <code>redo log</code> å½¢å¼è®°å½•ä¿®æ”¹å†…å®¹ï¼Œæ€§èƒ½ä¼šè¿œè¿œè¶…è¿‡åˆ·æ•°æ®é¡µçš„æ–¹å¼ï¼Œè¿™ä¹Ÿè®©æ•°æ®åº“çš„å¹¶å‘èƒ½åŠ›æ›´å¼ºã€‚</p><blockquote><p>å…¶å®å†…å­˜çš„æ•°æ®é¡µåœ¨ä¸€å®šæ—¶æœºä¹Ÿä¼šåˆ·ç›˜ï¼Œæˆ‘ä»¬æŠŠè¿™ç§°ä¸ºé¡µåˆå¹¶ï¼Œè®² <code>Buffer Pool</code>çš„æ—¶å€™ä¼šå¯¹è¿™å—ç»†è¯´</p></blockquote><h4 id="binlog" tabindex="-1"><a class="header-anchor" href="#binlog" aria-hidden="true">#</a> binlog</h4><blockquote><p><code>redo log</code> å®ƒæ˜¯ç‰©ç†æ—¥å¿—ï¼Œè®°å½•å†…å®¹æ˜¯â€œåœ¨æŸä¸ªæ•°æ®é¡µä¸Šåšäº†ä»€ä¹ˆä¿®æ”¹â€ï¼Œå±äº <code>InnoDB</code> å­˜å‚¨å¼•æ“ã€‚</p><p>è€Œ <code>binlog</code> æ˜¯é€»è¾‘æ—¥å¿—ï¼Œè®°å½•å†…å®¹æ˜¯è¯­å¥çš„åŸå§‹é€»è¾‘ï¼Œç±»ä¼¼äºâ€œç»™ ID=2 è¿™ä¸€è¡Œçš„ c å­—æ®µåŠ  1â€ï¼Œå±äº<code>MySQL Server</code> å±‚ã€‚</p><p>ä¸ç®¡ç”¨ä»€ä¹ˆå­˜å‚¨å¼•æ“ï¼Œåªè¦å‘ç”Ÿäº†è¡¨æ•°æ®æ›´æ–°ï¼Œéƒ½ä¼šäº§ç”Ÿ <code>binlog</code> æ—¥å¿—ã€‚</p><p><code>MySQL</code>æ•°æ®åº“çš„<strong>æ•°æ®å¤‡ä»½ã€ä¸»å¤‡ã€ä¸»ä¸»ã€ä¸»ä»</strong>éƒ½ç¦»ä¸å¼€<code>binlog</code>ï¼Œéœ€è¦ä¾é <code>binlog</code>æ¥åŒæ­¥æ•°æ®ï¼Œä¿è¯æ•°æ®ä¸€è‡´æ€§ã€‚</p><p><code>binlog</code> æ—¥å¿—æœ‰ä¸‰ç§æ ¼å¼ï¼Œå¯ä»¥é€šè¿‡<code>binlog_format</code>å‚æ•°æŒ‡å®šã€‚</p><ul><li><strong>statement</strong>ï¼ˆSQLè¯­å¥åŸæ–‡ï¼›ä½†æ˜¯ä¾‹å¦‚update_time=now()è¿™é‡Œä¼šè·å–å½“å‰ç³»ç»Ÿæ—¶é—´ï¼Œç›´æ¥æ‰§è¡Œä¼šå¯¼è‡´ä¸åŸåº“çš„æ•°æ®ä¸ä¸€è‡´ï¼‰</li><li><strong>row</strong>ï¼ˆè¦é€šè¿‡mysqlbinlogå·¥å…·è§£æï¼›update_time=now()å˜æˆäº†å…·ä½“çš„1627112756247ï¼›ä½†æ˜¯å ç”¨ç©ºé—´ï¼Œæ¶ˆè€—IOèµ„æºï¼Œå½±å“æ‰§è¡Œé€Ÿåº¦ï¼‰</li><li><strong>mixed</strong>(ä¼šåˆ¤æ–­è¿™æ¡SQLè¯­å¥æ˜¯å¦å¯èƒ½å¼•èµ·æ•°æ®ä¸ä¸€è‡´ï¼Œå¦‚æœæ˜¯ï¼Œå°±ç”¨rowæ ¼å¼ï¼Œå¦åˆ™å°±ç”¨statementæ ¼å¼ã€‚<strong>æŠ˜ä¸­æ–¹æ¡ˆ</strong>)</li></ul><p><strong>binlogåˆ·ç›˜æ—¶æœº</strong></p><p><code>sync_binlog</code> å‚æ•°ï¼Œå®ƒæ”¯æŒä¸‰ç§ç­–ç•¥ï¼š</p><ul><li><strong>0</strong> ï¼šè¡¨ç¤ºæ¯æ¬¡æäº¤äº‹åŠ¡éƒ½åª<code>write</code>ï¼Œç”±ç³»ç»Ÿè‡ªè¡Œåˆ¤æ–­ä»€ä¹ˆæ—¶å€™æ‰§è¡Œ<code>fsync</code>ã€‚ï¼ˆé»˜è®¤å€¼ï¼‰</li><li><strong>1</strong> ï¼šè¡¨ç¤ºæ¯æ¬¡æäº¤äº‹åŠ¡éƒ½ä¼šæ‰§è¡Œ<code>fsync</code>ï¼Œå°±å¦‚åŒ redo log æ—¥å¿—åˆ·ç›˜æµç¨‹ ä¸€æ ·ã€‚</li><li><strong>&gt;1</strong> ï¼šè¡¨ç¤ºæ¯æ¬¡æäº¤äº‹åŠ¡éƒ½<code>write</code>ï¼Œä½†ç´¯ç§¯<code>N</code>ä¸ªäº‹åŠ¡åæ‰<code>fsync</code>ã€‚</li></ul></blockquote><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230201163038287.png" alt="image-20230201163038287"></p><p><code>binlog</code>ä¼šè®°å½•æ‰€æœ‰æ¶‰åŠæ›´æ–°æ•°æ®çš„é€»è¾‘æ“ä½œï¼Œå¹¶ä¸”æ˜¯é¡ºåºå†™ã€‚</p><p><strong>è®°å½•æ ¼å¼</strong></p><p><code>binlog</code> æ—¥å¿—æœ‰ä¸‰ç§æ ¼å¼ï¼Œå¯ä»¥é€šè¿‡<code>binlog_format</code>å‚æ•°æŒ‡å®šã€‚</p><ul><li><strong>statement</strong></li><li><strong>row</strong></li><li><strong>mixed</strong></li></ul><p>æŒ‡å®š<code>statement</code>ï¼Œè®°å½•çš„å†…å®¹æ˜¯<code>SQL</code>è¯­å¥åŸæ–‡ï¼Œæ¯”å¦‚æ‰§è¡Œä¸€æ¡<code>update T set update_time=now() where id=1</code>ï¼Œè®°å½•çš„å†…å®¹å¦‚ä¸‹ã€‚</p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230201163049621.png" alt="image-20230201163049621"></p><p>åŒæ­¥æ•°æ®æ—¶ï¼Œä¼šæ‰§è¡Œè®°å½•çš„<code>SQL</code>è¯­å¥ï¼Œä½†æ˜¯æœ‰ä¸ªé—®é¢˜ï¼Œ<code>update_time=now()</code>è¿™é‡Œä¼šè·å–å½“å‰ç³»ç»Ÿæ—¶é—´ï¼Œç›´æ¥æ‰§è¡Œä¼šå¯¼è‡´ä¸åŸåº“çš„æ•°æ®ä¸ä¸€è‡´ã€‚</p><p>ä¸ºäº†è§£å†³è¿™ç§é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦æŒ‡å®šä¸º<code>row</code>ï¼Œè®°å½•çš„å†…å®¹ä¸å†æ˜¯ç®€å•çš„<code>SQL</code>è¯­å¥äº†ï¼Œè¿˜åŒ…å«æ“ä½œçš„å…·ä½“æ•°æ®ï¼Œè®°å½•å†…å®¹å¦‚ä¸‹ã€‚</p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230201163058562.png" alt="image-20230201163058562"></p><p><code>row</code>æ ¼å¼è®°å½•çš„å†…å®¹çœ‹ä¸åˆ°è¯¦ç»†ä¿¡æ¯ï¼Œè¦é€šè¿‡<code>mysqlbinlog</code>å·¥å…·è§£æå‡ºæ¥ã€‚</p><p><code>update_time=now()</code>å˜æˆäº†å…·ä½“çš„æ—¶é—´<code>update_time=1627112756247</code>ï¼Œæ¡ä»¶åé¢çš„@1ã€@2ã€@3 éƒ½æ˜¯è¯¥è¡Œæ•°æ®ç¬¬ 1 ä¸ª~3 ä¸ªå­—æ®µçš„åŸå§‹å€¼ï¼ˆ<strong>å‡è®¾è¿™å¼ è¡¨åªæœ‰ 3 ä¸ªå­—æ®µ</strong>ï¼‰ã€‚</p><p>è¿™æ ·å°±èƒ½ä¿è¯åŒæ­¥æ•°æ®çš„ä¸€è‡´æ€§ï¼Œé€šå¸¸æƒ…å†µä¸‹éƒ½æ˜¯æŒ‡å®šä¸º<code>row</code>ï¼Œè¿™æ ·å¯ä»¥ä¸ºæ•°æ®åº“çš„æ¢å¤ä¸åŒæ­¥å¸¦æ¥æ›´å¥½çš„å¯é æ€§ã€‚</p><p>ä½†æ˜¯è¿™ç§æ ¼å¼ï¼Œéœ€è¦æ›´å¤§çš„å®¹é‡æ¥è®°å½•ï¼Œæ¯”è¾ƒå ç”¨ç©ºé—´ï¼Œæ¢å¤ä¸åŒæ­¥æ—¶ä¼šæ›´æ¶ˆè€—<code>IO</code>èµ„æºï¼Œå½±å“æ‰§è¡Œé€Ÿåº¦ã€‚</p><p>æ‰€ä»¥å°±æœ‰äº†ä¸€ç§æŠ˜ä¸­çš„æ–¹æ¡ˆï¼ŒæŒ‡å®šä¸º<code>mixed</code>ï¼Œè®°å½•çš„å†…å®¹æ˜¯å‰ä¸¤è€…çš„æ··åˆã€‚</p><p><code>MySQL</code>ä¼šåˆ¤æ–­è¿™æ¡<code>SQL</code>è¯­å¥æ˜¯å¦å¯èƒ½å¼•èµ·æ•°æ®ä¸ä¸€è‡´ï¼Œå¦‚æœæ˜¯ï¼Œå°±ç”¨<code>row</code>æ ¼å¼ï¼Œå¦åˆ™å°±ç”¨<code>statement</code>æ ¼å¼ã€‚</p><p><strong>å†™å…¥æœºåˆ¶</strong></p><p><code>binlog</code>çš„å†™å…¥æ—¶æœºä¹Ÿéå¸¸ç®€å•ï¼Œäº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå…ˆæŠŠæ—¥å¿—å†™åˆ°<code>binlog cache</code>ï¼Œäº‹åŠ¡æäº¤çš„æ—¶å€™ï¼Œå†æŠŠ<code>binlog cache</code>å†™åˆ°<code>binlog</code>æ–‡ä»¶ä¸­ã€‚</p><p>å› ä¸ºä¸€ä¸ªäº‹åŠ¡çš„<code>binlog</code>ä¸èƒ½è¢«æ‹†å¼€ï¼Œæ— è®ºè¿™ä¸ªäº‹åŠ¡å¤šå¤§ï¼Œä¹Ÿè¦ç¡®ä¿ä¸€æ¬¡æ€§å†™å…¥ï¼Œæ‰€ä»¥ç³»ç»Ÿä¼šç»™æ¯ä¸ªçº¿ç¨‹åˆ†é…ä¸€ä¸ªå—å†…å­˜ä½œä¸º<code>binlog cache</code>ã€‚</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡<code>binlog_cache_size</code>å‚æ•°æ§åˆ¶å•ä¸ªçº¿ç¨‹ binlog cache å¤§å°ï¼Œå¦‚æœå­˜å‚¨å†…å®¹è¶…è¿‡äº†è¿™ä¸ªå‚æ•°ï¼Œå°±è¦æš‚å­˜åˆ°ç£ç›˜ï¼ˆ<code>Swap</code>ï¼‰ã€‚</p><p><code>binlog</code>æ—¥å¿—åˆ·ç›˜æµç¨‹å¦‚ä¸‹</p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230201163113791.png" alt="image-20230201163113791"></p><ul><li><strong>ä¸Šå›¾çš„ writeï¼Œæ˜¯æŒ‡æŠŠæ—¥å¿—å†™å…¥åˆ°æ–‡ä»¶ç³»ç»Ÿçš„ page cacheï¼Œå¹¶æ²¡æœ‰æŠŠæ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œæ‰€ä»¥é€Ÿåº¦æ¯”è¾ƒå¿«</strong></li><li><strong>ä¸Šå›¾çš„ fsyncï¼Œæ‰æ˜¯å°†æ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜çš„æ“ä½œ</strong></li></ul><p><code>write</code>å’Œ<code>fsync</code>çš„æ—¶æœºï¼Œå¯ä»¥ç”±å‚æ•°<code>sync_binlog</code>æ§åˆ¶ï¼Œé»˜è®¤æ˜¯<code>0</code>ã€‚</p><p>ä¸º<code>0</code>çš„æ—¶å€™ï¼Œè¡¨ç¤ºæ¯æ¬¡æäº¤äº‹åŠ¡éƒ½åª<code>write</code>ï¼Œç”±ç³»ç»Ÿè‡ªè¡Œåˆ¤æ–­ä»€ä¹ˆæ—¶å€™æ‰§è¡Œ<code>fsync</code>ã€‚</p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230201163126115.png" alt="image-20230201163126115"></p><p>è™½ç„¶æ€§èƒ½å¾—åˆ°æå‡ï¼Œä½†æ˜¯æœºå™¨å®•æœºï¼Œ<code>page cache</code>é‡Œé¢çš„ binlog ä¼šä¸¢å¤±ã€‚</p><p>ä¸ºäº†å®‰å…¨èµ·è§ï¼Œå¯ä»¥è®¾ç½®ä¸º<code>1</code>ï¼Œè¡¨ç¤ºæ¯æ¬¡æäº¤äº‹åŠ¡éƒ½ä¼šæ‰§è¡Œ<code>fsync</code>ï¼Œå°±å¦‚åŒ <strong>redo log æ—¥å¿—åˆ·ç›˜æµç¨‹</strong> ä¸€æ ·ã€‚</p><p>æœ€åè¿˜æœ‰ä¸€ç§æŠ˜ä¸­æ–¹å¼ï¼Œå¯ä»¥è®¾ç½®ä¸º<code>N(N&gt;1)</code>ï¼Œè¡¨ç¤ºæ¯æ¬¡æäº¤äº‹åŠ¡éƒ½<code>write</code>ï¼Œä½†ç´¯ç§¯<code>N</code>ä¸ªäº‹åŠ¡åæ‰<code>fsync</code>ã€‚</p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230201163136927.png" alt="image-20230201163136927"></p><p>åœ¨å‡ºç°<code>IO</code>ç“¶é¢ˆçš„åœºæ™¯é‡Œï¼Œå°†<code>sync_binlog</code>è®¾ç½®æˆä¸€ä¸ªæ¯”è¾ƒå¤§çš„å€¼ï¼Œå¯ä»¥æå‡æ€§èƒ½ã€‚</p><p>åŒæ ·çš„ï¼Œå¦‚æœæœºå™¨å®•æœºï¼Œä¼šä¸¢å¤±æœ€è¿‘<code>N</code>ä¸ªäº‹åŠ¡çš„<code>binlog</code>æ—¥å¿—ã€‚</p><h4 id="ä¸¤é˜¶æ®µæäº¤-1" tabindex="-1"><a class="header-anchor" href="#ä¸¤é˜¶æ®µæäº¤-1" aria-hidden="true">#</a> ä¸¤é˜¶æ®µæäº¤</h4><p><code>redo log</code>ï¼ˆé‡åšæ—¥å¿—ï¼‰è®©<code>InnoDB</code>å­˜å‚¨å¼•æ“æ‹¥æœ‰äº†å´©æºƒæ¢å¤èƒ½åŠ›ã€‚</p><p><code>binlog</code>ï¼ˆå½’æ¡£æ—¥å¿—ï¼‰ä¿è¯äº†<code>MySQL</code>é›†ç¾¤æ¶æ„çš„æ•°æ®ä¸€è‡´æ€§ã€‚</p><p>è™½ç„¶å®ƒä»¬éƒ½å±äºæŒä¹…åŒ–çš„ä¿è¯ï¼Œä½†æ˜¯ä¾§é‡ç‚¹ä¸åŒã€‚</p><p>åœ¨æ‰§è¡Œæ›´æ–°è¯­å¥è¿‡ç¨‹ï¼Œä¼šè®°å½•<code>redo log</code>ä¸<code>binlog</code>ä¸¤å—æ—¥å¿—ï¼Œä»¥åŸºæœ¬çš„äº‹åŠ¡ä¸ºå•ä½ï¼Œ<code>redo log</code>åœ¨äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­å¯ä»¥ä¸æ–­å†™å…¥ï¼Œè€Œ<code>binlog</code>åªæœ‰åœ¨æäº¤äº‹åŠ¡æ—¶æ‰å†™å…¥ï¼Œæ‰€ä»¥<code>redo log</code>ä¸<code>binlog</code>çš„å†™å…¥æ—¶æœºä¸ä¸€æ ·ã€‚</p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230201163148486.png" alt="image-20230201163148486"></p><p>å›åˆ°æ­£é¢˜ï¼Œ<code>redo log</code>ä¸<code>binlog</code>ä¸¤ä»½æ—¥å¿—ä¹‹é—´çš„é€»è¾‘ä¸ä¸€è‡´ï¼Œä¼šå‡ºç°ä»€ä¹ˆé—®é¢˜ï¼Ÿ</p><p>æˆ‘ä»¬ä»¥<code>update</code>è¯­å¥ä¸ºä¾‹ï¼Œå‡è®¾<code>id=2</code>çš„è®°å½•ï¼Œå­—æ®µ<code>c</code>å€¼æ˜¯<code>0</code>ï¼ŒæŠŠå­—æ®µ<code>c</code>å€¼æ›´æ–°æˆ<code>1</code>ï¼Œ<code>SQL</code>è¯­å¥ä¸º<code>update T set c=1 where id=2</code>ã€‚</p><p>å‡è®¾æ‰§è¡Œè¿‡ç¨‹ä¸­å†™å®Œ<code>redo log</code>æ—¥å¿—åï¼Œ<code>binlog</code>æ—¥å¿—å†™æœŸé—´å‘ç”Ÿäº†å¼‚å¸¸ï¼Œä¼šå‡ºç°ä»€ä¹ˆæƒ…å†µå‘¢ï¼Ÿ</p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230201163157321.png" alt="image-20230201163157321"></p><p>ç”±äº<code>binlog</code>æ²¡å†™å®Œå°±å¼‚å¸¸ï¼Œè¿™æ—¶å€™<code>binlog</code>é‡Œé¢æ²¡æœ‰å¯¹åº”çš„ä¿®æ”¹è®°å½•ã€‚å› æ­¤ï¼Œä¹‹åç”¨<code>binlog</code>æ—¥å¿—æ¢å¤æ•°æ®æ—¶ï¼Œå°±ä¼šå°‘è¿™ä¸€æ¬¡æ›´æ–°ï¼Œæ¢å¤å‡ºæ¥çš„è¿™ä¸€è¡Œ<code>c</code>å€¼æ˜¯<code>0</code>ï¼Œè€ŒåŸåº“å› ä¸º<code>redo log</code>æ—¥å¿—æ¢å¤ï¼Œè¿™ä¸€è¡Œ<code>c</code>å€¼æ˜¯<code>1</code>ï¼Œæœ€ç»ˆæ•°æ®ä¸ä¸€è‡´ã€‚</p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230201163209142.png" alt="image-20230201163209142"></p><p>ä¸ºäº†è§£å†³ä¸¤ä»½æ—¥å¿—ä¹‹é—´çš„é€»è¾‘ä¸€è‡´é—®é¢˜ï¼Œ<code>InnoDB</code>å­˜å‚¨å¼•æ“ä½¿ç”¨<strong>ä¸¤é˜¶æ®µæäº¤</strong>æ–¹æ¡ˆã€‚</p><p>åŸç†å¾ˆç®€å•ï¼Œå°†<code>redo log</code>çš„å†™å…¥æ‹†æˆäº†ä¸¤ä¸ªæ­¥éª¤<code>prepare</code>å’Œ<code>commit</code>ï¼Œè¿™å°±æ˜¯<strong>ä¸¤é˜¶æ®µæäº¤</strong>ã€‚</p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230201163220118.png" alt="image-20230201163220118"></p><p>ä½¿ç”¨<strong>ä¸¤é˜¶æ®µæäº¤</strong>åï¼Œå†™å…¥<code>binlog</code>æ—¶å‘ç”Ÿå¼‚å¸¸ä¹Ÿä¸ä¼šæœ‰å½±å“ï¼Œå› ä¸º<code>MySQL</code>æ ¹æ®<code>redo log</code>æ—¥å¿—æ¢å¤æ•°æ®æ—¶ï¼Œå‘ç°<code>redo log</code>è¿˜å¤„äº<code>prepare</code>é˜¶æ®µï¼Œå¹¶ä¸”æ²¡æœ‰å¯¹åº”<code>binlog</code>æ—¥å¿—ï¼Œå°±ä¼šå›æ»šè¯¥äº‹åŠ¡ã€‚</p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230201163233344.png" alt="image-20230201163233344"></p><p>å†çœ‹ä¸€ä¸ªåœºæ™¯ï¼Œ<code>redo log</code>è®¾ç½®<code>commit</code>é˜¶æ®µå‘ç”Ÿå¼‚å¸¸ï¼Œé‚£ä¼šä¸ä¼šå›æ»šäº‹åŠ¡å‘¢ï¼Ÿ</p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230201163243923.png" alt="image-20230201163243923"></p><p>å¹¶ä¸ä¼šå›æ»šäº‹åŠ¡ï¼Œå®ƒä¼šæ‰§è¡Œä¸Šå›¾æ¡†ä½çš„é€»è¾‘ï¼Œè™½ç„¶<code>redo log</code>æ˜¯å¤„äº<code>prepare</code>é˜¶æ®µï¼Œä½†æ˜¯èƒ½é€šè¿‡äº‹åŠ¡<code>id</code>æ‰¾åˆ°å¯¹åº”çš„<code>binlog</code>æ—¥å¿—ï¼Œæ‰€ä»¥<code>MySQL</code>è®¤ä¸ºæ˜¯å®Œæ•´çš„ï¼Œå°±ä¼šæäº¤äº‹åŠ¡æ¢å¤æ•°æ®ã€‚</p><p>undo log</p><blockquote><p>è¿™éƒ¨åˆ†å†…å®¹ä¸º JavaGuide çš„è¡¥å……ï¼š</p></blockquote><p>æˆ‘ä»¬çŸ¥é“å¦‚æœæƒ³è¦ä¿è¯äº‹åŠ¡çš„åŸå­æ€§ï¼Œå°±éœ€è¦åœ¨å¼‚å¸¸å‘ç”Ÿæ—¶ï¼Œå¯¹å·²ç»æ‰§è¡Œçš„æ“ä½œè¿›è¡Œ<strong>å›æ»š</strong>ï¼Œåœ¨ MySQL ä¸­ï¼Œæ¢å¤æœºåˆ¶æ˜¯é€šè¿‡ <strong>å›æ»šæ—¥å¿—ï¼ˆundo logï¼‰</strong> å®ç°çš„ï¼Œæ‰€æœ‰äº‹åŠ¡è¿›è¡Œçš„ä¿®æ”¹éƒ½ä¼šå…ˆè®°å½•åˆ°è¿™ä¸ªå›æ»šæ—¥å¿—ä¸­ï¼Œç„¶åå†æ‰§è¡Œç›¸å…³çš„æ“ä½œã€‚å¦‚æœæ‰§è¡Œè¿‡ç¨‹ä¸­é‡åˆ°å¼‚å¸¸çš„è¯ï¼Œæˆ‘ä»¬ç›´æ¥åˆ©ç”¨ <strong>å›æ»šæ—¥å¿—</strong> ä¸­çš„ä¿¡æ¯å°†æ•°æ®å›æ»šåˆ°ä¿®æ”¹ä¹‹å‰çš„æ ·å­å³å¯ï¼å¹¶ä¸”ï¼Œå›æ»šæ—¥å¿—ä¼šå…ˆäºæ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜ä¸Šã€‚è¿™æ ·å°±ä¿è¯äº†å³ä½¿é‡åˆ°æ•°æ®åº“çªç„¶å®•æœºç­‰æƒ…å†µï¼Œå½“ç”¨æˆ·å†æ¬¡å¯åŠ¨æ•°æ®åº“çš„æ—¶å€™ï¼Œæ•°æ®åº“è¿˜èƒ½å¤Ÿé€šè¿‡æŸ¥è¯¢å›æ»šæ—¥å¿—æ¥å›æ»šå°†ä¹‹å‰æœªå®Œæˆçš„äº‹åŠ¡ã€‚</p><p>å¦å¤–ï¼Œ<code>MVCC</code> çš„å®ç°ä¾èµ–äºï¼š<strong>éšè—å­—æ®µã€Read Viewã€undo log</strong>ã€‚åœ¨å†…éƒ¨å®ç°ä¸­ï¼Œ<code>InnoDB</code> é€šè¿‡æ•°æ®è¡Œçš„ <code>DB_TRX_ID</code> å’Œ <code>Read View</code> æ¥åˆ¤æ–­æ•°æ®çš„å¯è§æ€§ï¼Œå¦‚ä¸å¯è§ï¼Œåˆ™é€šè¿‡æ•°æ®è¡Œçš„ <code>DB_ROLL_PTR</code> æ‰¾åˆ° <code>undo log</code> ä¸­çš„å†å²ç‰ˆæœ¬ã€‚æ¯ä¸ªäº‹åŠ¡è¯»åˆ°çš„æ•°æ®ç‰ˆæœ¬å¯èƒ½æ˜¯ä¸ä¸€æ ·çš„ï¼Œåœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œç”¨æˆ·åªèƒ½çœ‹åˆ°è¯¥äº‹åŠ¡åˆ›å»º <code>Read View</code> ä¹‹å‰å·²ç»æäº¤çš„ä¿®æ”¹å’Œè¯¥äº‹åŠ¡æœ¬èº«åšçš„ä¿®æ”¹</p><h3 id="mysqlä¸­çš„sqlè¯­å¥çš„æ‰§è¡Œæµç¨‹" tabindex="-1"><a class="header-anchor" href="#mysqlä¸­çš„sqlè¯­å¥çš„æ‰§è¡Œæµç¨‹" aria-hidden="true">#</a> Mysqlä¸­çš„SQLè¯­å¥çš„æ‰§è¡Œæµç¨‹</h3><p>MySQL ä¸»è¦åˆ†ä¸º<strong>è¿æ¥å±‚</strong> <strong>Server å±‚</strong>å’Œ<strong>å¼•æ“å±‚</strong>ï¼ŒServer å±‚ä¸»è¦åŒ…æ‹¬<strong>è¿æ¥å™¨</strong>ã€<strong>æŸ¥è¯¢ç¼“å­˜</strong>ã€<strong>åˆ†æå™¨</strong>ã€<strong>ä¼˜åŒ–å™¨</strong>ã€<strong>æ‰§è¡Œå™¨</strong>ï¼Œ</p><p>åŒæ—¶è¿˜æ¶‰åŠåˆ°<strong>æ—¥å¿—æ¨¡å—ï¼ˆundolog/ redolog/ binlogï¼‰</strong>ï¼Œ<strong>redolog(å­˜å‚¨å¼•æ“å±‚é¢çš„log) åªæœ‰ InnoDB æœ‰</strong>ã€‚</p><p>å¼•æ“å±‚æ˜¯æ’ä»¶å¼çš„ï¼Œç›®å‰ä¸»è¦åŒ…æ‹¬ï¼ŒMyISAM,<strong>InnoDB</strong>,Memory ç­‰ã€‚</p><ul><li><strong>æŸ¥è¯¢è¯­å¥</strong>çš„æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼šæƒé™æ ¡éªŒ---&gt;ï¼ˆå¦‚æœå‘½ä¸­ç¼“å­˜ï¼‰æŸ¥è¯¢ç¼“å­˜---&gt;åˆ†æå™¨---&gt;ä¼˜åŒ–å™¨---&gt;æƒé™æ ¡éªŒ---&gt;æ‰§è¡Œå™¨---&gt;å¼•æ“</li><li><strong>æ›´æ–°è¯­å¥</strong>æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼šåˆ†æå™¨----&gt;æƒé™æ ¡éªŒ----&gt;æ‰§è¡Œå™¨---&gt;å¼•æ“---redo log(prepare çŠ¶æ€)---&gt;binlog---&gt;redo log(commitçŠ¶æ€)</li></ul><h4 id="æŸ¥è¯¢è¯­å¥" tabindex="-1"><a class="header-anchor" href="#æŸ¥è¯¢è¯­å¥" aria-hidden="true">#</a> æŸ¥è¯¢è¯­å¥</h4><ul><li>å…ˆ<strong>æ£€æŸ¥è¯¥è¯­å¥æ˜¯å¦æœ‰æƒé™</strong>ï¼Œå¦‚æœæ²¡æœ‰æƒé™ï¼Œç›´æ¥è¿”å›é”™è¯¯ä¿¡æ¯ï¼Œå¦‚æœæœ‰æƒé™ï¼Œ<strong>åœ¨ MySQL8.0 ç‰ˆæœ¬ä»¥å‰ï¼Œä¼šå…ˆæŸ¥è¯¢ç¼“å­˜</strong>ï¼Œä»¥è¿™æ¡ SQL è¯­å¥ä¸º key åœ¨å†…å­˜ä¸­æŸ¥è¯¢æ˜¯å¦æœ‰ç»“æœï¼Œå¦‚æœæœ‰ç›´æ¥ç¼“å­˜ç›´æ¥è¿”å›ç¼“å­˜çš„ç»“æœï¼Œå¦‚æœæ²¡æœ‰ï¼Œæ‰§è¡Œä¸‹ä¸€æ­¥ã€‚</li><li>é€šè¿‡<strong>åˆ†æå™¨</strong>ï¼Œåˆ†æå‡ºä¸€ä¸ª<strong>è¯­æ³•æ ‘</strong>ï¼Œæå– SQL è¯­å¥çš„å…³é”®å…ƒç´ ï¼Œæ¯”å¦‚æå–ä¸Šé¢è¿™ä¸ªè¯­å¥æ˜¯æŸ¥è¯¢ selectï¼Œæå–éœ€è¦æŸ¥è¯¢çš„è¡¨åä¸º tb_studentï¼Œéœ€è¦æŸ¥è¯¢æ‰€æœ‰çš„åˆ—ï¼ŒæŸ¥è¯¢æ¡ä»¶æ˜¯è¿™ä¸ªè¡¨çš„ id=&#39;1&#39;ã€‚ç„¶ååˆ¤æ–­è¿™ä¸ª SQL è¯­å¥æ˜¯å¦æœ‰<strong>è¯­æ³•&amp;è¯æ³•</strong>é”™è¯¯ï¼Œæ¯”å¦‚<strong>å…³é”®è¯</strong>æ˜¯å¦æ­£ç¡®ç­‰ç­‰ï¼Œå¦‚æœæ£€æŸ¥æ²¡é—®é¢˜å°±æ‰§è¡Œä¸‹ä¸€æ­¥ã€‚</li><li>æ¥ä¸‹æ¥å°±æ˜¯<strong>ä¼˜åŒ–å™¨</strong>è¿›è¡Œç¡®å®šæ‰§è¡Œæ–¹æ¡ˆï¼Œä¸Šé¢çš„ SQL è¯­å¥ï¼Œå¯ä»¥æœ‰ä¸¤ç§æ‰§è¡Œæ–¹æ¡ˆï¼š</li></ul><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>  a.å…ˆæŸ¥è¯¢å­¦ç”Ÿè¡¨ä¸­å§“åä¸ºâ€œå¼ ä¸‰â€çš„å­¦ç”Ÿï¼Œç„¶ååˆ¤æ–­æ˜¯å¦å¹´é¾„æ˜¯ 18ã€‚
  b.å…ˆæ‰¾å‡ºå­¦ç”Ÿä¸­å¹´é¾„ 18 å²çš„å­¦ç”Ÿï¼Œç„¶åå†æŸ¥è¯¢å§“åä¸ºâ€œå¼ ä¸‰â€çš„å­¦ç”Ÿã€‚
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>â€‹ é‚£ä¹ˆä¼˜åŒ–å™¨æ ¹æ®è‡ªå·±çš„ä¼˜åŒ–ç®—æ³•è¿›è¡Œé€‰æ‹©æ‰§è¡Œæ•ˆç‡æœ€å¥½çš„ä¸€ä¸ªæ–¹æ¡ˆï¼ˆä¼˜åŒ–å™¨è®¤ä¸ºï¼Œæœ‰æ—¶å€™ä¸ä¸€å®šæœ€å¥½ï¼‰ã€‚é‚£ä¹ˆç¡®è®¤äº†æ‰§è¡Œè®¡åˆ’åå°±å‡†å¤‡å¼€å§‹æ‰§è¡Œäº†ã€‚</p><ul><li>è¿›è¡Œ<strong>æƒé™æ ¡éªŒ</strong>ï¼Œå¦‚æœæ²¡æœ‰æƒé™å°±ä¼šè¿”å›é”™è¯¯ä¿¡æ¯ï¼Œå¦‚æœ<strong>æœ‰æƒé™å°±ä¼šè°ƒç”¨æ•°æ®åº“å¼•æ“æ¥å£ï¼Œè¿”å›å¼•æ“çš„æ‰§è¡Œç»“æœ</strong>ï¼ˆæœ‰ç¼“å­˜çš„è¯è¦å°†æŸ¥è¯¢ç»“æœå­˜æ”¾è‡³ç¼“å­˜ä¸­ï¼‰</li></ul><h4 id="æ›´æ–°è¯­å¥" tabindex="-1"><a class="header-anchor" href="#æ›´æ–°è¯­å¥" aria-hidden="true">#</a> æ›´æ–°è¯­å¥</h4><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>update tb_student A set A.age=&#39;19&#39; where A.name=&#39; å¼ ä¸‰ &#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æˆ‘ä»¬æ¥ç»™å¼ ä¸‰ä¿®æ”¹ä¸‹å¹´é¾„ï¼Œåœ¨å®é™…æ•°æ®åº“è‚¯å®šä¸ä¼šè®¾ç½®å¹´é¾„è¿™ä¸ªå­—æ®µçš„ï¼Œä¸ç„¶è¦è¢«æŠ€æœ¯è´Ÿè´£äººæ‰“çš„ã€‚å…¶å®è¿™æ¡è¯­å¥ä¹ŸåŸºæœ¬ä¸Šä¼šæ²¿ç€ä¸Šä¸€ä¸ªæŸ¥è¯¢çš„æµç¨‹èµ°ï¼Œåªä¸è¿‡æ‰§è¡Œæ›´æ–°çš„æ—¶å€™è‚¯å®šè¦è®°å½•æ—¥å¿—å•¦ï¼Œè¿™å°±ä¼šå¼•å…¥æ—¥å¿—æ¨¡å—äº†ï¼ŒMySQL è‡ªå¸¦çš„æ—¥å¿—æ¨¡å—æ˜¯ <strong>binlogï¼ˆå½’æ¡£æ—¥å¿—ï¼‰</strong> ï¼Œæ‰€æœ‰çš„å­˜å‚¨å¼•æ“éƒ½å¯ä»¥ä½¿ç”¨ï¼Œ</p><p>**undolog ï¼ˆå›æ»šæ—¥å¿—ï¼‰**æ—¥å¿—æ–‡ä»¶ï¼š<strong>è®°å½•æ•°æ®è¢«ä¿®æ”¹å‰çš„æ ·å­</strong>ï¼›æˆ‘ä»¬å¸¸ç”¨çš„ InnoDB å¼•æ“è¿˜è‡ªå¸¦äº†ä¸€ä¸ªæ—¥å¿—æ¨¡å— <strong>redo logï¼ˆé‡åšæ—¥å¿—ï¼‰</strong>ï¼Œæˆ‘ä»¬å°±ä»¥ InnoDB æ¨¡å¼ä¸‹æ¥æ¢è®¨è¿™ä¸ªè¯­å¥çš„æ‰§è¡Œæµç¨‹ã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">1</span>. å†™undolog 
<span class="token number">2</span>. å†™redologï¼ˆprepareï¼‰
<span class="token number">3</span>. å†™binlog 
<span class="token number">4</span>. å†™redologï¼ˆcommitï¼‰
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230201160837989.png" alt="image-20230201160837989"></p><p><strong>æµç¨‹å¦‚ä¸‹</strong>ï¼š</p><ul><li>â‘ å…ˆæŸ¥è¯¢åˆ°å¼ ä¸‰è¿™ä¸€æ¡æ•°æ®ï¼Œå¦‚æœæœ‰ç¼“å­˜ï¼Œä¹Ÿæ˜¯ä¼šç”¨åˆ°ç¼“å­˜ã€‚</li><li>â‘¡æ‹¿åˆ°æŸ¥è¯¢åˆ°çš„åŸå§‹æ•°æ®ï¼›å°†è¿™æ¡æ•°æ®çš„<strong>åŸå§‹è®°å½•ä¿å­˜åˆ° undo æ—¥å¿—æ–‡ä»¶ä¸­</strong></li><li>â‘¢ç„¶åæ‹¿åˆ°æŸ¥è¯¢çš„è¯­å¥ï¼ŒæŠŠ age æ”¹ä¸º 19ï¼Œç„¶åè°ƒç”¨å¼•æ“ API æ¥å£ï¼Œå†™å…¥è¿™ä¸€è¡Œæ•°æ®ï¼ŒInnoDB å¼•æ“<strong>æŠŠæ•°æ®ä¿å­˜åœ¨å†…å­˜ä¸­ï¼ˆBuffer Poolï¼‰</strong>ï¼Œ</li><li>â‘£<strong>åŒæ—¶è®°å½• redo log</strong>ï¼Œæ­¤æ—¶ <strong>redo log è¿›å…¥ prepare çŠ¶æ€(åŒé˜¶æ®µæäº¤)</strong>ï¼Œç„¶åå‘Šè¯‰æ‰§è¡Œå™¨ï¼Œæ‰§è¡Œå®Œæˆäº†ï¼Œéšæ—¶å¯ä»¥æäº¤ã€‚<strong>[fsync]</strong></li><li>â‘¤æ‰§è¡Œå™¨æ”¶åˆ°é€šçŸ¥å<strong>è®°å½• binlog</strong>ï¼Œç„¶åè°ƒç”¨å¼•æ“æ¥å£ï¼Œ<strong>[fsync]</strong></li><li>â‘¥<strong>æäº¤ redo log ä¸ºcommitçŠ¶æ€(åŒé˜¶æ®µæäº¤)</strong>ã€‚</li><li>â‘¦æ›´æ–°å®Œæˆã€‚</li></ul><blockquote><p>åœ¨æ‰§è¡Œ UPDATE è¯­å¥æ—¶ï¼Œ InnoDB å¯¹<strong>æ›´æ–°ä¸»é”®</strong>å’Œ<strong>ä¸æ›´æ–°ä¸»é”®</strong>è¿™ä¸¤ç§æƒ…å†µæœ‰æˆªç„¶ä¸åŒçš„å¤„ç†æ–¹æ¡ˆ</p><p><strong>ä¸æ›´æ–°ä¸»é”®çš„æƒ…å†µ</strong>ï¼š</p><ul><li><p><strong>å°±åœ°æ›´æ–°ï¼ˆin-place updateï¼‰</strong> å¯¹äºè¢«æ›´æ–°çš„æ¯ä¸ªåˆ—æ¥è¯´ï¼Œå¦‚æœæ›´æ–°åçš„åˆ—å’Œæ›´æ–°å‰çš„åˆ—å ç”¨çš„å­˜å‚¨ç©ºé—´éƒ½ä¸€æ ·å¤§ï¼Œè¿›è¡Œ å°±åœ°æ›´æ–° ï¼ˆ<strong>æ¯ä¸ªåˆ—åœ¨æ›´æ–°å‰åå ç”¨çš„å­˜å‚¨ç©ºé—´ä¸€æ ·å¤§</strong>ï¼‰</p></li><li><p><strong>å…ˆåˆ é™¤æ‰æ—§è®°å½•ï¼Œå†æ’å…¥æ–°è®°å½•</strong></p><p>æœ‰ä»»ä½•ä¸€ä¸ªè¢«æ›´æ–°çš„åˆ—<strong>æ›´æ–°å‰å’Œæ›´æ–°åå ç”¨çš„å­˜å‚¨ç©ºé—´å¤§å°ä¸ä¸€è‡´</strong>ï¼Œé‚£ä¹ˆå°±éœ€è¦å…ˆæŠŠè¿™æ¡æ—§çš„è®°å½•ä»èšç°‡ç´¢å¼•é¡µé¢ä¸­åˆ é™¤æ‰ï¼Œç„¶åå†æ ¹æ®æ›´æ–°ååˆ—çš„å€¼åˆ›å»ºä¸€æ¡æ–°çš„è®°å½•æ’å…¥åˆ°é¡µé¢ä¸­ï¼ˆè¿™é‡Œæ‰€è¯´çš„ åˆ é™¤ å¹¶ä¸æ˜¯ delete mark æ“ä½œï¼Œè€Œæ˜¯çœŸæ­£çš„åˆ é™¤æ‰ï¼‰</p></li></ul><p><strong>æ›´æ–°ä¸»é”®çš„æƒ…å†µ</strong>ï¼š</p><ul><li><p><strong>å…ˆå°†æ—§è®°å½•è¿›è¡Œ delete mark æ“ä½œ</strong>ï¼ˆäº‹åŠ¡æäº¤åæ‰ç”±ä¸“é—¨çš„çº¿ç¨‹åšpurgeæ“ä½œï¼ŒæŠŠå®ƒåŠ å…¥åˆ°åƒåœ¾é“¾è¡¨ä¸­ï¼‰ <strong>å†æ ¹æ®æ›´æ–°åå„åˆ—çš„å€¼åˆ›å»ºä¸€æ¡æ–°è®°å½•ï¼Œå¹¶å°†å…¶æ’å…¥åˆ°èšç°‡ç´¢å¼•ä¸­</strong>ï¼ˆéœ€é‡æ–°å®šä½æ’å…¥çš„ä½ç½®ï¼‰ã€‚</p><p>ä¹‹æ‰€ä»¥åªå¯¹æ—§è®°å½•åšdelete markæ“ä½œï¼Œæ˜¯å› ä¸ºåˆ«çš„äº‹åŠ¡åŒæ—¶ä¹Ÿå¯èƒ½è®¿é—®è¿™æ¡è®°å½•ï¼Œå¦‚æœæŠŠå®ƒçœŸæ­£çš„åˆ é™¤åŠ å…¥åˆ°åƒåœ¾é“¾è¡¨åï¼Œåˆ«çš„äº‹åŠ¡å°±è®¿é—®ä¸åˆ°äº†ã€‚è¿™ä¸ªåŠŸèƒ½å°±æ˜¯æ‰€è°“çš„MVCC</p></li></ul></blockquote><p><strong>ä¸ºä»€ä¹ˆè¦ç”¨ä¸¤ä¸ªæ—¥å¿—æ¨¡å—ï¼Œç”¨ä¸€ä¸ªæ—¥å¿—æ¨¡å—ä¸è¡Œå—?</strong></p><p>è¿™æ˜¯å› ä¸ºæœ€å¼€å§‹ MySQL å¹¶æ²¡æœ‰ InnoDB å¼•æ“ï¼ˆInnoDB å¼•æ“æ˜¯å…¶ä»–å…¬å¸ä»¥æ’ä»¶å½¢å¼æ’å…¥ MySQL çš„ï¼‰ï¼ŒMySQL è‡ªå¸¦çš„å¼•æ“æ˜¯ MyISAMï¼Œä½†æ˜¯æˆ‘ä»¬çŸ¥é“ redo log æ˜¯ InnoDB å¼•æ“ç‰¹æœ‰çš„ï¼Œå…¶ä»–å­˜å‚¨å¼•æ“éƒ½æ²¡æœ‰ï¼Œè¿™å°±å¯¼è‡´ä¼šæ²¡æœ‰ crash-safe çš„èƒ½åŠ›(crash-safe çš„èƒ½åŠ›å³ä½¿æ•°æ®åº“å‘ç”Ÿå¼‚å¸¸é‡å¯ï¼Œä¹‹å‰æäº¤çš„è®°å½•éƒ½ä¸ä¼šä¸¢å¤±)ï¼Œbinlog æ—¥å¿—åªèƒ½ç”¨æ¥å½’æ¡£ã€‚</p><p>å¹¶ä¸æ˜¯è¯´åªç”¨ä¸€ä¸ªæ—¥å¿—æ¨¡å—ä¸å¯ä»¥ï¼Œåªæ˜¯ InnoDB å¼•æ“å°±æ˜¯é€šè¿‡ redo log æ¥æ”¯æŒäº‹åŠ¡çš„ã€‚é‚£ä¹ˆï¼Œåˆä¼šæœ‰åŒå­¦é—®ï¼Œæˆ‘ç”¨ä¸¤ä¸ªæ—¥å¿—æ¨¡å—ï¼Œä½†æ˜¯ä¸è¦è¿™ä¹ˆå¤æ‚è¡Œä¸è¡Œï¼Œä¸ºä»€ä¹ˆ redo log è¦å¼•å…¥ prepare é¢„æäº¤çŠ¶æ€ï¼Ÿè¿™é‡Œæˆ‘ä»¬ç”¨åè¯æ³•æ¥è¯´æ˜ä¸‹ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšï¼Ÿ</p><ul><li><strong>å…ˆå†™ redo log ç›´æ¥æäº¤ï¼Œç„¶åå†™ binlog</strong>ï¼Œå‡è®¾å†™å®Œ redo log åï¼Œæœºå™¨æŒ‚äº†ï¼Œbinlog æ—¥å¿—æ²¡æœ‰è¢«å†™å…¥ï¼Œé‚£ä¹ˆæœºå™¨é‡å¯åï¼Œè¿™å°æœºå™¨ä¼šé€šè¿‡ redo log æ¢å¤æ•°æ®ï¼Œä½†æ˜¯è¿™ä¸ªæ—¶å€™ binlog å¹¶æ²¡æœ‰è®°å½•è¯¥æ•°æ®ï¼Œåç»­è¿›è¡Œæœºå™¨å¤‡ä»½çš„æ—¶å€™ï¼Œå°±ä¼šä¸¢å¤±è¿™ä¸€æ¡æ•°æ®ï¼ŒåŒæ—¶ä¸»ä»åŒæ­¥ä¹Ÿä¼šä¸¢å¤±è¿™ä¸€æ¡æ•°æ®ã€‚</li><li><strong>å…ˆå†™ binlogï¼Œç„¶åå†™ redo log</strong>ï¼Œå‡è®¾å†™å®Œäº† binlogï¼Œæœºå™¨å¼‚å¸¸é‡å¯äº†ï¼Œç”±äºæ²¡æœ‰ redo logï¼Œæœ¬æœºæ˜¯æ— æ³•æ¢å¤è¿™ä¸€æ¡è®°å½•çš„ï¼Œä½†æ˜¯ binlog åˆæœ‰è®°å½•ï¼Œé‚£ä¹ˆå’Œä¸Šé¢åŒæ ·çš„é“ç†ï¼Œå°±ä¼šäº§ç”Ÿæ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µã€‚</li></ul><p>å¦‚æœé‡‡ç”¨ redo log ä¸¤é˜¶æ®µæäº¤çš„æ–¹å¼å°±ä¸ä¸€æ ·äº†ï¼Œå†™å®Œ binlog åï¼Œç„¶åå†æäº¤ redo log å°±ä¼šé˜²æ­¢å‡ºç°ä¸Šè¿°çš„é—®é¢˜ï¼Œä»è€Œä¿è¯äº†æ•°æ®çš„ä¸€è‡´æ€§ã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œæœ‰æ²¡æœ‰ä¸€ä¸ªæç«¯çš„æƒ…å†µå‘¢ï¼Ÿå‡è®¾ redo log å¤„äºé¢„æäº¤çŠ¶æ€ï¼Œbinlog ä¹Ÿå·²ç»å†™å®Œäº†ï¼Œè¿™ä¸ªæ—¶å€™å‘ç”Ÿäº†å¼‚å¸¸é‡å¯ä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿ è¿™ä¸ªå°±è¦ä¾èµ–äº MySQL çš„å¤„ç†æœºåˆ¶äº†ï¼ŒMySQL çš„å¤„ç†è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ul><li>åˆ¤æ–­ redo logï¼ˆcommit çŠ¶æ€ï¼‰ æ˜¯å¦å®Œæ•´ï¼Œå¦‚æœåˆ¤æ–­æ˜¯å®Œæ•´çš„ï¼Œå°±ç«‹å³æäº¤ã€‚</li><li>å¦‚æœ redo log åªæ˜¯é¢„æäº¤ä½†ä¸æ˜¯ commit çŠ¶æ€ï¼Œè¿™ä¸ªæ—¶å€™å°±ä¼šå»åˆ¤æ–­ binlog æ˜¯å¦å®Œæ•´ï¼Œå¦‚æœå®Œæ•´å°±æäº¤ redo log, ä¸å®Œæ•´å°±å›æ»šäº‹åŠ¡ã€‚</li></ul><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221105144640601.png" alt="image-20221105144640601"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221021194721702.png" alt="image-20221021194721702"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221021192418947.png" alt="image-20221021192418947"></p><p><strong>æŸ¥è¯¢ç¼“å­˜</strong>åœ¨<strong>8.0ä¹‹åè¢«åºŸå¼ƒ</strong>äº†</p><p>åŸå› æ˜¯<strong>æŸ¥è¯¢ç¼“å­˜å®é™…ä¸Šååˆ†é¸¡è‚‹</strong> ï¼ˆå‘½ä¸­ç‡å¤ªä½ï¼‰è¦æ±‚æŸ¥è¯¢çš„keyè¦å®Œå…¨ä¸€æ ·æ‰èƒ½æˆåŠŸåŒ¹é…åˆ°ç¼“å­˜çš„value</p><p>æ€»ä¹‹æŸ¥è¯¢ç¼“å­˜å¼Šå¤§äºåˆ© æŸ¥è¯¢ç¼“å­˜å¤±æ•ˆååˆ†é¢‘ç¹</p><p>å¯ä»¥æ‰‹åŠ¨è¿›è¡Œé…ç½®æ˜¯å¦å¼€å¯ query-catch-type=0è¡¨ç¤ºoff=1è¡¨ç¤ºon</p><p>query-catch-type=2è¡¨ç¤ºè®¾ç½®ä¸ºæŒ‰éœ€ä½¿ç”¨</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>select SQL_CACHE * from user;
#SQL-CACHEè¡¨ç¤ºè¦è¿‡ä¸€éæŸ¥è¯¢ç¼“å­˜
select SQL_NO_CACHE * from user;
#SQL_NO_CACHEè¡¨ç¤ºä¸è¦è¿‡æŸ¥è¯¢ç¼“å­˜
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å»ºè®®å¤§å®¶ä½¿ç”¨<strong>é™æ€è¡¨</strong>ä½¿ç”¨æŸ¥è¯¢ç¼“å­˜</p><p><strong>é™æ€è¡¨å³ä¸º æå°‘æ›´æ–°çš„è¡¨</strong></p><p>æ¯”å¦‚ç³»ç»Ÿé…ç½® å­—å…¸è¡¨</p><h3 id="mysql-sqlè¯­å¥ä¹¦å†™é¡ºåºå’Œæ‰§è¡Œé¡ºåº" tabindex="-1"><a class="header-anchor" href="#mysql-sqlè¯­å¥ä¹¦å†™é¡ºåºå’Œæ‰§è¡Œé¡ºåº" aria-hidden="true">#</a> MySQL SQLè¯­å¥ä¹¦å†™é¡ºåºå’Œæ‰§è¡Œé¡ºåº</h3><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span> <span class="token keyword">SELECT</span>
<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token keyword">DISTINCT</span> <span class="token operator">&lt;</span>select_list<span class="token operator">&gt;</span>
<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span>  <span class="token operator">&lt;</span>main_table<span class="token operator">&gt;</span>
<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span>join_type<span class="token operator">&gt;</span> <span class="token keyword">JOIN</span> <span class="token operator">&lt;</span>join_table<span class="token operator">&gt;</span>
<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">ON</span> <span class="token operator">&lt;</span>join_condition<span class="token operator">&gt;</span>
<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token keyword">WHERE</span> <span class="token operator">&lt;</span>where_condition<span class="token operator">&gt;</span>
<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token operator">&lt;</span>group_by_list<span class="token operator">&gt;</span>
<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span> <span class="token keyword">HAVING</span> <span class="token operator">&lt;</span>having_condition<span class="token operator">&gt;</span>
<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token operator">&lt;</span>order_by_condition<span class="token operator">&gt;</span>
<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">LIMIT</span> <span class="token operator">&lt;</span>limit_number<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p><strong>ä¹¦å†™é¡ºåº</strong>: <strong>SELECT â†’FROM â†’ JOIN â†’ ON â†’ WHERE â†’ GROUP BY â†’ HAVING â†’ ORDER BYâ†’ LIMIT</strong></p><p><strong>æ‰§è¡Œé¡ºåº</strong>ï¼š <strong>FROM â†’ ON â†’ JOIN â†’ WHERE â†’ GROUP BY â†’ HAVING â†’ SELECT â†’DISTINCT â†’ ORDER BYâ†’ LIMIT</strong></p><ol><li>åŠ è½½ fromå…³é”®è¯åé¢è·Ÿçš„è¡¨ï¼Œè®¡ç®—ç¬›å¡å°”ç§¯ï¼Œç”Ÿæˆè™šæ‹Ÿè¡¨vt1ã€‚è¿™ä¹Ÿæ˜¯sqlæ‰§è¡Œçš„ç¬¬ä¸€æ­¥ï¼šè¡¨ç¤ºè¦ä»æ•°æ®åº“ä¸­æ‰§è¡Œå“ªäº›è¡¨ã€‚</li><li>ç­›é€‰å…³è”è¡¨ä¸­æ»¡è¶³onè¡¨è¾¾å¼çš„æ•°æ®ï¼Œä¿ç•™ä¸»è¡¨æ•°æ®ï¼Œå¹¶ç”Ÿæˆè™šæ‹Ÿè¡¨vt2ã€‚joinè¡¨ç¤ºè¦å…³è”çš„è¡¨ï¼Œonä»£è¡¨è¿æ¥æ¡ä»¶ã€‚</li><li>å¦‚æœä½¿ç”¨çš„æ˜¯å¤–è¿æ¥ï¼Œæ‰§è¡Œonçš„æ—¶å€™ï¼Œä¼šå°†ä¸»è¡¨ä¸­ä¸ç¬¦åˆonæ¡ä»¶çš„æ•°æ®ä¹ŸåŠ è½½è¿›æ¥ï¼Œä½œä¸ºå¤–éƒ¨è¡Œã€‚</li><li>å¦‚æœfromå­å¥ä¸­æ¶‰åŠå¤šå¼ è¡¨ï¼Œåˆ™é‡å¤ç¬¬ä¸€æ­¥åˆ°ç¬¬ä¸‰æ­¥ï¼Œç›´è‡³æ‰€æœ‰çš„è¡¨éƒ½åŠ è½½å®Œæ¯•ï¼Œæ›´æ–°vt3ã€‚</li><li>æ‰§è¡Œwhereè¡¨è¾¾å¼ï¼Œç­›é€‰å‡ºç¬¦åˆæ¡ä»¶çš„æ•°æ®ç”Ÿæˆvt4ã€‚</li><li>æ‰§è¡Œ group by å­å¥è¿›è¡Œåˆ†ç»„ã€‚åˆ†ç»„ä¼šæŠŠå­å¥ç»„åˆæˆå”¯ä¸€å€¼å¹¶ä¸”æ¯ä¸ªå”¯ä¸€å€¼åªåŒ…å«ä¸€è¡Œï¼Œç”Ÿæˆvt5ã€‚ä¸€æ—¦æ‰§è¡Œgroup byï¼Œåé¢çš„æ‰€æœ‰æ­¥éª¤åªèƒ½æ“ä½œvt5ä¸­çš„åˆ—ï¼ˆgroup byçš„å­å¥åŒ…å«çš„åˆ—ï¼‰å’Œèšåˆå‡½æ•°ã€‚ æ¸©é¦¨æç¤ºï¼šè¿™ä¸€æ­¥å¼€å§‹æ‰å¯ä»¥ä½¿ç”¨selectä¸­çš„åˆ«åï¼Œå®ƒè¿”å›çš„æ˜¯ä¸€ä¸ªæ¸¸æ ‡ï¼Œè€Œä¸æ˜¯ä¸€å¼ è¡¨ï¼Œæ‰€ä»¥åœ¨whereä¸­ä¸å¯ä»¥ä½¿ç”¨selectä¸­çš„åˆ«åï¼Œè€Œhavingå´å¯ä»¥ã€‚</li><li>æ‰§è¡Œèšåˆå‡½æ•°ï¼Œä¾‹å¦‚sumã€avgç­‰ï¼Œç”Ÿæˆvt6ã€‚</li><li>æ‰§è¡Œhavingè¡¨è¾¾å¼ï¼Œç­›é€‰vt6ä¸­çš„æ•°æ®ã€‚havingæ˜¯å”¯ä¸€ä¸€ä¸ªå¯ä»¥åœ¨åˆ†ç»„åæ‰§è¡Œçš„æ¡ä»¶ç­›é€‰è¡¨è¾¾å¼ï¼Œç”Ÿæˆvt7ã€‚</li><li>æ‰§è¡ŒSELECTï¼Œä»vt7ä¸­ç­›é€‰åˆ—ï¼Œç”Ÿæˆvt8ã€‚</li><li>æ‰§è¡Œdistinctï¼Œå¯¹vt8å»é‡ï¼Œç”Ÿæˆvt9ã€‚ å…¶å®æ‰§è¡Œè¿‡group byåå°±æ²¡å¿…è¦å†å»æ‰§è¡Œdistinctï¼Œå› ä¸ºåˆ†ç»„åï¼Œæ¯ç»„åªä¼šæœ‰ä¸€æ¡æ•°æ®ï¼Œå¹¶ä¸”æ¯æ¡æ•°æ®éƒ½ä¸ç›¸åŒã€‚</li><li>æŒ‰ç…§order_by_condition å¯¹vt9è¿›è¡Œæ’åºï¼Œæ­¤å¤„äº¦å¯ä»¥ä½¿ç”¨åˆ«åã€‚è¿™ä¸ªè¿‡ç¨‹æ¯”è¾ƒè€—è´¹èµ„æºã€‚</li><li>æ‰§è¡Œ limit è¯­å¥ï¼Œå–å‡ºæŒ‡å®šæ¡æ•°çš„ç»“æœé›†è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</li></ol></blockquote><h3 id="innodbå­˜å‚¨å¼•æ“å¯¹mvccçš„å®ç°" tabindex="-1"><a class="header-anchor" href="#innodbå­˜å‚¨å¼•æ“å¯¹mvccçš„å®ç°" aria-hidden="true">#</a> InnoDBå­˜å‚¨å¼•æ“å¯¹MVCCçš„å®ç°</h3><h4 id="mvcc" tabindex="-1"><a class="header-anchor" href="#mvcc" aria-hidden="true">#</a> MVCC</h4><p><em>MVCCï¼Œå…¨ç§°<strong>Multi-Version Concurrency Control</strong>ï¼Œå³å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ã€‚MVCCæ˜¯ä¸€ç§å¹¶å‘æ§åˆ¶çš„æ–¹æ³•ï¼Œä¸€èˆ¬åœ¨æ•°æ®åº“ç®¡ç†ç³»ç»Ÿä¸­ï¼Œå®ç°å¯¹æ•°æ®åº“çš„å¹¶å‘è®¿é—®ï¼Œåœ¨ç¼–ç¨‹è¯­è¨€ä¸­å®ç°äº‹åŠ¡å†…å­˜ã€‚</em></p><blockquote><p><strong>MVCC works only with</strong> the <strong>REPEATABLE READ</strong> and <strong>READ COMMITTED</strong> isolation levels.</p><p>READ UNCOMMITTED isnâ€™t MVCC-compatible because queries donâ€™t read the row version thatâ€™s appropriate for their transaction version; they read the newest version, no matter what.</p><p>SERIALIZABLE isnâ€™t MVCC - compatible because reads lock every row they return</p><p>æ‰€è°“çš„ MVCC ï¼ˆMulti-Version Concurrency Control ï¼Œå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰æŒ‡çš„å°±æ˜¯åœ¨ä½¿ç”¨ READ COMMITTD ã€ REPEATABLE READ è¿™ä¸¤ç§éš”ç¦»çº§åˆ«çš„äº‹åŠ¡åœ¨æ‰§è¡Œæ™®é€šçš„ SEELCT æ“ä½œæ—¶è®¿é—®è®°å½•çš„ç‰ˆæœ¬é“¾çš„è¿‡ç¨‹ï¼Œè¿™æ ·å­å¯ä»¥ä½¿ä¸åŒäº‹åŠ¡çš„ è¯»-å†™ ã€ å†™-è¯» æ“ä½œå¹¶å‘æ‰§è¡Œï¼Œä»è€Œæå‡ç³»ç»Ÿæ€§èƒ½ã€‚ READ COMMITTD ã€REPEATABLE READ è¿™ä¸¤ä¸ªéš”ç¦»çº§åˆ«çš„ä¸€ä¸ªå¾ˆå¤§ä¸åŒå°±æ˜¯ï¼šç”ŸæˆReadViewçš„æ—¶æœºä¸åŒï¼ŒREAD COMMITTDåœ¨æ¯ä¸€æ¬¡è¿›è¡Œæ™®é€šSELECTæ“ä½œå‰éƒ½ä¼šç”Ÿæˆä¸€ä¸ªReadViewï¼Œè€ŒREPEATABLE READåªåœ¨ç¬¬ä¸€æ¬¡è¿›è¡Œæ™®é€šSELECTæ“ä½œå‰ç”Ÿæˆä¸€ä¸ªReadViewï¼Œä¹‹åçš„æŸ¥è¯¢æ“ä½œéƒ½é‡å¤ä½¿ç”¨è¿™ä¸ªReadViewå°±å¥½äº†</p><p>MVCCåœ¨MySQL <strong>InnoDBä¸­çš„å®ç°</strong>ä¸»è¦æ˜¯ä¸ºäº†<strong>æé«˜æ•°æ®åº“å¹¶å‘æ€§èƒ½</strong>ï¼Œç”¨æ›´å¥½çš„æ–¹å¼å»å¤„ç†è¯»-å†™å†²çªï¼Œåšåˆ°<strong>å³ä½¿æœ‰è¯»å†™å†²çª</strong>æ—¶ï¼Œä¹Ÿ<strong>èƒ½åšåˆ°ä¸åŠ é”</strong>ï¼Œ<strong>éé˜»å¡å¹¶å‘è¯»</strong></p><p>å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼ˆMVCCï¼‰æ˜¯ä¸€ç§ç”¨æ¥<strong>è§£å†³è¯»-å†™å†²çªçš„æ— é”å¹¶å‘æ§åˆ¶</strong>ï¼Œä¹Ÿå°±æ˜¯<strong>ä¸ºäº‹åŠ¡åˆ†é…å•å‘å¢é•¿çš„æ—¶é—´æˆ³</strong>ï¼Œ<strong>ä¸ºæ¯ä¸ªä¿®æ”¹ä¿å­˜ä¸€ä¸ªç‰ˆæœ¬</strong>ï¼Œ<strong>ç‰ˆæœ¬ä¸äº‹åŠ¡æ—¶é—´æˆ³å…³è”</strong>ï¼Œ<strong>è¯»æ“ä½œåªè¯»è¯¥äº‹åŠ¡å¼€å§‹å‰çš„æ•°æ®åº“çš„å¿«ç…§</strong>ã€‚ æ‰€ä»¥MVCCå¯ä»¥ä¸ºæ•°æ®åº“è§£å†³ä»¥ä¸‹é—®é¢˜</p><p>åœ¨<strong>å¹¶å‘è¯»å†™æ•°æ®åº“æ—¶</strong>ï¼Œå¯ä»¥åšåˆ°åœ¨<strong>è¯»æ“ä½œæ—¶ä¸ç”¨é˜»å¡å†™æ“ä½œ</strong>ï¼Œ<strong>å†™æ“ä½œä¹Ÿä¸ç”¨é˜»å¡è¯»æ“ä½œ</strong>ï¼Œ<strong>æé«˜</strong>äº†æ•°æ®åº“<strong>å¹¶å‘è¯»å†™çš„æ€§èƒ½</strong> åŒæ—¶è¿˜<strong>å¯ä»¥è§£å†³è„è¯»ï¼Œå¹»è¯»ï¼Œä¸å¯é‡å¤è¯»</strong>ç­‰äº‹åŠ¡éš”ç¦»é—®é¢˜ï¼Œ<strong>ä½†ä¸èƒ½è§£å†³æ›´æ–°ä¸¢å¤±é—®é¢˜</strong></p></blockquote><p><strong>æ•°æ®åº“å¹¶å‘åœºæ™¯</strong></p><ul><li><p><strong>è¯»-è¯»</strong>ï¼šä¸å­˜åœ¨ä»»ä½•é—®é¢˜ï¼Œä¹Ÿä¸éœ€è¦å¹¶å‘æ§åˆ¶</p></li><li><p><strong>è¯»-å†™</strong>ï¼šæœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œå¯èƒ½ä¼šé€ æˆäº‹åŠ¡éš”ç¦»æ€§é—®é¢˜ï¼Œå¯èƒ½é‡åˆ°è„è¯»ï¼Œå¹»è¯»ï¼Œä¸å¯é‡å¤è¯»</p></li><li><p><strong>å†™-å†™</strong>ï¼šæœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œå¯èƒ½ä¼šå­˜åœ¨æ›´æ–°ä¸¢å¤±é—®é¢˜ï¼Œæ¯”å¦‚ç¬¬ä¸€ç±»æ›´æ–°ä¸¢å¤±ï¼Œç¬¬äºŒç±»æ›´æ–°ä¸¢å¤±</p></li></ul><p><strong>å°ç»“ä¸€ä¸‹</strong></p><p>MVCCå°±æ˜¯å› ä¸ºå¤§ç‰›ä»¬ï¼Œä¸æ»¡æ„åªè®©æ•°æ®åº“é‡‡ç”¨æ‚²è§‚é”è¿™æ ·æ€§èƒ½ä¸ä½³çš„å½¢å¼å»è§£å†³è¯»-å†™å†²çªé—®é¢˜ï¼Œè€Œæå‡ºçš„è§£å†³æ–¹æ¡ˆï¼Œæ‰€ä»¥åœ¨æ•°æ®åº“ä¸­ï¼Œå› ä¸ºæœ‰äº†MVCCï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å½¢æˆä¸¤ä¸ªç»„åˆï¼š</p><ul><li><strong>MVCC + æ‚²è§‚é”</strong> MVCCè§£å†³è¯»å†™å†²çªï¼Œæ‚²è§‚é”è§£å†³å†™å†™å†²çª</li><li><strong>MVCC + ä¹è§‚é”</strong> MVCCè§£å†³è¯»å†™å†²çªï¼Œä¹è§‚é”è§£å†³å†™å†™å†²çª</li></ul><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">/** The MVCC read view manager */</span>
class MVCC {
 private:
  view_list_t m_free<span class="token punctuation">;</span>    <span class="token comment">/* ç©ºé—²å³å¯ä»¥è¢«é‡å¤ä½¿ç”¨çš„ Read View çš„é“¾è¡¨ */</span>

  view_list_t m_views<span class="token punctuation">;</span>   <span class="token comment">/* æ´»è·ƒæˆ–è€…å·²ç»å…³é—­çš„ Read View çš„é“¾è¡¨ */</span>
}<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ä¸€è‡´æ€§éé”å®šè¯»å’Œé”å®šè¯»" tabindex="-1"><a class="header-anchor" href="#ä¸€è‡´æ€§éé”å®šè¯»å’Œé”å®šè¯»" aria-hidden="true">#</a> ä¸€è‡´æ€§éé”å®šè¯»å’Œé”å®šè¯»</h4><h5 id="ä¸€è‡´æ€§éé”å®šè¯»" tabindex="-1"><a class="header-anchor" href="#ä¸€è‡´æ€§éé”å®šè¯»" aria-hidden="true">#</a> ä¸€è‡´æ€§éé”å®šè¯»</h5><p><strong>å¿«ç…§è¯»</strong></p><p>å¯¹äº <a href="https://dev.mysql.com/doc/refman/5.7/en/innodb-consistent-read.html" target="_blank" rel="noopener noreferrer"><strong>ä¸€è‡´æ€§éé”å®šè¯»ï¼ˆConsistent Nonlocking Readsï¼‰</strong> open in new window<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>çš„å®ç°ï¼Œé€šå¸¸åšæ³•æ˜¯åŠ ä¸€ä¸ªç‰ˆæœ¬å·æˆ–è€…æ—¶é—´æˆ³å­—æ®µï¼Œåœ¨æ›´æ–°æ•°æ®çš„åŒæ—¶ç‰ˆæœ¬å· + 1 æˆ–è€…æ›´æ–°æ—¶é—´æˆ³ã€‚æŸ¥è¯¢æ—¶ï¼Œå°†å½“å‰å¯è§çš„ç‰ˆæœ¬å·ä¸å¯¹åº”è®°å½•çš„ç‰ˆæœ¬å·è¿›è¡Œæ¯”å¯¹ï¼Œå¦‚æœè®°å½•çš„ç‰ˆæœ¬å°äºå¯è§ç‰ˆæœ¬ï¼Œåˆ™è¡¨ç¤ºè¯¥è®°å½•å¯è§</p><p>åœ¨ <code>InnoDB</code> å­˜å‚¨å¼•æ“ä¸­ï¼Œ<a href="https://dev.mysql.com/doc/refman/5.7/en/innodb-multi-versioning.html" target="_blank" rel="noopener noreferrer">å¤šç‰ˆæœ¬æ§åˆ¶ (multi versioning)open in new window<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> å°±æ˜¯å¯¹éé”å®šè¯»çš„å®ç°ã€‚å¦‚æœè¯»å–çš„è¡Œæ­£åœ¨æ‰§è¡Œ <code>DELETE</code> æˆ– <code>UPDATE</code> æ“ä½œï¼Œè¿™æ—¶è¯»å–æ“ä½œä¸ä¼šå»ç­‰å¾…è¡Œä¸Šé”çš„é‡Šæ”¾ã€‚ç›¸ååœ°ï¼Œ<code>InnoDB</code> å­˜å‚¨å¼•æ“ä¼šå»è¯»å–è¡Œçš„ä¸€ä¸ªå¿«ç…§æ•°æ®ï¼Œå¯¹äºè¿™ç§è¯»å–å†å²æ•°æ®çš„æ–¹å¼ï¼Œæˆ‘ä»¬å«å®ƒå¿«ç…§è¯» (snapshot read)</p><p>åœ¨ <code>Repeatable Read</code> å’Œ <code>Read Committed</code> ä¸¤ä¸ªéš”ç¦»çº§åˆ«ä¸‹ï¼Œå¦‚æœæ˜¯æ‰§è¡Œæ™®é€šçš„ <code>select</code> è¯­å¥ï¼ˆä¸åŒ…æ‹¬ <code>select ... lock in share mode</code> ,<code>select ... for update</code>ï¼‰åˆ™ä¼šä½¿ç”¨ <code>ä¸€è‡´æ€§éé”å®šè¯»ï¼ˆMVCCï¼‰</code>ã€‚å¹¶ä¸”åœ¨ <code>Repeatable Read</code> ä¸‹ <code>MVCC</code> å®ç°äº†å¯é‡å¤è¯»å’Œé˜²æ­¢éƒ¨åˆ†å¹»è¯»</p><h5 id="é”å®šè¯»" tabindex="-1"><a class="header-anchor" href="#é”å®šè¯»" aria-hidden="true">#</a> é”å®šè¯»</h5><p><strong>å½“å‰è¯»</strong></p><p>å¦‚æœæ‰§è¡Œçš„æ˜¯ä¸‹åˆ—è¯­å¥ï¼Œå°±æ˜¯ <a href="https://dev.mysql.com/doc/refman/5.7/en/innodb-locking-reads.html" target="_blank" rel="noopener noreferrer">**é”å®šè¯»ï¼ˆLocking Readsï¼‰**open in new window<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><ul><li><code>select ... lock in share mode</code></li><li><code>select ... for update</code></li><li><code>insert</code>ã€<code>update</code>ã€<code>delete</code> æ“ä½œ</li></ul><p>åœ¨é”å®šè¯»ä¸‹ï¼Œè¯»å–çš„æ˜¯æ•°æ®çš„æœ€æ–°ç‰ˆæœ¬ï¼Œè¿™ç§è¯»ä¹Ÿè¢«ç§°ä¸º <code>å½“å‰è¯»ï¼ˆcurrent readï¼‰</code>ã€‚é”å®šè¯»ä¼šå¯¹è¯»å–åˆ°çš„è®°å½•åŠ é”ï¼š</p><ul><li><code>select ... lock in share mode</code>ï¼šå¯¹è®°å½•åŠ  <code>S</code> é”ï¼Œå…¶å®ƒäº‹åŠ¡ä¹Ÿå¯ä»¥åŠ <code>S</code>é”ï¼Œå¦‚æœåŠ  <code>x</code> é”åˆ™ä¼šè¢«é˜»å¡</li><li><code>select ... for update</code>ã€<code>insert</code>ã€<code>update</code>ã€<code>delete</code>ï¼šå¯¹è®°å½•åŠ  <code>X</code> é”ï¼Œä¸”å…¶å®ƒäº‹åŠ¡ä¸èƒ½åŠ ä»»ä½•é”</li></ul><p>åœ¨ä¸€è‡´æ€§éé”å®šè¯»ä¸‹ï¼Œå³ä½¿è¯»å–çš„è®°å½•å·²è¢«å…¶å®ƒäº‹åŠ¡åŠ ä¸Š <code>X</code> é”ï¼Œè¿™æ—¶è®°å½•ä¹Ÿæ˜¯å¯ä»¥è¢«è¯»å–çš„ï¼Œå³è¯»å–çš„å¿«ç…§æ•°æ®ã€‚ä¸Šé¢è¯´äº†ï¼Œåœ¨ <code>Repeatable Read</code> ä¸‹ <code>MVCC</code> é˜²æ­¢äº†éƒ¨åˆ†å¹»è¯»ï¼Œè¿™è¾¹çš„ â€œéƒ¨åˆ†â€ æ˜¯æŒ‡åœ¨ <code>ä¸€è‡´æ€§éé”å®šè¯»</code> æƒ…å†µä¸‹ï¼Œåªèƒ½è¯»å–åˆ°ç¬¬ä¸€æ¬¡æŸ¥è¯¢ä¹‹å‰æ‰€æ’å…¥çš„æ•°æ®ï¼ˆæ ¹æ® Read View åˆ¤æ–­æ•°æ®å¯è§æ€§ï¼ŒRead View åœ¨ç¬¬ä¸€æ¬¡æŸ¥è¯¢æ—¶ç”Ÿæˆï¼‰ã€‚ä½†æ˜¯ï¼å¦‚æœæ˜¯ <code>å½“å‰è¯»</code> ï¼Œæ¯æ¬¡è¯»å–çš„éƒ½æ˜¯æœ€æ–°æ•°æ®ï¼Œè¿™æ—¶å¦‚æœä¸¤æ¬¡æŸ¥è¯¢ä¸­é—´æœ‰å…¶å®ƒäº‹åŠ¡æ’å…¥æ•°æ®ï¼Œå°±ä¼šäº§ç”Ÿå¹»è¯»ã€‚æ‰€ä»¥ï¼Œ <strong><code>InnoDB</code> åœ¨å®ç°<code>Repeatable Read</code> æ—¶ï¼Œå¦‚æœæ‰§è¡Œçš„æ˜¯å½“å‰è¯»ï¼Œåˆ™ä¼šå¯¹è¯»å–çš„è®°å½•ä½¿ç”¨ <code>Next-key Lock</code> ï¼Œæ¥é˜²æ­¢å…¶å®ƒäº‹åŠ¡åœ¨é—´éš™é—´æ’å…¥æ•°æ®</strong></p><h4 id="innodb-å¯¹-mvcc-çš„å®ç°" tabindex="-1"><a class="header-anchor" href="#innodb-å¯¹-mvcc-çš„å®ç°" aria-hidden="true">#</a> InnoDB å¯¹ MVCC çš„å®ç°</h4><p><code>MVCC</code> çš„å®ç°ä¾èµ–äºï¼š<strong>éšè—å­—æ®µã€Read Viewã€undo log</strong>ã€‚åœ¨å†…éƒ¨å®ç°ä¸­ï¼Œ<code>InnoDB</code> é€šè¿‡æ•°æ®è¡Œçš„ <code>DB_TRX_ID</code> å’Œ <code>Read View</code> æ¥åˆ¤æ–­æ•°æ®çš„å¯è§æ€§ï¼Œå¦‚ä¸å¯è§ï¼Œåˆ™é€šè¿‡æ•°æ®è¡Œçš„ <code>DB_ROLL_PTR</code> æ‰¾åˆ° <code>undo log</code> ä¸­çš„å†å²ç‰ˆæœ¬ã€‚æ¯ä¸ªäº‹åŠ¡è¯»åˆ°çš„æ•°æ®ç‰ˆæœ¬å¯èƒ½æ˜¯ä¸ä¸€æ ·çš„ï¼Œåœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œç”¨æˆ·åªèƒ½çœ‹åˆ°è¯¥äº‹åŠ¡åˆ›å»º <code>Read View</code> ä¹‹å‰å·²ç»æäº¤çš„ä¿®æ”¹å’Œè¯¥äº‹åŠ¡æœ¬èº«åšçš„ä¿®æ”¹</p><h5 id="éšè—å­—æ®µ" tabindex="-1"><a class="header-anchor" href="#éšè—å­—æ®µ" aria-hidden="true">#</a> éšè—å­—æ®µ</h5><p>åœ¨å†…éƒ¨ï¼Œ<code>InnoDB</code> å­˜å‚¨å¼•æ“ä¸ºæ¯è¡Œæ•°æ®æ·»åŠ äº†ä¸‰ä¸ª <a href="https://dev.mysql.com/doc/refman/5.7/en/innodb-multi-versioning.html" target="_blank" rel="noopener noreferrer">éšè—å­—æ®µopen in new window<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ï¼š</p><ul><li><code>DB_TRX_IDï¼ˆ6å­—èŠ‚ï¼‰</code>ï¼šè¡¨ç¤ºæœ€åä¸€æ¬¡æ’å…¥æˆ–æ›´æ–°è¯¥è¡Œçš„äº‹åŠ¡ idã€‚ï¼ˆ<strong>æœ€è¿‘ä¿®æ”¹(ä¿®æ”¹/æ’å…¥)äº‹åŠ¡ID</strong>ï¼‰</li><li><code>DELETED_BIT (1byte)</code>, è®°å½•è¢«æ›´æ–°æˆ–åˆ é™¤å¹¶ä¸ä»£è¡¨çœŸçš„åˆ é™¤ï¼Œè€Œæ˜¯åˆ é™¤flagå˜äº†(<strong>ç±»ä¼¼é€»è¾‘åˆ é™¤</strong>)</li><li><code>DB_ROLL_PTRï¼ˆ7å­—èŠ‚ï¼‰</code> <strong>å›æ»šæŒ‡é’ˆ</strong>ï¼ŒæŒ‡å‘è¯¥è¡Œçš„ <code>undo log</code> ã€‚å¦‚æœè¯¥è¡Œæœªè¢«æ›´æ–°ï¼Œåˆ™ä¸ºç©º</li><li><code>DB_ROW_IDï¼ˆ6å­—èŠ‚ï¼‰</code>ï¼šå¦‚æœæ²¡æœ‰è®¾ç½®ä¸»é”®ä¸”è¯¥è¡¨æ²¡æœ‰å”¯ä¸€éç©ºç´¢å¼•æ—¶ï¼Œ<code>InnoDB</code> ä¼šä½¿ç”¨è¯¥ id æ¥ç”Ÿæˆèšç°‡ç´¢å¼•(<strong>éšè—çš„ä¸»é”®</strong>)</li></ul><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230201165150965.png" alt="image-20230201165150965"></p><h5 id="readview" tabindex="-1"><a class="header-anchor" href="#readview" aria-hidden="true">#</a> ReadView</h5><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>class ReadView {
  <span class="token comment">/* ... */</span>
private:
  trx_id_t m_low_limit_id<span class="token punctuation">;</span>      <span class="token comment">/* å¤§äºç­‰äºè¿™ä¸ª ID çš„äº‹åŠ¡å‡ä¸å¯è§ */</span>

  trx_id_t m_up_limit_id<span class="token punctuation">;</span>       <span class="token comment">/* å°äºè¿™ä¸ª ID çš„äº‹åŠ¡å‡å¯è§ */</span>

  trx_id_t m_creator_trx_id<span class="token punctuation">;</span>    <span class="token comment">/* åˆ›å»ºè¯¥ Read View çš„äº‹åŠ¡ID */</span>

  trx_id_t m_low_limit_no<span class="token punctuation">;</span>      <span class="token comment">/* äº‹åŠ¡ Number, å°äºè¯¥ Number çš„ Undo Logs å‡å¯ä»¥è¢« Purge */</span>

  ids_t m_ids<span class="token punctuation">;</span>                  <span class="token comment">/* åˆ›å»º Read View æ—¶çš„æ´»è·ƒäº‹åŠ¡åˆ—è¡¨ */</span>

  m_closed<span class="token punctuation">;</span>                     <span class="token comment">/* æ ‡è®° Read View æ˜¯å¦ close */</span>
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>Read View</code>ä¸»è¦æ˜¯ç”¨æ¥åš<strong>å¯è§æ€§åˆ¤æ–­</strong>ï¼Œé‡Œé¢ä¿å­˜äº† <code>â€œå½“å‰å¯¹æœ¬äº‹åŠ¡ä¸å¯è§çš„å…¶ä»–æ´»è·ƒäº‹åŠ¡â€</code></p><p>ä¸»è¦æœ‰ä»¥ä¸‹å­—æ®µï¼š</p><ul><li><code>m_low_limit_id</code>ï¼šç›®å‰å‡ºç°è¿‡çš„æœ€å¤§çš„äº‹åŠ¡ ID+1ï¼Œå³ä¸‹ä¸€ä¸ªå°†è¢«åˆ†é…çš„äº‹åŠ¡ IDã€‚å¤§äºç­‰äºè¿™ä¸ª ID çš„æ•°æ®ç‰ˆæœ¬å‡ä¸å¯è§</li><li><code>m_up_limit_id</code>ï¼šæ´»è·ƒäº‹åŠ¡åˆ—è¡¨ <code>m_ids</code> ä¸­æœ€å°çš„äº‹åŠ¡ IDï¼Œå¦‚æœ <code>m_ids</code> ä¸ºç©ºï¼Œåˆ™ <code>m_up_limit_id</code> ä¸º <code>m_low_limit_id</code>ã€‚å°äºè¿™ä¸ª ID çš„æ•°æ®ç‰ˆæœ¬å‡å¯è§</li><li><code>m_ids</code>ï¼š<code>Read View</code> åˆ›å»ºæ—¶å…¶ä»–æœªæäº¤çš„æ´»è·ƒäº‹åŠ¡ ID åˆ—è¡¨ã€‚åˆ›å»º <code>Read View</code>æ—¶ï¼Œå°†å½“å‰æœªæäº¤äº‹åŠ¡ ID è®°å½•ä¸‹æ¥ï¼Œåç»­å³ä½¿å®ƒä»¬ä¿®æ”¹äº†è®°å½•è¡Œçš„å€¼ï¼Œå¯¹äºå½“å‰äº‹åŠ¡ä¹Ÿæ˜¯ä¸å¯è§çš„ã€‚<code>m_ids</code> ä¸åŒ…æ‹¬å½“å‰äº‹åŠ¡è‡ªå·±å’Œå·²æäº¤çš„äº‹åŠ¡ï¼ˆæ­£åœ¨å†…å­˜ä¸­ï¼‰</li><li><code>m_creator_trx_id</code>ï¼šåˆ›å»ºè¯¥ <code>Read View</code> çš„äº‹åŠ¡ ID</li></ul><p><strong>äº‹åŠ¡å¯è§æ€§ç¤ºæ„å›¾</strong>ï¼š</p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230201165955609.png" alt="image-20230201165955609"></p><h5 id="undo-log" tabindex="-1"><a class="header-anchor" href="#undo-log" aria-hidden="true">#</a> undo-log</h5><p><code>undo log</code> ä¸»è¦æœ‰ä¸¤ä¸ªä½œç”¨ï¼š</p><ul><li>å½“äº‹åŠ¡å›æ»šæ—¶ç”¨äºå°†æ•°æ®æ¢å¤åˆ°ä¿®æ”¹å‰çš„æ ·å­</li><li>å¦ä¸€ä¸ªä½œç”¨æ˜¯ <code>MVCC</code> ï¼Œå½“è¯»å–è®°å½•æ—¶ï¼Œè‹¥è¯¥è®°å½•è¢«å…¶ä»–äº‹åŠ¡å ç”¨æˆ–å½“å‰ç‰ˆæœ¬å¯¹è¯¥äº‹åŠ¡ä¸å¯è§ï¼Œåˆ™å¯ä»¥é€šè¿‡ <code>undo log</code> è¯»å–ä¹‹å‰çš„ç‰ˆæœ¬æ•°æ®ï¼Œä»¥æ­¤å®ç°éé”å®šè¯»</li></ul><p>**åœ¨ <code>InnoDB</code> å­˜å‚¨å¼•æ“ä¸­ <code>undo log</code> åˆ†ä¸ºï¼š</p><p><strong>Insert undo log</strong> ï¼šæ’å…¥ä¸€æ¡è®°å½•æ—¶ï¼Œè‡³å°‘è¦æŠŠè¿™æ¡è®°å½•çš„ä¸»é”®å€¼è®°ä¸‹æ¥ï¼Œä¹‹åå›æ»šçš„æ—¶å€™åªéœ€è¦æŠŠè¿™ä¸ªä¸»é”®å€¼å¯¹åº”çš„è®°å½•åˆ æ‰å°±å¥½äº†ã€‚</p><p><strong>Update undo log</strong>ï¼šä¿®æ”¹ä¸€æ¡è®°å½•æ—¶ï¼Œè‡³å°‘è¦æŠŠä¿®æ”¹è¿™æ¡è®°å½•å‰çš„æ—§å€¼éƒ½è®°å½•ä¸‹æ¥ï¼Œè¿™æ ·ä¹‹åå›æ»šæ—¶å†æŠŠè¿™æ¡è®°å½•æ›´æ–°ä¸ºæ—§å€¼å°±å¥½äº†ã€‚</p><p><strong>Delete undo log</strong>ï¼šåˆ é™¤ä¸€æ¡è®°å½•æ—¶ï¼Œè‡³å°‘è¦æŠŠè¿™æ¡è®°å½•ä¸­çš„å†…å®¹éƒ½è®°ä¸‹æ¥ï¼Œè¿™æ ·ä¹‹åå›æ»šæ—¶å†æŠŠç”±è¿™äº›å†…å®¹ç»„æˆçš„è®°å½•æ’å…¥åˆ°è¡¨ä¸­å°±å¥½äº†ã€‚</p><ul><li>åˆ é™¤æ“ä½œéƒ½åªæ˜¯è®¾ç½®ä¸€ä¸‹è€è®°å½•çš„DELETED_BITï¼Œå¹¶ä¸çœŸæ­£å°†è¿‡æ—¶çš„è®°å½•åˆ é™¤ã€‚</li><li>ä¸ºäº†èŠ‚çœç£ç›˜ç©ºé—´ï¼ŒInnoDBæœ‰ä¸“é—¨çš„purgeçº¿ç¨‹æ¥æ¸…ç†DELETED_BITä¸ºtrueçš„è®°å½•ã€‚ä¸ºäº†ä¸å½±å“MVCCçš„æ­£å¸¸å·¥ä½œï¼Œpurgeçº¿ç¨‹è‡ªå·±ä¹Ÿç»´æŠ¤äº†ä¸€ä¸ªread viewï¼ˆè¿™ä¸ªread viewç›¸å½“äºç³»ç»Ÿä¸­æœ€è€æ´»è·ƒäº‹åŠ¡çš„read viewï¼‰;å¦‚æœæŸä¸ªè®°å½•çš„DELETED_BITä¸ºtrueï¼Œå¹¶ä¸”DB_TRX_IDç›¸å¯¹äºpurgeçº¿ç¨‹çš„read viewå¯è§ï¼Œé‚£ä¹ˆè¿™æ¡è®°å½•ä¸€å®šæ˜¯å¯ä»¥è¢«å®‰å…¨æ¸…é™¤çš„ã€‚</li></ul><p><strong><code>insert undo log</code></strong> ï¼š</p><p>æŒ‡åœ¨ <code>insert</code> æ“ä½œä¸­äº§ç”Ÿçš„ <code>undo log</code>ã€‚å› ä¸º <code>insert</code> æ“ä½œçš„è®°å½•åªå¯¹äº‹åŠ¡æœ¬èº«å¯è§ï¼Œå¯¹å…¶ä»–äº‹åŠ¡ä¸å¯è§ï¼Œæ•…è¯¥ <code>undo log</code> å¯ä»¥åœ¨äº‹åŠ¡æäº¤åç›´æ¥åˆ é™¤ã€‚ä¸éœ€è¦è¿›è¡Œ <code>purge</code> æ“ä½œ</p><p><strong><code>insert</code> æ—¶çš„æ•°æ®åˆå§‹çŠ¶æ€ï¼š</strong></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230201165514158.png" alt="image-20230201165514158"></p><p><strong><code>update undo log</code></strong> ï¼š</p><p><code>update</code> æˆ– <code>delete</code> æ“ä½œä¸­äº§ç”Ÿçš„ <code>undo log</code>ã€‚è¯¥ <code>undo log</code>å¯èƒ½éœ€è¦æä¾› <code>MVCC</code> æœºåˆ¶ï¼Œå› æ­¤ä¸èƒ½åœ¨äº‹åŠ¡æäº¤æ—¶å°±è¿›è¡Œåˆ é™¤ã€‚æäº¤æ—¶æ”¾å…¥ <code>undo log</code> é“¾è¡¨ï¼Œç­‰å¾… <code>purgeçº¿ç¨‹</code> è¿›è¡Œæœ€åçš„åˆ é™¤</p><p><strong>æ•°æ®ç¬¬ä¸€æ¬¡è¢«ä¿®æ”¹æ—¶ï¼š</strong></p><ol><li>åœ¨äº‹åŠ¡1ä¿®æ”¹è¯¥è¡Œ(è®°å½•)æ•°æ®æ—¶ï¼Œæ•°æ®åº“ä¼šå…ˆå¯¹è¯¥è¡ŒåŠ æ’ä»–é”</li><li>ç„¶åæŠŠè¯¥è¡Œæ•°æ®æ‹·è´åˆ°undo logä¸­ï¼Œä½œä¸ºæ—§è®°å½•ï¼Œå³åœ¨undo logä¸­æœ‰å½“å‰è¡Œçš„æ‹·è´å‰¯æœ¬</li><li>æ‹·è´å®Œæ¯•åï¼Œä¿®æ”¹è¯¥è¡Œnameä¸ºTomï¼Œå¹¶ä¸”ä¿®æ”¹éšè—å­—æ®µçš„äº‹åŠ¡IDä¸ºå½“å‰äº‹åŠ¡1çš„ID, æˆ‘ä»¬é»˜è®¤ä»1å¼€å§‹ï¼Œä¹‹åé€’å¢ï¼Œå›æ»šæŒ‡é’ˆæŒ‡å‘æ‹·è´åˆ°undo logçš„å‰¯æœ¬è®°å½•ï¼Œå³è¡¨ç¤ºæˆ‘çš„ä¸Šä¸€ä¸ªç‰ˆæœ¬å°±æ˜¯å®ƒ</li><li>äº‹åŠ¡æäº¤åï¼Œé‡Šæ”¾é”</li></ol><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230201165536433.png" alt="image-20230201165536433"></p><p><strong>æ•°æ®ç¬¬äºŒæ¬¡è¢«ä¿®æ”¹æ—¶ï¼š</strong></p><ol><li>åœ¨äº‹åŠ¡2ä¿®æ”¹è¯¥è¡Œæ•°æ®æ—¶ï¼Œæ•°æ®åº“ä¹Ÿå…ˆä¸ºè¯¥è¡ŒåŠ é”</li><li>ç„¶åæŠŠè¯¥è¡Œæ•°æ®æ‹·è´åˆ°undo logä¸­ï¼Œä½œä¸ºæ—§è®°å½•ï¼Œå‘ç°è¯¥è¡Œè®°å½•å·²ç»æœ‰undo logäº†ï¼Œé‚£ä¹ˆæœ€æ–°çš„æ—§æ•°æ®ä½œä¸ºé“¾è¡¨çš„è¡¨å¤´ï¼Œæ’åœ¨è¯¥è¡Œè®°å½•çš„undo logæœ€å‰é¢</li><li>ä¿®æ”¹è¯¥è¡Œageä¸º30å²ï¼Œå¹¶ä¸”ä¿®æ”¹éšè—å­—æ®µçš„äº‹åŠ¡IDä¸ºå½“å‰äº‹åŠ¡2çš„ID, é‚£å°±æ˜¯2ï¼Œå›æ»šæŒ‡é’ˆæŒ‡å‘åˆšåˆšæ‹·è´åˆ°undo logçš„å‰¯æœ¬è®°å½•</li><li>äº‹åŠ¡æäº¤ï¼Œé‡Šæ”¾é”</li></ol><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230201165644000.png" alt="image-20230201165644000"></p><p>ä¸åŒäº‹åŠ¡æˆ–è€…ç›¸åŒäº‹åŠ¡çš„å¯¹åŒä¸€è®°å½•è¡Œçš„ä¿®æ”¹ï¼Œä¼šä½¿è¯¥è®°å½•è¡Œçš„ <code>undo log</code> æˆä¸ºä¸€æ¡é“¾è¡¨ï¼Œ<strong>é“¾é¦–å°±æ˜¯æœ€æ–°çš„è®°å½•</strong>ï¼Œ<strong>é“¾å°¾å°±æ˜¯æœ€æ—©çš„æ—§è®°å½•</strong>ã€‚</p><p>è¯¥<strong>undo logçš„èŠ‚ç‚¹å¯èƒ½æ˜¯ä¼špurgeçº¿ç¨‹æ¸…é™¤æ‰</strong>ï¼Œä¾‹å­ä¸­çš„ç¬¬ä¸€æ¡insert undo logï¼Œå…¶å®åœ¨äº‹åŠ¡æäº¤ä¹‹åå¯èƒ½å°±è¢«åˆ é™¤ä¸¢å¤±äº†</p><h5 id="æ•°æ®å¯è§æ€§ç®—æ³•" tabindex="-1"><a class="header-anchor" href="#æ•°æ®å¯è§æ€§ç®—æ³•" aria-hidden="true">#</a> æ•°æ®å¯è§æ€§ç®—æ³•</h5><p>åœ¨ <code>InnoDB</code> å­˜å‚¨å¼•æ“ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªæ–°äº‹åŠ¡åï¼Œæ‰§è¡Œæ¯ä¸ª <code>select</code> è¯­å¥å‰ï¼Œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªå¿«ç…§ï¼ˆRead Viewï¼‰ï¼Œ<strong>å¿«ç…§ä¸­ä¿å­˜äº†å½“å‰æ•°æ®åº“ç³»ç»Ÿä¸­æ­£å¤„äºæ´»è·ƒï¼ˆæ²¡æœ‰ commitï¼‰çš„äº‹åŠ¡çš„ ID å·</strong>ã€‚å…¶å®ç®€å•çš„è¯´ä¿å­˜çš„æ˜¯ç³»ç»Ÿä¸­å½“å‰ä¸åº”è¯¥è¢«æœ¬äº‹åŠ¡çœ‹åˆ°çš„å…¶ä»–äº‹åŠ¡ ID åˆ—è¡¨ï¼ˆå³ m_idsï¼‰ã€‚å½“ç”¨æˆ·åœ¨è¿™ä¸ªäº‹åŠ¡ä¸­è¦è¯»å–æŸä¸ªè®°å½•è¡Œçš„æ—¶å€™ï¼Œ<code>InnoDB</code> ä¼šå°†è¯¥è®°å½•è¡Œçš„ <code>DB_TRX_ID</code> ä¸ <code>Read View</code> ä¸­çš„ä¸€äº›å˜é‡åŠå½“å‰äº‹åŠ¡ ID è¿›è¡Œæ¯”è¾ƒï¼Œåˆ¤æ–­æ˜¯å¦æ»¡è¶³å¯è§æ€§æ¡ä»¶</p><p>å…·ä½“çš„æ¯”è¾ƒç®—æ³•å¦‚ä¸‹</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">/* storage/innobase/include/read0types.h */</span>

<span class="token keyword">bool</span> changes_visible<span class="token punctuation">(</span>trx_id_t id<span class="token punctuation">,</span> const table_name_t <span class="token operator">&amp;</span>name<span class="token punctuation">)</span> const
      MY_ATTRIBUTE<span class="token punctuation">(</span><span class="token punctuation">(</span>warn_unused_result<span class="token punctuation">)</span><span class="token punctuation">)</span> {
    ut_ad<span class="token punctuation">(</span>id <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		
    <span class="token comment">/* å‡å¦‚ trx_id å°äº Read View é™åˆ¶çš„æœ€å°æ´»è·ƒäº‹åŠ¡ID m_up_limit_id æˆ–è€…ç­‰äºæ­£åœ¨åˆ›å»ºçš„äº‹åŠ¡ID
     * m_creator_trx_id å³æ»¡è¶³äº‹åŠ¡çš„å¯è§æ€§. */</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>id <span class="token operator">&lt;</span> m_up_limit_id <span class="token operator">||</span> id <span class="token operator">=</span><span class="token operator">=</span> m_creator_trx_id<span class="token punctuation">)</span> {
      <span class="token comment">/* å¯è§. */</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    }

    <span class="token comment">/* æ£€æŸ¥ trx_id æ˜¯å¦æœ‰æ•ˆ. */</span>
    check_trx_id_sanity<span class="token punctuation">(</span>id<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
		
    <span class="token keyword">if</span> <span class="token punctuation">(</span>id <span class="token operator">&gt;=</span> m_low_limit_id<span class="token punctuation">)</span> {
      <span class="token comment">/* å‡å¦‚ trx_id å¤§äºç­‰äºæœ€å¤§æ´»è·ƒçš„äº‹åŠ¡ID m_low_limit_id, å³ä¸å¯è§. */</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    } <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>m_ids<span class="token punctuation">.</span>empty<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> {
      <span class="token comment">/* å‡å¦‚ç›®å‰ä¸å­˜åœ¨æ´»è·ƒçš„äº‹åŠ¡ï¼Œå³å¯è§. */</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    }

    const ids_t::value_type <span class="token operator">*</span>p <span class="token operator">=</span> m_ids<span class="token punctuation">.</span><span class="token keyword">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/* åˆ©ç”¨äºŒåˆ†æŸ¥æ‰¾æœç´¢æ´»è·ƒäº‹åŠ¡åˆ—è¡¨, å½“ trx_id åœ¨ m_up_limit_id å’Œ m_low_limit_id ä¹‹é—´
     * å¦‚æœ id åœ¨ m_ids æ•°ç»„ä¸­, è¡¨æ˜ ReadView åˆ›å»ºæ—¶å€™ï¼Œäº‹åŠ¡å¤„äºæ´»è·ƒçŠ¶æ€ï¼Œå› æ­¤è®°å½•ä¸å¯è§. */</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token operator">!</span>std::binary_search<span class="token punctuation">(</span>p<span class="token punctuation">,</span> p <span class="token operator">+</span> m_ids<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  }
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol><li>å¦‚æœè®°å½• DB_TRX_ID &lt; m_up_limit_idï¼Œé‚£ä¹ˆè¡¨æ˜æœ€æ–°ä¿®æ”¹è¯¥è¡Œçš„äº‹åŠ¡ï¼ˆDB_TRX_IDï¼‰åœ¨å½“å‰äº‹åŠ¡åˆ›å»ºå¿«ç…§ä¹‹å‰å°±æäº¤äº†ï¼Œæ‰€ä»¥è¯¥è®°å½•è¡Œçš„å€¼å¯¹å½“å‰äº‹åŠ¡æ˜¯å¯è§çš„</li><li>å¦‚æœ DB_TRX_ID &gt;= m_low_limit_idï¼Œé‚£ä¹ˆè¡¨æ˜æœ€æ–°ä¿®æ”¹è¯¥è¡Œçš„äº‹åŠ¡ï¼ˆDB_TRX_IDï¼‰åœ¨å½“å‰äº‹åŠ¡åˆ›å»ºå¿«ç…§ä¹‹åæ‰ä¿®æ”¹è¯¥è¡Œï¼Œæ‰€ä»¥è¯¥è®°å½•è¡Œçš„å€¼å¯¹å½“å‰äº‹åŠ¡ä¸å¯è§ã€‚è·³åˆ°æ­¥éª¤ 5</li><li>m_ids ä¸ºç©ºï¼Œåˆ™è¡¨æ˜åœ¨å½“å‰äº‹åŠ¡åˆ›å»ºå¿«ç…§ä¹‹å‰ï¼Œä¿®æ”¹è¯¥è¡Œçš„äº‹åŠ¡å°±å·²ç»æäº¤äº†ï¼Œæ‰€ä»¥è¯¥è®°å½•è¡Œçš„å€¼å¯¹å½“å‰äº‹åŠ¡æ˜¯å¯è§çš„</li><li>å¦‚æœ m_up_limit_id &lt;= DB_TRX_ID &lt; m_low_limit_idï¼Œè¡¨æ˜æœ€æ–°ä¿®æ”¹è¯¥è¡Œçš„äº‹åŠ¡ï¼ˆDB_TRX_IDï¼‰åœ¨å½“å‰äº‹åŠ¡åˆ›å»ºå¿«ç…§çš„æ—¶å€™å¯èƒ½å¤„äºâ€œæ´»åŠ¨çŠ¶æ€â€æˆ–è€…â€œå·²æäº¤çŠ¶æ€â€ï¼›æ‰€ä»¥å°±è¦å¯¹æ´»è·ƒäº‹åŠ¡åˆ—è¡¨ m_ids è¿›è¡ŒæŸ¥æ‰¾ï¼ˆæºç ä¸­æ˜¯ç”¨çš„äºŒåˆ†æŸ¥æ‰¾ï¼Œå› ä¸ºæ˜¯æœ‰åºçš„ï¼‰ <ul><li>å¦‚æœåœ¨æ´»è·ƒäº‹åŠ¡åˆ—è¡¨ m_ids ä¸­èƒ½æ‰¾åˆ° DB_TRX_IDï¼Œè¡¨æ˜ï¼šâ‘  åœ¨å½“å‰äº‹åŠ¡åˆ›å»ºå¿«ç…§å‰ï¼Œè¯¥è®°å½•è¡Œçš„å€¼è¢«äº‹åŠ¡ ID ä¸º DB_TRX_ID çš„äº‹åŠ¡ä¿®æ”¹äº†ï¼Œä½†æ²¡æœ‰æäº¤ï¼›æˆ–è€… â‘¡ åœ¨å½“å‰äº‹åŠ¡åˆ›å»ºå¿«ç…§åï¼Œè¯¥è®°å½•è¡Œçš„å€¼è¢«äº‹åŠ¡ ID ä¸º DB_TRX_ID çš„äº‹åŠ¡ä¿®æ”¹äº†ã€‚è¿™äº›æƒ…å†µä¸‹ï¼Œè¿™ä¸ªè®°å½•è¡Œçš„å€¼å¯¹å½“å‰äº‹åŠ¡éƒ½æ˜¯ä¸å¯è§çš„ã€‚è·³åˆ°æ­¥éª¤ 5</li><li>åœ¨æ´»è·ƒäº‹åŠ¡åˆ—è¡¨ä¸­æ‰¾ä¸åˆ°ï¼Œåˆ™è¡¨æ˜â€œid ä¸º trx_id çš„äº‹åŠ¡â€åœ¨ä¿®æ”¹â€œè¯¥è®°å½•è¡Œçš„å€¼â€åï¼Œåœ¨â€œå½“å‰äº‹åŠ¡â€åˆ›å»ºå¿«ç…§å‰å°±å·²ç»æäº¤äº†ï¼Œæ‰€ä»¥è®°å½•è¡Œå¯¹å½“å‰äº‹åŠ¡å¯è§</li></ul></li><li>åœ¨è¯¥è®°å½•è¡Œçš„ DB_ROLL_PTR æŒ‡é’ˆæ‰€æŒ‡å‘çš„ <code>undo log</code> å–å‡ºå¿«ç…§è®°å½•ï¼Œç”¨å¿«ç…§è®°å½•çš„ DB_TRX_ID è·³åˆ°æ­¥éª¤ 1 é‡æ–°å¼€å§‹åˆ¤æ–­ï¼Œç›´åˆ°æ‰¾åˆ°æ»¡è¶³çš„å¿«ç…§ç‰ˆæœ¬æˆ–è¿”å›ç©º</li></ol><h3 id="rc-å’Œ-rr-éš”ç¦»çº§åˆ«ä¸‹-mvcc-çš„å·®å¼‚" tabindex="-1"><a class="header-anchor" href="#rc-å’Œ-rr-éš”ç¦»çº§åˆ«ä¸‹-mvcc-çš„å·®å¼‚" aria-hidden="true">#</a> RC å’Œ RR éš”ç¦»çº§åˆ«ä¸‹ MVCC çš„å·®å¼‚</h3><p>åœ¨äº‹åŠ¡éš”ç¦»çº§åˆ« <code>RC</code> å’Œ <code>RR</code> ï¼ˆInnoDB å­˜å‚¨å¼•æ“çš„é»˜è®¤äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼‰ä¸‹ï¼Œ<code>InnoDB</code> å­˜å‚¨å¼•æ“ä½¿ç”¨ <code>MVCC</code>ï¼ˆéé”å®šä¸€è‡´æ€§è¯»ï¼‰ï¼Œä½†å®ƒä»¬ç”Ÿæˆ <code>Read View</code> çš„æ—¶æœºå´ä¸åŒ</p><ul><li>åœ¨ RC éš”ç¦»çº§åˆ«ä¸‹çš„ <strong><code>æ¯æ¬¡select</code></strong> æŸ¥è¯¢å‰éƒ½ç”Ÿæˆä¸€ä¸ª<code>Read View</code> (m_ids åˆ—è¡¨)</li><li>åœ¨ RR éš”ç¦»çº§åˆ«ä¸‹åªåœ¨äº‹åŠ¡å¼€å§‹å <strong><code>ç¬¬ä¸€æ¬¡select</code></strong> æ•°æ®å‰ç”Ÿæˆä¸€ä¸ª<code>Read View</code>ï¼ˆm_ids åˆ—è¡¨ï¼‰</li></ul><h4 id="mvcc-è§£å†³ä¸å¯é‡å¤è¯»é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#mvcc-è§£å†³ä¸å¯é‡å¤è¯»é—®é¢˜" aria-hidden="true">#</a> MVCC è§£å†³ä¸å¯é‡å¤è¯»é—®é¢˜</h4><p>è™½ç„¶ RC å’Œ RR éƒ½é€šè¿‡ <code>MVCC</code> æ¥è¯»å–å¿«ç…§æ•°æ®ï¼Œä½†ç”±äº <strong>ç”Ÿæˆ Read View æ—¶æœºä¸åŒ</strong>ï¼Œä»è€Œåœ¨ RR çº§åˆ«ä¸‹å®ç°å¯é‡å¤è¯»</p><p>ä¸¾ä¸ªä¾‹å­ï¼š</p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230201170357019.png" alt="image-20230201170357019"></p><h4 id="åœ¨-rc-ä¸‹-readview-ç”Ÿæˆæƒ…å†µ" tabindex="-1"><a class="header-anchor" href="#åœ¨-rc-ä¸‹-readview-ç”Ÿæˆæƒ…å†µ" aria-hidden="true">#</a> åœ¨ RC ä¸‹ ReadView ç”Ÿæˆæƒ…å†µ</h4><p><strong>1. å‡è®¾æ—¶é—´çº¿æ¥åˆ° T4 ï¼Œé‚£ä¹ˆæ­¤æ—¶æ•°æ®è¡Œ id = 1 çš„ç‰ˆæœ¬é“¾ä¸ºï¼š</strong></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230201170459727.png" alt="image-20230201170459727"></p><p>ç”±äº RC çº§åˆ«ä¸‹æ¯æ¬¡æŸ¥è¯¢éƒ½ä¼šç”Ÿæˆ<code>Read View</code> ï¼Œå¹¶ä¸”äº‹åŠ¡ 101ã€102 å¹¶æœªæäº¤ï¼Œæ­¤æ—¶ <code>103</code> äº‹åŠ¡ç”Ÿæˆçš„ <code>Read View</code> ä¸­æ´»è·ƒçš„äº‹åŠ¡ <strong><code>m_ids</code> ä¸ºï¼š[101,102]</strong> ï¼Œ<code>m_low_limit_id</code>ä¸ºï¼š104ï¼Œ<code>m_up_limit_id</code>ä¸ºï¼š101ï¼Œ<code>m_creator_trx_id</code> ä¸ºï¼š103</p><ul><li>æ­¤æ—¶æœ€æ–°è®°å½•çš„ <code>DB_TRX_ID</code> ä¸º 101ï¼Œm_up_limit_id &lt;= 101 &lt; m_low_limit_idï¼Œæ‰€ä»¥è¦åœ¨ <code>m_ids</code> åˆ—è¡¨ä¸­æŸ¥æ‰¾ï¼Œå‘ç° <code>DB_TRX_ID</code> å­˜åœ¨åˆ—è¡¨ä¸­ï¼Œé‚£ä¹ˆè¿™ä¸ªè®°å½•ä¸å¯è§</li><li>æ ¹æ® <code>DB_ROLL_PTR</code> æ‰¾åˆ° <code>undo log</code> ä¸­çš„ä¸Šä¸€ç‰ˆæœ¬è®°å½•ï¼Œä¸Šä¸€æ¡è®°å½•çš„ <code>DB_TRX_ID</code> è¿˜æ˜¯ 101ï¼Œä¸å¯è§</li><li>ç»§ç»­æ‰¾ä¸Šä¸€æ¡ <code>DB_TRX_ID</code>ä¸º 1ï¼Œæ»¡è¶³ 1 &lt; m_up_limit_idï¼Œå¯è§ï¼Œæ‰€ä»¥äº‹åŠ¡ 103 æŸ¥è¯¢åˆ°æ•°æ®ä¸º <code>name = èœèŠ±</code></li></ul><p><strong>2. æ—¶é—´çº¿æ¥åˆ° T6 ï¼Œæ•°æ®çš„ç‰ˆæœ¬é“¾ä¸ºï¼š</strong></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230201170511755.png" alt="image-20230201170511755"></p><p>å› ä¸ºåœ¨ RC çº§åˆ«ä¸‹ï¼Œé‡æ–°ç”Ÿæˆ <code>Read View</code>ï¼Œè¿™æ—¶äº‹åŠ¡ 101 å·²ç»æäº¤ï¼Œ102 å¹¶æœªæäº¤ï¼Œæ‰€ä»¥æ­¤æ—¶ <code>Read View</code> ä¸­æ´»è·ƒçš„äº‹åŠ¡ <strong><code>m_ids</code>ï¼š[102]</strong> ï¼Œ<code>m_low_limit_id</code>ä¸ºï¼š104ï¼Œ<code>m_up_limit_id</code>ä¸ºï¼š102ï¼Œ<code>m_creator_trx_id</code>ä¸ºï¼š103</p><ul><li>æ­¤æ—¶æœ€æ–°è®°å½•çš„ <code>DB_TRX_ID</code> ä¸º 102ï¼Œm_up_limit_id &lt;= 102 &lt; m_low_limit_idï¼Œæ‰€ä»¥è¦åœ¨ <code>m_ids</code> åˆ—è¡¨ä¸­æŸ¥æ‰¾ï¼Œå‘ç° <code>DB_TRX_ID</code> å­˜åœ¨åˆ—è¡¨ä¸­ï¼Œé‚£ä¹ˆè¿™ä¸ªè®°å½•ä¸å¯è§</li><li>æ ¹æ® <code>DB_ROLL_PTR</code> æ‰¾åˆ° <code>undo log</code> ä¸­çš„ä¸Šä¸€ç‰ˆæœ¬è®°å½•ï¼Œä¸Šä¸€æ¡è®°å½•çš„ <code>DB_TRX_ID</code> ä¸º 101ï¼Œæ»¡è¶³ 101 &lt; m_up_limit_idï¼Œè®°å½•å¯è§ï¼Œæ‰€ä»¥åœ¨ <code>T6</code> æ—¶é—´ç‚¹æŸ¥è¯¢åˆ°æ•°æ®ä¸º <code>name = æå››</code>ï¼Œä¸æ—¶é—´ T4 æŸ¥è¯¢åˆ°çš„ç»“æœä¸ä¸€è‡´ï¼Œä¸å¯é‡å¤è¯»ï¼</li></ul><p><strong>3. æ—¶é—´çº¿æ¥åˆ° T9 ï¼Œæ•°æ®çš„ç‰ˆæœ¬é“¾ä¸ºï¼š</strong></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230201170524310.png" alt="image-20230201170524310"></p><p>é‡æ–°ç”Ÿæˆ <code>Read View</code>ï¼Œ è¿™æ—¶äº‹åŠ¡ 101 å’Œ 102 éƒ½å·²ç»æäº¤ï¼Œæ‰€ä»¥ <strong>m_ids</strong> ä¸ºç©ºï¼Œåˆ™ m_up_limit_id = m_low_limit_id = 104ï¼Œæœ€æ–°ç‰ˆæœ¬äº‹åŠ¡ ID ä¸º 102ï¼Œæ»¡è¶³ 102 &lt; m_low_limit_idï¼Œå¯è§ï¼ŒæŸ¥è¯¢ç»“æœä¸º <code>name = èµµå…­</code></p><blockquote><p><strong>æ€»ç»“ï¼š</strong> <strong>åœ¨ RC éš”ç¦»çº§åˆ«ä¸‹ï¼Œäº‹åŠ¡åœ¨æ¯æ¬¡æŸ¥è¯¢å¼€å§‹æ—¶éƒ½ä¼šç”Ÿæˆå¹¶è®¾ç½®æ–°çš„ Read Viewï¼Œæ‰€ä»¥å¯¼è‡´ä¸å¯é‡å¤è¯»</strong></p></blockquote><h4 id="åœ¨-rr-ä¸‹-readview-ç”Ÿæˆæƒ…å†µ" tabindex="-1"><a class="header-anchor" href="#åœ¨-rr-ä¸‹-readview-ç”Ÿæˆæƒ…å†µ" aria-hidden="true">#</a> åœ¨ RR ä¸‹ ReadView ç”Ÿæˆæƒ…å†µ</h4><p>åœ¨å¯é‡å¤è¯»çº§åˆ«ä¸‹ï¼Œåªä¼šåœ¨äº‹åŠ¡å¼€å§‹åç¬¬ä¸€æ¬¡è¯»å–æ•°æ®æ—¶ç”Ÿæˆä¸€ä¸ª Read Viewï¼ˆm_ids åˆ—è¡¨ï¼‰</p><p><strong>1. åœ¨ T4 æƒ…å†µä¸‹çš„ç‰ˆæœ¬é“¾ä¸ºï¼š</strong></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230201170539755.png" alt="image-20230201170539755"></p><p>åœ¨å½“å‰æ‰§è¡Œ <code>select</code> è¯­å¥æ—¶ç”Ÿæˆä¸€ä¸ª <code>Read View</code>ï¼Œæ­¤æ—¶ <strong><code>m_ids</code>ï¼š[101,102]</strong> ï¼Œ<code>m_low_limit_id</code>ä¸ºï¼š104ï¼Œ<code>m_up_limit_id</code>ä¸ºï¼š101ï¼Œ<code>m_creator_trx_id</code> ä¸ºï¼š103</p><p>æ­¤æ—¶å’Œ RC çº§åˆ«ä¸‹ä¸€æ ·ï¼š</p><ul><li>æœ€æ–°è®°å½•çš„ <code>DB_TRX_ID</code> ä¸º 101ï¼Œm_up_limit_id &lt;= 101 &lt; m_low_limit_idï¼Œæ‰€ä»¥è¦åœ¨ <code>m_ids</code> åˆ—è¡¨ä¸­æŸ¥æ‰¾ï¼Œå‘ç° <code>DB_TRX_ID</code> å­˜åœ¨åˆ—è¡¨ä¸­ï¼Œé‚£ä¹ˆè¿™ä¸ªè®°å½•ä¸å¯è§</li><li>æ ¹æ® <code>DB_ROLL_PTR</code> æ‰¾åˆ° <code>undo log</code> ä¸­çš„ä¸Šä¸€ç‰ˆæœ¬è®°å½•ï¼Œä¸Šä¸€æ¡è®°å½•çš„ <code>DB_TRX_ID</code> è¿˜æ˜¯ 101ï¼Œä¸å¯è§</li><li>ç»§ç»­æ‰¾ä¸Šä¸€æ¡ <code>DB_TRX_ID</code>ä¸º 1ï¼Œæ»¡è¶³ 1 &lt; m_up_limit_idï¼Œå¯è§ï¼Œæ‰€ä»¥äº‹åŠ¡ 103 æŸ¥è¯¢åˆ°æ•°æ®ä¸º <code>name = èœèŠ±</code></li></ul><p><strong>2. æ—¶é—´ç‚¹ T6 æƒ…å†µä¸‹ï¼š</strong></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230201170549490.png" alt="image-20230201170549490"></p><p>åœ¨ RR çº§åˆ«ä¸‹åªä¼šç”Ÿæˆä¸€æ¬¡<code>Read View</code>ï¼Œæ‰€ä»¥æ­¤æ—¶ä¾ç„¶æ²¿ç”¨ <strong><code>m_ids</code> ï¼š[101,102]</strong> ï¼Œ<code>m_low_limit_id</code>ä¸ºï¼š104ï¼Œ<code>m_up_limit_id</code>ä¸ºï¼š101ï¼Œ<code>m_creator_trx_id</code> ä¸ºï¼š103</p><ul><li>æœ€æ–°è®°å½•çš„ <code>DB_TRX_ID</code> ä¸º 102ï¼Œm_up_limit_id &lt;= 102 &lt; m_low_limit_idï¼Œæ‰€ä»¥è¦åœ¨ <code>m_ids</code> åˆ—è¡¨ä¸­æŸ¥æ‰¾ï¼Œå‘ç° <code>DB_TRX_ID</code> å­˜åœ¨åˆ—è¡¨ä¸­ï¼Œé‚£ä¹ˆè¿™ä¸ªè®°å½•ä¸å¯è§</li><li>æ ¹æ® <code>DB_ROLL_PTR</code> æ‰¾åˆ° <code>undo log</code> ä¸­çš„ä¸Šä¸€ç‰ˆæœ¬è®°å½•ï¼Œä¸Šä¸€æ¡è®°å½•çš„ <code>DB_TRX_ID</code> ä¸º 101ï¼Œä¸å¯è§</li><li>ç»§ç»­æ ¹æ® <code>DB_ROLL_PTR</code> æ‰¾åˆ° <code>undo log</code> ä¸­çš„ä¸Šä¸€ç‰ˆæœ¬è®°å½•ï¼Œä¸Šä¸€æ¡è®°å½•çš„ <code>DB_TRX_ID</code> è¿˜æ˜¯ 101ï¼Œä¸å¯è§</li><li>ç»§ç»­æ‰¾ä¸Šä¸€æ¡ <code>DB_TRX_ID</code>ä¸º 1ï¼Œæ»¡è¶³ 1 &lt; m_up_limit_idï¼Œå¯è§ï¼Œæ‰€ä»¥äº‹åŠ¡ 103 æŸ¥è¯¢åˆ°æ•°æ®ä¸º <code>name = èœèŠ±</code></li></ul><p><strong>3. æ—¶é—´ç‚¹ T9 æƒ…å†µä¸‹ï¼š</strong></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230201170601467.png" alt="image-20230201170601467"></p><p>æ­¤æ—¶æƒ…å†µè·Ÿ T6 å®Œå…¨ä¸€æ ·ï¼Œç”±äºå·²ç»ç”Ÿæˆäº† <code>Read View</code>ï¼Œæ­¤æ—¶ä¾ç„¶æ²¿ç”¨ <strong><code>m_ids</code> ï¼š[101,102]</strong> ï¼Œæ‰€ä»¥æŸ¥è¯¢ç»“æœä¾ç„¶æ˜¯ <code>name = èœèŠ±</code></p><h3 id="mvccâ•next-key-lock-é˜²æ­¢å¹»è¯»" tabindex="-1"><a class="header-anchor" href="#mvccâ•next-key-lock-é˜²æ­¢å¹»è¯»" aria-hidden="true">#</a> MVCCâ•Next-key-Lock é˜²æ­¢å¹»è¯»</h3><p><code>InnoDB</code>å­˜å‚¨å¼•æ“åœ¨ RR çº§åˆ«ä¸‹é€šè¿‡ <code>MVCC</code>å’Œ <code>Next-key Lock</code> æ¥è§£å†³å¹»è¯»é—®é¢˜ï¼š</p><p><strong>1ã€æ‰§è¡Œæ™®é€š <code>select</code>ï¼Œæ­¤æ—¶ä¼šä»¥ <code>MVCC</code> å¿«ç…§è¯»çš„æ–¹å¼è¯»å–æ•°æ®</strong></p><p>åœ¨å¿«ç…§è¯»çš„æƒ…å†µä¸‹ï¼ŒRR éš”ç¦»çº§åˆ«åªä¼šåœ¨äº‹åŠ¡å¼€å¯åçš„ç¬¬ä¸€æ¬¡æŸ¥è¯¢ç”Ÿæˆ <code>Read View</code> ï¼Œå¹¶ä½¿ç”¨è‡³äº‹åŠ¡æäº¤ã€‚æ‰€ä»¥åœ¨ç”Ÿæˆ <code>Read View</code> ä¹‹åå…¶å®ƒäº‹åŠ¡æ‰€åšçš„æ›´æ–°ã€æ’å…¥è®°å½•ç‰ˆæœ¬å¯¹å½“å‰äº‹åŠ¡å¹¶ä¸å¯è§ï¼Œå®ç°äº†å¯é‡å¤è¯»å’Œé˜²æ­¢å¿«ç…§è¯»ä¸‹çš„ â€œå¹»è¯»â€</p><p><strong>2ã€æ‰§è¡Œ select...for update/lock in share modeã€insertã€updateã€delete ç­‰å½“å‰è¯»</strong></p><p>åœ¨å½“å‰è¯»ä¸‹ï¼Œè¯»å–çš„éƒ½æ˜¯æœ€æ–°çš„æ•°æ®ï¼Œå¦‚æœå…¶å®ƒäº‹åŠ¡æœ‰æ’å…¥æ–°çš„è®°å½•ï¼Œå¹¶ä¸”åˆšå¥½åœ¨å½“å‰äº‹åŠ¡æŸ¥è¯¢èŒƒå›´å†…ï¼Œå°±ä¼šäº§ç”Ÿå¹»è¯»ï¼</p><p><code>InnoDB</code> ä½¿ç”¨</p><p><code>Next-Keyt Lock</code>{ä¸´å»ºé”}(A next-key lock is a combination of a record lock on the index record and a gap lock on the gap before the index record. )æ¥é˜²æ­¢è¿™ç§æƒ…å†µã€‚<strong>å½“æ‰§è¡Œå½“å‰è¯»æ—¶ï¼Œä¼šé”å®šè¯»å–åˆ°çš„è®°å½•çš„åŒæ—¶ï¼Œé”å®šå®ƒä»¬çš„é—´éš™ï¼Œé˜²æ­¢å…¶å®ƒäº‹åŠ¡åœ¨æŸ¥è¯¢èŒƒå›´å†…æ’å…¥æ•°æ®</strong>ã€‚åªè¦æˆ‘<strong>ä¸è®©ä½ æ’å…¥ï¼Œå°±ä¸ä¼šå‘ç”Ÿå¹»è¯»</strong></p><h3 id="mysql-é”" tabindex="-1"><a class="header-anchor" href="#mysql-é”" aria-hidden="true">#</a> MySQL é”</h3><h4 id="å…±äº«é”å’Œæ’ä»–é”" tabindex="-1"><a class="header-anchor" href="#å…±äº«é”å’Œæ’ä»–é”" aria-hidden="true">#</a> å…±äº«é”å’Œæ’ä»–é”</h4><blockquote><p>è®ºæ˜¯è¡¨çº§é”è¿˜æ˜¯è¡Œçº§é”ï¼Œéƒ½å­˜åœ¨å…±äº«é”ï¼ˆShare Lockï¼ŒS é”ï¼‰å’Œæ’ä»–é”ï¼ˆExclusive Lockï¼ŒX é”ï¼‰è¿™ä¸¤ç±»ï¼š</p><ul><li><strong>å…±äº«é”ï¼ˆS é”ï¼‰</strong> ï¼šåˆç§°è¯»é”ï¼Œäº‹åŠ¡åœ¨è¯»å–è®°å½•çš„æ—¶å€™è·å–å…±äº«é”ï¼Œå…è®¸å¤šä¸ªäº‹åŠ¡åŒæ—¶è·å–ï¼ˆé”å…¼å®¹ï¼‰ã€‚</li><li><strong>æ’ä»–é”ï¼ˆX é”ï¼‰</strong> ï¼šåˆç§°å†™é”/ç‹¬å é”ï¼Œäº‹åŠ¡åœ¨ä¿®æ”¹è®°å½•çš„æ—¶å€™è·å–æ’ä»–é”ï¼Œä¸å…è®¸å¤šä¸ªäº‹åŠ¡åŒæ—¶è·å–ã€‚å¦‚æœä¸€ä¸ªè®°å½•å·²ç»è¢«åŠ äº†æ’ä»–é”ï¼Œé‚£å…¶ä»–äº‹åŠ¡ä¸èƒ½å†å¯¹è¿™æ¡äº‹åŠ¡åŠ ä»»ä½•ç±»å‹çš„é”ï¼ˆé”ä¸å…¼å®¹ï¼‰ã€‚</li></ul><p><strong>æ’ä»–é”ä¸ä»»ä½•çš„é”éƒ½ä¸å…¼å®¹</strong>ï¼Œå…±äº«é”ä»…å’Œå…±äº«é”å…¼å®¹ã€‚</p><table><thead><tr><th style="text-align:left;">S é”</th><th style="text-align:left;">X é”</th><th></th></tr></thead><tbody><tr><td style="text-align:left;">S é”</td><td style="text-align:left;">ä¸å†²çª</td><td>å†²çª</td></tr><tr><td style="text-align:left;">X é”</td><td style="text-align:left;">å†²çª</td><td>å†²çª</td></tr></tbody></table></blockquote><p><strong>ç”±äº MVCC çš„å­˜åœ¨</strong>ï¼Œå¯¹äºä¸€èˆ¬çš„ <code>SELECT</code> è¯­å¥ï¼ŒInnoDB ä¸ä¼šåŠ ä»»ä½•é”ã€‚ä¸è¿‡ï¼Œ ä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹è¯­å¥æ˜¾å¼åŠ å…±äº«é”æˆ–æ’ä»–é”ã€‚</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment"># å…±äº«é”</span>
<span class="token keyword">SELECT</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">LOCK</span> <span class="token operator">IN</span> <span class="token keyword">SHARE</span> <span class="token keyword">MODE</span><span class="token punctuation">;</span>
<span class="token comment"># æ’ä»–é”</span>
<span class="token keyword">SELECT</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">FOR</span> <span class="token keyword">UPDATE</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="è¡¨çº§é”å’Œè¡Œçº§é”" tabindex="-1"><a class="header-anchor" href="#è¡¨çº§é”å’Œè¡Œçº§é”" aria-hidden="true">#</a> <strong>è¡¨çº§é”å’Œè¡Œçº§é”</strong></h4><blockquote><ul><li><p><strong>è¡¨çº§é”ï¼š</strong> MySQL ä¸­é”å®šç²’åº¦æœ€å¤§çš„ä¸€ç§é”ï¼ˆå…¨å±€é”é™¤å¤–ï¼‰ï¼Œæ˜¯é’ˆå¯¹éç´¢å¼•å­—æ®µåŠ çš„é”ï¼Œå¯¹å½“å‰æ“ä½œçš„æ•´å¼ è¡¨åŠ é”ï¼Œå®ç°ç®€å•ï¼Œèµ„æºæ¶ˆè€—ä¹Ÿæ¯”è¾ƒå°‘ï¼ŒåŠ é”å¿«ï¼Œä¸ä¼šå‡ºç°æ­»é”ã€‚ä¸è¿‡ï¼Œè§¦å‘é”å†²çªçš„æ¦‚ç‡æœ€é«˜ï¼Œé«˜å¹¶å‘ä¸‹æ•ˆç‡æä½ã€‚è¡¨çº§é”å’Œå­˜å‚¨å¼•æ“æ— å…³ï¼ŒMyISAM å’Œ InnoDB å¼•æ“éƒ½æ”¯æŒè¡¨çº§é”ã€‚</p></li><li><p><strong>è¡Œçº§é”ï¼š</strong> MySQL ä¸­é”å®šç²’åº¦æœ€å°çš„ä¸€ç§é”ï¼Œæ˜¯ <strong>é’ˆå¯¹ç´¢å¼•å­—æ®µåŠ çš„é”</strong> ï¼Œåªé’ˆå¯¹å½“å‰æ“ä½œçš„è¡Œè®°å½•è¿›è¡ŒåŠ é”ã€‚ è¡Œçº§é”èƒ½å¤§å¤§å‡å°‘æ•°æ®åº“æ“ä½œçš„å†²çªã€‚å…¶åŠ é”ç²’åº¦æœ€å°ï¼Œå¹¶å‘åº¦é«˜ï¼Œä½†åŠ é”çš„å¼€é”€ä¹Ÿæœ€å¤§ï¼ŒåŠ é”æ…¢ï¼Œä¼šå‡ºç°æ­»é”ã€‚è¡Œçº§é”å’Œå­˜å‚¨å¼•æ“æœ‰å…³ï¼Œæ˜¯åœ¨å­˜å‚¨å¼•æ“å±‚é¢å®ç°çš„</p><p>InnoDB è¡Œé”æ˜¯é€šè¿‡å¯¹ç´¢å¼•æ•°æ®é¡µä¸Šçš„è®°å½•åŠ é”å®ç°çš„ï¼ŒMySQL InnoDB æ”¯æŒä¸‰ç§è¡Œé”å®šæ–¹å¼ï¼š</p><ul><li><strong>è®°å½•é”ï¼ˆRecord Lockï¼‰</strong> ï¼šä¹Ÿè¢«ç§°ä¸ºè®°å½•é”ï¼Œå±äºå•ä¸ªè¡Œè®°å½•ä¸Šçš„é”ã€‚</li><li><strong>é—´éš™é”ï¼ˆGap Lockï¼‰</strong> ï¼šé”å®šä¸€ä¸ªèŒƒå›´ï¼Œä¸åŒ…æ‹¬è®°å½•æœ¬èº«ã€‚</li><li><strong>ä¸´é”®é”ï¼ˆNext-Key Lockï¼‰</strong> ï¼šRecord Lock+Gap Lockï¼Œé”å®šä¸€ä¸ªèŒƒå›´ï¼ŒåŒ…å«è®°å½•æœ¬èº«ï¼Œä¸»è¦ç›®çš„æ˜¯ä¸ºäº†è§£å†³å¹»è¯»é—®é¢˜ï¼ˆMySQL äº‹åŠ¡éƒ¨åˆ†æåˆ°è¿‡ï¼‰ã€‚è®°å½•é”åªèƒ½é”ä½å·²ç»å­˜åœ¨çš„è®°å½•ï¼Œä¸ºäº†é¿å…æ’å…¥æ–°è®°å½•ï¼Œéœ€è¦ä¾èµ–é—´éš™é”ã€‚</li></ul><p><strong>åœ¨ InnoDB é»˜è®¤çš„éš”ç¦»çº§åˆ« REPEATABLE-READ ä¸‹ï¼Œè¡Œé”é»˜è®¤ä½¿ç”¨çš„æ˜¯ Next-Key Lockã€‚ä½†æ˜¯ï¼Œå¦‚æœæ“ä½œçš„ç´¢å¼•æ˜¯å”¯ä¸€ç´¢å¼•æˆ–ä¸»é”®ï¼ŒInnoDB ä¼šå¯¹ Next-Key Lock è¿›è¡Œä¼˜åŒ–ï¼Œå°†å…¶é™çº§ä¸º Record Lockï¼Œå³ä»…é”ä½ç´¢å¼•æœ¬èº«ï¼Œè€Œä¸æ˜¯èŒƒå›´ã€‚</strong></p></li></ul></blockquote><h4 id="æ„å‘é”" tabindex="-1"><a class="header-anchor" href="#æ„å‘é”" aria-hidden="true">#</a> æ„å‘é”</h4><blockquote><p>å¦‚æœéœ€è¦<strong>ç”¨åˆ°è¡¨é”çš„è¯</strong>ï¼Œå¦‚ä½•<strong>åˆ¤æ–­è¡¨ä¸­çš„è®°å½•æœ‰æ²¡æœ‰è¡Œé”</strong>ï¼Œä¸€è¡Œä¸€è¡Œéå†è‚¯å®šæ˜¯ä¸è¡Œï¼Œæ€§èƒ½å¤ªå·®ã€‚æˆ‘ä»¬éœ€è¦ç”¨åˆ°ä¸€ä¸ªå«åšæ„å‘é”çš„ä¸œä¸œæ¥å¿«é€Ÿåˆ¤æ–­æ˜¯å¦å¯ä»¥å¯¹æŸä¸ªè¡¨ä½¿ç”¨è¡¨é”ã€‚</p><p>æ„å‘é”æ˜¯è¡¨çº§é”ï¼Œå…±æœ‰ä¸¤ç§ï¼š</p><ul><li><strong>æ„å‘å…±äº«é”ï¼ˆIntention Shared Lockï¼ŒIS é”ï¼‰</strong>ï¼šäº‹åŠ¡æœ‰æ„å‘å¯¹è¡¨ä¸­çš„æŸäº›è®°å½•åŠ å…±äº«é”ï¼ˆS é”ï¼‰ï¼ŒåŠ å…±äº«é”å‰å¿…é¡»å…ˆå–å¾—è¯¥è¡¨çš„ IS é”ã€‚</li><li><strong>æ„å‘æ’ä»–é”ï¼ˆIntention Exclusive Lockï¼ŒIX é”ï¼‰</strong>ï¼šäº‹åŠ¡æœ‰æ„å‘å¯¹è¡¨ä¸­çš„æŸäº›è®°å½•åŠ æ’ä»–é”ï¼ˆX é”ï¼‰ï¼ŒåŠ æ’ä»–é”ä¹‹å‰å¿…é¡»å…ˆå–å¾—è¯¥è¡¨çš„ IX é”ã€‚</li></ul><p><strong>æ„å‘é”æ˜¯æœ‰æ•°æ®å¼•æ“è‡ªå·±ç»´æŠ¤çš„ï¼Œç”¨æˆ·æ— æ³•æ‰‹åŠ¨æ“ä½œæ„å‘é”ï¼Œåœ¨ä¸ºæ•°æ®è¡ŒåŠ å…±äº«/æ’ä»–é”ä¹‹å‰ï¼ŒInooDB ä¼šå…ˆè·å–è¯¥æ•°æ®è¡Œæ‰€åœ¨åœ¨æ•°æ®è¡¨çš„å¯¹åº”æ„å‘é”ã€‚</strong></p><p><strong>æ„å‘é”ä¹‹é—´æ˜¯äº’ç›¸å…¼å®¹çš„ã€‚</strong></p><table><thead><tr><th></th><th>IS é”</th><th>IX é”</th></tr></thead><tbody><tr><td>IS é”</td><td>å…¼å®¹</td><td>å…¼å®¹</td></tr><tr><td>IX é”</td><td>å…¼å®¹</td><td>å…¼å®¹</td></tr></tbody></table><p><strong>æ„å‘æ’ä»–é”å’Œï¼ˆè¡¨çº§ï¼‰å…±äº«é”å’Œæ’å®ƒé”éƒ½äº’æ–¥</strong>ï¼ˆè¿™é‡ŒæŒ‡çš„æ˜¯è¡¨çº§åˆ«çš„å…±äº«é”å’Œæ’ä»–é”ï¼Œæ„å‘é”ä¸ä¼šä¸è¡Œçº§çš„å…±äº«é”å’Œæ’ä»–é”äº’æ–¥ï¼‰ã€‚</p><table><thead><tr><th></th><th>IS é”</th><th>IX é”</th></tr></thead><tbody><tr><td>S é”</td><td>å…¼å®¹</td><td>äº’æ–¥</td></tr><tr><td>X é”</td><td>äº’æ–¥</td><td>äº’æ–¥</td></tr></tbody></table></blockquote><h4 id="å½“å‰è¯»å’Œå¿«ç…§è¯»" tabindex="-1"><a class="header-anchor" href="#å½“å‰è¯»å’Œå¿«ç…§è¯»" aria-hidden="true">#</a> å½“å‰è¯»å’Œå¿«ç…§è¯»</h4><blockquote><p><strong>å¿«ç…§è¯»</strong>ï¼ˆä¸€è‡´æ€§éé”å®šè¯»ï¼‰å°±æ˜¯å•çº¯çš„ <code>SELECT</code> è¯­å¥ï¼Œä½†ä¸åŒ…æ‹¬ä¸‹é¢è¿™ä¸¤ç±» <code>SELECT</code> è¯­å¥ï¼š</p><p><strong>å¿«ç…§è¯»</strong>æ¯”è¾ƒ<strong>é€‚åˆå¯¹äºæ•°æ®ä¸€è‡´æ€§è¦æ±‚ä¸æ˜¯ç‰¹åˆ«é«˜ä¸”è¿½æ±‚æè‡´æ€§èƒ½çš„ä¸šåŠ¡åœºæ™¯</strong>ã€‚</p><p>å¿«ç…§å³è®°å½•çš„å†å²ç‰ˆæœ¬ï¼Œæ¯è¡Œè®°å½•å¯èƒ½å­˜åœ¨å¤šä¸ªå†å²ç‰ˆæœ¬ï¼ˆå¤šç‰ˆæœ¬æŠ€æœ¯ï¼‰ã€‚</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">FOR</span> <span class="token keyword">UPDATE</span>
<span class="token keyword">SELECT</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">LOCK</span> <span class="token operator">IN</span> <span class="token keyword">SHARE</span> <span class="token keyword">MODE</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>å¿«ç…§è¯»çš„æƒ…å†µä¸‹ï¼Œå¦‚æœè¯»å–çš„è®°å½•æ­£åœ¨æ‰§è¡Œ UPDATE/DELETE æ“ä½œï¼Œè¯»å–æ“ä½œä¸ä¼šå› æ­¤å»ç­‰å¾…è®°å½•ä¸Š X é”çš„é‡Šæ”¾ï¼Œè€Œæ˜¯ä¼šå»è¯»å–è¡Œçš„ä¸€ä¸ªå¿«ç…§ã€‚</p><p>åªæœ‰åœ¨äº‹åŠ¡éš”ç¦»çº§åˆ« RC(è¯»å–å·²æäº¤) å’Œ RRï¼ˆå¯é‡è¯»ï¼‰ä¸‹ï¼ŒInnoDB æ‰ä¼šä½¿ç”¨ä¸€è‡´æ€§éé”å®šè¯»ï¼š</p><ul><li>åœ¨ RC çº§åˆ«ä¸‹ï¼Œå¯¹äºå¿«ç…§æ•°æ®ï¼Œä¸€è‡´æ€§éé”å®šè¯»æ€»æ˜¯è¯»å–è¢«é”å®šè¡Œçš„æœ€æ–°ä¸€ä»½å¿«ç…§æ•°æ®ã€‚</li><li>åœ¨ RR çº§åˆ«ä¸‹ï¼Œå¯¹äºå¿«ç…§æ•°æ®ï¼Œä¸€è‡´æ€§éé”å®šè¯»æ€»æ˜¯è¯»å–æœ¬äº‹åŠ¡å¼€å§‹æ—¶çš„è¡Œæ•°æ®ç‰ˆæœ¬ã€‚</li></ul></blockquote><blockquote><p><strong>å½“å‰è¯»</strong> ï¼ˆä¸€è‡´æ€§é”å®šè¯»ï¼‰å°±æ˜¯ç»™è¡Œè®°å½•åŠ  X é”æˆ– S é”ã€‚</p><p>å½“å‰è¯»çš„ä¸€äº›å¸¸è§ SQL è¯­å¥ç±»å‹å¦‚ä¸‹ï¼š</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment"># å¯¹è¯»çš„è®°å½•åŠ ä¸€ä¸ªXé”</span>
<span class="token keyword">SELECT</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token keyword">FOR</span> <span class="token keyword">UPDATE</span>
<span class="token comment"># å¯¹è¯»çš„è®°å½•åŠ ä¸€ä¸ªSé”</span>
<span class="token keyword">SELECT</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token keyword">LOCK</span> <span class="token operator">IN</span> <span class="token keyword">SHARE</span> <span class="token keyword">MODE</span>
<span class="token comment"># å¯¹ä¿®æ”¹çš„è®°å½•åŠ ä¸€ä¸ªXé”</span>
<span class="token keyword">INSERT</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">UPDATE</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">DELETE</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></blockquote><h3 id="å­˜å‚¨å¼•æ“" tabindex="-1"><a class="header-anchor" href="#å­˜å‚¨å¼•æ“" aria-hidden="true">#</a> å­˜å‚¨å¼•æ“</h3><h4 id="innodb" tabindex="-1"><a class="header-anchor" href="#innodb" aria-hidden="true">#</a> InnoDB</h4><p>å…·å¤‡<strong>å¤–é”®</strong>æ”¯æŒåŠŸèƒ½çš„<strong>äº‹åŠ¡</strong>å­˜å‚¨å¼•æ“</p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221105151036572.png" alt="image-20221105151036572"></p><h4 id="myisam" tabindex="-1"><a class="header-anchor" href="#myisam" aria-hidden="true">#</a> MyISAM</h4><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221105151306925.png" alt="image-20221105151306925"></p><h4 id="äºŒè€…å¯¹æ¯”" tabindex="-1"><a class="header-anchor" href="#äºŒè€…å¯¹æ¯”" aria-hidden="true">#</a> äºŒè€…å¯¹æ¯”</h4><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221105151331261.png" alt="image-20221105151331261"></p><h3 id="ç´¢å¼•" tabindex="-1"><a class="header-anchor" href="#ç´¢å¼•" aria-hidden="true">#</a> ç´¢å¼•</h3><p>ç´¢å¼•æ˜¯å¸®åŠ©MySQLé«˜æ•ˆè·å–æ•°æ®çš„æ•°æ®ç»“æ„ï¼ˆ<strong>Innodbå­˜å‚¨å¼•æ“é»˜è®¤ä½¿ç”¨B+Treeç´¢å¼•ç»“æ„</strong>ï¼‰</p><p>B+æ ‘çš„é¡µï¼ˆå¤§å°é»˜è®¤ä¸º16kbï¼‰</p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221117165712218.png" alt="image-20221117165712218">ã€</p><p>B Tree æŒ‡çš„æ˜¯ Balance Treeï¼Œä¹Ÿå°±æ˜¯å¹³è¡¡æ ‘ã€‚å¹³è¡¡æ ‘æ˜¯ä¸€é¢—æŸ¥æ‰¾æ ‘ï¼Œå¹¶ä¸”æ‰€æœ‰å¶å­èŠ‚ç‚¹ä½äºåŒä¸€å±‚ã€‚</p><p>B+ Tree æ˜¯åŸºäº B Tree å’Œå¶å­èŠ‚ç‚¹é¡ºåºè®¿é—®æŒ‡é’ˆè¿›è¡Œå®ç°ï¼Œå®ƒå…·æœ‰ B Tree çš„å¹³è¡¡æ€§ï¼Œå¹¶ä¸”é€šè¿‡é¡ºåºè®¿é—®æŒ‡é’ˆæ¥æé«˜åŒºé—´æŸ¥è¯¢çš„æ€§èƒ½ã€‚</p><p>åœ¨ B+ Tree ä¸­ï¼Œä¸€ä¸ªèŠ‚ç‚¹ä¸­çš„ key ä»å·¦åˆ°å³éé€’å‡æ’åˆ—ï¼Œå¦‚æœæŸä¸ªæŒ‡é’ˆçš„å·¦å³ç›¸é‚» key åˆ†åˆ«æ˜¯ keyi å’Œ keyi+1ï¼Œä¸”ä¸ä¸º nullï¼Œåˆ™è¯¥æŒ‡é’ˆæŒ‡å‘èŠ‚ç‚¹çš„æ‰€æœ‰ key å¤§äºç­‰äº keyi ä¸”å°äºç­‰äº keyi+1ã€‚</p><p>B+Treeçš„<strong>é«˜åº¦å†³å®šIOçš„æ¬¡æ•°</strong> <strong>ä¸€æ¬¡IOä¼šè¯»å–ä¸€ä¸ªé¡µçš„æ•°æ®</strong></p><p>B+Treeçš„ç‰¹ç‚¹æ˜¯æ ‘<strong>é«˜åº¦å¾ˆä½</strong>ï¼ˆIOçš„æ¬¡æ•°å°‘ï¼‰ å¶å­èŠ‚ç‚¹å‡ºåº¦å¾ˆå¤§ï¼ˆå‚¨å­˜æ•°æ®ï¼‰</p><p>(ä¸€)<strong>æ›´å°‘çš„æŸ¥æ‰¾æ¬¡æ•°</strong></p><p>å¹³è¡¡æ ‘æŸ¥æ‰¾æ“ä½œçš„æ—¶é—´å¤æ‚åº¦ç­‰äºæ ‘é«˜ hï¼Œè€Œæ ‘é«˜å¤§è‡´ä¸º O(h)=O(logdN)ï¼Œå…¶ä¸­ d ä¸ºæ¯ä¸ªèŠ‚ç‚¹çš„å‡ºåº¦ã€‚</p><p>çº¢é»‘æ ‘çš„å‡ºåº¦ä¸º 2ï¼Œè€Œ B+ Tree çš„å‡ºåº¦ä¸€èˆ¬éƒ½éå¸¸å¤§ï¼Œæ‰€ä»¥çº¢é»‘æ ‘çš„æ ‘é«˜ h å¾ˆæ˜æ˜¾æ¯” B+ Tree å¤§éå¸¸å¤šï¼Œæ£€ç´¢çš„æ¬¡æ•°ä¹Ÿå°±æ›´å¤šã€‚</p><p>(äºŒ)<strong>åˆ©ç”¨è®¡ç®—æœºé¢„è¯»ç‰¹æ€§</strong></p><p><strong>ä¸ºäº†å‡å°‘ç£ç›˜ I/O</strong>ï¼Œ<strong>ç£ç›˜å¾€å¾€ä¸æ˜¯ä¸¥æ ¼æŒ‰éœ€è¯»å–</strong>ï¼Œè€Œæ˜¯æ¯æ¬¡éƒ½ä¼š<strong>é¢„è¯»</strong>ã€‚é¢„è¯»è¿‡ç¨‹ä¸­ï¼Œç£ç›˜è¿›è¡Œé¡ºåºè¯»å–ï¼Œ<strong>é¡ºåºè¯»å–ä¸éœ€è¦è¿›è¡Œç£ç›˜å¯»é“</strong>ï¼Œå¹¶ä¸”åªéœ€è¦å¾ˆçŸ­çš„æ—‹è½¬æ—¶é—´ï¼Œå› æ­¤é€Ÿåº¦ä¼šéå¸¸å¿«ã€‚</p><p>æ“ä½œç³»ç»Ÿä¸€èˆ¬å°†å†…å­˜å’Œç£ç›˜åˆ†å‰²æˆå›ºæ€å¤§å°çš„å—ï¼Œæ¯ä¸€å—ç§°ä¸ºä¸€é¡µï¼Œ<strong>å†…å­˜ä¸ç£ç›˜ä»¥é¡µä¸ºå•ä½äº¤æ¢æ•°æ®</strong>ã€‚æ•°æ®åº“ç³»ç»Ÿå°†<strong>ç´¢å¼•çš„ä¸€ä¸ªèŠ‚ç‚¹çš„å¤§å°è®¾ç½®ä¸ºé¡µçš„å¤§å°</strong>ï¼Œä½¿å¾—<strong>ä¸€æ¬¡ I/O å°±èƒ½å®Œå…¨è½½å…¥ä¸€ä¸ªèŠ‚ç‚¹</strong>ï¼Œå¹¶ä¸”å¯ä»¥åˆ©ç”¨é¢„è¯»ç‰¹æ€§ï¼Œç›¸é‚»çš„èŠ‚ç‚¹ä¹Ÿèƒ½å¤Ÿè¢«é¢„å…ˆè½½å…¥ã€‚</p><h4 id="ä½¿ç”¨ç´¢å¼•çš„ä¼˜ç¼ºç‚¹" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨ç´¢å¼•çš„ä¼˜ç¼ºç‚¹" aria-hidden="true">#</a> ä½¿ç”¨ç´¢å¼•çš„ä¼˜ç¼ºç‚¹</h4><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221117162845235.png" alt="image-20221117162845235"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221117163101308.png" alt="image-20221117163101308"></p><h4 id="innodbå­˜å‚¨å¼•æ“çš„ç´¢å¼•ç»“æ„" tabindex="-1"><a class="header-anchor" href="#innodbå­˜å‚¨å¼•æ“çš„ç´¢å¼•ç»“æ„" aria-hidden="true">#</a> Innodbå­˜å‚¨å¼•æ“çš„ç´¢å¼•ç»“æ„</h4><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221117170234277.png" alt="image-20221117170234277"></p><p>B+Tree</p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221117163321223.png" alt="image-20221117163321223"></p><h4 id="èšç°‡ç´¢å¼•" tabindex="-1"><a class="header-anchor" href="#èšç°‡ç´¢å¼•" aria-hidden="true">#</a> èšç°‡ç´¢å¼•</h4><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221117163934390.png" alt="image-20221117163934390"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221117164008929.png" alt="image-20221117164008929"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221117164029693.png" alt="image-20221117164029693"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221117163321223.png" alt="image-20221117163321223"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221117164107226.png" alt="image-20221117164107226"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221117164127755.png" alt="image-20221117164127755"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221117164148732.png" alt="image-20221117164148732"></p><h4 id="éèšç°‡ç´¢å¼•" tabindex="-1"><a class="header-anchor" href="#éèšç°‡ç´¢å¼•" aria-hidden="true">#</a> éèšç°‡ç´¢å¼•</h4><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221117164209647.png" alt="image-20221117164209647"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221117164522759.png" alt="image-20221117164522759"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221117164227073.png" alt="image-20221117164227073"></p><h5 id="äºŒçº§ç´¢å¼•" tabindex="-1"><a class="header-anchor" href="#äºŒçº§ç´¢å¼•" aria-hidden="true">#</a> äºŒçº§ç´¢å¼•</h5><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221117164451667.png" alt="image-20221117164451667"></p><h5 id="è”åˆç´¢å¼•" tabindex="-1"><a class="header-anchor" href="#è”åˆç´¢å¼•" aria-hidden="true">#</a> è”åˆç´¢å¼•</h5><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221117164654190.png" alt="image-20221117164654190"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221117164639245.png" alt="image-20221117164639245"></p><h5 id="å›è¡¨" tabindex="-1"><a class="header-anchor" href="#å›è¡¨" aria-hidden="true">#</a> å›è¡¨</h5><p><strong><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221117164405616.png" alt="image-20221117164405616"></strong></p><h4 id="innodbå¼•æ“ç´¢å¼•çš„æ³¨æ„äº‹é¡¹" tabindex="-1"><a class="header-anchor" href="#innodbå¼•æ“ç´¢å¼•çš„æ³¨æ„äº‹é¡¹" aria-hidden="true">#</a> Innodbå¼•æ“ç´¢å¼•çš„æ³¨æ„äº‹é¡¹</h4><h4 id="æ ¹é¡µé¢ä¸‡å¹´ä¸åŠ¨" tabindex="-1"><a class="header-anchor" href="#æ ¹é¡µé¢ä¸‡å¹´ä¸åŠ¨" aria-hidden="true">#</a> æ ¹é¡µé¢ä¸‡å¹´ä¸åŠ¨</h4><p>å½“ç´¢å¼•åˆ›å»ºçš„æ—¶å€™æ˜¯ä»æ ¹èŠ‚ç‚¹å‡ºå‘çš„</p><h4 id="å†…èŠ‚ç‚¹ä¸­ç›®å½•é¡¹è®°å½•çš„å”¯ä¸€æ€§" tabindex="-1"><a class="header-anchor" href="#å†…èŠ‚ç‚¹ä¸­ç›®å½•é¡¹è®°å½•çš„å”¯ä¸€æ€§" aria-hidden="true">#</a> å†…èŠ‚ç‚¹ä¸­ç›®å½•é¡¹è®°å½•çš„å”¯ä¸€æ€§</h4><p>éèšç°‡ç´¢å¼•ä¸­ ä¹Ÿå°±æ˜¯<strong>éä¸»é”®ç´¢å¼•ä¸­</strong> å¯èƒ½åˆ›å»ºçš„ç´¢å¼•ä¼šå‡ºç°ç›¸åŒçš„æƒ…å†µ å› æ­¤<strong>ä¸ºäº†ä¿è¯ç›®å½•é¡¹çš„å”¯ä¸€æ€§</strong> ä½¿ç”¨<strong>ä¸»é”®+é¡µå·</strong>çš„æ–¹å¼æ„æˆ</p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221117165315387.png" alt="image-20221117165315387"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221117165446585.png" alt="image-20221117165446585"></p><h4 id="ä¸€ä¸ªé¡µé¢æœ€å°‘å‚¨å­˜2æ¡è®°å½•" tabindex="-1"><a class="header-anchor" href="#ä¸€ä¸ªé¡µé¢æœ€å°‘å‚¨å­˜2æ¡è®°å½•" aria-hidden="true">#</a> ä¸€ä¸ªé¡µé¢æœ€å°‘å‚¨å­˜2æ¡è®°å½•</h4><h4 id="å“ˆå¸Œ-äºŒå‰æ ‘-avltree-b-tree-çº¢é»‘æ ‘-b-tree" tabindex="-1"><a class="header-anchor" href="#å“ˆå¸Œ-äºŒå‰æ ‘-avltree-b-tree-çº¢é»‘æ ‘-b-tree" aria-hidden="true">#</a> å“ˆå¸Œ|äºŒå‰æ ‘|AVLTree|B-Tree|çº¢é»‘æ ‘|B+Tree</h4><h5 id="å“ˆå¸Œç´¢å¼•" tabindex="-1"><a class="header-anchor" href="#å“ˆå¸Œç´¢å¼•" aria-hidden="true">#</a> å“ˆå¸Œç´¢å¼•</h5><p>å“ˆå¸Œç´¢å¼•èƒ½ä»¥ O(1) æ—¶é—´è¿›è¡ŒæŸ¥æ‰¾ï¼Œä½†æ˜¯å¤±å»äº†æœ‰åºæ€§ï¼Œå®ƒå…·æœ‰ä»¥ä¸‹é™åˆ¶:</p><ul><li><strong>æ— æ³•ç”¨äºæ’åºä¸åˆ†ç»„</strong>ï¼›</li><li>åªæ”¯æŒç²¾ç¡®æŸ¥æ‰¾ï¼Œ<strong>æ— æ³•ç”¨äºéƒ¨åˆ†æŸ¥æ‰¾å’ŒèŒƒå›´æŸ¥æ‰¾</strong>ã€‚</li></ul><p><strong>InnoDB å­˜å‚¨å¼•æ“</strong>æœ‰ä¸€ä¸ªç‰¹æ®Šçš„åŠŸèƒ½å«â€œ<strong>è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•</strong>â€ï¼Œ<strong>å½“æŸä¸ªç´¢å¼•å€¼è¢«ä½¿ç”¨çš„éå¸¸é¢‘ç¹æ—¶</strong>ï¼Œä¼š<strong>åœ¨ B+Tree ç´¢å¼•ä¹‹ä¸Šå†åˆ›å»ºä¸€ä¸ªå“ˆå¸Œç´¢å¼•</strong>ï¼Œè¿™æ ·å°±è®© B+Tree ç´¢å¼•å…·æœ‰å“ˆå¸Œç´¢å¼•çš„ä¸€äº›ä¼˜ç‚¹ï¼Œæ¯”å¦‚å¿«é€Ÿçš„å“ˆå¸ŒæŸ¥æ‰¾ã€‚</p><h5 id="äºŒå‰æ ‘" tabindex="-1"><a class="header-anchor" href="#äºŒå‰æ ‘" aria-hidden="true">#</a> äºŒå‰æ ‘</h5><p>æ ‘é«˜åº¦ä¼šè¿‡é«˜</p><p>æç«¯æƒ…å†µä¸‹ä¼šé€€åŒ–æˆé“¾è¡¨</p><h5 id="avltree" tabindex="-1"><a class="header-anchor" href="#avltree" aria-hidden="true">#</a> AVLTree</h5><p>å¹³è¡¡äºŒå‰æœç´¢æ ‘</p><p>æ ‘è¿‡é«˜</p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221117171231544.png" alt="image-20221117171231544"></p><h5 id="b-tree" tabindex="-1"><a class="header-anchor" href="#b-tree" aria-hidden="true">#</a> B-Tree</h5><p>å¶å­èŠ‚ç‚¹ä¸éå¶å­èŠ‚ç‚¹éƒ½ä¼šå­˜æ”¾æ•°æ® å½“å¯¹æ•°æ®è¿›è¡Œå¢åˆ æ“ä½œæ—¶ ä¸ºäº†ä¿è¯æ ‘çš„å¹³è¡¡æ€§ ä¼šå¯¹éå¶å­èŠ‚ç‚¹è¿›è¡Œè°ƒèŠ‚ï¼ˆæ€§èƒ½æ¶ˆè€—ï¼‰</p><p>æ’å…¥åˆ é™¤æ“ä½œè®°å½•ä¼šç ´åå¹³è¡¡æ ‘çš„å¹³è¡¡æ€§ï¼Œå› æ­¤åœ¨æ’å…¥åˆ é™¤æ“ä½œä¹‹åï¼Œ<strong>éœ€è¦å¯¹æ ‘è¿›è¡Œä¸€ä¸ªåˆ†è£‚ã€åˆå¹¶ã€æ—‹è½¬ç­‰æ“ä½œæ¥ç»´æŠ¤å¹³è¡¡æ€§</strong></p><p>ç›¸è¾ƒäºB+Treeå°†æ•°æ®å…¨éƒ¨æ”¾åœ¨å¶å­èŠ‚ç‚¹ éå¶å­èŠ‚ç‚¹ä¸å­˜æ”¾æ•°æ® å¹¶ä¸”å¯¹å¶å­èŠ‚ç‚¹è¿›è¡ŒåŒå‘é“¾è¡¨å…³è”èµ·æ¥</p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221117171630686.png" alt="image-20221117171630686"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221117171402867.png" alt="image-20221117171402867"></p><h5 id="b-tree-1" tabindex="-1"><a class="header-anchor" href="#b-tree-1" aria-hidden="true">#</a> B+Tree</h5><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221117171926475.png" alt="image-20221117171926475"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221117171848398.png" alt="image-20221117171848398"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221117172015738.png" alt="image-20221117172015738"></p><h5 id="çº¢é»‘æ ‘" tabindex="-1"><a class="header-anchor" href="#çº¢é»‘æ ‘" aria-hidden="true">#</a> çº¢é»‘æ ‘</h5><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221117172111742.png" alt="image-20221117172111742"></p><h3 id="å­˜å‚¨ç»“æ„" tabindex="-1"><a class="header-anchor" href="#å­˜å‚¨ç»“æ„" aria-hidden="true">#</a> å­˜å‚¨ç»“æ„</h3><p><a href="https://cloud.tencent.com/developer/article/1818381" target="_blank" rel="noopener noreferrer">ä¸€æ–‡ç†è§£ MySQL ä¸­çš„ page é¡µ - è…¾è®¯äº‘å¼€å‘è€…ç¤¾åŒº-è…¾è®¯äº‘ (tencent.com)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>InnoDBå­˜å‚¨å¼•æ“çš„é€»è¾‘ç»“æ„</p><p>æ‰€æœ‰æ•°æ®éƒ½è¢«é€»è¾‘åœ°å­˜æ”¾åœ¨ä¸€ä¸ªç©ºé—´å†…ï¼Œç§°ä¸º<strong>è¡¨ç©ºé—´(tablespace)</strong>ï¼Œè€Œè¡¨ç©ºé—´ç”±<strong>æ®µï¼ˆsengmentï¼‰</strong>ã€<strong>åŒºï¼ˆextentï¼‰</strong>ã€**é¡µï¼ˆpageï¼‰**ç»„æˆã€‚åœ¨ä¸€äº›æ–‡æ¡£ä¸­extendåˆç§°å—ï¼ˆblockï¼‰</p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221120143010692.png" alt="image-20221120143010692"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221120150923778.png" alt="image-20221120150923778"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221120151016776.png" alt="image-20221120151016776"></p><h4 id="é¡µç»“æ„" tabindex="-1"><a class="header-anchor" href="#é¡µç»“æ„" aria-hidden="true">#</a> é¡µç»“æ„</h4><p><a href="https://www.cnblogs.com/detectiveHLH/p/14907405.html" target="_blank" rel="noopener noreferrer">MySQL é¡µå®Œå…¨æŒ‡å—â€”â€”æµ…å…¥æ·±å‡ºé¡µçš„åŸç† - detectiveHLH - åšå®¢å›­ (cnblogs.com)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><a href="https://www.cnblogs.com/detectiveHLH/p/14907405.html" target="_blank" rel="noopener noreferrer">MySQL é¡µå®Œå…¨æŒ‡å—â€”â€”æµ…å…¥æ·±å‡ºé¡µçš„åŸç† - detectiveHLH - åšå®¢å›­ (cnblogs.com)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221120143604048.png" alt="image-20221120143604048"></p><p><strong>é¡µ</strong>æ˜¯InnoDBå­˜å‚¨å¼•æ“<strong>ç£ç›˜ç®¡ç†çš„æœ€å°å•ä½</strong>ï¼Œ<strong>æ¯ä¸ªé¡µé»˜è®¤16KB</strong>ï¼›InnoDBå­˜å‚¨å¼•æ“ä»1.2.xç‰ˆæœ¬å¼€å§‹ï¼Œå¯ä»¥é€šè¿‡å‚æ•°innodb_page_sizeå°†é¡µçš„å¤§å°è®¾ç½®ä¸º4Kã€8Kã€16Kã€‚è‹¥è®¾ç½®å®Œæˆï¼Œåˆ™æ‰€æœ‰è¡¨ä¸­é¡µçš„å¤§å°éƒ½ä¸ºinnodb_page_sizeï¼Œä¸å¯ä»¥å†æ¬¡å¯¹å…¶è¿›è¡Œä¿®æ”¹ï¼Œé™¤éé€šè¿‡mysqldumpå¯¼å…¥å’Œå¯¼å‡ºæ“ä½œæ¥äº§ç”Ÿæ–°çš„åº“ã€‚</p><p><strong>é¡µå¯¹åº”B+Treeçš„ä¸€ä¸ªå¶</strong></p><p><strong>æ¯ä¸ªé¡µä½¿ç”¨åŒå‘é“¾è¡¨è¿æ¥èµ·æ¥</strong></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221120143440603.png" alt="image-20221120143440603"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221120143652834.png" alt="image-20221120143652834"></p><p>innoDBå­˜å‚¨å¼•æ“ä¸­ï¼Œå¸¸è§çš„é¡µç±»å‹æœ‰ï¼š</p><p><strong>\1. æ•°æ®é¡µï¼ˆB-tree Node)</strong></p><p>\2. undoé¡µï¼ˆundo Log Pageï¼‰</p><p>\3. ç³»ç»Ÿé¡µ ï¼ˆSystem Pageï¼‰</p><p>\4. äº‹ç‰©æ•°æ®é¡µ ï¼ˆTransaction System Pageï¼‰</p><p>\5. æ’å…¥ç¼“å†²ä½å›¾é¡µï¼ˆInsert Buffer Bitmapï¼‰</p><p>\6. æ’å…¥ç¼“å†²ç©ºé—²åˆ—è¡¨é¡µï¼ˆInsert Buffer Free Listï¼‰</p><p>\7. æœªå‹ç¼©çš„äºŒè¿›åˆ¶å¤§å¯¹è±¡é¡µï¼ˆUncompressed BLOB Pageï¼‰</p><p>\8. å‹ç¼©çš„äºŒè¿›åˆ¶å¤§å¯¹è±¡é¡µ ï¼ˆcompressed BLOB Pageï¼‰</p><h4 id="åŒº-æ®µ-ç¢ç‰‡åŒºä¸è¡¨ç©ºé—´ç»“æ„" tabindex="-1"><a class="header-anchor" href="#åŒº-æ®µ-ç¢ç‰‡åŒºä¸è¡¨ç©ºé—´ç»“æ„" aria-hidden="true">#</a> åŒºï¼Œæ®µï¼Œç¢ç‰‡åŒºä¸è¡¨ç©ºé—´ç»“æ„</h4><h3 id="ç´¢å¼•çš„åˆ›å»ºä¸è®¾è®¡åŸåˆ™" tabindex="-1"><a class="header-anchor" href="#ç´¢å¼•çš„åˆ›å»ºä¸è®¾è®¡åŸåˆ™" aria-hidden="true">#</a> ç´¢å¼•çš„åˆ›å»ºä¸è®¾è®¡åŸåˆ™</h3><h4 id="ç´¢å¼•çš„åˆ†ç±»" tabindex="-1"><a class="header-anchor" href="#ç´¢å¼•çš„åˆ†ç±»" aria-hidden="true">#</a> ç´¢å¼•çš„åˆ†ç±»</h4><p><strong>é€»è¾‘ä¸Šåˆ’åˆ†</strong>ï¼šæ™®é€šç´¢å¼•(INDEX)ï¼Œå”¯ä¸€ç´¢å¼•(UNIQUE INDEX)ï¼Œä¸»é”®ç´¢å¼•ï¼Œå…¨æ–‡ç´¢å¼•ï¼ˆFULLTEXT INDEXï¼‰</p><p><strong>ç‰©ç†å®ç°ä¸Šåˆ’åˆ†</strong>ï¼šèšç°‡ç´¢å¼•ï¼Œéèšç°‡ç´¢å¼•</p><p><strong>ä½œç”¨å­—æ®µä¸ªæ•°åˆ’åˆ†</strong>ï¼šå•åˆ—ç´¢å¼•ï¼Œè”åˆç´¢å¼•</p><h4 id="ç´¢å¼•çš„åˆ›å»º" tabindex="-1"><a class="header-anchor" href="#ç´¢å¼•çš„åˆ›å»º" aria-hidden="true">#</a> ç´¢å¼•çš„åˆ›å»º</h4><p><strong>åˆ›å»ºè¡¨çš„æ—¶å€™</strong>æŒ‡å®šç´¢å¼•</p><p>åœ¨å£°æ˜ primary keyï¼Œ uniqueï¼Œforeign keyçš„å­—æ®µä¸Šä¼šè‡ªåŠ¨æ·»åŠ ç›¸å…³ç´¢å¼•</p><p>æœªæŒ‡å®šç´¢å¼•åç§° é»˜è®¤ä¸ºå­—æ®µå</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>CREATE TABLE Persons
(
P_Id int NOT NULL,
LastName varchar(255) NOT NULL,
FirstName varchar(255),
Address varchar(255),
City varchar(255),
UNIQUE (P_Id)
)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>å…¨æ–‡ç´¢å¼•</strong></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221120155332353.png" alt="image-20221120155332353"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221120155104741.png" alt="image-20221120155104741"></p><p><strong>ä½¿ç”¨äº†å…¨æ–‡ç´¢å¼•çš„æŸ¥è¯¢</strong></p><p>ä¸ä½¿ç”¨like &#39;%æŸ¥è¯¢çš„text%&#39;;</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>select * from papers where match(title,content) against (â€˜æŸ¥è¯¢çš„textâ€™)ï¼›
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>åˆ›å»ºè¡¨åæ·»åŠ </strong>ç´¢å¼• ALTER TABLE</p><p>ADD</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>#ALTER TABLE æ—¶çš„ SQL UNIQUE çº¦æŸ
å½“è¡¨å·²è¢«åˆ›å»ºæ—¶ï¼Œå¦‚éœ€åœ¨ &quot;P_Id&quot; åˆ—åˆ›å»º UNIQUE çº¦æŸï¼Œè¯·ä½¿ç”¨ä¸‹é¢çš„ SQLï¼š

MySQL / SQL Server / Oracle / MS Accessï¼š

ALTER TABLE Persons
ADD UNIQUE (P_Id)
å¦‚éœ€å‘½å UNIQUE çº¦æŸï¼Œå¹¶å®šä¹‰å¤šä¸ªåˆ—çš„ UNIQUE çº¦æŸï¼Œè¯·ä½¿ç”¨ä¸‹é¢çš„ SQL è¯­æ³•ï¼š

MySQL / SQL Server / Oracle / MS Accessï¼š

ALTER TABLE Persons
ADD CONSTRAINT uc_PersonID UNIQUE (P_Id,LastName)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>CREATE INDEX [indexname] ON [table (file,file,...)]</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>CREATE INDEX index_uname ON table_user (username);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="ç´¢å¼•çš„åˆ é™¤" tabindex="-1"><a class="header-anchor" href="#ç´¢å¼•çš„åˆ é™¤" aria-hidden="true">#</a> ç´¢å¼•çš„åˆ é™¤</h4><p><strong>å®æˆ˜ç»éªŒï¼šå½“éœ€è¦è¿›è¡Œå¤§é‡çš„å¢åˆ æ”¹æ“ä½œå‰å°†ç´¢å¼•åˆ é™¤æ‰ å®Œæˆå¢åˆ æ”¹æ“ä½œåå†æ·»åŠ ä¸Šç´¢å¼•ï¼ˆæ•ˆç‡ä¼˜åŒ–ï¼‰</strong></p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>åˆ é™¤ç´¢å¼•çš„è¯­æ³•
DROP INDEX [indexName] ON mytable;

ALTER TABLE [tablename] DROP INDEX [indexname];
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>AUTO_INCREMENTè‡ªå¢é•¿çš„å­—æ®µçš„UNIQUEå”¯ä¸€çº¦æŸï¼ˆç´¢å¼•ï¼‰ä¸èƒ½è¢«åˆ é™¤</strong></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221120160614653.png" alt="image-20221120160614653"></p><h4 id="mysql8-0æ”¯æŒé™åºç´¢å¼•" tabindex="-1"><a class="header-anchor" href="#mysql8-0æ”¯æŒé™åºç´¢å¼•" aria-hidden="true">#</a> MySQL8.0æ”¯æŒé™åºç´¢å¼•</h4><p>ä¹‹å‰çš„ç´¢å¼•éƒ½æ˜¯å‡åºçš„ è‹¥æˆ‘ä»¬order by å­—æ®µ desc ä½¿ç”¨é™åºæ’åºæ—¶è¦è¿›è¡Œåå‘æ‰«æ æ•ˆç‡è¾ƒä½</p><p>8.0ä¹‹åæ”¯æŒé™åºç´¢å¼• ç´¢å¼•å¯ä»¥é™åº å› æ­¤é¿å…äº†ä¸Šè¯‰åå‘æ‰«æçš„æƒ…å†µ æ•ˆç‡ä¸å—å½±å“</p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221120160838423.png" alt="image-20221120160838423"></p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>CREATE INDEX index_name_age ON table_user (username ASC,age DESC);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>create index index_name_major on table_user (username asc,major desc);

mysql&gt; show create table table_user\G;
*************************** 1. row ***************************
       Table: table_user
Create Table: CREATE TABLE `table_user` (
  `id` int NOT NULL AUTO_INCREMENT,
  `username` varchar(15) COLLATE utf8mb3_bin NOT NULL DEFAULT &#39;&#39;,
  `password` varchar(35) COLLATE utf8mb3_bin NOT NULL DEFAULT &#39;&#39;,
  `major` varchar(35) COLLATE utf8mb3_bin NOT NULL DEFAULT &#39;&#39;,
  `email` varchar(35) COLLATE utf8mb3_bin NOT NULL DEFAULT &#39;&#39;,
  PRIMARY KEY (`id`),
  KEY `index_name_major` (`username`,`major` DESC)
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb3 COLLATE=utf8mb3_bin
1 row in set (0.00 sec)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221120161632602.png" alt="image-20221120161632602"></p><h4 id="mysql8-0æ”¯æŒéšè—ç´¢å¼•" tabindex="-1"><a class="header-anchor" href="#mysql8-0æ”¯æŒéšè—ç´¢å¼•" aria-hidden="true">#</a> MySQL8.0æ”¯æŒéšè—ç´¢å¼•</h4><p>é¿å…åˆ é™¤åå‘ç°æ•°æ®å‡ºç°é”™è¯¯è¿˜è¦æŠŠç´¢å¼•å†æ·»åŠ å›æ¥çš„æƒ…å†µï¼ˆèµ„æºæ¶ˆè€—ï¼‰</p><p><strong>éšè—(invisible)ç´¢å¼•</strong>ï¼š</p><p><strong>å…ˆå°†ç´¢å¼•éšè—</strong>å®ç°<strong>ç´¢å¼•å¤±æ•ˆ</strong>çš„æ•ˆæœ <strong>å‘ç°æ•°æ®æ— é”™è¯¯</strong>å<strong>å†ç¡®å®šå°†æ‰€æœ‰è¿›è¡Œåˆ é™¤</strong></p><p><strong>å¯ä»¥ç”¨æ¥æ£€æµ‹ç´¢å¯¹å½“å‰æ•°æ®èµ·åˆ°çš„æ•ˆç‡ï¼ˆæŸ¥è¯¢æ€§èƒ½æå‡å¹…åº¦ï¼‰<strong>å¯ä»¥</strong>å°†ç´¢å¼•è®¾ç½®ä¸ºinvisibleå…ˆ</strong> å†<strong>é€šè¿‡explainè¿›è¡Œæ€§èƒ½ç›‘æ§</strong> è€Œ<strong>ä¸æ˜¯ç›´æ¥åˆ é™¤ç´¢å¼• å†åˆ›å»ºå›ç´¢å¼•</strong></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221120162740795.png" alt="image-20221120162740795"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221120163518013.png" alt="image-20221120163518013"></p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>CREATE INDEX index_uname ON table_user (username) INVISIBLE;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>CREATE TABLE Persons
(
P_Id int NOT NULL,
LastName varchar(255) NOT NULL,
FirstName varchar(255),
Address varchar(255),
City varchar(255),
UNIQUE (P_Id) INVISIBLE
)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ä¿®æ”¹ç´¢å¼•çš„å¯è§æ€§" tabindex="-1"><a class="header-anchor" href="#ä¿®æ”¹ç´¢å¼•çš„å¯è§æ€§" aria-hidden="true">#</a> ä¿®æ”¹ç´¢å¼•çš„å¯è§æ€§</h4><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>ALTER TABLE table_user ALTER INDEX [indexname] VISIBLE/INVISIBLE;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="ç´¢å¼•çš„è®¾è®¡åŸåˆ™" tabindex="-1"><a class="header-anchor" href="#ç´¢å¼•çš„è®¾è®¡åŸåˆ™" aria-hidden="true">#</a> ç´¢å¼•çš„è®¾è®¡åŸåˆ™</h4><p>ç´¢å¼•æ˜¯æŠŠåŒåˆƒå‰‘</p><p>æé«˜æŸ¥è¯¢æ•ˆç‡</p><p>åŒæ—¶å½±å“å¢åˆ æ”¹çš„æ•ˆç‡å¹¶ä¸”å ç”¨ç£ç›˜ç©ºé—´</p><h5 id="é€‚åˆåˆ›å»ºç´¢å¼•çš„æƒ…å†µ" tabindex="-1"><a class="header-anchor" href="#é€‚åˆåˆ›å»ºç´¢å¼•çš„æƒ…å†µ" aria-hidden="true">#</a> é€‚åˆåˆ›å»ºç´¢å¼•çš„æƒ…å†µ</h5><p><strong>1ï¼‰å­—æ®µçš„æ•°å€¼æœ‰å”¯ä¸€æ€§çº¦æŸ</strong></p><p><strong>2ï¼‰é¢‘ç¹ä½œä¸ºwhereæŸ¥è¯¢æ¡ä»¶çš„å­—æ®µ</strong></p><p><strong>3ï¼‰ç»å¸¸group byå’Œorder byçš„åˆ—</strong></p><div class="language-markdown line-numbers-mode" data-ext="md"><pre class="language-markdown"><code>å¦‚æœåŒæ—¶è¦ä½¿ç”¨åˆ°group by å’Œ order by å¯ä»¥è€ƒè™‘å»ºç«‹è”åˆç´¢å¼• æ³¨æ„å…ˆgroup by åorder by

ï¼ˆæ‰§è¡Œé¡ºåºæ˜¯å…ˆgroup by --&gt; order byï¼‰
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>4ï¼‰updateï¼Œdeleteå’Œwhereæ¡ä»¶åˆ—</strong></p><div class="language-markdown line-numbers-mode" data-ext="md"><pre class="language-markdown"><code>æˆ‘ä»¬éœ€è¦å…ˆæ ¹æ®whereæ¡ä»¶åˆ—æ£€ç´¢å‡ºè®°å½• ç„¶åè¿›è¡Œæ›´æ–°æˆ–åˆ é™¤æ“ä½œ

å› æ­¤åœ¨è¿›è¡Œæ›´æ–°æˆ–åˆ é™¤æ“ä½œæ—¶å¯¹whereå­—æ®µåˆ›å»ºäº†ç´¢å¼•èƒ½å¤§å¹…æé«˜æ•ˆç‡

å¯¹äºæŸ¥è¯¢è€Œè¨€ æœ‰ç´¢å¼• ä¼šæå¤§çš„æé«˜æŸ¥è¯¢çš„æ•ˆç‡ 

å¯¹äºæ›´æ–°æˆ–åˆ é™¤è€Œè¨€ æœ‰ç´¢å¼•åˆ™éœ€è¦å¯¹ç´¢å¼•è¿›è¡Œå†æ¬¡ç»´æŠ¤ ï¼ˆæ›´æ–°çš„æ˜¯éç´¢å¼•å­—æ®µåˆ™æ•ˆç‡æ›´é«˜ï¼‰
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>5ï¼‰distinctå­—æ®µéœ€è¦åˆ›å»ºç´¢å¼•</strong></p><p><strong>6ï¼‰å¤šè¡¨joinè¿æ¥æ“ä½œæ—¶</strong></p><div class="language-markdown line-numbers-mode" data-ext="md"><pre class="language-markdown"><code>è¿æ¥<span class="token bold"><span class="token punctuation">**</span><span class="token content">è¡¨çš„æ•°é‡ä¸è¦è¶…è¿‡3</span><span class="token punctuation">**</span></span> æ•°é‡çº§å‰§å¢ å½±å“æ•ˆç‡

å¯¹äº<span class="token bold"><span class="token punctuation">**</span><span class="token content">whereæ¡ä»¶åˆ›å»ºç´¢å¼•</span><span class="token punctuation">**</span></span> whereä½œä¸ºæ•°æ®çš„è¿‡æ»¤

å¯¹äº<span class="token bold"><span class="token punctuation">**</span><span class="token content">è¿æ¥çš„å­—æ®µåˆ›å»ºç´¢å¼•</span><span class="token punctuation">**</span></span> å¯¹äº<span class="token bold"><span class="token punctuation">**</span><span class="token content">è¿æ¥çš„å­—æ®µ</span><span class="token punctuation">**</span></span>å¤šå¼ è¡¨ä¸­çš„**æ•°æ®ç±»å‹å¿…é¡»ä¸€è‡´
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>7ï¼‰ä½¿ç”¨åˆ—çš„ç±»å‹å°çš„åˆ›å»ºç´¢å¼•</strong></p><div class="language-markdown line-numbers-mode" data-ext="md"><pre class="language-markdown"><code>æ•°æ®ç±»å‹è¶Šå° <span class="token bold"><span class="token punctuation">**</span><span class="token content">æŸ¥è¯¢é€Ÿåº¦è¶Šå¿«</span><span class="token punctuation">**</span></span>

æ•°æ®ç±»å‹è¶Šå° ç´¢å¼•<span class="token bold"><span class="token punctuation">**</span><span class="token content">å ç”¨çš„ç©ºé—´è¶Šå°</span><span class="token punctuation">**</span></span> <span class="token bold"><span class="token punctuation">**</span><span class="token content">æ•°æ®é¡µä¸­å¯ä»¥æ”¾ä¸‹æ›´å¤šçš„è®°å½•</span><span class="token punctuation">**</span></span> å‡å°‘I/Oå¸¦æ¥çš„æ€§èƒ½æŸè€— <span class="token bold"><span class="token punctuation">**</span><span class="token content">å¯ä»¥å°†æ›´å¤šçš„é¡µç¼“å­˜åœ¨å†…å­˜ä¸­</span><span class="token punctuation">**</span></span> åŠ å¿«è¯»å†™é€Ÿåº¦

<span class="token bold"><span class="token punctuation">**</span><span class="token content">ä¸»é”®æ•°æ®ç±»å‹å°½å¯èƒ½çš„å°</span><span class="token punctuation">**</span></span>ï¼ˆèšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•éƒ½æ˜¯ä¼šå­˜å‚¨ä¸»é”®å€¼çš„ï¼‰
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>8ï¼‰ä½¿ç”¨å­—ç¬¦ä¸²å‰ç¼€åˆ›å»ºç´¢å¼•</strong></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221207095347562.png" alt="image-20221207095347562"></p><div class="language-markdown line-numbers-mode" data-ext="md"><pre class="language-markdown"><code>å­—ç¬¦ä¸²è¶Šé•¿ å ç”¨çš„ç©ºé—´è¶Šå¤§

å­—ç¬¦ä¸²è¶Šé•¿ æ¯”è¾ƒæ—¶èŠ±è´¹çš„æ—¶é—´æ›´é•¿

ä½¿ç”¨<span class="token bold"><span class="token punctuation">**</span><span class="token content">å‰ç¼€ç´¢å¼•</span><span class="token punctuation">**</span></span>ï¼ˆæˆªå–å­—ç¬¦ä¸²å‰é¢çš„éƒ¨åˆ†ä½œä¸ºç´¢å¼•ï¼‰èŠ‚çº¦ç©ºé—´çš„åŒæ—¶ å‡å°‘å­—ç¬¦ä¸²æ¯”è¾ƒæ‰€èŠ±è´¹çš„æ—¶é—´

create table shop (address varchar(150) not null default &#39;&#39;);

alter table shop add index (address(12));

è®¡ç®—åº”å½“æˆªå–å¤šå°‘åˆé€‚
å…¬å¼ åŒºåˆ«åº¦è®¡ç®— 
count(distinct left(column,index_length)) / count(*);
æˆªå–å‰å¤šå°‘ä¸ªå­—ç¬¦çš„é€‰æ‹©åº¦è®¡ç®— è¶Šæ¥è¿‘1è¶Šå¥½
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221207095527112.png" alt="image-20221207095527112"></p><p><strong>9ï¼‰åŒºåˆ†åº¦é«˜ï¼ˆæ•£åˆ—æ€§é«˜ï¼‰çš„åˆ—é€‚åˆä½œä¸ºç´¢å¼•</strong></p><div class="language-markdown line-numbers-mode" data-ext="md"><pre class="language-markdown"><code>ä½¿ç”¨è®¡ç®—åŒºåˆ†åº¦çš„å…¬å¼ï¼šselect count(distinct column) / count(*) from table
è¶Šæ¥è¿‘1è¶Šå¥½ ä¸€èˆ¬è¶…è¿‡33%ç®—æ¯”è¾ƒé«˜æ•ˆçš„ç´¢å¼•

è”åˆç´¢å¼•è¦æŠŠåŒºåˆ†åº¦é«˜çš„ï¼ˆæ•£åˆ—æ€§é«˜çš„ï¼‰åˆ—æ”¾åœ¨å‰é¢
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>10ï¼‰ä½¿ç”¨æœ€é¢‘ç¹çš„åˆ—æ”¾åˆ°è”åˆç´¢å¼•çš„å·¦ä¾§</strong></p><p><strong>11ï¼‰åœ¨å¤šä¸ªå­—æ®µéƒ½éœ€è¦åˆ›å»ºç´¢å¼•çš„æ—¶å€™ï¼Œè”åˆç´¢å¼•ä¼˜äºå•ä¸ªå€¼ç´¢å¼•</strong></p><h5 id="é™åˆ¶ç´¢å¼•çš„æ•°ç›®" tabindex="-1"><a class="header-anchor" href="#é™åˆ¶ç´¢å¼•çš„æ•°ç›®" aria-hidden="true">#</a> é™åˆ¶ç´¢å¼•çš„æ•°ç›®</h5><p>å•è¡¨ç´¢å¼•æ•°é‡<strong>ä¸è¦è¶…è¿‡6ä¸ª</strong></p><p>1ï¼‰ç´¢å¼•ä¼š<strong>å ç”¨ç£ç›˜ç©ºé—´</strong></p><p>2ï¼‰ç´¢å¼•<strong>å½±å“insert delete update ç­‰æ“ä½œçš„æ€§èƒ½</strong> æ•°æ®åšä¿®æ”¹æ—¶ <strong>éœ€è¦å¯¹ç´¢å¼•è¿›è¡Œç»´æŠ¤</strong></p><p>3ï¼‰<strong>ä¼˜åŒ–å™¨</strong>è¿›è¡Œä¼˜åŒ–æŸ¥è¯¢æ—¶ ä½¿<strong>ç”¨ç´¢å¼•æ¥è¿›è¡Œè¯„ä¼°</strong>ä»¥ç”Ÿæˆæœ€å¥½çš„æ‰§è¡Œè®¡åˆ’ <strong>ç´¢å¼•è¿‡å¤š</strong> ä¼š<strong>å½±å“ä¼˜åŒ–å™¨çš„æ‰§è¡Œæ•ˆç‡</strong> ä»è€Œå½±å“æ•´ä¸ªæ‰§è¡Œè¿‡ç¨‹çš„æ€§èƒ½</p><h5 id="ä¸é€‚åˆåˆ›å»ºç´¢å¼•çš„æƒ…å†µ" tabindex="-1"><a class="header-anchor" href="#ä¸é€‚åˆåˆ›å»ºç´¢å¼•çš„æƒ…å†µ" aria-hidden="true">#</a> ä¸é€‚åˆåˆ›å»ºç´¢å¼•çš„æƒ…å†µ</h5><p>1ï¼‰åœ¨where group by order by ä¸­æœªä½¿ç”¨åˆ°çš„å­—æ®µ</p><p>2ï¼‰æ•°æ®é‡å°çš„è¡¨æœ€å¥½ä¸è¦åˆ›å»ºç´¢å¼•</p><p>3ï¼‰æœ‰å¤§é‡é‡å¤æ•°æ®çš„åˆ—ä¸Šä¸è¦åˆ›å»ºç´¢å¼•ï¼ˆåŒºåˆ†åº¦ä¸é«˜/æ•£åˆ—æ€§ä¸é«˜çš„åˆ—ï¼‰</p><p>4ï¼‰é¿å…å¯¹ç»å¸¸æ›´æ–°ï¼ˆå¢åˆ æ”¹ï¼‰çš„è¡¨åˆ›å»ºè¿‡å¤šçš„ç´¢å¼• æ¯æ¬¡æ›´æ–°éƒ½éœ€è¦å¯¹ç´¢å¼•è¿›è¡Œç»´æŠ¤</p><p>5ï¼‰ä¸å»ºè®®ä½¿ç”¨æ— åºçš„å€¼ä½œä¸ºç´¢å¼•</p><p>6ï¼‰åˆ é™¤ä¸å†ä½¿ç”¨æˆ–å¾ˆå°‘ä½¿ç”¨çš„ç´¢å¼•</p><p>7ï¼‰ä¸è¦å®šä¹‰å†—ä½™æˆ–è€…é‡å¤çš„ç´¢å¼• ï¼ˆè”åˆç´¢å¼•å¯ä»¥åšåˆ°å•åˆ—ç´¢å¼•çš„å·¥ä½œæ—¶ ä¸è¦å•ç‹¬å†å»ºç«‹å•åˆ—ç´¢å¼•äº†ï¼‰ï¼ˆä¸»é”®å³ä»£è¡¨äº†å”¯ä¸€ç´¢å¼• å› æ­¤ä¸è¦å†åˆ›å»ºä¸»é”®ä¸ºå”¯ä¸€ç´¢å¼•æˆ–æ™®é€šç´¢å¼•ï¼‰</p><h3 id="mysql-ç´¢å¼•å¤±æ•ˆåœºæ™¯" tabindex="-1"><a class="header-anchor" href="#mysql-ç´¢å¼•å¤±æ•ˆåœºæ™¯" aria-hidden="true">#</a> MySQL ç´¢å¼•å¤±æ•ˆåœºæ™¯</h3><h4 id="_1-è”åˆç´¢å¼•ä¸æ»¡è¶³æœ€å·¦åŒ¹é…åŸåˆ™" tabindex="-1"><a class="header-anchor" href="#_1-è”åˆç´¢å¼•ä¸æ»¡è¶³æœ€å·¦åŒ¹é…åŸåˆ™" aria-hidden="true">#</a> 1.è”åˆç´¢å¼•ä¸æ»¡è¶³æœ€å·¦åŒ¹é…åŸåˆ™</h4><h4 id="_2-ä½¿ç”¨äº†select" tabindex="-1"><a class="header-anchor" href="#_2-ä½¿ç”¨äº†select" aria-hidden="true">#</a> 2.ä½¿ç”¨äº†select *</h4><h4 id="_3-ç´¢å¼•åˆ—å‚ä¸è¿ç®—" tabindex="-1"><a class="header-anchor" href="#_3-ç´¢å¼•åˆ—å‚ä¸è¿ç®—" aria-hidden="true">#</a> 3.ç´¢å¼•åˆ—å‚ä¸è¿ç®—</h4><h4 id="_4-ç´¢å¼•åˆ—å‚ä½¿ç”¨äº†å‡½æ•°" tabindex="-1"><a class="header-anchor" href="#_4-ç´¢å¼•åˆ—å‚ä½¿ç”¨äº†å‡½æ•°" aria-hidden="true">#</a> 4.ç´¢å¼•åˆ—å‚ä½¿ç”¨äº†å‡½æ•°</h4><h4 id="_5-æ¨¡ç³ŠæŸ¥è¯¢æ—¶-likeè¯­å¥-æ¨¡ç³ŠåŒ¹é…çš„å ä½ç¬¦-ä½äºæ¡ä»¶çš„é¦–éƒ¨" tabindex="-1"><a class="header-anchor" href="#_5-æ¨¡ç³ŠæŸ¥è¯¢æ—¶-likeè¯­å¥-æ¨¡ç³ŠåŒ¹é…çš„å ä½ç¬¦-ä½äºæ¡ä»¶çš„é¦–éƒ¨" aria-hidden="true">#</a> 5.æ¨¡ç³ŠæŸ¥è¯¢æ—¶(likeè¯­å¥)ï¼Œæ¨¡ç³ŠåŒ¹é…çš„å ä½ç¬¦%ä½äºæ¡ä»¶çš„é¦–éƒ¨</h4><h4 id="_6-ç±»å‹éšå¼è½¬æ¢" tabindex="-1"><a class="header-anchor" href="#_6-ç±»å‹éšå¼è½¬æ¢" aria-hidden="true">#</a> 6.ç±»å‹éšå¼è½¬æ¢</h4><h4 id="_7-ä½¿ç”¨orå…³é”®å­—-å…¶ä¸­ä¸€ä¸ªå­—æ®µæ²¡æœ‰åˆ›å»ºç´¢å¼•-orä¸¤è¾¹ä¸º-å’Œ-èŒƒå›´æŸ¥è¯¢" tabindex="-1"><a class="header-anchor" href="#_7-ä½¿ç”¨orå…³é”®å­—-å…¶ä¸­ä¸€ä¸ªå­—æ®µæ²¡æœ‰åˆ›å»ºç´¢å¼•-orä¸¤è¾¹ä¸º-å’Œ-èŒƒå›´æŸ¥è¯¢" aria-hidden="true">#</a> 7.ä½¿ç”¨orå…³é”®å­—ï¼Œå…¶ä¸­ä¸€ä¸ªå­—æ®µæ²¡æœ‰åˆ›å»ºç´¢å¼•;orä¸¤è¾¹ä¸ºâ€œ&gt;â€å’Œâ€œ&lt;â€èŒƒå›´æŸ¥è¯¢</h4><h4 id="_8-ä¸¤åˆ—åšæ¯”è¾ƒ" tabindex="-1"><a class="header-anchor" href="#_8-ä¸¤åˆ—åšæ¯”è¾ƒ" aria-hidden="true">#</a> 8.ä¸¤åˆ—åšæ¯”è¾ƒ</h4><h4 id="_9-å½“æŸ¥è¯¢æ¡ä»¶ä¸ºå­—ç¬¦ä¸²æ—¶-ä½¿ç”¨-æˆ–-ä½œä¸ºæ¡ä»¶æŸ¥è¯¢-æœ‰å¯èƒ½ä¸èµ°ç´¢å¼•" tabindex="-1"><a class="header-anchor" href="#_9-å½“æŸ¥è¯¢æ¡ä»¶ä¸ºå­—ç¬¦ä¸²æ—¶-ä½¿ç”¨-æˆ–-ä½œä¸ºæ¡ä»¶æŸ¥è¯¢-æœ‰å¯èƒ½ä¸èµ°ç´¢å¼•" aria-hidden="true">#</a> 9.å½“æŸ¥è¯¢æ¡ä»¶ä¸ºå­—ç¬¦ä¸²æ—¶ï¼Œä½¿ç”¨â€&lt;&gt;â€œæˆ–â€!=â€œä½œä¸ºæ¡ä»¶æŸ¥è¯¢ï¼Œæœ‰å¯èƒ½ä¸èµ°ç´¢å¼•</h4><h4 id="_10-is-not-null" tabindex="-1"><a class="header-anchor" href="#_10-is-not-null" aria-hidden="true">#</a> 10.is not null</h4><h4 id="_11-ä½¿ç”¨not-inæ—¶-å­—æ®µä¸æ˜¯ä¸»é”®-ä½¿ç”¨not-existsæ—¶" tabindex="-1"><a class="header-anchor" href="#_11-ä½¿ç”¨not-inæ—¶-å­—æ®µä¸æ˜¯ä¸»é”®-ä½¿ç”¨not-existsæ—¶" aria-hidden="true">#</a> 11.ä½¿ç”¨not inæ—¶ï¼Œå­—æ®µä¸æ˜¯ä¸»é”®;ä½¿ç”¨not existsæ—¶</h4><h4 id="_12-ä½¿ç”¨order-byæ—¶-å­—æ®µä¸æ˜¯ä¸»é”®-æŸ¥è¯¢æ¡ä»¶æ¶‰åŠåˆ°order-byã€limitç­‰æ¡ä»¶æ—¶-æƒ…å†µæ¯”è¾ƒå¤æ‚-ä½¿ç”¨explain" tabindex="-1"><a class="header-anchor" href="#_12-ä½¿ç”¨order-byæ—¶-å­—æ®µä¸æ˜¯ä¸»é”®-æŸ¥è¯¢æ¡ä»¶æ¶‰åŠåˆ°order-byã€limitç­‰æ¡ä»¶æ—¶-æƒ…å†µæ¯”è¾ƒå¤æ‚-ä½¿ç”¨explain" aria-hidden="true">#</a> 12.ä½¿ç”¨order byæ—¶ï¼Œå­—æ®µä¸æ˜¯ä¸»é”®;æŸ¥è¯¢æ¡ä»¶æ¶‰åŠåˆ°order byã€limitç­‰æ¡ä»¶æ—¶ï¼Œæƒ…å†µæ¯”è¾ƒå¤æ‚ï¼ˆä½¿ç”¨explainï¼‰</h4><h4 id="_13-mysqlå‘ç°é€šè¿‡ç´¢å¼•æ‰«æçš„è¡Œè®°å½•æ•°è¶…è¿‡å…¨è¡¨çš„10-30-æ—¶-ä¼˜åŒ–å™¨å¯èƒ½ä¼šæ”¾å¼ƒèµ°ç´¢å¼•-ä½¿ç”¨explain" tabindex="-1"><a class="header-anchor" href="#_13-mysqlå‘ç°é€šè¿‡ç´¢å¼•æ‰«æçš„è¡Œè®°å½•æ•°è¶…è¿‡å…¨è¡¨çš„10-30-æ—¶-ä¼˜åŒ–å™¨å¯èƒ½ä¼šæ”¾å¼ƒèµ°ç´¢å¼•-ä½¿ç”¨explain" aria-hidden="true">#</a> 13.Mysqlå‘ç°é€šè¿‡ç´¢å¼•æ‰«æçš„è¡Œè®°å½•æ•°è¶…è¿‡å…¨è¡¨çš„10%-30%æ—¶ï¼Œä¼˜åŒ–å™¨å¯èƒ½ä¼šæ”¾å¼ƒèµ°ç´¢å¼•ï¼ˆä½¿ç”¨explainï¼‰</h4><h3 id="æ€§èƒ½åˆ†æ" tabindex="-1"><a class="header-anchor" href="#æ€§èƒ½åˆ†æ" aria-hidden="true">#</a> æ€§èƒ½åˆ†æ</h3><p>å¯¹æ•°æ®åº“è¿›è¡Œè°ƒä¼˜ï¼šç›®æ ‡æ˜¯ï¼š<strong>å“åº”æ—¶é—´å¿«ï¼Œååé‡å¤§ï¼›</strong></p><p>åˆ©ç”¨å®è§‚çš„<strong>ç›‘æ§å·¥å…·</strong>å’Œå¾®è§‚çš„<strong>æ—¥å¿—åˆ†æ</strong>å¯ä»¥å¿«é€Ÿæ‰¾åˆ°è°ƒä¼˜çš„æ€è·¯å’Œæ–¹æ³•</p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221207114919876.png" alt="image-20221207114919876"></p><h4 id="æ•°æ®åº“æœåŠ¡å™¨ä¼˜åŒ–çš„æ­¥éª¤" tabindex="-1"><a class="header-anchor" href="#æ•°æ®åº“æœåŠ¡å™¨ä¼˜åŒ–çš„æ­¥éª¤" aria-hidden="true">#</a> æ•°æ®åº“æœåŠ¡å™¨ä¼˜åŒ–çš„æ­¥éª¤</h4><p>è§‚å¯Ÿåˆ†æï¼ˆShow statusï¼‰ ä»¥åŠ è¡ŒåŠ¨ï¼ˆActionï¼‰</p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221207114840144.png" alt="image-20221207114840144"></p><h4 id="æŸ¥çœ‹ç³»ç»Ÿæ€§èƒ½å‚æ•°" tabindex="-1"><a class="header-anchor" href="#æŸ¥çœ‹ç³»ç»Ÿæ€§èƒ½å‚æ•°" aria-hidden="true">#</a> æŸ¥çœ‹ç³»ç»Ÿæ€§èƒ½å‚æ•°</h4><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221207115000574.png" alt="image-20221207115000574"></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> <span class="token keyword">status</span> <span class="token operator">like</span> <span class="token string">&#39;connections&#39;</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------------+-------+</span>
<span class="token operator">|</span> Variable_name <span class="token operator">|</span> <span class="token keyword">Value</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------+-------+</span>
<span class="token operator">|</span> Connections   <span class="token operator">|</span> <span class="token number">10</span>    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------+-------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.02</span> sec<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ç»Ÿè®¡sqlæŸ¥è¯¢æˆæœ¬-cost" tabindex="-1"><a class="header-anchor" href="#ç»Ÿè®¡sqlæŸ¥è¯¢æˆæœ¬-cost" aria-hidden="true">#</a> ç»Ÿè®¡sqlæŸ¥è¯¢æˆæœ¬ï¼ˆcostï¼‰</h4><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">show</span> <span class="token keyword">status</span> <span class="token operator">like</span> <span class="token string">&#39;last_query_cost&#39;</span><span class="token punctuation">;</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> <span class="token keyword">status</span> <span class="token operator">like</span> <span class="token string">&#39;last_query_cost&#39;</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-----------------+-----------+</span>
<span class="token operator">|</span> Variable_name   <span class="token operator">|</span> <span class="token keyword">Value</span>     <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------------+-----------+</span>
<span class="token operator">|</span> Last_query_cost <span class="token operator">|</span> <span class="token number">10.249000</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------------+-----------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>

<span class="token comment"># value ä»£è¡¨å½“å‰éœ€è¦åŠ è½½åˆ°çš„æ•°æ®é¡µé¡µæ•°</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221207120001163.png" alt="image-20221207120001163"></p><h4 id="æ…¢æŸ¥è¯¢æ—¥å¿—" tabindex="-1"><a class="header-anchor" href="#æ…¢æŸ¥è¯¢æ—¥å¿—" aria-hidden="true">#</a> æ…¢æŸ¥è¯¢æ—¥å¿—</h4><p><strong>å®šä½æ‰§è¡Œæ…¢çš„sql:</strong></p><p>ç”¨æ¥è®°å½•åœ¨MySQLä¸­å“åº”æ—¶é—´è¶…è¿‡é˜ˆå€¼ï¼ˆ<strong>long_query_time</strong>å€¼ï¼‰çš„è¯­å¥ï¼Œä¼šå°†å…¶è®°å½•åœ¨æ…¢æŸ¥è¯¢æ—¥å¿—ä¸­ã€‚</p><p><strong>long_query_time</strong>é»˜è®¤å€¼ä¸º<strong>10s</strong>ï¼ˆè¿è¡Œæ—¶é—´è¶…è¿‡10sï¼‰</p><p><strong>é»˜è®¤æƒ…å†µä¸‹ä¸å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—</strong>ï¼ˆå½±å“å¹³æ—¶è¿è¡Œæ•ˆç‡ï¼‰ï¼Œ<strong>è°ƒä¼˜æ—¶</strong>å¯ä»¥<strong>æ‰‹åŠ¨è¿›è¡Œå¼€å¯</strong></p><p>æ…¢æŸ¥è¯¢æ—¥å¿—å°†æ—¥å¿—è®°å½•å†™å…¥æ–‡ä»¶</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">#æŸ¥çœ‹æ…¢æŸ¥è¯¢å‚æ•°</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">&#39;%slow_query_log&#39;</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----------------+-------+</span>
<span class="token operator">|</span> Variable_name  <span class="token operator">|</span> <span class="token keyword">Value</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------+-------+</span>
<span class="token operator">|</span> slow_query_log <span class="token operator">|</span> <span class="token keyword">OFF</span>   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------+-------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> 

<span class="token comment">#å¼€å¯æ…¢æŸ¥è¯¢</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">set</span> <span class="token keyword">global</span> slow_query_log <span class="token operator">=</span> <span class="token keyword">on</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> 

<span class="token comment">#æŸ¥çœ‹æ…¢æŸ¥è¯¢æ—¥å¿—æ–‡ä»¶</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">&#39;%slow_query_log%&#39;</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------------------+---------------------------------------+</span>
<span class="token operator">|</span> Variable_name       <span class="token operator">|</span> <span class="token keyword">Value</span>                                 <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------------+---------------------------------------+</span>
<span class="token operator">|</span> slow_query_log      <span class="token operator">|</span> <span class="token keyword">ON</span>                                    <span class="token operator">|</span>
<span class="token operator">|</span> slow_query_log_file <span class="token operator">|</span> <span class="token operator">/</span>usr<span class="token operator">/</span><span class="token keyword">local</span><span class="token operator">/</span>mysql<span class="token operator">/</span>mysqldb<span class="token operator">/</span><span class="token number">192</span><span class="token operator">-</span>slow<span class="token punctuation">.</span>log <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------------+---------------------------------------+</span>
<span class="token number">2</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> 

<span class="token comment">#æŸ¥çœ‹æ…¢æŸ¥è¯¢é˜ˆå€¼long_query_timeï¼ˆé»˜è®¤10sï¼‰</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">&#39;%long_query_time%&#39;</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-----------------+-----------+</span>
<span class="token operator">|</span> Variable_name   <span class="token operator">|</span> <span class="token keyword">Value</span>     <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------------+-----------+</span>
<span class="token operator">|</span> long_query_time <span class="token operator">|</span> <span class="token number">10.000000</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------------+-----------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

<span class="token comment">#è®¾ç½®æ…¢æŸ¥è¯¢é˜ˆå€¼(æ³¨æ„è®¾ç½®çš„æ˜¯globalå˜é‡è¿˜æ˜¯sessionå˜é‡)</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">set</span> <span class="token keyword">global</span> long_query_time <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">&#39;%long_query_time%&#39;</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-----------------+-----------+</span>
<span class="token operator">|</span> Variable_name   <span class="token operator">|</span> <span class="token keyword">Value</span>     <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------------+-----------+</span>
<span class="token operator">|</span> long_query_time <span class="token operator">|</span> <span class="token number">10.000000</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------------+-----------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">set</span> <span class="token keyword">global</span> long_query_time <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> <span class="token keyword">global</span> variables <span class="token operator">like</span> <span class="token string">&#39;%long_query_time%&#39;</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-----------------+----------+</span>
<span class="token operator">|</span> Variable_name   <span class="token operator">|</span> <span class="token keyword">Value</span>    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------------+----------+</span>
<span class="token operator">|</span> long_query_time <span class="token operator">|</span> <span class="token number">1.000000</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------------+----------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">set</span> long_query_time <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">&#39;%long_query_time%&#39;</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-----------------+----------+</span>
<span class="token operator">|</span> Variable_name   <span class="token operator">|</span> <span class="token keyword">Value</span>    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------------+----------+</span>
<span class="token operator">|</span> long_query_time <span class="token operator">|</span> <span class="token number">1.000000</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------------+----------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ°¸ä¹…é…ç½®åˆ™éœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œé…ç½®</strong></p><p>my.cnf</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>[root@192 bin]# find / -name my.cnf
/etc/my.cnf
[root@192 bin]# 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221207141647697.png" alt="image-20221207141647697"></p><p><strong>mysqldumpslowæŸ¥çœ‹æ…¢æŸ¥è¯¢æ—¥å¿—</strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token punctuation">[</span>root<span class="token variable">@192</span> bin<span class="token punctuation">]</span><span class="token comment"># ./mysqldumpslow -s t -t 5 /usr/local/mysql/mysqldb/192-slow.log</span>
								<span class="token comment">#sort æ’åºæ–¹å¼ tæ›´åŠ æŸ¥è¯¢æ—¶é—´é™åº -t æ˜¾ç¤ºtopå¤šå°‘æ¡æ•°æ® </span>
Reading mysql slow query log <span class="token keyword">from</span> <span class="token operator">/</span>usr<span class="token operator">/</span><span class="token keyword">local</span><span class="token operator">/</span>mysql<span class="token operator">/</span>mysqldb<span class="token operator">/</span><span class="token number">192</span><span class="token operator">-</span>slow<span class="token punctuation">.</span>log
Count: <span class="token number">1</span>  <span class="token keyword">Time</span><span class="token operator">=</span><span class="token number">1.13</span>s <span class="token punctuation">(</span><span class="token number">1</span>s<span class="token punctuation">)</span>  <span class="token keyword">Lock</span><span class="token operator">=</span><span class="token number">0.00</span>s <span class="token punctuation">(</span><span class="token number">0</span>s<span class="token punctuation">)</span>  <span class="token keyword">Rows</span><span class="token operator">=</span><span class="token number">1000000.0</span> <span class="token punctuation">(</span><span class="token number">1000000</span><span class="token punctuation">)</span><span class="token punctuation">,</span> root<span class="token punctuation">[</span>root<span class="token punctuation">]</span><span class="token variable">@localhost</span>
  <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> students

Died at <span class="token punctuation">.</span><span class="token operator">/</span>mysqldumpslow line <span class="token number">162</span><span class="token punctuation">,</span> <span class="token operator">&lt;&gt;</span> chunk <span class="token number">1.</span>
<span class="token punctuation">[</span>root<span class="token variable">@192</span> bin<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>åˆ é™¤/é‡ç½®æ…¢æŸ¥è¯¢æ—¥å¿—æ–‡ä»¶</strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token punctuation">[</span>root<span class="token variable">@192</span> bin<span class="token punctuation">]</span><span class="token comment"># ./mysqladmin -u root -p flush-logs slow #é‡ç½®æ…¢æŸ¥è¯¢æ—¥å¿—æ–‡ä»¶</span>
Enter password: 
<span class="token punctuation">[</span>root<span class="token variable">@192</span> bin<span class="token punctuation">]</span><span class="token comment"># </span>

<span class="token comment">#åˆ é™¤æ…¢æŸ¥è¯¢æ—¥å¿—æ–‡ä»¶</span>
<span class="token punctuation">[</span>root<span class="token variable">@192</span> mysqldb<span class="token punctuation">]</span><span class="token comment"># rm 192-slow.log </span>
rm: remove regular <span class="token keyword">file</span> â€˜<span class="token number">192</span><span class="token operator">-</span>slow<span class="token punctuation">.</span>logâ€™? y
<span class="token punctuation">[</span>root<span class="token variable">@192</span> mysqldb<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="show-profile" tabindex="-1"><a class="header-anchor" href="#show-profile" aria-hidden="true">#</a> show profile</h4><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221207152038538.png" alt="image-20221207152038538"></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">&#39;profiling&#39;</span><span class="token punctuation">;</span><span class="token comment">#æŸ¥çœ‹profilingæ˜¯å¦å¼€å¯çŠ¶æ€ ï¼ˆé»˜è®¤æ˜¯å…³é—­çš„ï¼‰</span>
<span class="token operator">+</span><span class="token comment">---------------+-------+</span>
<span class="token operator">|</span> Variable_name <span class="token operator">|</span> <span class="token keyword">Value</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------+-------+</span>
<span class="token operator">|</span> profiling     <span class="token operator">|</span> <span class="token keyword">OFF</span>    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------+-------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">set</span> profiling <span class="token operator">=</span> <span class="token string">&#39;ON&#39;</span><span class="token punctuation">;</span><span class="token comment">#è®¾ç½®profilingä¸ºå¼€å¯</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected<span class="token punctuation">,</span> <span class="token number">1</span> warning <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> profiles<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----------+------------+---------------------------------+</span>
<span class="token operator">|</span> Query_ID <span class="token operator">|</span> Duration   <span class="token operator">|</span> Query                           <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------+------------+---------------------------------+</span>
<span class="token operator">|</span>        <span class="token number">1</span> <span class="token operator">|</span> <span class="token number">0.00173125</span> <span class="token operator">|</span> <span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">&#39;profiling&#39;</span> <span class="token operator">|</span>
<span class="token operator">|</span>        <span class="token number">2</span> <span class="token operator">|</span> <span class="token number">0.00087875</span> <span class="token operator">|</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> student           <span class="token operator">|</span>
<span class="token operator">|</span>        <span class="token number">3</span> <span class="token operator">|</span> <span class="token number">1.07819950</span> <span class="token operator">|</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> students          <span class="token operator">|</span>
<span class="token operator">|</span>        <span class="token number">4</span> <span class="token operator">|</span> <span class="token number">0.00205300</span> <span class="token operator">|</span> <span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">&#39;profiling&#39;</span> <span class="token operator">|</span>
<span class="token operator">|</span>        <span class="token number">5</span> <span class="token operator">|</span> <span class="token number">0.00016450</span> <span class="token operator">|</span> <span class="token keyword">set</span> profiling <span class="token operator">=</span> <span class="token string">&#39;ON&#39;</span>            <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------+------------+---------------------------------+</span>
<span class="token number">5</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span><span class="token punctuation">,</span> <span class="token number">1</span> warning <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> profile
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----------------+----------+</span>
<span class="token operator">|</span> <span class="token keyword">Status</span>         <span class="token operator">|</span> Duration <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------+----------+</span>
<span class="token operator">|</span> <span class="token keyword">starting</span>       <span class="token operator">|</span> <span class="token number">0.000085</span> <span class="token operator">|</span>
<span class="token operator">|</span> Opening <span class="token keyword">tables</span> <span class="token operator">|</span> <span class="token number">0.000035</span> <span class="token operator">|</span>
<span class="token operator">|</span> query <span class="token keyword">end</span>      <span class="token operator">|</span> <span class="token number">0.000010</span> <span class="token operator">|</span>
<span class="token operator">|</span> closing <span class="token keyword">tables</span> <span class="token operator">|</span> <span class="token number">0.000005</span> <span class="token operator">|</span>
<span class="token operator">|</span> freeing items  <span class="token operator">|</span> <span class="token number">0.000016</span> <span class="token operator">|</span>
<span class="token operator">|</span> cleaning up    <span class="token operator">|</span> <span class="token number">0.000014</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------+----------+</span>
<span class="token number">6</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span><span class="token punctuation">,</span> <span class="token number">1</span> warning <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> profile <span class="token keyword">for</span> query <span class="token number">3</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">--------------------------------+----------+</span>
<span class="token operator">|</span> <span class="token keyword">Status</span>                         <span class="token operator">|</span> Duration <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------------------------+----------+</span>
<span class="token operator">|</span> <span class="token keyword">starting</span>                       <span class="token operator">|</span> <span class="token number">0.000091</span> <span class="token operator">|</span>
<span class="token operator">|</span> Executing hook <span class="token keyword">on</span> <span class="token keyword">transaction</span>  <span class="token operator">|</span> <span class="token number">0.000011</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token keyword">starting</span>                       <span class="token operator">|</span> <span class="token number">0.000013</span> <span class="token operator">|</span>
<span class="token operator">|</span> checking permissions           <span class="token operator">|</span> <span class="token number">0.000010</span> <span class="token operator">|</span>
<span class="token operator">|</span> Opening <span class="token keyword">tables</span>                 <span class="token operator">|</span> <span class="token number">0.000055</span> <span class="token operator">|</span>
<span class="token operator">|</span> init                           <span class="token operator">|</span> <span class="token number">0.000014</span> <span class="token operator">|</span>
<span class="token operator">|</span> System <span class="token keyword">lock</span>                    <span class="token operator">|</span> <span class="token number">0.000017</span> <span class="token operator">|</span>
<span class="token operator">|</span> optimizing                     <span class="token operator">|</span> <span class="token number">0.000007</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token keyword">statistics</span>                     <span class="token operator">|</span> <span class="token number">0.000016</span> <span class="token operator">|</span>
<span class="token operator">|</span> preparing                      <span class="token operator">|</span> <span class="token number">0.000019</span> <span class="token operator">|</span>
<span class="token operator">|</span> executing                      <span class="token operator">|</span> <span class="token number">1.077882</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token keyword">end</span>                            <span class="token operator">|</span> <span class="token number">0.000018</span> <span class="token operator">|</span>
<span class="token operator">|</span> query <span class="token keyword">end</span>                      <span class="token operator">|</span> <span class="token number">0.000005</span> <span class="token operator">|</span>
<span class="token operator">|</span> waiting <span class="token keyword">for</span> <span class="token keyword">handler</span> <span class="token keyword">commit</span>     <span class="token operator">|</span> <span class="token number">0.000012</span> <span class="token operator">|</span>
<span class="token operator">|</span> closing <span class="token keyword">tables</span>                 <span class="token operator">|</span> <span class="token number">0.000011</span> <span class="token operator">|</span>
<span class="token operator">|</span> freeing items                  <span class="token operator">|</span> <span class="token number">0.000011</span> <span class="token operator">|</span>
<span class="token operator">|</span> cleaning up                    <span class="token operator">|</span> <span class="token number">0.000012</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------------------------+----------+</span>
<span class="token number">17</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span><span class="token punctuation">,</span> <span class="token number">1</span> warning <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> profile cpu<span class="token punctuation">,</span>block io <span class="token keyword">for</span> query <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">--------------------------------+----------+----------+------------+--------------+---------------+</span>
<span class="token operator">|</span> <span class="token keyword">Status</span>                         <span class="token operator">|</span> Duration <span class="token operator">|</span> CPU_user <span class="token operator">|</span> CPU_system <span class="token operator">|</span> Block_ops_in <span class="token operator">|</span> Block_ops_out <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------------------------+----------+----------+------------+--------------+---------------+</span>
<span class="token operator">|</span> <span class="token keyword">starting</span>                       <span class="token operator">|</span> <span class="token number">0.000091</span> <span class="token operator">|</span> <span class="token number">0.000050</span> <span class="token operator">|</span>   <span class="token number">0.000034</span> <span class="token operator">|</span>            <span class="token number">0</span> <span class="token operator">|</span>             <span class="token number">0</span> <span class="token operator">|</span>
<span class="token operator">|</span> Executing hook <span class="token keyword">on</span> <span class="token keyword">transaction</span>  <span class="token operator">|</span> <span class="token number">0.000011</span> <span class="token operator">|</span> <span class="token number">0.000005</span> <span class="token operator">|</span>   <span class="token number">0.000004</span> <span class="token operator">|</span>            <span class="token number">0</span> <span class="token operator">|</span>             <span class="token number">0</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token keyword">starting</span>                       <span class="token operator">|</span> <span class="token number">0.000013</span> <span class="token operator">|</span> <span class="token number">0.000008</span> <span class="token operator">|</span>   <span class="token number">0.000005</span> <span class="token operator">|</span>            <span class="token number">0</span> <span class="token operator">|</span>             <span class="token number">0</span> <span class="token operator">|</span>
<span class="token operator">|</span> checking permissions           <span class="token operator">|</span> <span class="token number">0.000010</span> <span class="token operator">|</span> <span class="token number">0.000006</span> <span class="token operator">|</span>   <span class="token number">0.000004</span> <span class="token operator">|</span>            <span class="token number">0</span> <span class="token operator">|</span>             <span class="token number">0</span> <span class="token operator">|</span>
<span class="token operator">|</span> Opening <span class="token keyword">tables</span>                 <span class="token operator">|</span> <span class="token number">0.000055</span> <span class="token operator">|</span> <span class="token number">0.000033</span> <span class="token operator">|</span>   <span class="token number">0.000023</span> <span class="token operator">|</span>            <span class="token number">0</span> <span class="token operator">|</span>             <span class="token number">0</span> <span class="token operator">|</span>
<span class="token operator">|</span> init                           <span class="token operator">|</span> <span class="token number">0.000014</span> <span class="token operator">|</span> <span class="token number">0.000008</span> <span class="token operator">|</span>   <span class="token number">0.000005</span> <span class="token operator">|</span>            <span class="token number">0</span> <span class="token operator">|</span>             <span class="token number">0</span> <span class="token operator">|</span>
<span class="token operator">|</span> System <span class="token keyword">lock</span>                    <span class="token operator">|</span> <span class="token number">0.000017</span> <span class="token operator">|</span> <span class="token number">0.000009</span> <span class="token operator">|</span>   <span class="token number">0.000007</span> <span class="token operator">|</span>            <span class="token number">0</span> <span class="token operator">|</span>             <span class="token number">0</span> <span class="token operator">|</span>
<span class="token operator">|</span> optimizing                     <span class="token operator">|</span> <span class="token number">0.000007</span> <span class="token operator">|</span> <span class="token number">0.000003</span> <span class="token operator">|</span>   <span class="token number">0.000002</span> <span class="token operator">|</span>            <span class="token number">0</span> <span class="token operator">|</span>             <span class="token number">0</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token keyword">statistics</span>                     <span class="token operator">|</span> <span class="token number">0.000016</span> <span class="token operator">|</span> <span class="token number">0.000010</span> <span class="token operator">|</span>   <span class="token number">0.000007</span> <span class="token operator">|</span>            <span class="token number">0</span> <span class="token operator">|</span>             <span class="token number">0</span> <span class="token operator">|</span>
<span class="token operator">|</span> preparing                      <span class="token operator">|</span> <span class="token number">0.000019</span> <span class="token operator">|</span> <span class="token number">0.000011</span> <span class="token operator">|</span>   <span class="token number">0.000007</span> <span class="token operator">|</span>            <span class="token number">0</span> <span class="token operator">|</span>             <span class="token number">0</span> <span class="token operator">|</span>
<span class="token operator">|</span> executing                      <span class="token operator">|</span> <span class="token number">1.077882</span> <span class="token operator">|</span> <span class="token number">0.831914</span> <span class="token operator">|</span>   <span class="token number">0.000000</span> <span class="token operator">|</span>            <span class="token number">0</span> <span class="token operator">|</span>             <span class="token number">0</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token keyword">end</span>                            <span class="token operator">|</span> <span class="token number">0.000018</span> <span class="token operator">|</span> <span class="token number">0.000011</span> <span class="token operator">|</span>   <span class="token number">0.000000</span> <span class="token operator">|</span>            <span class="token number">0</span> <span class="token operator">|</span>             <span class="token number">0</span> <span class="token operator">|</span>
<span class="token operator">|</span> query <span class="token keyword">end</span>                      <span class="token operator">|</span> <span class="token number">0.000005</span> <span class="token operator">|</span> <span class="token number">0.000005</span> <span class="token operator">|</span>   <span class="token number">0.000000</span> <span class="token operator">|</span>            <span class="token number">0</span> <span class="token operator">|</span>             <span class="token number">0</span> <span class="token operator">|</span>
<span class="token operator">|</span> waiting <span class="token keyword">for</span> <span class="token keyword">handler</span> <span class="token keyword">commit</span>     <span class="token operator">|</span> <span class="token number">0.000012</span> <span class="token operator">|</span> <span class="token number">0.000011</span> <span class="token operator">|</span>   <span class="token number">0.000000</span> <span class="token operator">|</span>            <span class="token number">0</span> <span class="token operator">|</span>             <span class="token number">0</span> <span class="token operator">|</span>
<span class="token operator">|</span> closing <span class="token keyword">tables</span>                 <span class="token operator">|</span> <span class="token number">0.000011</span> <span class="token operator">|</span> <span class="token number">0.000012</span> <span class="token operator">|</span>   <span class="token number">0.000000</span> <span class="token operator">|</span>            <span class="token number">0</span> <span class="token operator">|</span>             <span class="token number">0</span> <span class="token operator">|</span>
<span class="token operator">|</span> freeing items                  <span class="token operator">|</span> <span class="token number">0.000011</span> <span class="token operator">|</span> <span class="token number">0.000011</span> <span class="token operator">|</span>   <span class="token number">0.000000</span> <span class="token operator">|</span>            <span class="token number">0</span> <span class="token operator">|</span>             <span class="token number">0</span> <span class="token operator">|</span>
<span class="token operator">|</span> cleaning up                    <span class="token operator">|</span> <span class="token number">0.000012</span> <span class="token operator">|</span> <span class="token number">0.000012</span> <span class="token operator">|</span>   <span class="token number">0.000000</span> <span class="token operator">|</span>            <span class="token number">0</span> <span class="token operator">|</span>             <span class="token number">0</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------------------------+----------+----------+------------+--------------+---------------+</span>
<span class="token number">17</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span><span class="token punctuation">,</span> <span class="token number">1</span> warning <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="explainâ˜…" tabindex="-1"><a class="header-anchor" href="#explainâ˜…" aria-hidden="true">#</a> EXPLAINâ˜…</h4><p>å®šä½äº†æ‰§è¡Œæ…¢çš„æŸ¥è¯¢è¯­å¥åï¼ˆé€šè¿‡æ…¢æŸ¥è¯¢æ—¥å¿—æŸ¥çœ‹ï¼‰ï¼›ä½¿ç”¨<strong>EXPLAIN</strong>åˆ†æ/DESCRIBEFåˆ†ææŸ¥çœ‹<strong>æ‰§è¡Œè®¡åˆ’</strong>ï¼›é’ˆå¯¹æ€§çš„å¯¹sqlè¯­å¥è¿›è¡Œåˆ†æ</p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221207152547152.png" alt="image-20221207152547152"></p><p>ç›®å‰5.7ç‰ˆæœ¬ä»¥æ¥çš„EXPLAINå¯ä»¥åº”ç”¨åœ¨select ï¼Œupdate ä»¥åŠdeleteè¯­å¥</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> students<span class="token punctuation">;</span>
<span class="token keyword">explain</span> <span class="token keyword">update</span> students <span class="token keyword">set</span> <span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span> <span class="token operator">=</span> <span class="token string">&#39;eddie&#39;</span> <span class="token keyword">where</span> id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">explain</span> <span class="token keyword">delete</span> <span class="token keyword">from</span> students <span class="token keyword">where</span> id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ¶‰åŠåˆ°å‡ å¼ è¡¨å°±ä¼šæœ‰å‡ æ¡è®°å½•</strong></p><p><strong>å‰é¢çš„è¡¨</strong>ç§°ä¹‹ä¸º<strong>é©±åŠ¨è¡¨</strong> <strong>åè¾¹çš„è¡¨</strong>ç§°ä¹‹ä¸º<strong>è¢«é©±åŠ¨è¡¨</strong></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221207153656988.png" alt="image-20221207153656988"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221207153248476.png" alt="image-20221207153248476"></p><h3 id="mysqlå®šæ—¶å¢é‡-å…¨é‡å¤‡ä»½" tabindex="-1"><a class="header-anchor" href="#mysqlå®šæ—¶å¢é‡-å…¨é‡å¤‡ä»½" aria-hidden="true">#</a> MySQLå®šæ—¶å¢é‡/å…¨é‡å¤‡ä»½</h3><p><a href="https://www.cnblogs.com/haicheng92/p/10106517.html" target="_blank" rel="noopener noreferrer">MySQLå®šæ—¶å¤‡ä»½ï¼ˆå…¨é‡å¤‡ä»½+å¢é‡å¤‡ä»½ï¼‰ - åˆ˜ä¸€äºŒ - åšå®¢å›­ (cnblogs.com)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><a href="https://www.cnblogs.com/linyouyi/p/9823266.html" target="_blank" rel="noopener noreferrer">mysqlå®æ—¶å¢é‡å¤‡ä»½ - linyouyi - åšå®¢å›­ (cnblogs.com)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h3 id="mysqlä¸»ä»å¤åˆ¶è¯»å†™åˆ†ç¦»" tabindex="-1"><a class="header-anchor" href="#mysqlä¸»ä»å¤åˆ¶è¯»å†™åˆ†ç¦»" aria-hidden="true">#</a> Mysqlä¸»ä»å¤åˆ¶è¯»å†™åˆ†ç¦»</h3><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230108082244019.png" alt="image-20230108082244019"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230108082309588.png" alt="image-20230108082309588"></p><h4 id="è¯»å†™åˆ†ç¦»ä¸¤ç§ç»“æ„" tabindex="-1"><a class="header-anchor" href="#è¯»å†™åˆ†ç¦»ä¸¤ç§ç»“æ„" aria-hidden="true">#</a> è¯»å†™åˆ†ç¦»ä¸¤ç§ç»“æ„</h4><blockquote><ol><li><strong>å®¢æˆ·ç«¯ç›´è¿æ–¹æ¡ˆ</strong>ï¼Œå› ä¸ºå°‘äº†ä¸€å±‚proxyè½¬å‘ï¼Œæ‰€ä»¥æŸ¥è¯¢æ€§èƒ½ç¨å¾®å¥½ä¸€ç‚¹å„¿ï¼Œå¹¶ä¸”æ•´ä½“æ¶æ„ç®€å•ï¼Œæ’æŸ¥é—®é¢˜æ›´æ–¹ä¾¿ã€‚ä½†æ˜¯è¿™ç§æ–¹æ¡ˆï¼Œç”±äºè¦äº†è§£åç«¯éƒ¨ç½²ç»†èŠ‚ï¼Œæ‰€ä»¥åœ¨å‡ºç°ä¸»å¤‡åˆ‡æ¢ã€åº“è¿ç§»ç­‰æ“ä½œçš„æ—¶å€™ï¼Œå®¢æˆ·ç«¯éƒ½ä¼šæ„ŸçŸ¥åˆ°ï¼Œå¹¶ä¸”éœ€è¦è°ƒæ•´æ•°æ®åº“è¿æ¥ä¿¡æ¯ã€‚ ä½ å¯èƒ½ä¼šè§‰å¾—è¿™æ ·å®¢æˆ·ç«¯ä¹Ÿå¤ªéº»çƒ¦äº†ï¼Œä¿¡æ¯å¤§é‡å†—ä½™ï¼Œæ¶æ„å¾ˆä¸‘ã€‚å…¶å®ä¹Ÿæœªå¿…ï¼Œä¸€èˆ¬é‡‡ç”¨è¿™æ ·çš„æ¶æ„ï¼Œä¸€å®šä¼šä¼´éšä¸€ä¸ªè´Ÿè´£ç®¡ç†åç«¯çš„ç»„ä»¶ï¼Œæ¯”å¦‚Zookeeperï¼Œå°½é‡è®©ä¸šåŠ¡ç«¯åªä¸“æ³¨äºä¸šåŠ¡é€»è¾‘å¼€å‘ã€‚</li><li><strong>å¸¦proxyçš„æ¶æ„</strong>ï¼Œå¯¹å®¢æˆ·ç«¯æ¯”è¾ƒå‹å¥½ã€‚å®¢æˆ·ç«¯ä¸éœ€è¦å…³æ³¨åç«¯ç»†èŠ‚ï¼Œè¿æ¥ç»´æŠ¤ã€åç«¯ä¿¡æ¯ç»´æŠ¤ç­‰å·¥ä½œï¼Œéƒ½æ˜¯ç”±proxyå®Œæˆçš„ã€‚ä½†è¿™æ ·çš„è¯ï¼Œå¯¹åç«¯ç»´æŠ¤å›¢é˜Ÿçš„è¦æ±‚ä¼šæ›´é«˜ã€‚è€Œä¸”ï¼Œproxyä¹Ÿéœ€è¦æœ‰é«˜å¯ç”¨æ¶æ„ã€‚å› æ­¤ï¼Œå¸¦proxyæ¶æ„çš„æ•´ä½“å°±ç›¸å¯¹æ¯”è¾ƒå¤æ‚ã€‚ <ol><li>ä¸­é—´ä»¶æœ‰ï¼š<strong>MySQL Router</strong>ï¼ˆå®˜æ–¹ï¼‰ã€<strong>Atlas</strong>ï¼ˆåŸºäº MySQL Proxyï¼‰ã€<strong>MaxScale</strong>ã€<strong>MyCat</strong>ã€‚</li><li>ç»„ä»¶æ–¹å¼ï¼šè¿™ä¹Ÿæ˜¯æˆ‘æ¯”è¾ƒæ¨èçš„ä¸€ç§æ–¹å¼ã€‚è¿™ç§æ–¹å¼ç›®å‰åœ¨å„ç§äº’è”ç½‘å…¬å¸ä¸­ç”¨çš„æœ€å¤šçš„ï¼Œç›¸å…³çš„å®é™…çš„æ¡ˆä¾‹ä¹Ÿéå¸¸å¤šã€‚å¦‚æœä½ è¦é‡‡ç”¨è¿™ç§æ–¹å¼çš„è¯ï¼Œæ¨èä½¿ç”¨ <code>sharding-jdbc</code> ï¼Œç›´æ¥å¼•å…¥ jar åŒ…å³å¯ä½¿ç”¨ï¼Œéå¸¸æ–¹ä¾¿ã€‚åŒæ—¶ï¼Œä¹ŸèŠ‚çœäº†å¾ˆå¤šè¿ç»´çš„æˆæœ¬ã€‚</li></ol></li></ol></blockquote><h5 id="å®¢æˆ·ç«¯ç›´è¿-ä¸»åŠ¨åšè´Ÿè½½å‡è¡¡" tabindex="-1"><a class="header-anchor" href="#å®¢æˆ·ç«¯ç›´è¿-ä¸»åŠ¨åšè´Ÿè½½å‡è¡¡" aria-hidden="true">#</a> å®¢æˆ·ç«¯ç›´è¿ ä¸»åŠ¨åšè´Ÿè½½å‡è¡¡</h5><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230714115414022.png" alt="image-20230714115414022"></p><h5 id="å¸¦proxyçš„æ¶æ„" tabindex="-1"><a class="header-anchor" href="#å¸¦proxyçš„æ¶æ„" aria-hidden="true">#</a> å¸¦proxyçš„æ¶æ„</h5><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230714115422443.png" alt="image-20230714115422443"></p><h4 id="ä¸»ä»å¤åˆ¶åŸç†" tabindex="-1"><a class="header-anchor" href="#ä¸»ä»å¤åˆ¶åŸç†" aria-hidden="true">#</a> ä¸»ä»å¤åˆ¶åŸç†</h4><p><a href="https://www.toptal.com/mysql/mysql-master-slave-replication-tutorial" target="_blank" rel="noopener noreferrer">ã€ŠMySQL Master-Slave Replication on the Same Machineã€‹open in new window<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ï¼‰</p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230108082403130.png" alt="image-20230108082403130"></p><p>MySQL binlog(<strong>binary log å³äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶</strong>) ä¸»è¦è®°å½•äº† MySQL æ•°æ®åº“ä¸­æ•°æ®çš„æ‰€æœ‰å˜åŒ–(æ•°æ®åº“æ‰§è¡Œçš„æ‰€æœ‰ DDL å’Œ DML è¯­å¥)ã€‚å› æ­¤ï¼Œæˆ‘ä»¬æ ¹æ®ä¸»åº“çš„ MySQL binlog æ—¥å¿—å°±èƒ½å¤Ÿå°†ä¸»åº“çš„æ•°æ®åŒæ­¥åˆ°ä»åº“ä¸­ã€‚</p><ol><li><p>ä¸»åº“å°†æ•°æ®åº“ä¸­æ•°æ®çš„å˜åŒ–å†™å…¥åˆ° binlog</p></li><li><p>ä»åº“è¿æ¥ä¸»åº“</p></li><li><p>ä»åº“ä¼šåˆ›å»ºä¸€ä¸ª I/O çº¿ç¨‹å‘ä¸»åº“è¯·æ±‚æ›´æ–°çš„ binlog</p></li><li><p>ä¸»åº“ä¼šåˆ›å»ºä¸€ä¸ª binlog dump çº¿ç¨‹æ¥å‘é€ binlog ï¼Œä»åº“ä¸­çš„ I/O çº¿ç¨‹è´Ÿè´£æ¥æ”¶</p></li><li><p>ä»åº“çš„ I/O çº¿ç¨‹å°†æ¥æ”¶çš„ binlog å†™å…¥åˆ° relay log ä¸­ã€‚</p></li><li><p>ä»åº“çš„ SQL çº¿ç¨‹è¯»å– relay log åŒæ­¥æ•°æ®æœ¬åœ°ï¼ˆä¹Ÿå°±æ˜¯å†æ‰§è¡Œä¸€é SQL ï¼‰ã€‚</p></li></ol><h4 id="gtid-1" tabindex="-1"><a class="header-anchor" href="#gtid-1" aria-hidden="true">#</a> GTID</h4><blockquote><p>GTID (Global Transaction ID)æ˜¯å…¨å±€äº‹åŠ¡ID,ç”±ä¸»åº“ä¸Šç”Ÿæˆçš„ä¸äº‹åŠ¡ç»‘å®šçš„å”¯ä¸€æ ‡è¯†ï¼Œè¿™ä¸ªæ ‡è¯†ä¸ä»…åœ¨ä¸»åº“ä¸Šæ˜¯å”¯ä¸€çš„ï¼Œåœ¨MySQLé›†ç¾¤å†…ä¹Ÿæ˜¯å”¯ä¸€çš„ã€‚</p><p>æ ¼å¼ï¼šGTID = server_uuid:transaction_id</p><p>sample:3E11FA47-71CA-11E1-9E33-C80AA9429562:1</p></blockquote><blockquote><p>ä½¿ç”¨åœºæ™¯</p><ul><li>åœ¨ä¸»ä»å¤åˆ¶ä¸­ï¼šå°¤å…¶æ˜¯åŠåŒæ­¥å¤åˆ¶ä¸­ï¼Œ ç”±äºMaster çš„dumpè¿›ç¨‹ä¸€è¾¹è¦å‘é€binlogç»™Slaveï¼Œä¸€è¾¹è¦ç­‰å¾…Slaveçš„ACKæ¶ˆæ¯ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯ä¸²è¡Œçš„ï¼Œå³å‰ä¸€ä¸ªäº‹ç‰©çš„ACKæ²¡æœ‰æ”¶åˆ°æ¶ˆæ¯ï¼Œé‚£ä¹ˆåä¸€ä¸ªäº‹ç‰©åªèƒ½æ’é˜Ÿå€™ç€ï¼› è¿™æ ·å°†ä¼šæå¤§åœ°å½±å“æ€§èƒ½ï¼›æœ‰äº†GTIDåï¼ŒSLAVEå°±ç›´æ¥å¯ä»¥é€šè¿‡æ•°æ®æµè·å¾—GTIDä¿¡æ¯ï¼Œè€Œä¸”å¯ä»¥åŒæ­¥ï¼›</li><li>ä¸»ä»æ•…éšœåˆ‡æ¢ä¸­ï¼šå¦‚æœä¸€å°MASTER downï¼Œéœ€è¦æå–æ‹¥æœ‰æœ€æ–°æ—¥å¿—çš„SLAVEåšMASTERï¼Œè¿™ä¸ªæ˜¯å¾ˆå¥½åˆ¤æ–­ï¼Œè€Œæœ‰äº†GTIDï¼Œå°±åªè¦ä»¥GTIDä¸ºå‡†å³å¯æ–¹ä¾¿åˆ¤æ–­ï¼›è€Œæœ‰äº†GTIDåï¼ŒSLAVEå°±ä¸éœ€è¦ä¸€ç›´ä¿å­˜è¿™bin-log çš„æ–‡ä»¶åå’ŒPositionäº†ï¼›åªè¦å¯ç”¨MASTER_AUTO_POSITIONå³å¯ã€‚</li><li>å½“MASTER crashçš„æ—¶å€™ï¼ŒGTIDæœ‰åŠ©äºä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼Œå› ä¸ºæ¯ä¸ªäº‹ç‰©éƒ½å¯¹åº”å”¯ä¸€GTIDï¼Œå¦‚æœåœ¨æ¢å¤çš„æ—¶å€™æŸäº‹ç‰©è¢«é‡å¤æäº¤ï¼ŒSLAVEä¼šç›´æ¥å¿½ç•¥ï¼›</li></ul></blockquote><h4 id="è¯»å†™åˆ†ç¦»ä¸»å¤‡æ•°æ®ä¸€è‡´" tabindex="-1"><a class="header-anchor" href="#è¯»å†™åˆ†ç¦»ä¸»å¤‡æ•°æ®ä¸€è‡´" aria-hidden="true">#</a> è¯»å†™åˆ†ç¦»ä¸»å¤‡æ•°æ®ä¸€è‡´</h4><p><a href="https://funnylog.gitee.io/mysql45/28%E8%AE%B2%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB%E6%9C%89%E5%93%AA%E4%BA%9B%E5%9D%91.html" target="_blank" rel="noopener noreferrer">funnylog.gitee.io/mysql45/28è®²è¯»å†™åˆ†ç¦»æœ‰å“ªäº›å‘.html<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><blockquote><ul><li>å¼ºåˆ¶èµ°ä¸»åº“æ–¹æ¡ˆï¼›</li><li>sleepæ–¹æ¡ˆï¼›</li><li>åˆ¤æ–­ä¸»å¤‡æ— å»¶è¿Ÿæ–¹æ¡ˆï¼›</li><li>é…åˆsemi-syncæ–¹æ¡ˆï¼›</li><li>ç­‰ä¸»åº“ä½ç‚¹æ–¹æ¡ˆï¼›</li><li>ç­‰GTIDæ–¹æ¡ˆã€‚</li></ul></blockquote><h4 id="ä¸»ä»æ•°æ®åº“ç¯å¢ƒæ­å»º" tabindex="-1"><a class="header-anchor" href="#ä¸»ä»æ•°æ®åº“ç¯å¢ƒæ­å»º" aria-hidden="true">#</a> ä¸»ä»æ•°æ®åº“ç¯å¢ƒæ­å»º</h4><p><strong>1ï¼‰å‡†å¤‡ä¸¤å°LinuxæœåŠ¡å™¨ åˆ†åˆ«å®‰è£…Mysql æ­å»ºä¸€ä¸»ä¸€ä»</strong></p><p>tip:è‹¥æ˜¯cloneçš„LinuxæœåŠ¡å™¨ è®°å¾—å°†å…¶ä¸­ä¸€ä¸ªçš„MySQLçš„UUID è¿›è¡Œä¿®æ”¹</p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230108093125043.png" alt="image-20230108093125043"></p><p><strong>2ï¼‰åˆ†åˆ«é…ç½®ä¸¤ä¸ªMySQLçš„my.cnfï¼ˆMySQLçš„é…ç½®æ–‡ä»¶ï¼‰</strong></p><p>é…ç½®æ–‡ä»¶ä¿®æ”¹åé‡å¯MySQLæœåŠ¡</p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230108094024340.png" alt="image-20230108094024340"></p><p><strong>ä»æœåŠ¡å™¨æ›´å®Œæ•´çš„é…ç½®</strong></p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>## è®¾ç½®server_id,æ³¨æ„è¦å”¯ä¸€
server-id=101  
## å¼€å¯äºŒè¿›åˆ¶æ—¥å¿—åŠŸèƒ½å¹¶æŒ‡å®šå‰ç¼€ï¼Œä»¥å¤‡Slaveä½œä¸ºå…¶å®ƒSlaveçš„Masteræ—¶ä½¿ç”¨
log-bin=slave-bin   
## relay_logé…ç½®ä¸­ç»§æ—¥å¿—
relay_log=/var/lib/mysql/relay.log  
read_only=1  ## è®¾ç½®ä¸ºåªè¯»,è¯¥é¡¹å¦‚æœä¸è®¾ç½®ï¼Œè¡¨ç¤ºslaveå¯è¯»å¯å†™
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>3ï¼‰é…ç½®å¹¶å¼€å¯ä¸»ä»å¤åˆ¶</strong></p><p>master</p><p>åœ¨Masteræ•°æ®åº“åˆ›å»ºæ•°æ®åŒæ­¥ç”¨æˆ·ï¼Œæˆäºˆç”¨æˆ· slave REPLICATION SLAVEæƒé™å’ŒREPLICATION CLIENTæƒé™ï¼Œç”¨äºåœ¨ä¸»ä»åº“ä¹‹é—´åŒæ­¥æ•°æ®ã€‚</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>CREATE USER &#39;slave&#39;@&#39;%&#39; IDENTIFIED WITH mysql_native_password BY &#39;slave&#39;;
GRANT REPLICATION SLAVE, REPLICATION CLIENT ON *.* TO &#39;slave&#39;@&#39;%&#39;;

show master status;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>slave</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>change master to master_host=&#39;192.168.199.181&#39;,
 master_user=&#39;slave&#39;, 
 master_password=&#39;slave&#39;, 
 master_port=3306, 
 master_log_file=&#39;mysql-bin.000003&#39;, 
 master_log_pos=1239, 
 master_connect_retry=30;
 
 
 start slave;
 stop slave;
 
 show slave status;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230108095447271.png" alt="image-20230108095447271"></p><p><strong>4ï¼‰æŸ¥çœ‹ä¸»ä»çŠ¶æ€</strong></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230108095705696.png" alt="image-20230108095705696"></p><p><strong>5ï¼‰å½»åº•è§£é™¤ä¸»ä»å¤åˆ¶å…³ç³»</strong></p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>stop slave;
reset slave; # æˆ–ç›´æ¥åˆ é™¤master.infoå’Œrelay-log.infoè¿™ä¸¤ä¸ªæ–‡ä»¶ï¼›
# ä¿®æ”¹my.cnfåˆ é™¤ä¸»ä»ç›¸å…³é…ç½®å‚æ•°ã€‚
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="åŸºäºgtidæ­å»ºä¸»ä»mysql" tabindex="-1"><a class="header-anchor" href="#åŸºäºgtidæ­å»ºä¸»ä»mysql" aria-hidden="true">#</a> åŸºäºgtidæ­å»ºä¸»ä»MySQL</h4><p><a href="https://www.cnblogs.com/ZhuChangwu/p/13040214.html" target="_blank" rel="noopener noreferrer">åŸºäºGTIDæ­å»ºä¸»ä»MySQL - èµæˆ‘ç™½æ—¥æ¢¦ - åšå®¢å›­ (cnblogs.com)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>æƒ³è®©ä¸»ä»ä¹‹é—´ä½¿ç”¨gtidçš„æ–¹å¼åŒæ­¥æ•°æ®ï¼Œéœ€è¦æˆ‘ä»¬åœ¨é…ç½®æ–‡ä»¶ä¸­å¼€å¯mysqlå¯¹gtidç›¸å…³çš„é…ç½®ä¿¡æ¯</p><p>æ‰¾åˆ°my.cnf ï¼Œåœ¨mysqldæ¨¡å—ä¸­åŠ å…¥å¦‚ä¸‹çš„é…ç½®ã€‚ï¼ˆä¸»åº“ä»åº“éƒ½è¿™æ ·ï¼‰</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>mysqld<span class="token punctuation">]</span>
<span class="token comment"># onè¡¨ç¤ºå¼€å¯ï¼ŒOFFè¡¨ç¤ºå…³é—­</span>
gtid-mode <span class="token operator">=</span> ON
<span class="token comment"># ä¸‹é¢çš„ä¸¤ä¸ªå˜é‡å¿…é¡»å¼€å¯ï¼Œå¦åˆ™MySQLæ‹’ç»å¯åŠ¨</span>
<span class="token comment"># é€šå¸¸æƒ…å†µï¼Œä»æœåŠ¡å™¨ä»ä¸»æœåŠ¡å™¨æ¥æ”¶åˆ°çš„æ›´æ–°ä¸è®°å…¥å®ƒçš„äºŒè¿›åˆ¶æ—¥å¿—ã€‚è¯¥é€‰é¡¹å‘Šè¯‰ä»æœåŠ¡å™¨å°†å…¶SQLçº¿ç¨‹æ‰§è¡Œçš„æ›´æ–°è®°å…¥åˆ°ä»æœåŠ¡å™¨è‡ªå·±çš„äºŒè¿›åˆ¶æ—¥å¿—</span>
log-slave-updates <span class="token operator">=</span> <span class="token number">1</span>
log-bin <span class="token operator">=</span> MySQL-bin
<span class="token comment"># å¿…é¡»å¼€å¯ï¼Œå¦åˆ™MySQLä¸å¯åŠ¨ï¼Œå› ä¸ºMySQLçš„SQLå’Œgtid</span>
<span class="token comment"># è®¸å¤šMySQLçš„SQLå’ŒGTIDæ˜¯ä¸å…¼å®¹çš„ã€‚æ¯”å¦‚å¼€å¯ROW æ ¼å¼æ—¶ï¼ŒCREATE TABLE â€¦ SELECT</span>
<span class="token comment"># åœ¨binlogä¸­ä¼šå½¢æˆ2ä¸ªä¸åŒçš„äº‹åŠ¡ï¼ŒGTIDæ— æ³•å”¯ä¸€ã€‚</span>
<span class="token comment"># å¦å¤–åœ¨äº‹åŠ¡ä¸­æ›´æ–°MyISAMè¡¨ä¹Ÿæ˜¯ä¸å…è®¸çš„ã€‚</span>
enforce_gtid_consistency <span class="token operator">=</span> <span class="token number">1</span>  <span class="token comment">#</span>
log-bin-index <span class="token operator">=</span> MySQL-bin.index
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯¹ä¸»åº“æ¥è¯´ä¾ç„¶éœ€è¦åˆ›å»ºä¸€ä¸ªç”¨äºåŒæ­¥æ•°æ®çš„è´¦å·</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>CREATE <span class="token environment constant">USER</span> <span class="token string">&#39;slave&#39;</span>@<span class="token string">&#39;%&#39;</span> IDENTIFIED WITH mysql_native_password BY <span class="token string">&#39;slave&#39;</span><span class="token punctuation">;</span>
GRANT REPLICATION SLAVE, REPLICATION CLIENT ON *.* TO <span class="token string">&#39;slave&#39;</span>@<span class="token string">&#39;%&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯¹ä»åº“ä¸­æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼šå³å¯å®Œæˆä¸»ä»åŒæ­¥</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>CHANGE MASTER TO
    MASTER_HOST=&#39;127.0.0.1&#39;,
    MASTER_USER=&#39;slave&#39;,
    MASTER_PASSWORD=&#39;slave&#39;,
    MASTER_PORT=3306,
    MASTER_AUTO_POSITION = 1;
    
    
start slave;
stop slave;
 
show slave status;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ç§è‡ªåŠ¨æ‰¾ç‚¹å¯¹æ–¹å¼ï¼Œç›¸å¯¹äºä¹‹å‰ä½¿ç”¨bin-log+positionæ‰¾ç‚¹å°±æ˜¾å¾—æå…¶æ–¹ä¾¿äº†ã€‚</p><p>çœå»äº†æ‰‹åŠ¨æŸ¥çœ‹masteræ‰§è¡Œåˆ°é‚£ä¸ªbinlogï¼Œä»¥åŠbinlogçš„positionã€‚</p><blockquote><p>åšäº†å¦‚ä¸Šçš„é…ç½®åï¼Œè¿˜æ˜¯å¯ä»¥ç»§ç»­ä½¿ç”¨fileNameå’Œpositionæ‰¾ç‚¹ï¼Œä½†æ˜¯ä¸æ¨èè¿™æ ·åšäº†ï¼Œå¦‚æœéè¦è¿™æ ·åšï¼Œè®¾ç½®MASTER-AUTO-POSITION=0</p></blockquote><p>å‡è®¾æˆ‘ä»¬æƒ³åœ¨ç°æœ‰çš„ä¸»ä»é›†ç¾¤ä¸Šæ–°åŠ ä¸€ä¸ªä»åº“ï¼Œå¦‚æœè¿™ä¸ªä¸»åº“å·²ç»è¿è¡Œå¾ˆä¹…äº†ï¼Œbinlogè‚¯å®šæ›¾ç»è¢«purgeè¿‡ï¼Œæ‰€ä»¥å¦‚æœä¸»åº“ä¸­åŸæ¥çš„æ•°æ®ä¸é‡è¦</p><p><strong>ä¸ä»‹æ„</strong>ä¸»ä»æ•°æ®ä¸ä¸€è‡´ï¼Œåœ¨ä»åº“ä¸­æ‰§è¡Œï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>reset master<span class="token punctuation">;</span> 

<span class="token comment"># ç¼ºå¤±çš„GTIDé›†åˆè®¾ç½®ä¸ºpurged ï¼Œæ‰§è¡Œè¿™ä¸ªå‘½ä»¤è¯·ç¡®ä¿ä»åº“ï¼š@@global.gtid_executedä¸ºç©º</span>
<span class="token builtin class-name">set</span> global gtid_purged <span class="token operator">=</span> â€˜ä¸»åº“ä¸­æ›¾ç»purgeè¿‡çš„gtidè®°å½•â€™

<span class="token comment"># ç„¶åé€šè¿‡MASTER_AUTO_POSITION=1å®Œæˆè‡ªåŠ¨æ‰¾ç‚¹</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ä»‹æ„</strong>ä¸»ä»æ•°æ®å¼ºä¸€è‡´å¯ä»¥è€ƒè™‘ä½¿ç”¨å¯ä»¥çƒ­å¤‡ä»½çš„å·¥å…·ä»ä¸»åº“æ‹·è´æ•°æ®åˆ°ä»åº“ï¼Œå®Œæˆæ•°æ®çš„åŒæ­¥å†åœ¨ä»åº“æ‰§è¡Œå¦‚ä¸Šset global gtid_purged = &#39;xxx&#39;</p><blockquote><p>çƒ­å¤‡ä»½å·¥å…·å¦‚ï¼šxtrabackup , å®ƒå¯ä»¥æ‹·è´ç‰©ç†æ–‡ä»¶å’Œredologæ¥æ”¯æŒçƒ­å¤‡ä»½</p></blockquote><h4 id="sharding-jdbc" tabindex="-1"><a class="header-anchor" href="#sharding-jdbc" aria-hidden="true">#</a> Sharding-JDBC</h4><p>1ï¼‰å¼•å…¥mavenåæ ‡</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token comment">&lt;!--TODO sharding-jdbcæ•´åˆspringbootæ¡†æ¶ å®ç°mysql ä¸»ä»å¤åˆ¶ è¯»å†™åˆ†ç¦»--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.inurl.shardingsphere<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>sharding-jdbc-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.1.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2ï¼‰é…ç½®yml</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> reggie_takeout
  <span class="token comment"># TODO é…ç½®ShardingSphere å®ç°MySQLä¸»ä»å¤åˆ¶</span>
  <span class="token key atrule">shardingsphere</span><span class="token punctuation">:</span>
    <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
      <span class="token key atrule">names</span><span class="token punctuation">:</span> master<span class="token punctuation">,</span>slave
      <span class="token comment"># ä¸»æ•°æ®æº</span>
      <span class="token key atrule">master</span><span class="token punctuation">:</span>
        <span class="token key atrule">type</span><span class="token punctuation">:</span> com.alibaba.druid.pool.DruidDataSource
        <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
        <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//192.168.199.181<span class="token punctuation">:</span>3306/reggie<span class="token punctuation">?</span>serverTimezone=Asia/Shanghai<span class="token important">&amp;useUnicode=true&amp;characterEncoding=utf-8&amp;zeroDateTimeBehavior=convertToNull&amp;useSSL=false&amp;allowPublicKeyRetrieval=true</span>
        <span class="token key atrule">username</span><span class="token punctuation">:</span> root
        <span class="token key atrule">password</span><span class="token punctuation">:</span> root
      <span class="token comment"># ä»æ•°æ®æº</span>
      <span class="token key atrule">slave</span><span class="token punctuation">:</span>
        <span class="token key atrule">type</span><span class="token punctuation">:</span> com.alibaba.druid.pool.DruidDataSource
        <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
        <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//192.168.199.180<span class="token punctuation">:</span>3306/reggie<span class="token punctuation">?</span>serverTimezone=Asia/Shanghai<span class="token important">&amp;useUnicode=true&amp;characterEncoding=utf-8&amp;zeroDateTimeBehavior=convertToNull&amp;useSSL=false&amp;allowPublicKeyRetrieval=true</span>
        <span class="token key atrule">username</span><span class="token punctuation">:</span> root
        <span class="token key atrule">password</span><span class="token punctuation">:</span> root
    <span class="token key atrule">masterslave</span><span class="token punctuation">:</span>
      <span class="token comment"># è¯»å†™åˆ†ç¦»é…ç½®</span>
      <span class="token key atrule">load-balance-algorithm-type</span><span class="token punctuation">:</span> round_robin <span class="token comment">#è½®è¯¢</span>
      <span class="token comment"># æœ€ç»ˆçš„æ•°æ®æºåç§°</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> dataSource
      <span class="token comment"># ä¸»åº“æ•°æ®æºåç§°</span>
      <span class="token key atrule">master-data-source-name</span><span class="token punctuation">:</span> master
      <span class="token comment"># ä»åº“æ•°æ®æºåç§°åˆ—è¡¨ï¼Œå¤šä¸ªé€—å·åˆ†éš”</span>
      <span class="token key atrule">slave-data-source-names</span><span class="token punctuation">:</span> slave
    <span class="token key atrule">props</span><span class="token punctuation">:</span>
      <span class="token key atrule">sql</span><span class="token punctuation">:</span>
        <span class="token key atrule">show</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment">#å¼€å¯SQLæ˜¾ç¤ºï¼Œé»˜è®¤false</span>
  <span class="token key atrule">main</span><span class="token punctuation">:</span>
    <span class="token key atrule">allow-bean-definition-overriding</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment">#å…è®¸beanè¦†ç›– druidæ•°æ®æºå’Œshardingéƒ½ä¼šåºŠæ¶datasourceæ•°æ® ä¸ºäº†é¿å…æŠ¥é”™ å…è®¸åä¸€ä¸ªè¦†ç›–å‰ä¸€ä¸ª</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3ï¼‰å¯åŠ¨</p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230108100222147.png" alt="image-20230108100222147"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230108100552837.png" alt="image-20230108100552837"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230108100608705.png" alt="image-20230108100608705"></p></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/EddieZturbo/Eddie-Tech-Blog.github.io/edit/main/docs/backend/database/mysql.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page on GitHub" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->Edit this page on GitHub<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item git-info"><!----><!----></div></footer><!----><!----><!----><!--]--></main><!--]--><footer class="footer-wrapper"><div class="footer">Default footer</div><div class="copyright">Copyright Â© 2023 EddieZ</div></footer></div><!--]--><!--]--><!----><!--]--></div>
    <script type="module" src="/assets/app-7117916c.js" defer></script>
  </body>
</html>
