<!DOCTYPE html>
<html lang="en-US" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.60" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://mister-hope.github.io/backend/middleware/Redis.html"><meta property="og:site_name" content="Eddie-Tech-Blog"><meta property="og:title" content="Redis"><meta property="og:description" content="https://redis.io/ image-20230130205947937 Redisæ˜¯ä¸€ä¸ªå¼€æºçš„å†…å­˜æ•°æ®å­˜å‚¨ç³»ç»Ÿï¼Œå¯ä»¥ç”¨ä½œæ•°æ®åº“ã€ç¼“å­˜å’Œæ¶ˆæ¯ä¸­é—´ä»¶ã€‚å®ƒæ”¯æŒå¤šç§æ•°æ®ç»“æ„ï¼ŒåŒ…æ‹¬å­—ç¬¦ä¸²ã€å“ˆå¸Œè¡¨ã€åˆ—è¡¨ã€é›†åˆå’Œæœ‰åºé›†åˆç­‰ï¼Œå¹¶æä¾›äº†ä¸°å¯Œçš„APIä»¥åŠé«˜å¯ç”¨æ€§ã€åˆ†å¸ƒå¼ã€äº‹åŠ¡ç­‰ç‰¹æ€§ã€‚Redisè¢«å¹¿æ³›ç”¨äºäº’è”ç½‘åº”ç”¨é¢†åŸŸï¼Œå¦‚ç¤¾äº¤ç½‘ç»œã€ç”µå­å•†åŠ¡ã€æ¸¸æˆç­‰ã€‚ ä»¥ä¸‹æ˜¯..."><meta property="og:type" content="article"><meta property="og:locale" content="en-US"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Redis","image":[""],"dateModified":null,"author":[]}</script><title>Redis | Eddie-Tech-Blog</title><meta name="description" content="https://redis.io/ image-20230130205947937 Redisæ˜¯ä¸€ä¸ªå¼€æºçš„å†…å­˜æ•°æ®å­˜å‚¨ç³»ç»Ÿï¼Œå¯ä»¥ç”¨ä½œæ•°æ®åº“ã€ç¼“å­˜å’Œæ¶ˆæ¯ä¸­é—´ä»¶ã€‚å®ƒæ”¯æŒå¤šç§æ•°æ®ç»“æ„ï¼ŒåŒ…æ‹¬å­—ç¬¦ä¸²ã€å“ˆå¸Œè¡¨ã€åˆ—è¡¨ã€é›†åˆå’Œæœ‰åºé›†åˆç­‰ï¼Œå¹¶æä¾›äº†ä¸°å¯Œçš„APIä»¥åŠé«˜å¯ç”¨æ€§ã€åˆ†å¸ƒå¼ã€äº‹åŠ¡ç­‰ç‰¹æ€§ã€‚Redisè¢«å¹¿æ³›ç”¨äºäº’è”ç½‘åº”ç”¨é¢†åŸŸï¼Œå¦‚ç¤¾äº¤ç½‘ç»œã€ç”µå­å•†åŠ¡ã€æ¸¸æˆç­‰ã€‚ ä»¥ä¸‹æ˜¯...">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d1e1f;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/assets/style-71862533.css" as="style"><link rel="stylesheet" href="/assets/style-71862533.css">
    <link rel="modulepreload" href="/assets/app-7117916c.js"><link rel="modulepreload" href="/assets/framework-e28ace55.js"><link rel="modulepreload" href="/assets/Redis.html-e07d4331.js"><link rel="modulepreload" href="/assets/Redis.html-67ba8f06.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">Skip to main content</a><!--]--><!--[--><div class="theme-container has-toc"><!--[--><header class="navbar" id="navbar"><div class="navbar-start"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><a href="/" class="brand"><img class="logo" src="/logo.png" alt="Eddie-Tech-Blog"><!----><span class="site-name hide-in-pad">Eddie-Tech-Blog</span></a><!--[--><!----><!--]--></div><div class="navbar-center"><!--[--><!----><!--]--><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/" class="nav-link" aria-label="Home"><span class="font-icon icon iconfont icon-home" style=""></span>Home<!----></a></div><div class="nav-item hide-in-mobile"><a href="/eddie/" class="nav-link" aria-label="Expoler"><span class="font-icon icon iconfont icon-discover" style=""></span>Expoler<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Backend-Dev"><span class="title"><span class="font-icon icon iconfont icon-edit" style=""></span>Backend-Dev</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>Java</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/backend/java/jvm.html" class="nav-link" aria-label="JVM"><span class="font-icon icon iconfont icon-edit" style=""></span>JVM<!----></a></li><li class="dropdown-subitem"><a href="/backend/java/java8.html" class="nav-link" aria-label="Java8"><span class="font-icon icon iconfont icon-edit" style=""></span>Java8<!----></a></li><li class="dropdown-subitem"><a href="/backend/java/java_concurrency_programming.html" class="nav-link" aria-label="Java Concurrency Programming"><span class="font-icon icon iconfont icon-edit" style=""></span>Java Concurrency Programming<!----></a></li><li class="dropdown-subitem"><a href="/backend/java/Java.html" class="nav-link" aria-label="Java"><span class="font-icon icon iconfont icon-edit" style=""></span>Java<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>Database</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/backend/database/mysql.html" class="nav-link" aria-label="MySQL  Basic --- advanced"><span class="font-icon icon iconfont icon-edit" style=""></span>MySQL  Basic --- advanced<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>Dev-FrameWork</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/backend/dev_framework/SpringBoot.html" class="nav-link" aria-label="Spring Boot"><span class="font-icon icon iconfont icon-edit" style=""></span>Spring Boot<!----></a></li><li class="dropdown-subitem"><a href="/backend/dev_framework/SpringMVC.html" class="nav-link" aria-label="SpringMVC"><span class="font-icon icon iconfont icon-edit" style=""></span>SpringMVC<!----></a></li><li class="dropdown-subitem"><a href="/backend/dev_framework/Spring5.html" class="nav-link" aria-label="Spring5"><span class="font-icon icon iconfont icon-edit" style=""></span>Spring5<!----></a></li><li class="dropdown-subitem"><a href="/backend/dev_framework/Mybatis.html" class="nav-link" aria-label="Mybatis"><span class="font-icon icon iconfont icon-edit" style=""></span>Mybatis<!----></a></li><li class="dropdown-subitem"><a href="/backend/dev_framework/MybatisPlus.html" class="nav-link" aria-label="MybatisPlus"><span class="font-icon icon iconfont icon-edit" style=""></span>MybatisPlus<!----></a></li><li class="dropdown-subitem"><a href="/backend/dev_framework/SpringCloud.html" class="nav-link" aria-label="SpringCloud &amp; ~Aibaba"><span class="font-icon icon iconfont icon-edit" style=""></span>SpringCloud &amp; ~Aibaba<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>Middleware</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/backend/middleware/MQ.html" class="nav-link" aria-label="MQ"><span class="font-icon icon iconfont icon-edit" style=""></span>MQ<!----></a></li><li class="dropdown-subitem"><a aria-current="page" href="/backend/middleware/Redis.html" class="router-link-active router-link-exact-active nav-link active" aria-label="Redis"><span class="font-icon icon iconfont icon-edit" style=""></span>Redis<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>Skills</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/backend/skills/DataStructureAlgorithm.html" class="nav-link" aria-label="DataStructureAlgorithm"><span class="font-icon icon iconfont icon-edit" style=""></span>DataStructureAlgorithm<!----></a></li><li class="dropdown-subitem"><a href="/backend/skills/ComputerNetwork.html" class="nav-link" aria-label="ComputerNetwork"><span class="font-icon icon iconfont icon-edit" style=""></span>ComputerNetwork<!----></a></li><li class="dropdown-subitem"><a href="/backend/skills/OperatingSystem.html" class="nav-link" aria-label="OperatingSystem"><span class="font-icon icon iconfont icon-edit" style=""></span>OperatingSystem<!----></a></li><li class="dropdown-subitem"><a href="/backend/skills/Methodology.html" class="nav-link" aria-label="Methodology"><span class="font-icon icon iconfont icon-edit" style=""></span>Methodology<!----></a></li><li class="dropdown-subitem"><a href="/backend/skills/IO.html" class="nav-link" aria-label="IO"><span class="font-icon icon iconfont icon-edit" style=""></span>IO<!----></a></li><li class="dropdown-subitem"><a href="/backend/skills/Netty.html" class="nav-link" aria-label="Netty"><span class="font-icon icon iconfont icon-edit" style=""></span>Netty<!----></a></li><li class="dropdown-subitem"><a href="/backend/skills/Linux.html" class="nav-link" aria-label="Linux"><span class="font-icon icon iconfont icon-edit" style=""></span>Linux<!----></a></li><li class="dropdown-subitem"><a href="/backend/skills/Dubbo.html" class="nav-link" aria-label="Dubbo"><span class="font-icon icon iconfont icon-edit" style=""></span>Dubbo<!----></a></li><li class="dropdown-subitem"><a href="/backend/skills/Zookeeper.html" class="nav-link" aria-label="Zookeeper"><span class="font-icon icon iconfont icon-edit" style=""></span>Zookeeper<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>Tools</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/backend/tools/Docker.html" class="nav-link" aria-label="Docker"><span class="font-icon icon iconfont icon-edit" style=""></span>Docker<!----></a></li><li class="dropdown-subitem"><a href="/backend/tools/Git.html" class="nav-link" aria-label="Git"><span class="font-icon icon iconfont icon-edit" style=""></span>Git<!----></a></li><li class="dropdown-subitem"><a href="/backend/tools/Maven.html" class="nav-link" aria-label="Maven"><span class="font-icon icon iconfont icon-edit" style=""></span>Maven<!----></a></li><li class="dropdown-subitem"><a href="/backend/tools/Nginx.html" class="nav-link" aria-label="Nginx"><span class="font-icon icon iconfont icon-edit" style=""></span>Nginx<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a href="/article-papper/" class="nav-link" aria-label="Article &amp; Papper"><span class="font-icon icon iconfont icon-note" style=""></span>Article &amp; Papper<!----></a></div></nav><!--[--><!----><!--]--></div><div class="navbar-end"><!--[--><!----><!--]--><!----><div class="nav-item"><a class="repo-link" href="https://github.com/EddieZturbo/Eddie-Tech-Blog.github.io" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--[--><!----><!--]--><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside class="sidebar" id="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><a href="/" class="nav-link sidebar-link sidebar-page" aria-label="Home"><span class="font-icon icon iconfont icon-home" style=""></span>Home<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><section class="sidebar-group"><p class="sidebar-heading clickable"><span class="font-icon icon iconfont icon-discover" style=""></span><a href="/eddie/" class="title">Eddie</a><!----></p><ul class="sidebar-links"></ul></section></li><li><section class="sidebar-group"><p class="sidebar-heading active"><span class="font-icon icon iconfont icon-note" style=""></span><span class="title">Backend-Dev</span><!----></p><ul class="sidebar-links"><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">Database</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">Dev Framework</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">Java</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable active"><!----><span class="title">Middleware</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><!--[--><a href="/backend/middleware/MQ.html" class="nav-link sidebar-link sidebar-page" aria-label="MQ"><!---->MQ<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/backend/middleware/Redis.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="Redis"><!---->Redis<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/backend/middleware/Redis.html#why-is-redis-so-fast-â˜…" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Why is Redis so fast?â˜…"><!---->Why is Redis so fast?â˜…<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/middleware/Redis.html#redisèµ·æ­¥å®‰è£…" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Redisèµ·æ­¥å®‰è£…"><!---->Redisèµ·æ­¥å®‰è£…<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/middleware/Redis.html#redisäº”å¤§åŸºæœ¬æ•°æ®ç±»å‹â˜…" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Redisäº”å¤§åŸºæœ¬æ•°æ®ç±»å‹â˜…"><!---->Redisäº”å¤§åŸºæœ¬æ•°æ®ç±»å‹â˜…<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/backend/middleware/Redis.html#äº”ç§å¯¹è±¡ç±»å‹" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="äº”ç§å¯¹è±¡ç±»å‹"><!---->äº”ç§å¯¹è±¡ç±»å‹<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/middleware/Redis.html#åº•å±‚æ•°æ®ç»“æ„" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="åº•å±‚æ•°æ®ç»“æ„"><!---->åº•å±‚æ•°æ®ç»“æ„<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/middleware/Redis.html#redis6æ–°çš„æ•°æ®ç±»å‹" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Redis6æ–°çš„æ•°æ®ç±»å‹"><!---->Redis6æ–°çš„æ•°æ®ç±»å‹<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/backend/middleware/Redis.html#bitmap" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="BitMap"><!---->BitMap<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/middleware/Redis.html#hyperloglog" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Hyperloglog"><!---->Hyperloglog<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/middleware/Redis.html#grographic" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Grographic"><!---->Grographic<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/middleware/Redis.html#é…ç½®æ–‡ä»¶" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="é…ç½®æ–‡ä»¶"><!---->é…ç½®æ–‡ä»¶<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/middleware/Redis.html#rediså‘å¸ƒå’Œè®¢é˜…" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Rediså‘å¸ƒå’Œè®¢é˜…"><!---->Rediså‘å¸ƒå’Œè®¢é˜…<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/backend/middleware/Redis.html#å‘å¸ƒè®¢é˜…æµç¨‹" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å‘å¸ƒè®¢é˜…æµç¨‹"><!---->å‘å¸ƒè®¢é˜…æµç¨‹<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/middleware/Redis.html#å‘½ä»¤è¡Œå®ç°å‘å¸ƒå’Œè®¢é˜…æ¼”ç¤º" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å‘½ä»¤è¡Œå®ç°å‘å¸ƒå’Œè®¢é˜…æ¼”ç¤º"><!---->å‘½ä»¤è¡Œå®ç°å‘å¸ƒå’Œè®¢é˜…æ¼”ç¤º<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/middleware/Redis.html#å¸¸ç”¨å‘½ä»¤" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å¸¸ç”¨å‘½ä»¤"><!---->å¸¸ç”¨å‘½ä»¤<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/middleware/Redis.html#jedisæ“ä½œredis" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Jedisæ“ä½œRedis"><!---->Jedisæ“ä½œRedis<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/backend/middleware/Redis.html#javaä½¿ç”¨redis" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Javaä½¿ç”¨Redis"><!---->Javaä½¿ç”¨Redis<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/middleware/Redis.html#æ¨¡æ‹ŸéªŒè¯ç å‘é€å’ŒéªŒè¯" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="æ¨¡æ‹ŸéªŒè¯ç å‘é€å’ŒéªŒè¯"><!---->æ¨¡æ‹ŸéªŒè¯ç å‘é€å’ŒéªŒè¯<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/middleware/Redis.html#springbootæ•´åˆredisâ˜…" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="SpringBootæ•´åˆRedisâ˜…"><!---->SpringBootæ•´åˆRedisâ˜…<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/middleware/Redis.html#redisçš„äº‹åŠ¡æ“ä½œ" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Redisçš„äº‹åŠ¡æ“ä½œ"><!---->Redisçš„äº‹åŠ¡æ“ä½œ<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/backend/middleware/Redis.html#redisäº‹åŠ¡ç‰¹æ€§" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Redisäº‹åŠ¡ç‰¹æ€§"><!---->Redisäº‹åŠ¡ç‰¹æ€§<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/middleware/Redis.html#redisäº‹åŠ¡å‘½ä»¤" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Redisäº‹åŠ¡å‘½ä»¤"><!---->Redisäº‹åŠ¡å‘½ä»¤<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/middleware/Redis.html#redisä¹è§‚é”å®ç°" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Redisä¹è§‚é”å®ç°"><!---->Redisä¹è§‚é”å®ç°<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/middleware/Redis.html#ç§’æ€æ¡ˆä¾‹ä½“ä¼šredisäº‹åŠ¡" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ç§’æ€æ¡ˆä¾‹ä½“ä¼šredisäº‹åŠ¡"><!---->ç§’æ€æ¡ˆä¾‹ä½“ä¼šredisäº‹åŠ¡<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/middleware/Redis.html#redisæŒä¹…åŒ–â˜…" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="RedisæŒä¹…åŒ–â˜…"><!---->RedisæŒä¹…åŒ–â˜…<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/middleware/Redis.html#redisä¸»ä»å¤åˆ¶" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Redisä¸»ä»å¤åˆ¶"><!---->Redisä¸»ä»å¤åˆ¶<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/backend/middleware/Redis.html#ä½¿ç”¨å‘½ä»¤å®ç°" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ä½¿ç”¨å‘½ä»¤å®ç°"><!---->ä½¿ç”¨å‘½ä»¤å®ç°<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/middleware/Redis.html#ä¿®æ”¹é…ç½®æ–‡ä»¶å®ç°" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ä¿®æ”¹é…ç½®æ–‡ä»¶å®ç°"><!---->ä¿®æ”¹é…ç½®æ–‡ä»¶å®ç°<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/middleware/Redis.html#ä¸€ä¸»å¤šä»" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ä¸€ä¸»å¤šä»"><!---->ä¸€ä¸»å¤šä»<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/middleware/Redis.html#è–ªç«ç›¸ä¼ " class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="è–ªç«ç›¸ä¼ "><!---->è–ªç«ç›¸ä¼ <!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/middleware/Redis.html#åå®¢ä¸ºä¸»" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="åå®¢ä¸ºä¸»"><!---->åå®¢ä¸ºä¸»<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/middleware/Redis.html#ä¸»ä»æ¨¡å¼ä¸è¶³" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ä¸»ä»æ¨¡å¼ä¸è¶³"><!---->ä¸»ä»æ¨¡å¼ä¸è¶³<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/middleware/Redis.html#sentinelå“¨å…µæ¨¡å¼" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Sentinelå“¨å…µæ¨¡å¼"><!---->Sentinelå“¨å…µæ¨¡å¼<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/backend/middleware/Redis.html#å“¨å…µæ¨¡å¼åŸç†" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å“¨å…µæ¨¡å¼åŸç†"><!---->å“¨å…µæ¨¡å¼åŸç†<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/middleware/Redis.html#é…ç½®å“¨å…µæ¨¡å¼" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="é…ç½®å“¨å…µæ¨¡å¼"><!---->é…ç½®å“¨å…µæ¨¡å¼<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/middleware/Redis.html#sentinel-confé…ç½®é¡¹" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="sentinel.confé…ç½®é¡¹"><!---->sentinel.confé…ç½®é¡¹<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/middleware/Redis.html#redis-clusterâ˜…" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Redis Clusterâ˜…"><!---->Redis Clusterâ˜…<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/backend/middleware/Redis.html#create-a-redis-cluster" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Create a Redis Cluster"><!---->Create a Redis Cluster<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/middleware/Redis.html#redis-cluster-expansion-reduction" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Redis Cluster Expansion &amp; Reduction"><!---->Redis Cluster Expansion &amp; Reduction<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/middleware/Redis.html#redisç¼“å­˜é—®é¢˜â˜…" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Redisç¼“å­˜é—®é¢˜â˜…"><!---->Redisç¼“å­˜é—®é¢˜â˜…<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/backend/middleware/Redis.html#ç¼“å­˜ç©¿é€" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ç¼“å­˜ç©¿é€"><!---->ç¼“å­˜ç©¿é€<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/middleware/Redis.html#ç¼“å­˜å‡»ç©¿" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ç¼“å­˜å‡»ç©¿"><!---->ç¼“å­˜å‡»ç©¿<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/middleware/Redis.html#ç¼“å­˜é›ªå´©" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ç¼“å­˜é›ªå´©"><!---->ç¼“å­˜é›ªå´©<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/middleware/Redis.html#rediså›æ”¶å»¶è¿Ÿ-åˆ é™¤æ•°æ®æ“ä½œ-â˜…" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Rediså›æ”¶å»¶è¿Ÿï¼ˆåˆ é™¤æ•°æ®æ“ä½œï¼‰â˜…"><!---->Rediså›æ”¶å»¶è¿Ÿï¼ˆåˆ é™¤æ•°æ®æ“ä½œï¼‰â˜…<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/middleware/Redis.html#rediså†…å­˜æ·˜æ±°æœºåˆ¶â˜…" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Rediså†…å­˜æ·˜æ±°æœºåˆ¶â˜…"><!---->Rediså†…å­˜æ·˜æ±°æœºåˆ¶â˜…<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/middleware/Redis.html#redisè¿‡æœŸé”®çš„åˆ é™¤ç­–ç•¥â˜…" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Redisè¿‡æœŸé”®çš„åˆ é™¤ç­–ç•¥â˜…"><!---->Redisè¿‡æœŸé”®çš„åˆ é™¤ç­–ç•¥â˜…<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/middleware/Redis.html#redis-å†…å­˜ç¢ç‰‡â˜…" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Redis å†…å­˜ç¢ç‰‡â˜…"><!---->Redis å†…å­˜ç¢ç‰‡â˜…<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/backend/middleware/Redis.html#äº§ç”Ÿçš„åŸå› " class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="äº§ç”Ÿçš„åŸå› "><!---->äº§ç”Ÿçš„åŸå› <!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/middleware/Redis.html#æŸ¥è¯¢å†…å­˜ç¢ç‰‡ä¿¡æ¯" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="æŸ¥è¯¢å†…å­˜ç¢ç‰‡ä¿¡æ¯"><!---->æŸ¥è¯¢å†…å­˜ç¢ç‰‡ä¿¡æ¯<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/middleware/Redis.html#æ¸…ç†å†…å­˜ç¢ç‰‡" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="æ¸…ç†å†…å­˜ç¢ç‰‡"><!---->æ¸…ç†å†…å­˜ç¢ç‰‡<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/middleware/Redis.html#åˆ†å¸ƒå¼é”â˜…" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="åˆ†å¸ƒå¼é”â˜…"><!---->åˆ†å¸ƒå¼é”â˜…<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/backend/middleware/Redis.html#ä¸»æµåˆ†å¸ƒå¼é”å®ç°æ–¹å¼" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ä¸»æµåˆ†å¸ƒå¼é”å®ç°æ–¹å¼"><!---->ä¸»æµåˆ†å¸ƒå¼é”å®ç°æ–¹å¼<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/middleware/Redis.html#rediså®ç°åˆ†å¸ƒå¼é”" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Rediså®ç°åˆ†å¸ƒå¼é”"><!---->Rediså®ç°åˆ†å¸ƒå¼é”<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/middleware/Redis.html#redisson" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Redisson"><!---->Redisson<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/backend/middleware/Redis.html#ç¼“å­˜æ•°æ®ä¸€è‡´æ€§â˜…" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ç¼“å­˜æ•°æ®ä¸€è‡´æ€§â˜…"><!---->ç¼“å­˜æ•°æ®ä¸€è‡´æ€§â˜…<!----></a><ul class="sidebar-sub-headers"></ul></li></ul><!--]--></li></ul></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">Skills</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">Tools</span><span class="arrow end"></span></button><!----></section></li></ul></section></li><li><section class="sidebar-group"><p class="sidebar-heading"><span class="font-icon icon iconfont icon-note" style=""></span><span class="title">Article &amp; Papper</span><!----></p><ul class="sidebar-links"><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">Article</span><span class="arrow end"></span></button><!----></section></li></ul></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->Redis</h1><div class="page-info"><span class="page-author-info" aria-label="AuthorğŸ–Š" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://github.com/EddieZturbo" target="_blank" rel="noopener noreferrer">EddieZ</a></span><span property="author" content="EddieZ"></span></span><!----><!----><!----><span class="page-reading-time-info" aria-label="Reading TimeâŒ›" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>About 81 min</span><meta property="timeRequired" content="PT81M"></span><!----><!----></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">On This Page<button class="print-button" title="print"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/backend/middleware/Redis.html#why-is-redis-so-fast-â˜…" class="router-link-active router-link-exact-active toc-link level2">Why is Redis so fast?â˜…</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/middleware/Redis.html#redisèµ·æ­¥å®‰è£…" class="router-link-active router-link-exact-active toc-link level2">Redisèµ·æ­¥å®‰è£…</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/middleware/Redis.html#redisäº”å¤§åŸºæœ¬æ•°æ®ç±»å‹â˜…" class="router-link-active router-link-exact-active toc-link level2">Redisäº”å¤§åŸºæœ¬æ•°æ®ç±»å‹â˜…</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/backend/middleware/Redis.html#äº”ç§å¯¹è±¡ç±»å‹" class="router-link-active router-link-exact-active toc-link level3">äº”ç§å¯¹è±¡ç±»å‹</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/middleware/Redis.html#åº•å±‚æ•°æ®ç»“æ„" class="router-link-active router-link-exact-active toc-link level3">åº•å±‚æ•°æ®ç»“æ„</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/middleware/Redis.html#redis6æ–°çš„æ•°æ®ç±»å‹" class="router-link-active router-link-exact-active toc-link level2">Redis6æ–°çš„æ•°æ®ç±»å‹</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/backend/middleware/Redis.html#bitmap" class="router-link-active router-link-exact-active toc-link level3">BitMap</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/middleware/Redis.html#hyperloglog" class="router-link-active router-link-exact-active toc-link level3">Hyperloglog</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/middleware/Redis.html#grographic" class="router-link-active router-link-exact-active toc-link level3">Grographic</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/middleware/Redis.html#é…ç½®æ–‡ä»¶" class="router-link-active router-link-exact-active toc-link level2">é…ç½®æ–‡ä»¶</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/middleware/Redis.html#rediså‘å¸ƒå’Œè®¢é˜…" class="router-link-active router-link-exact-active toc-link level2">Rediså‘å¸ƒå’Œè®¢é˜…</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/backend/middleware/Redis.html#å‘å¸ƒè®¢é˜…æµç¨‹" class="router-link-active router-link-exact-active toc-link level3">å‘å¸ƒè®¢é˜…æµç¨‹</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/middleware/Redis.html#å‘½ä»¤è¡Œå®ç°å‘å¸ƒå’Œè®¢é˜…æ¼”ç¤º" class="router-link-active router-link-exact-active toc-link level3">å‘½ä»¤è¡Œå®ç°å‘å¸ƒå’Œè®¢é˜…æ¼”ç¤º</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/middleware/Redis.html#å¸¸ç”¨å‘½ä»¤" class="router-link-active router-link-exact-active toc-link level3">å¸¸ç”¨å‘½ä»¤</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/middleware/Redis.html#jedisæ“ä½œredis" class="router-link-active router-link-exact-active toc-link level2">Jedisæ“ä½œRedis</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/backend/middleware/Redis.html#javaä½¿ç”¨redis" class="router-link-active router-link-exact-active toc-link level3">Javaä½¿ç”¨Redis</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/middleware/Redis.html#æ¨¡æ‹ŸéªŒè¯ç å‘é€å’ŒéªŒè¯" class="router-link-active router-link-exact-active toc-link level3">æ¨¡æ‹ŸéªŒè¯ç å‘é€å’ŒéªŒè¯</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/middleware/Redis.html#springbootæ•´åˆredisâ˜…" class="router-link-active router-link-exact-active toc-link level2">SpringBootæ•´åˆRedisâ˜…</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/middleware/Redis.html#redisçš„äº‹åŠ¡æ“ä½œ" class="router-link-active router-link-exact-active toc-link level2">Redisçš„äº‹åŠ¡æ“ä½œ</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/backend/middleware/Redis.html#redisäº‹åŠ¡ç‰¹æ€§" class="router-link-active router-link-exact-active toc-link level3">Redisäº‹åŠ¡ç‰¹æ€§</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/middleware/Redis.html#redisäº‹åŠ¡å‘½ä»¤" class="router-link-active router-link-exact-active toc-link level3">Redisäº‹åŠ¡å‘½ä»¤</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/middleware/Redis.html#redisä¹è§‚é”å®ç°" class="router-link-active router-link-exact-active toc-link level3">Redisä¹è§‚é”å®ç°</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/middleware/Redis.html#ç§’æ€æ¡ˆä¾‹ä½“ä¼šredisäº‹åŠ¡" class="router-link-active router-link-exact-active toc-link level3">ç§’æ€æ¡ˆä¾‹ä½“ä¼šredisäº‹åŠ¡</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/middleware/Redis.html#redisæŒä¹…åŒ–â˜…" class="router-link-active router-link-exact-active toc-link level2">RedisæŒä¹…åŒ–â˜…</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/middleware/Redis.html#redisä¸»ä»å¤åˆ¶" class="router-link-active router-link-exact-active toc-link level2">Redisä¸»ä»å¤åˆ¶</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/backend/middleware/Redis.html#ä½¿ç”¨å‘½ä»¤å®ç°" class="router-link-active router-link-exact-active toc-link level3">ä½¿ç”¨å‘½ä»¤å®ç°</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/middleware/Redis.html#ä¿®æ”¹é…ç½®æ–‡ä»¶å®ç°" class="router-link-active router-link-exact-active toc-link level3">ä¿®æ”¹é…ç½®æ–‡ä»¶å®ç°</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/middleware/Redis.html#ä¸€ä¸»å¤šä»" class="router-link-active router-link-exact-active toc-link level3">ä¸€ä¸»å¤šä»</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/middleware/Redis.html#è–ªç«ç›¸ä¼ " class="router-link-active router-link-exact-active toc-link level3">è–ªç«ç›¸ä¼ </a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/middleware/Redis.html#åå®¢ä¸ºä¸»" class="router-link-active router-link-exact-active toc-link level3">åå®¢ä¸ºä¸»</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/middleware/Redis.html#ä¸»ä»æ¨¡å¼ä¸è¶³" class="router-link-active router-link-exact-active toc-link level3">ä¸»ä»æ¨¡å¼ä¸è¶³</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/middleware/Redis.html#sentinelå“¨å…µæ¨¡å¼" class="router-link-active router-link-exact-active toc-link level2">Sentinelå“¨å…µæ¨¡å¼</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/backend/middleware/Redis.html#å“¨å…µæ¨¡å¼åŸç†" class="router-link-active router-link-exact-active toc-link level3">å“¨å…µæ¨¡å¼åŸç†</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/middleware/Redis.html#é…ç½®å“¨å…µæ¨¡å¼" class="router-link-active router-link-exact-active toc-link level3">é…ç½®å“¨å…µæ¨¡å¼</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/middleware/Redis.html#sentinel-confé…ç½®é¡¹" class="router-link-active router-link-exact-active toc-link level3">sentinel.confé…ç½®é¡¹</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/middleware/Redis.html#redis-clusterâ˜…" class="router-link-active router-link-exact-active toc-link level2">Redis Clusterâ˜…</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/backend/middleware/Redis.html#create-a-redis-cluster" class="router-link-active router-link-exact-active toc-link level3">Create a Redis Cluster</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/middleware/Redis.html#redis-cluster-expansion-reduction" class="router-link-active router-link-exact-active toc-link level3">Redis Cluster Expansion &amp; Reduction</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/middleware/Redis.html#redisç¼“å­˜é—®é¢˜â˜…" class="router-link-active router-link-exact-active toc-link level2">Redisç¼“å­˜é—®é¢˜â˜…</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/backend/middleware/Redis.html#ç¼“å­˜ç©¿é€" class="router-link-active router-link-exact-active toc-link level3">ç¼“å­˜ç©¿é€</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/middleware/Redis.html#ç¼“å­˜å‡»ç©¿" class="router-link-active router-link-exact-active toc-link level3">ç¼“å­˜å‡»ç©¿</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/middleware/Redis.html#ç¼“å­˜é›ªå´©" class="router-link-active router-link-exact-active toc-link level3">ç¼“å­˜é›ªå´©</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/middleware/Redis.html#rediså›æ”¶å»¶è¿Ÿ-åˆ é™¤æ•°æ®æ“ä½œ-â˜…" class="router-link-active router-link-exact-active toc-link level2">Rediså›æ”¶å»¶è¿Ÿï¼ˆåˆ é™¤æ•°æ®æ“ä½œï¼‰â˜…</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/middleware/Redis.html#rediså†…å­˜æ·˜æ±°æœºåˆ¶â˜…" class="router-link-active router-link-exact-active toc-link level2">Rediså†…å­˜æ·˜æ±°æœºåˆ¶â˜…</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/middleware/Redis.html#redisè¿‡æœŸé”®çš„åˆ é™¤ç­–ç•¥â˜…" class="router-link-active router-link-exact-active toc-link level2">Redisè¿‡æœŸé”®çš„åˆ é™¤ç­–ç•¥â˜…</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/middleware/Redis.html#redis-å†…å­˜ç¢ç‰‡â˜…" class="router-link-active router-link-exact-active toc-link level2">Redis å†…å­˜ç¢ç‰‡â˜…</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/backend/middleware/Redis.html#äº§ç”Ÿçš„åŸå› " class="router-link-active router-link-exact-active toc-link level3">äº§ç”Ÿçš„åŸå› </a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/middleware/Redis.html#æŸ¥è¯¢å†…å­˜ç¢ç‰‡ä¿¡æ¯" class="router-link-active router-link-exact-active toc-link level3">æŸ¥è¯¢å†…å­˜ç¢ç‰‡ä¿¡æ¯</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/middleware/Redis.html#æ¸…ç†å†…å­˜ç¢ç‰‡" class="router-link-active router-link-exact-active toc-link level3">æ¸…ç†å†…å­˜ç¢ç‰‡</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/middleware/Redis.html#åˆ†å¸ƒå¼é”â˜…" class="router-link-active router-link-exact-active toc-link level2">åˆ†å¸ƒå¼é”â˜…</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/backend/middleware/Redis.html#ä¸»æµåˆ†å¸ƒå¼é”å®ç°æ–¹å¼" class="router-link-active router-link-exact-active toc-link level3">ä¸»æµåˆ†å¸ƒå¼é”å®ç°æ–¹å¼</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/middleware/Redis.html#rediså®ç°åˆ†å¸ƒå¼é”" class="router-link-active router-link-exact-active toc-link level3">Rediså®ç°åˆ†å¸ƒå¼é”</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/middleware/Redis.html#redisson" class="router-link-active router-link-exact-active toc-link level3">Redisson</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/backend/middleware/Redis.html#ç¼“å­˜æ•°æ®ä¸€è‡´æ€§â˜…" class="router-link-active router-link-exact-active toc-link level2">ç¼“å­˜æ•°æ®ä¸€è‡´æ€§â˜…</a></li><!----><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><h1 id="redis" tabindex="-1"><a class="header-anchor" href="#redis" aria-hidden="true">#</a> Redis</h1><p>https://redis.io/</p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230130205947937.png" alt="image-20230130205947937"></p><blockquote><p>Redisæ˜¯ä¸€ä¸ªå¼€æºçš„<strong>å†…å­˜æ•°æ®å­˜å‚¨ç³»ç»Ÿ</strong>ï¼Œå¯ä»¥ç”¨ä½œæ•°æ®åº“ã€ç¼“å­˜å’Œæ¶ˆæ¯ä¸­é—´ä»¶ã€‚å®ƒæ”¯æŒå¤šç§æ•°æ®ç»“æ„ï¼ŒåŒ…æ‹¬å­—ç¬¦ä¸²ã€å“ˆå¸Œè¡¨ã€åˆ—è¡¨ã€é›†åˆå’Œæœ‰åºé›†åˆç­‰ï¼Œå¹¶æä¾›äº†ä¸°å¯Œçš„APIä»¥åŠé«˜å¯ç”¨æ€§ã€åˆ†å¸ƒå¼ã€äº‹åŠ¡ç­‰ç‰¹æ€§ã€‚Redisè¢«å¹¿æ³›ç”¨äºäº’è”ç½‘åº”ç”¨é¢†åŸŸï¼Œå¦‚ç¤¾äº¤ç½‘ç»œã€ç”µå­å•†åŠ¡ã€æ¸¸æˆç­‰ã€‚</p><p>ä»¥ä¸‹æ˜¯Redisçš„ä¸€äº›ä½¿ç”¨åœºæ™¯ï¼š</p><ol><li><strong>ç¼“å­˜</strong>ï¼šRedisæœ€å¸¸è§çš„ä½¿ç”¨åœºæ™¯æ˜¯ä½œä¸ºç¼“å­˜ï¼Œå°†çƒ­ç‚¹æ•°æ®æ”¾åœ¨å†…å­˜ä¸­ï¼Œä»¥æé«˜æ•°æ®è®¿é—®çš„é€Ÿåº¦ã€‚å®ƒæ”¯æŒç¼“å­˜çš„è‡ªåŠ¨è¿‡æœŸã€LRUæ·˜æ±°ç­‰æœºåˆ¶ï¼Œå¹¶å¯ä»¥è®¾ç½®æœ€å¤§å†…å­˜ä½¿ç”¨é‡ã€‚</li><li><strong>æ¶ˆæ¯ä¸­é—´ä»¶</strong>ï¼šRedisæä¾›äº†å‘å¸ƒ-è®¢é˜…ï¼ˆPub/Subï¼‰åŠŸèƒ½ï¼Œå¯ä»¥ç”¨ä½œæ¶ˆæ¯ä¸­é—´ä»¶ã€‚å®ƒæ”¯æŒå¤šä¸ªæ¶ˆè´¹è€…è®¢é˜…åŒä¸€ä¸ªé¢‘é“ï¼Œæ”¯æŒæŒ‰ç…§æ¨¡å¼åŒ¹é…è®¢é˜…å¤šä¸ªé¢‘é“ï¼Œé€‚åˆç”¨äºå®æ—¶æ¨é€ã€å®æ—¶èŠå¤©ç­‰åœºæ™¯ã€‚</li><li><strong>è®¡æ•°å™¨</strong>ï¼šRedisçš„åŸå­æ€§æ“ä½œå¯ä»¥ç”¨äºè®¡æ•°å™¨çš„å®ç°ï¼Œå¦‚ç»Ÿè®¡ç½‘ç«™è®¿é—®é‡ã€å•†å“é”€å”®é‡ç­‰ã€‚</li><li><strong>åˆ†å¸ƒå¼é”</strong>ï¼šRedisæä¾›äº†SETNXå‘½ä»¤å¯ä»¥å®ç°åˆ†å¸ƒå¼é”ï¼Œä¿è¯åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªå®¢æˆ·ç«¯å¯ä»¥è®¿é—®æŸä¸ªèµ„æºï¼Œé˜²æ­¢æ•°æ®ç«äº‰é—®é¢˜çš„å‘ç”Ÿã€‚</li><li><strong>æ’è¡Œæ¦œ</strong>ï¼šRedisçš„æœ‰åºé›†åˆï¼ˆSorted Setï¼‰å¯ä»¥ç”¨äºå®ç°æ’è¡Œæ¦œï¼ŒæŒ‰ç…§æŸç§æŒ‡æ ‡è¿›è¡Œæ’åºï¼Œå¦‚æ ¹æ®ç”¨æˆ·ç§¯åˆ†ã€ç²‰ä¸æ•°ç­‰ã€‚</li><li><strong>åœ°ç†ä½ç½®</strong>ï¼šRedisæä¾›äº†åœ°ç†ä½ç½®ç´¢å¼•åŠŸèƒ½ï¼Œå¯ä»¥å°†ç»çº¬åº¦ä½œä¸ºscoreå­˜å‚¨åœ¨æœ‰åºé›†åˆä¸­ï¼Œå®ç°é™„è¿‘çš„äººã€é™„è¿‘çš„åº—ç­‰åŠŸèƒ½ã€‚</li></ol></blockquote><h2 id="why-is-redis-so-fast-â˜…" tabindex="-1"><a class="header-anchor" href="#why-is-redis-so-fast-â˜…" aria-hidden="true">#</a> Why is Redis so fast?â˜…</h2><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230212120504791.png" alt="image-20230212120504791"></p><blockquote><p>Redis is a fast data store due to several design choices made in its development:</p><ol><li><strong>In-Memory Storage</strong>: Redis stores all data in-memory, which eliminates the overhead of disk I/O, making it much faster than traditional disk-based databases.</li><li><strong>Data Structures</strong>: Redis supports a variety of data structures like strings, hashes, lists, sets, and sorted sets. These data structures are optimized for speed and are implemented in a way that is efficient and lightweight.</li><li><strong>Single-Threaded</strong>: Redis is single-threaded, which means that it processes all requests on a single CPU core, avoiding the overhead of context switching between threads or processes.</li><li><strong>Non-Blocking I/O</strong>: Redis uses non-blocking I/O, which allows it to handle a large number of simultaneous connections without blocking or slowing down other connections.</li><li><strong>Asynchronous Operations</strong>: Redis supports asynchronous operations, which means that a client can send multiple requests to Redis without waiting for a response to each request. This feature reduces latency and increases throughput.</li><li><strong>Optimized Algorithms</strong>: Redis uses several optimized algorithms, such as the LRU (Least Recently Used) eviction algorithm for cache expiration and the Skip List data structure for fast indexing and searching.</li></ol></blockquote><h2 id="redisèµ·æ­¥å®‰è£…" tabindex="-1"><a class="header-anchor" href="#redisèµ·æ­¥å®‰è£…" aria-hidden="true">#</a> Redisèµ·æ­¥å®‰è£…</h2><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221115141221935.png" alt="image-20221115141221935"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221115141239112.png" alt="image-20221115141239112"></p><h2 id="redisäº”å¤§åŸºæœ¬æ•°æ®ç±»å‹â˜…" tabindex="-1"><a class="header-anchor" href="#redisäº”å¤§åŸºæœ¬æ•°æ®ç±»å‹â˜…" aria-hidden="true">#</a> Redisäº”å¤§åŸºæœ¬æ•°æ®ç±»å‹â˜…</h2><blockquote><p><strong>5ç§åŸºç¡€æ•°æ®ç±»å‹</strong>ï¼Œå­—ç¬¦ä¸²(String)ã€åˆ—è¡¨(List)ã€é›†åˆ(Set)ã€æœ‰åºé›†åˆ(ZSet)å’Œå“ˆå¸Œ(Hash)ã€‚</p><ul><li><h3 id="å­—ç¬¦ä¸²-string" tabindex="-1"><a class="header-anchor" href="#å­—ç¬¦ä¸²-string" aria-hidden="true">#</a> <strong>å­—ç¬¦ä¸²(String)</strong></h3><ul><li><p>åº”ç”¨åœºæ™¯ï¼šå­—ç¬¦ä¸²ç±»å‹<strong>ä¸»è¦ç”¨äºå­˜å‚¨å•ä¸ªå€¼ï¼Œä¾‹å¦‚ç”¨æˆ·åã€å¯†ç ã€æ‰‹æœºå·ç­‰</strong>ã€‚æ­¤å¤–ï¼Œå­—ç¬¦ä¸²<strong>è¿˜å¯ä»¥ç”¨äºè®¡æ•°å™¨</strong>ã€<strong>ç¼“å­˜å’Œåˆ†å¸ƒå¼é”</strong>ç­‰ã€‚</p></li><li><p>ç‰¹ç‚¹ï¼šå­—ç¬¦ä¸²ç±»å‹çš„æœ€å¤§ç‰¹ç‚¹æ˜¯<strong>ç®€å•ã€é«˜æ•ˆï¼Œå®ƒå¯ä»¥å¿«é€Ÿåœ°å­˜å‚¨ã€è·å–ã€ä¿®æ”¹å’Œåˆ é™¤å•ä¸ªå€¼ï¼Œå¹¶ä¸”æ”¯æŒåŸå­æ€§æ“ä½œ</strong>ã€‚æ­¤å¤–ï¼Œå­—ç¬¦ä¸²ç±»å‹è¿˜<strong>æ”¯æŒè‡ªå¢ã€è‡ªå‡ç­‰æ“ä½œï¼Œå¯ä»¥æ–¹ä¾¿åœ°å®ç°è®¡æ•°å™¨</strong>ç­‰åŠŸèƒ½ã€‚</p></li><li><p>å¸¸ç”¨æ“ä½œæŒ‡ä»¤ï¼š</p><ul><li>SET key valueï¼šè®¾ç½®keyå¯¹åº”çš„value</li><li>GET keyï¼šè·å–keyå¯¹åº”çš„value</li><li>INCR keyï¼šå°†keyå¯¹åº”çš„valueåŠ 1</li><li>DECR keyï¼šå°†keyå¯¹åº”çš„valueå‡1</li><li>APPEND key valueï¼šåœ¨keyå¯¹åº”çš„valueåè¿½åŠ å­—ç¬¦ä¸²value</li></ul></li></ul></li><li><h3 id="åˆ—è¡¨-list" tabindex="-1"><a class="header-anchor" href="#åˆ—è¡¨-list" aria-hidden="true">#</a> <strong>åˆ—è¡¨(List)</strong></h3><ul><li><p>åº”ç”¨åœºæ™¯ï¼šåˆ—è¡¨ç±»å‹ä¸»è¦ç”¨äº<strong>å­˜å‚¨å¤šä¸ªå€¼</strong>ï¼Œä¾‹å¦‚<strong>ä»»åŠ¡é˜Ÿåˆ—ã€æ¶ˆæ¯é˜Ÿåˆ—ã€ç”¨æˆ·è¡Œä¸ºè®°å½•</strong>ç­‰ã€‚åˆ—è¡¨ç±»å‹è¿˜å¯ä»¥ç”¨äº<strong>å®ç°ç®€å•çš„ç¼“å­˜å’Œæ’è¡Œæ¦œ</strong>ç­‰ã€‚</p></li><li><p>ç‰¹ç‚¹ï¼šåˆ—è¡¨ç±»å‹çš„æœ€å¤§ç‰¹ç‚¹æ˜¯<strong>æœ‰åºã€å¯é‡å¤</strong>ã€‚å®ƒ<strong>å¯ä»¥å¿«é€Ÿåœ°åœ¨ä¸¤ç«¯æ·»åŠ ã€åˆ é™¤å…ƒç´ ï¼Œå¹¶ä¸”æ”¯æŒèŒƒå›´æŸ¥è¯¢ã€ä¿®å‰ªç­‰æ“ä½œ</strong>ï¼Œéå¸¸<strong>é€‚åˆç”¨ä½œé˜Ÿåˆ—å’Œæ ˆ</strong>ç­‰æ•°æ®ç»“æ„ã€‚</p></li><li><p>å¸¸ç”¨æ“ä½œæŒ‡ä»¤ï¼š</p><ul><li>LPUSH key value [value...]ï¼šå°†ä¸€ä¸ªæˆ–å¤šä¸ªå€¼æ’å…¥åˆ°åˆ—è¡¨çš„å¤´éƒ¨</li><li>RPUSH key value [value...]ï¼šå°†ä¸€ä¸ªæˆ–å¤šä¸ªå€¼æ’å…¥åˆ°åˆ—è¡¨çš„å°¾éƒ¨</li><li>LPOP keyï¼šç§»é™¤å¹¶è¿”å›åˆ—è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ </li><li>RPOP keyï¼šç§»é™¤å¹¶è¿”å›åˆ—è¡¨çš„æœ€åä¸€ä¸ªå…ƒç´ </li><li>LRANGE key start stopï¼šè·å–åˆ—è¡¨ä»startåˆ°stopèŒƒå›´å†…çš„å…ƒç´ </li></ul></li></ul></li><li><h3 id="é›†åˆ-set" tabindex="-1"><a class="header-anchor" href="#é›†åˆ-set" aria-hidden="true">#</a> <strong>é›†åˆ(Set)</strong></h3><ul><li><p>åº”ç”¨åœºæ™¯ï¼šé›†åˆç±»å‹ä¸»è¦ç”¨äº<strong>å­˜å‚¨å”¯ä¸€å€¼</strong>ï¼Œä¾‹å¦‚<strong>ç”¨æˆ·æ ‡ç­¾ã€å¥½å‹å…³ç³»ã€ç‚¹èµè®°å½•</strong>ç­‰ã€‚é›†åˆç±»å‹è¿˜å¯ä»¥<strong>ç”¨äºè®¡ç®—å…±åŒå…³æ³¨ã€å…±åŒç‚¹èµ</strong>ç­‰ã€‚</p></li><li><p>ç‰¹ç‚¹ï¼šé›†åˆç±»å‹çš„æœ€å¤§ç‰¹ç‚¹æ˜¯<strong>æ— åºã€ä¸å¯é‡å¤</strong>ã€‚å®ƒ<strong>å¯ä»¥å¿«é€Ÿåœ°æ·»åŠ ã€åˆ é™¤å…ƒç´ </strong>ï¼Œå¹¶ä¸”æ”¯æŒ<strong>æ±‚äº¤ã€æ±‚å¹¶ã€æ±‚å·®</strong>ç­‰æ“ä½œï¼Œéå¸¸é€‚åˆç”¨ä½œ<strong>å»é‡å’Œç­›é€‰æ•°æ®</strong>ã€‚</p></li><li><p>å¸¸ç”¨æ“ä½œæŒ‡ä»¤ï¼š</p><ul><li>SADD key member [member...]ï¼šå°†ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ æ·»åŠ åˆ°é›†åˆä¸­</li><li>SMEMBERS keyï¼šè·å–é›†åˆä¸­çš„æ‰€æœ‰å…ƒç´ </li><li>SINTER key [key...]ï¼šè·å–å¤šä¸ªé›†åˆçš„äº¤é›†</li><li>SUNION key [key...]ï¼šè·å–å¤šä¸ªé›†åˆçš„å¹¶é›†</li><li>SREM key member [member...]ï¼šä»é›†åˆä¸­ç§»é™¤ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ </li></ul></li></ul></li><li><h3 id="æœ‰åºé›†åˆ-zset" tabindex="-1"><a class="header-anchor" href="#æœ‰åºé›†åˆ-zset" aria-hidden="true">#</a> <strong>æœ‰åºé›†åˆ(ZSet)</strong></h3><ul><li><p>åº”ç”¨åœºæ™¯ï¼šæœ‰åºé›†åˆç±»å‹ä¸»è¦ç”¨äº<strong>å­˜å‚¨å¸¦æƒå€¼çš„å”¯ä¸€å€¼</strong>ï¼Œä¾‹å¦‚<strong>æ’è¡Œæ¦œã€æœç´¢å»ºè®®</strong>ç­‰ã€‚æœ‰åºé›†åˆç±»å‹è¿˜å¯ä»¥ç”¨äº<strong>å®ç°ç®€å•çš„é™æµã€å»¶æ—¶é˜Ÿåˆ—</strong>ç­‰ã€‚</p></li><li><p>ç‰¹ç‚¹ï¼šæœ‰åºé›†åˆç±»å‹çš„æœ€å¤§ç‰¹ç‚¹æ˜¯<strong>æœ‰åºã€ä¸å¯é‡å¤</strong>ã€‚å®ƒå¯ä»¥<strong>å¿«é€Ÿåœ°æ·»åŠ ã€åˆ é™¤å…ƒç´ </strong>ï¼Œå¹¶ä¸”æ”¯æŒ<strong>æŒ‰ç…§æƒå€¼èŒƒå›´æŸ¥è¯¢ã€ä¿®å‰ªç­‰æ“ä½œ</strong>ï¼Œéå¸¸é€‚åˆç”¨ä½œ<strong>æ’è¡Œæ¦œå’Œæ’åº</strong>ç­‰ã€‚</p></li><li><p>å¸¸ç”¨æ“ä½œæŒ‡ä»¤ï¼š</p><ul><li>ZADD key score member [score member...]ï¼šå‘æœ‰åºé›†åˆä¸­æ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ </li><li>ZRANGE key start stop [WITHSCORES]ï¼šè·å–æœ‰åºé›†åˆä»startåˆ°stopèŒƒå›´å†…çš„å…ƒç´ </li><li>ZRANK key memberï¼šè·å–æœ‰åºé›†åˆä¸­å…ƒç´ çš„æ’å</li><li>ZINCRBY key increment memberï¼šå°†æœ‰åºé›†åˆä¸­å…ƒç´ çš„åˆ†å€¼å¢åŠ æŒ‡å®šçš„increment</li></ul></li></ul></li><li><h3 id="å“ˆå¸Œ-hash" tabindex="-1"><a class="header-anchor" href="#å“ˆå¸Œ-hash" aria-hidden="true">#</a> <strong>å“ˆå¸Œ(Hash)</strong></h3><ul><li>åº”ç”¨åœºæ™¯ï¼šå“ˆå¸Œç±»å‹ä¸»è¦ç”¨äº<strong>å­˜å‚¨å¤šä¸ªå­—æ®µå’Œå€¼çš„æ˜ å°„å…³ç³»</strong>ï¼Œä¾‹å¦‚<strong>ç”¨æˆ·ä¿¡æ¯ã€å•†å“ä¿¡æ¯</strong>ç­‰ï¼Œ<strong>è´­ç‰©è½¦</strong>ã€‚å“ˆå¸Œç±»å‹è¿˜å¯ä»¥ç”¨äº<strong>å®ç°ç®€å•çš„ç¼“å­˜å’Œè®¡æ•°å™¨</strong>ç­‰ã€‚</li><li>ç‰¹ç‚¹ï¼šå¯ä»¥<strong>å­˜å‚¨å¤šä¸ªé”®å€¼å¯¹</strong>æ”¯æŒ<strong>å¯¹å•ä¸ªå­—æ®µè¿›è¡Œè¯»å†™æ“ä½œ</strong>ï¼Œé€‚åˆå­˜å‚¨ç»“æ„åŒ–æ•°æ®å¯ä»¥å¯¹å­—æ®µè¿›è¡Œè‡ªå¢ã€è‡ªå‡ç­‰æ“ä½œå¸¸ç”¨äºå­˜å‚¨ç»“æ„åŒ–æ•°æ®</li><li>å¸¸ç”¨æ“ä½œæŒ‡ä»¤ï¼š <ul><li>HSET key field valueï¼šè®¾ç½®å“ˆå¸Œkeyä¸­çš„ä¸€ä¸ªå­—æ®µçš„å€¼</li><li>HGET key fieldï¼šè·å–å“ˆå¸Œkeyä¸­çš„ä¸€ä¸ªå­—æ®µçš„å€¼</li><li>HGETALL keyï¼šè·å–å“ˆå¸Œkeyä¸­çš„æ‰€æœ‰å­—æ®µå’Œå€¼</li><li>HINCRBY key field incrementï¼šå°†å“ˆå¸Œkeyä¸­çš„ä¸€ä¸ªå­—æ®µçš„å€¼å¢åŠ æŒ‡å®šçš„increment</li><li>HDEL key field [field...]ï¼šåˆ é™¤å“ˆå¸Œkeyä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªå­—æ®µ</li></ul></li></ul></li></ul></blockquote><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230328104653679.png" alt="image-20230328104653679"></p><h3 id="äº”ç§å¯¹è±¡ç±»å‹" tabindex="-1"><a class="header-anchor" href="#äº”ç§å¯¹è±¡ç±»å‹" aria-hidden="true">#</a> äº”ç§å¯¹è±¡ç±»å‹</h3><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230409141916190.png" alt="image-20230409141916190"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230409140910581.png" alt="image-20230409140910581"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230409142100603.png" alt="image-20230409142100603"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230409141032351.png" alt="image-20230409141032351"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230409140605779.png" alt="image-20230409140605779"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230409141104918.png" alt="image-20230409141104918"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230409141134881.png" alt="image-20230409141134881"></p><h3 id="åº•å±‚æ•°æ®ç»“æ„" tabindex="-1"><a class="header-anchor" href="#åº•å±‚æ•°æ®ç»“æ„" aria-hidden="true">#</a> åº•å±‚æ•°æ®ç»“æ„</h3><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230328104955156.png" alt="image-20230328104955156"></p><h4 id="sds-simple-dynamic-string" tabindex="-1"><a class="header-anchor" href="#sds-simple-dynamic-string" aria-hidden="true">#</a> SDSï¼ˆSimple Dynamic Stringï¼‰</h4><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230409122612787.png" alt="image-20230409122612787"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230409121348233.png" alt="image-20230409121348233"></p><h4 id="é“¾è¡¨-linked-list" tabindex="-1"><a class="header-anchor" href="#é“¾è¡¨-linked-list" aria-hidden="true">#</a> é“¾è¡¨(Linked List)</h4><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230409122951549.png" alt="image-20230409122951549"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230409122856697.png" alt="image-20230409122856697"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230409122906810.png" alt="image-20230409122906810"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230409122824254.png" alt="image-20230409122824254"></p><h4 id="å­—å…¸-dict" tabindex="-1"><a class="header-anchor" href="#å­—å…¸-dict" aria-hidden="true">#</a> å­—å…¸ï¼ˆDictï¼‰</h4><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230409123217972.png" alt="image-20230409123217972"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230409124754271.png" alt="image-20230409124754271"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230409123429176.png" alt="image-20230409123429176"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230409124241957.png" alt="image-20230409124241957"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230409124538504.png" alt="image-20230409124538504"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230409123702230.png" alt="image-20230409123702230"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230409124838687.png" alt="image-20230409124838687"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230409124850690.png" alt="image-20230409124850690"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230409125551609.png" alt="image-20230409125551609"></p><h4 id="skiplist" tabindex="-1"><a class="header-anchor" href="#skiplist" aria-hidden="true">#</a> SkipList</h4><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230409132010588.png" alt="image-20230409132010588"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230409130137039.png" alt="image-20230409130137039"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230409131228487.png" alt="image-20230409131228487"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230409130434768.png" alt="image-20230409130434768"></p><h4 id="intset" tabindex="-1"><a class="header-anchor" href="#intset" aria-hidden="true">#</a> Intset</h4><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230409132318202.png" alt="image-20230409132318202"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230409132436926.png" alt="image-20230409132436926"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230409132618190.png" alt="image-20230409132618190"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230409132629259.png" alt="image-20230409132629259"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230409133126113.png" alt="image-20230409133126113"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230409133149043.png" alt="image-20230409133149043"></p><h4 id="ziplist" tabindex="-1"><a class="header-anchor" href="#ziplist" aria-hidden="true">#</a> ZipList</h4><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230409134849566.png" alt="image-20230409134849566"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230409134957339.png" alt="image-20230409134957339"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230409134922408.png" alt="image-20230409134922408"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230409134939508.png" alt="image-20230409134939508"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230409135125113.png" alt="image-20230409135125113"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230409135451618.png" alt="image-20230409135451618"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230409135505088.png" alt="image-20230409135505088"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230409135525066.png" alt="image-20230409135525066"></p><h2 id="redis6æ–°çš„æ•°æ®ç±»å‹" tabindex="-1"><a class="header-anchor" href="#redis6æ–°çš„æ•°æ®ç±»å‹" aria-hidden="true">#</a> Redis6æ–°çš„æ•°æ®ç±»å‹</h2><h3 id="bitmap" tabindex="-1"><a class="header-anchor" href="#bitmap" aria-hidden="true">#</a> BitMap</h3><p>ä¸“é—¨<strong>è¿›è¡Œä½æ“ä½œçš„å­—ç¬¦ä¸²</strong></p><p>ä½å›¾<a href="https://www.cnblogs.com/cjsblog/p/11613708.html" target="_blank" rel="noopener noreferrer">Bitmapç®€ä»‹ - åºŸç‰©å¤§å¸ˆå…„ - åšå®¢å›­ (cnblogs.com)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221115210832052.png" alt="image-20221115210832052"></p><p>è‹¥<strong>æ´»è·ƒç”¨æˆ·é‡å¹¶ä¸å¤§</strong> åˆ™<strong>ä¸æ¨èä½¿ç”¨bitmap</strong></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221115211029253.png" alt="image-20221115211029253"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221115210557976.png" alt="image-20221115210557976"></p><h4 id="ä½å›¾åº”ç”¨åŸç†" tabindex="-1"><a class="header-anchor" href="#ä½å›¾åº”ç”¨åŸç†" aria-hidden="true">#</a> ä½å›¾åº”ç”¨åŸç†</h4><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221115210707353.png" alt="image-20221115210707353"></p><h4 id="ä½å›¾å¸¸ç”¨å‘½ä»¤" tabindex="-1"><a class="header-anchor" href="#ä½å›¾å¸¸ç”¨å‘½ä»¤" aria-hidden="true">#</a> ä½å›¾å¸¸ç”¨å‘½ä»¤</h4><h5 id="_1-setbitå‘½ä»¤" tabindex="-1"><a class="header-anchor" href="#_1-setbitå‘½ä»¤" aria-hidden="true">#</a> 1) SETBITå‘½ä»¤</h5><p>ç”¨æ¥è®¾ç½®æˆ–è€…æ¸…é™¤æŸä¸€ä½ä¸Šçš„å€¼ï¼Œå…¶è¿”å›å€¼æ˜¯åŸæ¥ä½ä¸Šå­˜å‚¨çš„å€¼ã€‚key åœ¨åˆå§‹çŠ¶æ€ä¸‹æ‰€æœ‰çš„ä½éƒ½ä¸º 0 ï¼Œè¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>SETBIT key offset value
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å…¶ä¸­ offset è¡¨ç¤ºåç§»é‡ï¼Œä» 0 å¼€å§‹ã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>127.0.0.1:6379&gt; SET user:1 a
OK
#è®¾ç½®åç§»é‡ä¸º0
127.0.0.1:6379&gt; SETBIT user:1 0 1
(integer) 0
#å½“å¯¹åº”ä½çš„å­—ç¬¦æ˜¯ä¸å¯æ‰“å°å­—ç¬¦ï¼Œredisä¼šä»¥16è¿›åˆ¶å½¢å¼æ˜¾ç¤º
127.0.0.1:6379&gt; GET user:1
&quot;\xe1&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_2-getbitå‘½ä»¤" tabindex="-1"><a class="header-anchor" href="#_2-getbitå‘½ä»¤" aria-hidden="true">#</a> 2) GETBITå‘½ä»¤</h5><p>ç”¨æ¥è·å–æŸä¸€ä½ä¸Šçš„å€¼ã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>127.0.0.1:6379&gt; GETBIT user:1 0
(integer) 1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“åç§»é‡ offset æ¯”å­—ç¬¦ä¸²çš„é•¿åº¦å¤§ï¼Œæˆ–è€…å½“ key ä¸å­˜åœ¨æ—¶ï¼Œè¿”å› 0ã€‚</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>redis&gt; EXISTS bits
(integer) 0
redis&gt; GETBIT bits 100000
(integer) 0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_3-bitcountå‘½ä»¤" tabindex="-1"><a class="header-anchor" href="#_3-bitcountå‘½ä»¤" aria-hidden="true">#</a> 3) BITCOUNTå‘½ä»¤</h5><p>ç»Ÿè®¡æŒ‡å®šä½åŒºé—´ä¸Šï¼Œå€¼ä¸º 1 çš„ä¸ªæ•°ã€‚è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>BITCOUNT key [start end]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>127.0.0.1:6379&gt; BITCOUNT user:1
(integer) 8
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡æŒ‡å®šçš„ start å’Œ end å‚æ•°ï¼Œå¯ä»¥è®©è®¡æ•°åªåœ¨ç‰¹å®šçš„å­—èŠ‚ä¸Šè¿›è¡Œã€‚start å’Œ end å‚æ•°å’Œ <a href="http://c.biancheng.net/redis2/getrange.html" target="_blank" rel="noopener noreferrer">GETRANGE<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> å‘½ä»¤çš„å‚æ•°ç±»ä¼¼ï¼Œéƒ½å¯ä»¥ä½¿ç”¨è´Ÿæ•°ï¼Œæ¯”å¦‚ -1 è¡¨ç¤ºå€’æ•°ç¬¬ä¸€ä¸ªä½ï¼Œ -2 è¡¨ç¤ºå€’æ•°ç¬¬äºŒä¸ªä½ã€‚</p><h5 id="_4-bitopå‘½ä»¤" tabindex="-1"><a class="header-anchor" href="#_4-bitopå‘½ä»¤" aria-hidden="true">#</a> 4ï¼‰BITOPå‘½ä»¤</h5><p>and</p><p>or</p><h3 id="hyperloglog" tabindex="-1"><a class="header-anchor" href="#hyperloglog" aria-hidden="true">#</a> Hyperloglog</h3><p><strong>é«˜æ•ˆè®¡ç®—åŸºæ•°</strong></p><p>åŸºæ•°ï¼ˆä¸é‡å¤å…ƒç´ ä¸ªæ•°ï¼‰</p><p>ç»Ÿè®¡çš„<strong>è¯¯å·®ç‡æ˜¯0.81%ã€‚</strong></p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>ä¾‹å¦‚é›†åˆä¸­å…ƒç´ æœ‰{1ï¼Œ3ï¼Œ5ï¼Œ7ï¼Œ5ï¼Œ3ï¼Œ8}
åŸºæ•°ï¼ˆä¸é‡å¤å…ƒç´ ï¼‰åˆ™ä¸º5{1ï¼Œ3ï¼Œ5ï¼Œ7ï¼Œ8}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>è§£å†³åŸºæ•°é—®é¢˜çš„å¤šç§æ–¹æ¡ˆ</p><p><strong>MySQL</strong>ä¸­çš„ <strong>select distinct count</strong> è®¡ç®—ä¸é‡å¤å…ƒç´ </p><p><strong>Redis</strong>ä¸­ <strong>hashï¼Œsetï¼Œbitmap</strong>ç­‰æ•°æ®ç»“æ„å¤„ç†</p><p>ä¸Šè¿°æ–¹å¼è™½ç„¶å¯ä»¥å®Œæˆéœ€æ±‚ä¸”ç²¾ç¡® ä½†æ˜¯<strong>éšç€æ•°æ®é‡çš„å‰§å¢</strong> ä¼š<strong>å¯¼è‡´ç©ºé—´å ç”¨é—®é¢˜</strong> å¯¹äºå¤§æ•°æ®é‡çš„æ•°æ®æ˜¯ä¸åˆ‡å®é™…çš„</p><p>å› æ­¤æ¨å‡º<strong>Hyperloglogï¼ˆåŸºæ•°ç»Ÿè®¡ç®—æ³•ï¼‰</strong></p><p>åœ¨Redisä¸­ï¼›æ¯ä¸ªHyperLogLogé”®åªéœ€è¦èŠ±è´¹12KBå†…å­˜ï¼Œå°±å¯ä»¥è®¡ç®—å‡º2^64ä¸ªä¸åŒå…ƒç´ çš„åŸºæ•°ã€‚</p><h4 id="åº”ç”¨åœºæ™¯" tabindex="-1"><a class="header-anchor" href="#åº”ç”¨åœºæ™¯" aria-hidden="true">#</a> åº”ç”¨åœºæ™¯</h4><p>å¼€å‘ä¸­ï¼šç»Ÿè®¡ç½‘ç«™PVï¼ˆ<strong>PageViewé¡µé¢è®¿é—®é‡</strong>ï¼‰<strong>å…è®¸ä¸€å®šçš„è¯¯å·®</strong></p><h4 id="å‘½ä»¤" tabindex="-1"><a class="header-anchor" href="#å‘½ä»¤" aria-hidden="true">#</a> å‘½ä»¤</h4><p>pfadd datalist ï¼ˆæ·»åŠ æ•°æ®é›†-æ— æ³•æ·»åŠ é‡å¤çš„ï¼‰</p><p>pfcount datalist ï¼ˆç»Ÿè®¡æ•°æ®é›†ï¼‰</p><p>pfmerge åˆå¹¶ä¸ºå“ªä¸ªkey è¦åˆå¹¶çš„key1 è¦åˆå¹¶çš„key2 ï¼ˆåˆå¹¶æ•°æ®-è‡ªåŠ¨å»é‡ï¼‰</p><h3 id="grographic" tabindex="-1"><a class="header-anchor" href="#grographic" aria-hidden="true">#</a> Grographic</h3><p><strong>åœ°ç†ä½ç½® åŸå¸‚ç»çº¬åº¦æŸ¥è¯¢ èŒƒå›´æŸ¥è¯¢ è·ç¦»æŸ¥è¯¢ ç»çº¬åº¦hashå€¼ ç›¸å…³æ“ä½œ</strong></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221115233106371.png" alt="image-20221115233106371"></p><h5 id="_1geoadd-æ·»åŠ -ã€geopos-æŸ¥çœ‹-ã€geodist-è®¡ç®—è·ç¦»-æ“ä½œ" tabindex="-1"><a class="header-anchor" href="#_1geoadd-æ·»åŠ -ã€geopos-æŸ¥çœ‹-ã€geodist-è®¡ç®—è·ç¦»-æ“ä½œ" aria-hidden="true">#</a> â‘ geoaddï¼ˆæ·»åŠ ï¼‰ã€geoposï¼ˆæŸ¥çœ‹ï¼‰ã€geodistï¼ˆè®¡ç®—è·ç¦»ï¼‰æ“ä½œ</h5><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>127.0.0.1:6379&gt; geoadd city 118.8921 31.32751 nanjing 197.30794 31.79322  
#å½“ç»çº¬åº¦å…¶ä¸­ä¸€ä¸ªæˆ–è€…ä¸¤ä¸ªè¶…è¿‡ç•Œé™å€¼ï¼ŒæŠ¥é”™ï¼Œä¿¡æ¯å¦‚ä¸‹ï¼š
(error) ERR syntax error. Try GEOADD key [x1] [y1] [name1] [x2] [y2] [name2] ...
#æ·»åŠ åŸå¸‚ç»çº¬åº¦ è¯­æ³•æ ¼å¼ï¼š geoadd key ç»åº¦ çº¬åº¦ name +++å¯å¤šä¸ªæ·»åŠ 
#æ·»åŠ æˆåŠŸåè¿”å›æ·»åŠ æˆåŠŸçš„æ•°é‡å€¼
127.0.0.1:6379&gt; geoadd city 118.8921 31.32751 nanjing 117.30794 31.79322 hefei 102.82147 24.88554 kunming 91.13775 29.65262 lasa 116.23128 40.22077 beijing 106.54041 29.40268 chongqing  
(integer) 6
127.0.0.1:6379&gt; ZRANGE city 0 -1  #æ³¨æ„ï¼šgeoçš„æŸ¥çœ‹æ–¹å¼å’Œzsetçš„å‘½ä»¤æ˜¯ä¸€è‡´çš„ï¼Œ
#ç”±æ­¤å¯çŸ¥ï¼Œgeoæœ¬è´¨ä¸Šè¿˜æ˜¯ä¸ªé›†åˆï¼Œä¸è¿‡Rediså®˜æ–¹å¯¹å…¶è¿›è¡Œäº†äºŒæ¬¡å°è£…
1) &quot;lasa&quot;
2) &quot;kunming&quot;
3) &quot;chongqing&quot;
4) &quot;hefei&quot;
5) &quot;nanjing&quot;
6) &quot;beijing&quot;
127.0.0.1:6379&gt; geopos city nanjing  #æŸ¥çœ‹çœ‹æŒ‡å®šåŸå¸‚çš„ç»çº¬åº¦ä¿¡æ¯
1) 1) &quot;118.89209836721420288&quot;
   2) &quot;31.32750976275760735&quot;
127.0.0.1:6379&gt; geopos city nanjing beijing  #æŸ¥çœ‹çœ‹å¤šä¸ªåŸå¸‚çš„ç»çº¬åº¦ä¿¡æ¯
1) 1) &quot;118.89209836721420288&quot;
   2) &quot;31.32750976275760735&quot;
2) 1) &quot;116.23128265142440796&quot;
   2) &quot;40.22076905438526495&quot;
127.0.0.1:6379&gt; geodist city nanjing beijing   #è®¡ç®—å—äº¬åˆ°åŒ—äº¬ä¹‹é—´çš„è·ç¦»ï¼Œé»˜è®¤è¿”å›å•ä½æ˜¯m
&quot;1017743.1413&quot;
127.0.0.1:6379&gt; geodist city nanjing beijing km  #km  åƒç±³
&quot;1017.7431&quot;
127.0.0.1:6379&gt; geodist city nanjing beijing mi  #mi  è‹±é‡Œ
&quot;632.3978&quot;
127.0.0.1:6379&gt; geodist city nanjing beijing ft  #ft  è‹±å°º
&quot;3339052.3010&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_2georadius-æŸ¥è¯¢é™„è¿‘ä½ç½®-æ“ä½œ" tabindex="-1"><a class="header-anchor" href="#_2georadius-æŸ¥è¯¢é™„è¿‘ä½ç½®-æ“ä½œ" aria-hidden="true">#</a> â‘¡georadiusï¼ˆæŸ¥è¯¢é™„è¿‘ä½ç½®ï¼‰æ“ä½œ</h5><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>127.0.0.1:6379&gt; ZRANGE city 0 -1  #æŸ¥çœ‹åŸå¸‚
1) &quot;lasa&quot;
2) &quot;kunming&quot;
3) &quot;chongqing&quot;
4) &quot;hefei&quot;
5) &quot;nanjing&quot;
6) &quot;beijing&quot;
#æŸ¥çœ‹æŒ‡å®šä½ç½®çš„1000å…¬é‡ŒèŒƒå›´å†…æœ‰å“ªäº›åŸå¸‚
127.0.0.1:6379&gt; georadius city 120 38 1000 km  
1) &quot;beijing&quot;
2) &quot;hefei&quot;
3) &quot;nanjing&quot;
127.0.0.1:6379&gt; georadius city 120 38 400 km  #æŸ¥çœ‹æŒ‡å®šä½ç½®çš„400å…¬é‡ŒèŒƒå›´å†…æœ‰å“ªäº›åŸå¸‚
(empty array)
127.0.0.1:6379&gt; georadius city 120 38 550 km  #æŸ¥çœ‹æŒ‡å®šä½ç½®çš„550å…¬é‡ŒèŒƒå›´å†…æœ‰å“ªäº›åŸå¸‚
1) &quot;beijing&quot;
#æŸ¥çœ‹æŒ‡å®šä½ç½®çš„550å…¬é‡ŒèŒƒå›´å†…æœ‰å“ªäº›åŸå¸‚,withcoordæŒ‡å®šè¿”å›åŸå¸‚çš„name
127.0.0.1:6379&gt; georadius city 120 38 1000 km withcoord
1) 1) &quot;beijing&quot;
   2) 1) &quot;116.23128265142440796&quot;
      2) &quot;40.22076905438526495&quot;
2) 1) &quot;hefei&quot;
   2) 1) &quot;117.30793744325637817&quot;
      2) &quot;31.79321915080526395&quot;
3) 1) &quot;nanjing&quot;
   2) 1) &quot;118.89209836721420288&quot;
      2) &quot;31.32750976275760735&quot;
#æŸ¥çœ‹æŒ‡å®šä½ç½®çš„550å…¬é‡ŒèŒƒå›´å†…æœ‰å“ªäº›åŸå¸‚,withdistæŒ‡å®šè¿”å›åŸå¸‚çš„â€™ç»çº¬åº¦â€˜å€¼
127.0.0.1:6379&gt; georadius city 120 38 1000 km withcoord withdist
1) 1) &quot;beijing&quot;
   2) &quot;408.3496&quot;
   3) 1) &quot;116.23128265142440796&quot;
      2) &quot;40.22076905438526495&quot;
2) 1) &quot;hefei&quot;
   2) &quot;732.6371&quot;
   3) 1) &quot;117.30793744325637817&quot;
      2) &quot;31.79321915080526395&quot;
3) 1) &quot;nanjing&quot;
   2) &quot;749.0265&quot;
   3) 1) &quot;118.89209836721420288&quot;
      2) &quot;31.32750976275760735&quot;
#æŸ¥çœ‹æŒ‡å®šä½ç½®çš„550å…¬é‡ŒèŒƒå›´å†…æœ‰å“ªäº›åŸå¸‚,withhashæŒ‡å®šè¿”å›åŸå¸‚çš„â€™ç»çº¬åº¦â€˜çš„hashå€¼
#å¦‚æœä¸¤ä¸ªåŸå¸‚çš„hashå€¼è¶Šâ€™åƒâ€˜ï¼Œè¯æ˜åŸå¸‚è·ç¦»è¶Šè¿‘ï¼
127.0.0.1:6379&gt; georadius city 120 38 1000 km withcoord withdist withhash
1) 1) &quot;beijing&quot;
   2) &quot;408.3496&quot;
   3) (integer) 4069896088584598
   4) 1) &quot;116.23128265142440796&quot;
      2) &quot;40.22076905438526495&quot;
2) 1) &quot;hefei&quot;
   2) &quot;732.6371&quot;
   3) (integer) 4052763834193093
   4) 1) &quot;117.30793744325637817&quot;
      2) &quot;31.79321915080526395&quot;
3) 1) &quot;nanjing&quot;
   2) &quot;749.0265&quot;
   3) (integer) 4054278565840695
   4) 1) &quot;118.89209836721420288&quot;
      2) &quot;31.32750976275760735&quot;
#æŸ¥çœ‹æŒ‡å®šä½ç½®çš„550å…¬é‡ŒèŒƒå›´å†…æœ‰å“ªäº›åŸå¸‚,count num æŒ‡å®šè¿”å›â€™numâ€˜ä¸ªåŸå¸‚æ•°æ®é‡
127.0.0.1:6379&gt; georadius city 120 38 1000 km withcoord withdist withhash count 2
1) 1) &quot;beijing&quot;
   2) &quot;408.3496&quot;
   3) (integer) 4069896088584598
   4) 1) &quot;116.23128265142440796&quot;
      2) &quot;40.22076905438526495&quot;
2) 1) &quot;hefei&quot;
   2) &quot;732.6371&quot;
   3) (integer) 4052763834193093
   4) 1) &quot;117.30793744325637817&quot;
      2) &quot;31.79321915080526395&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_3-georadiusbymember-æŸ¥æ‰¾æŒ‡å®šå…ƒç´ æŒ‡å®šèŒƒå›´å†…çš„å…ƒç´ -ã€geohash-è¿”å›ç»çº¬åº¦çš„hashå€¼-ã€zrangeã€zrem-ä½¿ç”¨zsetå‘½ä»¤æ“ä½œgeo" tabindex="-1"><a class="header-anchor" href="#_3-georadiusbymember-æŸ¥æ‰¾æŒ‡å®šå…ƒç´ æŒ‡å®šèŒƒå›´å†…çš„å…ƒç´ -ã€geohash-è¿”å›ç»çº¬åº¦çš„hashå€¼-ã€zrangeã€zrem-ä½¿ç”¨zsetå‘½ä»¤æ“ä½œgeo" aria-hidden="true">#</a> â‘¢ georadiusbymember ï¼ˆæŸ¥æ‰¾æŒ‡å®šå…ƒç´ æŒ‡å®šèŒƒå›´å†…çš„å…ƒç´ ï¼‰ã€geohash ï¼ˆè¿”å›ç»çº¬åº¦çš„hashå€¼ï¼‰ã€zrangeã€zremï¼ˆä½¿ç”¨zsetå‘½ä»¤æ“ä½œgeoï¼‰</h5><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>#æŸ¥è¯¢å—äº¬ 500å…¬é‡ŒèŒƒå›´æœ‰å“ªäº›åŸå¸‚
127.0.0.1:6379&gt; georadiusbymember city nanjing 500 km
1) &quot;hefei&quot;
2) &quot;nanjing&quot;
#æŸ¥è¯¢é‡åº† 1500å…¬é‡ŒèŒƒå›´æœ‰å“ªäº›åŸå¸‚
127.0.0.1:6379&gt; georadiusbymember city chongqing 1500 km
1) &quot;lasa&quot;
2) &quot;kunming&quot;
3) &quot;chongqing&quot;
4) &quot;hefei&quot;
5) &quot;nanjing&quot;
6) &quot;beijing&quot;
#è¿”å›åŒ—äº¬å’Œå—äº¬çš„ç»çº¬åº¦çš„ hashå€¼
127.0.0.1:6379&gt; geohash city beijing nanjing
1) &quot;wx4sucvncn0&quot;
2) &quot;wtsd1qyxfx0&quot;
#æŸ¥çœ‹æ‰€æœ‰åŸå¸‚name
127.0.0.1:6379&gt; ZRANGE city 0 -1
1) &quot;lasa&quot;
2) &quot;kunming&quot;
3) &quot;chongqing&quot;
4) &quot;hefei&quot;
5) &quot;nanjing&quot;
6) &quot;beijing&quot;
#æ ¹æ®geoä¸­çš„nameåˆ é™¤gå…ƒç´ 
127.0.0.1:6379&gt; ZREM city lasa
(integer) 1
#åˆ é™¤æˆåŠŸ
127.0.0.1:6379&gt; ZRANGE city 0 -1
1) &quot;kunming&quot;
2) &quot;chongqing&quot;
3) &quot;hefei&quot;
4) &quot;nanjing&quot;
5) &quot;beijing&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="é…ç½®æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#é…ç½®æ–‡ä»¶" aria-hidden="true">#</a> é…ç½®æ–‡ä»¶</h2><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221115203607198.png" alt="image-20221115203607198"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221115203549707.png" alt="image-20221115203549707"></p><p><strong>ä¸»è¦çš„é…ç½®é¡¹</strong></p><table><thead><tr><th>é…ç½®é¡¹</th><th>å‚æ•°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>daemonize</td><td>no/yes</td><td>é»˜è®¤ä¸º noï¼Œè¡¨ç¤º Redis ä¸æ˜¯ä»¥å®ˆæŠ¤è¿›ç¨‹çš„æ–¹å¼è¿è¡Œï¼Œé€šè¿‡ä¿®æ”¹ä¸º yes å¯ç”¨å®ˆæŠ¤è¿›ç¨‹ã€‚</td></tr><tr><td>pidfile</td><td>æ–‡ä»¶è·¯å¾„</td><td>å½“ Redis ä»¥å®ˆæŠ¤è¿›ç¨‹æ–¹å¼è¿è¡Œæ—¶ï¼Œä¼šæŠŠè¿›ç¨‹ pid å†™å…¥è‡ªå®šä¹‰çš„æ–‡ä»¶ä¸­ã€‚</td></tr><tr><td>port</td><td>6379</td><td>æŒ‡å®š Redis ç›‘å¬ç«¯å£ï¼Œé»˜è®¤ç«¯å£ä¸º 6379ã€‚</td></tr><tr><td>bind</td><td>127.0.0.1</td><td>ç»‘å®šçš„ä¸»æœºåœ°å€ã€‚</td></tr><tr><td>timeout</td><td>0</td><td>å®¢æˆ·ç«¯é—²ç½®å¤šé•¿ç§’åå…³é—­è¿æ¥ï¼Œè‹¥æŒ‡å®šä¸º 0 ï¼Œè¡¨ç¤ºä¸å¯ç”¨è¯¥åŠŸèƒ½ã€‚</td></tr><tr><td>loglevel</td><td>notice</td><td>æŒ‡å®šæ—¥å¿—è®°å½•çº§åˆ«ï¼Œæ”¯æŒå››ä¸ªçº§åˆ«ï¼šdebugã€verboseã€noticeã€warningï¼Œé»˜è®¤ä¸º noticeã€‚</td></tr><tr><td>logfile</td><td>stdout</td><td>æ—¥å¿—è®°å½•æ–¹å¼ï¼Œé»˜è®¤ä¸ºæ ‡å‡†è¾“å‡ºã€‚</td></tr><tr><td>databases</td><td>16</td><td>è®¾ç½®æ•°æ®åº“çš„æ•°é‡ï¼ˆ0-15ä¸ªï¼‰å…±16ä¸ªï¼ŒRedis é»˜è®¤é€‰æ‹©çš„æ˜¯ 0 åº“ï¼Œå¯ä»¥ä½¿ç”¨ SELECT å‘½ä»¤æ¥é€‰æ‹©ä½¿ç”¨å“ªä¸ªæ•°æ®åº“å‚¨å­˜æ•°æ®ã€‚</td></tr><tr><td>save[seconds] [changes]</td><td>å¯ä»¥åŒæ—¶é…ç½®ä¸‰ç§æ¨¡å¼ï¼š save 900 1 save 300 10 save 60 10000</td><td>è¡¨ç¤ºåœ¨è§„å®šçš„æ—¶é—´å†…ï¼Œæ‰§è¡Œäº†è§„å®šæ¬¡æ•°çš„å†™å…¥æˆ–ä¿®æ”¹æ“ä½œï¼ŒRedis å°±ä¼šå°†æ•°æ®åŒæ­¥åˆ°æŒ‡å®šçš„ç£ç›˜æ–‡ä»¶ä¸­ã€‚æ¯”å¦‚ 900s å†…åšäº†ä¸€æ¬¡æ›´æ”¹ï¼ŒRedis å°±ä¼šè‡ªåŠ¨æ‰§è¡Œæ•°æ®åŒæ­¥ã€‚</td></tr><tr><td>rdbcompression</td><td>yes/no</td><td>å½“æ•°æ®å­˜å‚¨è‡³æœ¬åœ°æ•°æ®åº“æ—¶æ˜¯å¦è¦å‹ç¼©æ•°æ®ï¼Œé»˜è®¤ä¸º yesã€‚</td></tr><tr><td>dbfilename</td><td>dump.rdb</td><td>æŒ‡å®šæœ¬åœ°å­˜å‚¨æ•°æ®åº“çš„æ–‡ä»¶åï¼Œé»˜è®¤ä¸º dump.rdbã€‚</td></tr><tr><td>dir</td><td>./</td><td>æŒ‡å®šæœ¬åœ°æ•°æ®åº“å­˜æ”¾ç›®å½•ã€‚</td></tr><tr><td>slaveof [&lt;]masterip[&gt;] [&lt;]masterport[&gt;]</td><td>ä¸»ä»å¤åˆ¶é…ç½®é€‰é¡¹</td><td>å½“æœ¬æœºä¸º slave æœåŠ¡æ—¶ï¼Œè®¾ç½® master æœåŠ¡çš„ IP åœ°å€åŠç«¯å£ï¼Œåœ¨ Redis å¯åŠ¨æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨ä¸ master ä¸»æœºè¿›è¡Œæ•°æ®åŒæ­¥ã€‚</td></tr><tr><td>requirepass</td><td>foobared é»˜è®¤å…³é—­</td><td>å¯†ç é…ç½®é¡¹ï¼Œé»˜è®¤å…³é—­ï¼Œç”¨äºè®¾ç½® Redis è¿æ¥å¯†ç ã€‚å¦‚æœé…ç½®äº†è¿æ¥å¯†ç ï¼Œå®¢æˆ·ç«¯è¿æ¥ Redis æ—¶éœ€è¦é€šè¿‡[&lt;]password[&gt;] å¯†ç è®¤è¯ã€‚</td></tr><tr><td>maxmemory [&lt;]bytes[&gt;]</td><td>æœ€å¤§å†…å­˜é™åˆ¶é…ç½®é¡¹</td><td>æŒ‡å®š Redis æœ€å¤§å†…å­˜é™åˆ¶ï¼ŒRedis åœ¨å¯åŠ¨æ—¶ä¼šæŠŠæ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œè¾¾åˆ°æœ€å¤§å†…å­˜åï¼ŒRedis ä¼šå°è¯•æ¸…é™¤å·²åˆ°æœŸæˆ–å³å°†åˆ°æœŸçš„ Keyï¼Œå½“æ­¤æ–¹æ³•å¤„ç† åï¼Œè‹¥ä»ç„¶åˆ°è¾¾æœ€å¤§å†…å­˜è®¾ç½®ï¼Œå°†æ— æ³•å†è¿›è¡Œå†™å…¥æ“ä½œï¼Œä½†å¯ä»¥è¿›è¡Œè¯»å–æ“ä½œã€‚</td></tr><tr><td>appendfilename</td><td>appendonly.aof</td><td>æŒ‡å®š AOF æŒä¹…åŒ–æ—¶ä¿å­˜æ•°æ®çš„æ–‡ä»¶åï¼Œé»˜è®¤ä¸º appendonly.aofã€‚</td></tr><tr><td>glueoutputbuf</td><td>yes</td><td>è®¾ç½®å‘å®¢æˆ·ç«¯åº”ç­”æ—¶ï¼Œæ˜¯å¦æŠŠè¾ƒå°çš„åŒ…åˆå¹¶ä¸ºä¸€ä¸ªåŒ…å‘é€ï¼Œé»˜è®¤å¼€å¯çŠ¶æ€ã€‚</td></tr></tbody></table><h2 id="rediså‘å¸ƒå’Œè®¢é˜…" tabindex="-1"><a class="header-anchor" href="#rediså‘å¸ƒå’Œè®¢é˜…" aria-hidden="true">#</a> Rediså‘å¸ƒå’Œè®¢é˜…</h2><p><strong>æ˜¯ä¸€ç§æ¶ˆæ¯çš„é€šä¿¡æ¨¡å¼ï¼ˆæ¶ˆæ¯ä¼ é€’ç³»ç»Ÿï¼‰</strong></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221115203937712.png" alt="image-20221115203937712"></p><h3 id="å‘å¸ƒè®¢é˜…æµç¨‹" tabindex="-1"><a class="header-anchor" href="#å‘å¸ƒè®¢é˜…æµç¨‹" aria-hidden="true">#</a> å‘å¸ƒè®¢é˜…æµç¨‹</h3><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221115204015851.png" alt="image-20221115204015851"></p><h3 id="å‘½ä»¤è¡Œå®ç°å‘å¸ƒå’Œè®¢é˜…æ¼”ç¤º" tabindex="-1"><a class="header-anchor" href="#å‘½ä»¤è¡Œå®ç°å‘å¸ƒå’Œè®¢é˜…æ¼”ç¤º" aria-hidden="true">#</a> å‘½ä»¤è¡Œå®ç°å‘å¸ƒå’Œè®¢é˜…æ¼”ç¤º</h3><p>è®¢é˜…è€…/ç­‰å¾…æ¥æ”¶æ¶ˆæ¯</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>#è®¢é˜…channel
127.0.0.1:6379&gt; SUBSCRIBE www.biancheng.net
Reading messages... (press Ctrl-C to quit)
1) &quot;subscribe&quot;
2) &quot;www.biancheng.net&quot;
3) (integer) 1 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å‘å¸ƒè€…/å‘é€æ¶ˆæ¯ <code>PUBLISH</code>å‘½ä»¤å‘å¸ƒ</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>127.0.0.1:6379&gt; PUBLISH www.biancheng.net &quot;this is website&quot;
(integer) 1
127.0.0.1:6379&gt; PUBLISH www.biancheng.net &quot;hello world&quot;
(integer) 1
127.0.0.1:6379&gt; PUBLISH www.biancheng.net &quot;how are you&quot;
(integer) 1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è®¢é˜…è€…/æˆåŠŸæ¥æ”¶æ¶ˆæ¯</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>127.0.0.1:6379&gt; SUBSCRIBE www.biancheng.net
Reading messages... (press Ctrl-C to quit)
1) &quot;subscribe&quot;
2) &quot;www.biancheng.net&quot;
3) (integer) 1
1) &quot;message&quot;
2) &quot;www.biancheng.net&quot;
3) &quot;this is website&quot;
1) &quot;message&quot;
2) &quot;www.biancheng.net&quot;
3) &quot;hello world&quot;
1) &quot;message&quot;
2) &quot;www.biancheng.net&quot;
3) &quot;how are you&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å¸¸ç”¨å‘½ä»¤" tabindex="-1"><a class="header-anchor" href="#å¸¸ç”¨å‘½ä»¤" aria-hidden="true">#</a> å¸¸ç”¨å‘½ä»¤</h3><p>Redis PubSubå¸¸ç”¨å‘½ä»¤</p><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>PSUBSCRIBE pattern [pattern ...]</td><td>è®¢é˜…ä¸€ä¸ªæˆ–å¤šä¸ªç¬¦åˆæŒ‡å®šæ¨¡å¼çš„é¢‘é“ã€‚</td></tr><tr><td>PUBSUB subcommand [argument [argument ...]]</td><td>æŸ¥çœ‹å‘å¸ƒ/è®¢é˜…ç³»ç»ŸçŠ¶æ€ï¼Œå¯é€‰å‚æ•° 1) channel è¿”å›åœ¨çº¿çŠ¶æ€çš„é¢‘é“ã€‚ 2) numpat è¿”å›æŒ‡å®šæ¨¡å¼çš„è®¢é˜…è€…æ•°é‡ã€‚ 3) numsub è¿”å›æŒ‡å®šé¢‘é“çš„è®¢é˜…è€…æ•°é‡ã€‚</td></tr><tr><td>PUBSUB subcommand [argument [argument ...]]</td><td>å°†ä¿¡æ¯å‘é€åˆ°æŒ‡å®šçš„é¢‘é“ã€‚</td></tr><tr><td>PUNSUBSCRIBE [pattern [pattern ...]]</td><td>é€€è®¢æ‰€æœ‰æŒ‡å®šæ¨¡å¼çš„é¢‘é“ã€‚</td></tr><tr><td>SUBSCRIBE channel [channel ...]</td><td>è®¢é˜…ä¸€ä¸ªæˆ–è€…å¤šä¸ªé¢‘é“çš„æ¶ˆæ¯ã€‚</td></tr><tr><td>UNSUBSCRIBE [channel [channel ...]]</td><td>é€€è®¢æŒ‡å®šçš„é¢‘é“ã€‚</td></tr></tbody></table><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>#è®¢é˜…æŒ‡å®šæ¨¡å¼çš„é¢‘é“ï¼Œ*ä»£è¡¨é€šé…ç¬¦ï¼Œä¼šåŒ¹é…æ‰€æœ‰wwwå¼€å¤´çš„é¢‘é“
127.0.0.1:6379&gt; PSUBSCRIBE www*
Reading messages... (press Ctrl-C to quit)
1) &quot;psubscribe&quot;
2) &quot;www*&quot;
3) (integer) 1
#æŒ‰ctrl+cé€€å‡ºé˜»å¡çŠ¶æ€
^C
C:\Users\Administrator&gt;redis-cli
#æŸ¥çœ‹å‘å¸ƒè®¢é˜…ç³»ç»ŸçŠ¶æ€ï¼Œè¿”å›ç›¸åº”çš„é¢‘é“
127.0.0.1:6379&gt; PUBSUB channels
1) &quot;www.biancheng.net&quot;
#é€€è®¢æŒ‡å®šæ¨¡å¼çš„é¢‘é“
127.0.0.1:6379&gt; PUNSUBSCRIBE www*
1) &quot;punsubscribe&quot;
2) &quot;www*&quot;
3) (integer) 0
#é€€è®¢æŒ‡å®šé¢‘é“
127.0.0.1:6379&gt; UNSUBSCRIBE www.biancheng.net
1) &quot;unsubscribe&quot;
2) &quot;www.biancheng.net&quot;
3) (integer) 0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="jedisæ“ä½œredis" tabindex="-1"><a class="header-anchor" href="#jedisæ“ä½œredis" aria-hidden="true">#</a> Jedisæ“ä½œRedis</h2><h3 id="javaä½¿ç”¨redis" tabindex="-1"><a class="header-anchor" href="#javaä½¿ç”¨redis" aria-hidden="true">#</a> Javaä½¿ç”¨Redis</h3><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221116002433987.png" alt="image-20221116002433987"></p><h3 id="æ¨¡æ‹ŸéªŒè¯ç å‘é€å’ŒéªŒè¯" tabindex="-1"><a class="header-anchor" href="#æ¨¡æ‹ŸéªŒè¯ç å‘é€å’ŒéªŒè¯" aria-hidden="true">#</a> æ¨¡æ‹ŸéªŒè¯ç å‘é€å’ŒéªŒè¯</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>eddie<span class="token punctuation">.</span>jedis</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">redis<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>jedis<span class="token punctuation">.</span></span><span class="token class-name">Jedis</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Random</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 <span class="token keyword">@author</span> EddieZhang
 @create 2022-11-15 23:47
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JedisDemo1</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">getCodeTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//è·å–éªŒè¯ç </span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token function">generateCode</span><span class="token punctuation">(</span><span class="token string">&quot;19880895770&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">verifyCodeTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//è¾“å…¥éªŒè¯ç è¿›è¡ŒéªŒè¯</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token function">verifyCode</span><span class="token punctuation">(</span><span class="token string">&quot;19880895770&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;66072&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token doc-comment comment">/**
     * éšæœºç”Ÿæˆ6ä¸ºçš„éªŒè¯ç 
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Random</span> random <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> code <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            code <span class="token operator">+=</span> random<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> code<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * æ¯ä¸ªæ‰‹æœºå·ç æ¯å¤©æœ€å¤šåªèƒ½éªŒè¯ä¸‰æ¬¡éªŒè¯ç  è®¾ç½®éªŒè¯ç çš„è¿‡æœŸæ—¶é—´ä¸º2second
     * <span class="token keyword">@param</span> <span class="token parameter">phoneNumber</span>
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">generateCode</span><span class="token punctuation">(</span><span class="token class-name">String</span> phoneNumber<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Jedis</span> jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token string">&quot;192.168.199.133&quot;</span><span class="token punctuation">,</span> <span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//æ‰‹æœºå‘é€æ¬¡æ•°çš„key</span>
        <span class="token class-name">String</span> countKey <span class="token operator">=</span> <span class="token string">&quot;verifyCode&quot;</span> <span class="token operator">+</span> phoneNumber <span class="token operator">+</span> <span class="token string">&quot;:count&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">//éªŒè¯ç çš„key</span>
        <span class="token class-name">String</span> codeKey <span class="token operator">=</span> <span class="token string">&quot;verifyCode&quot;</span> <span class="token operator">+</span> phoneNumber <span class="token operator">+</span> <span class="token string">&quot;:code&quot;</span><span class="token punctuation">;</span>

        <span class="token comment">//æ¯ä¸ªæ‰‹æœºæ¯å¤©åªèƒ½å‘é€ä¸‰æ¬¡</span>
        <span class="token class-name">String</span> count <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>countKey<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å–æ‰‹æœºçš„å‘é€æ¬¡æ•°</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//å½“è·å–æ­¤æ‰‹æœºçš„countä¸ºnullæ—¶è¡¨æ˜å°šæœªéªŒè¯è¿‡ åˆ™è¿›è¡Œç¬¬ä¸€æ¬¡setä¸”è®¾ç½®è¿‡æœŸæ—¶é—´ä¸º24H</span>
            jedis<span class="token punctuation">.</span><span class="token function">setex</span><span class="token punctuation">(</span>countKey<span class="token punctuation">,</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//éšæœºç”Ÿæˆçš„éªŒè¯ç å­˜æ”¾åˆ°redisä¸­ å¹¶è®¾å®šexpireæ—¶æ•ˆä¸º2second</span>
            jedis<span class="token punctuation">.</span><span class="token function">setex</span><span class="token punctuation">(</span>codeKey<span class="token punctuation">,</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            jedis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> jedis<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>codeKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//å½“è·å–åˆ°æ­¤æ‰‹æœºçš„countä¸º3æ¬¡ä»¥ä¸‹æ—¶ åˆ™å¯¹countè¿›è¡Œincræ“ä½œ</span>
            jedis<span class="token punctuation">.</span><span class="token function">incr</span><span class="token punctuation">(</span>countKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//éšæœºç”Ÿæˆçš„éªŒè¯ç å­˜æ”¾åˆ°redisä¸­ å¹¶è®¾å®šexpireæ—¶æ•ˆä¸º2second</span>
            jedis<span class="token punctuation">.</span><span class="token function">setex</span><span class="token punctuation">(</span>codeKey<span class="token punctuation">,</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            jedis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> jedis<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>codeKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token comment">//å½“è·å–åˆ°æ­¤æ‰‹æœºçš„countæ»¡3æ¬¡æ—¶ åˆ™æç¤ºç”¨æˆ·æ— æ³•å†è¿›è¡ŒéªŒè¯ å¹¶ä¸”jedis.close()</span>
            <span class="token keyword">return</span> <span class="token string">&quot;æ‚¨å½“å¤©çš„ä¸‰æ¬¡éªŒè¯æ¬¡æ•°æ»¡äº†å“¦ æ˜å¤©å†è¿›è¡ŒéªŒè¯å§~&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * éªŒè¯ç çš„æ ¡éªŒ
     * <span class="token keyword">@param</span> <span class="token parameter">phoneNumber</span>
     * <span class="token keyword">@param</span> <span class="token parameter">code</span>
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">verifyCode</span><span class="token punctuation">(</span><span class="token class-name">String</span> phoneNumber<span class="token punctuation">,</span> <span class="token class-name">String</span> code<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Jedis</span> jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token string">&quot;192.168.199.133&quot;</span><span class="token punctuation">,</span> <span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>code<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;verifyCode&quot;</span> <span class="token operator">+</span> phoneNumber <span class="token operator">+</span> <span class="token string">&quot;:code&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            jedis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token string">&quot;verify success~&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            jedis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token string">&quot;sorry is wrong! try again&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="springbootæ•´åˆredisâ˜…" tabindex="-1"><a class="header-anchor" href="#springbootæ•´åˆredisâ˜…" aria-hidden="true">#</a> SpringBootæ•´åˆRedisâ˜…</h2><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221116190736845.png" alt="image-20221116190736845"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221116190758797.png" alt="image-20221116190758797"></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">JsonAutoDetect</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">PropertyAccessor</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>databind<span class="token punctuation">.</span></span><span class="token class-name">ObjectMapper</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cache<span class="token punctuation">.</span></span><span class="token class-name">CacheManager</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cache<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">CachingConfigurerSupport</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cache<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">EnableCaching</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>cache<span class="token punctuation">.</span></span><span class="token class-name">RedisCacheConfiguration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>cache<span class="token punctuation">.</span></span><span class="token class-name">RedisCacheManager</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>connection<span class="token punctuation">.</span></span><span class="token class-name">RedisConnectionFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">RedisTemplate</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>serializer<span class="token punctuation">.</span></span><span class="token class-name">Jackson2JsonRedisSerializer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>serializer<span class="token punctuation">.</span></span><span class="token class-name">RedisSerializationContext</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>serializer<span class="token punctuation">.</span></span><span class="token class-name">RedisSerializer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>serializer<span class="token punctuation">.</span></span><span class="token class-name">StringRedisSerializer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 <span class="token keyword">@author</span> EddieZhang
 @create 2022-11-16 13:45
 */</span>
<span class="token annotation punctuation">@EnableCaching</span><span class="token comment">//å…è®¸ç¼“å­˜</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisConfig</span> <span class="token keyword">extends</span> <span class="token class-name">CachingConfigurerSupport</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">redisTemplate</span><span class="token punctuation">(</span><span class="token class-name">RedisConnectionFactory</span> factory<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> template <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">RedisSerializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> redisSerializer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Jackson2JsonRedisSerializer</span> jackson2JsonRedisSerializer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jackson2JsonRedisSerializer</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ObjectMapper</span> om <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        om<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">PropertyAccessor</span><span class="token punctuation">.</span><span class="token constant">ALL</span><span class="token punctuation">,</span> <span class="token class-name">JsonAutoDetect<span class="token punctuation">.</span>Visibility</span><span class="token punctuation">.</span><span class="token constant">ANY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        om<span class="token punctuation">.</span><span class="token function">enableDefaultTyping</span><span class="token punctuation">(</span><span class="token class-name">ObjectMapper<span class="token punctuation">.</span>DefaultTyping</span><span class="token punctuation">.</span><span class="token constant">NON_FINAL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jackson2JsonRedisSerializer<span class="token punctuation">.</span><span class="token function">setObjectMapper</span><span class="token punctuation">(</span>om<span class="token punctuation">)</span><span class="token punctuation">;</span>
        template<span class="token punctuation">.</span><span class="token function">setConnectionFactory</span><span class="token punctuation">(</span>factory<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//keyåºåˆ—åŒ–æ–¹å¼</span>
        template<span class="token punctuation">.</span><span class="token function">setKeySerializer</span><span class="token punctuation">(</span>redisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//valueåºåˆ—åŒ–</span>
        template<span class="token punctuation">.</span><span class="token function">setValueSerializer</span><span class="token punctuation">(</span>jackson2JsonRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//value hashmapåºåˆ—åŒ–</span>
        template<span class="token punctuation">.</span><span class="token function">setHashValueSerializer</span><span class="token punctuation">(</span>jackson2JsonRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> template<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">CacheManager</span> <span class="token function">cacheManager</span><span class="token punctuation">(</span><span class="token class-name">RedisConnectionFactory</span> factory<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">RedisSerializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> redisSerializer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Jackson2JsonRedisSerializer</span> jackson2JsonRedisSerializer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jackson2JsonRedisSerializer</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//è§£å†³æŸ¥è¯¢ç¼“å­˜è½¬æ¢å¼‚å¸¸çš„é—®é¢˜</span>
        <span class="token class-name">ObjectMapper</span> om <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        om<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">PropertyAccessor</span><span class="token punctuation">.</span><span class="token constant">ALL</span><span class="token punctuation">,</span> <span class="token class-name">JsonAutoDetect<span class="token punctuation">.</span>Visibility</span><span class="token punctuation">.</span><span class="token constant">ANY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        om<span class="token punctuation">.</span><span class="token function">enableDefaultTyping</span><span class="token punctuation">(</span><span class="token class-name">ObjectMapper<span class="token punctuation">.</span>DefaultTyping</span><span class="token punctuation">.</span><span class="token constant">NON_FINAL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jackson2JsonRedisSerializer<span class="token punctuation">.</span><span class="token function">setObjectMapper</span><span class="token punctuation">(</span>om<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// é…ç½®åºåˆ—åŒ–ï¼ˆè§£å†³ä¹±ç çš„é—®é¢˜ï¼‰,è¿‡æœŸæ—¶é—´600ç§’</span>
        <span class="token class-name">RedisCacheConfiguration</span> config <span class="token operator">=</span> <span class="token class-name">RedisCacheConfiguration</span><span class="token punctuation">.</span><span class="token function">defaultCacheConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">entryTtl</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">600</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">serializeKeysWith</span><span class="token punctuation">(</span><span class="token class-name">RedisSerializationContext<span class="token punctuation">.</span>SerializationPair</span><span class="token punctuation">.</span><span class="token function">fromSerializer</span><span class="token punctuation">(</span>redisSerializer<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">serializeValuesWith</span><span class="token punctuation">(</span><span class="token class-name">RedisSerializationContext<span class="token punctuation">.</span>SerializationPair</span><span class="token punctuation">.</span><span class="token function">fromSerializer</span><span class="token punctuation">(</span>jackson2JsonRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">disableCachingNullValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">RedisCacheManager</span> cacheManager <span class="token operator">=</span> <span class="token class-name">RedisCacheManager</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span>factory<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">cacheDefaults</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> cacheManager<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221116190838128.png" alt="image-20221116190838128"></p><h2 id="redisçš„äº‹åŠ¡æ“ä½œ" tabindex="-1"><a class="header-anchor" href="#redisçš„äº‹åŠ¡æ“ä½œ" aria-hidden="true">#</a> Redisçš„äº‹åŠ¡æ“ä½œ</h2><blockquote><p>Redis äº‹åŠ¡çš„æœ¬è´¨æ˜¯ä¸€ç»„å‘½ä»¤çš„é›†åˆã€‚äº‹åŠ¡æ”¯æŒä¸€æ¬¡æ‰§è¡Œå¤šä¸ªå‘½ä»¤ï¼Œä¸€ä¸ªäº‹åŠ¡ä¸­æ‰€æœ‰å‘½ä»¤éƒ½ä¼šè¢«åºåˆ—åŒ–ã€‚åœ¨äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ï¼Œä¼šæŒ‰ç…§é¡ºåºä¸²è¡ŒåŒ–æ‰§è¡Œé˜Ÿåˆ—ä¸­çš„å‘½ä»¤ï¼Œå…¶ä»–å®¢æˆ·ç«¯æäº¤çš„å‘½ä»¤è¯·æ±‚ä¸ä¼šæ’å…¥åˆ°äº‹åŠ¡æ‰§è¡Œå‘½ä»¤åºåˆ—ä¸­ã€‚</p><p><strong>æ€»ç»“è¯´ï¼šredisäº‹åŠ¡å°±æ˜¯ä¸€æ¬¡æ€§ã€é¡ºåºæ€§ã€æ’ä»–æ€§çš„æ‰§è¡Œä¸€ä¸ªé˜Ÿåˆ—ä¸­çš„ä¸€ç³»åˆ—å‘½ä»¤ã€‚</strong></p></blockquote><p><strong>Redis äº‹åŠ¡çš„ç›®çš„</strong>æ˜¯æ–¹ä¾¿ç”¨æˆ·ä¸€æ¬¡æ‰§è¡Œå¤šä¸ªå‘½ä»¤ï¼ˆ<strong>ä¸²è”å¤šä¸ªå‘½ä»¤</strong>ï¼‰é˜²æ­¢åˆ«çš„å‘½ä»¤æ’é˜Ÿã€‚æ‰§è¡Œ Redis äº‹åŠ¡å¯åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼š</p><ul><li>å¼€å§‹äº‹åŠ¡ã€MULTIã€‘</li><li>å‘½ä»¤å…¥é˜Ÿ</li><li>æ‰§è¡Œäº‹åŠ¡ã€EXECã€‘</li></ul><h3 id="redisäº‹åŠ¡ç‰¹æ€§" tabindex="-1"><a class="header-anchor" href="#redisäº‹åŠ¡ç‰¹æ€§" aria-hidden="true">#</a> Redisäº‹åŠ¡ç‰¹æ€§</h3><p>Redis äº‹åŠ¡</p><p>é‡è¦ç‰¹æ€§ï¼š</p><h4 id="_1-å•ç‹¬çš„éš”ç¦»æ“ä½œ" tabindex="-1"><a class="header-anchor" href="#_1-å•ç‹¬çš„éš”ç¦»æ“ä½œ" aria-hidden="true">#</a> 1) å•ç‹¬çš„éš”ç¦»æ“ä½œ</h4><p>äº‹åŠ¡ä¸­çš„æ‰€æœ‰å‘½ä»¤éƒ½ä¼šè¢«åºåˆ—åŒ–ï¼Œå®ƒä»¬å°†æŒ‰ç…§é¡ºåºæ‰§è¡Œï¼Œå¹¶ä¸”åœ¨æ‰§è¡Œè¿‡çš„ç¨‹ä¸­ï¼Œä¸ä¼šè¢«å…¶ä»–å®¢æˆ·ç«¯å‘é€æ¥çš„å‘½ä»¤æ‰“æ–­ã€‚</p><h4 id="_2-ä¸ä¿è¯åŸå­æ€§" tabindex="-1"><a class="header-anchor" href="#_2-ä¸ä¿è¯åŸå­æ€§" aria-hidden="true">#</a> 2) ä¸ä¿è¯åŸå­æ€§</h4><p>åœ¨ Redis çš„äº‹åŠ¡ä¸­ï¼Œå¦‚æœå­˜åœ¨å‘½ä»¤æ‰§è¡Œå¤±è´¥çš„æƒ…å†µï¼Œé‚£ä¹ˆå…¶ä»–å‘½ä»¤ä¾ç„¶ä¼šè¢«æ‰§è¡Œï¼Œä¸æ”¯æŒäº‹åŠ¡å›æ»šæœºåˆ¶ã€‚</p><p>æ³¨æ„ï¼šRedis ä¸æ”¯æŒäº‹åŠ¡å›æ»šï¼ŒåŸå› åœ¨äº Redis æ˜¯ä¸€æ¬¾åŸºäºå†…å­˜çš„å­˜å‚¨ç³»ç»Ÿï¼Œå…¶å†…éƒ¨ç»“æ„æ¯”è¾ƒç®€å•ï¼Œè‹¥æ”¯æŒå›æ»šæœºåˆ¶ï¼Œåˆ™è®©å…¶å˜å¾—å†—ä½™ï¼Œå¹¶ä¸”æŸè€—æ€§èƒ½ï¼Œè¿™ä¸ Redis ç®€å•ã€å¿«é€Ÿçš„ç†å¿µä¸ç›¸ç¬¦åˆã€‚</p><p>ä½¿ç”¨luaè„šæœ¬è§£å†³ï¼ˆluaè„šæœ¬ï¼ˆç±»ä¼¼äºæ‚²è§‚é”çš„å®ç°ï¼‰ä¸»è¦è§£å†³redisäº‹åŠ¡ï¼ˆä¹è§‚é”ï¼‰æ— æ³•ä¿è¯åŸå­æ€§çš„é—®é¢˜ï¼‰</p><h4 id="_3-æ²¡æœ‰éš”ç¦»çº§åˆ«çš„æ¦‚å¿µ" tabindex="-1"><a class="header-anchor" href="#_3-æ²¡æœ‰éš”ç¦»çº§åˆ«çš„æ¦‚å¿µ" aria-hidden="true">#</a> 3)æ²¡æœ‰éš”ç¦»çº§åˆ«çš„æ¦‚å¿µ</h4><p>é˜Ÿåˆ—ä¸­çš„å‘½ä»¤æ²¡æœ‰æäº¤ä¹‹å‰éƒ½ä¸ä¼šå®é™…è¢«æ‰§è¡Œï¼Œå› ä¸ºäº‹åŠ¡æäº¤å‰ä»»ä½•æŒ‡ä»¤éƒ½ä¸ä¼šè¢«å®é™…æ‰§è¡Œ</p><h3 id="redisäº‹åŠ¡å‘½ä»¤" tabindex="-1"><a class="header-anchor" href="#redisäº‹åŠ¡å‘½ä»¤" aria-hidden="true">#</a> Redisäº‹åŠ¡å‘½ä»¤</h3><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>MULTI</td><td>å¼€å¯ä¸€ä¸ªäº‹åŠ¡</td></tr><tr><td>EXEC</td><td>æ‰§è¡Œäº‹åŠ¡ä¸­çš„æ‰€æœ‰å‘½ä»¤</td></tr><tr><td>DISCARD</td><td>å–æ¶ˆäº‹åŠ¡ã€‚</td></tr><tr><td></td><td></td></tr><tr><td>WATCH key [key ...]</td><td>åœ¨<strong>å¼€å¯äº‹åŠ¡ä¹‹å‰</strong>ç”¨æ¥<strong>ç›‘è§†ä¸€ä¸ªæˆ–å¤šä¸ªkey</strong> ã€‚å¦‚æœ<strong>äº‹åŠ¡æ‰§è¡Œæ—¶è¿™äº› key è¢«æ”¹åŠ¨è¿‡</strong>ï¼Œé‚£ä¹ˆäº‹<strong>åŠ¡å°†è¢«æ‰“æ–­</strong>ã€‚</td></tr><tr><td>UNWATCH</td><td>å–æ¶ˆ WATCH å‘½ä»¤å¯¹ key çš„ç›‘æ§ã€‚</td></tr></tbody></table><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221116141928493.png" alt="image-20221116141928493"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221116162757393.png" alt="image-20221116162757393"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221116162809864.png" alt="image-20221116162809864"></p><p>ä»è¾“å…¥<strong>Multiå‘½ä»¤å¼€å§‹</strong>ï¼Œè¾“å…¥çš„å‘½ä»¤éƒ½ä¼šä¾æ¬¡è¿›å…¥å‘½ä»¤é˜Ÿåˆ—ä¸­ï¼Œä½†ä¸ä¼šæ‰§è¡Œï¼Œ</p><p>ç›´åˆ°è¾“å…¥<strong>Exec</strong>åï¼ŒRedisä¼š<strong>å°†ä¹‹å‰çš„å‘½ä»¤é˜Ÿåˆ—ä¸­çš„å‘½ä»¤ä¾æ¬¡æ‰§è¡Œ</strong>ã€‚</p><p>ç»„é˜Ÿçš„è¿‡ç¨‹ä¸­å¯ä»¥<strong>é€šè¿‡discardæ¥æ”¾å¼ƒç»„é˜Ÿ</strong></p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>127.0.0.1:6379&gt; multi å¼€å¯äº‹åŠ¡
OK
127.0.0.1:6379(TX)&gt; set key1 eddie
QUEUED
127.0.0.1:6379(TX)&gt; set key2 irving
QUEUED
127.0.0.1:6379(TX)&gt; set key3 james
QUEUED
127.0.0.1:6379(TX)&gt; set key4 curry
QUEUED
127.0.0.1:6379(TX)&gt; set key5 durant
QUEUED
127.0.0.1:6379(TX)&gt; exec æ‰§è¡Œäº‹åŠ¡
1) OK
2) OK
3) OK
4) OK
5) OK
127.0.0.1:6379&gt; multi å¼€å¯äº‹åŠ¡
OK
127.0.0.1:6379(TX)&gt; set key1 eddie
QUEUED
127.0.0.1:6379(TX)&gt; set key2 irving
QUEUED
127.0.0.1:6379(TX)&gt; set key3 james
QUEUED
127.0.0.1:6379(TX)&gt; set key4 curry
QUEUED
127.0.0.1:6379(TX)&gt; set key5 durant
QUEUED
127.0.0.1:6379(TX)&gt; discard å–æ¶ˆäº‹åŠ¡
OK
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="redisä¹è§‚é”å®ç°" tabindex="-1"><a class="header-anchor" href="#redisä¹è§‚é”å®ç°" aria-hidden="true">#</a> Redisä¹è§‚é”å®ç°</h3><table><thead><tr><th>WATCH key [key ...]</th><th>åœ¨å¼€å¯äº‹åŠ¡ä¹‹å‰ç”¨æ¥ç›‘è§†ä¸€ä¸ªæˆ–å¤šä¸ªkey ã€‚å¦‚æœäº‹åŠ¡æ‰§è¡Œæ—¶è¿™äº› key è¢«æ”¹åŠ¨è¿‡ï¼Œé‚£ä¹ˆäº‹åŠ¡å°†è¢«æ‰“æ–­ã€‚</th></tr></thead><tbody><tr><td>UNWATCH</td><td>å–æ¶ˆ WATCH å‘½ä»¤å¯¹ key çš„ç›‘æ§ã€‚</td></tr></tbody></table><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221116191251821.png" alt="image-20221116191251821"></p><p>æ€»ç»“ï¼šä¹è§‚é”å’Œæ‚²è§‚é”çš„åŒºåˆ«ã€‚ <strong>æ‚²è§‚é”ï¼š</strong> ä»€ä¹ˆæ—¶å€™éƒ½ä¼šå‡ºé—®é¢˜ï¼Œæ‰€ä»¥ä¸€ç›´ç›‘è§†ç€ï¼Œæ²¡æœ‰æ‰§è¡Œå½“å‰æ­¥éª¤å®Œæˆå‰ï¼Œä¸è®©ä»»ä½•çº¿ç¨‹æ‰§è¡Œï¼Œååˆ†æµªè´¹æ€§èƒ½ï¼ä¸€èˆ¬ä¸ä½¿ç”¨ï¼ <strong>ä¹è§‚é”ï¼š</strong> åªæœ‰æ›´æ–°æ•°æ®çš„æ—¶å€™å»åˆ¤æ–­ä¸€ä¸‹ï¼Œåœ¨æ­¤æœŸé—´æ˜¯å¦æœ‰äººä¿®æ”¹è¿‡è¢«ç›‘è§†çš„è¿™ä¸ªæ•°æ®ï¼Œæ²¡æœ‰çš„è¯æ­£å¸¸æ‰§è¡Œäº‹åŠ¡ï¼Œåä¹‹æ‰§è¡Œå¤±è´¥ï¼</p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221116191232703.png" alt="image-20221116191232703"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221116191146824.png" alt="image-20221116191146824"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221116191155778.png" alt="image-20221116191155778"></p><h3 id="ç§’æ€æ¡ˆä¾‹ä½“ä¼šredisäº‹åŠ¡" tabindex="-1"><a class="header-anchor" href="#ç§’æ€æ¡ˆä¾‹ä½“ä¼šredisäº‹åŠ¡" aria-hidden="true">#</a> ç§’æ€æ¡ˆä¾‹ä½“ä¼šredisäº‹åŠ¡</h3><h4 id="ç§’æ€æ¡ˆä¾‹ä¸­ä¼šå‡ºç°çš„é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#ç§’æ€æ¡ˆä¾‹ä¸­ä¼šå‡ºç°çš„é—®é¢˜" aria-hidden="true">#</a> ç§’æ€æ¡ˆä¾‹ä¸­ä¼šå‡ºç°çš„é—®é¢˜</h4><p>è¿æ¥è¶…æ—¶çš„é—®é¢˜-----ä½¿ç”¨è¿æ¥æ± è§£å†³</p><p>è¶…å–çš„é—®é¢˜-----------ä½¿ç”¨redisäº‹åŠ¡è§£å†³</p><p>åº“å­˜é—ç•™é—®é¢˜--------ä½¿ç”¨luaè„šæœ¬è§£å†³ï¼ˆluaè„šæœ¬ï¼ˆç±»ä¼¼äºæ‚²è§‚é”çš„å®ç°ï¼‰ä¸»è¦è§£å†³redisäº‹åŠ¡ï¼ˆä¹è§‚é”ï¼‰æ— æ³•ä¿è¯åŸå­æ€§çš„é—®é¢˜ï¼‰</p><h4 id="é¡¹ç›®æ¡ˆä¾‹" tabindex="-1"><a class="header-anchor" href="#é¡¹ç›®æ¡ˆä¾‹" aria-hidden="true">#</a> é¡¹ç›®æ¡ˆä¾‹</h4><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221116233901248.png" alt="image-20221116233901248"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221116234117079.png" alt="image-20221116234117079"></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>eddie<span class="token punctuation">.</span>lua</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>eddie<span class="token punctuation">.</span>utils<span class="token punctuation">.</span></span><span class="token class-name">JedisPoolUtil</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">LoggerFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">redis<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>jedis<span class="token punctuation">.</span></span><span class="token class-name">HostAndPort</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">redis<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>jedis<span class="token punctuation">.</span></span><span class="token class-name">Jedis</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">redis<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>jedis<span class="token punctuation">.</span></span><span class="token class-name">JedisPool</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashSet</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Set</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 <span class="token keyword">@author</span> EddieZhang
 @create 2022-11-16 22:21
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Script</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span>  <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span>Logger</span> logger <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">Script</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">JedisPool</span> jedispool <span class="token operator">=</span>  <span class="token class-name">JedisPoolUtil</span><span class="token punctuation">.</span><span class="token function">getJedisPoolInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Jedis</span> jedis<span class="token operator">=</span>jedispool<span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">ping</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">HostAndPort</span><span class="token punctuation">&gt;</span></span> set<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">HostAndPort</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//	doSecKill(&quot;201&quot;,&quot;sk:0101&quot;);</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token class-name">String</span> secKillScript <span class="token operator">=</span><span class="token string">&quot;local userid=KEYS[1];\r\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;local prodid=KEYS[2];\r\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;local qtkey=&#39;sk:&#39;..prodid..\&quot;:qt\&quot;;\r\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;local usersKey=&#39;sk:&#39;..prodid..\&quot;:usr\&quot;;\r\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;local userExists=redis.call(\&quot;sismember\&quot;,usersKey,userid);\r\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;if tonumber(userExists)==1 then \r\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;   return 2;\r\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;end\r\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;local num= redis.call(\&quot;get\&quot; ,qtkey);\r\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;if tonumber(num)&lt;=0 then \r\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;   return 0;\r\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;else \r\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;   redis.call(\&quot;decr\&quot;,qtkey);\r\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;   redis.call(\&quot;sadd\&quot;,usersKey,userid);\r\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;end\r\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;return 1&quot;</span> <span class="token punctuation">;</span>

    <span class="token keyword">static</span> <span class="token class-name">String</span> secKillScript2 <span class="token operator">=</span>
            <span class="token string">&quot;local userExists=redis.call(\&quot;sismember\&quot;,\&quot;{sk}:0101:usr\&quot;,userid);\r\n&quot;</span> <span class="token operator">+</span>
                    <span class="token string">&quot; return 1&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">doSecKill</span><span class="token punctuation">(</span><span class="token class-name">String</span> uid<span class="token punctuation">,</span><span class="token class-name">String</span> prodid<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>

        <span class="token class-name">JedisPool</span> jedispool <span class="token operator">=</span>  <span class="token class-name">JedisPoolUtil</span><span class="token punctuation">.</span><span class="token function">getJedisPoolInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Jedis</span> jedis<span class="token operator">=</span>jedispool<span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//String sha1=  .secKillScript;</span>
        <span class="token class-name">String</span> sha1<span class="token operator">=</span>  jedis<span class="token punctuation">.</span><span class="token function">scriptLoad</span><span class="token punctuation">(</span>secKillScript<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span> result<span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">evalsha</span><span class="token punctuation">(</span>sha1<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> uid<span class="token punctuation">,</span>prodid<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">String</span> reString<span class="token operator">=</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;0&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span> reString <span class="token punctuation">)</span>  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;å·²æŠ¢ç©ºï¼ï¼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span> reString <span class="token punctuation">)</span>  <span class="token punctuation">)</span>  <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æŠ¢è´­æˆåŠŸï¼ï¼ï¼ï¼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span> reString <span class="token punctuation">)</span>  <span class="token punctuation">)</span>  <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;è¯¥ç”¨æˆ·å·²æŠ¢è¿‡ï¼ï¼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æŠ¢è´­å¼‚å¸¸ï¼ï¼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        jedis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221116234132560.png" alt="image-20221116234132560"></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>eddie<span class="token punctuation">.</span>redis</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>eddie<span class="token punctuation">.</span>utils<span class="token punctuation">.</span></span><span class="token class-name">JedisPoolUtil</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">redis<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>jedis<span class="token punctuation">.</span></span><span class="token class-name">Jedis</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">redis<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>jedis<span class="token punctuation">.</span></span><span class="token class-name">JedisPool</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">redis<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>jedis<span class="token punctuation">.</span></span><span class="token class-name">Transaction</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 <span class="token keyword">@author</span> EddieZhang
 @create 2022-11-16 22:18
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Redis</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Jedis</span> jedis <span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token string">&quot;192.168.199.133&quot;</span><span class="token punctuation">,</span><span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">ping</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jedis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//ç§’æ€è¿‡ç¨‹</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">doSecKill</span><span class="token punctuation">(</span><span class="token class-name">String</span> uid<span class="token punctuation">,</span><span class="token class-name">String</span> prodid<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token comment">//1 uidå’Œprodidéç©ºåˆ¤æ–­</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>uid <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> prodid <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//2 è¿æ¥redis</span>
        <span class="token comment">//Jedis jedis = new Jedis(&quot;192.168.44.168&quot;,6379);</span>
        <span class="token comment">//é€šè¿‡è¿æ¥æ± å¾—åˆ°jediså¯¹è±¡</span>
        <span class="token class-name">JedisPool</span> jedisPoolInstance <span class="token operator">=</span> <span class="token class-name">JedisPoolUtil</span><span class="token punctuation">.</span><span class="token function">getJedisPoolInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Jedis</span> jedis <span class="token operator">=</span> jedisPoolInstance<span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//3 æ‹¼æ¥key</span>
        <span class="token comment">// 3.1 åº“å­˜key</span>
        <span class="token class-name">String</span> kcKey <span class="token operator">=</span> <span class="token string">&quot;sk:&quot;</span><span class="token operator">+</span>prodid<span class="token operator">+</span><span class="token string">&quot;:qt&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">// 3.2 ç§’æ€æˆåŠŸç”¨æˆ·key</span>
        <span class="token class-name">String</span> userKey <span class="token operator">=</span> <span class="token string">&quot;sk:&quot;</span><span class="token operator">+</span>prodid<span class="token operator">+</span><span class="token string">&quot;:user&quot;</span><span class="token punctuation">;</span>

        <span class="token comment">//ç›‘è§†åº“å­˜</span>
        jedis<span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span>kcKey<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//4 è·å–åº“å­˜ï¼Œå¦‚æœåº“å­˜nullï¼Œç§’æ€è¿˜æ²¡æœ‰å¼€å§‹</span>
        <span class="token class-name">String</span> kc <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>kcKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>kc <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ç§’æ€è¿˜æ²¡æœ‰å¼€å§‹ï¼Œè¯·ç­‰å¾…&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            jedis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 5 åˆ¤æ–­ç”¨æˆ·æ˜¯å¦é‡å¤ç§’æ€æ“ä½œ</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">sismember</span><span class="token punctuation">(</span>userKey<span class="token punctuation">,</span> uid<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;å·²ç»ç§’æ€æˆåŠŸäº†ï¼Œä¸èƒ½é‡å¤ç§’æ€&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            jedis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//6 åˆ¤æ–­å¦‚æœå•†å“æ•°é‡ï¼Œåº“å­˜æ•°é‡å°äº1ï¼Œç§’æ€ç»“æŸ</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>kc<span class="token punctuation">)</span><span class="token operator">&lt;=</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ç§’æ€å·²ç»ç»“æŸäº†&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            jedis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//7 ç§’æ€è¿‡ç¨‹</span>
        <span class="token comment">//ä½¿ç”¨äº‹åŠ¡</span>
        <span class="token class-name">Transaction</span> multi <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">multi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//ç»„é˜Ÿæ“ä½œ</span>
        multi<span class="token punctuation">.</span><span class="token function">decr</span><span class="token punctuation">(</span>kcKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        multi<span class="token punctuation">.</span><span class="token function">sadd</span><span class="token punctuation">(</span>userKey<span class="token punctuation">,</span>uid<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//æ‰§è¡Œ</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> results <span class="token operator">=</span> multi<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>results <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> results<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ç§’æ€å¤±è´¥äº†....&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            jedis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//7.1 åº“å­˜-1</span>
        <span class="token comment">//jedis.decr(kcKey);</span>
        <span class="token comment">//7.2 æŠŠç§’æ€æˆåŠŸç”¨æˆ·æ·»åŠ æ¸…å•é‡Œé¢</span>
        <span class="token comment">//jedis.sadd(userKey,uid);</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ç§’æ€æˆåŠŸäº†..&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jedis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221116234143307.png" alt="image-20221116234143307"></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>eddie<span class="token punctuation">.</span>servlet</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>eddie<span class="token punctuation">.</span>lua<span class="token punctuation">.</span></span><span class="token class-name">Script</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">ServletException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServlet</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletRequest</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletResponse</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Random</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 <span class="token keyword">@author</span> EddieZhang
 @create 2022-11-16 22:08
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Servlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doPost</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> userid <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">50000</span><span class="token punctuation">)</span> <span class="token operator">+</span><span class="token string">&quot;&quot;</span> <span class="token punctuation">;</span>
        <span class="token class-name">String</span> prodid <span class="token operator">=</span>req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">&quot;prodid&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//        boolean isSuccess= Redis.doSecKill(userid,prodid);</span>
        <span class="token keyword">boolean</span> isSuccess<span class="token operator">=</span> <span class="token class-name">Script</span><span class="token punctuation">.</span><span class="token function">doSecKill</span><span class="token punctuation">(</span>userid<span class="token punctuation">,</span>prodid<span class="token punctuation">)</span><span class="token punctuation">;</span>
        resp<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>isSuccess<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221116234154713.png" alt="image-20221116234154713"></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>eddie<span class="token punctuation">.</span>utils</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">redis<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>jedis<span class="token punctuation">.</span></span><span class="token class-name">Jedis</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">redis<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>jedis<span class="token punctuation">.</span></span><span class="token class-name">JedisPool</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">redis<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>jedis<span class="token punctuation">.</span></span><span class="token class-name">JedisPoolConfig</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 <span class="token keyword">@author</span> EddieZhang
 @create 2022-11-16 22:20
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JedisPoolUtil</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">volatile</span> <span class="token class-name">JedisPool</span> jedisPool <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">JedisPoolUtil</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">JedisPool</span> <span class="token function">getJedisPoolInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">==</span> jedisPool<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token class-name">JedisPoolUtil</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">==</span> jedisPool<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">JedisPoolConfig</span> poolConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JedisPoolConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    poolConfig<span class="token punctuation">.</span><span class="token function">setMaxTotal</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    poolConfig<span class="token punctuation">.</span><span class="token function">setMaxIdle</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    poolConfig<span class="token punctuation">.</span><span class="token function">setMaxWaitMillis</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token operator">*</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    poolConfig<span class="token punctuation">.</span><span class="token function">setBlockWhenExhausted</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    poolConfig<span class="token punctuation">.</span><span class="token function">setTestOnBorrow</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// ping  PONG</span>

                    jedisPool <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JedisPool</span><span class="token punctuation">(</span>poolConfig<span class="token punctuation">,</span> <span class="token string">&quot;192.168.199.133&quot;</span><span class="token punctuation">,</span> <span class="token number">6379</span><span class="token punctuation">,</span> <span class="token number">60000</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> jedisPool<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">release</span><span class="token punctuation">(</span><span class="token class-name">JedisPool</span> jedisPool<span class="token punctuation">,</span> <span class="token class-name">Jedis</span> jedis<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">!=</span> jedis<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            jedisPool<span class="token punctuation">.</span><span class="token function">returnResource</span><span class="token punctuation">(</span>jedis<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221116234208013.png" alt="image-20221116234208013"></p><div class="language-jsp line-numbers-mode" data-ext="jsp"><pre class="language-jsp"><code>&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;
&lt;html&gt;
&lt;body&gt;
&lt;h2&gt;Hello World!&lt;/h2&gt;
&lt;h1&gt;ç§’æ€ï¼ï¼ï¼
&lt;/h1&gt;
&lt;h2&gt;&lt;/h2&gt;

&lt;form id=&quot;msform&quot; action=&quot;/servlet&quot; enctype=&quot;application/x-www-form-urlencoded&quot;&gt;
    &lt;input type=&quot;hidden&quot; id=&quot;prodid&quot; name=&quot;prodid&quot; value=&quot;0101&quot;&gt;
    &lt;input type=&quot;button&quot;  id=&quot;miaosha_btn&quot; name=&quot;seckill_btn&quot; value=&quot;ç§’æ€ç‚¹æˆ‘&quot;/&gt;
&lt;/form&gt;
&lt;script  type=&quot;text/javascript&quot; src=&quot;/script/jquery/jquery-3.1.0.js&quot;&gt;&lt;/script&gt;
&lt;script  type=&quot;text/javascript&quot;&gt;
    $(function(){
        $(&quot;#miaosha_btn&quot;).click(function(){
            var url=$(&quot;#msform&quot;).attr(&quot;action&quot;);
            $.post(url,$(&quot;#msform&quot;).serialize(),function(data){
                if(data==&quot;false&quot;){
                    alert(&quot;æŠ¢å…‰äº†&quot; );
                    $(&quot;#miaosha_btn&quot;).attr(&quot;disabled&quot;,true);
                }
            } );
        })
    })
&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221116234220105.png" alt="image-20221116234220105"></p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">web-app</span> <span class="token name">PUBLIC</span>
 <span class="token string">&quot;-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN&quot;</span>
 <span class="token string">&quot;http://java.sun.com/dtd/web-app_2_3.dtd&quot;</span> <span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>web-app</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>display-name</span><span class="token punctuation">&gt;</span></span>Archetype Created Web Application<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>display-name</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">&gt;</span></span>Servlet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-class</span><span class="token punctuation">&gt;</span></span>com.eddie.servlet.Servlet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-class</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-mapping</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">&gt;</span></span>Servlet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">&gt;</span></span>/servlet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-mapping</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>web-app</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ä½¿ç”¨abè¿›è¡Œå¹¶å‘æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨abè¿›è¡Œå¹¶å‘æµ‹è¯•" aria-hidden="true">#</a> ä½¿ç”¨ABè¿›è¡Œå¹¶å‘æµ‹è¯•</h4><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221116234521901.png" alt="image-20221116234521901"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221116234455146.png" alt="image-20221116234455146"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221116234557703.png" alt="image-20221116234557703"></p><p>ab -n 2000 -c 200 -p ~/postfile -T application/x-www-form-urlencoded http://172.17.89.71:8080/servlet</p><h2 id="redisæŒä¹…åŒ–â˜…" tabindex="-1"><a class="header-anchor" href="#redisæŒä¹…åŒ–â˜…" aria-hidden="true">#</a> RedisæŒä¹…åŒ–â˜…</h2><p><a href="https://www.pdai.tech/md/db/nosql-redis/db-redis-x-rdb-aof.html" target="_blank" rel="noopener noreferrer">Redisè¿›é˜¶ - æŒä¹…åŒ–ï¼šRDBå’ŒAOFæœºåˆ¶è¯¦è§£ | Java å…¨æ ˆçŸ¥è¯†ä½“ç³» (pdai.tech)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><a href="https://blog.csdn.net/weixin_43829443/article/details/113173849" target="_blank" rel="noopener noreferrer">(5æ¡æ¶ˆæ¯) Redisï¼ˆä¸ƒï¼‰è¿›é˜¶ï¼šRedisæŒä¹…åŒ–ä¹‹RDBå’ŒAOF_å¤§é±¼ç­‰äºè´Ÿçš„åšå®¢-CSDNåšå®¢<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h4 id="ç®€ä»‹" tabindex="-1"><a class="header-anchor" href="#ç®€ä»‹" aria-hidden="true">#</a> ç®€ä»‹</h4><p>Redisæ˜¯<strong>åŸºäºå†…å­˜</strong>çš„æ•°æ®åº“ã€‚</p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221117181810508.png" alt="image-20221117181810508"></p><h4 id="æœåŠ¡å¯åŠ¨æ—¶å¦‚ä½•åŠ è½½æŒä¹…åŒ–æ•°æ®" tabindex="-1"><a class="header-anchor" href="#æœåŠ¡å¯åŠ¨æ—¶å¦‚ä½•åŠ è½½æŒä¹…åŒ–æ•°æ®" aria-hidden="true">#</a> æœåŠ¡å¯åŠ¨æ—¶å¦‚ä½•åŠ è½½æŒä¹…åŒ–æ•°æ®</h4><blockquote><p>é»˜è®¤<strong>åªå¼€å¯äº†RDBåˆ™è½½å…¥RDBæ–‡ä»¶çš„æ•°æ®</strong>ã€‚RDB æ–‡ä»¶æ˜¯ç»è¿‡å‹ç¼©çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå ç”¨ç©ºé—´å¾ˆå°ã€‚RDB åœ¨æ¢å¤å¤§æ•°æ®é›†æ—¶çš„é€Ÿåº¦æ¯” AOF çš„æ¢å¤é€Ÿåº¦è¦å¿«ã€‚</p><p>ç®€å•æ¥è¯´ï¼Œå¦‚æœ<strong>åŒæ—¶å¯ç”¨äº† AOF å’Œ RDB</strong>ï¼ŒRedis é‡æ–°å¯åŠ¨æ—¶ï¼Œ<strong>ä¼šä½¿ç”¨ AOF æ–‡ä»¶æ¥é‡å»ºæ•°æ®é›†</strong>ï¼Œå› ä¸ºé€šå¸¸æ¥è¯´ï¼Œ <strong>AOF çš„æ•°æ®ä¼šæ›´å®Œæ•´</strong>ã€‚</p><p>è€Œåœ¨<strong>å¼•å…¥äº†æ··åˆæŒä¹…åŒ–ä¹‹å</strong>ï¼Œä½¿ç”¨ AOF é‡å»ºæ•°æ®é›†æ—¶ï¼Œä¼š<strong>é€šè¿‡æ–‡ä»¶å¼€å¤´æ˜¯å¦ä¸ºâ€œREDISâ€æ¥åˆ¤æ–­æ˜¯å¦ä¸ºæ··åˆæŒä¹…åŒ–</strong>ã€‚</p></blockquote><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230411151612003.png" alt="image-20230411151612003"></p><h4 id="rdbæŒä¹…åŒ–-default" tabindex="-1"><a class="header-anchor" href="#rdbæŒä¹…åŒ–-default" aria-hidden="true">#</a> RDBæŒä¹…åŒ–(default)</h4><blockquote><p>åœ¨æŒ‡å®šçš„<strong>æ—¶é—´é—´éš”</strong>å†…å°†å†…å­˜ä¸­çš„æ•°æ®é›†**å¿«ç…§ï¼ˆsnapshotï¼‰**å†™å…¥ç£ç›˜ã€‚<strong>RDB æ–‡ä»¶æ˜¯æ˜¯ç»è¿‡å‹ç¼©çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå ç”¨ç©ºé—´å¾ˆå°ã€‚</strong></p><p><strong>RDB åœ¨æ¢å¤å¤§æ•°æ®é›†æ—¶çš„é€Ÿåº¦æ¯” AOF çš„æ¢å¤é€Ÿåº¦è¦å¿«ã€‚</strong></p><p>When using only snapshots for saving data, you must remember that <strong>if a crash were to happen, you d lose any data changed since the last snapshot.</strong></p><p>RDB æŒä¹…åŒ–çš„æ–¹å¼æ˜¯å°† Redis å†…å­˜ä¸­çš„æ•°æ®å¿«ç…§å†™å…¥åˆ°ç£ç›˜æ–‡ä»¶ä¸­ã€‚å¿«ç…§æ˜¯æŒ‡ Redis å½“å‰æ—¶åˆ»å†…å­˜ä¸­çš„æ•°æ®åœ¨æŸä¸ªæ—¶åˆ»çš„æ‹·è´ï¼Œå°†è¿™ä¸ªæ‹·è´ä¿å­˜åˆ°æ–‡ä»¶ä¸­ï¼Œè¿™ä¸ªæ–‡ä»¶å°±æ˜¯ RDB æ–‡ä»¶ã€‚å½“ Redis éœ€è¦è¿›è¡ŒæŒä¹…åŒ–æ—¶ï¼ŒRedis å°†å†…å­˜ä¸­çš„æ•°æ®è¿›è¡Œå¿«ç…§ï¼Œç„¶åå°†å¿«ç…§å†™å…¥åˆ° RDB æ–‡ä»¶ä¸­ã€‚RDB æ–‡ä»¶æ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¯ä»¥è¢« Redis è¯»å–å’ŒåŠ è½½åˆ°å†…å­˜ä¸­ã€‚</p><ul><li><p><strong>BGSAVE</strong>:â–  Any Redis client can initiate a snapshot by calling the BGSAVE command.</p><p><strong>Redis will fork</strong>ï¼ˆRedis ä¸­çš„ fork æ“ä½œé€šå¸¸ç”¨äº RDB æŒä¹…åŒ–å’Œ AOF é‡å†™æ“ä½œã€‚å½“ Redis éœ€è¦è¿›è¡Œ RDB æŒä¹…åŒ–æˆ– AOF é‡å†™æ—¶ï¼Œå®ƒä¼šæ‰§è¡Œ fork æ“ä½œæ¥åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œä¸ä¼šå½±å“çˆ¶çº¿ç¨‹ç»§ç»­å¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚ä½†æ˜¯åœ¨ fork æ“ä½œä¸­ï¼Œçˆ¶è¿›ç¨‹çš„æ•´ä¸ªåœ°å€ç©ºé—´éƒ½ä¼šè¢«å¤åˆ¶åˆ°å­è¿›ç¨‹ä¸­ï¼Œè¿™æ ·å¯èƒ½ä¼šå¸¦æ¥ä¸€äº›å†…å­˜æ¶ˆè€—ã€‚å½“æ•°æ®é‡å¾ˆå¤§æ—¶ä¼šå½±å“æ•´ä½“æ€§èƒ½ã€‚ï¼‰</p><ol><li>åˆ›å»ºå­è¿›ç¨‹ï¼šRedis ä½¿ç”¨ C è¯­è¨€ä¸­çš„ fork å‡½æ•°æ¥åˆ›å»ºå­è¿›ç¨‹ï¼Œfork å‡½æ•°ä¼šå°†çˆ¶è¿›ç¨‹çš„æ•´ä¸ªåœ°å€ç©ºé—´å®Œå…¨å¤åˆ¶åˆ°å­è¿›ç¨‹ä¸­ï¼ŒåŒ…æ‹¬ä»£ç ã€æ•°æ®å’Œå †æ ˆç­‰ã€‚åœ¨åˆ›å»ºå­è¿›ç¨‹ä¹‹åï¼Œçˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹éƒ½å°†æ‹¥æœ‰ç›¸åŒçš„ç¨‹åºä»£ç å’Œæ•°æ®ã€‚</li><li>æ‰§è¡Œä¸åŒçš„ä»£ç ï¼šåœ¨ fork æ“ä½œä¹‹åï¼Œçˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹ä¼šç»§ç»­æ‰§è¡Œç›¸åŒçš„ä»£ç ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡è¿”å›å€¼åŒºåˆ†æ˜¯çˆ¶è¿›ç¨‹è¿˜æ˜¯å­è¿›ç¨‹ã€‚åœ¨ Redis ä¸­ï¼Œçˆ¶è¿›ç¨‹é€šå¸¸ä¼šç»§ç»­å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ï¼Œè€Œå­è¿›ç¨‹åˆ™ä¼šè¿›è¡Œ RDB æŒä¹…åŒ–æˆ– AOF é‡å†™æ“ä½œã€‚</li></ol></li><li><p><strong>SAVE</strong>â–  A Redis client can also initiate a snapshot by calling the SAVE command, which causes <strong>Redis to stop responding to any/all commands until the snapshot completes.</strong> This command isnâ€™t commonly used, except in situations where we need our data on disk, and either weâ€™re okay waiting for it to complete, or we donâ€™t have enough memory for a BGSAVE.</p></li></ul><p>â­•Linux <strong>fork å­è¿›ç¨‹é‡‡ç”¨çš„æ˜¯ copy-on-write çš„æ–¹å¼</strong>ã€‚åœ¨ Redis æ‰§è¡Œ RDB æŒä¹…åŒ–æœŸé—´ï¼Œå¦‚æœ client å†™å…¥æ•°æ®å¾ˆé¢‘ç¹ï¼Œé‚£ä¹ˆå°†å¢åŠ  Redis å ç”¨çš„å†…å­˜ï¼Œæœ€åæƒ…å†µä¸‹ï¼Œå†…å­˜çš„å ç”¨å°†è¾¾åˆ°åŸå…ˆçš„2å€ã€‚</p><p>å½“æ•°æ®é‡ååˆ†åºå¤§æ—¶ï¼Œä½¿ç”¨BGSAVEåè€Œæ•ˆç‡æ›´ä½ï¼ˆéœ€è¦forkï¼‰ï¼Œå¯ä»¥æ ¹æ®è‡ªèº«çš„åº”ç”¨åœºæ™¯å–æ¶ˆè‡ªåŠ¨BGSAVEï¼›é‡‡ç”¨æ‰‹åŠ¨SAVEçš„æ–¹å¼åœ¨å‡Œæ™¨å†·åœºæ—¶æœŸåœæ­¢ä½¿ç”¨ç¼“å­˜ï¼Œä¸“é—¨è¿›è¡Œæ•°æ®çš„æŒä¹…åŒ–ï¼Œåè€Œæ•ˆç‡æ›´é«˜ã€‚</p><p>RDB æŒä¹…åŒ–çš„ä¼˜ç‚¹ï¼š</p><ol><li><strong>æ•ˆç‡é«˜</strong>ï¼šRDB æŒä¹…åŒ–æ–¹å¼æ¯” AOF æŒä¹…åŒ–æ–¹å¼çš„æ•ˆç‡æ›´é«˜ï¼Œå› ä¸º RDB æŒä¹…åŒ–æ–¹å¼åªéœ€è¦è¿›è¡Œä¸€æ¬¡å¿«ç…§ï¼Œå°±èƒ½å¤Ÿå°†æ‰€æœ‰æ•°æ®ä¿å­˜åˆ°ç£ç›˜ä¸­ï¼Œè€Œ AOF æŒä¹…åŒ–æ–¹å¼éœ€è¦é¢‘ç¹åœ°å°†æ“ä½œå†™å…¥åˆ° AOF æ–‡ä»¶ä¸­ï¼Œå¯¼è‡´æ•ˆç‡ä½ä¸‹ã€‚</li><li><strong>æ–‡ä»¶å°</strong>ï¼šRDB æ–‡ä»¶çš„å¤§å°ç›¸å¯¹äº AOF æ–‡ä»¶æ¥è¯´æ›´å°ï¼Œå› ä¸º RDB æ–‡ä»¶åªä¿å­˜äº† Redis å†…å­˜ä¸­çš„æ•°æ®å¿«ç…§ï¼Œè€Œ AOF æ–‡ä»¶éœ€è¦ä¿å­˜æ¯ä¸€æ¬¡å†™æ“ä½œçš„è¯¦ç»†ä¿¡æ¯ï¼Œå¯¼è‡´æ–‡ä»¶æ¯”è¾ƒå¤§ã€‚</li><li><strong>æ¢å¤æ•°æ®æ–¹ä¾¿</strong>ï¼šåœ¨æŸäº›æƒ…å†µä¸‹ï¼ŒRedis éœ€è¦è¿›è¡Œæ•°æ®æ¢å¤ï¼Œä½¿ç”¨ RDB æŒä¹…åŒ–æ–¹å¼å¯ä»¥æ–¹ä¾¿åœ°å°†æ•°æ®ä» RDB æ–‡ä»¶ä¸­æ¢å¤ã€‚</li></ol><p>RDB æŒä¹…åŒ–çš„ä¸è¶³ï¼š</p><ol><li><strong>æ•°æ®ä¸¢å¤±</strong>ï¼šä¸Šä¸€ä¸ªå¿«ç…§å®Œæˆåä¸‹ä¸€ä¸ªå¿«ç…§å¼€å§‹å‰çš„æ•°æ®ä¼šä¸¢å¤±å¦‚æœæ­¤æ—¶Rediså‡ºç°Failureçš„è¯ã€‚å› ä¸º RDB æŒä¹…åŒ–æ–¹å¼æ˜¯å°†å†…å­˜ä¸­çš„æ•°æ®å¿«ç…§å†™å…¥åˆ°ç£ç›˜ä¸­ï¼Œå¦‚æœ Redis æŒ‚æ‰äº†å¹¶ä¸”æœ€åä¸€æ¬¡æŒä¹…åŒ–çš„ RDB æ–‡ä»¶æ²¡æœ‰å®Œå…¨å†™å…¥ç£ç›˜ï¼Œå°±ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚</li><li><strong>æŒä¹…åŒ–é—´éš”</strong>ï¼šRDB æŒä¹…åŒ–æ–¹å¼éœ€è¦è®¾ç½®æŒä¹…åŒ–é—´éš”ï¼Œé—´éš”æ—¶é—´è¿‡é•¿ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±ï¼Œé—´éš”æ—¶é—´è¿‡çŸ­åˆ™ä¼šå½±å“ Redis çš„æ€§èƒ½ã€‚</li><li><strong>å†™å…¥ç£ç›˜çš„é¢‘ç‡</strong>ï¼šRDB æŒä¹…åŒ–æ–¹å¼éœ€è¦å°†å¿«ç…§å†™å…¥ç£ç›˜ï¼Œå¦‚æœå†™å…¥ç£ç›˜çš„é¢‘ç‡è¿‡é«˜ï¼Œä¼šå¯¼è‡´ Redis çš„æ€§èƒ½é™ä½ã€‚</li></ol></blockquote><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221117182541480.png" alt="image-20221117182541480"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221129163023942.png" alt="image-20221129163023942"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221129230655071.png" alt="image-20221129230655071"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221129230703297.png" alt="image-20221129230703297"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221129231202363.png" alt="image-20221129231202363"></p><h5 id="æ‰‹åŠ¨è§¦å‘" tabindex="-1"><a class="header-anchor" href="#æ‰‹åŠ¨è§¦å‘" aria-hidden="true">#</a> æ‰‹åŠ¨è§¦å‘</h5><p>æ‰‹åŠ¨è§¦å‘æ˜¯é€šè¿‡<code>SAVE</code>å‘½ä»¤æˆ–è€…<code>BGSAVE</code>å‘½ä»¤å°†å†…å­˜æ•°æ®ä¿å­˜åˆ°ç£ç›˜æ–‡ä»¶ä¸­ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>127.0.0.1:6379&gt; SAVE
OK
127.0.0.1:6379&gt; BGSAVE
Background saving started
127.0.0.1:6379&gt;  LASTSAVE
(integer) 1611298430
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿°å‘½ä»¤<code>BGSAVE</code>ä»åå°æ‰§è¡Œæ•°æ®ä¿å­˜æ“ä½œï¼Œå…¶å¯ç”¨æ€§è¦ä¼˜äºæ‰§è¡Œ SAVE å‘½ä»¤ã€‚</p><p><strong>SAVE å‘½ä»¤ä¼šé˜»å¡ Redis æœåŠ¡å™¨è¿›ç¨‹</strong>ï¼Œç›´åˆ° dump.rdb æ–‡ä»¶åˆ›å»ºå®Œæ¯•ä¸ºæ­¢ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼ŒæœåŠ¡å™¨ä¸èƒ½å¤„ç†ä»»ä½•çš„å‘½ä»¤è¯·æ±‚ã€‚</p><p><strong><code>BGSAVE</code>å‘½ä»¤æ˜¯éé˜»å¡å¼çš„</strong>ï¼Œæ‰€è°“éé˜»å¡å¼ï¼ŒæŒ‡çš„æ˜¯åœ¨è¯¥å‘½ä»¤æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œå¹¶ä¸å½±å“ Redis æœåŠ¡å™¨å¤„ç†å®¢æˆ·ç«¯çš„å…¶ä»–è¯·æ±‚ã€‚è¿™æ˜¯å› ä¸º <strong>Redis æœåŠ¡å™¨ä¼š fork() ä¸€ä¸ªå­è¿›ç¨‹æ¥è¿›è¡ŒæŒä¹…åŒ–æ“ä½œï¼ˆæ¯”å¦‚åˆ›å»ºæ–°çš„ dump.rdb æ–‡ä»¶ï¼‰</strong>ï¼Œè€Œçˆ¶è¿›ç¨‹åˆ™ç»§ç»­å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ã€‚å½“å­è¿›ç¨‹å¤„ç†å®Œåä¼šå‘çˆ¶è¿›ç¨‹å‘é€ä¸€ä¸ªä¿¡å·ï¼Œé€šçŸ¥å®ƒå·²ç»å¤„ç†å®Œæ¯•ã€‚æ­¤æ—¶ï¼Œçˆ¶è¿›ç¨‹ä¼šç”¨æ–°çš„ dump.rdb æ–‡ä»¶è¦†ç›–æ‰åŸæ¥çš„æ—§æ–‡ä»¶ã€‚</p><p><strong>å› ä¸º<code>SAVE</code>å‘½ä»¤æ— éœ€åˆ›å»ºå­è¿›ç¨‹</strong>ï¼Œæ‰€ä»¥<strong>æ‰§è¡Œé€Ÿåº¦è¦ç•¥å¿«äº<code>BGSAVE</code>å‘½ä»¤</strong>ï¼Œä½†æ˜¯<code>SAVE</code>å‘½ä»¤æ˜¯é˜»å¡å¼çš„ï¼Œå› æ­¤å…¶å¯ç”¨æ€§æ¬ ä½³ï¼Œå¦‚æœåœ¨æ•°æ®é‡è¾ƒå°‘çš„æƒ…å†µä¸‹ï¼ŒåŸºæœ¬ä¸Šä½“ä¼šä¸åˆ°ä¸¤ä¸ªå‘½ä»¤çš„å·®åˆ«ï¼Œä¸è¿‡ä»ç„¶<strong>å»ºè®®æ‚¨ä½¿ç”¨ <code>BGSAVE</code>å‘½ä»¤ã€‚</strong></p><p>æ³¨æ„ï¼š<strong>LASTSAVE å‘½ä»¤ç”¨äºæŸ¥çœ‹ BGSAVE å‘½ä»¤æ˜¯å¦æ‰§è¡ŒæˆåŠŸã€‚</strong></p><h5 id="è‡ªåŠ¨è§¦å‘" tabindex="-1"><a class="header-anchor" href="#è‡ªåŠ¨è§¦å‘" aria-hidden="true">#</a> è‡ªåŠ¨è§¦å‘</h5><blockquote><p>If Redis is configured with save lines, such as save 60 10000, Redis will auto- matically trigger a BGSAVE operation if 10,000 writes have occurred within 60 seconds since the last successful save has started (using the configuration option described). When multiple save lines are present, any time one of the rules match, a BGSAVE is triggered.</p></blockquote><p>è‡ªåŠ¨è§¦å‘ç­–ç•¥ï¼Œæ˜¯<strong>æŒ‡ Redis åœ¨æŒ‡å®šçš„æ—¶é—´å†…ï¼Œæ•°æ®å‘ç”Ÿäº†å¤šå°‘æ¬¡å˜åŒ–æ—¶</strong>ï¼Œ<strong>ä¼šè‡ªåŠ¨æ‰§è¡Œ<code>BGSAVE</code>å‘½ä»¤</strong>ã€‚è‡ªåŠ¨<strong>è§¦å‘çš„æ¡ä»¶</strong>åŒ…å«åœ¨äº† <strong>Redis çš„é…ç½®æ–‡ä»¶</strong>ä¸­</p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221130004943280.png" alt="image-20221130004943280"></p><p>ä¸Šå›¾æ‰€ç¤ºï¼Œ save m n çš„å«ä¹‰æ˜¯åœ¨æ—¶é—´ m ç§’å†…ï¼Œå¦‚æœ Redis æ•°æ®è‡³å°‘å‘ç”Ÿäº† n æ¬¡å˜åŒ–ï¼Œé‚£ä¹ˆå°±è‡ªåŠ¨æ‰§è¡Œ<code>BGSAVE</code>å‘½ä»¤ã€‚é…ç½®ç­–ç•¥è¯´æ˜å¦‚ä¸‹ï¼š</p><ul><li>save 900 1 è¡¨ç¤ºåœ¨ 900 ç§’å†…ï¼Œè‡³å°‘æ›´æ–°äº† 1 æ¡æ•°æ®ï¼ŒRedis è‡ªåŠ¨è§¦å‘ BGSAVE å‘½ä»¤ï¼Œå°†æ•°æ®ä¿å­˜åˆ°ç¡¬ç›˜ã€‚</li><li>save 300 10 è¡¨ç¤ºåœ¨ 300 ç§’å†…ï¼Œè‡³å°‘æ›´æ–°äº† 10 æ¡æ•°æ®ï¼ŒRedis è‡ªåŠ¨è§¦ BGSAVE å‘½ä»¤ï¼Œå°†æ•°æ®ä¿å­˜åˆ°ç¡¬ç›˜ã€‚</li><li>save 60 10000 è¡¨ç¤º 60 ç§’å†…ï¼Œè‡³å°‘æ›´æ–°äº† 10000 æ¡æ•°æ®ï¼ŒRedis è‡ªåŠ¨è§¦å‘ BGSAVE å‘½ä»¤ï¼Œå°†æ•°æ®ä¿å­˜åˆ°ç¡¬ç›˜ã€‚</li></ul><p>åªè¦ä¸Šè¿°ä¸‰ä¸ªæ¡ä»¶ä»»æ„æ»¡è¶³ä¸€ä¸ªï¼ŒæœåŠ¡å™¨å°±ä¼šè‡ªåŠ¨æ‰§è¡Œ<code>BGSAVE</code>å‘½ä»¤ã€‚å½“ç„¶æ‚¨å¯ä»¥æ ¹æ®å®é™…æƒ…å†µè‡ªå·±è°ƒæ•´è§¦å‘ç­–ç•¥ã€‚</p><p><strong>æ³¨æ„ï¼šæ¯æ¬¡åˆ›å»º RDB æ–‡ä»¶ä¹‹åï¼ŒRedis æœåŠ¡å™¨ä¸ºå®ç°è‡ªåŠ¨æŒä¹…åŒ–è€Œè®¾ç½®çš„æ—¶é—´è®¡æ•°å’Œæ¬¡æ•°è®¡æ•°å°±ä¼šè¢«æ¸…é›¶ï¼Œå¹¶é‡æ–°å¼€å§‹è®¡æ•°ï¼Œå› æ­¤å¤šä¸ªç­–ç•¥çš„æ•ˆæœä¸ä¼šå åŠ ã€‚</strong></p><h5 id="è§¦å‘æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#è§¦å‘æœºåˆ¶" aria-hidden="true">#</a> è§¦å‘æœºåˆ¶</h5><p>1ï¼‰<strong>saveçš„è§„åˆ™æ»¡è¶³çš„æƒ…å†µä¸‹</strong> redis.confä¸­é…ç½®<code>save m n</code>ï¼Œå³åœ¨mç§’å†…æœ‰næ¬¡ä¿®æ”¹æ—¶ï¼Œè‡ªåŠ¨è§¦å‘bgsaveç”Ÿæˆrdbæ–‡ä»¶ï¼›</p><p>2ï¼‰<strong>ä¸»ä»å¤åˆ¶æ—¶</strong>ï¼Œ<strong>ä»èŠ‚ç‚¹è¦ä»ä¸»èŠ‚ç‚¹è¿›è¡Œå…¨é‡å¤åˆ¶</strong>æ—¶ä¹Ÿä¼šè§¦å‘bgsaveæ“ä½œï¼Œç”Ÿæˆå½“æ—¶çš„å¿«ç…§å‘é€åˆ°ä»èŠ‚ç‚¹ï¼›</p><p>3ï¼‰<strong>æ‰§è¡Œdebug reloadå‘½ä»¤</strong>é‡æ–°åŠ è½½redisæ—¶ä¹Ÿä¼šè§¦å‘bgsaveæ“ä½œï¼›</p><p>4ï¼‰é€€å‡ºRedisï¼Œä¹Ÿä¼šè§¦å‘rdbè§„åˆ™ é»˜è®¤æƒ…å†µä¸‹<strong>æ‰§è¡Œshutdownå‘½ä»¤æ—¶</strong>ï¼Œå¦‚æœæ²¡æœ‰å¼€å¯aofæŒä¹…åŒ–ï¼Œé‚£ä¹ˆä¹Ÿä¼šè§¦å‘bgsaveæ“ä½œï¼›</p><p>5ï¼‰<strong>æ‰§è¡Œflushallå‘½ä»¤</strong>ï¼Œä¹Ÿä¼šè§¦å‘rdbè§„åˆ™</p><h5 id="æ¢å¤rdbæ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#æ¢å¤rdbæ–‡ä»¶" aria-hidden="true">#</a> æ¢å¤rdbæ–‡ä»¶</h5><p>åªéœ€å°†å¤‡ä»½çš„rdbæ–‡ä»¶æ”¾åœ¨æˆ‘ä»¬çš„rediså¯åŠ¨ç›®å½•å³å¯ï¼ŒRediså¯åŠ¨çš„æ—¶å€™ä¼šè‡ªåŠ¨æ£€æŸ¥dump.rdbæ–‡ä»¶å¹¶æ¢å¤å…¶ä¸­çš„æ•°æ®ï¼</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>127.0.0.1:6379&gt; config get dir
1) &quot;dir&quot;
2) &quot;/usr/local/bin&quot;  # å¦‚æœåœ¨è¿™ä¸ªç›®å½•ä¸‹å­˜åœ¨ dump.rdb æ–‡ä»¶ï¼Œå¯åŠ¨å°±ä¼šè‡ªåŠ¨æ¢å¤å…¶ä¸­çš„æ•°æ®
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="ä¼˜ç¼ºç‚¹" tabindex="-1"><a class="header-anchor" href="#ä¼˜ç¼ºç‚¹" aria-hidden="true">#</a> ä¼˜ç¼ºç‚¹</h5><blockquote><p><strong>ä¼˜ç‚¹</strong>ï¼š 1ã€é€‚åˆå¤§è§„æ¨¡çš„æ•°æ®æ¢å¤ï¼ 2ã€å¯¹æ•°æ®çš„å®Œæ•´æ€§è¦æ±‚ä¸é«˜ï¼ <strong>ç¼ºç‚¹</strong>ï¼š 1ã€éœ€è¦ä¸€å®šçš„æ—¶é—´é—´éš”è¿›ç¨‹æ“ä½œï¼å¦‚æœredisæ„å¤–å®•æœºäº†ï¼Œè¿™ä¸ªæœ€åä¸€æ¬¡ä¿®æ”¹æ•°æ®å°±æ²¡æœ‰çš„äº†ï¼ 2ã€forkè¿›ç¨‹çš„æ—¶å€™ï¼Œä¼šå ç”¨ä¸€å®šçš„å†…å®¹ç©ºé—´ï¼</p><p>â‘¥æ€»ç»“ï¼š Redisä¼šå•ç‹¬åˆ›å»ºï¼ˆforkï¼‰ä¸€ä¸ªå­è¿›ç¨‹æ¥è¿›è¡ŒæŒä¹…åŒ–ï¼Œä¼šå…ˆå°†æ•°æ®å†™å…¥åˆ°ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ä¸­ï¼Œå¾…æŒä¹…åŒ–è¿‡ç¨‹éƒ½ç»“æŸäº†ï¼Œå†ç”¨è¿™ä¸ªä¸´æ—¶æ–‡ä»¶æ›¿æ¢ä¸Šæ¬¡æŒä¹…åŒ–å¥½çš„æ–‡ä»¶ã€‚æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œä¸»è¿›ç¨‹æ˜¯ä¸è¿›è¡Œä»»ä½•IOæ“ä½œçš„ã€‚ è¿™å°±ç¡®ä¿äº†æé«˜çš„æ€§èƒ½ã€‚å¦‚æœéœ€è¦è¿›è¡Œå¤§è§„æ¨¡æ•°æ®çš„æ¢å¤ï¼Œä¸”å¯¹äºæ•°æ®æ¢å¤çš„å®Œæ•´æ€§ä¸æ˜¯éå¸¸æ•æ„Ÿï¼Œé‚£RDBæ–¹å¼è¦æ¯”AOFæ–¹å¼æ›´åŠ çš„é«˜æ•ˆã€‚RDBçš„ç¼ºç‚¹æ˜¯æœ€åä¸€æ¬¡æŒä¹…åŒ–åçš„æ•°æ®å¯èƒ½ä¸¢å¤±ã€‚æˆ‘ä»¬é»˜è®¤çš„å°±æ˜¯RDBï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä¸éœ€è¦ä¿®æ”¹è¿™ä¸ªé…ç½®ï¼</p><p>åœ¨ç”Ÿäº§ç¯å¢ƒæˆ‘ä»¬ä¼šå°†è¿™ä¸ªæ–‡ä»¶è¿›è¡Œå¤‡ä»½ï¼</p></blockquote><h4 id="aof-append-only-file" tabindex="-1"><a class="header-anchor" href="#aof-append-only-file" aria-hidden="true">#</a> AOFï¼ˆAppend Only Fileï¼‰</h4><blockquote><p>AOF æŒä¹…åŒ–ä¼šå°† Redis æœåŠ¡å™¨<strong>æ‰§è¡Œçš„æ¯ä¸ªå†™å‘½ä»¤éƒ½è¿½åŠ åˆ° AOF æ–‡ä»¶ä¸­</strong>ã€‚å½“ Redis éœ€è¦è¿›è¡Œæ•°æ®æ¢å¤æ—¶ï¼Œåªéœ€è¦å°† AOF æ–‡ä»¶ä¸­çš„å†™å‘½ä»¤é‡æ–°æ‰§è¡Œä¸€éï¼Œå°±å¯ä»¥å®Œå…¨æ¢å¤ Redis ä¸­çš„æ•°æ®ã€‚</p><p>Redis æ”¯æŒä¸‰ç§appendfsyncåˆ·ç›˜ç­–ç•¥ï¼ˆ<strong>ä¸ºäº†æå‡å†™å…¥æ•ˆç‡</strong>ï¼Œ<strong>ä¸ä¼šå°†å†…å®¹ç›´æ¥å†™å…¥åˆ°ç£ç›˜</strong>ä¸­ï¼Œè€Œæ˜¯<strong>å°†å…¶æ”¾åˆ°ä¸€ä¸ªå†…å­˜ç¼“å­˜åŒºï¼ˆaof_bufï¼‰ä¸­</strong>ï¼‰</p><ul><li>alwaysï¼šæ¯æ¬¡å†™æ“ä½œåéƒ½ä¼šæ‰§è¡Œ fsync() å°†å†™å…¥çš„æ•°æ®ç«‹å³å†™å…¥ç£ç›˜ï¼Œä¿è¯æ•°æ®çš„å®‰å…¨æ€§ï¼Œä½†ä¼šå¯¹æ€§èƒ½äº§ç”Ÿå½±å“ã€‚</li><li>everysec(é»˜è®¤)ï¼šæ¯ç§’é’Ÿæ‰§è¡Œä¸€æ¬¡ fsync()ï¼Œåœ¨ä¿è¯æ•°æ®å®‰å…¨çš„åŒæ—¶å°½å¯èƒ½å‡å°‘ fsync() çš„è°ƒç”¨ï¼Œæé«˜æ€§èƒ½ã€‚</li><li>noï¼šå°† fsync() äº¤ç»™æ“ä½œç³»ç»Ÿæ¥å¤„ç†ï¼Œæ— æ³•ä¿è¯æ•°æ®çš„å®Œæ•´æ€§ï¼Œä½†å¯ä»¥è·å¾—æœ€å¥½çš„æ€§èƒ½ã€‚</li></ul><p>AOF æŒä¹…åŒ–çš„ä¼˜ç‚¹</p><ul><li>æ•°æ®å®‰å…¨ï¼šAOF æŒä¹…åŒ–èƒ½å¤Ÿç¡®ä¿ Redis æœåŠ¡å™¨åœ¨é‡å¯æ—¶èƒ½å¤Ÿå®Œå…¨æ¢å¤æ•°æ®ï¼Œé¿å…æ•°æ®ä¸¢å¤±çš„é£é™©ã€‚</li><li>é«˜å¯é æ€§ï¼šAOF æŒä¹…åŒ–è®°å½•äº†æ¯ä¸ªå†™å‘½ä»¤ï¼Œå³ä½¿ Redis æœåŠ¡å™¨æ„å¤–å®•æœºï¼Œä¹Ÿå¯ä»¥é€šè¿‡ AOF æ–‡ä»¶ä¸­çš„å‘½ä»¤æ¥æ¢å¤æ•°æ®ã€‚</li><li>çµæ´»æ€§ï¼šAOF æŒä¹…åŒ–å¯ä»¥æ ¹æ®éœ€è¦é€‰æ‹©ä¸‰ç§ä¸åŒçš„æŒä¹…åŒ–æ–¹å¼ï¼Œä»¥å¹³è¡¡æ•°æ®å®‰å…¨æ€§å’Œæ€§èƒ½ä¹‹é—´çš„å…³ç³»ã€‚</li><li>å…¼å®¹æ€§ï¼šAOF æŒä¹…åŒ–ä¸ä¼šå½±å“ Redis çš„è¯»å†™æ€§èƒ½ï¼Œå› æ­¤å¯ä»¥ä¸ Redis çš„å…¶ä»–åŠŸèƒ½å…¼å®¹ã€‚</li></ul><p>AOF æŒä¹…åŒ–çš„ä¸è¶³</p><ul><li>æ–‡ä»¶ä½“ç§¯ï¼šç”±äº AOF æ–‡ä»¶éœ€è¦è®°å½•æ¯ä¸ªå†™å‘½ä»¤ï¼Œå› æ­¤å¯èƒ½ä¼šæ¯” RDB æ–‡ä»¶æ›´å¤§ï¼Œå¯¼è‡´å­˜å‚¨ç©ºé—´æµªè´¹ã€‚</li><li>æ€§èƒ½é—®é¢˜ï¼šåœ¨ always æ¨¡å¼ä¸‹ï¼Œæ¯æ¬¡å†™å…¥æ“ä½œéƒ½éœ€è¦æ‰§è¡Œ fsync()ï¼Œè¿™ä¼šå¯¹æ€§èƒ½äº§ç”Ÿå½±å“ã€‚å³ä½¿ä½¿ç”¨ everysec æ¨¡å¼ï¼Œä»ç„¶ä¼šæœ‰ä¸€å®šçš„ fsync() å»¶è¿Ÿï¼Œå¯èƒ½ä¼šå¯¼è‡´æ•°æ®çš„ä¸¢å¤±ã€‚</li><li>é‡å†™é—®é¢˜ï¼šAOF æ–‡ä»¶åœ¨ä¸æ–­è¿½åŠ å†™å‘½ä»¤æ—¶ï¼Œå¯èƒ½ä¼šå˜å¾—å¾ˆå¤§ï¼Œå½±å“æ€§èƒ½ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒRedis æä¾›äº† AOF é‡å†™åŠŸèƒ½ï¼Œå¯ä»¥å¯¹ AOF æ–‡ä»¶è¿›è¡Œå‹ç¼©ã€‚ä½†æ˜¯ï¼ŒAOF é‡å†™ä¹Ÿä¼šå¯¹æ€§èƒ½äº§ç”Ÿå½±å“ï¼ˆï¼‰ã€‚ <ul><li>REWRITEAOFï¼šè¿›è¡Œ AOF é‡å†™ï¼Œä½†æ˜¯ä¼šé˜»å¡ä¸»è¿›ç¨‹ï¼ŒæœåŠ¡å™¨å°†æ— æ³•å¤„ç†å®¢æˆ·ç«¯å‘æ¥çš„å‘½ä»¤è¯·æ±‚ï¼Œé€šå¸¸ä¸ä¼šç›´æ¥ä½¿ç”¨è¯¥å‘½ä»¤ã€‚</li><li>BGREWRITEAOFï¼šfork å­è¿›ç¨‹æ¥è¿›è¡Œ AOF é‡å†™ï¼Œé˜»å¡åªä¼šå‘ç”Ÿåœ¨ fork å­è¿›ç¨‹çš„æ—¶å€™ï¼Œä¹‹åä¸»è¿›ç¨‹å¯ä»¥æ­£å¸¸å¤„ç†è¯·æ±‚ã€‚</li></ul></li></ul></blockquote><blockquote><p>éœ€è¦æ‰‹åŠ¨å¼€å¯ï¼›å¯ä»¥é€šè¿‡é…ç½®ï¼šappendonly yes å¼€å¯</p><p><strong>è®°å½•æ‰€æœ‰çš„å†™æ“ä½œåˆ°.aofæ–‡ä»¶ä¸­</strong>ï¼ˆä¿å­˜ Redis æœåŠ¡å™¨æ‰€æ‰§è¡Œçš„æ‰€æœ‰å†™æ“ä½œå‘½ä»¤æ¥è®°å½•æ•°æ®åº“çŠ¶æ€ï¼ŒæœåŠ¡å™¨å¯åŠ¨æ—¶ï¼Œé€šè¿‡é‡æ–°æ‰§è¡Œè¿™äº›å‘½ä»¤æ¥è¿˜åŸæ•°æ®é›†ã€‚ï¼‰</p><p>æ¯å½“æœ‰ä¸€ä¸ª<strong>ä¿®æ”¹æ•°æ®åº“çš„å‘½ä»¤</strong>è¢«æ‰§è¡Œæ—¶ï¼ŒæœåŠ¡å™¨å°±<strong>å°†å‘½ä»¤å†™å…¥åˆ° appendonly.aof æ–‡ä»¶ä¸­</strong>ï¼Œè¯¥æ–‡ä»¶<strong>å­˜å‚¨äº†æœåŠ¡å™¨æ‰§è¡Œè¿‡çš„æ‰€æœ‰ä¿®æ”¹å‘½ä»¤</strong>ï¼Œå› æ­¤ï¼Œ<strong>åªè¦æœåŠ¡å™¨é‡æ–°æ‰§è¡Œä¸€æ¬¡ .aof æ–‡ä»¶</strong>ï¼Œå°±å¯ä»¥å®ç°<strong>è¿˜åŸæ•°æ®</strong>çš„ç›®çš„ï¼Œè¿™ä¸ªè¿‡ç¨‹è¢«å½¢è±¡åœ°ç§°ä¹‹ä¸º**â€œå‘½ä»¤é‡æ¼”â€**ã€‚</p><p><strong>è‹¥RDBå’ŒAOFåŒæ—¶å¼€å¯ ç³»ç»Ÿä¼šä¼˜å…ˆè¯».aofæ–‡ä»¶</strong></p></blockquote><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221130005653537.png" alt="image-20221130005653537"></p><h5 id="å†™å…¥æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#å†™å…¥æœºåˆ¶" aria-hidden="true">#</a> å†™å…¥æœºåˆ¶</h5><p><strong>Redis åœ¨æ”¶åˆ°</strong>å®¢æˆ·ç«¯<strong>ä¿®æ”¹å‘½ä»¤</strong>åï¼Œå…ˆ<strong>è¿›è¡Œç›¸åº”çš„æ ¡éªŒ</strong>ï¼Œå¦‚æœæ²¡é—®é¢˜ï¼Œå°±<strong>ç«‹å³å°†è¯¥å‘½ä»¤å­˜è¿½åŠ åˆ° .aof æ–‡ä»¶ä¸­</strong>ï¼Œä¹Ÿå°±æ˜¯<strong>å…ˆå­˜åˆ°ç£ç›˜ä¸­</strong>ï¼Œç„¶å<strong>æœåŠ¡å™¨å†æ‰§è¡Œå‘½ä»¤</strong>ã€‚è¿™æ ·å°±ç®—é‡åˆ°äº†çªå‘çš„å®•æœºæƒ…å†µæƒ…å†µï¼Œä¹Ÿåªéœ€å°†å­˜å‚¨åˆ° .aof æ–‡ä»¶ä¸­çš„å‘½ä»¤ï¼Œè¿›è¡Œä¸€æ¬¡â€œå‘½ä»¤é‡æ¼”â€å°±å¯ä»¥æ¢å¤åˆ°å®•æœºå‰çš„çŠ¶æ€ã€‚</p><p>åœ¨ä¸Šè¿°æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œæœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„ç¯èŠ‚å°±æ˜¯å‘½ä»¤çš„å†™å…¥ï¼Œè¿™æ˜¯ä¸€ä¸ª IO æ“ä½œã€‚<strong>ä¸ºäº†æå‡å†™å…¥æ•ˆç‡</strong>ï¼Œå®ƒ<strong>ä¸ä¼šå°†å†…å®¹ç›´æ¥å†™å…¥åˆ°ç£ç›˜</strong>ä¸­ï¼Œè€Œæ˜¯<strong>å°†å…¶æ”¾åˆ°ä¸€ä¸ªå†…å­˜ç¼“å­˜åŒºï¼ˆbufferï¼‰ä¸­</strong>ï¼Œç­‰åˆ°<strong>ç¼“å­˜åŒºè¢«å¡«æ»¡æ—¶æ‰çœŸæ­£å°†ç¼“å­˜åŒºä¸­çš„å†…å®¹å†™å…¥åˆ°ç£ç›˜é‡Œ</strong>ã€‚</p><blockquote><p>Linux æ“ä½œç³»ç»Ÿä¸­ä¸ºäº†æå‡æ€§èƒ½ï¼Œä½¿ç”¨äº†é¡µç¼“å­˜ï¼ˆpage cacheï¼‰ã€‚å½“æˆ‘ä»¬å°† aof_buf çš„å†…å®¹å†™åˆ°ç£ç›˜ä¸Šæ—¶ï¼Œæ­¤æ—¶æ•°æ®å¹¶æ²¡æœ‰çœŸæ­£çš„è½ç›˜ï¼Œè€Œæ˜¯åœ¨ page cache ä¸­ï¼Œä¸ºäº†å°† page cache ä¸­çš„æ•°æ®çœŸæ­£è½ç›˜ï¼Œéœ€è¦æ‰§è¡Œ fsync / fdatasync å‘½ä»¤æ¥å¼ºåˆ¶åˆ·ç›˜ã€‚è¿™è¾¹çš„æ–‡ä»¶åŒæ­¥åšçš„å°±æ˜¯åˆ·ç›˜æ“ä½œï¼Œæˆ–è€…å«æ–‡ä»¶åˆ·ç›˜å¯èƒ½æ›´å®¹æ˜“ç†è§£ä¸€äº›ã€‚</p></blockquote><h5 id="é‡å†™æœºåˆ¶â˜…" tabindex="-1"><a class="header-anchor" href="#é‡å†™æœºåˆ¶â˜…" aria-hidden="true">#</a> é‡å†™æœºåˆ¶â˜…</h5><blockquote><p>Redis åœ¨é•¿æœŸè¿è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œaof æ–‡ä»¶ä¼šè¶Šå˜è¶Šé•¿ã€‚å¦‚æœæœºå™¨å®•æœºé‡å¯ï¼Œâ€œé‡æ¼”â€æ•´ä¸ª aof æ–‡ä»¶ä¼šéå¸¸è€—æ—¶ï¼Œå¯¼è‡´é•¿æ—¶é—´ Redis æ— æ³•å¯¹å¤–æä¾›æœåŠ¡ã€‚å› æ­¤å°±éœ€è¦å¯¹ aof æ–‡ä»¶åšä¸€ä¸‹â€œç˜¦èº«â€è¿åŠ¨ã€‚</p><p>ä¸ºäº†è®© <strong>aof æ–‡ä»¶çš„å¤§å°æ§åˆ¶åœ¨åˆç†çš„èŒƒå›´å†…</strong>ï¼ŒRedis æä¾›äº† AOF é‡å†™æœºåˆ¶ï¼Œæ‰‹åŠ¨æ‰§è¡Œ<code>BGREWRITEAOF</code>å‘½ä»¤ï¼Œå¼€å§‹é‡å†™ aof æ–‡ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><ul><li><p>REWRITEAOFï¼šè¿›è¡Œ AOF é‡å†™ï¼Œä½†æ˜¯ä¼šé˜»å¡ä¸»è¿›ç¨‹ï¼ŒæœåŠ¡å™¨å°†æ— æ³•å¤„ç†å®¢æˆ·ç«¯å‘æ¥çš„å‘½ä»¤è¯·æ±‚ï¼Œé€šå¸¸ä¸ä¼šç›´æ¥ä½¿ç”¨è¯¥å‘½ä»¤ã€‚</p></li><li><p><strong>BGREWRITEAOFï¼šfork å­è¿›ç¨‹æ¥è¿›è¡Œ AOF é‡å†™ï¼Œé˜»å¡åªä¼šå‘ç”Ÿåœ¨ fork å­è¿›ç¨‹çš„æ—¶å€™ï¼Œä¹‹åä¸»è¿›ç¨‹å¯ä»¥æ­£å¸¸å¤„ç†è¯·æ±‚ã€‚</strong></p></li></ul></blockquote><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>127.0.0.1:6379&gt; BGREWRITEAOF
Background append only file rewriting started
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡ä¸Šè¿°æ“ä½œåï¼ŒæœåŠ¡å™¨ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„ aof æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p><ul><li>æ–°çš„ aof æ–‡ä»¶è®°å½•çš„æ•°æ®åº“æ•°æ®å’ŒåŸ aof æ–‡ä»¶è®°å½•çš„æ•°æ®åº“<strong>æ•°æ®å®Œå…¨ä¸€è‡´</strong>ï¼›</li><li>æ–°çš„ aof æ–‡ä»¶ä¼šä½¿ç”¨<strong>å°½å¯èƒ½å°‘çš„å‘½ä»¤æ¥è®°å½•æ•°æ®åº“æ•°æ®</strong>ï¼Œå› æ­¤æ–°çš„ aof æ–‡ä»¶çš„<strong>ä½“ç§¯ä¼šå°</strong>å¾ˆå¤šï¼›</li><li><strong>AOF é‡å†™æœŸé—´</strong>ï¼ŒæœåŠ¡å™¨<strong>ä¸ä¼šè¢«é˜»å¡</strong>ï¼Œå®ƒå¯ä»¥æ­£å¸¸å¤„ç†å®¢æˆ·ç«¯å‘é€çš„å‘½ä»¤ã€‚</li></ul><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221130010336666.png" alt="image-20221130010336666"></p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># è‡ªåŠ¨è§¦å‘AOFé‡å†™
auto-aof-rewrite-percentage 100  #å†™å…¥ç™¾åˆ†æ¯”
auto-aof-rewrite-min-size 64mb  #å†™å…¥çš„æ–‡ä»¶æœ€å¤§å€¼æ˜¯å¤šå°‘ï¼Œä¸€èˆ¬åœ¨å®é™…å·¥ä½œä¸­æˆ‘ä»¬ä¼šå°†å…¶è®¾ç½®ä¸º5gbå·¦å³ï¼
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="aof-åå°é‡å†™å­˜åœ¨çš„æ•°æ®ä¸ä¸€è‡´é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#aof-åå°é‡å†™å­˜åœ¨çš„æ•°æ®ä¸ä¸€è‡´é—®é¢˜" aria-hidden="true">#</a> AOF åå°é‡å†™å­˜åœ¨çš„æ•°æ®ä¸ä¸€è‡´é—®é¢˜</h6><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230412011707264.png" alt="image-20230412011707264"></p><blockquote><p>Redis å¼•å…¥äº† <strong>AOF é‡å†™ç¼“å†²åŒºï¼ˆaof_rewrite_buf_blocksï¼‰</strong></p><p>è¿™ä¸ª<strong>ç¼“å†²åŒºåœ¨æœåŠ¡å™¨åˆ›å»ºå­è¿›ç¨‹ä¹‹åå¼€å§‹ä½¿ç”¨</strong>ï¼Œå½“ Redis æœåŠ¡å™¨æ‰§è¡Œå®Œä¸€ä¸ªå†™å‘½ä»¤ä¹‹åï¼Œå®ƒä¼šåŒæ—¶å°†è¿™ä¸ªå†™å‘½ä»¤è¿½åŠ åˆ° AOF ç¼“å†²åŒºå’Œ AOF é‡å†™ç¼“å†²åŒºã€‚</p><p>1ã€<strong>ç°æœ‰ AOF æ–‡ä»¶çš„å¤„ç†å·¥ä½œä¼šå¦‚å¸¸è¿›è¡Œ</strong>ã€‚è¿™æ ·å³ä½¿åœ¨é‡å†™çš„ä¸­é€”å‘ç”Ÿåœæœºï¼Œç°æœ‰çš„ AOF æ–‡ä»¶ä¹Ÿè¿˜æ˜¯å®‰å…¨çš„ã€‚</p><p>2ã€ä»åˆ›å»ºå­è¿›ç¨‹å¼€å§‹ï¼Œä¹Ÿå°±æ˜¯ <strong>AOF é‡å†™å¼€å§‹ï¼ŒæœåŠ¡å™¨æ‰§è¡Œçš„æ‰€æœ‰å†™å‘½ä»¤</strong>ä¼šè¢«<strong>è®°å½•åˆ° AOF é‡å†™ç¼“å†²åŒºé‡Œé¢</strong>ã€‚</p><p><strong>å½“å­è¿›ç¨‹å®Œæˆ AOF é‡å†™å·¥ä½œå</strong>ï¼Œ**çˆ¶è¿›ç¨‹ï¼ˆè¿™ä¸€è¿‡ç¨‹ä¼šå¯¼è‡´ä¸»è¿›ç¨‹æ— æ³•å¤„ç†è¯·æ±‚ï¼‰**ä¼šåœ¨ serverCron ä¸­æ£€æµ‹åˆ°å­è¿›ç¨‹å·²ç»é‡å†™ç»“æŸï¼Œåˆ™ä¼šæ‰§è¡Œä»¥ä¸‹å·¥ä½œï¼š</p><p>1ã€<strong>å°† AOF é‡å†™ç¼“å†²åŒºä¸­çš„æ‰€æœ‰å†…å®¹å†™å…¥åˆ°æ–° AOF æ–‡ä»¶ä¸­</strong>ï¼Œè¿™æ—¶æ–° AOF æ–‡ä»¶æ‰€ä¿å­˜çš„æ•°æ®åº“çŠ¶æ€å°†å’ŒæœåŠ¡å™¨å½“å‰çš„æ•°æ®åº“çŠ¶æ€ä¸€è‡´ã€‚</p><p>2ã€<strong>å¯¹æ–°çš„ AOF æ–‡ä»¶è¿›è¡Œæ”¹åï¼ŒåŸå­çš„è¦†ç›–ç°æœ‰çš„ AOF æ–‡ä»¶</strong>ï¼Œå®Œæˆæ–°æ—§ä¸¤ä¸ª AOF æ–‡ä»¶çš„æ›¿æ¢ã€‚</p><p><strong>ä¹‹åï¼Œçˆ¶è¿›ç¨‹å°±å¯ä»¥ç»§ç»­æ¥å—å‘½ä»¤è¯·æ±‚</strong>äº†ã€‚</p></blockquote><h6 id="aof-é‡å†™ç¼“å†²åŒºå†…å®¹è¿‡å¤š" tabindex="-1"><a class="header-anchor" href="#aof-é‡å†™ç¼“å†²åŒºå†…å®¹è¿‡å¤š" aria-hidden="true">#</a> AOF é‡å†™ç¼“å†²åŒºå†…å®¹è¿‡å¤š</h6><blockquote><p><strong>å°† AOF é‡å†™ç¼“å†²åŒºçš„å†…å®¹è¿½åŠ åˆ°æ–° AOF æ–‡ä»¶</strong>çš„å·¥ä½œæ˜¯<strong>ç”±ä¸»è¿›ç¨‹å®Œæˆ</strong>çš„ï¼Œæ‰€ä»¥<strong>è¿™ä¸€è¿‡ç¨‹ä¼šå¯¼è‡´ä¸»è¿›ç¨‹æ— æ³•å¤„ç†è¯·æ±‚</strong>ï¼Œå¦‚æœ<strong>å†…å®¹è¿‡å¤š</strong>ï¼Œå¯èƒ½ä¼š<strong>ä½¿å¾—é˜»å¡æ—¶é—´è¿‡é•¿</strong>ï¼Œæ˜¾ç„¶æ˜¯æ— æ³•æ¥å—çš„ã€‚</p><p>Redis ä¸­å·²ç»é’ˆå¯¹è¿™ç§æƒ…å†µè¿›è¡Œäº†ä¼˜åŒ–ï¼š</p><p>1ã€åœ¨<strong>è¿›è¡Œ AOF åå°é‡å†™æ—¶</strong>ï¼ŒRedis ä¼š<strong>åˆ›å»ºä¸€ç»„ç”¨äºçˆ¶å­è¿›ç¨‹é—´é€šä¿¡çš„ç®¡é“</strong>ï¼ŒåŒæ—¶ä¼š<strong>æ–°å¢ä¸€ä¸ªæ–‡ä»¶äº‹ä»¶</strong>ï¼Œè¯¥æ–‡ä»¶äº‹ä»¶ä¼šå°†å†™å…¥ AOF é‡å†™ç¼“å†²åŒºçš„å†…å®¹é€šè¿‡è¯¥ç®¡é“å‘é€åˆ°å­è¿›ç¨‹ã€‚</p><p>2ã€åœ¨é‡å†™ç»“æŸåï¼Œ<strong>å­è¿›ç¨‹ä¼šé€šè¿‡è¯¥ç®¡é“å°½é‡ä»çˆ¶è¿›ç¨‹è¯»å–æ›´å¤šçš„æ•°æ®</strong>ï¼Œæ¯æ¬¡ç­‰å¾…å¯è¯»å–äº‹ä»¶1msï¼Œå¦‚æœä¸€ç›´èƒ½è¯»å–åˆ°æ•°æ®ï¼Œåˆ™è¿™ä¸ªè¿‡ç¨‹æœ€å¤šæ‰§è¡Œ1000æ¬¡ï¼Œä¹Ÿå°±æ˜¯1ç§’ã€‚å¦‚æœè¿ç»­20æ¬¡æ²¡æœ‰è¯»å–åˆ°æ•°æ®ï¼Œåˆ™ç»“æŸè¿™ä¸ªè¿‡ç¨‹ã€‚</p><p>é€šè¿‡è¿™äº›ä¼˜åŒ–ï¼Œ<strong>Redis å°½é‡è®© AOF é‡å†™ç¼“å†²åŒºçš„å†…å®¹æ›´å°‘ï¼Œä»¥å‡å°‘ä¸»è¿›ç¨‹é˜»å¡çš„æ—¶é—´ã€‚</strong></p></blockquote><h6 id="é‡å†™æœºåˆ¶çš„æ ¸å¿ƒæµç¨‹" tabindex="-1"><a class="header-anchor" href="#é‡å†™æœºåˆ¶çš„æ ¸å¿ƒæµç¨‹" aria-hidden="true">#</a> é‡å†™æœºåˆ¶çš„æ ¸å¿ƒæµç¨‹</h6><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230411150742833.png" alt="image-20230411150742833"></p><h5 id="ä¿®å¤aofæ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#ä¿®å¤aofæ–‡ä»¶" aria-hidden="true">#</a> ä¿®å¤aofæ–‡ä»¶</h5><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>redis-check-aof --fix appendonly.aof  #ä¿®å¤appendonly.aofæ–‡ä»¶
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h5 id="aofç­–ç•¥é…ç½®" tabindex="-1"><a class="header-anchor" href="#aofç­–ç•¥é…ç½®" aria-hidden="true">#</a> AOFç­–ç•¥é…ç½®</h5><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># appendfsync always # æ¯æ¬¡ä¿®æ”¹éƒ½ä¼š syncã€‚æ¶ˆè€—æ€§èƒ½ 
appendfsync everysec # æ¯ç§’æ‰§è¡Œä¸€æ¬¡ syncï¼Œå¯èƒ½ä¼šä¸¢å¤±è¿™1sçš„æ•°æ®ï¼ # appendfsync no # ä¸æ‰§è¡Œ syncï¼Œè¿™ä¸ªæ—¶å€™æ“ä½œç³»ç»Ÿè‡ªå·±åŒæ­¥æ•°æ®ï¼Œé€Ÿåº¦æœ€å¿«ï¼

appendfilename &quot;appendonly.aof&quot; # æŒä¹…åŒ–çš„æ–‡ä»¶çš„åå­—
appendonly no # é»˜è®¤æ˜¯ä¸å¼€å¯aofæ¨¡å¼çš„ï¼Œé»˜è®¤æ˜¯ä½¿ç”¨rdbæ–¹å¼æŒä¹…åŒ–çš„ï¼Œåœ¨å¤§éƒ¨åˆ†æ‰€æœ‰çš„æƒ…å†µä¸‹ï¼Œ rdbå®Œå…¨å¤Ÿç”¨ï¼
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221130010521121.png" alt="image-20221130010521121"></p><ul><li>Alwaysï¼šæœåŠ¡å™¨æ¯å†™å…¥ä¸€ä¸ªå‘½ä»¤ï¼Œå°±è°ƒç”¨ä¸€æ¬¡ fsync å‡½æ•°ï¼Œå°†ç¼“å†²åŒºé‡Œé¢çš„å‘½ä»¤å†™å…¥åˆ°ç¡¬ç›˜ã€‚è¿™ç§æ¨¡å¼ä¸‹ï¼ŒæœåŠ¡å™¨å‡ºç°æ•…éšœï¼Œä¹Ÿä¸ä¼šä¸¢å¤±ä»»ä½•å·²ç»æˆåŠŸæ‰§è¡Œçš„å‘½ä»¤æ•°æ®ï¼Œä½†æ˜¯å…¶æ‰§è¡Œé€Ÿåº¦è¾ƒæ…¢ï¼›</li><li>Everysecï¼ˆé»˜è®¤ï¼‰ï¼šæœåŠ¡å™¨æ¯ä¸€ç§’è°ƒç”¨ä¸€æ¬¡ fsync å‡½æ•°ï¼Œå°†ç¼“å†²åŒºé‡Œé¢çš„å‘½ä»¤å†™å…¥åˆ°ç¡¬ç›˜ã€‚è¿™ç§æ¨¡å¼ä¸‹ï¼ŒæœåŠ¡å™¨å‡ºç°æ•…éšœï¼Œæœ€å¤šåªä¸¢å¤±ä¸€ç§’é’Ÿå†…çš„æ‰§è¡Œçš„å‘½ä»¤æ•°æ®ï¼Œé€šå¸¸éƒ½ä½¿ç”¨å®ƒä½œä¸º AOF é…ç½®ç­–ç•¥ï¼›</li><li>Noï¼šæœåŠ¡å™¨ä¸ä¸»åŠ¨è°ƒç”¨ fsync å‡½æ•°ï¼Œç”±æ“ä½œç³»ç»Ÿå†³å®šä½•æ—¶å°†ç¼“å†²åŒºé‡Œé¢çš„å‘½ä»¤å†™å…¥åˆ°ç¡¬ç›˜ã€‚è¿™ç§æ¨¡å¼ä¸‹ï¼ŒæœåŠ¡å™¨é­é‡æ„å¤–åœæœºæ—¶ï¼Œä¸¢å¤±å‘½ä»¤çš„æ•°é‡æ˜¯ä¸ç¡®å®šçš„ï¼Œæ‰€ä»¥è¿™ç§ç­–ç•¥ï¼Œä¸ç¡®å®šæ€§è¾ƒå¤§ï¼Œä¸å®‰å…¨ã€‚</li></ul><p>æ³¨æ„ï¼š<strong>Linux ç³»ç»Ÿ</strong>çš„ <strong>fsync() å‡½æ•°</strong>å¯ä»¥<strong>å°†æŒ‡å®šæ–‡ä»¶çš„å†…å®¹ä»å†…æ ¸ç¼“å­˜åˆ·åˆ°ç¡¬ç›˜ä¸­ã€‚</strong></p><p>ç”±äºæ˜¯ fsync æ˜¯ç£ç›˜ IO æ“ä½œï¼Œæ‰€ä»¥å®ƒå¾ˆæ…¢ï¼å¦‚æœ Redis æ‰§è¡Œä¸€æ¡æŒ‡ä»¤å°±è¦ fsync ä¸€æ¬¡ï¼ˆAlwaysï¼‰ï¼Œé‚£ä¹ˆ Redis é«˜æ€§èƒ½å°†ä¸¥é‡å—åˆ°å½±å“ã€‚</p><p><strong>åœ¨ç”Ÿäº§ç¯å¢ƒçš„æœåŠ¡å™¨ä¸­ï¼ŒRedis é€šå¸¸æ˜¯æ¯éš” 1s å·¦å³æ‰§è¡Œä¸€æ¬¡ fsync æ“ä½œï¼ˆ Everysecï¼‰ï¼Œè¿™æ ·æ—¢ä¿æŒäº†é«˜æ€§èƒ½ï¼Œä¹Ÿè®©æ•°æ®å°½å¯èƒ½çš„å°‘ä¸¢å¤±ã€‚</strong></p><p>æœ€åä¸€ç§ç­–ç•¥ï¼ˆNoï¼‰ï¼Œè®©æ“ä½œç³»ç»Ÿæ¥å†³å®šä½•æ—¶å°†æ•°æ®åŒæ­¥åˆ°ç£ç›˜ï¼Œè¿™ç§ç­–ç•¥å­˜åœ¨è®¸å¤šä¸ç¡®å®šæ€§ï¼Œæ‰€ä»¥ä¸å»ºè®®ä½¿ç”¨ã€‚</p><p>ä»ä¸‰ç§ç­–ç•¥çš„è¿è¡Œé€Ÿåº¦æ¥çœ‹ï¼ŒAlways çš„é€Ÿåº¦æœ€æ…¢ï¼Œè€Œ Everysec å’Œ No éƒ½å¾ˆå¿«ã€‚</p><h4 id="æ··åˆæŒä¹…åŒ–" tabindex="-1"><a class="header-anchor" href="#æ··åˆæŒä¹…åŒ–" aria-hidden="true">#</a> æ··åˆæŒä¹…åŒ–</h4><blockquote><p>æ··åˆæŒä¹…åŒ–æœ¬è´¨æ˜¯<strong>é€šè¿‡ AOF åå°é‡å†™ï¼ˆbgrewriteaof å‘½ä»¤ï¼‰å®Œæˆ</strong>çš„.</p><p>ä¸åŒçš„æ˜¯å½“å¼€å¯æ··åˆæŒä¹…åŒ–æ—¶ï¼Œfork å‡ºçš„å­è¿›ç¨‹å…ˆå°†å½“å‰å…¨é‡æ•°æ®ä»¥ RDB æ–¹å¼å†™å…¥æ–°çš„ AOF æ–‡ä»¶ï¼Œç„¶åå†å°† AOF é‡å†™ç¼“å†²åŒºï¼ˆaof_rewrite_buf_blocksï¼‰çš„å¢é‡å‘½ä»¤ä»¥ AOF æ–¹å¼å†™å…¥åˆ°æ–‡ä»¶ï¼Œå†™å…¥å®Œæˆåé€šçŸ¥ä¸»è¿›ç¨‹å°†æ–°çš„å«æœ‰ RDB æ ¼å¼å’Œ AOF æ ¼å¼çš„ AOF æ–‡ä»¶æ›¿æ¢æ—§çš„çš„ AOF æ–‡ä»¶ã€‚</p><p>æè¿°ï¼šæ··åˆæŒä¹…åŒ–å¹¶ä¸æ˜¯ä¸€ç§å…¨æ–°çš„æŒä¹…åŒ–æ–¹å¼ï¼Œè€Œæ˜¯å¯¹å·²æœ‰æ–¹å¼çš„ä¼˜åŒ–ã€‚<strong>æ··åˆæŒä¹…åŒ–åªå‘ç”Ÿäº AOF é‡å†™è¿‡ç¨‹</strong>ã€‚ä½¿ç”¨äº†æ··åˆæŒä¹…åŒ–ï¼Œ</p><p><strong>é‡å†™åçš„æ–° AOF æ–‡ä»¶å‰åŠæ®µæ˜¯ RDB æ ¼å¼çš„å…¨é‡æ•°æ®ï¼ŒååŠæ®µæ˜¯ AOF æ ¼å¼çš„å¢é‡æ•°æ®</strong>ã€‚</p><p>æ•´ä½“æ ¼å¼ä¸ºï¼š[RDB file --- AOF tail]</p><p>å¼€å¯ï¼šæ··åˆæŒä¹…åŒ–çš„é…ç½®å‚æ•°ä¸º aof-use-rdb-preambleï¼Œé…ç½®ä¸º yes æ—¶å¼€å¯æ··åˆæŒä¹…åŒ–ï¼Œåœ¨ redis 4 åˆšå¼•å…¥æ—¶ï¼Œé»˜è®¤æ˜¯å…³é—­æ··åˆæŒä¹…åŒ–çš„ï¼Œä½†æ˜¯åœ¨ redis 5 ä¸­é»˜è®¤å·²ç»æ‰“å¼€äº†ã€‚</p><p>å…³é—­ï¼šä½¿ç”¨ aof-use-rdb-preamble no é…ç½®å³å¯å…³é—­æ··åˆæŒä¹…åŒ–ã€‚</p></blockquote><h4 id="aofå’Œrdbâ˜…" tabindex="-1"><a class="header-anchor" href="#aofå’Œrdbâ˜…" aria-hidden="true">#</a> AOFå’ŒRDBâ˜…</h4><table><thead><tr><th>RDBæŒä¹…åŒ–</th><th>AOFæŒä¹…åŒ–</th></tr></thead><tbody><tr><td>å…¨é‡å¤‡ä»½ï¼Œä¸€æ¬¡ä¿å­˜æ•´ä¸ªæ•°æ®åº“ã€‚</td><td>å¢é‡å¤‡ä»½ï¼Œä¸€æ¬¡åªä¿å­˜ä¸€ä¸ªä¿®æ”¹æ•°æ®åº“çš„å‘½ä»¤ã€‚</td></tr><tr><td>æ¯æ¬¡æ‰§è¡ŒæŒä¹…åŒ–æ“ä½œçš„é—´éš”æ—¶é—´è¾ƒé•¿ã€‚</td><td>ä¿å­˜çš„é—´éš”é»˜è®¤ä¸ºä¸€ç§’é’Ÿï¼ˆEverysecï¼‰</td></tr><tr><td>æ•°æ®ä¿å­˜ä¸ºäºŒè¿›åˆ¶æ ¼å¼ï¼Œå…¶è¿˜åŸé€Ÿåº¦å¿«ã€‚</td><td>ä½¿ç”¨æ–‡æœ¬æ ¼å¼è¿˜åŸæ•°æ®ï¼Œæ‰€ä»¥æ•°æ®è¿˜åŸé€Ÿåº¦ä¸€èˆ¬ã€‚</td></tr><tr><td>æ‰§è¡Œ SAVE å‘½ä»¤æ—¶ä¼šé˜»å¡æœåŠ¡å™¨ï¼Œä½†æ‰‹åŠ¨æˆ–è€…è‡ªåŠ¨è§¦å‘çš„ BGSAVE ä¸ä¼šé˜»å¡æœåŠ¡å™¨</td><td>AOFæŒä¹…åŒ–æ— è®ºä½•æ—¶éƒ½ä¸ä¼šé˜»å¡æœåŠ¡å™¨ã€‚</td></tr></tbody></table><p>å¦‚æœè¿›è¡Œæ•°æ®æ¢å¤æ—¶ï¼Œ<strong>æ—¢æœ‰ dump.rdbæ–‡ä»¶ï¼Œåˆæœ‰ appendonly.aof æ–‡ä»¶</strong>ï¼Œåº”è¯¥<strong>å…ˆé€šè¿‡ appendonly.aof æ¢å¤æ•°æ®</strong>ï¼Œè¿™èƒ½<strong>æœ€å¤§ç¨‹åº¦åœ°ä¿è¯æ•°æ®çš„å®‰å…¨æ€§</strong>ã€‚</p><blockquote><p><strong>æ··åˆä½¿ç”¨ AOF æ—¥å¿—å’Œå†…å­˜å¿«ç…§</strong>çš„æ–¹æ³•ã€‚ ç®€å•æ¥è¯´ï¼Œå†…å­˜å¿«ç…§ä»¥ä¸€å®šçš„é¢‘ç‡æ‰§è¡Œï¼Œåœ¨ä¸¤æ¬¡å¿«ç…§ä¹‹é—´ï¼Œä½¿ç”¨ AOF æ—¥å¿—è®°å½•è¿™æœŸé—´çš„æ‰€æœ‰å‘½ä»¤æ“ä½œã€‚</p><p>è¿™æ ·ä¸€æ¥ï¼Œå¿«ç…§ä¸ç”¨å¾ˆé¢‘ç¹åœ°æ‰§è¡Œï¼Œè¿™å°±é¿å…äº†é¢‘ç¹ fork å¯¹ä¸»çº¿ç¨‹çš„å½±å“ã€‚è€Œä¸”ï¼ŒAOF æ—¥å¿—ä¹Ÿåªç”¨è®°å½•ä¸¤æ¬¡å¿«ç…§é—´çš„æ“ä½œï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸éœ€è¦è®°å½•æ‰€æœ‰æ“ä½œäº†ï¼Œå› æ­¤ï¼Œå°±ä¸ä¼šå‡ºç°æ–‡ä»¶è¿‡å¤§çš„æƒ…å†µäº†ï¼Œä¹Ÿå¯ä»¥é¿å…é‡å†™å¼€é”€ã€‚</p><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒT1 å’Œ T2 æ—¶åˆ»çš„ä¿®æ”¹ï¼Œç”¨ AOF æ—¥å¿—è®°å½•ï¼Œç­‰åˆ°ç¬¬äºŒæ¬¡åšå…¨é‡å¿«ç…§æ—¶ï¼Œå°±å¯ä»¥æ¸…ç©º AOF æ—¥å¿—ï¼Œå› ä¸ºæ­¤æ—¶çš„ä¿®æ”¹éƒ½å·²ç»è®°å½•åˆ°å¿«ç…§ä¸­äº†ï¼Œæ¢å¤æ—¶å°±ä¸å†ç”¨æ—¥å¿—äº†ã€‚</p></blockquote><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230328105232398.png" alt="image-20230328105232398"></p><h4 id="æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“" aria-hidden="true">#</a> <strong>æ€»ç»“</strong>ï¼š</h4><blockquote><p>1ã€RDB æŒä¹…åŒ–æ–¹å¼èƒ½å¤Ÿåœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”å†…å¯¹ä½ çš„æ•°æ®è¿›è¡Œå¿«ç…§å­˜å‚¨ 2ã€AOF æŒä¹…åŒ–æ–¹å¼è®°å½•æ¯æ¬¡å¯¹æœåŠ¡å™¨å†™çš„æ“ä½œï¼Œå½“æœåŠ¡å™¨é‡å¯çš„æ—¶å€™ä¼šé‡æ–°æ‰§è¡Œè¿™äº›å‘½ä»¤æ¥æ¢å¤åŸå§‹çš„æ•°æ®ï¼ŒAOFå‘½ä»¤ä»¥Redis åè®®è¿½åŠ ä¿å­˜æ¯æ¬¡å†™çš„æ“ä½œåˆ°æ–‡ä»¶æœ«å°¾ï¼ŒRedisè¿˜èƒ½å¯¹AOFæ–‡ä»¶è¿›è¡Œåå°é‡å†™ï¼Œä½¿å¾—AOFæ–‡ä»¶çš„ä½“ç§¯ä¸è‡³äºè¿‡å¤§ã€‚ 3ã€<strong>åªåšç¼“å­˜</strong>ï¼Œå¦‚æœä½ <strong>åªå¸Œæœ›ä½ çš„æ•°æ®åœ¨æœåŠ¡å™¨è¿è¡Œçš„æ—¶å€™å­˜åœ¨</strong>ï¼Œä½ ä¹Ÿ<strong>å¯ä»¥ä¸ä½¿ç”¨ä»»ä½•æŒä¹…åŒ–</strong> 4ã€<strong>åŒæ—¶å¼€å¯ä¸¤ç§æŒä¹…åŒ–æ–¹å¼ï¼ˆRDBå¿«ç…§çš„å½¢å¼è¿›è¡Œå¤‡ä»½ä¿éšœï¼ŒåŒæ—¶AOFä¿éšœæœ€åä¸€æ¬¡å¿«ç…§åä»¥åŠå†ä¸€æ¬¡å¿«ç…§å¼€å§‹å‰çš„å†™æ“ä½œï¼‰</strong></p><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<strong>å½“redisé‡å¯çš„æ—¶å€™ä¼šä¼˜å…ˆè½½å…¥AOFæ–‡ä»¶æ¥æ¢å¤åŸå§‹çš„æ•°æ®</strong>ï¼Œå› ä¸ºåœ¨é€šå¸¸æƒ…å†µä¸‹<strong>AOFæ–‡ä»¶ä¿å­˜çš„æ•°æ®é›†è¦æ¯”RDBæ–‡ä»¶ä¿å­˜çš„æ•°æ®é›†è¦å®Œæ•´</strong>ã€‚ RDB çš„æ•°æ®ä¸å®æ—¶ï¼ŒåŒæ—¶ä½¿ç”¨ä¸¤è€…æ—¶æœåŠ¡å™¨é‡å¯ä¹Ÿåªä¼šæ‰¾AOFæ–‡ä»¶ï¼Œé‚£è¦ä¸è¦åªä½¿ç”¨AOFå‘¢ï¼Ÿå»ºè®®ä¸è¦ï¼Œå› ä¸ºRDBæ›´é€‚åˆç”¨äºå¤‡ä»½æ•°æ®åº“ï¼ˆAOFåœ¨ä¸æ–­å˜åŒ–ä¸å¥½å¤‡ä»½ï¼‰ï¼Œå¿«é€Ÿé‡å¯ï¼Œè€Œä¸”ä¸ä¼šæœ‰AOFå¯èƒ½æ½œåœ¨çš„Bugï¼Œç•™ç€ä½œä¸ºä¸€ä¸ªä¸‡ä¸€çš„æ‰‹æ®µã€‚</p><p>å› ä¸ºRDBæ–‡ä»¶åªç”¨ä½œåå¤‡ç”¨é€”ï¼Œ<strong>å»ºè®®åªåœ¨Slaveä¸ŠæŒä¹…åŒ–RDBæ–‡ä»¶</strong>ï¼Œè€Œä¸”åªè¦<strong>15åˆ†é’Ÿå¤‡ä»½ä¸€æ¬¡å°±å¤Ÿäº†</strong>ï¼Œ<strong>åªä¿ç•™ save 900 1 è¿™æ¡è§„åˆ™</strong>ã€‚ å¦‚æœEnable AOF ï¼Œå¥½å¤„æ˜¯åœ¨æœ€æ¶åŠ£æƒ…å†µä¸‹ä¹Ÿåªä¼šä¸¢å¤±ä¸è¶…è¿‡ä¸¤ç§’æ•°æ®ï¼Œå¯åŠ¨è„šæœ¬è¾ƒç®€å•åªloadè‡ªå·±çš„AOFæ–‡ä»¶å°±å¯ä»¥äº†ï¼Œä»£ä»·ä¸€æ˜¯å¸¦æ¥äº†æŒç»­çš„IOï¼ŒäºŒæ˜¯AOF rewrite çš„æœ€åå°† rewrite è¿‡ç¨‹ä¸­äº§ç”Ÿçš„æ–°æ•°æ®å†™åˆ°æ–°æ–‡ä»¶é€ æˆçš„é˜»å¡å‡ ä¹æ˜¯ä¸å¯é¿å…çš„ã€‚åªè¦ç¡¬ç›˜è®¸å¯ï¼Œåº”è¯¥<strong>å°½é‡å‡å°‘AOF rewriteçš„é¢‘ç‡</strong>ï¼ŒAOFé‡å†™çš„åŸºç¡€å¤§å°<strong>é»˜è®¤å€¼64Må¤ªå°äº†ï¼Œå¯ä»¥è®¾åˆ°5Gä»¥ä¸Š</strong>ï¼Œé»˜è®¤è¶…è¿‡åŸå¤§å°100%å¤§å°é‡å†™å¯ä»¥æ”¹åˆ°é€‚å½“çš„æ•°å€¼ã€‚ å¦‚æœä¸Enable AOF ï¼Œä»…é  Master-Slave Repllcation å®ç°é«˜å¯ç”¨æ€§ä¹Ÿå¯ä»¥ï¼Œèƒ½çœæ‰ä¸€å¤§ç¬”IOï¼Œä¹Ÿå‡å°‘äº†rewriteæ—¶å¸¦æ¥çš„ç³»ç»Ÿæ³¢åŠ¨ã€‚ä»£ä»·æ˜¯å¦‚æœMaster/Slave åŒæ—¶å€’æ‰ï¼Œä¼šä¸¢å¤±åå‡ åˆ†é’Ÿçš„æ•°æ®ï¼Œå¯åŠ¨è„šæœ¬ä¹Ÿè¦æ¯”è¾ƒä¸¤ä¸ª Master/Slave ä¸­çš„ RDBæ–‡ä»¶ï¼Œè½½å…¥è¾ƒæ–°çš„é‚£ä¸ªï¼Œå¾®åšå°±æ˜¯è¿™ç§æ¶æ„ã€‚</p></blockquote><h2 id="redisä¸»ä»å¤åˆ¶" tabindex="-1"><a class="header-anchor" href="#redisä¸»ä»å¤åˆ¶" aria-hidden="true">#</a> Redisä¸»ä»å¤åˆ¶</h2><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221117194814622.png" alt="image-20221117194814622"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221117194944449.png" alt="image-20221117194944449"></p><p><strong>æŸ¥çœ‹ä¸»ä»ä¿¡æ¯</strong></p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>info replication
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>å¤åˆ¶åŸç†ï¼š</strong> Slave å¯åŠ¨æˆåŠŸè¿æ¥åˆ° master åä¼šå‘é€ä¸€ä¸ªsyncåŒæ­¥å‘½ä»¤</p><p>Master æ¥åˆ°å‘½ä»¤ï¼Œå¯åŠ¨åå°çš„å­˜ç›˜è¿›ç¨‹ï¼ŒåŒæ—¶æ”¶é›†æ‰€æœ‰æ¥æ”¶åˆ°çš„ç”¨äºä¿®æ”¹æ•°æ®é›†å‘½ä»¤ï¼Œåœ¨åå°è¿›ç¨‹æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œmasterå°†ä¼ é€æ•´ä¸ªæ•°æ®æ–‡ä»¶åˆ°slaveï¼Œå¹¶å®Œæˆä¸€æ¬¡å®Œå…¨åŒæ­¥ã€‚</p><p>**å…¨é‡å¤åˆ¶ï¼š**è€ŒslaveæœåŠ¡åœ¨æ¥æ”¶åˆ°æ•°æ®åº“æ–‡ä»¶æ•°æ®åï¼Œå°†å…¶å­˜ç›˜å¹¶åŠ è½½åˆ°å†…å­˜ä¸­ã€‚</p><p>å¢é‡å¤åˆ¶ï¼š Master ç»§ç»­å°†æ–°çš„æ‰€æœ‰æ”¶é›†åˆ°çš„ä¿®æ”¹å‘½ä»¤ä¾æ¬¡ä¼ ç»™slaveï¼Œå®ŒæˆåŒæ­¥ä½†æ˜¯åªè¦æ˜¯é‡æ–°è¿æ¥masterï¼Œä¸€æ¬¡å®Œå…¨åŒæ­¥ï¼ˆå…¨é‡å¤åˆ¶ï¼‰å°†è¢«è‡ªåŠ¨æ‰§è¡Œï¼ æˆ‘ä»¬çš„æ•°æ®ä¸€å®šå¯ä»¥åœ¨ä»æœºä¸­çœ‹åˆ°ï¼</p><p><strong>å¯ä»¥çœ‹å‡ºä¸»ä»æ¨¡å¼ä¸‹ï¼Œæ•°æ®çš„åŒæ­¥æ˜¯è‡ªåŠ¨å®Œæˆçš„ï¼Œè¿™ä¸ªæ•°æ®åŒæ­¥çš„è¿‡ç¨‹ï¼Œåˆç§°ä¸ºå…¨é‡å¤åˆ¶ã€‚</strong></p><h3 id="ä½¿ç”¨å‘½ä»¤å®ç°" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨å‘½ä»¤å®ç°" aria-hidden="true">#</a> <strong>ä½¿ç”¨å‘½ä»¤å®ç°</strong></h3><p>ä½¿ç”¨å‘½ä»¤åœ¨æœåŠ¡ç«¯æ­å»ºä¸»ä»æ¨¡å¼ï¼Œå…¶è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>redis-server --port &lt;slave-port&gt; --slaveof &lt;master-ip&gt; &lt;master-port&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>#å¼€å¯å¼€å¯ä¸€ä¸ªportä¸º6300çš„ä»æœºï¼Œå®ƒä¾èµ–çš„ä¸»æœºport=6379
C:\Users\Administrator&gt; redis-server --port 6300 --slaveof 127.0.0.1 6379
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ä¿®æ”¹é…ç½®æ–‡ä»¶å®ç°" tabindex="-1"><a class="header-anchor" href="#ä¿®æ”¹é…ç½®æ–‡ä»¶å®ç°" aria-hidden="true">#</a> ä¿®æ”¹é…ç½®æ–‡ä»¶å®ç°</h3><p>æ¯ä¸ª Redis æœåŠ¡å™¨éƒ½æœ‰ä¸€ä¸ªä¸å…¶å¯¹åº”çš„é…ç½®æ–‡ä»¶ï¼Œé€šè¿‡ä¿®æ”¹è¯¥é…ç½®æ–‡ä»¶ä¹Ÿå¯ä»¥å®ç°ä¸»ä»æ¨¡å¼ï¼Œä¸‹é¢åœ¨ Ubuntu ç¯å¢ƒä¸‹å¯¹è¯¥æ–¹æ³•è¿›è¡Œæ¼”ç»ƒã€‚</p><p>æ–°å»º redis_6302.conf æ–‡ä»¶,å¹¶æ·»åŠ ä»¥ä¸‹é…ç½®ä¿¡æ¯ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>slaveof 127.0.0.1 6379 #æŒ‡å®šä¸»æœºçš„ipä¸port
port 6302 #æŒ‡å®šä»æœºçš„ç«¯å£
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯åŠ¨ Redis æœåŠ¡å™¨ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>$ redis-server redis_6302.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å®¢æˆ·ç«¯è¿æ¥æœåŠ¡å™¨ï¼Œå¹¶è¿›è¡Œç®€å•æµ‹è¯•ã€‚æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>$ redis-cli -p 6302
127.0.0.1:6300&gt; HSET user:username biangcheng
#å†™å…¥å¤±è´¥
(error) READONLY You can&#39;t write against a read only slave.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æç¤ºï¼šé€šè¿‡å‘½ä»¤æ­å»ºä¸»ä»æ¨¡å¼ï¼Œç®€å•åˆå¿«æ·ï¼Œæ‰€ä»¥ä¸å»ºè®®æ‚¨ä½¿ç”¨ä¿®æ”¹é…ç½®æ–‡ä»¶çš„æ–¹æ³•ã€‚</p><h3 id="ä¸€ä¸»å¤šä»" tabindex="-1"><a class="header-anchor" href="#ä¸€ä¸»å¤šä»" aria-hidden="true">#</a> ä¸€ä¸»å¤šä»</h3><p><strong>è‹¥ä¸»æœºå®•æœº</strong>ä¸å½±å“é€šè¿‡ä»æœºçš„è¯»æ•°æ®ï¼›æ­¤æ—¶<strong>ä¸»æœºé‡å¯ä»ç„¶ä¸ºmaster</strong></p><p>æ­¤æ—¶<strong>ä»æœºå¯ä»¥é€šè¿‡slaveof no one æŒ‡ä»¤æˆä¸ºmaster</strong>ï¼›<strong>ä¸»æœºé‡å¯åæˆä¸ºæ–°ä¸»æœºçš„slave</strong></p><p><strong>è‹¥ä»æœºå®•æœº</strong>ï¼›ç”±äºæ˜¯<strong>å‘½ä»¤è¡Œä¸€æ¬¡æ€§æŒ‡å®š</strong> å› æ­¤<strong>éœ€è¦é‡æ–°ä¸ºä»æœºé…ç½®master</strong></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221130102638809.png" alt="image-20221130102638809"></p><p>å¤åˆ¶å¤šä¸ªé…ç½®æ–‡ä»¶</p><p>ä½¿ç”¨ä¸åŒçš„é…ç½®æ–‡ä»¶å¯åŠ¨ä¸åŒçš„æœåŠ¡</p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221130101522355.png" alt="image-20221130101522355"></p><p>æŒ‡å®š.rdbæ–‡ä»¶</p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221130101638981.png" alt="image-20221130101638981"></p><p>å‘½ä»¤è¡Œé…ç½®ï¼ˆä¸€æ¬¡æ€§é…ç½®ï¼‰</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>#å¼€å¯å¼€å¯ä¸€ä¸ªportä¸º6380çš„ä»æœºï¼Œå®ƒä¾èµ–çš„ä¸»æœºport=6379
C:\Users\Administrator&gt; redis-server --port 6380 --slaveof 127.0.0.1 6379

#å¼€å¯å¼€å¯ä¸€ä¸ªportä¸º6381çš„ä»æœºï¼Œå®ƒä¾èµ–çš„ä¸»æœºport=6379
C:\Users\Administrator&gt; redis-server --port 6381 --slaveof 127.0.0.1 6379
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é…ç½®æ–‡ä»¶é…ç½®</p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221130100728384.png" alt="image-20221130100728384"></p><h3 id="è–ªç«ç›¸ä¼ " tabindex="-1"><a class="header-anchor" href="#è–ªç«ç›¸ä¼ " aria-hidden="true">#</a> è–ªç«ç›¸ä¼ </h3><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221130100942224.png" alt="image-20221130100942224"></p><h3 id="åå®¢ä¸ºä¸»" tabindex="-1"><a class="header-anchor" href="#åå®¢ä¸ºä¸»" aria-hidden="true">#</a> åå®¢ä¸ºä¸»</h3><p>å¦‚æœä¸»æœºæ–­å¼€äº†è¿æ¥ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code> <span class="token constant">SLAVEOF</span> no one
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>è®©è‡ªå·±å˜æˆä¸»æœºï¼<strong>å…¶ä»–çš„èŠ‚ç‚¹å°±å¯ä»¥æ‰‹åŠ¨è¿æ¥åˆ°æœ€æ–°çš„è¿™ä¸ªä¸»èŠ‚ç‚¹ï¼ˆæ‰‹åŠ¨ï¼‰ï¼å¦‚æœè¿™ä¸ªæ—¶å€™åŸæ¥çš„</strong>è€å¤§ä¿®å¤äº†</strong>ï¼Œé‚£å°±<strong>é‡æ–°è¿æ¥æˆä¸ºå°å¼Ÿï¼ï¼</strong></p><p><strong>æ³¨æ„å“¦ï¼ï¼</strong> è€å¤§æ²¡æŒ‚ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨è¿™ä¸ªå‘½ä»¤ç›´æ¥è®©è‡ªå·±å˜æˆè€å¤§ï¼</p><h3 id="ä¸»ä»æ¨¡å¼ä¸è¶³" tabindex="-1"><a class="header-anchor" href="#ä¸»ä»æ¨¡å¼ä¸è¶³" aria-hidden="true">#</a> ä¸»ä»æ¨¡å¼ä¸è¶³</h3><p>ä¸»ä»æ¨¡å¼å¹¶ä¸å®Œç¾ï¼Œå®ƒä¹Ÿå­˜åœ¨è®¸å¤šä¸è¶³ä¹‹å¤„ï¼Œä¸‹é¢åšäº†ç®€å•åœ°æ€»ç»“ï¼š</p><ul><li><strong>1)</strong> Redis ä¸»ä»æ¨¡å¼ä¸å…·å¤‡è‡ªåŠ¨å®¹é”™å’Œæ¢å¤åŠŸèƒ½ï¼Œå¦‚æœä¸»èŠ‚ç‚¹å®•æœºï¼ŒRedis é›†ç¾¤å°†æ— æ³•å·¥ä½œï¼Œæ­¤æ—¶éœ€è¦äººä¸ºå¹²é¢„ï¼Œå°†ä»èŠ‚ç‚¹æå‡ä¸ºä¸»èŠ‚ç‚¹ã€‚</li><li><strong>2)</strong> å¦‚æœä¸»æœºå®•æœºå‰æœ‰ä¸€éƒ¨åˆ†æ•°æ®æœªèƒ½åŠæ—¶åŒæ­¥åˆ°ä»æœºï¼Œå³ä½¿åˆ‡æ¢ä¸»æœºåä¹Ÿä¼šé€ æˆæ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œä»è€Œé™ä½äº†ç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚</li><li><strong>3)</strong> å› ä¸ºåªæœ‰ä¸€ä¸ªä¸»èŠ‚ç‚¹ï¼Œæ‰€ä»¥å…¶å†™å…¥èƒ½åŠ›å’Œå­˜å‚¨èƒ½åŠ›éƒ½å—åˆ°ä¸€å®šç¨‹åº¦åœ°é™åˆ¶ã€‚</li><li><strong>4)</strong> åœ¨è¿›è¡Œæ•°æ®å…¨é‡åŒæ­¥æ—¶ï¼Œè‹¥åŒæ­¥çš„æ•°æ®é‡è¾ƒå¤§å¯èƒ½ä¼šé€ å¡é¡¿çš„ç°è±¡ã€‚</li></ul><h2 id="sentinelå“¨å…µæ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#sentinelå“¨å…µæ¨¡å¼" aria-hidden="true">#</a> Sentinelå“¨å…µæ¨¡å¼</h2><p>åœ¨ Redis ä¸»ä»å¤åˆ¶æ¨¡å¼ä¸­ï¼Œå› ä¸ºç³»ç»Ÿä¸å…·å¤‡è‡ªåŠ¨æ¢å¤çš„åŠŸèƒ½ï¼Œæ‰€ä»¥<strong>å½“ä¸»æœåŠ¡å™¨ï¼ˆmasterï¼‰å®•æœºå</strong>ï¼Œ<strong>éœ€è¦æ‰‹åŠ¨æŠŠä¸€å°ä»æœåŠ¡å™¨ï¼ˆslaveï¼‰åˆ‡æ¢ä¸ºä¸»æœåŠ¡å™¨</strong>ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œä¸ä»…éœ€è¦äººä¸ºå¹²é¢„ï¼Œè€Œä¸”è¿˜ä¼šé€ æˆä¸€æ®µæ—¶é—´å†…æœåŠ¡å™¨å¤„äºä¸å¯ç”¨çŠ¶æ€ï¼ŒåŒæ—¶æ•°æ®å®‰å…¨æ€§ä¹Ÿå¾—ä¸åˆ°ä¿éšœï¼Œå› æ­¤ä¸»ä»æ¨¡å¼çš„å¯ç”¨æ€§è¾ƒä½ï¼Œä¸é€‚ç”¨äºçº¿ä¸Šç”Ÿäº§ç¯å¢ƒã€‚</p><p>Redis å®˜æ–¹æ¨èä¸€ç§<strong>é«˜å¯ç”¨æ–¹æ¡ˆ</strong>ï¼Œä¹Ÿå°±æ˜¯ <strong>Redis Sentinel å“¨å…µæ¨¡å¼</strong>ï¼Œå®ƒ<strong>å¼¥è¡¥äº†ä¸»ä»æ¨¡å¼çš„ä¸è¶³</strong>ã€‚Sentinel é€šè¿‡ç›‘æ§çš„æ–¹å¼è·å–ä¸»æœºçš„å·¥ä½œçŠ¶æ€æ˜¯å¦æ­£å¸¸ï¼Œ<strong>å½“ä¸»æœºå‘ç”Ÿæ•…éšœæ—¶</strong>ï¼Œ <strong>Sentinel ä¼šè‡ªåŠ¨è¿›è¡Œ Failoverï¼ˆå³æ•…éšœè½¬ç§»ï¼‰ï¼Œå¹¶å°†å…¶ç›‘æ§çš„ä»æœºæå‡ä¸»æœåŠ¡å™¨ï¼ˆmasterï¼‰ï¼Œä»è€Œä¿è¯äº†ç³»ç»Ÿçš„é«˜å¯ç”¨æ€§</strong>ã€‚</p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221130111147964.png" alt="image-20221130111147964"></p><h3 id="å“¨å…µæ¨¡å¼åŸç†" tabindex="-1"><a class="header-anchor" href="#å“¨å…µæ¨¡å¼åŸç†" aria-hidden="true">#</a> å“¨å…µæ¨¡å¼åŸç†</h3><p>Sentinel è´Ÿè´£ç›‘æ§ä¸»ä»èŠ‚ç‚¹çš„â€œå¥åº·â€çŠ¶æ€ã€‚å½“ä¸»èŠ‚ç‚¹æŒ‚æ‰æ—¶ï¼Œè‡ªåŠ¨é€‰æ‹©ä¸€ä¸ªæœ€ä¼˜çš„ä»èŠ‚ç‚¹åˆ‡æ¢ä¸ºä¸»èŠ‚ç‚¹ã€‚å®¢æˆ·ç«¯æ¥è¿æ¥ Redis é›†ç¾¤æ—¶ï¼Œä¼šé¦–å…ˆè¿æ¥ Sentinelï¼Œé€šè¿‡ Sentinel æ¥æŸ¥è¯¢ä¸»èŠ‚ç‚¹çš„åœ°å€ï¼Œç„¶åå†å»è¿æ¥ä¸»èŠ‚ç‚¹è¿›è¡Œæ•°æ®äº¤äº’ã€‚å½“ä¸»èŠ‚ç‚¹å‘ç”Ÿæ•…éšœæ—¶ï¼Œå®¢æˆ·ç«¯ä¼šé‡æ–°å‘ Sentinel è¦åœ°å€ï¼ŒSentinel ä¼šå°†æœ€æ–°çš„ä¸»èŠ‚ç‚¹åœ°å€å‘Šè¯‰å®¢æˆ·ç«¯ã€‚å› æ­¤åº”ç”¨ç¨‹åºæ— éœ€é‡å¯å³å¯è‡ªåŠ¨å®Œæˆä¸»ä»èŠ‚ç‚¹åˆ‡æ¢ã€‚</p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221130014156595.png" alt="image-20221130014156595"></p><h4 id="_1-ä¸»è§‚ä¸‹çº¿" tabindex="-1"><a class="header-anchor" href="#_1-ä¸»è§‚ä¸‹çº¿" aria-hidden="true">#</a> 1) ä¸»è§‚ä¸‹çº¿</h4><p>ä¸»è§‚ä¸‹çº¿ï¼Œé€‚ç”¨äºä¸»æœåŠ¡å™¨å’Œä»æœåŠ¡å™¨ã€‚å¦‚æœåœ¨è§„å®šçš„æ—¶é—´å†…(é…ç½®å‚æ•°ï¼šdown-after-milliseconds)ï¼ŒSentinel èŠ‚ç‚¹æ²¡æœ‰æ”¶åˆ°ç›®æ ‡æœåŠ¡å™¨çš„æœ‰æ•ˆå›å¤ï¼Œåˆ™åˆ¤å®šè¯¥æœåŠ¡å™¨ä¸ºâ€œä¸»è§‚ä¸‹çº¿â€ã€‚æ¯”å¦‚ Sentinel1 å‘ä¸»æœåŠ¡å‘é€äº†<code>PING</code>å‘½ä»¤ï¼Œåœ¨è§„å®šæ—¶é—´å†…æ²¡æ”¶åˆ°ä¸»æœåŠ¡å™¨<code>PONG</code>å›å¤ï¼Œåˆ™ Sentinel1 åˆ¤å®šä¸»æœåŠ¡å™¨ä¸ºâ€œä¸»è§‚ä¸‹çº¿â€ã€‚</p><h4 id="_2-å®¢è§‚ä¸‹çº¿" tabindex="-1"><a class="header-anchor" href="#_2-å®¢è§‚ä¸‹çº¿" aria-hidden="true">#</a> 2) å®¢è§‚ä¸‹çº¿</h4><p>å®¢è§‚ä¸‹çº¿ï¼Œåªé€‚ç”¨äºä¸»æœåŠ¡å™¨ã€‚ Sentinel1 å‘ç°ä¸»æœåŠ¡å™¨å‡ºç°äº†æ•…éšœï¼Œå®ƒä¼šé€šè¿‡ç›¸åº”çš„å‘½ä»¤ï¼Œè¯¢é—®å…¶å®ƒ Sentinel èŠ‚ç‚¹å¯¹ä¸»æœåŠ¡å™¨çš„çŠ¶æ€åˆ¤æ–­ã€‚å¦‚æœè¶…è¿‡åŠæ•°ä»¥ä¸Šçš„ Sentinel èŠ‚ç‚¹è®¤ä¸ºä¸»æœåŠ¡å™¨ down æ‰ï¼Œåˆ™ Sentinel1 èŠ‚ç‚¹åˆ¤å®šä¸»æœåŠ¡ä¸ºâ€œå®¢è§‚ä¸‹çº¿â€ã€‚</p><h4 id="_3-æŠ•ç¥¨é€‰ä¸¾" tabindex="-1"><a class="header-anchor" href="#_3-æŠ•ç¥¨é€‰ä¸¾" aria-hidden="true">#</a> 3) æŠ•ç¥¨é€‰ä¸¾</h4><p>æŠ•ç¥¨é€‰ä¸¾ï¼Œæ‰€æœ‰ Sentinel èŠ‚ç‚¹ä¼šé€šè¿‡æŠ•ç¥¨æœºåˆ¶ï¼ŒæŒ‰ç…§è°å‘ç°è°å»å¤„ç†çš„åŸåˆ™ï¼Œé€‰ä¸¾ Sentinel1 ä¸ºé¢†å¤´èŠ‚ç‚¹å»åš Failoverï¼ˆæ•…éšœè½¬ç§»ï¼‰æ“ä½œã€‚Sentinel1 èŠ‚ç‚¹åˆ™æŒ‰ç…§ä¸€å®šçš„è§„åˆ™åœ¨æ‰€æœ‰ä»èŠ‚ç‚¹ä¸­é€‰æ‹©ä¸€ä¸ªæœ€ä¼˜çš„ä½œä¸ºä¸»æœåŠ¡å™¨ï¼Œç„¶åé€šè¿‡å‘å¸ƒè®¢åŠŸèƒ½é€šçŸ¥å…¶ä½™çš„ä»èŠ‚ç‚¹ï¼ˆslaveï¼‰æ›´æ”¹é…ç½®æ–‡ä»¶ï¼Œè·Ÿéšæ–°ä¸Šä»»çš„ä¸»æœåŠ¡å™¨ï¼ˆmasterï¼‰ã€‚è‡³æ­¤å°±å®Œæˆäº†ä¸»ä»åˆ‡æ¢çš„æ“ä½œã€‚</p><h3 id="é…ç½®å“¨å…µæ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#é…ç½®å“¨å…µæ¨¡å¼" aria-hidden="true">#</a> é…ç½®å“¨å…µæ¨¡å¼</h3><h4 id="_1-å®‰è£…sentinel" tabindex="-1"><a class="header-anchor" href="#_1-å®‰è£…sentinel" aria-hidden="true">#</a> 1) å®‰è£…sentinel</h4><p>Sentinel éœ€è¦ä½œä¸ºæ’ä»¶å•ç‹¬å®‰è£…ï¼Œå®‰è£…æ–¹å¼å¦‚ä¸‹ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>sudo apt install redis-sentinel
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="_2-æ­å»ºä¸»ä»æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#_2-æ­å»ºä¸»ä»æ¨¡å¼" aria-hidden="true">#</a> 2) æ­å»ºä¸»ä»æ¨¡å¼</h4><p>æ¥ä¸‹æ¥ï¼Œåœ¨æœ¬åœ°ç¯å¢ƒä½¿ç”¨ä¸»ä»æ¨¡å¼æ­å»ºä¸€ä¸ªæ‹¥æœ‰ä¸‰å°æœåŠ¡å™¨çš„ Redis é›†ç¾¤ï¼Œå‘½ä»¤å¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>å¯åŠ¨6379çš„redisæœåŠ¡å™¨ä½œä¸ºmasterä¸»æœº:
sudo /etc/init.d/redis-server start

å¯åŠ¨6380çš„redisæœåŠ¡å™¨ï¼Œè®¾ç½®ä¸º6379çš„slave:
redis-server --port 6380
$ redis-cli -p 6380
127.0.0.1:6380&gt; slaveof 127.0.0.1 6379
OK

å¯åŠ¨6381çš„redisæœåŠ¡å™¨ï¼Œè®¾ç½®ä¸º6379çš„salve
redis-server --port 6381
$ redis-cli -p 6381
127.0.0.1:6381&gt; slaveof 127.0.0.1 6379
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-é…ç½®sentinelå“¨å…µ" tabindex="-1"><a class="header-anchor" href="#_3-é…ç½®sentinelå“¨å…µ" aria-hidden="true">#</a> 3) é…ç½®sentinelå“¨å…µ</h4><p>é¦–å…ˆæ–°å»º sentinel.conf æ–‡ä»¶ï¼Œå¹¶å¯¹å…¶è¿›è¡Œé…ç½®ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>port 26379
Sentinel monitor biancheng 127.0.0.1 6379 1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>é…ç½®æ–‡ä»¶è¯´æ˜å¦‚ä¸‹ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>port 26379 #sentinelç›‘å¬ç«¯å£ï¼Œé»˜è®¤æ˜¯26379ï¼Œå¯ä»¥æ›´æ”¹
sentinel monitor &lt;master-name&gt; &lt;ip&gt; &lt;redis-port&gt; &lt;quorum&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>ç¬¬äºŒä¸ªé…ç½®é¡¹è¡¨ç¤ºï¼šè®© sentinel å»ç›‘æ§ä¸€ä¸ªåœ°å€ä¸º ip:port çš„ä¸»æœåŠ¡å™¨ï¼Œè¿™é‡Œçš„ master-name å¯ä»¥è‡ªå®šä¹‰ï¼›[&lt;]quorum[&gt;] æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œè¡¨ç¤ºå½“æœ‰å¤šå°‘ä¸ª sentinel è®¤ä¸ºä¸»æœåŠ¡å™¨å®•æœºæ—¶ï¼Œå®ƒæ‰ç®—çœŸæ­£çš„å®•æœºæ‰ï¼Œé€šå¸¸æ•°é‡ä¸ºåŠæ•°æˆ–åŠæ•°ä»¥ä¸Šæ‰ä¼šè®¤ä¸ºä¸»æœºå·²ç»å®•æœºï¼Œ[&lt;]quorum[&gt;] éœ€è¦æ ¹æ® sentinel çš„æ•°é‡è®¾ç½®ã€‚</p><h4 id="_4-å¯åŠ¨sentienlå“¨å…µ" tabindex="-1"><a class="header-anchor" href="#_4-å¯åŠ¨sentienlå“¨å…µ" aria-hidden="true">#</a> 4) å¯åŠ¨sentienlå“¨å…µ</h4><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>æ–¹å¼ä¸€: 
redis-sentinel sentinel.conf
æ–¹å¼äºŒ: 
redis-server sentinel.conf --sentinel
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_4-æµ‹è¯•" aria-hidden="true">#</a> 4ï¼‰æµ‹è¯•</h4><p><strong>æ­å»ºä¸€ä¸»å¤šä»æœåŠ¡å™¨</strong></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221130105931861.png" alt="image-20221130105931861"></p><p><strong>é…ç½®å’Œå¯åŠ¨sentinel</strong></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221130105809397.png" alt="image-20221130105809397"></p><p><strong>ä¸»æœºå®•æœºæµ‹è¯•</strong></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221130105648611.png" alt="image-20221130105648611"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221130105636061.png" alt="image-20221130105636061"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221130105721091.png" alt="image-20221130105721091"></p><h3 id="sentinel-confé…ç½®é¡¹" tabindex="-1"><a class="header-anchor" href="#sentinel-confé…ç½®é¡¹" aria-hidden="true">#</a> sentinel.confé…ç½®é¡¹</h3><p>å¦‚æœæ‚¨æƒ³å¼€å¯å¤šä¸ªå“¨å…µï¼Œåªéœ€é…ç½®è¦å¤šä¸ª sentinel.conf æ–‡ä»¶å³å¯ï¼Œä¸€ä¸ªé…ç½®æ–‡ä»¶å¼€å¯ä¸€ä¸ªã€‚</p><p>ä¸‹é¢å¯¹ Sentinel é…ç½®æ–‡ä»¶çš„å…¶ä»–é…ç½®é¡¹åšç®€å•è¯´æ˜ï¼š</p><table><thead><tr><th>é…ç½®é¡¹</th><th>å‚æ•°ç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>dir</td><td>æ–‡ä»¶ç›®å½•</td><td>å“¨å…µè¿›ç¨‹æœåŠ¡çš„æ–‡ä»¶å­˜æ”¾ç›®å½•ï¼Œé»˜è®¤ä¸º /tmpã€‚</td></tr><tr><td>port</td><td>ç«¯å£å·</td><td>å¯åŠ¨å“¨å…µçš„è¿›ç¨‹ç«¯å£å·ï¼Œé»˜è®¤ä¸º 26379ã€‚</td></tr><tr><td>sentinel down-after-milliseconds</td><td>&lt;æœåŠ¡åç§°&gt;&lt;æ¯«ç§’æ•°(æ•´æ•°)&gt;</td><td>åœ¨æŒ‡å®šçš„æ¯«ç§’æ•°å†…ï¼Œè‹¥ä¸»èŠ‚ç‚¹æ²¡æœ‰åº”ç­”å“¨å…µçš„ PING å‘½ä»¤ï¼Œæ­¤æ—¶å“¨å…µè®¤ä¸ºæœåŠ¡å™¨ä¸»è§‚ä¸‹çº¿ï¼Œé»˜è®¤æ—¶é—´ä¸º 30 ç§’ã€‚</td></tr><tr><td>sentinel parallel-syncs</td><td>&lt;æœåŠ¡åç§°&gt;&lt;æœåŠ¡å™¨æ•°(æ•´æ•°)&gt;</td><td>æŒ‡å®šå¯ä»¥æœ‰å¤šå°‘ä¸ª Redis æœåŠ¡åŒæ­¥æ–°çš„ä¸»æœºï¼Œä¸€èˆ¬è€Œè¨€ï¼Œè¿™ä¸ªæ•°å­—è¶Šå°åŒæ­¥æ—¶é—´è¶Šé•¿ï¼Œè€Œè¶Šå¤§ï¼Œåˆ™å¯¹ç½‘ç»œèµ„æºè¦æ±‚å°±è¶Šé«˜ã€‚</td></tr><tr><td>sentinel failover-timeout</td><td>&lt;æœåŠ¡åç§°&gt;&lt;æ¯«ç§’æ•°(æ•´æ•°)&gt;</td><td>æŒ‡å®šæ•…éšœè½¬ç§»å…è®¸çš„æ¯«ç§’æ•°ï¼Œè‹¥è¶…è¿‡è¿™ä¸ªæ—¶é—´ï¼Œå°±è®¤ä¸ºæ•…éšœè½¬ç§»æ‰§è¡Œå¤±è´¥ï¼Œé»˜è®¤ä¸º 3 åˆ†é’Ÿã€‚</td></tr><tr><td>sentinel notification-script</td><td>&lt;æœåŠ¡åç§°&gt;&lt;è„šæœ¬è·¯å¾„&gt;</td><td>è„šæœ¬é€šçŸ¥ï¼Œé…ç½®å½“æŸä¸€äº‹ä»¶å‘ç”Ÿæ—¶æ‰€éœ€è¦æ‰§è¡Œçš„è„šæœ¬ï¼Œå¯ä»¥é€šè¿‡è„šæœ¬æ¥é€šçŸ¥ç®¡ç†å‘˜ï¼Œä¾‹å¦‚å½“ç³»ç»Ÿè¿è¡Œä¸æ­£å¸¸æ—¶å‘é‚®ä»¶é€šçŸ¥ç›¸å…³äººå‘˜ã€‚</td></tr><tr><td>sentinel auth-pass [&lt;]master-name[&gt;] [&lt;]password[&gt;]</td><td>&lt;æœåŠ¡å™¨åç§°&gt;&lt;å¯†ç &gt;</td><td>è‹¥ä¸»æœåŠ¡å™¨è®¾ç½®äº†å¯†ç ï¼Œåˆ™å“¨å…µå¿…é¡»ä¹Ÿé…ç½®å¯†ç ï¼Œå¦åˆ™å“¨å…µæ— æ³•å¯¹ä¸»ä»æœåŠ¡å™¨è¿›è¡Œç›‘æ§ã€‚è¯¥å¯†ç ä¸ä¸»æœåŠ¡å™¨å¯†ç ç›¸åŒã€‚</td></tr></tbody></table><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># Example sentinel.conf 

# å“¨å…µsentinelå®ä¾‹è¿è¡Œçš„ç«¯å£ é»˜è®¤26379 
port 26379 

# å“¨å…µsentinelçš„å·¥ä½œç›®å½• 
dir /tmp 

# å“¨å…µsentinelç›‘æ§çš„redisä¸»èŠ‚ç‚¹çš„ ip port 
# master-name å¯ä»¥è‡ªå·±å‘½åçš„ä¸»èŠ‚ç‚¹åå­— åªèƒ½ç”±å­—æ¯A-zã€æ•°å­—0-9 ã€è¿™ä¸‰ä¸ªå­—ç¬¦&quot;.-_&quot;ç»„æˆã€‚ 
# quorum é…ç½®å¤šå°‘ä¸ªsentinelå“¨å…µç»Ÿä¸€è®¤ä¸ºmasterä¸»èŠ‚ç‚¹å¤±è” é‚£ä¹ˆè¿™æ—¶å®¢è§‚ä¸Šè®¤ä¸ºä¸»èŠ‚ç‚¹å¤±è”äº† 
# sentinel monitor &lt;master-name&gt; &lt;ip&gt; &lt;redis-port&gt; &lt;quorum&gt; sentinel monitor mymaster 127.0.0.1 6379 2 

# å½“åœ¨Rediså®ä¾‹ä¸­å¼€å¯äº†requirepass foobared æˆæƒå¯†ç  è¿™æ ·æ‰€æœ‰è¿æ¥Rediså®ä¾‹çš„å®¢æˆ·ç«¯éƒ½è¦æä¾› å¯†ç 
# è®¾ç½®å“¨å…µsentinel è¿æ¥ä¸»ä»çš„å¯†ç  æ³¨æ„å¿…é¡»ä¸ºä¸»ä»è®¾ç½®ä¸€æ ·çš„éªŒè¯å¯†ç  
# sentinel auth-pass &lt;master-name&gt; &lt;password&gt; 
sentinel auth-pass mymaster MySUPER--secret-0123passw0rd 

# æŒ‡å®šå¤šå°‘æ¯«ç§’ä¹‹å ä¸»èŠ‚ç‚¹æ²¡æœ‰åº”ç­”å“¨å…µsentinel æ­¤æ—¶ å“¨å…µä¸»è§‚ä¸Šè®¤ä¸ºä¸»èŠ‚ç‚¹ä¸‹çº¿ é»˜è®¤30ç§’ 
# sentinel down-after-milliseconds &lt;master-name&gt; &lt;milliseconds&gt; 
sentinel down-after-milliseconds mymaster 30000 

# è¿™ä¸ªé…ç½®é¡¹æŒ‡å®šäº†åœ¨å‘ç”Ÿfailoverä¸»å¤‡åˆ‡æ¢æ—¶æœ€å¤šå¯ä»¥æœ‰å¤šå°‘ä¸ªslaveåŒæ—¶å¯¹æ–°çš„masterè¿›è¡Œ åŒæ­¥
#è¿™ä¸ªæ•°å­—è¶Šå°ï¼Œå®Œæˆfailoveræ‰€éœ€çš„æ—¶é—´å°±è¶Šé•¿ï¼Œ
# ä½†æ˜¯å¦‚æœè¿™ä¸ªæ•°å­—è¶Šå¤§ï¼Œå°±æ„å‘³ç€è¶Š å¤šçš„slaveå› ä¸ºreplicationè€Œä¸å¯ç”¨ã€‚ 
#å¯ä»¥é€šè¿‡å°†è¿™ä¸ªå€¼è®¾ä¸º 1 æ¥ä¿è¯æ¯æ¬¡åªæœ‰ä¸€ä¸ªslave å¤„äºä¸èƒ½å¤„ç†å‘½ä»¤è¯·æ±‚çš„çŠ¶æ€ã€‚ 
# sentinel parallel-syncs &lt;master-name&gt; &lt;numslaves&gt; 
sentinel parallel-syncs mymaster 1 


# æ•…éšœè½¬ç§»çš„è¶…æ—¶æ—¶é—´ failover-timeout å¯ä»¥ç”¨åœ¨ä»¥ä¸‹è¿™äº›æ–¹é¢ï¼š 
#1. åŒä¸€ä¸ªsentinelå¯¹åŒä¸€ä¸ªmasterä¸¤æ¬¡failoverä¹‹é—´çš„é—´éš”æ—¶é—´ã€‚ 
#2. å½“ä¸€ä¸ªslaveä»ä¸€ä¸ªé”™è¯¯çš„masteré‚£é‡ŒåŒæ­¥æ•°æ®å¼€å§‹è®¡ç®—æ—¶é—´ã€‚ç›´åˆ°slaveè¢«çº æ­£ä¸ºå‘æ­£ç¡®çš„masteré‚£ é‡ŒåŒæ­¥æ•°æ®æ—¶ã€‚ 
#3.å½“æƒ³è¦å–æ¶ˆä¸€ä¸ªæ­£åœ¨è¿›è¡Œçš„failoveræ‰€éœ€è¦çš„æ—¶é—´ã€‚ 
#4.å½“è¿›è¡Œfailoveræ—¶ï¼Œé…ç½®æ‰€æœ‰slavesæŒ‡å‘æ–°çš„masteræ‰€éœ€çš„æœ€å¤§æ—¶é—´ã€‚ä¸è¿‡ï¼Œå³ä½¿è¿‡äº†è¿™ä¸ªè¶…æ—¶ï¼Œ slavesä¾ç„¶ä¼šè¢«æ­£ç¡®é…ç½®ä¸ºæŒ‡å‘masterï¼Œä½†æ˜¯å°±ä¸æŒ‰parallel-syncsæ‰€é…ç½®çš„è§„åˆ™æ¥äº† 
# é»˜è®¤ä¸‰åˆ†é’Ÿ # sentinel failover-timeout &lt;master-name&gt; 
sentinel failover-timeout mymaster 180000 


# SCRIPTS EXECUTION #é…ç½®å½“æŸä¸€äº‹ä»¶å‘ç”Ÿæ—¶æ‰€éœ€è¦æ‰§è¡Œçš„è„šæœ¬ï¼Œå¯ä»¥é€šè¿‡è„šæœ¬æ¥é€šçŸ¥ç®¡ç†å‘˜ï¼Œä¾‹å¦‚å½“ç³»ç»Ÿè¿è¡Œä¸æ­£å¸¸æ—¶å‘é‚®ä»¶é€šçŸ¥ ç›¸å…³äººå‘˜ã€‚ 
#å¯¹äºè„šæœ¬çš„è¿è¡Œç»“æœæœ‰ä»¥ä¸‹è§„åˆ™ï¼š 
#è‹¥è„šæœ¬æ‰§è¡Œåè¿”å›1ï¼Œé‚£ä¹ˆè¯¥è„šæœ¬ç¨åå°†ä¼šè¢«å†æ¬¡æ‰§è¡Œï¼Œé‡å¤æ¬¡æ•°ç›®å‰é»˜è®¤ä¸º10 #è‹¥è„šæœ¬æ‰§è¡Œåè¿”å›2ï¼Œæˆ–è€…æ¯”2æ›´é«˜çš„ä¸€ä¸ªè¿”å›å€¼ï¼Œè„šæœ¬å°†ä¸ä¼šé‡å¤æ‰§è¡Œã€‚ 
#å¦‚æœè„šæœ¬åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ç”±äºæ”¶åˆ°ç³»ç»Ÿä¸­æ–­ä¿¡å·è¢«ç»ˆæ­¢äº†ï¼Œåˆ™åŒè¿”å›å€¼ä¸º1æ—¶çš„è¡Œä¸ºç›¸åŒã€‚ 
#ä¸€ä¸ªè„šæœ¬çš„æœ€å¤§æ‰§è¡Œæ—¶é—´ä¸º60sï¼Œå¦‚æœè¶…è¿‡è¿™ä¸ªæ—¶é—´ï¼Œè„šæœ¬å°†ä¼šè¢«ä¸€ä¸ªSIGKILLä¿¡å·ç»ˆæ­¢ï¼Œä¹‹åé‡æ–°æ‰§è¡Œã€‚ 
#é€šçŸ¥å‹è„šæœ¬:å½“sentinelæœ‰ä»»ä½•è­¦å‘Šçº§åˆ«çš„äº‹ä»¶å‘ç”Ÿæ—¶ï¼ˆæ¯”å¦‚è¯´rediså®ä¾‹çš„ä¸»è§‚å¤±æ•ˆå’Œå®¢è§‚å¤±æ•ˆç­‰ç­‰ï¼‰ï¼Œ å°†ä¼šå»è°ƒç”¨è¿™ä¸ªè„šæœ¬ï¼Œè¿™æ—¶è¿™ä¸ªè„šæœ¬åº”è¯¥é€šè¿‡é‚®ä»¶ï¼ŒSMSç­‰æ–¹å¼å»é€šçŸ¥ç³»ç»Ÿç®¡ç†å‘˜å…³äºç³»ç»Ÿä¸æ­£å¸¸è¿è¡Œçš„ä¿¡ æ¯ã€‚è°ƒç”¨è¯¥è„šæœ¬æ—¶ï¼Œå°†ä¼ ç»™è„šæœ¬ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯äº‹ä»¶çš„ç±»å‹ï¼Œä¸€ä¸ªæ˜¯äº‹ä»¶çš„æè¿°ã€‚å¦‚æœsentinel.confé… ç½®æ–‡ä»¶ä¸­é…ç½®äº†è¿™ä¸ªè„šæœ¬è·¯å¾„ï¼Œé‚£ä¹ˆå¿…é¡»ä¿è¯è¿™ä¸ªè„šæœ¬å­˜åœ¨äºè¿™ä¸ªè·¯å¾„ï¼Œå¹¶ä¸”æ˜¯å¯æ‰§è¡Œçš„ï¼Œå¦åˆ™sentinelæ—  æ³•æ­£å¸¸å¯åŠ¨æˆåŠŸã€‚ 
#é€šçŸ¥è„šæœ¬ 
# shellç¼–ç¨‹ 
# sentinel notification-script &lt;master-name&gt; &lt;script-path&gt; 
sentinel notification-script mymaster /var/redis/notify.sh 


# å®¢æˆ·ç«¯é‡æ–°é…ç½®ä¸»èŠ‚ç‚¹å‚æ•°è„šæœ¬ 
# å½“ä¸€ä¸ªmasterç”±äºfailoverè€Œå‘ç”Ÿæ”¹å˜æ—¶ï¼Œè¿™ä¸ªè„šæœ¬å°†ä¼šè¢«è°ƒç”¨ï¼Œé€šçŸ¥ç›¸å…³çš„å®¢æˆ·ç«¯å…³äºmasteråœ°å€å·² ç»å‘ç”Ÿæ”¹å˜çš„ä¿¡æ¯ã€‚ 
# ä»¥ä¸‹å‚æ•°å°†ä¼šåœ¨è°ƒç”¨è„šæœ¬æ—¶ä¼ ç»™è„šæœ¬: 
# &lt;master-name&gt; &lt;role&gt; &lt;state&gt; &lt;from-ip&gt; &lt;from-port&gt; &lt;to-ip&gt; &lt;to-port&gt; 
# ç›®å‰&lt;state&gt;æ€»æ˜¯â€œfailoverâ€, 
# &lt;role&gt;æ˜¯â€œleaderâ€æˆ–è€…â€œobserverâ€ä¸­çš„ä¸€ä¸ªã€‚ 
# å‚æ•° from-ip, from-port, to-ip, to-portæ˜¯ç”¨æ¥å’Œæ—§çš„masterå’Œæ–°çš„master(å³æ—§çš„slave)é€š ä¿¡çš„
# è¿™ä¸ªè„šæœ¬åº”è¯¥æ˜¯é€šç”¨çš„ï¼Œèƒ½è¢«å¤šæ¬¡è°ƒç”¨ï¼Œä¸æ˜¯é’ˆå¯¹æ€§çš„ã€‚ 
# sentinel client-reconfig-script &lt;master-name&gt; &lt;script-path&gt; 
sentinel client-reconfig-script mymaster /var/redis/reconfig.sh 
# ä¸€èˆ¬éƒ½æ˜¯ç”±è¿ç»´æ¥é…ç½®ï¼
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="redis-clusterâ˜…" tabindex="-1"><a class="header-anchor" href="#redis-clusterâ˜…" aria-hidden="true">#</a> Redis Clusterâ˜…</h2><p>https://redis.io/docs/reference/cluster-spec/</p><p>https://juejin.cn/post/6949832776224866340#heading-11</p><blockquote><p>Redis Cluster é€šè¿‡<strong>åˆ†ç‰‡ï¼ˆShardingï¼‰<strong>æ¥è¿›è¡Œæ•°æ®ç®¡ç†ï¼›æä¾›</strong>ä¸»ä»å¤åˆ¶(Master-Slave Replication)</strong>ï¼Œ**æ•…éšœè½¬ç§»(Failover)**ç­‰å¼€ç®±å³ç”¨çš„åŠŸèƒ½ï¼Œ</p><p><strong>ä¿éšœåœ¨Rediså¤§æ•°æ®é‡ç¼“å­˜ä¸‹çš„æœåŠ¡é«˜å¯ç”¨</strong>ã€‚</p><ul><li><strong>åˆ†å¸ƒå¼å­˜å‚¨ï¼š</strong><ul><li>Redis Cluster å°†æ•°æ®åˆ†æ•£å­˜å‚¨åœ¨å¤šä¸ªèŠ‚ç‚¹ä¸­ï¼Œå¯ä»¥æœ‰æ•ˆåœ°æ‰©å±•æ•°æ®å­˜å‚¨èƒ½åŠ›ã€‚åŒæ—¶ï¼Œå®ƒä¹Ÿå¯ä»¥è‡ªåŠ¨åœ°å°†**æ•°æ®åˆ†ç‰‡(å“ˆå¸Œæ§½åˆ†ç‰‡ç®—æ³•)**åˆ°ä¸åŒçš„èŠ‚ç‚¹ä¸Šï¼Œå®ç°æ•°æ®çš„è´Ÿè½½å‡è¡¡å’Œé«˜æ•ˆè®¿é—®ã€‚</li></ul></li><li><strong>è‡ªåŠ¨å®¹é”™ï¼š</strong><ul><li>Redis Cluster æ”¯æŒ<strong>ä¸»ä»å¤åˆ¶</strong>å’Œ<strong>æ•…éšœè½¬ç§»</strong>ï¼Œå¯ä»¥åœ¨<strong>èŠ‚ç‚¹æ•…éšœæˆ–ç½‘ç»œå¼‚å¸¸æ—¶è‡ªåŠ¨åˆ‡æ¢åˆ°å¤‡ç”¨èŠ‚ç‚¹</strong>ï¼Œä¿è¯ç³»ç»Ÿçš„é«˜å¯ç”¨æ€§ã€‚</li></ul></li><li><strong>èŠ‚ç‚¹é—´é€šä¿¡ï¼š</strong><ul><li>Redis Cluster <strong>èŠ‚ç‚¹ä¹‹é—´ä½¿ç”¨äºŒè¿›åˆ¶åè®®é€šä¿¡(Gossip)</strong>ï¼Œå¯ä»¥é«˜æ•ˆåœ°ä¼ è¾“æ•°æ®ã€‚åŒæ—¶ï¼Œå®ƒä¹Ÿæ”¯æŒ<strong>èŠ‚ç‚¹é—´çš„æ¡æ‰‹å’Œå¿ƒè·³æœºåˆ¶</strong>ï¼Œä¿è¯èŠ‚ç‚¹ä¹‹é—´çš„å¯é é€šä¿¡ã€‚</li></ul></li><li><strong>è´Ÿè½½å‡è¡¡ï¼š</strong><ul><li>Redis Cluster å¯ä»¥è‡ªåŠ¨å°†æ•°æ®åˆ†é…åˆ°ä¸åŒçš„èŠ‚ç‚¹ä¸Šï¼Œå®ç°è´Ÿè½½å‡è¡¡ã€‚åŒæ—¶ï¼Œå®ƒè¿˜å¯ä»¥ä½¿ç”¨<strong>å“ˆå¸Œæ§½åˆ†ç‰‡ç®—æ³•</strong>ï¼Œç¡®ä¿<strong>æ¯ä¸ªèŠ‚ç‚¹ä¸Šçš„æ•°æ®å‡åŒ€åˆ†å¸ƒï¼Œé¿å…æ•°æ®å€¾æ–œ</strong>ã€‚</li></ul></li><li><strong>å¯æ‰©å±•æ€§ï¼š</strong><ul><li>Redis Cluster <strong>æ”¯æŒåŠ¨æ€æ·»åŠ å’Œåˆ é™¤èŠ‚ç‚¹</strong>ï¼Œå¯ä»¥æ ¹æ®éœ€æ±‚<strong>çµæ´»åœ°æ‰©å±•é›†ç¾¤çš„è§„æ¨¡å’Œæ€§èƒ½</strong>ã€‚</li></ul></li></ul></blockquote><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230409143517003.png" alt="image-20230409143517003"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230409143917916.png" alt="image-20230409143917916"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230409144150286.png" alt="image-20230409144150286"></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230409144136619.png" alt="image-20230409144136619"></p><h3 id="create-a-redis-cluster" tabindex="-1"><a class="header-anchor" href="#create-a-redis-cluster" aria-hidden="true">#</a> Create a Redis Cluster</h3><p>https://redis.io/docs/management/scaling/#create-a-redis-cluster</p><h4 id="manually" tabindex="-1"><a class="header-anchor" href="#manually" aria-hidden="true">#</a> manually</h4><p>Now that we have a number of instances running, you need to create your cluster by writing some meaningful configuration to the nodes.</p><p>You can configure and execute individual instances manually or use the create-cluster script. Let&#39;s go over how you do it manually.</p><p>To create the cluster, run:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>redis-cli --cluster create 127.0.0.1:7000 127.0.0.1:7001 \
127.0.0.1:7002 127.0.0.1:7003 127.0.0.1:7004 127.0.0.1:7005 \
--cluster-replicas 1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The command used here is <strong>create</strong>, since we want to create a new cluster. The option <code>--cluster-replicas 1</code> means that we want a replica for every master created.</p><p>The other arguments are the list of addresses of the instances I want to use to create the new cluster.</p><p><code>redis-cli</code> will propose a configuration. Accept the proposed configuration by typing <strong>yes</strong>. The cluster will be configured and <em>joined</em>, which means that instances will be bootstrapped into talking with each other.</p><p>Finally, if everything has gone well, you&#39;ll see a message like this:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>[OK] All 16384 slots covered
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>This means that there is at least one master instance serving each of the 16384 available slots.</p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230409170418315.png" alt="image-20230409170418315"></p><h4 id="use-commands" tabindex="-1"><a class="header-anchor" href="#use-commands" aria-hidden="true">#</a> use commands</h4><p>If you don&#39;t want to create a Redis Cluster by configuring and executing individual instances manually as explained above, there is a much simpler system (but you&#39;ll not learn the same amount of operational details).</p><p>Find the <code>utils/create-cluster</code> directory in the Redis distribution. There is a script called <code>create-cluster</code> inside (same name as the directory it is contained into), it&#39;s a simple bash script. In order to start a 6 nodes cluster with 3 masters and 3 replicas just type the following commands:</p><ol><li><code>create-cluster start</code></li><li><code>create-cluster create</code></li></ol><p>Reply to <code>yes</code> in step 2 when the <code>redis-cli</code> utility wants you to accept the cluster layout.</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>bash-3.2$ ./create-cluster start
Starting <span class="token number">30001</span>
Starting <span class="token number">30002</span>
Starting <span class="token number">30003</span>
Starting <span class="token number">30004</span>
Starting <span class="token number">30005</span>
Starting <span class="token number">30006</span>
bash-3.2$ ./create-cluster create <span class="token parameter variable">-f</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Performing <span class="token builtin class-name">hash</span> slots allocation on <span class="token number">6</span> nodes<span class="token punctuation">..</span>.
Master<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> -<span class="token operator">&gt;</span> Slots <span class="token number">0</span> - <span class="token number">5460</span>
Master<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> -<span class="token operator">&gt;</span> Slots <span class="token number">5461</span> - <span class="token number">10922</span>
Master<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> -<span class="token operator">&gt;</span> Slots <span class="token number">10923</span> - <span class="token number">16383</span>
Adding replica <span class="token number">127.0</span>.0.1:30005 to <span class="token number">127.0</span>.0.1:30001
Adding replica <span class="token number">127.0</span>.0.1:30006 to <span class="token number">127.0</span>.0.1:30002
Adding replica <span class="token number">127.0</span>.0.1:30004 to <span class="token number">127.0</span>.0.1:30003
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Trying to optimize slaves allocation <span class="token keyword">for</span> anti-affinity
<span class="token punctuation">[</span>WARNING<span class="token punctuation">]</span> Some slaves are <span class="token keyword">in</span> the same <span class="token function">host</span> as their master
M: 685a75d2e26062231d4d8500747be44c64e8de9c <span class="token number">127.0</span>.0.1:30001
   slots:<span class="token punctuation">[</span><span class="token number">0</span>-5460<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5461</span> slots<span class="token punctuation">)</span> master
M: 42bfb59288e424124ee6942762dbb9047f93729c <span class="token number">127.0</span>.0.1:30002
   slots:<span class="token punctuation">[</span><span class="token number">5461</span>-10922<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5462</span> slots<span class="token punctuation">)</span> master
M: d7784261adb1df483605ccda5a07a876d4c18ebe <span class="token number">127.0</span>.0.1:30003
   slots:<span class="token punctuation">[</span><span class="token number">10923</span>-16383<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5461</span> slots<span class="token punctuation">)</span> master
S: b09ead29ce667b3be129af893b11617c65f31cda <span class="token number">127.0</span>.0.1:30004
   replicates 685a75d2e26062231d4d8500747be44c64e8de9c
S: 8f9a0d90cf21ba35420ea7c0b7cc4317ad66c9f5 <span class="token number">127.0</span>.0.1:30005
   replicates 42bfb59288e424124ee6942762dbb9047f93729c
S: 3f6a47da15503bac7abb31f70a02c324df8d2248 <span class="token number">127.0</span>.0.1:30006
   replicates d7784261adb1df483605ccda5a07a876d4c18ebe
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Nodes configuration updated
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Assign a different config epoch to each <span class="token function">node</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Sending CLUSTER MEET messages to <span class="token function">join</span> the cluster
Waiting <span class="token keyword">for</span> the cluster to <span class="token function">join</span>
<span class="token builtin class-name">.</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Performing Cluster Check <span class="token punctuation">(</span>using <span class="token function">node</span> <span class="token number">127.0</span>.0.1:30001<span class="token punctuation">)</span>
M: 685a75d2e26062231d4d8500747be44c64e8de9c <span class="token number">127.0</span>.0.1:30001
   slots:<span class="token punctuation">[</span><span class="token number">0</span>-5460<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5461</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
M: 42bfb59288e424124ee6942762dbb9047f93729c <span class="token number">127.0</span>.0.1:30002
   slots:<span class="token punctuation">[</span><span class="token number">5461</span>-10922<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5462</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
S: 3f6a47da15503bac7abb31f70a02c324df8d2248 <span class="token number">127.0</span>.0.1:30006
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates d7784261adb1df483605ccda5a07a876d4c18ebe
M: d7784261adb1df483605ccda5a07a876d4c18ebe <span class="token number">127.0</span>.0.1:30003
   slots:<span class="token punctuation">[</span><span class="token number">10923</span>-16383<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5461</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
S: b09ead29ce667b3be129af893b11617c65f31cda <span class="token number">127.0</span>.0.1:30004
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates 685a75d2e26062231d4d8500747be44c64e8de9c
S: 8f9a0d90cf21ba35420ea7c0b7cc4317ad66c9f5 <span class="token number">127.0</span>.0.1:30005
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates 42bfb59288e424124ee6942762dbb9047f93729c
<span class="token punctuation">[</span>OK<span class="token punctuation">]</span> All nodes agree about slots configuration.
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Check <span class="token keyword">for</span> <span class="token function">open</span> slots<span class="token punctuation">..</span>.
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Check slots coverage<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>OK<span class="token punctuation">]</span> All <span class="token number">16384</span> slots covered.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>You can now interact with the cluster, the first node will start at port 30001 by default. When you are done, stop the cluster with:</p><ol><li><code>create-cluster stop</code></li></ol><p>Please read the <code>README</code> inside this directory for more information on how to run the script.</p><h3 id="redis-cluster-expansion-reduction" tabindex="-1"><a class="header-anchor" href="#redis-cluster-expansion-reduction" aria-hidden="true">#</a> Redis Cluster Expansion &amp; Reduction</h3><blockquote><p>Redis Cluster æ˜¯ Redis çš„åˆ†å¸ƒå¼é›†ç¾¤å®ç°ï¼Œå®ƒæ”¯æŒåŠ¨æ€çš„æ‰©å®¹å’Œç¼©å®¹ã€‚åœ¨ Redis Cluster ä¸­ï¼Œæ¯ä¸ª Redis å®ä¾‹è¢«ç§°ä¸ºä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ¯ä¸ªèŠ‚ç‚¹è´Ÿè´£éƒ¨åˆ†æ•°æ®ã€‚ä¸€ä¸ª Redis Cluster å¯ä»¥åŒ…å«å¤šä¸ªèŠ‚ç‚¹ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¹‹é—´é€šè¿‡ Gossip åè®®è¿›è¡Œé€šä¿¡ï¼Œä¿è¯é›†ç¾¤çš„çŠ¶æ€ä¸€è‡´æ€§ã€‚åœ¨æ‰©å®¹å’Œç¼©å®¹è¿‡ç¨‹ä¸­ï¼Œéœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ul><li><p><strong>Scale-out</strong></p><p>å½“éœ€è¦æ‰©å®¹ Redis Cluster æ—¶ï¼Œéœ€è¦æ·»åŠ æ–°çš„èŠ‚ç‚¹ã€‚å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š</p><p>https://cloud.tencent.com/developer/article/1906499</p><ol><li>éƒ¨ç½²æ–°çš„ Redis å®ä¾‹ï¼Œå¹¶åŠ å…¥é›†ç¾¤</li><li>å°†æ–°èŠ‚ç‚¹åŠ å…¥åˆ°é›†ç¾¤ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ Redis Cluster æä¾›çš„ meet å‘½ä»¤æ·»åŠ æ–°èŠ‚ç‚¹</li><li>å°†éƒ¨åˆ†æ•°æ®ä»æ—§èŠ‚ç‚¹è¿ç§»åˆ°æ–°èŠ‚ç‚¹ï¼Œå¯ä»¥ä½¿ç”¨ Redis Cluster æä¾›çš„ reshard å‘½ä»¤è¿›è¡Œæ•°æ®è¿ç§»</li></ol></li><li><p><strong>Scale-in</strong></p><p>å½“éœ€è¦ç¼©å®¹ Redis Cluster æ—¶ï¼Œéœ€è¦åˆ é™¤æŸäº›èŠ‚ç‚¹ã€‚å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š</p><p>https://cloud.tencent.com/developer/article/2167377?from=article.detail.1906499&amp;areaSource=106000.1&amp;traceId=x8oVHakrhRgm7L4Pdoewo</p><ol><li>å°†è¦åˆ é™¤çš„èŠ‚ç‚¹ä¸Šçš„æ•°æ®è¿ç§»åˆ°å…¶ä»–èŠ‚ç‚¹ï¼Œå¯ä»¥ä½¿ç”¨ Redis Cluster æä¾›çš„ reshard å‘½ä»¤è¿›è¡Œæ•°æ®è¿ç§»</li><li>å°†è¦åˆ é™¤çš„èŠ‚ç‚¹ä»é›†ç¾¤ä¸­åˆ é™¤ï¼Œå¯ä»¥ä½¿ç”¨ Redis Cluster æä¾›çš„ forget å‘½ä»¤åˆ é™¤èŠ‚ç‚¹</li></ol></li></ul><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨è¿›è¡Œæ‰©å®¹å’Œç¼©å®¹æ“ä½œæ—¶ï¼Œéœ€è¦ç¡®ä¿é›†ç¾¤çš„çŠ¶æ€ä¸€è‡´æ€§ï¼Œé¿å…æ•°æ®ä¸¢å¤±æˆ–æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µã€‚å¯ä»¥ä½¿ç”¨ Redis Cluster æä¾›çš„å‘½ä»¤å’Œå·¥å…·æ¥ç®¡ç†é›†ç¾¤ï¼Œæ¯”å¦‚ reshard å‘½ä»¤ã€meet å‘½ä»¤ã€forget å‘½ä»¤ã€cluster info å‘½ä»¤ç­‰ã€‚</p></blockquote><h2 id="redisç¼“å­˜é—®é¢˜â˜…" tabindex="-1"><a class="header-anchor" href="#redisç¼“å­˜é—®é¢˜â˜…" aria-hidden="true">#</a> Redisç¼“å­˜é—®é¢˜â˜…</h2><p>åœ¨å®é™…çš„ä¸šåŠ¡åœºæ™¯ä¸­ï¼ŒRedis ä¸€èˆ¬å’Œå…¶ä»–æ•°æ®åº“æ­é…ä½¿ç”¨ï¼Œç”¨æ¥å‡è½»åç«¯æ•°æ®åº“çš„å‹åŠ›ï¼Œæ¯”å¦‚å’Œå…³ç³»å‹æ•°æ®åº“ MySQL é…åˆä½¿ç”¨ã€‚</p><p>Redis ä¼šæŠŠ MySQL ä¸­ç»å¸¸è¢«æŸ¥è¯¢çš„æ•°æ®ç¼“å­˜èµ·æ¥ï¼Œæ¯”å¦‚çƒ­ç‚¹æ•°æ®ï¼Œè¿™æ ·å½“ç”¨æˆ·æ¥è®¿é—®çš„æ—¶å€™ï¼Œå°±ä¸éœ€è¦åˆ° MySQL ä¸­å»æŸ¥è¯¢äº†ï¼Œè€Œæ˜¯ç›´æ¥è·å– Redis ä¸­çš„ç¼“å­˜æ•°æ®ï¼Œä»è€Œé™ä½äº†åç«¯æ•°æ®åº“çš„è¯»å–å‹åŠ›ã€‚å¦‚æœè¯´ç”¨æˆ·æŸ¥è¯¢çš„æ•°æ® Redis æ²¡æœ‰ï¼Œæ­¤æ—¶ç”¨æˆ·çš„æŸ¥è¯¢è¯·æ±‚å°±ä¼šè½¬åˆ° MySQL æ•°æ®åº“ï¼Œå½“ MySQL å°†æ•°æ®è¿”å›ç»™å®¢æˆ·ç«¯æ—¶ï¼ŒåŒæ—¶ä¼šå°†æ•°æ®ç¼“å­˜åˆ° Redis ä¸­ï¼Œè¿™æ ·ç”¨æˆ·å†æ¬¡è¯»å–æ—¶ï¼Œå°±å¯ä»¥ç›´æ¥ä» Redis ä¸­è·å–æ•°æ®ã€‚æµç¨‹å›¾å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230130115134977.png" alt="image-20230130115134977"></p><p>åœ¨ä½¿ç”¨ Redis ä½œä¸ºç¼“å­˜æ•°æ®åº“çš„è¿‡ç¨‹ä¸­ï¼Œæœ‰æ—¶ä¹Ÿä¼šé‡åˆ°ä¸€äº›æ£˜æ‰‹é—®é¢˜ï¼Œæ¯”å¦‚å¸¸è§ç¼“å­˜ç©¿é€ã€ç¼“å­˜å‡»ç©¿å’Œç¼“å­˜é›ªå´©ç­‰é—®é¢˜ã€‚</p><h3 id="ç¼“å­˜ç©¿é€" tabindex="-1"><a class="header-anchor" href="#ç¼“å­˜ç©¿é€" aria-hidden="true">#</a> ç¼“å­˜ç©¿é€</h3><p>ç¼“å­˜ç©¿é€æ˜¯æŒ‡å½“ç”¨æˆ·æŸ¥è¯¢æŸä¸ªæ•°æ®æ—¶ï¼Œ<strong>Redis ä¸­ä¸å­˜åœ¨è¯¥æ•°æ®</strong>ï¼Œä¹Ÿå°±æ˜¯<strong>ç¼“å­˜æ²¡æœ‰å‘½ä¸­</strong>ï¼Œæ­¤æ—¶æŸ¥è¯¢è¯·æ±‚å°±ä¼šè½¬å‘æŒä¹…å±‚æ•°æ®åº“ MySQLï¼Œç»“æœå‘ç° <strong>MySQL ä¸­ä¹Ÿä¸å­˜åœ¨è¯¥æ•°æ®</strong>ï¼ŒMySQL åªèƒ½è¿”å›ä¸€ä¸ªç©ºå¯¹è±¡ï¼Œä»£è¡¨æ­¤æ¬¡æŸ¥è¯¢å¤±è´¥ã€‚å¦‚æœè¿™ç§ç±»è¯·æ±‚éå¸¸å¤šï¼Œæˆ–è€…ç”¨æˆ·åˆ©ç”¨è¿™ç§è¯·æ±‚è¿›è¡Œæ¶æ„æ”»å‡»ï¼Œå°±ä¼šç»™ MySQL æ•°æ®åº“é€ æˆå¾ˆå¤§å‹åŠ›ï¼Œç”šè‡³äºå´©æºƒï¼Œè¿™ç§ç°è±¡å°±å«ç¼“å­˜ç©¿é€ã€‚</p><p>ä¸ºäº†é¿å…ç¼“å­˜ç©¿é€é—®é¢˜ï¼Œä¸‹é¢ä»‹ç»ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼š</p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230510233620610.png" alt="image-20230510233620610"></p><p><strong>1) ç¼“å­˜ç©ºå¯¹è±¡</strong></p><p>å½“ MySQL è¿”å›ç©ºå¯¹è±¡æ—¶ï¼Œ Redis å°†è¯¥å¯¹è±¡ç¼“å­˜èµ·æ¥ï¼ŒåŒæ—¶ä¸ºå…¶è®¾ç½®ä¸€ä¸ªè¿‡æœŸæ—¶é—´ã€‚å½“ç”¨æˆ·å†æ¬¡å‘èµ·ç›¸åŒè¯·æ±‚æ—¶ï¼Œå°±ä¼šä»ç¼“å­˜ä¸­æ‹¿åˆ°ä¸€ä¸ªç©ºå¯¹è±¡ï¼Œç”¨æˆ·çš„è¯·æ±‚è¢«é˜»æ–­åœ¨äº†ç¼“å­˜å±‚ï¼Œä»è€Œä¿æŠ¤äº†åç«¯æ•°æ®åº“ï¼Œä½†æ˜¯è¿™ç§åšæ³•ä¹Ÿå­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œè™½ç„¶è¯·æ±‚è¿›ä¸äº† MSQLï¼Œä½†æ˜¯è¿™ç§ç­–ç•¥ä¼šå ç”¨ Redis çš„ç¼“å­˜ç©ºé—´ã€‚</p><p><strong>2) å¸ƒéš†è¿‡æ»¤å™¨</strong></p><p>æˆ‘ä»¬çŸ¥é“ï¼Œå¸ƒéš†è¿‡æ»¤å™¨åˆ¤å®šä¸å­˜åœ¨çš„æ•°æ®ï¼Œé‚£ä¹ˆè¯¥æ•°æ®ä¸€å®šä¸å­˜åœ¨ï¼Œåˆ©ç”¨å®ƒçš„è¿™ä¸€ç‰¹ç‚¹å¯ä»¥é˜²æ­¢ç¼“å­˜ç©¿é€ã€‚</p><p>é¦–å…ˆå°†ç”¨æˆ·å¯èƒ½ä¼šè®¿é—®çš„çƒ­ç‚¹æ•°æ®å­˜å‚¨åœ¨å¸ƒéš†è¿‡æ»¤å™¨ä¸­ï¼ˆä¹Ÿç§°ç¼“å­˜é¢„çƒ­ï¼‰ï¼Œå½“æœ‰ä¸€ä¸ªç”¨æˆ·è¯·æ±‚åˆ°æ¥æ—¶ä¼šå…ˆç»è¿‡å¸ƒéš†è¿‡æ»¤å™¨ï¼Œå¦‚æœè¯·æ±‚çš„æ•°æ®ï¼Œå¸ƒéš†è¿‡æ»¤å™¨ä¸­ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆè¯¥è¯·æ±‚å°†ç›´æ¥è¢«æ‹’ç»ï¼Œå¦åˆ™å°†ç»§ç»­æ‰§è¡ŒæŸ¥è¯¢ã€‚ç›¸è¾ƒäºç¬¬ä¸€ç§æ–¹æ³•ï¼Œç”¨å¸ƒéš†è¿‡æ»¤å™¨æ–¹æ³•æ›´ä¸ºé«˜æ•ˆã€å®ç”¨ã€‚å…¶æµç¨‹ç¤ºæ„å›¾å¦‚ä¸‹ï¼š</p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230130115216664.png" alt="image-20230130115216664"></p><p>**ç¼“å­˜é¢„çƒ­ï¼š**æ˜¯æŒ‡ç³»ç»Ÿå¯åŠ¨æ—¶ï¼Œæå‰å°†ç›¸å…³çš„æ•°æ®åŠ è½½åˆ° Redis ç¼“å­˜ç³»ç»Ÿä¸­ã€‚è¿™æ ·é¿å…äº†ç”¨æˆ·è¯·æ±‚çš„æ—¶å†å»åŠ è½½æ•°æ®ã€‚</p><h3 id="ç¼“å­˜å‡»ç©¿" tabindex="-1"><a class="header-anchor" href="#ç¼“å­˜å‡»ç©¿" aria-hidden="true">#</a> ç¼“å­˜å‡»ç©¿</h3><p>ç¼“å­˜å‡»ç©¿æ˜¯æŒ‡ç”¨æˆ·æŸ¥è¯¢çš„æ•°æ®ç¼“å­˜ä¸­ä¸å­˜åœ¨ï¼Œä½†æ˜¯åç«¯æ•°æ®åº“å´å­˜åœ¨ï¼Œè¿™ç§ç°è±¡å‡ºç°åŸå› æ˜¯ä¸€èˆ¬æ˜¯ç”±ç¼“å­˜ä¸­ key è¿‡æœŸå¯¼è‡´çš„ã€‚æ¯”å¦‚ä¸€ä¸ªçƒ­ç‚¹æ•°æ® keyï¼Œå®ƒæ— æ—¶æ— åˆ»éƒ½åœ¨æ¥å—å¤§é‡çš„å¹¶å‘è®¿é—®ï¼Œå¦‚æœæŸä¸€æ—¶åˆ»è¿™ä¸ª key çªç„¶å¤±æ•ˆäº†ï¼Œå°±è‡´ä½¿å¤§é‡çš„å¹¶å‘è¯·æ±‚è¿›å…¥åç«¯æ•°æ®åº“ï¼Œå¯¼è‡´å…¶å‹åŠ›ç¬é—´å¢å¤§ã€‚è¿™ç§ç°è±¡è¢«ç§°ä¸ºç¼“å­˜å‡»ç©¿ã€‚</p><p>ç¼“å­˜å‡»ç©¿æœ‰ä¸¤ç§è§£å†³æ–¹æ³•ï¼š</p><p><strong>1) æ”¹å˜è¿‡æœŸæ—¶é—´</strong></p><p>è®¾ç½®çƒ­ç‚¹æ•°æ®æ°¸ä¸è¿‡æœŸã€‚</p><p><strong>2) åˆ†å¸ƒå¼é”</strong></p><p>é‡‡ç”¨åˆ†å¸ƒå¼é”çš„æ–¹æ³•ï¼Œé‡æ–°è®¾è®¡ç¼“å­˜çš„ä½¿ç”¨æ–¹å¼ï¼Œè¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ul><li>ä¸Šé”ï¼šå½“æˆ‘ä»¬é€šè¿‡ key å»æŸ¥è¯¢æ•°æ®æ—¶ï¼Œé¦–å…ˆæŸ¥è¯¢ç¼“å­˜ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå°±é€šè¿‡åˆ†å¸ƒå¼é”è¿›è¡ŒåŠ é”ï¼Œç¬¬ä¸€ä¸ªè·å–é”çš„è¿›ç¨‹è¿›å…¥åç«¯æ•°æ®åº“æŸ¥è¯¢ï¼Œå¹¶å°†æŸ¥è¯¢ç»“æœç¼“åˆ°Redis ä¸­ã€‚</li><li>è§£é”ï¼šå½“å…¶ä»–è¿›ç¨‹å‘ç°é”è¢«æŸä¸ªè¿›ç¨‹å ç”¨æ—¶ï¼Œå°±è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œç›´è‡³è§£é”åï¼Œå…¶ä½™è¿›ç¨‹å†ä¾æ¬¡è®¿é—®è¢«ç¼“å­˜çš„ keyã€‚</li></ul><h3 id="ç¼“å­˜é›ªå´©" tabindex="-1"><a class="header-anchor" href="#ç¼“å­˜é›ªå´©" aria-hidden="true">#</a> ç¼“å­˜é›ªå´©</h3><p>ç¼“å­˜é›ªå´©æ˜¯æŒ‡ç¼“å­˜ä¸­å¤§æ‰¹é‡çš„ key åŒæ—¶è¿‡æœŸï¼Œè€Œæ­¤æ—¶æ•°æ®è®¿é—®é‡åˆéå¸¸å¤§ï¼Œä»è€Œå¯¼è‡´åç«¯æ•°æ®åº“å‹åŠ›çªç„¶æš´å¢ï¼Œç”šè‡³ä¼šæŒ‚æ‰ï¼Œè¿™ç§ç°è±¡è¢«ç§°ä¸ºç¼“å­˜é›ªå´©ã€‚å®ƒå’Œç¼“å­˜å‡»ç©¿ä¸åŒï¼Œç¼“å­˜å‡»ç©¿æ˜¯åœ¨å¹¶å‘é‡ç‰¹åˆ«å¤§æ—¶ï¼ŒæŸä¸€ä¸ªçƒ­ç‚¹ key çªç„¶è¿‡æœŸï¼Œè€Œç¼“å­˜é›ªå´©åˆ™æ˜¯å¤§é‡çš„ key åŒæ—¶è¿‡æœŸï¼Œå› æ­¤å®ƒä»¬æ ¹æœ¬ä¸æ˜¯ä¸€ä¸ªé‡çº§ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆ</strong></p><p>ç¼“å­˜é›ªå´©å’Œç¼“å­˜å‡»ç©¿æœ‰ç›¸ä¼¼ä¹‹å¤„ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥é‡‡ç”¨<strong>çƒ­ç‚¹æ•°æ®æ°¸ä¸è¿‡æœŸ</strong>çš„æ–¹æ³•ï¼Œæ¥å‡å°‘å¤§æ‰¹é‡çš„ key åŒæ—¶è¿‡æœŸã€‚</p><p>å†è€…å°±æ˜¯<strong>ä¸º key è®¾ç½®éšæœºè¿‡æœŸæ—¶é—´</strong>ï¼Œ<strong>é¿å… key é›†ä¸­è¿‡æœŸã€‚</strong></p><h2 id="rediså›æ”¶å»¶è¿Ÿ-åˆ é™¤æ•°æ®æ“ä½œ-â˜…" tabindex="-1"><a class="header-anchor" href="#rediså›æ”¶å»¶è¿Ÿ-åˆ é™¤æ•°æ®æ“ä½œ-â˜…" aria-hidden="true">#</a> Rediså›æ”¶å»¶è¿Ÿï¼ˆåˆ é™¤æ•°æ®æ“ä½œï¼‰â˜…</h2><blockquote><p>å½“Redisä¸­çš„<strong>æŸä¸ªé”®è¢«åˆ é™¤æ—¶</strong>ï¼ŒRedisé€šå¸¸<strong>ä¸ä¼šç«‹å³å°†ç›¸åº”çš„å†…å­˜é‡Šæ”¾ç»™æ“ä½œç³»ç»Ÿ</strong>ã€‚</p><p>ç›¸åï¼Œå®ƒä¼š<strong>å°†è¿™äº›å·²ç»è¢«åˆ é™¤çš„é”®çš„å†…å­˜ç©ºé—´æ”¾åˆ°ä¸€ä¸ªç©ºé—²é“¾è¡¨ä¸­</strong>ï¼Œä»¥ä¾¿åœ¨ä»¥åç”¨æ¥å­˜å‚¨æ–°çš„é”®å€¼å¯¹ã€‚</p><p>è¿™ç§è¡Œä¸ºç§°ä¸ºå†…å­˜<strong>å›æ”¶å»¶è¿Ÿï¼ˆMemory Reclamation Latencyï¼‰</strong>ï¼Œå®ƒå¯ä»¥<strong>å‡å°‘é¢‘ç¹çš„å†…å­˜åˆ†é…å’Œé‡Šæ”¾æ“ä½œï¼Œä»è€Œæé«˜Redisçš„æ€§èƒ½å’Œæ•ˆç‡</strong>ã€‚åœ¨å®é™…è¿è¡Œä¸­ï¼ŒRedisé€šå¸¸ä¼šç»´æŠ¤å¤šä¸ªå†…å­˜åˆ†é…å™¨ï¼Œæ¯ä¸ªåˆ†é…å™¨å¯¹åº”ä¸åŒå¤§å°çš„å†…å­˜å—ï¼Œä»¥ä¾¿æ›´é«˜æ•ˆåœ°ç®¡ç†å†…å­˜ç©ºé—´ã€‚</p><p>å½“Redis<strong>éœ€è¦ä¸ºæ–°çš„é”®å€¼å¯¹åˆ†é…å†…å­˜æ—¶ï¼Œå®ƒä¼šå…ˆå°è¯•ä»ç©ºé—²é“¾è¡¨ä¸­è·å–ä¸€å—å¯ç”¨çš„å†…å­˜ç©ºé—´ï¼Œè€Œä¸æ˜¯ç›´æ¥å‘æ“ä½œç³»ç»Ÿè¯·æ±‚æ–°çš„å†…å­˜åˆ†é…</strong>ã€‚å¦‚æœRedisç©ºé—²é“¾è¡¨ä¸­æ²¡æœ‰å¯ç”¨çš„å†…å­˜ç©ºé—´ï¼Œå®ƒå°†å‘æ“ä½œç³»ç»Ÿè¯·æ±‚æ–°çš„å†…å­˜ã€‚</p><p>è¿™ç§å†…å­˜å›æ”¶å»¶è¿Ÿçš„è¡Œä¸ºè™½ç„¶å¯ä»¥æé«˜Redisçš„æ€§èƒ½ï¼Œä½†ä¹Ÿå¯èƒ½å¯¼è‡´Rediså ç”¨æ›´å¤šçš„å†…å­˜ç©ºé—´ã€‚å¦‚æœéœ€è¦é‡Šæ”¾Rediså ç”¨çš„å†…å­˜ç©ºé—´ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨å‘½ä»¤FLUSHALLæˆ–è€…é‡å¯Rediså®ä¾‹ã€‚ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™æ ·ä¼šåˆ é™¤æ‰€æœ‰çš„é”®å€¼å¯¹ï¼Œå› æ­¤åœ¨ä½¿ç”¨ä¹‹å‰éœ€è¦è°¨æ…è€ƒè™‘ã€‚</p></blockquote><h2 id="rediså†…å­˜æ·˜æ±°æœºåˆ¶â˜…" tabindex="-1"><a class="header-anchor" href="#rediså†…å­˜æ·˜æ±°æœºåˆ¶â˜…" aria-hidden="true">#</a> Rediså†…å­˜æ·˜æ±°æœºåˆ¶â˜…</h2><blockquote><p>ç”±äºå†…å­˜èµ„æºçš„æœ‰é™æ€§ï¼Œå½“Redisä½¿ç”¨çš„å†…å­˜è¾¾åˆ°ä¸€å®šé™åˆ¶æ—¶ï¼Œéœ€è¦é‡‡ç”¨ä¸€å®šçš„æ·˜æ±°æœºåˆ¶æ¥é‡Šæ”¾å†…å­˜ã€‚Redisæä¾›äº†å¤šç§å†…å­˜æ·˜æ±°æœºåˆ¶æ¥æ»¡è¶³ä¸åŒçš„éœ€æ±‚ã€‚</p><p>å¦‚æœè¾¾åˆ°è®¾ç½®çš„ä¸Šé™ï¼ŒRedisçš„å†™å‘½ä»¤ä¼šè¿”å›é”™è¯¯ä¿¡æ¯ï¼ˆä½†æ˜¯è¯»å‘½ä»¤è¿˜å¯ä»¥æ­£å¸¸è¿”å›ã€‚ï¼‰æˆ–è€…ä½ å¯ä»¥<strong>é…ç½®å†…å­˜æ·˜æ±°æœºåˆ¶</strong>ï¼Œå½“Redisè¾¾åˆ°å†…å­˜ä¸Šé™æ—¶ä¼šå†²åˆ·æ‰æ—§çš„å†…å®¹ã€‚</p><p>åœ¨Redisä¸­ï¼Œå¯ä»¥é€šè¿‡é…ç½®å‚æ•°æ¥é€‰æ‹©ä¸åŒçš„æ·˜æ±°ç­–ç•¥ã€‚ä¾‹å¦‚ï¼Œåœ¨Redisçš„é…ç½®æ–‡ä»¶ä¸­å¯ä»¥è®¾ç½®<code>maxmemory-policy</code>å‚æ•°æ¥æŒ‡å®šæ·˜æ±°ç­–ç•¥ï¼Œå…¶å¯é€‰é¡¹åŒ…æ‹¬noevictionï¼ˆä¸æ·˜æ±°ï¼‰ã€allkeys-lruï¼ˆå…¨å±€LRUï¼‰ã€volatile-lruï¼ˆåŸºäºè¿‡æœŸæ—¶é—´çš„LRUï¼‰ã€allkeys-randomï¼ˆå…¨å±€éšæœºï¼‰ã€volatile-randomï¼ˆåŸºäºè¿‡æœŸæ—¶é—´çš„éšæœºï¼‰ã€volatile-ttlï¼ˆåŸºäºè¿‡æœŸæ—¶é—´çš„TTLï¼‰ç­‰ã€‚</p><p><strong>Rediså†…å­˜æ·˜æ±°æœºåˆ¶çš„å¸¸è§ç±»å‹ï¼š</strong></p><ul><li><strong>LRUï¼ˆLeast Recently Usedï¼‰ç®—æ³•</strong></li></ul><p>LRUç®—æ³•æ ¹æ®æœ€è¿‘ä½¿ç”¨æ—¶é—´æ¥æ·˜æ±°æœ€å°‘ä½¿ç”¨çš„é”®å€¼å¯¹ï¼Œå³ä¼˜å…ˆæ·˜æ±°æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®ï¼Œä¿ç•™æœ€è¿‘ä½¿ç”¨é¢‘ç‡è¾ƒé«˜çš„æ•°æ®ã€‚Redisä¸­é»˜è®¤é‡‡ç”¨çš„å°±æ˜¯LRUç®—æ³•ã€‚</p><ul><li>LFUï¼ˆLeast Frequently Usedï¼‰ç®—æ³•</li></ul><p>LFUç®—æ³•æ ¹æ®è®¿é—®æ¬¡æ•°æ¥æ·˜æ±°æœ€å°‘ä½¿ç”¨çš„é”®å€¼å¯¹ï¼Œå³ä¼˜å…ˆæ·˜æ±°è®¿é—®æ¬¡æ•°æœ€å°‘çš„æ•°æ®ï¼Œä¿ç•™è®¿é—®é¢‘ç‡è¾ƒé«˜çš„æ•°æ®ã€‚</p><ul><li>Randomç®—æ³•</li></ul><p>Randomç®—æ³•æ˜¯ä¸€ç§éšæœºæ·˜æ±°ç®—æ³•ï¼Œå³éšæœºé€‰æ‹©ä¸€ä¸ªé”®å€¼å¯¹è¿›è¡Œæ·˜æ±°ã€‚</p><ul><li>TTLï¼ˆTime To Liveï¼‰ç®—æ³•</li></ul><p>TTLç®—æ³•æ ¹æ®é”®å€¼å¯¹çš„è¿‡æœŸæ—¶é—´æ¥æ·˜æ±°æ•°æ®ï¼Œå³ä¼˜å…ˆæ·˜æ±°è¿‡æœŸæ—¶é—´æœ€æ—©çš„æ•°æ®ï¼Œä¿ç•™æœªè¿‡æœŸçš„æ•°æ®ã€‚</p></blockquote><h2 id="redisè¿‡æœŸé”®çš„åˆ é™¤ç­–ç•¥â˜…" tabindex="-1"><a class="header-anchor" href="#redisè¿‡æœŸé”®çš„åˆ é™¤ç­–ç•¥â˜…" aria-hidden="true">#</a> Redisè¿‡æœŸé”®çš„åˆ é™¤ç­–ç•¥â˜…</h2><blockquote><ul><li><p>åœ¨å•æœºç‰ˆRedisä¸­ï¼Œå­˜åœ¨ä¸¤ç§åˆ é™¤ç­–ç•¥ï¼š</p><ul><li><p><strong>æƒ°æ€§åˆ é™¤</strong>ï¼šæœåŠ¡å™¨ä¸ä¼šä¸»åŠ¨åˆ é™¤æ•°æ®ï¼Œåªæœ‰å½“å®¢æˆ·ç«¯æŸ¥è¯¢æŸä¸ªæ•°æ®æ—¶ï¼ŒæœåŠ¡å™¨åˆ¤æ–­è¯¥æ•°æ®æ˜¯å¦è¿‡æœŸï¼Œå¦‚æœè¿‡æœŸåˆ™åˆ é™¤ã€‚</p></li><li><p><strong>å®šæœŸåˆ é™¤</strong>ï¼šæœåŠ¡å™¨æ‰§è¡Œå®šæ—¶ä»»åŠ¡åˆ é™¤è¿‡æœŸæ•°æ®ï¼Œä½†æ˜¯è€ƒè™‘åˆ°å†…å­˜å’ŒCPUçš„æŠ˜ä¸­ï¼ˆåˆ é™¤ä¼šé‡Šæ”¾å†…å­˜ï¼Œä½†æ˜¯é¢‘ç¹çš„åˆ é™¤æ“ä½œå¯¹CPUä¸å‹å¥½ï¼‰ï¼Œè¯¥åˆ é™¤çš„é¢‘ç‡å’Œæ‰§è¡Œæ—¶é—´éƒ½å—åˆ°äº†é™åˆ¶ã€‚</p></li></ul></li><li><p>åœ¨ä¸»ä»å¤åˆ¶åœºæ™¯ä¸‹ï¼š</p><p>:happy:Redis 3.2ä¹‹åï¼Œ<strong>ä»èŠ‚ç‚¹åœ¨è¯»å–æ•°æ®æ—¶ï¼Œå¢åŠ äº†å¯¹æ•°æ®æ˜¯å¦è¿‡æœŸçš„åˆ¤æ–­ï¼šå¦‚æœè¯¥æ•°æ®å·²è¿‡æœŸï¼Œåˆ™ä¸è¿”å›ç»™å®¢æˆ·ç«¯</strong>ï¼›å°†Rediså‡çº§åˆ°3.2å¯ä»¥è§£å†³æ•°æ®è¿‡æœŸé—®é¢˜ã€‚</p></li></ul></blockquote><h2 id="redis-å†…å­˜ç¢ç‰‡â˜…" tabindex="-1"><a class="header-anchor" href="#redis-å†…å­˜ç¢ç‰‡â˜…" aria-hidden="true">#</a> Redis å†…å­˜ç¢ç‰‡â˜…</h2><p>å¯ä»¥å°†<strong>å†…å­˜ç¢ç‰‡</strong>ç®€å•åœ°ç†è§£ä¸ºé‚£äº›<strong>ä¸å¯ç”¨çš„ç©ºé—²å†…å­˜</strong></p><h3 id="äº§ç”Ÿçš„åŸå› " tabindex="-1"><a class="header-anchor" href="#äº§ç”Ÿçš„åŸå› " aria-hidden="true">#</a> äº§ç”Ÿçš„åŸå› </h3><blockquote><p>Redis å†…å­˜ç¢ç‰‡äº§ç”Ÿæ¯”è¾ƒå¸¸è§çš„ 2 ä¸ª<strong>åŸå› </strong>ï¼š</p><ol><li><p><strong>Redis å­˜å‚¨å­˜å‚¨æ•°æ®çš„æ—¶å€™å‘æ“ä½œç³»ç»Ÿç”³è¯·çš„å†…å­˜ç©ºé—´å¯èƒ½ä¼šå¤§äºæ•°æ®å®é™…éœ€è¦çš„å­˜å‚¨ç©ºé—´ã€‚ï¼ˆç©ºé—´é¢„åˆ†é…ï¼‰</strong></p><p>Redis ä½¿ç”¨ <code>zmalloc</code> æ–¹æ³•(Redis è‡ªå·±å®ç°çš„å†…å­˜åˆ†é…æ–¹æ³•)è¿›è¡Œå†…å­˜åˆ†é…çš„æ—¶å€™ï¼Œé™¤äº†è¦åˆ†é… <code>size</code> å¤§å°çš„å†…å­˜ä¹‹å¤–ï¼Œè¿˜ä¼šå¤šåˆ†é… <code>PREFIX_SIZE</code> å¤§å°çš„å†…å­˜ã€‚</p></li><li><p><strong>é¢‘ç¹ä¿®æ”¹ Redis ä¸­çš„æ•°æ®ä¹Ÿä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ã€‚</strong></p><p>å½“ Redis ä¸­çš„æŸä¸ªæ•°æ®åˆ é™¤æ—¶ï¼ŒRedis é€šå¸¸ä¸ä¼šè½»æ˜“é‡Šæ”¾å†…å­˜ç»™æ“ä½œç³»ç»Ÿã€‚</p></li></ol></blockquote><h3 id="æŸ¥è¯¢å†…å­˜ç¢ç‰‡ä¿¡æ¯" tabindex="-1"><a class="header-anchor" href="#æŸ¥è¯¢å†…å­˜ç¢ç‰‡ä¿¡æ¯" aria-hidden="true">#</a> æŸ¥è¯¢å†…å­˜ç¢ç‰‡ä¿¡æ¯</h3><blockquote><p><strong>æŸ¥çœ‹</strong>å†…å­˜ç¢ç‰‡</p><p>å¿«é€ŸæŸ¥çœ‹å†…å­˜ç¢ç‰‡ç‡</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token operator">&gt;</span> redis-cli <span class="token parameter variable">-p</span> <span class="token number">6379</span> info <span class="token operator">|</span> <span class="token function">grep</span> mem_fragmentation_ratio
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ä½¿ç”¨ <code>info memory</code> å‘½ä»¤å³å¯æŸ¥çœ‹ Redis å†…å­˜ç›¸å…³çš„ä¿¡æ¯</p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230328113014456.png" alt="image-20230328113014456"></p></blockquote><h3 id="æ¸…ç†å†…å­˜ç¢ç‰‡" tabindex="-1"><a class="header-anchor" href="#æ¸…ç†å†…å­˜ç¢ç‰‡" aria-hidden="true">#</a> æ¸…ç†å†…å­˜ç¢ç‰‡</h3><blockquote><p><strong>æ¸…ç†</strong> Redis å†…å­˜ç¢ç‰‡</p><p>Redis4.0-RC3 ç‰ˆæœ¬ä»¥å<strong>è‡ªå¸¦å†…å­˜æ•´ç†</strong>ï¼Œå¯ä»¥é¿å…å†…å­˜ç¢ç‰‡ç‡è¿‡å¤§çš„é—®é¢˜ã€‚</p><p>ç›´æ¥é€šè¿‡ <code>config set</code> å‘½ä»¤å°† <code>activedefrag</code> é…ç½®é¡¹è®¾ç½®ä¸º <code>yes</code> å³å¯ã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>config <span class="token builtin class-name">set</span> activedefrag <span class="token function">yes</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>å…·ä½“ä»€ä¹ˆæ—¶å€™æ¸…ç†</strong>éœ€è¦é€šè¿‡ä¸‹é¢ä¸¤ä¸ªå‚æ•°æ§åˆ¶ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># å†…å­˜ç¢ç‰‡å ç”¨ç©ºé—´è¾¾åˆ° 500mb çš„æ—¶å€™å¼€å§‹æ¸…ç†</span>
config <span class="token builtin class-name">set</span> active-defrag-ignore-bytes 500mb
<span class="token comment"># å†…å­˜ç¢ç‰‡ç‡å¤§äº 1.5 çš„æ—¶å€™å¼€å§‹æ¸…ç†</span>
config <span class="token builtin class-name">set</span> active-defrag-threshold-lower <span class="token number">50</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡ Redis è‡ªåŠ¨å†…å­˜ç¢ç‰‡æ¸…ç†æœºåˆ¶å¯èƒ½ä¼šå¯¹ Redis çš„æ€§èƒ½äº§ç”Ÿå½±å“ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢ä¸¤ä¸ªå‚æ•°æ¥<strong>å‡å°‘å¯¹ Redis æ€§èƒ½çš„å½±å“</strong>ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># å†…å­˜ç¢ç‰‡æ¸…ç†æ‰€å ç”¨ CPU æ—¶é—´çš„æ¯”ä¾‹ä¸ä½äº 20%</span>
config <span class="token builtin class-name">set</span> active-defrag-cycle-min <span class="token number">20</span>
<span class="token comment"># å†…å­˜ç¢ç‰‡æ¸…ç†æ‰€å ç”¨ CPU æ—¶é—´çš„æ¯”ä¾‹ä¸é«˜äº 50%</span>
config <span class="token builtin class-name">set</span> active-defrag-cycle-max <span class="token number">50</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ğŸ‘¿å¦å¤–ï¼Œ<strong>é‡å¯èŠ‚ç‚¹å¯ä»¥åšåˆ°å†…å­˜ç¢ç‰‡é‡æ–°æ•´ç†</strong>ã€‚å¦‚æœä½ é‡‡ç”¨çš„æ˜¯é«˜å¯ç”¨æ¶æ„çš„ Redis é›†ç¾¤çš„è¯ï¼Œä½ å¯ä»¥å°†ç¢ç‰‡ç‡è¿‡é«˜çš„ä¸»èŠ‚ç‚¹è½¬æ¢ä¸ºä»èŠ‚ç‚¹ï¼Œä»¥ä¾¿è¿›è¡Œå®‰å…¨é‡å¯</p></blockquote><h2 id="åˆ†å¸ƒå¼é”â˜…" tabindex="-1"><a class="header-anchor" href="#åˆ†å¸ƒå¼é”â˜…" aria-hidden="true">#</a> åˆ†å¸ƒå¼é”â˜…</h2><p>ç”±äºç°å¦‚ä»Šçš„éƒ¨ç½²<strong>åˆ†å¸ƒå¼é›†ç¾¤</strong>ç³»ç»Ÿåï¼›åŸæœ¬çš„å•æœºéƒ¨ç½²æƒ…å†µä¸‹çš„å¹¶å‘æ§åˆ¶é”ç­–ç•¥å°†å¤±æ•ˆã€‚</p><p>å•çº¯çš„Java APIæ— æ³•å®ç°åˆ†å¸ƒå¼é”ï¼›</p><p>éœ€è¦ä¸€ç§è·¨JVMçš„äº’æ–¥æœºåˆ¶æ¥æ§åˆ¶å…±äº«èµ„æºçš„è®¿é—®ï¼›</p><p>å› è€Œéœ€è¦<strong>åˆ†å¸ƒå¼é”</strong></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221130182538186.png" alt="image-20221130182538186"></p><h3 id="ä¸»æµåˆ†å¸ƒå¼é”å®ç°æ–¹å¼" tabindex="-1"><a class="header-anchor" href="#ä¸»æµåˆ†å¸ƒå¼é”å®ç°æ–¹å¼" aria-hidden="true">#</a> ä¸»æµåˆ†å¸ƒå¼é”å®ç°æ–¹å¼</h3><blockquote><p>1ï¼‰åŸºäºæ•°æ®åº“å®ç°åˆ†å¸ƒå¼é”</p><p>2ï¼‰åŸºäºç¼“å­˜ï¼ˆRedisï¼‰å®ç°åˆ†å¸ƒå¼é”ï¼ˆé«˜æ•ˆï¼‰[Redis å¦‚ä½•è§£å†³é›†ç¾¤æƒ…å†µä¸‹åˆ†å¸ƒå¼é”çš„å¯é æ€§ï¼Ÿå®é™…é¡¹ç›®ä¸­ä¸å»ºè®®ä½¿ç”¨ Redlock ç®—æ³•ï¼Œæˆæœ¬å’Œæ”¶ç›Šä¸æˆæ­£æ¯”ã€‚]</p><p>3ï¼‰åŸºäºZookeeperï¼ˆç¨³å®šï¼‰</p></blockquote><h3 id="rediså®ç°åˆ†å¸ƒå¼é”" tabindex="-1"><a class="header-anchor" href="#rediså®ç°åˆ†å¸ƒå¼é”" aria-hidden="true">#</a> Rediså®ç°åˆ†å¸ƒå¼é”</h3><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20221130184120016.png" alt="image-20221130184120016"></p><table><thead><tr><th><strong>issue ï¼š</strong></th><th><strong>solutionï¼š</strong></th></tr></thead><tbody><tr><td>åœ¨<strong>é‡Šæ”¾é”ä¹‹å‰</strong>çš„<strong>ä¸šåŠ¡å‡ºç°å¼‚å¸¸</strong>æˆ–è€…<strong>æœåŠ¡å®•æœºç­‰</strong>é€ æˆ<strong>é”æœªè¢«é‡Šæ”¾</strong> å½¢æˆ<strong>æ­»é”</strong>çš„å±€é¢</td><td><strong>ä½¿ç”¨åŒæ—¶ä¸Šé”åŒæ—¶è®¾ç½®é”è¿‡æœŸæ—¶é—´çš„æ–¹å¼ è‡ªåŠ¨åˆ é™¤é”</strong></td></tr><tr><td>åœ¨<strong>ä¸šåŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­é”å°±è¿‡æœŸ</strong>è‡ªåŠ¨åˆ é™¤äº†</td><td><strong>â‘ å°†è¿‡æœŸæ—¶é—´è®¾ç½®ä¹…ä¸€ç‚¹</strong> <strong>â‘¡ç»­æœŸ</strong></td></tr><tr><td><strong>é‡Šæ”¾é”ä¹Ÿè¦ä¿è¯åŸå­æ€§</strong> è¦ç¡®ä¿é‡Šæ”¾çš„æ˜¯è‡ªå·±çš„é” è€Œä¸æ˜¯é‡Šæ”¾åˆ«çš„çº¿ç¨‹çš„é”</td><td><strong>ç»“åˆluaè„šæœ¬</strong>ä¿è¯é‡Šæ”¾é”æ“ä½œçš„åŸå­æ€§</td></tr></tbody></table><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230130211954312.png" alt="image-20230130211954312"></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//ä¸Šredisåˆ†å¸ƒå¼é”SET Key Value NX EX Second</span>
<span class="token comment">//TODO åŸå­æ€§ä¸Šé”</span>
<span class="token class-name">String</span> uuid <span class="token operator">=</span> <span class="token constant">UUID</span><span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Boolean</span> isRedisLock <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setIfAbsent</span><span class="token punctuation">(</span><span class="token comment">//ä¸Šé”çš„åŒæ—¶è®¾ç½®é”çš„expireTime è¿‡æœŸæ—¶é—´ é¿å…å¹¶å‘æƒ…å†µä¸‹é€ æˆæ­»é”</span>
        <span class="token string">&quot;redisLock&quot;</span><span class="token punctuation">,</span>
        uuid<span class="token punctuation">,</span>
        <span class="token number">300</span><span class="token punctuation">,</span>
        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>isRedisLock<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//åˆ¤æ–­æ˜¯å¦åŠ é”æˆåŠŸ</span>
    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;è·å–redisåˆ†å¸ƒå¼é”æˆåŠŸ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//è‹¥åŠ é”æˆåŠŸåˆ™è¿›è¡Œåç»­æ“ä½œ åŠ é”æˆåŠŸåä¹ŸåŒæ—¶è¦æŠŠé”è¿›è¡Œåˆ é™¤</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">Catalog2Vo</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> catalogJsonFromDB<span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        catalogJsonFromDB <span class="token operator">=</span> <span class="token function">getCatalogJsonFromDB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ‰§è¡ŒæŸ¥åº“ä¸šåŠ¡ä»£ç </span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        <span class="token comment">//TODO åŸå­æ€§è§£é” ä½¿ç”¨luaè„šæœ¬</span>
        <span class="token class-name">String</span> lua <span class="token operator">=</span> <span class="token string">&quot;if redis.call(\&quot;get\&quot;,KEYS[1]) == ARGV[1]\n&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;then\n&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;    return redis.call(\&quot;del\&quot;,KEYS[1])\n&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;else\n&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;    return 0\n&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;end&quot;</span><span class="token punctuation">;</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>
                <span class="token keyword">new</span> <span class="token class-name">DefaultRedisScript</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>lua<span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">//è„šæœ¬ å¹¶ä¸”æŒ‡å®šè¿”å›å€¼ç±»å‹Long ã€1åˆ é™¤æˆåŠŸ 0åˆ é™¤å¤±è´¥ã€‘</span>
                <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">&quot;redisLock&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">//key</span>
                uuid<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//value</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;luaè„šæœ¬é‡Šæ”¾redisåˆ†å¸ƒå¼é”&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ä¸Šé”" tabindex="-1"><a class="header-anchor" href="#ä¸Šé”" aria-hidden="true">#</a> ä¸Šé”</h4><p>SETNX Key Value</p><p><strong>åŸå­åŠ é”</strong></p><p>ï¼ˆ<strong>è®¾ç½®é”®çš„è¿‡æœŸæ—¶é—´</strong> <strong>è¿‡æœŸåé‡Šæ”¾é”</strong>ï¼‰<strong>SETNX Key Second Value</strong> æˆ– --<strong>SET Key Value NX EX Second</strong> --expire second</p><p>æ¨è<strong>ä½¿ç”¨åŒæ—¶ä¸Šé”åŒæ—¶è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ–¹å¼</strong></p><h4 id="é‡Šæ”¾é”" tabindex="-1"><a class="header-anchor" href="#é‡Šæ”¾é”" aria-hidden="true">#</a> é‡Šæ”¾é”</h4><p>DEL Key</p><p><strong>åŸå­è§£é”</strong></p><p>ç»“åˆluaè„šæœ¬</p><p>An example of unlock script would be similar to the following:</p><div class="language-lua line-numbers-mode" data-ext="lua"><pre class="language-lua"><code><span class="token keyword">if</span> redis<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span>KEYS<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> ARGV<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
<span class="token keyword">then</span>
    <span class="token keyword">return</span> redis<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">&quot;del&quot;</span><span class="token punctuation">,</span>KEYS<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">else</span>
    <span class="token keyword">return</span> <span class="token number">0</span>
<span class="token keyword">end</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="redisson" tabindex="-1"><a class="header-anchor" href="#redisson" aria-hidden="true">#</a> Redisson</h3><p>https://github.com/redisson/redisson/wiki/Table-of-Content</p><p><strong>Redisåˆ†å¸ƒå¼é”çš„Javaå®ç°æ¡†æ¶</strong></p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230329120753805.png" alt="image-20230329120753805"></p><blockquote><p>**è¶…æ—¶æ—¶é—´ï¼š**å¦‚æœæ‹¿åˆ°åˆ†å¸ƒå¼é”çš„èŠ‚ç‚¹å®•æœºï¼Œä¸”è¿™ä¸ªé”æ­£å¥½å¤„äºé”ä½çš„çŠ¶æ€æ—¶ï¼Œä¼šå‡ºç°é”æ­»çš„çŠ¶æ€ï¼Œä¸ºäº†é¿å…è¿™ç§æƒ…å†µçš„å‘ç”Ÿï¼Œé”éƒ½ä¼šè®¾ç½®ä¸€ä¸ªè¿‡æœŸæ—¶é—´,åˆ†å¸ƒå¼é”çš„è¶…æ—¶æ—¶é—´é»˜è®¤æ˜¯30ç§’ã€‚</p><p>**è®¾ç½®è¶…æ—¶æ—¶é—´ï¼š**å¦å¤–Redisson è¿˜æä¾›äº†å¯ä»¥æŒ‡å®šleaseTimeå‚æ•°çš„åŠ é”æ–¹æ³•æ¥æŒ‡å®šåŠ é”çš„æ—¶é—´ã€‚<strong>è¶…è¿‡è¿™ä¸ªæ—¶é—´åé”ä¾¿è‡ªåŠ¨è§£å¼€</strong>äº†ï¼Œ<strong>ä¸ä¼šå»¶é•¿é”çš„æœ‰æ•ˆæœŸ</strong>ã€‚</p><p>ğŸ¶<strong>watch dogè‡ªåŠ¨å»¶æœŸæœºåˆ¶ï¼š<strong>è¿™æ ·ä¹Ÿå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœä¸€ä¸ªçº¿ç¨‹æ‹¿åˆ°äº†é”è®¾ç½®äº†30sè¶…æ—¶ï¼Œåœ¨30såè¿™ä¸ªçº¿ç¨‹è¿˜æ²¡æœ‰æ‰§è¡Œå®Œæ¯•ï¼Œé”è¶…æ—¶é‡Šæ”¾äº†ï¼Œå°±ä¼šå¯¼è‡´é—®é¢˜ã€‚Redissonæä¾›äº†ä¸€ä¸ªç›‘æ§é”çš„çœ‹é—¨ç‹—ï¼Œå®ƒçš„ä½œç”¨æ˜¯åœ¨Redissonå®ä¾‹è¢«å…³é—­å‰ï¼Œä¸æ–­çš„å»¶é•¿é”çš„æœ‰æ•ˆæœŸï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>å¦‚æœä¸€ä¸ªæ‹¿åˆ°é”çš„çº¿ç¨‹ä¸€ç›´æ²¡æœ‰å®Œæˆé€»è¾‘</strong>ï¼Œé‚£ä¹ˆ</strong>çœ‹é—¨ç‹—ä¼šå¸®åŠ©çº¿ç¨‹ä¸æ–­çš„å»¶é•¿é”è¶…æ—¶æ—¶é—´ï¼Œé”ä¸ä¼šå› ä¸ºè¶…æ—¶è€Œè¢«é‡Šæ”¾</strong>ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œçœ‹é—¨ç‹—<strong>æ¯éš”10så°±ä¼šè¿›è¡Œä¸€æ¬¡ç»­æœŸ,æŠŠé”é‡ç½®æˆ30ç§’</strong>ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ä¿®æ”¹Config.lockWatchdogTimeoutæ¥å¦è¡ŒæŒ‡å®šã€‚</p><ol><li>åªæœ‰åœ¨<strong>æœªæŒ‡å®šé”è¶…æ—¶æ—¶é—´æ—¶</strong>æ‰<strong>ä¼šä½¿ç”¨çœ‹é—¨ç‹—</strong>ï¼›</li><li>çœ‹é—¨ç‹—é»˜è®¤ç»­ç§Ÿæ—¶é—´æ˜¯ 10s å·¦å³ï¼Œ<code>internalLockLeaseTime / 3</code>ï¼›</li><li>å¯ä»¥é€šè¿‡ Config ç»Ÿä¸€è®¾ç½®çœ‹é—¨ç‹—çš„æ—¶é—´ï¼Œè®¾ç½® <code>lockWatchdogTimeout</code> å‚æ•°å³å¯ã€‚</li></ol><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230329121728159.png" alt="image-20230329121728159"></p><p><strong>å°è¯•è·å–é”æ—¶é—´</strong>ï¼šçº¿ç¨‹ä¼šå°è¯•åœ¨ä¸€å®šæ—¶é—´å†…è·å–é”ï¼Œå¦‚æœè¶…æ—¶åˆ™è¡¨ç¤ºè·å–å¤±è´¥,è¿”å›false</p><p>**å®•æœºï¼š**å¦‚æœå®•æœºäº†å®šæ—¶ä»»åŠ¡è·‘ä¸äº†,å°±ç»­ä¸äº†æœŸ,é‚£è‡ªç„¶30ç§’ä¹‹åé”å°±è§£å¼€äº†</p><p><strong>æ³¨æ„</strong>ï¼šå¦‚æœç¨‹åºé‡Šæ”¾é”æ“ä½œæ—¶å› ä¸ºå¼‚å¸¸æ²¡æœ‰è¢«æ‰§è¡Œï¼Œé‚£ä¹ˆé”æ— æ³•è¢«é‡Šæ”¾ï¼Œæ‰€ä»¥é‡Šæ”¾é”æ“ä½œä¸€å®šè¦æ”¾åˆ° finally {} ä¸­ï¼›</p></blockquote><p>pom</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token comment">&lt;!--Redisson åˆ†å¸ƒå¼é”æ¡†æ¶--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.redisson<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>redisson-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.19.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é…ç½®æ–‡ä»¶</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">redis</span><span class="token punctuation">:</span>
    <span class="token key atrule">host</span><span class="token punctuation">:</span> 192.168.199.181
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">6379</span>
    <span class="token key atrule">database</span><span class="token punctuation">:</span> <span class="token number">0</span>
    <span class="token key atrule">redisson</span><span class="token punctuation">:</span>
      <span class="token key atrule">file</span><span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>redisson.yml <span class="token comment">#ä¹Ÿå¯ä»¥ç›´æ¥å°†é…ç½®å†™åœ¨é…ç½®æ–‡ä»¶ä¸­ æˆ–è€…ä½¿ç”¨é…ç½®ç±»çš„å½¢å¼</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>redisson.yml</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">singleServerConfig</span><span class="token punctuation">:</span>
  <span class="token key atrule">address</span><span class="token punctuation">:</span> <span class="token string">&quot;redis://192.168.199.181:6379&quot;</span> <span class="token comment">#//è‹¥å®‰å…¨è¿æ¥ä½¿ç”¨ &quot;rediss://&quot; for SSL connection</span>
  <span class="token key atrule">database</span><span class="token punctuation">:</span> <span class="token number">0</span>
<span class="token key atrule">threads</span><span class="token punctuation">:</span> <span class="token number">16</span>
<span class="token key atrule">nettyThreads</span><span class="token punctuation">:</span> <span class="token number">32</span>
<span class="token key atrule">codec</span><span class="token punctuation">:</span> <span class="token tag">!&lt;org.redisson.codec.FstCodec&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token key atrule">transportMode</span><span class="token punctuation">:</span> <span class="token string">&quot;NIO&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230130214142510.png" alt="image-20230130214142510"></p><p>instance</p><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230130221014909.png" alt="image-20230130221014909"></p><h2 id="ç¼“å­˜æ•°æ®ä¸€è‡´æ€§â˜…" tabindex="-1"><a class="header-anchor" href="#ç¼“å­˜æ•°æ®ä¸€è‡´æ€§â˜…" aria-hidden="true">#</a> ç¼“å­˜æ•°æ®ä¸€è‡´æ€§â˜…</h2><p><a href="https://mp.weixin.qq.com/s?__biz=MzIyOTYxNDI5OA==&amp;mid=2247487312&amp;idx=1&amp;sn=fa19566f5729d6598155b5c676eee62d&amp;chksm=e8beb8e5dfc931f3e35655da9da0b61c79f2843101c130cf38996446975014f958a6481aacf1&amp;scene=178&amp;cur_album_id=1699766580538032128#rd" target="_blank" rel="noopener noreferrer">ç¼“å­˜å’Œæ•°æ®åº“ä¸€è‡´æ€§é—®é¢˜ï¼Œçœ‹è¿™ç¯‡å°±å¤Ÿäº† (qq.com)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code> <span class="token operator">*</span> ä»æ•°æ®åº“ä¸­è·å–æ•°æ® <span class="token constant">TODO</span> ä½¿ç”¨<span class="token class-name">Redisson</span>
 <span class="token operator">*</span> <span class="token constant">TODO</span> ç¼“å­˜ä¸­çš„æ•°æ®å’Œæ•°æ®åº“ä¸­çš„æ•°æ®ä¿å­˜æ•°æ®ä¸€è‡´æ€§ï¼Ÿ<span class="token punctuation">(</span>ç¼“å­˜å¤šæ•°åº”ç”¨åœ¨è¯»å¤šå†™å°‘çš„ä¸šåŠ¡æƒ…å†µä¸‹<span class="token punctuation">)</span>
 <span class="token operator">*</span> <span class="token number">1</span>ï¼‰åŒå†™æ¨¡å¼<span class="token punctuation">(</span>åœ¨æ•°æ®åº“ä¸­è¿›è¡Œäº†å†™æ“ä½œ åŒæ—¶åŒæ­¥å†™åˆ°ç¼“å­˜ä¸­<span class="token punctuation">)</span>
 <span class="token operator">*</span> <span class="token number">2</span>ï¼‰å¤±æ•ˆæ¨¡å¼<span class="token punctuation">(</span>åœ¨æ•°æ®åº“ä¸­è¿›è¡Œäº†å†™æ“ä½œ å°†ç¼“å­˜ä¸­çš„æ•°æ®åŠæ—¶çš„è¿›è¡Œåˆ é™¤ ä¸‹æ¬¡è¿›è¡ŒæŸ¥è¯¢å°±ä»æ•°æ®åº“ä¸­è·å–æœ€æ–°çš„æ•°æ®<span class="token punctuation">)</span>
 <span class="token operator">*</span> ä»¥ä¸Šæ–¹æ³•å¹¶å‘æƒ…å†µä¸‹ä»ç„¶æ— æ³•å®Œå…¨è§£å†³æ•°æ®ä¸€è‡´æ€§é—®é¢˜
 <span class="token operator">*</span>
 <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">)</span>å¯ä»¥ä½¿ç”¨è¯»å†™é”<span class="token punctuation">(</span>è¯»è¯»æƒ…å†µä¸‹ç›¸å½“äºæ— é”<span class="token punctuation">)</span>
 <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">)</span>ä½¿ç”¨canalï¼ˆalibabaçš„è§£å†³ç¼“å­˜æ•°æ®ä¸€è‡´æ€§çš„å·¥å…· canalå°†è‡ªå·±ä¼ªè£…æˆmysqlçš„ä»åº“ å®æ—¶å°†binlogä¸­çš„å†™æ“ä½œæ›´æ–°æ‰§è¡Œåˆ°redisä¸­ï¼‰è®¢é˜…æ•°æ®åº“çš„binlog
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://eddie-typora-image.oss-cn-shenzhen.aliyuncs.com/typora-user-images/image-20230130220513829.png" alt="image-20230130220513829"></p></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/EddieZturbo/Eddie-Tech-Blog.github.io/edit/main/docs/backend/middleware/Redis.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page on GitHub" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->Edit this page on GitHub<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item git-info"><!----><!----></div></footer><nav class="page-nav"><a href="/backend/middleware/MQ.html" class="nav-link prev" aria-label="MQ"><div class="hint"><span class="arrow start"></span>Prev</div><div class="link"><!---->MQ</div></a><!----></nav><!----><!----><!--]--></main><!--]--><footer class="footer-wrapper"><div class="footer">Default footer</div><div class="copyright">Copyright Â© 2023 EddieZ</div></footer></div><!--]--><!--]--><!----><!--]--></div>
    <script type="module" src="/assets/app-7117916c.js" defer></script>
  </body>
</html>
